USE [sigh]
GO
/****** Object:  Schema [Imagenes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
CREATE SCHEMA [Imagenes] AUTHORIZATION [dbo]
GO
/****** Object:  Schema [SANALITICOSINTF]    Script Date: 12/01/2026 02:48:06 p. m. ******/
CREATE SCHEMA [SANALITICOSINTF] AUTHORIZATION [dbo]
GO
/****** Object:  UserDefinedFunction [dbo].[cleanSpecialChar]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[cleanSpecialChar](@InTexto [varchar](1000))
RETURNS [varchar](1000) WITH EXECUTE AS CALLER
AS
BEGIN
	DECLARE @VarTexto varchar(1000)

	SET @VarTexto =  REPLACE(@InTexto, ' ', '')
	SET @VarTexto =  REPLACE(@VarTexto, 'á', 'a')
	SET @VarTexto =  REPLACE(@VarTexto, 'é', 'e')
	SET @VarTexto =  REPLACE(@VarTexto, 'í', 'i')
	SET @VarTexto =  REPLACE(@VarTexto, 'ó', 'o')
	SET @VarTexto =  REPLACE(@VarTexto, 'ú', 'u')
	SET @VarTexto =  REPLACE(@VarTexto, ',', '')
	SET @VarTexto =  REPLACE(@VarTexto, ';', '')
	SET @VarTexto =  REPLACE(@VarTexto, '.', '')

	RETURN @VarTexto
END
GO
ALTER AUTHORIZATION ON [dbo].[cleanSpecialChar] TO  SCHEMA OWNER
GO
/****** Object:  UserDefinedFunction [dbo].[DNI_HISTORIAdevuelveSIN9]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[DNI_HISTORIAdevuelveSIN9](@nroHistoria [int])
RETURNS [int] WITH EXECUTE AS CALLER
AS
begin
   declare @historia int
   if @nroHistoria>900000000
      select @historia= (@nroHistoria-900000000)
   else
      select @historia=  @nroHistoria
   return @historia
end
GO
ALTER AUTHORIZATION ON [dbo].[DNI_HISTORIAdevuelveSIN9] TO  SCHEMA OWNER
GO
/****** Object:  UserDefinedFunction [dbo].[STRING_SPLIT]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[STRING_SPLIT](@StrParam [varchar](max))
RETURNS @DATA TABLE (
	[VALUE] [varchar](50) NULL
) WITH EXECUTE AS CALLER
AS
BEGIN


		DECLARE @Str VARCHAR(MAX)=''
		DECLARE @Part NVARCHAR(MAX)
		DECLARE @IND INT
		DECLARE @EIND INT
		IF @StrParam IS NULL
			SET @StrParam = ''
		IF @StrParam <> ''
			SET @Str = ',' + @StrParam + ','

		SET @IND = CHARINDEX(',',@Str)
		set @EIND = 0

		WHILE(@IND != LEN(@STR))
		BEGIN
			SET  @EIND = ISNULL(((CHARINDEX(',', @Str, @IND + 1)) - @IND - 1), 0)
			INSERT INTO @DATA(VALUE) VALUES(SUBSTRING(@Str, (@IND  + 1),  @EIND))
			SELECT @IND = ISNULL(CHARINDEX(',', @STR, @IND + 1), 0)
		END

		RETURN

	END
GO
ALTER AUTHORIZATION ON [dbo].[STRING_SPLIT] TO  SCHEMA OWNER
GO
/****** Object:  UserDefinedFunction [dbo].[ufn_Calcular_SaldoActual]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ufn_Calcular_SaldoActual](@idAlmacen [int], @idProducto [int], @Fecha_inicio [datetime], @Fecha_fin [datetime], @saldo_inicial [int])
RETURNS [int] WITH EXECUTE AS CALLER
AS
BEGIN
declare @saldo AS int
;WITH MOVIMIENTOS AS(
select FM.MovNumero,FM.MovTipo,idAlmacenOrigen,idAlmacenDestino,FMD.idProducto,CODIGO,lote,Cantidad,fechaCreacion from farmMovimiento FM
inner join farmMovimientoDetalle FMD on FM.MovNumero=FMD.MovNumero
inner join FactCatalogoBienesInsumos CBI on FMD.idProducto=CBI.IdProducto
and (idAlmacenDestino=@idAlmacen or idAlmacenOrigen=@idAlmacen) AND FMD.idProducto=@idProducto
AND idEstadoMovimiento=1
and fechaCreacion > =@Fecha_inicio and fechaCreacion < =@fecha_fin
--CONDICIÓN PARA EL CÁLCULO
and ((FMD.MovTipo='E' and idAlmacenDestino=@idAlmacen) or (FMD.MovTipo='S' and idAlmacenOrigen=@idAlmacen))
)
, CALCULOS AS(
select idProducto, CASE
WHEN MovTipo='E' THEN SUM(Cantidad) ELSE 0 END AS INGRESOS,
CASE WHEN  MovTipo='S' THEN SUM(Cantidad)ELSE 0 END AS EGRESOS
from MOVIMIENTOS
GROUP BY MovTipo, idProducto)
,CALCULO_FINAL AS(SELECT SUM(INGRESOS)AS INGRESOS, SUM(EGRESOS)AS EGRESOS FROM CALCULOS)

SELECT @saldo=isnull(@saldo_inicial,0)+ INGRESOS - (EGRESOS) FROM CALCULO_FINAL
RETURN isnull(@saldo,0)

END
--SCCQ 13/08/2020 Cambio26 Fin


GO
ALTER AUTHORIZATION ON [dbo].[ufn_Calcular_SaldoActual] TO  SCHEMA OWNER
GO
/****** Object:  UserDefinedFunction [dbo].[ufn_GenerarCorrelativoFarmRelMod]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[ufn_GenerarCorrelativoFarmRelMod](@MovTipo [char](1), @idTipoLocales [char](1), @idTipoSuministro [char](2), @DocumentoIdtipo [int])
RETURNS [int] WITH EXECUTE AS CALLER
AS
BEGIN
	 declare @correlativo AS int
	 DECLARE @EXISTE AS BIT
		SELECT  @correlativo=DocumentoUltimoNumero
				 FROM     dbo.farmRelMod LEFT OUTER JOIN dbo.farmTipoConceptos ON dbo.farmRelMod.ConceptoCodigo = dbo.farmTipoConceptos.codigoMINSA
				 WHERE   dbo.farmRelMod.TipoAlmacen=@idTipoLocales and dbo.farmRelMod.TipoMov=@MovTipo and dbo.farmRelMod.tipoSuministro=@idTipoSuministro
				 and DocumentoId=@DocumentoIdtipo
	if @@rowcount = 0--Sin resultados de consulta
	  begin
		 set @correlativo=0
	  end
	else
	  begin
			if @correlativo=null--Campo correlativo es NULL
				begin
					set @correlativo=1
				end
			else
				begin
					set @correlativo=@correlativo+1--Se agrega en  el correlativo.
				end
	  end
	RETURN @correlativo
end
--SCCQ 08/10/2020 Cambio28 Fin
GO
ALTER AUTHORIZATION ON [dbo].[ufn_GenerarCorrelativoFarmRelMod] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ArchiveroServicio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ArchiveroServicio](
	[IdArchivero] [int] IDENTITY(1,1) NOT NULL,
	[IdEmpleado] [int] NULL,
	[IdServicio] [int] NULL,
	[EsConsultorioAsignado] [bit] NULL,
 CONSTRAINT [ResponsableHistoriaServicio_PK] PRIMARY KEY CLUSTERED
(
	[IdArchivero] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AreaTramitaSeguros]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AreaTramitaSeguros](
	[idAreaTramitaSeguros] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_AreaTramitaSeguros] PRIMARY KEY CLUSTERED
(
	[idAreaTramitaSeguros] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AreaTramitaSeguros] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionCEServicios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionCEServicios](
	[IdAtencionCEServicios] [int] IDENTITY(1,1) NOT NULL,
	[IdAtencion] [int] NOT NULL,
	[Codigo_Item] [varchar](10) NOT NULL,
	[Descripcion_Item] [varchar](300) NOT NULL,
	[Fg_Tipo] [varchar](2) NOT NULL,
	[Descripcion_Tipo_Item] [varchar](100) NOT NULL,
	[IdSubclasificacionDx] [int] NOT NULL,
	[Lab1] [varchar](3) NULL,
	[Lab2] [varchar](3) NULL,
	[Lab3] [varchar](3) NULL,
	[Estado] [int] NOT NULL,
	[idAnterior] [int] NULL,
 CONSTRAINT [PK_AtencionCEServicios] PRIMARY KEY CLUSTERED
(
	[IdAtencionCEServicios] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionCEServicios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Atenciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Atenciones](
	[IdAtencion] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[Edad] [int] NOT NULL,
	[FechaIngreso] [datetime] NOT NULL,
	[HoraIngreso] [char](5) NOT NULL,
	[IdDestinoAtencion] [int] NULL,
	[IdTipoCondicionAlServicio] [int] NULL,
	[IdTipoCondicionALEstab] [int] NULL,
	[IdServicioIngreso] [int] NOT NULL,
	[IdMedicoIngreso] [int] NOT NULL,
	[IdEspecialidadMedico] [int] NULL,
	[IdMedicoEgreso] [int] NULL,
	[FechaEgreso] [datetime] NULL,
	[HoraEgreso] [char](5) NULL,
	[IdOrigenAtencion] [int] NULL,
	[FechaEgresoAdministrativo] [datetime] NULL,
	[HoraEgresoAdministrativo] [char](5) NULL,
	[IdCondicionAlta] [int] NULL,
	[IdTipoAlta] [int] NULL,
	[IdServicioEgreso] [int] NULL,
	[IdCamaIngreso] [int] NULL,
	[IdCamaEgreso] [int] NULL,
	[IdTipoGravedad] [int] NULL,
	[IdTipoEdad] [int] NULL,
	[IdCuentaAtencion] [int] NOT NULL,
	[IdTipoServicio] [int] NULL,
	[IdFormaPago] [int] NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[idEstadoAtencion] [int] NULL,
	[EsPacienteExterno] [bit] NULL,
	[idSunasaPacienteHistorico] [int] NULL,
	[horaInicioAtencion] [varchar](5) NULL,
	[EpsPorcentaje] [money] NULL,
	[ENVIADO_HISWEB] [int] NOT NULL,
 CONSTRAINT [PK_Atenciones] PRIMARY KEY CLUSTERED
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Atenciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesConvenio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesConvenio](
	[idAtencionesConvenio] [int] IDENTITY(1,1) NOT NULL,
	[idPaciente] [int] NOT NULL,
	[nroOficio] [varchar](20) NOT NULL,
	[FechaSesion] [datetime] NOT NULL,
	[ImporteSesion] [money] NULL,
	[idUsuario] [int] NOT NULL,
	[idProducto] [int] NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConvenio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesDatosAdicionales]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesDatosAdicionales](
	[idAtencion] [int] NOT NULL,
	[DireccionDomicilio] [varchar](100) NULL,
	[NombreAcompaniante] [varchar](100) NULL,
	[Observacion] [varchar](200) NULL,
	[ProximaCita] [datetime] NULL,
	[NumeroDeHijos] [int] NULL,
	[IdSiaSis] [int] NULL,
	[IdTipoReferenciaOrigen] [int] NULL,
	[IdTipoReferenciaDestino] [int] NULL,
	[IdEstablecimientoOrigen] [int] NULL,
	[IdEstablecimientoDestino] [int] NULL,
	[IdEstablecimientoNoMinsaOrigen] [int] NULL,
	[IdEstablecimientoNoMinsaDestino] [int] NULL,
	[HuboInfeccionIntraHospitalaria] [int] NULL,
	[TieneNecropsia] [bit] NULL,
	[IdMedicoRespNacimiento] [int] NULL,
	[RecienNacido] [bit] NULL,
	[NroReferenciaOrigen] [varchar](20) NULL,
	[NroReferenciaDestino] [varchar](20) NULL,
	[FuaCodigoPrestacion] [varchar](3) NULL,
	[SisCodigo] [varchar](2) NULL,
	[SeImprimioFicha] [bit] NULL,
	[sisAfiliacion] [varchar](30) NULL,
	[referenciaOservicio] [varchar](7) NULL,
	[referenciaOidDiagnostico] [int] NULL,
	[referenciaDservicio] [varchar](7) NULL,
	[referenciaDfextension] [datetime] NULL,
	[referenciaDftramite] [datetime] NULL,
	[ReferenciaMedicoOColeg] [varchar](6) NULL,
	[ReferenciaMedicoOIdcolegio] [varchar](2) NULL,
	[idServicioDestino] [int] NULL,
	[idAtencionEmeg_CE] [int] NULL,
	[referenciaOdniMedico] [varchar](8) NULL,
	[acompanianteDNI] [varchar](8) NULL,
	[emergenciaCorrelativo] [varchar](10) NULL,
 CONSTRAINT [PK_AtencionesDatosAdicionales] PRIMARY KEY CLUSTERED
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionales] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesDiagnosticos](
	[IdAtencionDiagnostico] [int] IDENTITY(1,1) NOT NULL,
	[IdAtencion] [int] NOT NULL,
	[IdClasificacionDx] [int] NOT NULL,
	[IdDiagnostico] [int] NULL,
	[IdSubclasificacionDx] [int] NULL,
	[labConfHIS] [varchar](3) NULL,
	[GrupoHIS] [int] NULL,
	[SubGrupoHIS] [int] NULL,
 CONSTRAINT [AtencionesDiagnosticos_PK] PRIMARY KEY CLUSTERED
(
	[IdAtencionDiagnostico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesEmergencia]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtencionesEmergencia](
	[IdAtencionEmergencia] [int] IDENTITY(1,1) NOT NULL,
	[IdAtencion] [int] NULL,
	[IdCausaExternaMorbilidad] [int] NULL,
	[IdLugarEvento] [int] NULL,
	[IdTipoEvento] [int] NULL,
	[IdSeguridad] [int] NULL,
	[IdRelacionAgresorVictima] [int] NULL,
	[IdClaseAccidente] [int] NULL,
	[IdTipoVehiculo] [int] NULL,
	[IdTipoTransporte] [int] NULL,
	[IdUbicacionLesionado] [int] NULL,
	[IdPosicionLesionadoALAB] [int] NULL,
	[IdGrupoOcupacionalALAB] [int] NULL,
	[IdTipoAgenteAGAN] [int] NULL,
	[idEstadoLlegada] [int] NULL,
	[comoLlego] [int] NULL,
	[tipoAtencion] [int] NULL,
 CONSTRAINT [AtencionesEmergencia_PK] PRIMARY KEY CLUSTERED
(
	[IdAtencionEmergencia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesEpisodiosCabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtencionesEpisodiosCabecera](
	[idPaciente] [int] NOT NULL,
	[idEpisodio] [int] NOT NULL,
	[FechaApertura] [datetime] NOT NULL,
	[FechaCierre] [datetime] NULL,
 CONSTRAINT [PK_AtencionesEpisodiosCabecera] PRIMARY KEY CLUSTERED
(
	[idPaciente] ASC,
	[idEpisodio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosCabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesEpisodiosDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtencionesEpisodiosDetalle](
	[idPaciente] [int] NOT NULL,
	[idEpisodio] [int] NOT NULL,
	[idAtencion] [int] NOT NULL,
 CONSTRAINT [PK_AtencionesEpisodiosDetalle] PRIMARY KEY CLUSTERED
(
	[idEpisodio] ASC,
	[idPaciente] ASC,
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesEstanciaHospitalaria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesEstanciaHospitalaria](
	[IdEstanciaHospitalaria] [int] IDENTITY(1,1) NOT NULL,
	[Secuencia] [int] NOT NULL,
	[FechaOcupacion] [datetime] NOT NULL,
	[HoraOcupacion] [char](5) NOT NULL,
	[FechaDesocupacion] [datetime] NULL,
	[HoraDesocupacion] [char](5) NULL,
	[IdServicio] [int] NOT NULL,
	[IdCama] [int] NULL,
	[DiasEstancia] [decimal](8, 2) NULL,
	[IdMedicoOrdena] [int] NULL,
	[IdFacturacionServicio] [int] NULL,
	[IdAtencion] [int] NULL,
	[LlegoAlServicio] [int] NULL,
	[idProducto] [int] NULL,
	[IdMedicoOrdenaOrigen] [int] NULL,
 CONSTRAINT [OcupacionCamas_PK] PRIMARY KEY CLUSTERED
(
	[IdEstanciaHospitalaria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalaria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesHijoMadre]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtencionesHijoMadre](
	[idAtencion] [int] NOT NULL,
	[idAtencionMadre] [int] NULL,
 CONSTRAINT [PK_AtencionesMadreHijo] PRIMARY KEY CLUSTERED
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesHijoMadre] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesLabSinDxSinCpt]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesLabSinDxSinCpt](
	[idAtencion] [int] NOT NULL,
	[Grupo] [int] NOT NULL,
	[SubGrupo] [int] NOT NULL,
	[lab] [varchar](3) NOT NULL,
 CONSTRAINT [PK_AtencionesLabSinDxSinCpt] PRIMARY KEY CLUSTERED
(
	[idAtencion] ASC,
	[Grupo] ASC,
	[SubGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesLabSinDxSinCpt] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtencionesNacimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtencionesNacimientos](
	[IdNacimiento] [int] IDENTITY(1,1) NOT NULL,
	[FechaNacimiento] [datetime] NOT NULL,
	[EdadSemanas] [int] NOT NULL,
	[Talla] [float] NOT NULL,
	[Peso] [float] NOT NULL,
	[IdTipoSexo] [int] NOT NULL,
	[IdCondicionRN] [int] NOT NULL,
	[IdAtencion] [int] NOT NULL,
	[IdPacienteNacido] [int] NULL,
	[apgar_1] [int] NULL,
	[apgar_5] [int] NULL,
	[ClamplajeFecha] [datetime] NULL,
	[NroOrdenHijoEnParto] [int] NULL,
	[NroOrdenHijo] [int] NULL,
	[docIdentidad] [varchar](20) NULL,
	[IdDocIdentidad] [int] NULL,
 CONSTRAINT [Nacimientos_PK] PRIMARY KEY CLUSTERED
(
	[IdNacimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenHospCenso]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenHospCenso](
	[IdRangoCensoHosp] [int] NOT NULL,
	[RangoInicial] [money] NOT NULL,
	[RangoFinal] [money] NOT NULL,
	[RGBRojo] [int] NULL,
	[RGBVerde] [int] NULL,
	[RGBAzul] [int] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenHospCenso] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteGrupo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenInteGrupo](
	[IdAtenInteGrupo] [int] IDENTITY(1,1) NOT NULL,
	[AtencionIntegralGrupo] [varchar](50) NOT NULL,
	[DesdeAnio] [int] NOT NULL,
	[DesdeMes] [int] NOT NULL,
	[DesdeDia] [int] NOT NULL,
	[HastaAnio] [int] NOT NULL,
	[HastaMes] [int] NOT NULL,
	[HastaDia] [int] NOT NULL,
 CONSTRAINT [PK_AtencionIntegralGrupos] PRIMARY KEY CLUSTERED
(
	[IdAtenInteGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteGrupoHCPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteGrupoHCPaciente](
	[IdPaciente] [int] NOT NULL,
	[IdGrupoHCPaciente] [int] NOT NULL,
	[IdAtenInteGrupo] [int] NOT NULL,
	[IdPregunta] [int] NOT NULL,
 CONSTRAINT [PK_AtenInteGrupoHCPaciente] PRIMARY KEY CLUSTERED
(
	[IdGrupoHCPaciente] ASC,
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteGrupoHCRespuestaPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenInteGrupoHCRespuestaPaciente](
	[IdGrupoHCPaciente] [int] NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[ItemRespuesta] [int] NOT NULL,
	[ValorTexto] [varchar](255) NULL,
	[ValorNumero] [money] NULL,
	[ValorFecha] [datetime] NULL,
	[ValorNumeroFin] [money] NULL,
	[ValorFechaFin] [datetime] NULL,
	[ValorEspecificacion] [varchar](1500) NULL,
	[EsActivo] [bit] NOT NULL,
 CONSTRAINT [PK_AtenInteGrupoHCRespuestaPaciente] PRIMARY KEY CLUSTERED
(
	[IdGrupoHCPaciente] ASC,
	[IdPaciente] ASC,
	[ItemRespuesta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemDesarrollo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenInteItemDesarrollo](
	[IdItemDesarrollo] [int] IDENTITY(1,1) NOT NULL,
	[ItemDesarrollo] [varchar](200) NOT NULL,
 CONSTRAINT [PK_PerinatalItemDesarrollo] PRIMARY KEY CLUSTERED
(
	[IdItemDesarrollo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrollo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemPlan]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenInteItemPlan](
	[IdAtenInteItemPlan] [int] IDENTITY(1,1) NOT NULL,
	[ItemPlan] [varchar](50) NOT NULL,
 CONSTRAINT [PK_AtenInteItemPlan] PRIMARY KEY CLUSTERED
(
	[IdAtenInteItemPlan] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlan] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemPlanCrecimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteItemPlanCrecimiento](
	[IdItemPlanCrecimiento] [bigint] IDENTITY(1,1) NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[NumeroSesion] [int] NOT NULL,
 CONSTRAINT [PK_AtenInteItemPlanCrecimiento] PRIMARY KEY CLUSTERED
(
	[IdItemPlanCrecimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanCrecimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemPlanDesarrollo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteItemPlanDesarrollo](
	[IdItemPlanDesarrollo] [bigint] IDENTITY(1,1) NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[NumeroSesion] [int] NOT NULL,
 CONSTRAINT [PK_AtenItemPlanDesarrollo] PRIMARY KEY CLUSTERED
(
	[IdItemPlanDesarrollo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanDesarrollo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemPlanProcedimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteItemPlanProcedimiento](
	[IdItemPlanProcedimiento] [bigint] IDENTITY(1,1) NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[NumeroDosis] [tinyint] NOT NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
	[IdDiagnostico] [int] NULL,
 CONSTRAINT [PK_AtenInteItemPlanInmunizacion] PRIMARY KEY CLUSTERED
(
	[IdItemPlanProcedimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanProcedimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteItemPlanSuplemento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteItemPlanSuplemento](
	[ItemPlanSuplemento] [bigint] IDENTITY(1,1) NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[NumeroDosis] [int] NULL,
	[IdDiagnostico] [int] NULL,
 CONSTRAINT [PK_AtenInteItemPlanSuplemento] PRIMARY KEY CLUSTERED
(
	[ItemPlanSuplemento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSuplemento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenIntePlanAtencion](
	[IdPlanAtencion] [int] IDENTITY(1,1) NOT NULL,
	[IdAtenInteGrupo] [int] NOT NULL,
	[IdPeriodoTiempo] [int] NOT NULL,
	[EdadAnio] [int] NOT NULL,
	[EdadMes] [int] NOT NULL,
	[EdadDia] [int] NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [PK_AtenIntePlanAtencion] PRIMARY KEY CLUSTERED
(
	[IdPlanAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanCrecDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanCrecDetalle](
	[IdItemPlanCrecimiento] [bigint] NOT NULL,
	[IdTriajeVariable] [int] NOT NULL,
	[OrdenItem] [int] NOT NULL,
 CONSTRAINT [PK_AtenIntePlanCrecDetalle] PRIMARY KEY CLUSTERED
(
	[IdItemPlanCrecimiento] ASC,
	[IdTriajeVariable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanCrecimientoPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanCrecimientoPaciente](
	[IdPlanCrecimientoPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
	[FechaProgramada] [datetime] NOT NULL,
	[FechaEjecucion] [datetime] NULL,
	[NumeroSesion] [int] NOT NULL,
	[IdAtencion] [int] NULL,
	[IdEstablecimiento] [int] NULL,
 CONSTRAINT [PK_AtenIntePlanCrecimientoPaciente] PRIMARY KEY CLUSTERED
(
	[IdPlanCrecimientoPaciente] ASC,
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanCrecPacienteDet]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanCrecPacienteDet](
	[IdPlanCrecimientoPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[IdTriajeVariable] [int] NOT NULL,
	[VariableValor] [money] NOT NULL,
	[OrdenItem] [int] NOT NULL,
 CONSTRAINT [PK_AtenIntePlanCrecPacienteDet] PRIMARY KEY CLUSTERED
(
	[IdPlanCrecimientoPaciente] ASC,
	[IdPlanIntegralPaciente] ASC,
	[IdTriajeVariable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecPacienteDet] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanDesarrolloPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanDesarrolloPaciente](
	[IdPlanDesarrolloPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[Evaluacion] [int] NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
	[FechaProgramada] [datetime] NOT NULL,
	[FechaEjecucion] [datetime] NULL,
	[NumeroSesion] [int] NOT NULL,
	[IdAtencion] [int] NULL,
	[IdEstablecimiento] [int] NULL,
 CONSTRAINT [PK_AtenIntePlanDesarrolloPaciente] PRIMARY KEY CLUSTERED
(
	[IdPlanDesarrolloPaciente] ASC,
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanDesDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanDesDetalle](
	[IdItemPlanDesarrollo] [bigint] NOT NULL,
	[IdItemDesarrollo] [int] NOT NULL,
	[OrdenItem] [int] NOT NULL,
 CONSTRAINT [PK_AtenIntePlanDesDetalle] PRIMARY KEY CLUSTERED
(
	[IdItemPlanDesarrollo] ASC,
	[IdItemDesarrollo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanDesPacienteDet]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanDesPacienteDet](
	[IdPlanDesarrolloPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[IdItemDesarrollo] [int] NOT NULL,
	[OrdenItem] [int] NOT NULL,
	[EjecutaAccion] [bit] NULL,
 CONSTRAINT [PK_AtenIntePlanDesPacienteDet] PRIMARY KEY CLUSTERED
(
	[IdPlanDesarrolloPaciente] ASC,
	[IdPlanIntegralPaciente] ASC,
	[IdItemDesarrollo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesPacienteDet] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanIntegralPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanIntegralPaciente](
	[IdPlanIntegralPaciente] [bigint] IDENTITY(1,1) NOT NULL,
	[IdAtenInteGrupo] [int] NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[FechaElaboracion] [datetime] NOT NULL,
 CONSTRAINT [PK_AtenIntePlanIntegralPaciente] PRIMARY KEY CLUSTERED
(
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanIntegralPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanItemElaborado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanItemElaborado](
	[IdAtenInteItemPlan] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[EsElaborado] [bit] NOT NULL,
 CONSTRAINT [PK_AtenIntePlanItemElaborado] PRIMARY KEY CLUSTERED
(
	[IdAtenInteItemPlan] ASC,
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanItemElaborado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanProcedimientoPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenIntePlanProcedimientoPaciente](
	[IdPlanProcedimientoPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdPlanAtencion] [int] NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
	[FechaProgramada] [datetime] NOT NULL,
	[FechaEjecucion] [datetime] NULL,
	[NumeroDosis] [tinyint] NOT NULL,
	[CodigoHIS] [varchar](7) NULL,
	[IdAtencion] [int] NULL,
	[IdEstablecimiento] [int] NULL,
	[IdDiagnostico] [int] NULL,
 CONSTRAINT [PK_AtenIntePlanInmunizacionPaciente] PRIMARY KEY CLUSTERED
(
	[IdPlanProcedimientoPaciente] ASC,
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlanSuplementoPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlanSuplementoPaciente](
	[IdPlanSuplementoPaciente] [int] NOT NULL,
	[IdPlanIntegralPaciente] [bigint] NOT NULL,
	[IdPlanAtencion] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
	[FechaProgramada] [datetime] NOT NULL,
	[FechaEjecucion] [datetime] NULL,
	[NumeroDosis] [int] NOT NULL,
	[IdAtencion] [int] NULL,
	[IdEstablecimiento] [int] NULL,
	[IdDiagnostico] [int] NULL,
 CONSTRAINT [PK_AtenIntePlanSuplementoPaciente] PRIMARY KEY CLUSTERED
(
	[IdPlanSuplementoPaciente] ASC,
	[IdPlanIntegralPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePlantillaItemPlan]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenIntePlantillaItemPlan](
	[IdPlantillaItemPlan] [int] IDENTITY(1,1) NOT NULL,
	[IdAtenInteGrupo] [int] NOT NULL,
	[IdAtenInteItemPlan] [int] NOT NULL,
 CONSTRAINT [PK_AtenIntePlantillaItemPlan] PRIMARY KEY CLUSTERED
(
	[IdPlantillaItemPlan] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlantillaItemPlan] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenIntePregunta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AtenIntePregunta](
	[IdPregunta] [int] IDENTITY(1,1) NOT NULL,
	[Pregunta] [varchar](70) NOT NULL,
	[TipoRespuesta] [int] NOT NULL,
	[TipoValorRespuesta] [int] NOT NULL,
 CONSTRAINT [PK_AtenIntePregunta] PRIMARY KEY CLUSTERED
(
	[IdPregunta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePregunta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteValorPeso]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteValorPeso](
	[IdValorPeso] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoSexo] [int] NOT NULL,
	[EdadMeses] [int] NOT NULL,
	[NroDesviacion] [int] NOT NULL,
	[ValorPeso] [money] NOT NULL,
 CONSTRAINT [PK_AtenInteValorPeso] PRIMARY KEY CLUSTERED
(
	[IdValorPeso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPeso] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[AtenInteValorTalla]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AtenInteValorTalla](
	[IdValorTalla] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoSexo] [int] NOT NULL,
	[EdadMeses] [int] NOT NULL,
	[NroDesviacion] [int] NOT NULL,
	[ValorTalla] [money] NOT NULL,
 CONSTRAINT [PK_AtenInteValorTalla] PRIMARY KEY CLUSTERED
(
	[IdValorTalla] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTalla] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Auditoria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Auditoria](
	[IdAuditoria] [int] IDENTITY(1,1) NOT NULL,
	[FechaHora] [datetime] NOT NULL,
	[Tabla] [varchar](50) NOT NULL,
	[IdRegistro] [int] NOT NULL,
	[Accion] [char](1) NOT NULL,
	[IdEmpleado] [int] NULL,
	[idListItem] [int] NULL,
	[nombrePc] [varchar](30) NULL,
	[observaciones] [varchar](100) NULL,
 CONSTRAINT [SeguridadAuditoria_PK] PRIMARY KEY CLUSTERED
(
	[IdAuditoria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Auditoria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaCaja]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaCaja](
	[IdCaja] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Descripcion] [varchar](250) NOT NULL,
	[loginPC] [varchar](50) NULL,
	[ImpresoraDefault] [varchar](50) NULL,
	[Impresora2] [varchar](50) NULL,
	[idTipoComprobante] [int] NULL,
	[SerieImpresoraDefault] [varchar](20) NULL,
	[SerieImpresora2] [varchar](20) NULL,
	[FormatoImpDefaultCinta] [bit] NULL,
	[FormatoImp2Cinta] [bit] NULL,
	[IdTipoComprobante2] [int] NULL,
	[idPartida] [int] NULL,
	[idCentroCosto] [int] NULL,
 CONSTRAINT [CajaCaja_PK] PRIMARY KEY CLUSTERED
(
	[IdCaja] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaCaja] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaCajeroSupervisor]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CajaCajeroSupervisor](
	[IdCajeroSupervisor] [int] IDENTITY(1,1) NOT NULL,
	[IdTurno] [int] NOT NULL,
 CONSTRAINT [PK_CajaCajeroSupervisor] PRIMARY KEY CLUSTERED
(
	[IdCajeroSupervisor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroSupervisor] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaComprobantesPago]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaComprobantesPago](
	[IdComprobantePago] [int] IDENTITY(1,1) NOT NULL,
	[NroSerie] [nvarchar](4) NULL,
	[NroDocumento] [nvarchar](8) NULL,
	[RazonSocial] [varchar](100) NULL,
	[RUC] [char](11) NULL,
	[SubTotal] [money] NULL,
	[IGV] [money] NULL,
	[Total] [money] NOT NULL,
	[FechaCobranza] [datetime] NULL,
	[TipoCambio] [money] NULL,
	[Observaciones] [varchar](250) NULL,
	[IdTipoComprobante] [int] NULL,
	[IdCuentaAtencion] [int] NULL,
	[IdEstadoComprobante] [int] NULL,
	[IdGestionCaja] [int] NULL,
	[IdTipoPago] [int] NULL,
	[IdTipoOrden] [int] NULL,
	[Dctos] [money] NULL,
	[IdPaciente] [int] NULL,
	[IdCajero] [int] NULL,
	[idTurno] [int] NULL,
	[idCaja] [int] NULL,
	[idFormaPago] [int] NULL,
	[idFarmacia] [int] NULL,
	[Exoneraciones] [money] NULL,
	[Adelantos] [money] NULL,
	[idTipoFinanciamiento] [int] NULL,
	[DNI] [varchar](11) NULL,
	[fechaEmision] [datetime] NULL,
	[TieneCredito] [varchar](1) NULL,
	[SunatTotalIgv] [money] NULL,
	[SunatOpeInafectas] [money] NULL,
 CONSTRAINT [CajaDocumento_PK] PRIMARY KEY CLUSTERED
(
	[IdComprobantePago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPago] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaDevoluciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaDevoluciones](
	[idDevolucion] [int] IDENTITY(1,1) NOT NULL,
	[idComprobantePago] [int] NOT NULL,
	[montoDevuelto] [money] NOT NULL,
	[montoTotal] [money] NOT NULL,
	[fechaDevolucion] [datetime] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[motivo] [varchar](2000) NOT NULL,
PRIMARY KEY CLUSTERED
(
	[idDevolucion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevoluciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaEstadosComprobante]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaEstadosComprobante](
	[IdEstadoComprobante] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [CajaEstadosComprobante_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoComprobante] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaEstadosComprobante] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaGestion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaGestion](
	[IdGestionCaja] [int] IDENTITY(1,1) NOT NULL,
	[FechaApertura] [datetime] NULL,
	[EstadoLote] [char](1) NULL,
	[IdCaja] [int] NULL,
	[IdTurno] [int] NULL,
	[FechaCierre] [datetime] NULL,
	[TotalCobrado] [char](10) NULL,
	[IdCajero] [int] NULL,
 CONSTRAINT [CajaLote_PK] PRIMARY KEY CLUSTERED
(
	[IdGestionCaja] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaNroDocumento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaNroDocumento](
	[IdCaja] [int] NOT NULL,
	[IdTipoComprobante] [int] NOT NULL,
	[NroSerie] [nvarchar](4) NULL,
	[NroDocumento] [char](12) NOT NULL,
	[NroDocumentoInicial] [char](12) NULL,
	[NroDocumentoFinal] [char](12) NULL,
	[SeImprime] [bit] NULL,
	[FacturaSinIGV] [bit] NULL,
 CONSTRAINT [CajaNroDocumento_PK] PRIMARY KEY CLUSTERED
(
	[IdCaja] ASC,
	[IdTipoComprobante] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajasTiposOrden]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajasTiposOrden](
	[IdTipoOrden] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [CajasTiposOrden_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajasTiposOrden] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaTiposComprobante]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaTiposComprobante](
	[IdTipoComprobante] [int] NOT NULL,
	[Descripcion] [char](20) NULL,
 CONSTRAINT [CajaTiposDocumento_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoComprobante] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposComprobante] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaTiposMoneda]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaTiposMoneda](
	[IdTipoMoneda] [int] NOT NULL,
	[Descripcion] [varchar](100) NULL,
 CONSTRAINT [CajaTiposMoneda_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoMoneda] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposMoneda] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CajaTurno]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CajaTurno](
	[IdTurno] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [CajaTurno_PK] PRIMARY KEY CLUSTERED
(
	[IdTurno] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CajaTurno] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Camas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Camas](
	[IdCama] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [char](5) NOT NULL,
	[IdServicioPropietario] [int] NULL,
	[IdServicioUbicacionActual] [int] NULL,
	[IdTiposCama] [int] NULL,
	[IdCondicionOcupacion] [int] NULL,
	[IdEstadoCama] [int] NULL,
	[IdPaciente] [int] NULL,
	[X] [int] NULL,
	[Y] [int] NULL,
 CONSTRAINT [Camas_PK] PRIMARY KEY CLUSTERED
(
	[IdCama] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Camas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[camasMovimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[camasMovimientos](
	[idMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[idCama] [int] NULL,
	[idServicio] [int] NULL,
	[FechaIngreso] [datetime] NULL,
	[FechaSalida] [datetime] NULL,
 CONSTRAINT [PK_camasMovimientos] PRIMARY KEY CLUSTERED
(
	[idMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[camasMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CentrosCosto]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CentrosCosto](
	[IdCentroCosto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](20) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
 CONSTRAINT [CentrosCosto_PK] PRIMARY KEY CLUSTERED
(
	[IdCentroCosto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCosto] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CentrosPoblados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CentrosPoblados](
	[IdCentroPoblado] [int] NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[IdDistrito] [int] NOT NULL,
 CONSTRAINT [CentrosPoblados_PK] PRIMARY KEY CLUSTERED
(
	[IdCentroPoblado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPoblados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Citas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Citas](
	[IdCita] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[HoraInicio] [char](5) NOT NULL,
	[HoraFin] [char](5) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[IdEstadoCita] [int] NOT NULL,
	[IdAtencion] [int] NOT NULL,
	[IdMedico] [int] NOT NULL,
	[IdEspecialidad] [int] NOT NULL,
	[IdServicio] [int] NOT NULL,
	[IdProgramacion] [int] NOT NULL,
	[IdProducto] [int] NULL,
	[FechaSolicitud] [datetime] NOT NULL,
	[HoraSolicitud] [char](5) NOT NULL,
	[EsCitaAdicional] [bit] NULL,
	[formacita] [varchar](1) NULL,
 CONSTRAINT [Citas_PK] PRIMARY KEY CLUSTERED
(
	[IdCita] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Citas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CitasBloqueadas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CitasBloqueadas](
	[IdCitaBloqueada] [int] IDENTITY(1,1) NOT NULL,
	[IdUsuario] [int] NULL,
	[Fecha] [datetime] NULL,
	[HoraInicio] [char](5) NULL,
	[HoraFin] [char](5) NULL,
	[FechaBloqueo] [datetime] NULL,
	[HoraBloqueo] [char](5) NULL,
	[IdMedico] [int] NULL,
 CONSTRAINT [CitasBloqueadas_PK] PRIMARY KEY CLUSTERED
(
	[IdCitaBloqueada] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ClasificacionDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ClasificacionDiagnosticos](
	[IdClasificacionDx] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [ClasificacionDiagnosticos_PK] PRIMARY KEY CLUSTERED
(
	[IdClasificacionDx] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ClasificacionDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[constancias]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[constancias](
	[idConstancia] [int] IDENTITY(1,1) NOT NULL,
	[idAtencion] [int] NOT NULL,
	[idPaciente] [int] NOT NULL,
	[idResponsable] [int] NOT NULL,
	[idServicio] [int] NOT NULL,
	[idMedico] [int] NOT NULL,
	[idTipoConstancia] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[pc] [varchar](32) NOT NULL,
	[recibo] [varchar](20) NOT NULL,
	[observaciones] [text] NULL,
	[estadoConstancia] [varchar](1) NOT NULL,
 CONSTRAINT [PK_constancias] PRIMARY KEY CLUSTERED
(
	[idConstancia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[constancias] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ConstanciasEstado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ConstanciasEstado](
	[idConstanciaEstado] [int] IDENTITY(1,1) NOT NULL,
	[Estado] [char](20) NULL,
 CONSTRAINT [PK_ConstanciasEstado] PRIMARY KEY CLUSTERED
(
	[idConstanciaEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasEstado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ConstanciasTipo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ConstanciasTipo](
	[idTipoConstancia] [int] NOT NULL,
	[NombreConstancia] [char](15) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasTipo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[CptExcepcionesRecetasHIS]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CptExcepcionesRecetasHIS](
	[IdProducto] [int] NOT NULL,
 CONSTRAINT [PK_CptExcepcionesRecetasHIS] PRIMARY KEY CLUSTERED
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[CptExcepcionesRecetasHIS] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Departamentos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Departamentos](
	[IdDepartamento] [int] NOT NULL,
	[Nombre] [varchar](20) NOT NULL,
	[idReniec] [int] NULL,
 CONSTRAINT [Departamentos_PK] PRIMARY KEY CLUSTERED
(
	[IdDepartamento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Departamentos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DepartamentosHospital]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DepartamentosHospital](
	[IdDepartamento] [int] NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
 CONSTRAINT [DepartamentosHospital_PK] PRIMARY KEY CLUSTERED
(
	[IdDepartamento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospital] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Diagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Diagnosticos](
	[IdDiagnostico] [int] IDENTITY(1,1) NOT NULL,
	[CodigoCIE2004] [char](7) NOT NULL,
	[Descripcion] [varchar](250) NOT NULL,
	[IdCapitulo] [int] NULL,
	[IdGrupo] [int] NULL,
	[IdCategoria] [int] NULL,
	[CodigoExportacion] [char](5) NULL,
	[CodigoCIE9] [char](5) NULL,
	[CodigoCIE10] [char](7) NULL,
	[Gestacion] [bit] NULL,
	[Morbilidad] [bit] NULL,
	[Intrahospitalario] [bit] NULL,
	[Restriccion] [bit] NULL,
	[EdadMaxDias] [int] NULL,
	[EdadMinDias] [int] NULL,
	[IdTipoSexo] [int] NULL,
	[ClaseDxHIS] [varchar](1) NULL,
	[DescripcionMINSA] [varchar](250) NULL,
	[codigoCIEsinPto] [varchar](7) NULL,
	[FechaInicioVigencia] [datetime] NULL,
	[EsActivo] [bit] NOT NULL,
	[CIEHISWEB] [bit] NULL,
 CONSTRAINT [Diagnosticos_PK] PRIMARY KEY CLUSTERED
(
	[IdDiagnostico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Diagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DiagnosticosCapitulos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DiagnosticosCapitulos](
	[IdCapitulo] [int] NOT NULL,
	[Codigo] [varchar](20) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
 CONSTRAINT [DiagnosticosCapitulos_PK] PRIMARY KEY CLUSTERED
(
	[IdCapitulo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DiagnosticosCategorias]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DiagnosticosCategorias](
	[IdCategoria] [int] NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdGrupo] [int] NULL,
 CONSTRAINT [DiagnosticosCategorias_PK] PRIMARY KEY CLUSTERED
(
	[IdCategoria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategorias] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DiagnosticosGrupos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DiagnosticosGrupos](
	[IdGrupo] [int] NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdCapitulo] [int] NULL,
 CONSTRAINT [DiagnosticosGrupos_PK] PRIMARY KEY CLUSTERED
(
	[IdGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGrupos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DiagnosticosPrioridades]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DiagnosticosPrioridades](
	[Dx] [varchar](7) NOT NULL,
	[Prioridad] [varchar](1) NOT NULL,
 CONSTRAINT [PK_DiagnosticosPrioridades] PRIMARY KEY CLUSTERED
(
	[Dx] ASC,
	[Prioridad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosPrioridades] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[DiagnosticosSoloPartos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DiagnosticosSoloPartos](
	[codigoCie10] [varchar](7) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSoloPartos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Distritos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Distritos](
	[IdDistrito] [int] NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[IdProvincia] [int] NOT NULL,
	[IdReniec] [int] NULL,
	[nombreEncriptado] [varchar](200) NULL,
 CONSTRAINT [Distritos_PK] PRIMARY KEY CLUSTERED
(
	[IdDistrito] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Distritos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaCausaExternaMorbilidad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaCausaExternaMorbilidad](
	[IdCausaExternaMorbilidad] [int] NOT NULL,
	[Codigo] [varchar](4) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[MotivoSEM] [varchar](2) NULL,
 CONSTRAINT [EmergenciaCausaExternaMorbilidad_PK] PRIMARY KEY CLUSTERED
(
	[IdCausaExternaMorbilidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaCausaExternaMorbilidad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaClaseAccidente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaClaseAccidente](
	[IdClaseAccidente] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaClaseAccidente_PK] PRIMARY KEY CLUSTERED
(
	[IdClaseAccidente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaClaseAccidente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaGrupoOcupacionalALAB]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaGrupoOcupacionalALAB](
	[IdGrupoOcupacionalALAB] [int] NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [EmergenciaGrupoOcupacionalALAB_PK] PRIMARY KEY CLUSTERED
(
	[IdGrupoOcupacionalALAB] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaGrupoOcupacionalALAB] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaLugarEvento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaLugarEvento](
	[IdLugarEvento] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EmergenciaLugarEvento_PK] PRIMARY KEY CLUSTERED
(
	[IdLugarEvento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaLugarEvento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaPosicionLesionadoALAB]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaPosicionLesionadoALAB](
	[IdPosicionLesionadoALAB] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaPosicionLesionadoALAB_PK] PRIMARY KEY CLUSTERED
(
	[IdPosicionLesionadoALAB] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaPosicionLesionadoALAB] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaRelacionAgresorVictima]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaRelacionAgresorVictima](
	[IdRelacionAgresorVictima] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaRelacionAgresorVictima_PK] PRIMARY KEY CLUSTERED
(
	[IdRelacionAgresorVictima] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaRelacionAgresorVictima] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaSeguridad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaSeguridad](
	[IdSeguridad] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EmergenciaSeguridad_PK] PRIMARY KEY CLUSTERED
(
	[IdSeguridad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaSeguridad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaTipoAgenteAGAN]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaTipoAgenteAGAN](
	[IdTipoAgenteAGAN] [int] NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [EmergenciaTipoAgenteAGAN_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoAgenteAGAN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoAgenteAGAN] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaTipoEvento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaTipoEvento](
	[IdTipoEvento] [int] NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [EmergenciaTipoEvento_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoEvento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoEvento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaTipoTransporte]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaTipoTransporte](
	[IdTipoTransporte] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaTipoTransporte_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoTransporte] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoTransporte] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaTipoVehiculo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaTipoVehiculo](
	[IdTipoVehiculo] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaTipoVehiculo_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoVehiculo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoVehiculo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmergenciaUbicacionLesionado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EmergenciaUbicacionLesionado](
	[IdUbicacionLesionado] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EmergenciaUbicacionLesionado_PK] PRIMARY KEY CLUSTERED
(
	[IdUbicacionLesionado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaUbicacionLesionado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Empleados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Empleados](
	[IdEmpleado] [int] IDENTITY(1,1) NOT NULL,
	[ApellidoPaterno] [varchar](50) NOT NULL,
	[ApellidoMaterno] [varchar](50) NOT NULL,
	[Nombres] [varchar](50) NOT NULL,
	[IdCondicionTrabajo] [int] NOT NULL,
	[IdTipoEmpleado] [int] NOT NULL,
	[DNI] [char](20) NOT NULL,
	[CodigoPlanilla] [varchar](8) NOT NULL,
	[FechaIngreso] [datetime] NULL,
	[FechaAlta] [datetime] NULL,
	[Usuario] [varchar](20) NULL,
	[Clave] [varchar](200) NULL,
	[loginEstado] [int] NULL,
	[loginPC] [varchar](50) NULL,
	[FechaNacimiento] [datetime] NULL,
	[idTipoDestacado] [int] NULL,
	[IdEstablecimientoExterno] [int] NULL,
	[HisCodigoDigitador] [varchar](20) NULL,
	[ReniecAutorizado] [bit] NULL,
	[idTipoDocumento] [int] NULL,
	[idSupervisor] [int] NULL,
	[esActivo] [bit] NULL,
	[idTipoSexo] [int] NULL,
	[IdPais] [int] NULL,
	[UltimoLogin] [datetime] NULL,
 CONSTRAINT [Empleados_PK] PRIMARY KEY CLUSTERED
(
	[IdEmpleado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Empleados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmpleadosCargos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EmpleadosCargos](
	[idEmpleado] [int] NULL,
	[idCargo] [int] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosCargos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EmpleadosLugarDeTrabajo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EmpleadosLugarDeTrabajo](
	[idEmpleado] [int] NOT NULL,
	[idLaboraArea] [int] NOT NULL,
	[idLaboraSubArea] [int] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosLugarDeTrabajo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_CatalogoDominios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Enfermeria_CatalogoDominios](
	[IdDominio] [int] NOT NULL,
	[CodDominio] [varchar](50) NULL,
	[DominioTexto] [varchar](200) NULL,
 CONSTRAINT [PK_Enfermeria_CatalogoDominios] PRIMARY KEY CLUSTERED
(
	[IdDominio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoDominios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_CatalogoValoresCombo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Enfermeria_CatalogoValoresCombo](
	[IdVariable] [int] NOT NULL,
	[IdValorCombo] [int] NOT NULL,
	[ComboTexto] [varchar](50) NOT NULL,
 CONSTRAINT [PK_Enfermeria_VariablesValoresCombo] PRIMARY KEY CLUSTERED
(
	[IdVariable] ASC,
	[IdValorCombo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoValoresCombo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_CatalogoVariables]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Enfermeria_CatalogoVariables](
	[IdVariable] [int] NOT NULL,
	[IdDominio] [int] NOT NULL,
	[OrdernDominio] [int] NOT NULL,
	[Texto] [varchar](200) NOT NULL,
	[Tipo] [varchar](20) NOT NULL,
	[Ancho] [int] NOT NULL,
	[EsDatoObligatorio] [bit] NOT NULL,
	[TextoTooltip] [varchar](200) NULL,
	[EsDatoGrafico] [bit] NOT NULL,
	[TieneFormatoMask] [bit] NOT NULL,
	[FormatoMask] [varchar](50) NULL,
	[TieneRango] [bit] NOT NULL,
	[RangoInicial] [int] NULL,
	[RangoFinal] [int] NULL,
	[PosicionFila] [int] NULL,
	[PosicionColumna] [int] NULL,
 CONSTRAINT [PK_Enfermeria_CatalogoVariables] PRIMARY KEY CLUSTERED
(
	[IdVariable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoVariables] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_TratamientoDosis]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Enfermeria_TratamientoDosis](
	[IdCuentaAtencion] [int] NOT NULL,
	[IdVisita] [int] NOT NULL,
	[IdDiaVisita] [int] NOT NULL,
	[IdReceta] [int] NOT NULL,
	[IdItem] [int] NOT NULL,
	[Dosis] [int] NULL,
	[DatoProrenata] [int] NULL,
 CONSTRAINT [PK_Enfermeria_TratamientoDosis] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC,
	[IdVisita] ASC,
	[IdDiaVisita] ASC,
	[IdReceta] ASC,
	[IdItem] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TratamientoDosis] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_ValoresCombo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Enfermeria_ValoresCombo](
	[IdCuentaAtencion] [int] NOT NULL,
	[IdVisita] [int] NOT NULL,
	[IdVariable] [int] NOT NULL,
	[IdValorCombo] [int] NOT NULL,
 CONSTRAINT [PK_Enfermeria_ValoresCombo] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC,
	[IdVisita] ASC,
	[IdVariable] ASC,
	[IdValorCombo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ValoresCombo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_Variables]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Enfermeria_Variables](
	[IdCuentaAtencion] [int] NOT NULL,
	[IdVisita] [int] NOT NULL,
	[IdVariable] [int] NOT NULL,
	[VariableDato] [varchar](200) NULL,
 CONSTRAINT [PK_Enfermeria_Variables] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC,
	[IdVisita] ASC,
	[IdVariable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_Variables] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Enfermeria_Visitas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Enfermeria_Visitas](
	[IdCuentaAtencion] [int] NOT NULL,
	[IdVisita] [int] NOT NULL,
	[FechaHoraVisita] [datetime] NOT NULL,
	[IdServicio] [int] NOT NULL,
	[Observaciones] [varchar](1000) NULL,
	[IdCama] [int] NOT NULL,
	[IdEmpleadoEnfermera] [int] NOT NULL,
	[IngresoValorizacion] [bit] NULL,
 CONSTRAINT [PK_Enfermeria_Visitas] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC,
	[IdVisita] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_Visitas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EPS_CPTfijos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EPS_CPTfijos](
	[idProducto] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NOT NULL,
	[Porcentaje] [money] NOT NULL,
 CONSTRAINT [PK_EPS_CPTfijos] PRIMARY KEY CLUSTERED
(
	[idProducto] ASC,
	[idFuenteFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[EPS_CPTfijos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EPS_CPTfijosSoles]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EPS_CPTfijosSoles](
	[idProducto] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NOT NULL,
	[importe] [money] NOT NULL,
 CONSTRAINT [PK_EPS_CPTfijosSoles] PRIMARY KEY CLUSTERED
(
	[idProducto] ASC,
	[idFuenteFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[EPS_CPTfijosSoles] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EquivalenciaCPT_SMI]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EquivalenciaCPT_SMI](
	[codigoCPT] [varchar](20) NOT NULL,
	[codigoSMI] [varchar](3) NOT NULL,
 CONSTRAINT [PK_EquivalenciaCPT_SMI] PRIMARY KEY CLUSTERED
(
	[codigoCPT] ASC,
	[codigoSMI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EquivalenciaCPT_SMI] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EspecialidadCE]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EspecialidadCE](
	[IdEspecialidadCE] [int] IDENTITY(1,1) NOT NULL,
	[IdEspecialidad] [int] NOT NULL,
	[TiempoPromedioAtencion] [int] NULL,
	[IdProductoConsulta] [int] NULL,
	[IdProductoInterconsulta] [int] NULL,
 CONSTRAINT [EspecialidadCE_PK] PRIMARY KEY CLUSTERED
(
	[IdEspecialidadCE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCE] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Especialidades]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Especialidades](
	[IdEspecialidad] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[IdDepartamento] [int] NOT NULL,
	[TiempoPromedioAtencion] [int] NULL,
 CONSTRAINT [Especialidades_PK] PRIMARY KEY CLUSTERED
(
	[IdEspecialidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Especialidades] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Establecimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Establecimientos](
	[IdEstablecimiento] [int] NOT NULL,
	[Codigo] [varchar](6) NOT NULL,
	[Nombre] [varchar](150) NOT NULL,
	[IdDistrito] [int] NULL,
	[IdTipo] [int] NULL,
 CONSTRAINT [Establecimientos_PK] PRIMARY KEY CLUSTERED
(
	[IdEstablecimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Establecimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstablecimientosNoMinsa]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstablecimientosNoMinsa](
	[IdEstablecimientoNoMinsa] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](150) NULL,
	[IdTipoSubsector] [int] NULL,
	[IdDistrito] [int] NULL,
	[codigo] [varchar](10) NULL,
 CONSTRAINT [EstablecimientosNoMinsa_PK] PRIMARY KEY CLUSTERED
(
	[IdEstablecimientoNoMinsa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsa] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosAtencion](
	[IdEstadoAtencion] [int] NOT NULL,
	[Descripcion] [varchar](20) NULL,
 CONSTRAINT [EstadoAtencion_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosCama]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosCama](
	[IdEstadoCama] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EstadosCama_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoCama] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCama] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosCuenta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosCuenta](
	[IdEstado] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EstadosCuenta_PK] PRIMARY KEY CLUSTERED
(
	[IdEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuenta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosDevoluciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosDevoluciones](
	[idEstadoDevolucion] [int] NOT NULL,
	[Estado] [varchar](30) NULL,
 CONSTRAINT [PK_EstadoDevoluciones] PRIMARY KEY CLUSTERED
(
	[idEstadoDevolucion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosDevoluciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosFacturacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosFacturacion](
	[IdEstadoFacturacion] [int] NOT NULL,
	[Descripcion] [varchar](20) NULL,
 CONSTRAINT [EstadoProducto_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoFacturacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosFacturacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosHistoriaClinica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosHistoriaClinica](
	[IdEstadoHistoria] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EstadosHistoriaClinica_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoHistoria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosMovimientoHistoria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosMovimientoHistoria](
	[IdEstadoMovimiento] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [EstadosPrestamoHistoria_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosMovimientoHistoria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosOrden]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosOrden](
	[IdEstadoOrden] [int] NOT NULL,
	[descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [EstadosOrden_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosOrden] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[EstadosReembolso]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[EstadosReembolso](
	[idEstadoReembolso] [int] NOT NULL,
	[Estado] [varchar](10) NOT NULL,
 CONSTRAINT [PK_EstadosReembolso] PRIMARY KEY CLUSTERED
(
	[idEstadoReembolso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[EstadosReembolso] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoBienesInsumos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoBienesInsumos](
	[IdProducto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](7) NOT NULL,
	[Nombre] [varchar](300) NOT NULL,
	[NombreComercial] [varchar](100) NULL,
	[IdGrupoFarmacologico] [int] NULL,
	[IdSubGrupoFarmacologico] [int] NULL,
	[IdPartida] [int] NULL,
	[IdCentroCosto] [int] NULL,
	[PrecioCompra] [money] NULL,
	[PrecioDistribucion] [money] NULL,
	[PrecioDonacion] [money] NULL,
	[PrecioUltCompra] [money] NULL,
	[idTipoSalidaBienInsumo] [int] NOT NULL,
	[StockMinimo] [int] NULL,
	[TipoProducto] [int] NULL,
	[Denominacion] [varchar](100) NULL,
	[Concentracion] [varchar](100) NULL,
	[Presentacion] [varchar](100) NULL,
	[FormaFarmaceutica] [varchar](10) NULL,
	[MaterialEnvase] [varchar](100) NULL,
	[PresentacionEnvase] [varchar](100) NULL,
	[Fabricante] [varchar](100) NULL,
	[IdPaisOrigen] [int] NULL,
	[Petitorio] [bit] NULL,
	[TipoProductoSismed] [varchar](1) NULL,
	[esPaquete] [bit] NULL,
	[codigoSUNAT] [varchar](20) NULL,
 CONSTRAINT [CatalogoBienesInsumos_PK] PRIMARY KEY CLUSTERED
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoBienesInsumosHosp]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactCatalogoBienesInsumosHosp](
	[IdPlanCatalogo] [int] IDENTITY(1,1) NOT NULL,
	[PrecioUnitario] [money] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdTipoFinanciamiento] [int] NOT NULL,
	[Activo] [bit] NOT NULL,
 CONSTRAINT [PlanesCatalogoBienesInsumos_PK] PRIMARY KEY CLUSTERED
(
	[IdPlanCatalogo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHosp] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoPaquete]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoPaquete](
	[idFactPaquete] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [nvarchar](10) NOT NULL,
	[Descripcion] [nvarchar](100) NOT NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
	[FechaCreacion] [smalldatetime] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[idEstado] [int] NOT NULL,
	[TipoPaquete] [int] NULL,
	[esItemFarmacia] [int] NULL,
	[CPT] [varchar](20) NULL,
 CONSTRAINT [PK_FactCatalogoPaquete] PRIMARY KEY CLUSTERED
(
	[idFactPaquete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaquete] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServicios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServicios](
	[IdProducto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](20) NOT NULL,
	[Nombre] [varchar](255) NOT NULL,
	[IdServicioGrupo] [int] NULL,
	[IdServicioSubGrupo] [int] NULL,
	[IdServicioSeccion] [int] NULL,
	[IdServicioSubSeccion] [int] NULL,
	[IdPartida] [int] NULL,
	[IdCentroCosto] [int] NULL,
	[CodMINSA] [varchar](20) NULL,
	[CodMINSAnoActualiza] [bit] NULL,
	[EsCPT] [int] NULL,
	[idOpcs] [int] NULL,
	[NombreMINSA] [varchar](255) NULL,
	[idEstado] [int] NULL,
	[codigoSIS] [varchar](20) NULL,
	[LabResultadoAutomatico] [int] NULL,
	[idProveedor] [int] NULL,
	[equipoCodigo] [varchar](2) NULL,
	[codigoSUNAT] [varchar](20) NULL,
 CONSTRAINT [Productos_PK] PRIMARY KEY CLUSTERED
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServicios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosGrupo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosGrupo](
	[IdServicioGrupo] [int] NOT NULL,
	[Codigo] [char](10) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
 CONSTRAINT [CatalogoServiciosGrupo_PK] PRIMARY KEY CLUSTERED
(
	[IdServicioGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosHosp]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosHosp](
	[IdFinanciamientoCatalogo] [int] IDENTITY(1,1) NOT NULL,
	[PrecioUnitario] [money] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdTipoFinanciamiento] [int] NOT NULL,
	[Activo] [bit] NOT NULL,
	[SeUsaSinPrecio] [bit] NULL,
 CONSTRAINT [PlanesProductos_PK] PRIMARY KEY NONCLUSTERED
(
	[IdFinanciamientoCatalogo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHosp] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosN]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosN](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdAtencion] [varchar](20) NULL,
	[Descripcion_Tipo_Item] [varchar](100) NULL,
	[Fg_Tipo] [varchar](2) NULL,
	[IdProducto] [varchar](10) NULL,
	[NombreMINSA] [varchar](300) NULL,
	[IdSubclasificacionDx] [varchar](20) NULL,
	[valores] [varchar](10) NULL,
 CONSTRAINT [PK_FactCatalogoServiciosN] PRIMARY KEY CLUSTERED
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosN] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosPtos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosPtos](
	[idPuntoCarga] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[EsPreVenta] [bit] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosSeccion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosSeccion](
	[IdServicioSeccion] [int] NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdServicioSubGrupo] [int] NULL,
 CONSTRAINT [CatalogoServiciosSeccion_PK] PRIMARY KEY CLUSTERED
(
	[IdServicioSeccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeccion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosSubGrupo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosSubGrupo](
	[IdServicioSubGrupo] [int] NOT NULL,
	[Descripcion] [varchar](255) NULL,
	[IdServicioGrupo] [int] NULL,
	[Codigo] [char](10) NULL,
 CONSTRAINT [FactCatalogoServiciosSubGrupo_PK] PRIMARY KEY CLUSTERED
(
	[IdServicioSubGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactCatalogoServiciosSubSeccion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactCatalogoServiciosSubSeccion](
	[IdServicioSubSeccion] [int] NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdServicioSeccion] [int] NOT NULL,
 CONSTRAINT [CatalogoServiciosSubSeccion_PK] PRIMARY KEY CLUSTERED
(
	[IdServicioSubSeccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactInsumosGrupoFarmacologico]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactInsumosGrupoFarmacologico](
	[IdGrupoFarmacologico] [int] NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
 CONSTRAINT [InsumosGrupoFarmacologico_PK] PRIMARY KEY CLUSTERED
(
	[IdGrupoFarmacologico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologico] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactInsumosSubGrupoFarmacologico]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactInsumosSubGrupoFarmacologico](
	[IdSubGrupoFarmacologico] [int] NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdGrupoFarmacologico] [int] NULL,
 CONSTRAINT [InsumosSubGrupoFarmacologico_PK] PRIMARY KEY CLUSTERED
(
	[IdSubGrupoFarmacologico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologico] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactOrdenesBienes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactOrdenesBienes](
	[idOrden] [int] IDENTITY(1,1) NOT NULL,
	[idPuntoCarga] [int] NOT NULL,
	[IdPaciente] [int] NULL,
	[idCuentaAtencion] [int] NULL,
	[idComprobantePago] [int] NULL,
	[MovNumero] [varchar](9) NULL,
	[MovTipo] [varchar](1) NULL,
	[idPreventa] [int] NULL,
	[ImporteExonerado] [money] NOT NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[idEstadoFacturacion] [int] NOT NULL,
	[idUsuarioExonera] [int] NULL,
	[Descripcion] [varchar](200) NULL,
	[Paquete] [varchar](100) NULL,
	[DNI] [varchar](12) NULL,
	[NombPaciente] [varchar](100) NULL,
 CONSTRAINT [PK_FactOrdenesBienes] PRIMARY KEY CLUSTERED
(
	[idOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactOrdenServicio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactOrdenServicio](
	[IdOrden] [int] IDENTITY(1,1) NOT NULL,
	[IdPuntoCarga] [int] NOT NULL,
	[IdPaciente] [int] NULL,
	[IdCuentaAtencion] [int] NULL,
	[IdServicioPaciente] [int] NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[IdUsuario] [int] NOT NULL,
	[FechaDespacho] [datetime] NULL,
	[IdUsuarioDespacho] [int] NULL,
	[IdEstadoFacturacion] [int] NOT NULL,
	[FechaHoraRealizaCpt] [datetime] NULL,
 CONSTRAINT [PK_FactOrdenServicio] PRIMARY KEY CLUSTERED
(
	[IdOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactOrdenServicioPagos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactOrdenServicioPagos](
	[idOrdenPago] [int] IDENTITY(1,1) NOT NULL,
	[idComprobantePago] [int] NULL,
	[idOrden] [int] NOT NULL,
	[ImporteExonerado] [money] NOT NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[IdUsuario] [int] NOT NULL,
	[IdEstadoFacturacion] [int] NOT NULL,
	[idUsuarioExonera] [int] NULL,
 CONSTRAINT [PK_FactOrdenServicioPagos] PRIMARY KEY CLUSTERED
(
	[idOrdenPago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPartidasPresupuestales]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactPartidasPresupuestales](
	[IdPartidaPresupuestal] [int] NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
	[IdPartidaSeccion] [int] NULL,
 CONSTRAINT [PartidasPresupuestales_PK] PRIMARY KEY CLUSTERED
(
	[IdPartidaPresupuestal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestales] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPartidasPresupuestalesXMes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactPartidasPresupuestalesXMes](
	[Fecha] [datetime] NOT NULL,
	[idPartida] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[ImpAnulado] [money] NOT NULL,
	[impExonerado] [money] NOT NULL,
	[ImpNormal] [money] NOT NULL,
	[ImpCancelado] [money] NOT NULL,
 CONSTRAINT [PK_FactPartidasPresupuestalesXMes] PRIMARY KEY CLUSTERED
(
	[Fecha] ASC,
	[idPartida] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXMes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPartidasSeccion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactPartidasSeccion](
	[IdPartidaSeccion] [int] NOT NULL,
	[Codigo] [char](5) NOT NULL,
	[Descripcion] [varchar](250) NULL,
 CONSTRAINT [FactPartidasSeccion_PK] PRIMARY KEY CLUSTERED
(
	[IdPartidaSeccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasSeccion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPreventa]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactPreventa](
	[idFactPreventa] [int] IDENTITY(1,1) NOT NULL,
	[idServicio] [int] NOT NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
	[Total] [money] NOT NULL,
	[fechaCreacion] [smalldatetime] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[idEstadoPreventa] [int] NOT NULL,
	[idAtencion] [int] NULL,
	[idOrden] [int] NULL,
 CONSTRAINT [PK_FactPreventa] PRIMARY KEY CLUSTERED
(
	[idFactPreventa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactPreventa] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPuntosCarga]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactPuntosCarga](
	[IdPuntoCarga] [int] NOT NULL,
	[Descripcion] [char](50) NULL,
	[TipoPunto] [char](1) NULL,
	[IdUPS] [int] NULL,
	[idServicio] [int] NULL,
	[NroCupos] [int] NULL,
	[NroCuposMinutos] [int] NULL,
	[HoraInicioDiaCita] [varchar](5) NULL,
 CONSTRAINT [FactPuntosCarga_PK] PRIMARY KEY CLUSTERED
(
	[IdPuntoCarga] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCarga] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPuntosCargaBienesInsumos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactPuntosCargaBienesInsumos](
	[IdPuntoCargaBienInsumo] [int] NOT NULL,
	[IdPuntoCarga] [int] NULL,
	[IdSubGrupoFarmacologico] [int] NULL,
 CONSTRAINT [TiposDeBienesEInsumos_PK] PRIMARY KEY CLUSTERED
(
	[IdPuntoCargaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaBienesInsumos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactPuntosCargaServicio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FactPuntosCargaServicio](
	[IdPuntoCargaServicio] [int] NOT NULL,
	[IdPuntoCarga] [int] NULL,
	[IdServicioSubGrupo] [int] NULL,
 CONSTRAINT [FactPuntosCargaServicio_PK] PRIMARY KEY CLUSTERED
(
	[IdPuntoCargaServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaServicio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactReembolsos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactReembolsos](
	[idFactReembolso] [int] IDENTITY(1,1) NOT NULL,
	[Anio] [int] NOT NULL,
	[Mes] [int] NOT NULL,
	[idAreaTramitaSeguro] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NOT NULL,
	[Descripcion] [varchar](300) NULL,
	[SaldoInicial] [money] NOT NULL,
	[ConsumoPorReembolsar] [money] NOT NULL,
	[ReembolsoPagado] [money] NULL,
	[ReembolsoPorPagar] [money] NOT NULL,
	[SaldoFinal] [money] NOT NULL,
	[Documentos] [varchar](100) NULL,
	[idEstadoReembolso] [int] NOT NULL,
	[idTipoConsumo] [int] NOT NULL,
	[idTipoComprobante] [int] NULL,
	[idComprobantePago] [int] NULL,
	[GrabaDefinitivamente] [bit] NULL,
 CONSTRAINT [PK_FactReembolsos] PRIMARY KEY CLUSTERED
(
	[idFactReembolso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactReembolsosDocumentos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactReembolsosDocumentos](
	[idFactReembolso] [int] NOT NULL,
	[idComprobantePago] [int] NULL,
	[NroSerie] [varchar](4) NULL,
	[NroDocumento] [varchar](8) NULL,
	[MotivoAnulacion] [varchar](150) NULL,
 CONSTRAINT [PK_FactReembolsosDocumentos] PRIMARY KEY CLUSTERED
(
	[idFactReembolso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FactTrasladoReferidos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FactTrasladoReferidos](
	[idFactTrasladoReferidos] [int] NOT NULL,
	[Fecha] [char](10) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FactTrasladoReferidos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionBienesDevoluciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionBienesDevoluciones](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[idProducto] [int] NOT NULL,
	[MovNumeroE] [varchar](9) NOT NULL,
	[CantidadAdevolver] [int] NOT NULL,
	[IdComprobantePago] [int] NULL,
	[IdEstadoDevolucion] [int] NOT NULL,
	[FechaAutoriza] [datetime] NOT NULL,
	[IdUsuarioAutoriza] [int] NOT NULL,
	[MovTipoE] [varchar](1) NULL,
 CONSTRAINT [PK_FacturacionBienesDevoluciones] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC,
	[idProducto] ASC,
	[MovNumeroE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevoluciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionBienesFinanciamientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionBienesFinanciamientos](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdTipoFinanciamiento] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[CantidadFinanciada] [int] NOT NULL,
	[PrecioFinanciado] [money] NOT NULL,
	[TotalFinanciado] [money] NOT NULL,
	[FechaAutoriza] [datetime] NOT NULL,
	[IdUsuarioAutoriza] [int] NOT NULL,
	[idEstadoFacturacion] [int] NULL,
 CONSTRAINT [PK_FacturacionBienesFinanciamientos] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC,
	[IdProducto] ASC,
	[IdTipoFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionBienesPagos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionBienesPagos](
	[IdOrden] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[CantidadPagar] [int] NOT NULL,
	[PrecioVenta] [money] NOT NULL,
	[TotalPagar] [money] NOT NULL,
 CONSTRAINT [PK_FacturacionBienesPagos] PRIMARY KEY CLUSTERED
(
	[IdOrden] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionCatalogoPaquetes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionCatalogoPaquetes](
	[idFactPaquete] [int] NOT NULL,
	[idPuntoCarga] [int] NULL,
	[idEspecialidadServicio] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Importe] [money] NOT NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionCuentasAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionCuentasAtencion](
	[IdCuentaAtencion] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[FechaApertura] [datetime] NOT NULL,
	[HoraApertura] [char](5) NOT NULL,
	[FechaCierre] [datetime] NULL,
	[HoraCierre] [char](5) NULL,
	[TotalExonerado] [money] NULL,
	[TotalAsegurado] [money] NULL,
	[TotalPagado] [money] NULL,
	[IdEstado] [int] NULL,
	[TotalPorPagar] [money] NULL,
	[IdUsuarioCrea] [int] NULL,
	[IdUsuarioModifica] [int] NULL,
	[FechaCreacion] [datetime] NULL,
	[FechaModificacion] [datetime] NULL,
 CONSTRAINT [CuentasAtencion_PK] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionCuentasAtencionExon]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionCuentasAtencionExon](
	[idCuentaAtencion] [int] NOT NULL,
	[NumeroExoneracion] [int] NOT NULL,
	[motivo] [varchar](500) NULL,
 CONSTRAINT [PK_FacturacionCuentasAtencionExon] PRIMARY KEY CLUSTERED
(
	[idCuentaAtencion] ASC,
	[NumeroExoneracion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionExon] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionCuentasAtencionPtos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionCuentasAtencionPtos](
	[idCuentaAtencion] [int] NOT NULL,
	[idPuntoCarga] [int] NOT NULL,
	[TotalConsumos] [money] NULL,
	[TotalPagos] [money] NULL,
	[TotalPagosReembolso] [money] NULL,
 CONSTRAINT [PK_FacturacionCuentasAtencionPtos] PRIMARY KEY CLUSTERED
(
	[idCuentaAtencion] ASC,
	[idPuntoCarga] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionPaquetes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionPaquetes](
	[idComprobantePago] [int] NOT NULL,
	[idOrdenPago] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[idFactPaquete] [int] NOT NULL,
	[IdPuntoCarga] [int] NOT NULL,
	[idEspecialidadServicio] [int] NOT NULL,
	[AtencionId] [int] NULL,
 CONSTRAINT [PK_FacturacionPaquetes] PRIMARY KEY CLUSTERED
(
	[idComprobantePago] ASC,
	[idOrdenPago] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionPreventa]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionPreventa](
	[idFactPreventa] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Importe] [money] NOT NULL,
 CONSTRAINT [PK_FacturacionPreventa] PRIMARY KEY CLUSTERED
(
	[idFactPreventa] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPreventa] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionReembolsos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionReembolsos](
	[idFactReembolso] [int] NOT NULL,
	[idCuentaAtencion] [int] NOT NULL,
	[ConsumoPorReembolsar] [money] NOT NULL,
	[ReembolsoPagado] [money] NULL,
	[ReembolsoPorPagar] [money] NOT NULL,
	[ReembolsoPagadoFarmacia] [money] NULL,
	[ReembolsoPagadoServicio] [money] NULL,
	[IdReembolsosAnteriores] [varchar](100) NULL,
	[idDiagnostico] [int] NULL,
	[NroReferenciaDestino] [varchar](20) NULL,
 CONSTRAINT [PK_FacturacionReembolsos] PRIMARY KEY CLUSTERED
(
	[idFactReembolso] ASC,
	[idCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionServicioDespacho]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionServicioDespacho](
	[idOrden] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Total] [money] NOT NULL,
	[labConfHIS] [varchar](3) NULL,
	[GrupoHIS] [int] NULL,
	[SubGrupoHIS] [int] NULL,
 CONSTRAINT [PK_FacturacionServicioDespacho] PRIMARY KEY CLUSTERED
(
	[idOrden] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespacho] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionServicioDevoluciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionServicioDevoluciones](
	[idOrden] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[CantidadAdevolver] [int] NOT NULL,
	[IdComprobantePago] [int] NOT NULL,
	[idEstadoDevolucion] [int] NOT NULL,
	[FechaAutoriza] [datetime] NOT NULL,
	[IdUsuarioAutoriza] [int] NOT NULL,
 CONSTRAINT [PK_FacturacionServicioDevoluciones] PRIMARY KEY CLUSTERED
(
	[idOrden] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevoluciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionServicioFinanciamientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionServicioFinanciamientos](
	[idOrden] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[IdTipoFinanciamiento] [int] NOT NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[CantidadFinanciada] [int] NOT NULL,
	[PrecioFinanciado] [money] NOT NULL,
	[TotalFinanciado] [money] NOT NULL,
	[FechaAutoriza] [datetime] NOT NULL,
	[IdUsuarioAutoriza] [int] NOT NULL,
	[idEstadoFacturacion] [int] NULL,
 CONSTRAINT [PK_FacturacionServicioFinanciamientos] PRIMARY KEY CLUSTERED
(
	[idOrden] ASC,
	[idProducto] ASC,
	[IdTipoFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionServicioPagos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionServicioPagos](
	[idOrdenPago] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Total] [money] NOT NULL,
 CONSTRAINT [PK_FacturacionPagos] PRIMARY KEY CLUSTERED
(
	[idOrdenPago] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionTrasladoReferidos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FacturacionTrasladoReferidos](
	[idFactTrasladoReferidos] [int] NOT NULL,
	[idCuenta] [int] NOT NULL,
	[codigoSeguro] [varchar](20) NULL,
	[Beneficio] [varchar](1) NULL,
	[idTipoTransporte] [int] NULL,
	[idTipoViaje] [int] NULL,
	[FechaSalida] [datetime] NULL,
	[NroFamiliarAcompania] [int] NULL,
	[NroPersonalAcompania] [int] NULL,
	[KmDistancia] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionTrasladoReferidos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FacturacionTrasladoReferidosServicios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FacturacionTrasladoReferidosServicios](
	[idFactTrasladoReferidos] [int] NOT NULL,
	[idCuenta] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[cantidad] [int] NULL,
	[precio] [money] NULL,
	[Total] [money] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionTrasladoReferidosServicios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farm_formdet]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farm_formdet](
	[CODIGO_EJE] [varchar](3) NULL,
	[CODIGO_PRE] [varchar](11) NULL,
	[TIPSUM] [varchar](1) NULL,
	[ANNOMES] [varchar](6) NULL,
	[CODIGO_MED] [varchar](7) NULL,
	[SALDO] [int] NULL,
	[PRECIO] [money] NULL,
	[INGRE] [int] NULL,
	[REINGRE] [int] NULL,
	[VENTA] [int] NULL,
	[SIS] [int] NULL,
	[INTERSAN] [int] NULL,
	[FAC_PERD] [int] NULL,
	[DEFNAC] [int] NULL,
	[EXO] [int] NULL,
	[SOAT] [int] NULL,
	[CREDHOSP] [int] NULL,
	[OTR_CONV] [int] NULL,
	[DEVOL] [int] NULL,
	[VENCIDO] [int] NULL,
	[MERMA] [int] NULL,
	[DISTRI] [int] NULL,
	[TRANSF] [int] NULL,
	[VENTAINST] [int] NULL,
	[DEV_VEN] [int] NULL,
	[DEV_MERMA] [int] NULL,
	[OTRAS_SAL] [int] NULL,
	[STOCK_FIN] [int] NULL,
	[STOCK_FIN1] [int] NULL,
	[REQ] [int] NULL,
	[TOTAL] [int] NULL,
	[FEC_EXP] [datetime] NULL,
	[DO_SALDO] [int] NULL,
	[DO_INGRE] [int] NULL,
	[DO_CON] [int] NULL,
	[DO_OTR] [int] NULL,
	[DO_TOT] [int] NULL,
	[DO_STK] [int] NULL,
	[DO_FECEXP] [datetime] NULL,
	[FECHA] [datetime] NULL,
	[USUARIO] [varchar](15) NULL,
	[INDIPROC] [varchar](1) NULL,
	[SIT] [varchar](1) NULL,
	[INDISIGA] [varchar](1) NULL,
	[DSTKCERO] [int] NULL,
	[MPTOREPO] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdet] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farm_formdetl]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farm_formdetl](
	[CODIGO_EJE] [nvarchar](3) NULL,
	[CODIGO_PRE] [nvarchar](11) NULL,
	[TIPSUM] [nvarchar](1) NULL,
	[ANNOMES] [nvarchar](6) NULL,
	[CODIGO_MED] [nvarchar](7) NULL,
	[LOTE] [nvarchar](15) NULL,
	[FECHVTO] [datetime] NULL,
	[SALDO] [float] NULL,
	[SIT] [nvarchar](1) NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetl] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farm_psicotropicos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farm_psicotropicos](
	[codigo] [varchar](7) NOT NULL,
	[posicion] [int] NOT NULL,
	[tipo] [varchar](1) NULL,
 CONSTRAINT [PK_farm_psicotropicos] PRIMARY KEY CLUSTERED
(
	[codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farm_psicotropicos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farm_psicotropTipo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farm_psicotropTipo](
	[tipo] [varchar](1) NOT NULL,
	[descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [PK_farm_psicotropTipo] PRIMARY KEY CLUSTERED
(
	[tipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farm_psicotropTipo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmAlmacen]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmAlmacen](
	[idAlmacen] [int] NOT NULL,
	[descripcion] [varchar](50) NOT NULL,
	[idTipoLocales] [varchar](1) NOT NULL,
	[idTipoSuministro] [varchar](2) NULL,
	[idEstado] [int] NOT NULL,
	[codigoSISMED] [varchar](11) NULL,
	[regenerarDias] [varchar](7) NULL,
	[regenerarHora] [varchar](5) NULL,
	[regenerarEstado] [varchar](7) NULL,
	[ArmaPaquetes] [int] NULL,
	[esUnidosis] [int] NULL,
 CONSTRAINT [PK_farmMalmacen] PRIMARY KEY CLUSTERED
(
	[idAlmacen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmComponente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmComponente](
	[idComponente] [int] IDENTITY(1,1) NOT NULL,
	[Componente] [varchar](2) NOT NULL,
	[Descripcion] [varchar](150) NOT NULL,
 CONSTRAINT [PK_farmComponente] PRIMARY KEY CLUSTERED
(
	[idComponente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmComponente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmComponenteSub]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmComponenteSub](
	[idSubComponente] [int] NOT NULL,
	[idComponente] [int] NOT NULL,
	[componente] [varchar](2) NULL,
	[subComponente] [varchar](2) NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[Diagnostico] [varchar](20) NULL,
	[TipoProductoSismed] [varchar](1) NULL,
 CONSTRAINT [PK_farmComponenteSub] PRIMARY KEY CLUSTERED
(
	[idSubComponente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmComponenteSub] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmEstadosInventario]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmEstadosInventario](
	[idEstadoInventario] [int] NOT NULL,
	[Estado] [varchar](30) NOT NULL,
 CONSTRAINT [PK_farmEstadosInventario] PRIMARY KEY CLUSTERED
(
	[idEstadoInventario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmEstadosInventario] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmEstadosMovimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmEstadosMovimientos](
	[idEstadoMovimiento] [int] NOT NULL,
	[Estado] [varchar](30) NOT NULL,
 CONSTRAINT [PK_farmEstadosMovimientos] PRIMARY KEY CLUSTERED
(
	[idEstadoMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmEstadosMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmEstadosPreventa]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmEstadosPreventa](
	[idEstadoPreventa] [int] NOT NULL,
	[Estado] [varchar](30) NOT NULL,
 CONSTRAINT [PK_farmEstadosPreventa] PRIMARY KEY CLUSTERED
(
	[idEstadoPreventa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmEstadosPreventa] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmHistPrecio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farmHistPrecio](
	[idHistPrecio] [int] IDENTITY(1,1) NOT NULL,
	[idProducto] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[PrecioCompra] [money] NOT NULL,
	[PrecioDistribucion] [money] NOT NULL,
	[PrecioVenta] [money] NOT NULL,
	[PrecioDonacion] [money] NOT NULL,
	[IdUsuario] [int] NOT NULL,
 CONSTRAINT [PK_farmHistPrecio] PRIMARY KEY CLUSTERED
(
	[idHistPrecio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farmHistPrecio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmInventario]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmInventario](
	[idInventario] [int] IDENTITY(1,1) NOT NULL,
	[idAlmacen] [int] NOT NULL,
	[numeroInventario] [varchar](4) NULL,
	[FechaCierre] [datetime] NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[FechaModificacion] [datetime] NULL,
	[idEstadoInventario] [int] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[idTipoInventario] [int] NULL,
 CONSTRAINT [PK_farmInventario] PRIMARY KEY CLUSTERED
(
	[idInventario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmInventario] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmInventarioCabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farmInventarioCabecera](
	[idInventario] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Total] [money] NOT NULL,
	[CantidadSaldo] [int] NULL,
	[CantidadFaltante] [int] NULL,
	[CantidadSobrante] [int] NULL,
 CONSTRAINT [PK_farmInventarioCabecera] PRIMARY KEY CLUSTERED
(
	[idInventario] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmInventarioDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmInventarioDetalle](
	[idInventario] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Lote] [varchar](15) NOT NULL,
	[FechaVencimiento] [datetime] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[RegistroSanitario] [varchar](50) NULL,
	[CantidadSaldo] [int] NULL,
	[CantidadFaltante] [int] NULL,
	[CantidadSobrante] [int] NULL,
	[EsHistoricoSaldo] [int] NULL,
 CONSTRAINT [PK_farmInventarioDetalle] PRIMARY KEY CLUSTERED
(
	[idInventario] ASC,
	[idProducto] ASC,
	[Lote] ASC,
	[FechaVencimiento] ASC,
	[IdTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMotivoAnulacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMotivoAnulacion](
	[idMotivoAnulacion] [int] IDENTITY(1,1) NOT NULL,
	[CodigoMINSA] [varchar](2) NOT NULL,
	[Motivo] [char](150) NOT NULL,
 CONSTRAINT [PK_farmMotivoAnulacion] PRIMARY KEY CLUSTERED
(
	[idMotivoAnulacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMotivoAnulacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimiento](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[idAlmacenOrigen] [int] NOT NULL,
	[idAlmacenDestino] [int] NOT NULL,
	[idTipoConcepto] [int] NOT NULL,
	[DocumentoIdtipo] [int] NOT NULL,
	[DocumentoNumero] [varchar](20) NULL,
	[Observaciones] [varchar](100) NULL,
	[Total] [money] NOT NULL,
	[idMotivoAnulacion] [int] NULL,
	[fechaAnulacion] [datetime] NULL,
	[idUsuarioAnulacion] [int] NULL,
	[fechaCreacion] [datetime] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[idEstadoMovimiento] [int] NOT NULL,
	[DocExterno] [varchar](20) NULL,
 CONSTRAINT [PK_farmTmovim] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimientoDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimientoDetalle](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[idProducto] [int] NOT NULL,
	[Lote] [varchar](15) NOT NULL,
	[FechaVencimiento] [datetime] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[Item] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Total] [money] NOT NULL,
	[RegistroSanitario] [varchar](50) NULL,
	[DocumentoNumero] [varchar](20) NULL,
 CONSTRAINT [PK_farmTmovimDet] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC,
	[idProducto] ASC,
	[Lote] ASC,
	[FechaVencimiento] ASC,
	[IdTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FarmMovimientoDonaciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FarmMovimientoDonaciones](
	[movNumero] [varchar](9) NOT NULL,
	[movTipo] [varchar](1) NOT NULL,
	[idCuentaAtencion] [int] NOT NULL,
	[idPrescriptorReceta] [int] NULL,
	[idCoordinadorServicioSocial] [int] NOT NULL,
	[idDiagnostico] [int] NULL,
 CONSTRAINT [PK_FarmMovimientoDonaciones] PRIMARY KEY CLUSTERED
(
	[movNumero] ASC,
	[movTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDonaciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimientoNotaIngreso]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimientoNotaIngreso](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[DocumentoFechaRecepcion] [datetime] NULL,
	[OrigenIdTipo] [int] NULL,
	[OrigenNumero] [varchar](20) NULL,
	[OrigenFecha] [datetime] NULL,
	[idProveedor] [int] NULL,
	[idTipoCompra] [int] NULL,
	[idTipoProceso] [int] NULL,
	[NumeroProceso] [varchar](50) NULL,
	[idPaciente] [int] NULL,
	[idCuentaAtencion] [int] NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[idComprobantePago] [int] NULL,
	[FechaModificacion] [datetime] NULL,
	[idUsuarioModifica] [int] NULL,
 CONSTRAINT [PK_farmMovimientoAlmacen] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngreso] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimientoProgramas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimientoProgramas](
	[movNumero] [varchar](9) NOT NULL,
	[movTipo] [varchar](1) NOT NULL,
	[idCoordinador] [int] NOT NULL,
	[idPrescriptor] [char](10) NOT NULL,
	[idDiagnostico] [int] NOT NULL,
	[idPaciente] [int] NULL,
	[idComponente] [int] NOT NULL,
	[idSubComponente] [int] NOT NULL,
	[FechaHoraPrescribe] [datetime] NULL,
 CONSTRAINT [PK_farmMovimientoProgramas] PRIMARY KEY CLUSTERED
(
	[movNumero] ASC,
	[movTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimientoVentas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimientoVentas](
	[movNumero] [varchar](9) NOT NULL,
	[movTipo] [varchar](1) NOT NULL,
	[tipoVenta] [varchar](1) NOT NULL,
	[idPreVenta] [int] NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
	[idPrescriptor] [int] NULL,
	[idTipoReceta] [int] NOT NULL,
	[idDiagnostico] [int] NULL,
	[idCuentaAtencion] [int] NULL,
	[IdServicioPaciente] [int] NULL,
	[idFuenteFinanciamiento] [int] NULL,
	[idPaciente] [int] NULL,
	[FechaHoraPrescribe] [datetime] NULL,
 CONSTRAINT [PK_farmMovimientoVentas] PRIMARY KEY CLUSTERED
(
	[movNumero] ASC,
	[movTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmMovimientoVentasDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmMovimientoVentasDetalle](
	[MovNumero] [varchar](9) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[idProducto] [int] NOT NULL,
	[cantidad] [int] NOT NULL,
	[precio] [money] NOT NULL,
	[total] [money] NOT NULL,
 CONSTRAINT [PK_farmMovimientoVentasDetalle] PRIMARY KEY CLUSTERED
(
	[MovNumero] ASC,
	[MovTipo] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmPreVenta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmPreVenta](
	[idPreventa] [int] IDENTITY(1,1) NOT NULL,
	[idAlmacen] [int] NOT NULL,
	[idVendedor] [int] NOT NULL,
	[idPaciente] [int] NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
	[Total] [money] NOT NULL,
	[idDiagnostico] [int] NULL,
	[idTipoReceta] [int] NOT NULL,
	[idCuentaAtencion] [int] NULL,
	[idPrescriptor] [int] NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[HoraCreacion] [varchar](5) NOT NULL,
	[idUsuario] [int] NOT NULL,
	[FechaModificacion] [datetime] NULL,
	[idUsuarioModifica] [int] NULL,
	[idEstadoPreventa] [int] NOT NULL,
	[FechaHoraPrescribe] [datetime] NULL,
	[dni] [varchar](8) NULL,
	[Paciente] [varchar](100) NULL,
 CONSTRAINT [PK_farmTventa] PRIMARY KEY CLUSTERED
(
	[idPreventa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVenta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmPreVentaDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farmPreVentaDetalle](
	[idPreventa] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[item] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Importe] [money] NOT NULL,
 CONSTRAINT [PK_farmTpreVtaDe] PRIMARY KEY CLUSTERED
(
	[idPreventa] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmRelMod]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmRelMod](
	[TipoAlmacen] [varchar](1) NOT NULL,
	[TipoMov] [varchar](1) NOT NULL,
	[TipoSuministro] [varchar](2) NOT NULL,
	[ConceptoCodigo] [varchar](2) NOT NULL,
	[DocumentoId] [int] NOT NULL,
	[DocumentoCodigo] [varchar](2) NOT NULL,
	[DocumentoEsAutomatico] [varchar](1) NOT NULL,
	[DocumentoUltimoNumero] [varchar](20) NOT NULL,
	[NiDocumentoOrigenId] [int] NOT NULL,
	[NiDocumentoOrigenCodigo] [varchar](2) NOT NULL,
	[NiDocumentoOrigenEsAutomatico] [varchar](1) NOT NULL,
	[NiDocumentoOrigenUltimoNumero] [varchar](20) NOT NULL,
	[NiFiltroAlmacenOrigen] [varchar](200) NULL,
	[NiEsCompra] [bit] NOT NULL,
	[NiEsDevolucionPaciente] [bit] NOT NULL,
	[NsFiltroAlmacenDestino] [varchar](200) NULL,
	[TipoPrecioParaNiNs] [int] NOT NULL,
	[MuestraLoteParaDespachoNS] [varchar](1) NULL,
	[NiFiltroAlmacenOrigenCS] [varchar](200) NULL,
	[NsFiltroAlmacenDestinoCS] [varchar](200) NULL,
 CONSTRAINT [PK_farmRelMod1] PRIMARY KEY CLUSTERED
(
	[TipoAlmacen] ASC,
	[TipoMov] ASC,
	[TipoSuministro] ASC,
	[ConceptoCodigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmRelMod] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmSaldo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farmSaldo](
	[idAlmacen] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[cantidad] [money] NOT NULL,
	[Precio] [money] NOT NULL,
 CONSTRAINT [PK_farmMstockAlm] PRIMARY KEY CLUSTERED
(
	[idAlmacen] ASC,
	[idProducto] ASC,
	[IdTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmSaldoDetallado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmSaldoDetallado](
	[idAlmacen] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Lote] [varchar](15) NOT NULL,
	[FechaVencimiento] [datetime] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[Cantidad] [money] NOT NULL,
	[Precio] [money] NOT NULL,
 CONSTRAINT [PK_farmMsaldoXlote] PRIMARY KEY CLUSTERED
(
	[idAlmacen] ASC,
	[idProducto] ASC,
	[Lote] ASC,
	[FechaVencimiento] ASC,
	[IdTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoDetallado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmSaldoMensual]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[farmSaldoMensual](
	[idAlmacen] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[SaldoFecha] [datetime] NOT NULL,
	[Saldo] [int] NOT NULL,
 CONSTRAINT [PK_farmSaldoDetalladoMes] PRIMARY KEY CLUSTERED
(
	[idAlmacen] ASC,
	[idProducto] ASC,
	[SaldoFecha] ASC,
	[IdTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoMensual] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FarmSaldoMensualDetallado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FarmSaldoMensualDetallado](
	[idAlmacen] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Lote] [varchar](15) NOT NULL,
	[FechaVencimiento] [datetime] NOT NULL,
	[IdTipoSalidaBienInsumo] [int] NOT NULL,
	[SaldoFecha] [datetime] NOT NULL,
	[Saldo] [int] NOT NULL,
	[Precio] [money] NOT NULL,
 CONSTRAINT [PK_FarmSaldoMensualDetallado] PRIMARY KEY CLUSTERED
(
	[idAlmacen] ASC,
	[idProducto] ASC,
	[Lote] ASC,
	[FechaVencimiento] ASC,
	[IdTipoSalidaBienInsumo] ASC,
	[SaldoFecha] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoMensualDetallado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoCompra]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoCompra](
	[idTipoCompra] [int] IDENTITY(1,1) NOT NULL,
	[codigoMINSA] [varchar](2) NOT NULL,
	[descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmTipoCompra] PRIMARY KEY CLUSTERED
(
	[idTipoCompra] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoCompra] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoConceptos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoConceptos](
	[idTipoConcepto] [int] IDENTITY(1,1) NOT NULL,
	[codigoMINSA] [varchar](2) NOT NULL,
	[Concepto] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmTipoConceptos] PRIMARY KEY CLUSTERED
(
	[idTipoConcepto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoConceptos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoDocumentos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoDocumentos](
	[idTipoDocumento] [int] IDENTITY(1,1) NOT NULL,
	[CodigoMINSA] [varchar](2) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Abreviatura] [varchar](20) NOT NULL,
	[Correlativo] [int] NOT NULL,
 CONSTRAINT [PK_farmMtipoDocu] PRIMARY KEY CLUSTERED
(
	[idTipoDocumento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoDocumentos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoInventario]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoInventario](
	[idTipoInventario] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
	[TipoInventarioSismed] [varchar](1) NOT NULL,
 CONSTRAINT [PK_farmTipoInventario] PRIMARY KEY CLUSTERED
(
	[idTipoInventario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoInventario] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoLocal]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoLocal](
	[idTipoLocal] [varchar](1) NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [PK_farmTipoAlmacen] PRIMARY KEY CLUSTERED
(
	[idTipoLocal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoLocal] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoProceso]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoProceso](
	[idTipoProceso] [int] IDENTITY(1,1) NOT NULL,
	[codigoMINSA] [varchar](2) NOT NULL,
	[descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmTipoProceso] PRIMARY KEY CLUSTERED
(
	[idTipoProceso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoProceso] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoProductosSismed]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoProductosSismed](
	[TipoProductoSismed] [varchar](1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmTipoSalidaSismed] PRIMARY KEY CLUSTERED
(
	[TipoProductoSismed] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoProductosSismed] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoReceta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoReceta](
	[idTipoReceta] [int] NOT NULL,
	[tipoReceta] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmTipoReceta] PRIMARY KEY CLUSTERED
(
	[idTipoReceta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoReceta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoSalidaBienInsumo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoSalidaBienInsumo](
	[idTipoSalidaBienInsumo] [int] NOT NULL,
	[tipo] [varchar](20) NOT NULL,
 CONSTRAINT [PK_farmTipoBienInsumo] PRIMARY KEY CLUSTERED
(
	[idTipoSalidaBienInsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoSalidaBienInsumo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmTipoSuministro]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmTipoSuministro](
	[idTipoSuministro] [varchar](2) NOT NULL,
	[descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [PK_farmTipoSuministro] PRIMARY KEY CLUSTERED
(
	[idTipoSuministro] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoSuministro] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[farmUnidosis]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[farmUnidosis](
	[codigo] [varchar](7) NOT NULL,
	[descripcion] [nvarchar](255) NOT NULL,
	[um] [varchar](10) NOT NULL,
	[umconsumo] [varchar](10) NOT NULL,
	[CONVERTIR] [varchar](50) NOT NULL,
 CONSTRAINT [PK_farmunidosis] PRIMARY KEY CLUSTERED
(
	[codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[farmUnidosis] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FuentesFinanciamiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[FuentesFinanciamiento](
	[IdFuenteFinanciamiento] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[IdTipoFinanciamiento] [int] NULL,
	[idTipoConceptoFarmacia] [int] NULL,
	[UtilizadoEn] [int] NULL,
	[CodigoFuenteFinanciamientoSEM] [varchar](2) NULL,
	[idAreaTramitaSeguros] [int] NULL,
	[EsUsadoEnCaja] [bit] NULL,
	[CodigoHIS] [varchar](2) NULL,
	[idTipoFinanciador] [int] NOT NULL,
	[codigo] [char](11) NOT NULL,
	[MontoMaximo] [money] NULL,
	[MontoMaxAlerta] [int] NULL,
	[CuentaParaUnidosis] [int] NULL,
	[usadoEnFUnidosis] [int] NULL,
	[TieneEPS] [int] NULL,
 CONSTRAINT [FuentesFinaciamiento_PK] PRIMARY KEY CLUSTERED
(
	[IdFuenteFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[FuentesFinanciamientoTarifas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FuentesFinanciamientoTarifas](
	[idFuenteFinanciamiento] [int] NOT NULL,
	[idTipoFinanciamiento] [int] NOT NULL,
 CONSTRAINT [PK_FuentesFinanciamientoTarifas] PRIMARY KEY CLUSTERED
(
	[idFuenteFinanciamiento] ASC,
	[idTipoFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[GeneradorNroHistoriaClinica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GeneradorNroHistoriaClinica](
	[IdNumerador] [int] IDENTITY(1,1) NOT NULL,
	[NroHistoriaClinica] [int] NULL,
	[Estado] [bit] NULL,
	[IdTipoNumeracion] [int] NULL,
 CONSTRAINT [GeneradorNroHistoriaClinica_PK] PRIMARY KEY CLUSTERED
(
	[IdNumerador] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Cabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HIS_Cabecera](
	[IdHisCabecera] [int] IDENTITY(1,1) NOT NULL,
	[IdHisLote] [int] NULL,
	[NroHojaHis] [int] NULL,
	[NroFormato] [int] NOT NULL,
	[IdTurno] [int] NOT NULL,
	[IdUsuario] [int] NULL,
	[IdEstadoHis] [int] NULL,
	[IdMedico] [int] NULL,
	[IdServEstablecimiento] [int] NULL,
	[FechaCreacion] [datetime] NULL,
	[IdEstablecimiento] [int] NOT NULL,
	[IdServicio] [int] NOT NULL,
 CONSTRAINT [PK__HIS_Cabecera__2D0AE9D4] PRIMARY KEY CLUSTERED
(
	[IdHisCabecera] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Cabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_CodigosActividades]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_CodigosActividades](
	[IdHisCodActvidad] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoAtencion] [int] NULL,
	[CodigoActividad] [char](6) NOT NULL,
	[Descripcion] [varchar](100) NULL,
 CONSTRAINT [PK__HIS_CodigosActiv__3A64E4F2] PRIMARY KEY CLUSTERED
(
	[IdHisCodActvidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividades] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_colegios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_colegios](
	[cod_col] [char](2) NOT NULL,
	[des_col] [char](41) NOT NULL,
 CONSTRAINT [PK_HIS_colegios] PRIMARY KEY CLUSTERED
(
	[cod_col] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_colegios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_DatosEstablecimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_DatosEstablecimiento](
	[IdDatoEstablec] [int] IDENTITY(1,1) NOT NULL,
	[IdEstablecimiento] [int] NULL,
	[Color] [varchar](30) NULL,
	[Turnos] [int] NULL,
	[UltimoNroFormatoHIS] [int] NULL,
 CONSTRAINT [PK__HIS_DatosEstable__0B74EBDF] PRIMARY KEY CLUSTERED
(
	[IdDatoEstablec] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Detalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Detalle](
	[IdHisDetalle] [int] IDENTITY(1,1) NOT NULL,
	[IdHisCabecera] [int] NULL,
	[IdTipoAtencion] [int] NULL,
	[DiaAtencion] [int] NOT NULL,
	[IdHisPaciente] [int] NULL,
	[CodigoActividad] [varchar](10) NULL,
	[IdTipoFinanciamiento] [int] NULL,
	[IdDistrito] [int] NULL,
	[IdTipoEdad] [int] NULL,
	[Edad] [int] NULL,
	[Talla] [int] NULL,
	[Peso] [char](50) NULL,
	[IdEstadoaEstablec] [int] NULL,
	[IdEstadoaServicio] [int] NULL,
	[NroRegistroLote] [int] NULL,
	[NroRegistroHoja] [int] NULL,
 CONSTRAINT [PK__HIS_Detalle__2EF33246] PRIMARY KEY CLUSTERED
(
	[IdHisDetalle] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Detalle_Verifica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Detalle_Verifica](
	[IdHisDetalle] [int] NOT NULL,
	[IdHisCabecera] [int] NOT NULL,
	[IdTipoAtencion] [int] NULL,
	[DiaAtencion] [int] NULL,
	[Sexo] [int] NULL,
	[IdNacionalidad] [int] NULL,
	[NroDocIdentidad] [varchar](12) NULL,
	[NroHijo] [char](2) NULL,
	[IdEtnia] [char](2) NULL,
	[IdTipoDocumento] [int] NULL,
	[NroHC_FF] [varchar](20) NULL,
	[CodigoActividad] [varchar](10) NULL,
	[IdTipoFinanciamiento] [int] NULL,
	[IdDistrito] [int] NULL,
	[IdTipoEdad] [int] NULL,
	[Edad] [int] NULL,
	[Talla] [int] NULL,
	[Peso] [char](50) NULL,
	[IdEstadoaEstablec] [int] NULL,
	[IdEstadoaServicio] [int] NULL,
	[NroRegistroLote] [int] NULL,
	[NroRegistroHoja] [int] NULL,
	[Registrado] [int] NOT NULL,
	[Coincide] [int] NULL,
 CONSTRAINT [PK_HIS_Detalle_Verifica] PRIMARY KEY CLUSTERED
(
	[IdHisDetalle] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle_Verifica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_DetalleDiagnostico]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_DetalleDiagnostico](
	[IdHisDetalleDiagnostico] [int] IDENTITY(1,1) NOT NULL,
	[IdHisDetalle] [int] NULL,
	[IdCIE] [int] NULL,
	[IdSubClasificacionDX] [int] NULL,
	[CodLAB] [varchar](30) NULL,
 CONSTRAINT [PK__HIS_DetalleDiagn__34AC0B9C] PRIMARY KEY CLUSTERED
(
	[IdHisDetalleDiagnostico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnostico] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_DetalleDx_Verifica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_DetalleDx_Verifica](
	[IdHisDetalle] [int] NOT NULL,
	[IdCIE] [int] NOT NULL,
	[IdSubClasificacionDX] [int] NULL,
	[CodLAB] [varchar](30) NULL,
 CONSTRAINT [PK_HIS_DetalleDx_Verifica] PRIMARY KEY CLUSTERED
(
	[IdHisDetalle] ASC,
	[IdCIE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDx_Verifica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_DxOmitidos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_DxOmitidos](
	[NroPagina] [int] NOT NULL,
	[Codigo1] [varchar](6) NOT NULL,
	[Codigo2] [varchar](6) NOT NULL,
	[Codigo3] [varchar](6) NOT NULL,
	[Codigo4] [varchar](6) NOT NULL,
	[Codigo5] [varchar](6) NOT NULL,
	[Codigo6] [varchar](6) NOT NULL,
	[LabConf1] [varchar](3) NULL,
	[LabConf2] [varchar](3) NULL,
	[LabConf3] [varchar](3) NULL,
	[LabConf4] [varchar](3) NULL,
	[LabConf5] [varchar](3) NULL,
	[LabConf6] [varchar](3) NULL,
	[Diagnost1] [varchar](1) NOT NULL,
	[Diagnost2] [varchar](1) NOT NULL,
	[Diagnost3] [varchar](1) NOT NULL,
	[Diagnost4] [varchar](1) NOT NULL,
	[Diagnost5] [varchar](1) NOT NULL,
	[Diagnost6] [varchar](1) NOT NULL,
	[Edad] [int] NOT NULL,
	[TIP_EDAD] [varchar](1) NOT NULL,
	[Sexo] [varchar](1) NOT NULL,
	[Peso] [money] NOT NULL,
	[FichaFam] [varchar](10) NULL,
	[Establecimiento] [varchar](1) NOT NULL,
	[Servicio] [varchar](1) NOT NULL,
	[CODVALIDACION] [int] NULL,
	[IdLote] [int] NULL,
	[DiaAtencion] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DxOmitidos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_ESTAB]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HIS_ESTAB](
	[COD_ESTAB] [nvarchar](9) NULL,
	[DESC_ESTAB] [nvarchar](44) NULL,
	[COD_2000] [float] NOT NULL,
	[TIPOESTAB] [nvarchar](1) NULL,
	[COD_DPTO] [nvarchar](2) NULL,
	[COD_PROV] [nvarchar](2) NULL,
	[COD_DIST] [nvarchar](2) NULL,
	[COD_DISA] [nvarchar](2) NULL,
	[COD_RED] [nvarchar](2) NULL,
	[COD_MIC] [nvarchar](2) NULL,
 CONSTRAINT [PK_HIS_ESTAB] PRIMARY KEY CLUSTERED
(
	[COD_2000] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ESTAB] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[His_Establecimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[His_Establecimientos](
	[IdEstablecimiento] [int] NOT NULL,
 CONSTRAINT [PK_His_Establecimientos] PRIMARY KEY CLUSTERED
(
	[IdEstablecimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[His_Establecimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_EstablecPacienteHIS]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_EstablecPacienteHIS](
	[IdEstablecPacienteHIS] [int] IDENTITY(1,1) NOT NULL,
	[IdEstablecimiento] [int] NULL,
	[IdHisPaciente] [int] NULL,
	[NroHC_FF] [varchar](20) NOT NULL,
 CONSTRAINT [PK__HIS_EstablecPaci__38652BE2] PRIMARY KEY CLUSTERED
(
	[IdEstablecPacienteHIS] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstablecPacienteHIS] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[His_EstadosCalidad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[His_EstadosCalidad](
	[IdEstado] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_His_EstadosCalidad] PRIMARY KEY CLUSTERED
(
	[IdEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosCalidad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[His_EstadosLote]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[His_EstadosLote](
	[IdEstado] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_His_EstadosLote] PRIMARY KEY CLUSTERED
(
	[IdEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosLote] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_FACTCATALOGOSERVICIOS]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_FACTCATALOGOSERVICIOS](
	[IdDiagCpt] [int] NOT NULL,
	[CodigoDiagCpt] [varchar](20) NULL,
	[DescripcionDiagCpt] [varchar](1000) NULL,
	[EsCpt] [varchar](1) NULL,
	[CodCondicion] [varchar](1) NULL,
	[DxSexo] [varchar](4) NULL,
	[CodigoDiagCptSinPunto] [varchar](20) NULL,
	[MasDeUnDiagnosticos] [varchar](20) NULL,
 CONSTRAINT [PK_HIS_FACTCATALOGOSERVICIOS] PRIMARY KEY CLUSTERED
(
	[IdDiagCpt] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_FACTCATALOGOSERVICIOS] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Financiador]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Financiador](
	[IdCodigoFinancHis] [int] NOT NULL,
	[DescripcionFinancHis] [varchar](50) NULL,
	[IdFuenteFinanciamiento] [int] NULL,
 CONSTRAINT [PK_HIS_Financiador] PRIMARY KEY CLUSTERED
(
	[IdCodigoFinancHis] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Financiador] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[his_historicoAtenciones]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[his_historicoAtenciones](
	[idPaciente] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[diagnost] [varchar](6) NULL,
	[cpt] [varchar](6) NULL,
	[ups] [varchar](6) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtenciones] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Lotes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Lotes](
	[IdHisLote] [int] IDENTITY(1,1) NOT NULL,
	[IdEstablecimiento] [int] NULL,
	[Lote] [char](3) NULL,
	[NroHojas] [int] NULL,
	[Mes] [int] NULL,
	[Anio] [int] NULL,
	[Cerrado] [int] NULL,
	[idEstadoLote] [int] NULL,
	[DobleDigitacion] [int] NOT NULL,
 CONSTRAINT [PK__HIS_Lotes__2B22A162] PRIMARY KEY CLUSTERED
(
	[IdHisLote] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Lotes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Meses]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Meses](
	[IdMes] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
 CONSTRAINT [PK_HIS_Meses] PRIMARY KEY CLUSTERED
(
	[IdMes] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Meses] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Paciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Paciente](
	[IdHisPaciente] [int] IDENTITY(1,1) NOT NULL,
	[Sexo] [int] NULL,
	[IdNacionalidad] [int] NULL,
	[NroDocIdentidad] [varchar](12) NULL,
	[NroHijo] [char](2) NULL,
	[IdEtnia] [char](2) NULL,
	[IdPacienteGalenHos] [int] NULL,
	[IdTipoDocumento] [int] NULL,
 CONSTRAINT [PK__HIS_Paciente__32C3C32A] PRIMARY KEY CLUSTERED
(
	[IdHisPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Paciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_ProgMedEstMR]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HIS_ProgMedEstMR](
	[IdHisProgMedEstMR] [int] IDENTITY(1,1) NOT NULL,
	[IdMedico] [int] NULL,
	[IdServicio] [int] NULL,
	[IdEstablecimiento] [int] NULL,
	[FechaProgramada] [datetime] NULL,
	[IdTurno] [int] NULL,
 CONSTRAINT [PK__HIS_ProgMedEstMR__3C4D2D64] PRIMARY KEY CLUSTERED
(
	[IdHisProgMedEstMR] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMR] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_ServEstablecimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HIS_ServEstablecimiento](
	[IdEstablecimiento] [int] NOT NULL,
	[IdServicio] [int] NOT NULL,
 CONSTRAINT [PK_HIS_ServEstablecimiento] PRIMARY KEY CLUSTERED
(
	[IdEstablecimiento] ASC,
	[IdServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_situacio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_situacio](
	[IdHisSituacio] [int] IDENTITY(1,1) NOT NULL,
	[valores] [char](5) NULL,
	[descripcio] [varchar](100) NULL,
	[codigo] [numeric](5, 0) NOT NULL,
	[est] [char](1) NOT NULL,
	[LABHISWEB] [bit] NULL,
 CONSTRAINT [PK_HISsituacio] PRIMARY KEY CLUSTERED
(
	[IdHisSituacio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_tabetnia]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_tabetnia](
	[codetni] [char](2) NOT NULL,
	[desetni] [char](48) NOT NULL,
	[codgen] [char](2) NOT NULL,
	[etnias] [char](24) NOT NULL,
 CONSTRAINT [PK_HIS_tabetnia] PRIMARY KEY CLUSTERED
(
	[codetni] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetnia] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_TEMPORAL]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_TEMPORAL](
	[Codigo1] [varchar](6) NOT NULL,
	[Codigo2] [varchar](6) NOT NULL,
	[Codigo3] [varchar](6) NOT NULL,
	[Codigo4] [varchar](6) NOT NULL,
	[Codigo5] [varchar](6) NOT NULL,
	[Codigo6] [varchar](6) NOT NULL,
	[LabConf1] [varchar](3) NULL,
	[LabConf2] [varchar](3) NULL,
	[LabConf3] [varchar](3) NULL,
	[LabConf4] [varchar](3) NULL,
	[LabConf5] [varchar](3) NULL,
	[LabConf6] [varchar](3) NULL,
	[Diagnost1] [varchar](1) NOT NULL,
	[Diagnost2] [varchar](1) NOT NULL,
	[Diagnost3] [varchar](1) NOT NULL,
	[Diagnost4] [varchar](1) NOT NULL,
	[Diagnost5] [varchar](1) NOT NULL,
	[Diagnost6] [varchar](1) NOT NULL,
	[Edad] [int] NOT NULL,
	[TIP_EDAD] [varchar](1) NOT NULL,
	[Sexo] [varchar](1) NOT NULL,
	[Peso] [money] NOT NULL,
	[FichaFam] [varchar](10) NULL,
	[Establecimiento] [varchar](1) NULL,
	[Servicio] [varchar](1) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORAL] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_TemporalSexo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_TemporalSexo](
	[CieCpt] [varchar](50) NOT NULL,
	[DxSexo] [int] NULL,
	[EsCpt] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TemporalSexo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_TipoAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_TipoAtencion](
	[IdHisTipoAtencion] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [char](3) NULL,
	[Descripcion] [varchar](50) NULL,
 CONSTRAINT [PK__HIS_TipoAtencion__30DB7AB8] PRIMARY KEY CLUSTERED
(
	[IdHisTipoAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_TipoEdad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_TipoEdad](
	[IdHisTipoEdad] [int] IDENTITY(1,1) NOT NULL,
	[CodigoEdad] [char](1) NULL,
	[Descripcion] [varchar](5) NULL,
 CONSTRAINT [PK__HIS_TipoEdad__3694540E] PRIMARY KEY CLUSTERED
(
	[IdHisTipoEdad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_Turnos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_Turnos](
	[IdHisTurno] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](10) NULL,
 CONSTRAINT [PK__HIS_Turnos__3E3575D6] PRIMARY KEY CLUSTERED
(
	[IdHisTurno] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Turnos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HIS_VALIDACIONES]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HIS_VALIDACIONES](
	[CODVALIDACION] [int] NOT NULL,
	[TXTDESCRIPCION] [varchar](300) NOT NULL,
	[TXTVALIDACION] [varchar](2000) NULL,
	[TXTARCHIVO] [varchar](100) NULL,
	[TXTNPAGINA] [varchar](100) NULL,
	[CodCondicion] [varchar](1) NULL,
	[FECACTIVACION] [datetime] NOT NULL,
	[FECINACTIVACION] [datetime] NOT NULL,
	[CCH] [varchar](1) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HIS_VALIDACIONES] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HistoriasClinicas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HistoriasClinicas](
	[NroHistoriaClinica] [int] NOT NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[FechaPasoAPasivo] [datetime] NULL,
	[IdTipoHistoria] [int] NOT NULL,
	[IdEstadoHistoria] [int] NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[IdTipoNumeracion] [int] NOT NULL,
	[NroHistoriaClinicaAnterior] [int] NULL,
	[IdTipoNumeracionAnterior] [int] NULL,
	[HistoriaSistemaAnterior] [varchar](50) NULL,
	[fechaUltimoCambioHistoria] [datetime] NULL,
	[FultimoMovimiento] [datetime] NULL,
 CONSTRAINT [HistoriasClinicas_PK] PRIMARY KEY CLUSTERED
(
	[NroHistoriaClinica] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HistoriasNormas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HistoriasNormas](
	[NoResolucion] [varchar](100) NULL,
	[NoDirectiva] [varchar](150) NULL,
	[Institucion] [int] NULL,
	[FechaNorma] [datetime] NULL,
	[AnioPasivo_N1] [int] NULL,
	[AnioElimin_N2] [int] NULL,
	[FechaVigencia] [datetime] NULL,
	[Estado] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasNormas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[HistoriasSolicitadas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[HistoriasSolicitadas](
	[IdHistoriaSolicitada] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[FechaSolicitud] [datetime] NULL,
	[HoraSolicitud] [char](5) NULL,
	[FechaRequerida] [datetime] NULL,
	[HoraRequerida] [char](5) NULL,
	[IdMotivo] [int] NULL,
	[IdServicio] [int] NULL,
	[Observacion] [varchar](150) NULL,
	[IdMovimiento] [int] NULL,
	[IdEmpleadoSolicita] [int] NULL,
	[FechaHoraReg] [datetime] NULL,
	[IdAtencion] [int] NULL,
 CONSTRAINT [HistoriasSolicitadas_PK] PRIMARY KEY CLUSTERED
(
	[IdHistoriaSolicitada] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ICI_DIGEMID]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ICI_DIGEMID](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CODIGO_EJE] [varchar](3) NULL,
	[CODIGO_PRE] [varchar](12) NULL,
	[TIPSUM] [char](1) NULL,
	[PERIODO] [varchar](8) NULL,
	[CODIGO_MED] [varchar](5) NULL,
	[PRECIO_ADQUISICION] [decimal](15, 6) NULL,
	[PRECIO_OPERACION] [decimal](15, 6) NULL,
	[SALDO] [int] NULL,
	[INGRE] [int] NULL,
	[REINGRE] [int] NULL,
	[VENTA] [int] NULL,
	[SIS] [int] NULL,
	[INTERSAN] [int] NULL,
	[FAC_PERD] [int] NULL,
	[DEFNAC] [int] NULL,
	[EXO] [int] NULL,
	[SOAT] [int] NULL,
	[CREDHOSP] [int] NULL,
	[OTR_CONV] [int] NULL,
	[DEVOL] [int] NULL,
	[VENCIDO] [int] NULL,
	[MERMA] [int] NULL,
	[DISTRI] [int] NULL,
	[TRANSF] [int] NULL,
	[VENTAINST] [int] NULL,
	[DEV_VEN] [int] NULL,
	[DEV_MERMA] [int] NULL,
	[OTRAS_SAL] [int] NULL,
	[TOTAL] [int] NULL,
	[STOCK_FIN] [int] NULL,
	[FEC_EXP] [date] NULL,
	[REQUERIMIENTO] [int] NULL,
	[DO_SALDO] [int] NULL,
	[DO_INGRE] [int] NULL,
	[DO_CON] [int] NULL,
	[DO_OTR] [int] NULL,
	[DO_TOT] [int] NULL,
	[DO_STK] [int] NULL,
	[DO_FECEXP] [date] NULL,
 CONSTRAINT [PK_ICI_SISMED] PRIMARY KEY CLUSTERED
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ICI_DIGEMID] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagCatalgoServicioDuracion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ImagCatalgoServicioDuracion](
	[IdProducto] [int] NOT NULL,
	[DuracionEnMin] [money] NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_ImagCatalgoServicioDuracion] PRIMARY KEY CLUSTERED
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagEstados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagEstados](
	[IdImagEstado] [int] NOT NULL,
	[Estado] [varchar](20) NOT NULL,
 CONSTRAINT [PK_ImagEstados] PRIMARY KEY CLUSTERED
(
	[IdImagEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagEstados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMotivoSalidas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagMotivoSalidas](
	[idMotivoSalida] [int] IDENTITY(1,1) NOT NULL,
	[motivo] [varchar](100) NOT NULL,
 CONSTRAINT [PK_ImagMotivosSalidas] PRIMARY KEY CLUSTERED
(
	[idMotivoSalida] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagMotivoSalidas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagMovimiento](
	[IdMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[IdTipoConcepto] [int] NOT NULL,
	[IdPuntoCarga] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[IdUsuario] [int] NOT NULL,
	[IdImagEstado] [int] NOT NULL,
 CONSTRAINT [PK_ImagMovimiento] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoCPT]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ImagMovimientoCPT](
	[idMovimiento] [int] NOT NULL,
	[idProductoCPT] [int] NOT NULL,
	[cantidad] [int] NOT NULL,
	[precio] [money] NOT NULL,
	[importe] [money] NOT NULL,
	[ResultadoAutomatico] [int] NULL,
 CONSTRAINT [PK_ImagMovimientoCPT] PRIMARY KEY CLUSTERED
(
	[idMovimiento] ASC,
	[idProductoCPT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPT] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ImagMovimientoDetalle](
	[idMovimiento] [int] NOT NULL,
	[idProductoCPT] [int] NULL,
	[idProducto] [int] NOT NULL,
	[CantidadFallada] [int] NOT NULL,
	[Cantidad] [int] NOT NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoImagenes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagMovimientoImagenes](
	[IdMovimiento] [int] NOT NULL,
	[IdOrden] [int] NOT NULL,
	[CorrelativoAnual] [int] NULL,
	[IdCuentaAtencion] [int] NULL,
	[IdComprobantePago] [int] NULL,
	[idPersonaTomaImagen] [int] NULL,
	[idPersonaRecoge] [int] NULL,
	[zonaRayosX] [varchar](50) NULL,
	[PorcInformeRadiolog] [money] NULL,
	[ResultadoFinal] [varchar](3000) NULL,
	[EsContraste] [int] NULL,
	[EsContrasteIonico] [int] NULL,
	[idDiagnostico] [int] NULL,
	[EsDiagnosticoDefinitivo] [int] NULL,
	[Eo_FUM] [datetime] NULL,
	[Eo_Gestantes] [varchar](2) NULL,
	[Eo_Partos] [varchar](20) NULL,
	[Eo_EG] [int] NULL,
	[Paciente] [varchar](100) NULL,
	[IdTipoSexo] [int] NULL,
	[FechaNacimiento] [datetime] NULL,
	[HCrx] [varchar](10) NULL,
 CONSTRAINT [PK_ImagMovimientoRayosX] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoIngresos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagMovimientoIngresos](
	[IdMovimiento] [int] NOT NULL,
	[NroDocumento] [varchar](20) NULL,
	[IdPersonaRecepciona] [int] NULL,
 CONSTRAINT [PK_ImagMovimientoIngresos] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoIngresos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoResultados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagMovimientoResultados](
	[idMovimiento] [int] NOT NULL,
	[idProductoCPT] [int] NOT NULL,
	[Resultado] [varchar](3000) NULL,
	[ResultadoFecha] [datetime] NOT NULL,
	[ResultadoDNI] [varchar](8) NOT NULL,
	[EquipoRuta] [varchar](200) NULL,
 CONSTRAINT [PK_ImagMovimientoResultados] PRIMARY KEY CLUSTERED
(
	[idMovimiento] ASC,
	[idProductoCPT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoResultados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagMovimientoSalidas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ImagMovimientoSalidas](
	[IdMovimiento] [int] NOT NULL,
	[IdResponsable] [int] NOT NULL,
	[IdMotivoSalida] [int] NOT NULL,
 CONSTRAINT [PK_ImagMovimientoSalidas] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagRecojeExamen]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagRecojeExamen](
	[idRecojeExamen] [int] IDENTITY(1,1) NOT NULL,
	[RecojeExamen] [varchar](30) NOT NULL,
 CONSTRAINT [PK_ImagRecojeExamen] PRIMARY KEY CLUSTERED
(
	[idRecojeExamen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagRecojeExamen] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagSala]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagSala](
	[IdSala] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoModalidadSala] [int] NOT NULL,
	[Sala] [varchar](50) NOT NULL,
	[Codigo] [varchar](15) NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_ImagSala] PRIMARY KEY CLUSTERED
(
	[IdSala] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagSala] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagTipoConceptos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagTipoConceptos](
	[idTipoConcepto] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [varchar](50) NOT NULL,
 CONSTRAINT [PK_ImagTipoConceptos] PRIMARY KEY CLUSTERED
(
	[idTipoConcepto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoConceptos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ImagTipoModalidadSala]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ImagTipoModalidadSala](
	[IdTipoModalidadSala] [int] IDENTITY(1,1) NOT NULL,
	[TipoModalidadSala] [varchar](50) NOT NULL,
	[Codigo] [varchar](5) NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_ImagTipoModalidadSala] PRIMARY KEY CLUSTERED
(
	[IdTipoModalidadSala] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSala] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[InteoIntegracionSistema]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[InteoIntegracionSistema](
	[IdIntegracionSistema] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoSistema] [int] NOT NULL,
	[IdProveedorSistema] [int] NOT NULL,
	[NombreUsuario] [varchar](35) NULL,
	[ClaveUsuario] [varchar](50) NULL,
	[EsProveedorActual] [bit] NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_InteoIntegracionSistema] PRIMARY KEY CLUSTERED
(
	[IdIntegracionSistema] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistema] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[InteoProveedorSistema]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[InteoProveedorSistema](
	[IdProveedorSistema] [int] IDENTITY(1,1) NOT NULL,
	[ProveedorSistema] [varchar](100) NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_IOpProveedorSistema] PRIMARY KEY CLUSTERED
(
	[IdProveedorSistema] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistema] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[InteoTipoSistema]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[InteoTipoSistema](
	[IdTipoSistema] [int] IDENTITY(1,1) NOT NULL,
	[TipoSistema] [varchar](50) NOT NULL,
	[EsActivo] [bit] NOT NULL,
	[FechaCrea] [datetime] NOT NULL,
	[FechaEdita] [datetime] NULL,
 CONSTRAINT [PK_InteoTipoSistema] PRIMARY KEY CLUSTERED
(
	[IdTipoSistema] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistema] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabEstados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabEstados](
	[IdLabEstado] [int] NOT NULL,
	[Estado] [varchar](20) NOT NULL,
 CONSTRAINT [PK_LabEstados] PRIMARY KEY CLUSTERED
(
	[IdLabEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabEstados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[labGrupos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[labGrupos](
	[idGrupo] [int] IDENTITY(1,1) NOT NULL,
	[NombreGrupo] [char](20) NOT NULL,
	[SiglasGrupo] [char](3) NOT NULL,
	[idCargo] [int] NULL,
 CONSTRAINT [PK_labGrupos] PRIMARY KEY CLUSTERED
(
	[idGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[labGrupos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabItems]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabItems](
	[idItem] [int] NOT NULL,
	[Item] [varchar](100) NULL,
	[idProductoCpt] [int] NULL,
 CONSTRAINT [PK_LabItems] PRIMARY KEY CLUSTERED
(
	[idItem] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabItems] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabItemsCpt]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabItemsCpt](
	[idProductoCpt] [int] NOT NULL,
	[ordenXresultado] [int] NOT NULL,
	[idGrupo] [int] NOT NULL,
	[idItemGrupo] [int] NULL,
	[idItem] [int] NOT NULL,
	[ValorSiEsCombo] [varchar](100) NULL,
	[ValorReferencial] [varchar](100) NULL,
	[Metodo] [varchar](50) NULL,
	[SoloNumero] [bit] NULL,
	[SoloTexto] [bit] NULL,
	[SoloCombo] [bit] NULL,
	[SoloCheck] [bit] NULL,
 CONSTRAINT [PK_LabItemsCpt] PRIMARY KEY CLUSTERED
(
	[idProductoCpt] ASC,
	[ordenXresultado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCpt] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabItemsGrupos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabItemsGrupos](
	[idItemGrupo] [int] NOT NULL,
	[Grupo] [varchar](100) NULL,
 CONSTRAINT [PK_LabItemsGrupos] PRIMARY KEY CLUSTERED
(
	[idItemGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGrupos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMotivoSalidas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabMotivoSalidas](
	[idMotivoSalida] [int] IDENTITY(1,1) NOT NULL,
	[motivo] [varchar](100) NOT NULL,
 CONSTRAINT [PK_LabMotivoSalidas] PRIMARY KEY CLUSTERED
(
	[idMotivoSalida] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabMotivoSalidas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabMovimiento](
	[IdMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[MovTipo] [varchar](1) NOT NULL,
	[IdTipoConcepto] [int] NOT NULL,
	[IdPuntoCarga] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[IdUsuario] [int] NOT NULL,
	[IdLabEstado] [int] NOT NULL,
 CONSTRAINT [PK_LabMovimiento] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimientoCPT]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LabMovimientoCPT](
	[idMovimiento] [int] NOT NULL,
	[idProductoCPT] [int] NOT NULL,
	[cantidad] [int] NOT NULL,
	[precio] [money] NOT NULL,
	[importe] [money] NOT NULL,
	[ResultadoAutomatico] [int] NULL,
 CONSTRAINT [PK_LabMovimientoCPT] PRIMARY KEY CLUSTERED
(
	[idMovimiento] ASC,
	[idProductoCPT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPT] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimientoDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LabMovimientoDetalle](
	[idMovimiento] [int] NOT NULL,
	[idProductoCPT] [int] NULL,
	[idProducto] [int] NOT NULL,
	[CantidadFallada] [int] NOT NULL,
	[Cantidad] [int] NOT NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimientoIngresos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabMovimientoIngresos](
	[IdMovimiento] [int] NOT NULL,
	[NroDocumento] [varchar](20) NULL,
	[IdPersonaRecepciona] [int] NULL,
 CONSTRAINT [PK_LabMovimientoIngresos] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimientoLaboratorio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabMovimientoLaboratorio](
	[IdMovimiento] [int] NOT NULL,
	[IdOrden] [int] NOT NULL,
	[CorrelativoAnual] [int] NULL,
	[IdCuentaAtencion] [int] NULL,
	[IdComprobantePago] [int] NULL,
	[idPersonaTomaLab] [int] NULL,
	[idPersonaRecoge] [int] NULL,
	[idDiagnostico] [int] NULL,
	[EsDiagnosticoDefinitivo] [int] NULL,
	[OrdenaPrueba] [varchar](50) NULL,
	[Paciente] [varchar](100) NULL,
	[idTipoSexo] [int] NULL,
	[FechaNacimiento] [datetime] NULL,
	[Eo_FUM] [datetime] NULL,
	[Eo_EG] [int] NULL,
	[colegiatura] [varchar](10) NULL,
 CONSTRAINT [PK_LabMovimientoLaboratorio] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabMovimientoSalidas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LabMovimientoSalidas](
	[IdMovimiento] [int] NOT NULL,
	[IdResponsable] [int] NOT NULL,
	[IdMotivoSalida] [int] NOT NULL,
 CONSTRAINT [PK_LabMovimientoSalidas] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[labPruebas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[labPruebas](
	[idPrueba] [int] IDENTITY(1,1) NOT NULL,
	[CodigoPrueba] [char](6) NOT NULL,
	[CodigoCPT] [char](20) NULL,
 CONSTRAINT [PK_labPruebas] PRIMARY KEY CLUSTERED
(
	[idPrueba] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[labPruebas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabRecojeExamen]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabRecojeExamen](
	[idRecojeExamen] [int] IDENTITY(1,1) NOT NULL,
	[RecojeExamen] [varchar](30) NOT NULL,
 CONSTRAINT [PK_LabRecojeExamen] PRIMARY KEY CLUSTERED
(
	[idRecojeExamen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamen] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabResultado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabResultado](
	[idAnalisis] [varchar](20) NOT NULL,
	[idOrden] [int] NOT NULL,
	[resultadoAnalisis] [text] NOT NULL,
	[realizaAnalisis] [int] NOT NULL,
	[observacionResultado] [text] NULL,
	[idUsuario] [int] NOT NULL,
	[fecha] [datetime] NULL,
 CONSTRAINT [PK_LabResultado] PRIMARY KEY CLUSTERED
(
	[idAnalisis] ASC,
	[idOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabResultado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabResultadoPorItems]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabResultadoPorItems](
	[idOrden] [int] NOT NULL,
	[idProductoCpt] [int] NOT NULL,
	[ordenXresultado] [int] NOT NULL,
	[ValorNumero] [money] NULL,
	[ValorTexto] [varchar](500) NULL,
	[ValorCombo] [varchar](100) NULL,
	[ValorCheck] [varchar](1) NULL,
	[realizaAnalisis] [int] NOT NULL,
	[idUsuario] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[idGrupo] [int] NULL,
	[idItem] [int] NULL,
	[ValorReferencial] [varchar](100) NULL,
	[Metodo] [varchar](50) NULL,
 CONSTRAINT [PK_LabResutadoPorItems] PRIMARY KEY CLUSTERED
(
	[idOrden] ASC,
	[idProductoCpt] ASC,
	[ordenXresultado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoPorItems] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[LabTipoConceptos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[LabTipoConceptos](
	[idTipoConcepto] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [varchar](50) NOT NULL,
 CONSTRAINT [PK_LabTipoConceptos] PRIMARY KEY CLUSTERED
(
	[idTipoConcepto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[LabTipoConceptos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ListBarGrupos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ListBarGrupos](
	[IdListGrupo] [int] NOT NULL,
	[Texto] [varchar](50) NOT NULL,
	[Clave] [varchar](50) NOT NULL,
	[Indice] [int] NOT NULL,
 CONSTRAINT [GUIListBarGrupos_PK] PRIMARY KEY CLUSTERED
(
	[IdListGrupo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ListBarGrupos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ListBarItems]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ListBarItems](
	[IdListItem] [int] IDENTITY(1,1) NOT NULL,
	[Texto] [varchar](50) NOT NULL,
	[Clave] [varchar](50) NOT NULL,
	[IdListGrupo] [int] NOT NULL,
	[Indice] [int] NOT NULL,
	[KeyIcon] [varchar](50) NULL,
 CONSTRAINT [GUIListBarItems_PK] PRIMARY KEY CLUSTERED
(
	[IdListItem] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ListBarItems] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ListBarReporte]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ListBarReporte](
	[idReporte] [int] IDENTITY(1,1) NOT NULL,
	[Reporte] [varchar](255) NOT NULL,
	[id_MenuReporte] [varchar](100) NOT NULL,
	[MODULO] [varchar](50) NOT NULL,
 CONSTRAINT [PK_ListBarReporte] PRIMARY KEY CLUSTERED
(
	[idReporte] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ListBarReporte] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[lolcliProblemasHC]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[lolcliProblemasHC](
	[pacHis] [char](50) NULL,
	[pacPat] [char](30) NULL,
	[pacMat] [char](30) NULL,
	[pacNam] [char](50) NULL,
	[nroHistoriaGalenhos] [varchar](50) NULL,
	[pacfin] [datetime] NULL,
	[autogeneradoGalenHos] [varchar](50) NULL,
	[idPaciente] [int] NULL,
	[DNI] [varchar](14) NULL,
	[FechaNacimiento] [datetime] NULL,
	[idTipoSexo] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[lolcliProblemasHC] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[lolcliUbigeo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[lolcliUbigeo](
	[ubigeoLolcli] [varchar](50) NULL,
	[dptoLolCli] [varchar](50) NULL,
	[provLolCli] [varchar](50) NULL,
	[distritoLolCli] [varchar](50) NULL,
	[idDepartamento] [int] NULL,
	[idprovincia] [int] NULL,
	[idDistrito] [int] NULL,
	[dpto] [varchar](50) NULL,
	[prov] [varchar](50) NULL,
	[distrito] [varchar](50) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[lolcliUbigeo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Medicos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Medicos](
	[IdMedico] [int] IDENTITY(1,1) NOT NULL,
	[Colegiatura] [char](6) NOT NULL,
	[IdEmpleado] [int] NULL,
	[LoteHIS] [varchar](2) NULL,
	[idColegioHIS] [varchar](2) NULL,
	[rne] [varchar](50) NULL,
	[egresado] [bit] NULL,
 CONSTRAINT [Medicos_PK] PRIMARY KEY CLUSTERED
(
	[IdMedico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Medicos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[MedicosEspecialidad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MedicosEspecialidad](
	[IdMedicoEspecialidad] [int] IDENTITY(1,1) NOT NULL,
	[IdEspecialidad] [int] NOT NULL,
	[IdMedico] [int] NOT NULL,
 CONSTRAINT [MedicosEspecialidad_PK] PRIMARY KEY CLUSTERED
(
	[IdMedicoEspecialidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[MensajesEnVentana]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MensajesEnVentana](
	[Ventana] [varchar](50) NOT NULL,
	[Orden] [int] NOT NULL,
	[MensajeAusuario] [varchar](250) NULL,
 CONSTRAINT [PK_MensajesEnVentana] PRIMARY KEY CLUSTERED
(
	[Ventana] ASC,
	[Orden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[MensajesEnVentana] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[MotivosMovimientoHistoria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MotivosMovimientoHistoria](
	[IdMotivo] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [MotivosPrestamoHistoria_PK] PRIMARY KEY CLUSTERED
(
	[IdMotivo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[MovimientosFormatosHistoriaClinica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MovimientosFormatosHistoriaClinica](
	[IdMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[FechaMovimiento] [datetime] NOT NULL,
	[IdMotivo] [int] NOT NULL,
	[Observacion] [varchar](100) NULL,
	[IdServicioOrigen] [int] NULL,
	[IdServicioDestino] [int] NULL,
	[NroFolios] [int] NULL,
	[IdEmpleadoArchivo] [int] NULL,
	[IdEmpleadoTransporte] [int] NULL,
	[IdEmpleadoRecepcion] [int] NULL,
	[IdGrupoMovimiento] [int] NULL,
	[IdAtencion] [int] NULL,
 CONSTRAINT [PK_MovimientosFormatosHistoriaClinica] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[MovimientosHistoriaClinica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[MovimientosHistoriaClinica](
	[IdMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
	[FechaMovimiento] [datetime] NOT NULL,
	[IdMotivo] [int] NOT NULL,
	[Observacion] [varchar](100) NULL,
	[IdServicioOrigen] [int] NULL,
	[IdServicioDestino] [int] NULL,
	[NroFolios] [int] NULL,
	[IdEmpleadoArchivo] [int] NULL,
	[IdEmpleadoTransporte] [int] NULL,
	[IdEmpleadoRecepcion] [int] NULL,
	[IdGrupoMovimiento] [int] NULL,
	[IdAtencion] [int] NULL,
 CONSTRAINT [PrestamosHistoriaClinica_PK] PRIMARY KEY CLUSTERED
(
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[NotaCreditoDebito]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NotaCreditoDebito](
	[IdNota] [int] IDENTITY(1,1) NOT NULL,
	[IdComprobantePago] [int] NULL,
	[IdTipoNota] [int] NULL,
	[NroSerie] [nvarchar](4) NULL,
	[NroDocumento] [varchar](12) NULL,
	[RazonSocial] [varchar](50) NULL,
	[RUC] [char](11) NULL,
	[SubTotal] [money] NULL,
	[IGV] [money] NULL,
	[Total] [money] NOT NULL,
	[IdUsuarioAutoriza] [int] NULL,
	[FechaAprueba] [datetime] NULL,
	[TipoCambio] [money] NULL,
	[Observaciones] [varchar](500) NULL,
	[IdEstadoNota] [int] NULL,
	[FechaPagado] [datetime] NULL,
	[IdGestionCaja] [int] NULL,
	[IdPaciente] [int] NULL,
	[IdCajero] [int] NULL,
	[idTurno] [int] NULL,
	[idCaja] [int] NULL,
	[idFarmacia] [int] NULL,
	[idMotivo] [int] NULL,
	[Direccion] [varchar](50) NULL,
	[TipoAnulacion] [bit] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebito] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[NotaCreditoDebitoEstadoNota]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NotaCreditoDebitoEstadoNota](
	[IdEstado] [int] NULL,
	[EstadoNota] [varchar](50) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoEstadoNota] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[NotaCreditoDebitoMotivo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NotaCreditoDebitoMotivo](
	[IdMotivo] [int] NULL,
	[Motivo] [varchar](50) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoMotivo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[NotaCreditoDebitoTipoNota]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[NotaCreditoDebitoTipoNota](
	[IdTipoNota] [int] NULL,
	[TipoNota] [varchar](50) NULL,
	[NroSerie] [nvarchar](4) NULL,
	[NroDocumento] [char](12) NULL,
	[NroDocumentoInicial] [char](12) NULL,
	[NroDocumentoFinal] [char](12) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoTipoNota] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[OPCS]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[OPCS](
	[IdOPCS] [int] NOT NULL,
	[Codigo] [char](7) NULL,
	[Descripcion] [varchar](255) NULL,
 CONSTRAINT [OPCS_PK] PRIMARY KEY CLUSTERED
(
	[IdOPCS] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[OPCS] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Pacientes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Pacientes](
	[IdPaciente] [int] IDENTITY(1,1) NOT NULL,
	[ApellidoPaterno] [varchar](40) NULL,
	[ApellidoMaterno] [varchar](40) NULL,
	[PrimerNombre] [varchar](40) NULL,
	[SegundoNombre] [varchar](40) NULL,
	[TercerNombre] [varchar](40) NULL,
	[FechaNacimiento] [datetime] NULL,
	[NroDocumento] [varchar](12) NULL,
	[Telefono] [varchar](10) NULL,
	[DireccionDomicilio] [varchar](100) NULL,
	[Autogenerado] [varchar](30) NULL,
	[IdTipoSexo] [int] NULL,
	[IdProcedencia] [int] NULL,
	[IdGradoInstruccion] [int] NULL,
	[IdEstadoCivil] [int] NULL,
	[IdDocIdentidad] [int] NULL,
	[IdTipoOcupacion] [int] NULL,
	[IdCentroPobladoNacimiento] [int] NULL,
	[IdCentroPobladoDomicilio] [int] NULL,
	[NombrePadre] [varchar](20) NULL,
	[NombreMadre] [varchar](20) NULL,
	[NroHistoriaClinica] [int] NULL,
	[IdTipoNumeracion] [int] NULL,
	[IdCentroPobladoProcedencia] [int] NULL,
	[Observacion] [varchar](150) NULL,
	[IdPaisDomicilio] [int] NULL,
	[IdPaisProcedencia] [int] NULL,
	[IdPaisNacimiento] [int] NULL,
	[IdDistritoProcedencia] [int] NULL,
	[IdDistritoDomicilio] [int] NULL,
	[IdDistritoNacimiento] [int] NULL,
	[FichaFamiliar] [varchar](20) NULL,
	[IdEtnia] [varchar](2) NULL,
	[GrupoSanguineo] [varchar](10) NULL,
	[FactorRh] [varchar](10) NULL,
	[UsoWebReniec] [bit] NULL,
	[idIdioma] [int] NULL,
	[Email] [varchar](50) NULL,
	[madreDocumento] [varchar](12) NULL,
	[madreApellidoPaterno] [varchar](20) NULL,
	[madreApellidoMaterno] [varchar](20) NULL,
	[madrePrimerNombre] [varchar](20) NULL,
	[madreSegundoNombre] [varchar](20) NULL,
	[NroOrdenHijo] [int] NULL,
	[madreTipoDocumento] [int] NULL,
	[Sector] [varchar](2) NULL,
	[Sectorista] [int] NULL,
	[validacionReniec] [bit] NOT NULL,
 CONSTRAINT [Pacientes_PK] PRIMARY KEY CLUSTERED
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Pacientes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PacientesDatosAdicionales]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PacientesDatosAdicionales](
	[idPaciente] [int] NOT NULL,
	[antecedentes] [varchar](1000) NULL,
	[antecedAlergico] [varchar](1000) NULL,
	[antecedObstetrico] [varchar](1000) NULL,
	[antecedQuirurgico] [varchar](1000) NULL,
	[antecedFamiliar] [varchar](1000) NULL,
	[antecedPatologico] [varchar](1000) NULL,
	[FNacimientoCalculada] [bit] NULL,
 CONSTRAINT [PK_PacientesDatosAdicionales] PRIMARY KEY CLUSTERED
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionales] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PacientesMovimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PacientesMovimientos](
	[IdCuentaAtencion] [int] NOT NULL,
	[Peso] [money] NULL,
	[Talla] [money] NULL,
	[idDxNutricional] [int] NULL,
	[GrafXedadEnMeses] [int] NULL,
	[GrafYpercentilTE] [int] NULL,
	[GrafYpercentilPT] [int] NULL,
	[GrafYpercentilPE] [int] NULL,
	[ZetaPT] [money] NULL,
	[ZetaTE] [money] NULL,
	[ZetaPE] [money] NULL,
	[Hemoglobina] [money] NULL,
	[Parasitosis] [varchar](2) NULL,
 CONSTRAINT [PK_PacientesMovimientos] PRIMARY KEY CLUSTERED
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PacientesMovimientosDx]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PacientesMovimientosDx](
	[idDxNutricional] [int] NOT NULL,
	[DxNutricional] [varchar](200) NOT NULL,
 CONSTRAINT [PK_PacientesMovimientosDx] PRIMARY KEY CLUSTERED
(
	[idDxNutricional] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosDx] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PadronNominal_Detalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PadronNominal_Detalle](
	[IdPaNomDetalle] [int] IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
	[IdTipoDoc] [int] NULL,
	[NumDocumento] [int] NULL,
	[HistClinica] [varchar](10) NOT NULL,
	[ApellidoPaterno] [varchar](20) NOT NULL,
	[ApellidoMaterno] [varchar](20) NOT NULL,
	[Nombres] [varchar](40) NOT NULL,
	[idSexo] [int] NOT NULL,
	[FecNacimiento] [varchar](10) NOT NULL,
	[IdTipoSeguro] [int] NULL,
	[NumAfiliacion] [varchar](10) NULL,
	[FecEvaluacion] [varchar](10) NOT NULL,
	[Peso] [varchar](5) NOT NULL,
	[Talla] [varchar](3) NOT NULL,
	[IdDiagNutricional] [int] NULL,
	[CodRenaes] [int] NULL,
	[IdDiagPE] [int] NOT NULL,
	[IdDiagPT] [int] NOT NULL,
	[IdDiagTE] [int] NOT NULL,
	[hemoglobina] [int] NULL,
	[heces] [varchar](2) NULL,
	[renaes] [varchar](10) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_Detalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[padronnominal_dxnutricional]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[padronnominal_dxnutricional](
	[iddiagnostico] [int] NULL,
	[LabReferencia] [varchar](8) NULL,
	[RangoInicial] [money] NULL,
	[RangoFinal] [money] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[padronnominal_dxnutricional] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PadronNominal_DxNutriTemp]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PadronNominal_DxNutriTemp](
	[IdpadNomFormulario] [int] NOT NULL,
	[Descripcion] [varchar](100) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DxNutriTemp] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Paises]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Paises](
	[IdPais] [int] NOT NULL,
	[Codigo] [char](3) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[codigoPostal] [varchar](5) NULL,
	[IndFlag] [bit] NULL,
 CONSTRAINT [Paises_PK] PRIMARY KEY CLUSTERED
(
	[IdPais] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Paises] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Parametros]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Parametros](
	[IdParametro] [int] NOT NULL,
	[Tipo] [varchar](20) NOT NULL,
	[Codigo] [varchar](20) NULL,
	[ValorTexto] [varchar](355) NULL,
	[ValorInt] [int] NULL,
	[ValorFloat] [float] NULL,
	[Descripcion] [varchar](150) NULL,
	[Grupo] [varchar](30) NULL,
 CONSTRAINT [Parametros_PK] PRIMARY KEY CLUSTERED
(
	[IdParametro] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Parametros] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalAtencion](
	[idPerinatalAtencion] [int] IDENTITY(1,1) NOT NULL,
	[idPaciente] [int] NOT NULL,
	[idModulo] [int] NOT NULL,
	[GrafXedadEnMeses] [int] NULL,
	[GrafYpercentilTE] [int] NULL,
	[GrafYpercentilPT] [int] NULL,
	[GrafYpercentilPE] [int] NULL,
	[GrafYimc] [money] NULL,
	[FechaAtencion] [datetime] NULL,
	[CredN] [int] NULL,
 CONSTRAINT [PK_PerinatalAtencion] PRIMARY KEY CLUSTERED
(
	[idPerinatalAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionCred]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalAtencionCred](
	[idPerinatalAtencion] [int] NOT NULL,
	[EdadEnAnios] [varchar](10) NOT NULL,
	[CredNumero] [int] NOT NULL,
	[CredCheck] [varchar](1) NOT NULL,
	[idAtencion] [int] NULL,
 CONSTRAINT [PK_PerinatalAtencionCRED] PRIMARY KEY CLUSTERED
(
	[idPerinatalAtencion] ASC,
	[EdadEnAnios] ASC,
	[CredNumero] ASC,
	[CredCheck] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionCred1]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalAtencionCred1](
	[idPerinatalAtencion] [int] NOT NULL,
	[idModulo] [int] NULL,
	[EstimulacionTemprana] [bit] NULL,
	[AlimentacionComplementaria] [bit] NULL,
	[LactanciaMaterna] [bit] NULL,
	[PersonalSalud] [bit] NULL,
	[DemandaIndividual] [bit] NULL,
	[MujerEdadReproductiva] [bit] NULL,
	[MujerGestante] [bit] NULL,
	[idAtencion] [int] NULL,
	[LactanciaMaternaComp] [bit] NULL,
 CONSTRAINT [PK_PerinatalAtencionCred1] PRIMARY KEY CLUSTERED
(
	[idPerinatalAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalAtencionDiagnosticos](
	[idPerinatalAtencion] [int] NOT NULL,
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idDiagnostico] [int] NOT NULL,
	[CodigoHIS] [varchar](7) NULL,
	[idAtencion] [int] NULL,
	[labConfHIS] [varchar](3) NULL,
	[IdClasificacionDx] [int] NOT NULL,
	[IdSubclasificacionDx] [int] NOT NULL,
	[ItemDiagnostico] [int] NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionDiaria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalAtencionDiaria](
	[idPerinatalAtencion] [int] NOT NULL,
	[idAtencion] [int] NOT NULL,
 CONSTRAINT [PK_PerinatalAtencionDiaria] PRIMARY KEY CLUSTERED
(
	[idPerinatalAtencion] ASC,
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiaria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionMedicamentos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalAtencionMedicamentos](
	[idPerinatalAtencion] [int] NOT NULL,
	[idModulo] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[idAtencion] [int] NULL,
 CONSTRAINT [PK_PerinatalAtencionMedicamentos] PRIMARY KEY CLUSTERED
(
	[idPerinatalAtencion] ASC,
	[idModulo] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalAtencionProcedimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalAtencionProcedimientos](
	[idPerinatalAtencion] [int] NOT NULL,
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[CptEsAutomatico] [bit] NULL,
	[CodigoHIS] [varchar](7) NULL,
	[idAtencion] [int] NULL,
	[labConfHIS] [varchar](3) NULL,
	[ItemProcedimiento] [int] NOT NULL,
	[IdOrden] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalCatalogoCie10]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalCatalogoCie10](
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idDiagnostico] [int] NOT NULL,
	[RangoInicio] [money] NULL,
	[RangoFinal] [money] NULL,
	[CodigoHIS] [varchar](7) NULL,
	[LabHis] [varchar](20) NULL,
	[TipoDx] [varchar](6) NULL,
 CONSTRAINT [PK_PerinatalCatalogoDiagnosticos] PRIMARY KEY CLUSTERED
(
	[idModulo] ASC,
	[idLista] ASC,
	[idDiagnostico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCie10] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalCatalogoCpt]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalCatalogoCpt](
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[CodigoHIS] [varchar](7) NULL,
 CONSTRAINT [PK_PerinatalCatalogoDeProcedimientos] PRIMARY KEY CLUSTERED
(
	[idModulo] ASC,
	[idLista] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCpt] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalCatalogoCptAutomaticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalCatalogoCptAutomaticos](
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[idProductoAutomatico] [int] NOT NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptAutomaticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalCatalogoCptMaximaDosis]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalCatalogoCptMaximaDosis](
	[idModulo] [int] NOT NULL,
	[idLista] [int] NOT NULL,
	[idProducto] [int] NOT NULL,
	[Limite] [int] NOT NULL,
	[EdadInicial] [int] NOT NULL,
	[EdadFinal] [int] NOT NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptMaximaDosis] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalCatalogoMedicamentos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PerinatalCatalogoMedicamentos](
	[idModulo] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[Cantidad] [int] NOT NULL,
 CONSTRAINT [PK_PerinatalCatalogoMedicamentos] PRIMARY KEY CLUSTERED
(
	[idModulo] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoMedicamentos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalListas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalListas](
	[idLista] [int] NOT NULL,
	[Lista] [varchar](50) NOT NULL,
 CONSTRAINT [PK_PerinatalListas] PRIMARY KEY CLUSTERED
(
	[idLista] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalListas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PerinatalModulos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PerinatalModulos](
	[idModulo] [int] NOT NULL,
	[Modulo] [varchar](100) NOT NULL,
	[AniosDesde] [int] NULL,
	[AniosHasta] [int] NULL,
 CONSTRAINT [PK_PerinatalModulos] PRIMARY KEY CLUSTERED
(
	[idModulo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalModulos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[PeriodoTiempo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[PeriodoTiempo](
	[IdPeriodoTiempo] [int] IDENTITY(1,1) NOT NULL,
	[PeriodoTiempo] [varchar](20) NULL,
 CONSTRAINT [PK_PeriodoTiempo] PRIMARY KEY CLUSTERED
(
	[IdPeriodoTiempo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[PeriodoTiempo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Permisos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Permisos](
	[IdPermiso] [int] NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[Modulo] [varchar](50) NULL,
 CONSTRAINT [Permisos_PK] PRIMARY KEY CLUSTERED
(
	[IdPermiso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Permisos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProCabecera](
	[IdPrograma] [int] NOT NULL,
	[IdProcabecera] [int] IDENTITY(1,1) NOT NULL,
	[IdPaciente] [int] NOT NULL,
 CONSTRAINT [PK_ProCabecera] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProcabecera] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProCabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCabeceraConfigDatos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProCabeceraConfigDatos](
	[IdPrograma] [int] NOT NULL,
	[IdCabDato] [int] NOT NULL,
	[Cab_Texto] [varchar](200) NULL,
	[Cab_Tipo] [varchar](200) NULL,
	[Cab_Ancho] [int] NULL,
	[Cab_EsDatoObligatorio] [int] NULL,
	[Cab_TextoToolTip] [varchar](200) NULL,
	[Cab_EsDatoCalculado] [bit] NULL,
	[Cab_FormulaCalculaValor] [varchar](200) NULL,
	[Cab_EsDatoCalculador] [bit] NULL,
	[Cab_RangoInicial] [int] NULL,
	[Cab_RangoFinal] [int] NULL,
	[Cab_Fila] [int] NULL,
	[Cab_Columna] [int] NULL,
 CONSTRAINT [PK_ProCabeceraConfigDatos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdCabDato] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraConfigDatos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCabeceraDato]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProCabeceraDato](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdCabDato] [int] NOT NULL,
	[CabDato] [varchar](200) NULL,
 CONSTRAINT [PK_ProCabeceraDato] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProCabecera] ASC,
	[IdCabDato] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraDato] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCatalogoControles]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProCatalogoControles](
	[IdPrograma] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[Descripcion] [varchar](200) NULL,
 CONSTRAINT [PK_ProCatalogoControles] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdControl] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoControles] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCatalogoDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProCatalogoDiagnosticos](
	[IdPrograma] [int] NOT NULL,
	[IdDiagnostico] [int] NOT NULL,
 CONSTRAINT [PK_ProCatalogoDiagnosticos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdDiagnostico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCatalogoProcedimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProCatalogoProcedimientos](
	[IdPrograma] [int] NOT NULL,
	[IdDiagnostico] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
 CONSTRAINT [PK_ProCatalogoProcedimientos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdDiagnostico] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoProcedimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProCatalogoTratamientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProCatalogoTratamientos](
	[IdPrograma] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
 CONSTRAINT [PK_ProCatalogoTratamientos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoTratamientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProControlConfigDatos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProControlConfigDatos](
	[IdPrograma] [int] NOT NULL,
	[IdControlDato] [int] NOT NULL,
	[Control_Texto] [varchar](200) NULL,
	[Control_Tipo] [varchar](200) NULL,
	[Control_Ancho] [int] NULL,
	[Control_EsDatoObligatorio] [bit] NULL,
	[Control_TextoToolTip] [varchar](200) NULL,
	[Control_EsPresion] [bit] NULL,
	[Control_EsPeso] [bit] NULL,
	[Control_EsTalla] [bit] NULL,
	[Control_EsDatoCalculado] [bit] NULL,
	[Control_FormulaCalculaValor] [varchar](200) NULL,
	[Control_EsDatoGrafico] [bit] NULL,
	[Control_EsGraficoEjeX] [bit] NULL,
	[Control_Fila] [int] NOT NULL,
	[Control_Columna] [int] NOT NULL,
 CONSTRAINT [PK_ProControlConfigDatos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdControlDato] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProControlConfigDatos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProControlDato]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProControlDato](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[IdControlDato] [int] NOT NULL,
	[ControlDato] [varchar](200) NULL,
 CONSTRAINT [PK_ProControlDato] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProCabecera] ASC,
	[IdControl] ASC,
	[IdControlDato] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDato] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProControles]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProControles](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[IdAtencion] [int] NULL,
	[FechaControl] [nvarchar](10) NULL,
	[ControlOtroEESS] [bit] NOT NULL,
	[IdEstablecimiento] [int] NULL,
 CONSTRAINT [PK_ProControles] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProCabecera] ASC,
	[IdControl] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProControles] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProDiagnosticos](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[IdDiagnostico] [int] NOT NULL,
	[Principal] [bit] NULL,
	[labConfHIS] [varchar](3) NULL,
	[IdSubClasificacionDX] [int] NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProductosHis]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProductosHis](
	[IdProductoHis] [int] NOT NULL,
	[EsCpt] [varchar](1) NOT NULL,
	[CodigoProductoHis] [varchar](20) NOT NULL,
 CONSTRAINT [PK_ProductosHis] PRIMARY KEY CLUSTERED
(
	[IdProductoHis] ASC,
	[EsCpt] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProductosHis] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProgramacionMedica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProgramacionMedica](
	[IdProgramacion] [int] IDENTITY(1,1) NOT NULL,
	[IdMedico] [int] NOT NULL,
	[IdDepartamento] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[HoraInicio] [char](5) NOT NULL,
	[HoraFin] [char](5) NOT NULL,
	[IdTipoProgramacion] [int] NOT NULL,
	[Descripcion] [varchar](100) NULL,
	[IdTurno] [int] NULL,
	[IdEspecialidad] [int] NULL,
	[Color] [int] NULL,
	[IdServicio] [int] NULL,
	[IdTipoServicio] [int] NULL,
	[FechaReg] [datetime] NULL,
	[TiempoPromedioAtencion] [int] NULL,
	[HoraFinProgramacion] [char](5) NULL,
 CONSTRAINT [ProgramacionMedica_PK] PRIMARY KEY NONCLUSTERED
(
	[IdProgramacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Programas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Programas](
	[IdPrograma] [int] NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
 CONSTRAINT [PK_Programas] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Programas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProProcedimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ProProcedimientos](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[IdDiagnostico] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
	[IdResultado] [int] NULL,
	[labConfHIS] [varchar](3) NULL,
 CONSTRAINT [PK_ProProcedimientos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProCabecera] ASC,
	[IdControl] ASC,
	[IdDiagnostico] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ProTratamientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProTratamientos](
	[IdPrograma] [int] NOT NULL,
	[IdProCabecera] [int] NOT NULL,
	[IdControl] [int] NOT NULL,
	[IdProducto] [int] NOT NULL,
 CONSTRAINT [PK_ProTratamientos] PRIMARY KEY CLUSTERED
(
	[IdPrograma] ASC,
	[IdProCabecera] ASC,
	[IdControl] ASC,
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ProTratamientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Proveedores]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Proveedores](
	[idProveedor] [int] IDENTITY(1,1) NOT NULL,
	[Ruc] [varchar](11) NOT NULL,
	[RazonSocial] [varchar](100) NOT NULL,
	[email] [varchar](100) NULL,
	[direccion] [varchar](100) NULL,
 CONSTRAINT [PK_Proveedores] PRIMARY KEY CLUSTERED
(
	[idProveedor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Proveedores] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Provincias]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Provincias](
	[IdProvincia] [int] NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[IdDepartamento] [int] NOT NULL,
	[IdReniec] [int] NULL,
 CONSTRAINT [Provincias_PK] PRIMARY KEY CLUSTERED
(
	[IdProvincia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Provincias] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaCabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaCabecera](
	[idReceta] [int] IDENTITY(1,1) NOT NULL,
	[IdPuntoCarga] [int] NOT NULL,
	[FechaReceta] [datetime] NOT NULL,
	[idCuentaAtencion] [int] NOT NULL,
	[idServicioReceta] [int] NOT NULL,
	[idEstado] [int] NOT NULL,
	[DocumentoDespacho] [varchar](20) NULL,
	[idComprobantePago] [int] NULL,
	[idMedicoReceta] [int] NULL,
	[fechaVigencia] [datetime] NULL,
 CONSTRAINT [PK_RecetaCabecera] PRIMARY KEY CLUSTERED
(
	[idReceta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaClasificacionViasAdmin]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaClasificacionViasAdmin](
	[IdCategoria] [int] NOT NULL,
	[Categoria] [varchar](50) NULL,
 CONSTRAINT [PK_RecetaClasificacionViasAdmin] PRIMARY KEY CLUSTERED
(
	[IdCategoria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaClasificacionViasAdmin] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaDetalle](
	[idReceta] [int] NOT NULL,
	[idItem] [int] NOT NULL,
	[CantidadPedida] [int] NOT NULL,
	[Precio] [money] NOT NULL,
	[Total] [money] NOT NULL,
	[SaldoEnRegistroReceta] [int] NULL,
	[SaldoEnDespachoReceta] [int] NULL,
	[CantidadDespachada] [int] NULL,
	[idDosisRecetada] [int] NULL,
	[idEstadoDetalle] [int] NULL,
	[MotivoAnulacionMedico] [varchar](300) NULL,
	[observaciones] [varchar](300) NULL,
	[IdViaAdministracion] [int] NULL,
	[dx] [varchar](20) NULL,
	[idPuntoCarga] [int] NULL,
 CONSTRAINT [PK_RecetaDetalle] PRIMARY KEY CLUSTERED
(
	[idReceta] ASC,
	[idItem] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaDetalleItem]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaDetalleItem](
	[idReceta] [int] NOT NULL,
	[idItem] [int] NOT NULL,
	[DocumentoDespacho] [varchar](20) NOT NULL,
	[CantidadDespachada] [int] NOT NULL,
	[idComprobantePago] [int] NULL,
	[idEstado] [int] NULL,
 CONSTRAINT [PK_RecetaDetalleItem] PRIMARY KEY CLUSTERED
(
	[idReceta] ASC,
	[idItem] ASC,
	[DocumentoDespacho] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItem] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaDosis]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaDosis](
	[idDosis] [int] NOT NULL,
	[NumeroDosis] [varchar](50) NOT NULL,
 CONSTRAINT [PK_RecetaDosis] PRIMARY KEY CLUSTERED
(
	[idDosis] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDosis] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaEstados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaEstados](
	[idEstado] [int] NOT NULL,
	[Estado] [varchar](30) NOT NULL,
 CONSTRAINT [PK_RecetaEstados] PRIMARY KEY CLUSTERED
(
	[idEstado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaEstados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaEstadosDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaEstadosDetalle](
	[idEstadoDetalle] [int] NOT NULL,
	[Estado] [varchar](30) NOT NULL,
 CONSTRAINT [PK_RecetaEstadosDetalle] PRIMARY KEY CLUSTERED
(
	[idEstadoDetalle] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaEstadosDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RecetaViaAdministracion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RecetaViaAdministracion](
	[IdViaAdministracion] [int] NOT NULL,
	[Descripcion] [varchar](100) NULL,
	[IdCategoria] [int] NOT NULL,
 CONSTRAINT [PK_RecetaViaAdministracion] PRIMARY KEY CLUSTERED
(
	[IdViaAdministracion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[RecetaViaAdministracion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Reporte]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Reporte](
	[NroHistoriaClinica] [int] NULL,
	[ApellidoPaterno] [varchar](20) NOT NULL,
	[ApellidoMaterno] [varchar](20) NOT NULL,
	[PrimerNombre] [varchar](20) NOT NULL,
	[SegundoNombre] [varchar](20) NULL,
	[Sexo] [varchar](50) NOT NULL,
	[Edad] [int] NOT NULL,
	[FechaIngreso] [datetime] NOT NULL,
	[HoraIngreso] [char](5) NOT NULL,
	[FechaEgreso] [datetime] NULL,
	[HoraEgreso] [char](5) NULL,
	[Condición Alta] [varchar](50) NOT NULL,
	[Cod. Serv. Ing] [varchar](6) NOT NULL,
	[Servicio Ingreso] [varchar](50) NOT NULL,
	[Cod. Serv. Egr] [varchar](6) NOT NULL,
	[Servicio Egreso] [varchar](50) NOT NULL,
	[CodigoCIE10_Diagn] [char](7) NULL,
	[Diagnóstico] [varchar](250) NOT NULL,
	[CodigoCPT2004] [char](7) NOT NULL,
	[Descripción Procedimiento] [varchar](250) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Reporte] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[reporte_cabecera]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[reporte_cabecera](
	[idUsuario] [int] NULL,
	[NroCuenta] [int] NOT NULL,
	[FechaIngreso] [datetime] NULL,
	[HoraIngreso] [varchar](5) NULL,
	[Paciente] [varchar](100) NULL,
	[Sexo] [varchar](1) NULL,
	[Motivo] [varchar](100) NULL,
	[Estancia] [varchar](100) NULL,
	[FechaEgreso] [datetime] NULL,
	[HoraEgreso] [varchar](5) NULL,
	[Destino] [varchar](100) NULL,
	[Recibe] [varchar](100) NULL,
	[MedicoIE] [varchar](100) NULL,
	[idServicio] [int] NULL,
	[ServicioHosp] [varchar](100) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[reporte_cabecera] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[reporte_detalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[reporte_detalle](
	[idUsuario] [int] NULL,
	[NroCuenta] [int] NULL,
	[ConsumoDescripcion] [varchar](100) NULL,
	[ConsumoImporte] [money] NULL,
	[DevolucionHC] [varchar](50) NULL,
	[dia1] [int] NULL,
	[dia2] [int] NULL,
	[dia3] [int] NULL,
	[dia4] [int] NULL,
	[dia5] [int] NULL,
	[dia6] [int] NULL,
	[dia7] [int] NULL,
	[dia8] [int] NULL,
	[dia9] [int] NULL,
	[dia10] [int] NULL,
	[dia11] [int] NULL,
	[dia12] [int] NULL,
	[dia13] [int] NULL,
	[dia14] [int] NULL,
	[dia15] [int] NULL,
	[dia16] [int] NULL,
	[dia17] [int] NULL,
	[dia18] [int] NULL,
	[dia19] [int] NULL,
	[dia20] [int] NULL,
	[dia21] [int] NULL,
	[dia22] [int] NULL,
	[dia23] [int] NULL,
	[dia24] [int] NULL,
	[dia25] [int] NULL,
	[dia26] [int] NULL,
	[dia27] [int] NULL,
	[dia28] [int] NULL,
	[dia29] [int] NULL,
	[dia30] [int] NULL,
	[dia31] [int] NULL,
	[total] [int] NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[reporte_detalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[reporte5]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[reporte5](
	[idPaciente] [int] NOT NULL,
	[ApellidoPaterno] [varchar](40) NULL,
	[ApellidoMaterno] [varchar](40) NULL,
	[PrimerNombre] [varchar](40) NULL,
	[SegundoNombre] [varchar](40) NULL,
	[NroHistoriaClinica] [int] NOT NULL,
	[seProceso] [int] NULL,
	[paciente] [varchar](120) NOT NULL,
	[NroDocumento] [varchar](12) NULL,
	[IdDocIdentidad] [int] NULL,
	[autogenerado] [varchar](30) NULL,
	[FechaNacimiento] [datetime] NULL,
	[idTipoSexo] [int] NULL,
 CONSTRAINT [PK_reporte5] PRIMARY KEY CLUSTERED
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[reporte5] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Roles]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Roles](
	[IdRol] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
 CONSTRAINT [SeguridadGrupos_PK] PRIMARY KEY CLUSTERED
(
	[IdRol] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Roles] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RolesItems]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RolesItems](
	[IdRolItem] [int] IDENTITY(1,1) NOT NULL,
	[IdListItem] [int] NULL,
	[IdRol] [int] NULL,
	[Agregar] [bit] NULL,
	[Modificar] [bit] NULL,
	[Eliminar] [bit] NULL,
	[Consultar] [bit] NULL,
 CONSTRAINT [SeguridadGruposPermisos_PK] PRIMARY KEY CLUSTERED
(
	[IdRolItem] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[RolesItems] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RolesPermisos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RolesPermisos](
	[IdRolPermiso] [int] IDENTITY(1,1) NOT NULL,
	[IdPermiso] [int] NULL,
	[IdRol] [int] NULL,
 CONSTRAINT [RolesPermisos_PK] PRIMARY KEY CLUSTERED
(
	[IdRolPermiso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[RolesReportes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RolesReportes](
	[idRol] [int] NOT NULL,
	[IdReporte] [int] NOT NULL,
	[TieneAcceso] [bit] NULL,
 CONSTRAINT [PK_RolesReportes] PRIMARY KEY CLUSTERED
(
	[idRol] ASC,
	[IdReporte] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Servicios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Servicios](
	[IdServicio] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[IdEspecialidad] [int] NOT NULL,
	[IdTipoServicio] [int] NOT NULL,
	[Codigo] [varchar](6) NOT NULL,
	[SVG] [varchar](8000) NULL,
	[IdProducto] [int] NULL,
	[soloTipoSexo] [int] NULL,
	[maximaEdad] [int] NULL,
	[codigoServicioSEM] [varchar](10) NULL,
	[ubicacionSEM] [varchar](5) NULL,
	[codigoServicioHIS] [varchar](6) NULL,
	[CostoCeroCE] [varchar](1) NULL,
	[MinimaEdad] [int] NULL,
	[idEstado] [int] NULL,
	[Triaje] [bit] NULL,
	[EsObservacionEmergencia] [bit] NULL,
	[UsaModuloNinoSano] [bit] NULL,
	[UsaModuloMaterno] [bit] NULL,
	[UsaGalenHos] [bit] NULL,
	[TipoEdad] [int] NULL,
	[UsaFUA] [bit] NULL,
	[codigoServicioSuSalud] [varchar](7) NULL,
	[codigoServicioFUA] [varchar](6) NULL,
	[FuaTipoAnexo2015] [int] NULL,
	[MaxCuposCitasAdelantadas] [int] NULL,
	[MaxCuposAdicionales] [int] NULL,
	[usaNacimiento] [int] NULL,
	[MaxCuposCitasHoySIS] [int] NULL,
	[MaxCuposCitasAdelandatasSIS] [int] NULL,
	[emergenciaCorrelativo] [varchar](10) NULL,
	[NoUsaMensajeTexto] [int] NULL,
 CONSTRAINT [Servicios_PK] PRIMARY KEY CLUSTERED
(
	[IdServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Servicios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ServiciosAtenSimultanea]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ServiciosAtenSimultanea](
	[idServicio] [int] NOT NULL,
	[idServicioAtencionSimultanea] [int] NOT NULL,
 CONSTRAINT [PK_ServiciosAtencionSimultaneo] PRIMARY KEY CLUSTERED
(
	[idServicio] ASC,
	[idServicioAtencionSimultanea] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultanea] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ServiciosAtenSimultaneaFua]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ServiciosAtenSimultaneaFua](
	[AScorrelativo] [char](10) NOT NULL,
	[idAtencion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[idTipo] [int] NOT NULL,
	[idFuaCorrelativo] [int] NOT NULL,
	[idFuaIdCuentaAtencion] [int] NULL,
	[FuaCodigoPrestacion] [varchar](3) NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFua] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ServiciosAtenSimultaneaFuaEquiv]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ServiciosAtenSimultaneaFuaEquiv](
	[Id] [int] NOT NULL,
	[ups] [varchar](6) NOT NULL,
	[EdadInicio] [int] NOT NULL,
	[EdadFinal] [int] NOT NULL,
	[idTipoEdad] [int] NOT NULL,
	[FuaCodigoPrestacion] [varchar](3) NOT NULL,
	[DxTipo] [varchar](1) NOT NULL,
	[DxCodigo] [varchar](20) NOT NULL,
	[PesoKgMenor] [money] NOT NULL,
	[PesoKgMayor] [money] NOT NULL,
 CONSTRAINT [PK_ServiciosAtenSimultaneaFuaEquiv] PRIMARY KEY CLUSTERED
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaEquiv] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ServiciosAtenSimultaneaImpHIS]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ServiciosAtenSimultaneaImpHIS](
	[ups] [varchar](6) NOT NULL,
	[grupo] [int] NOT NULL,
	[subgrupo] [int] NOT NULL,
	[subgrupoOrden] [int] NULL,
	[Lab] [varchar](3) NULL,
	[cpt_dx] [varchar](20) NOT NULL,
	[idTipo] [int] NOT NULL,
	[EdadInicio] [int] NOT NULL,
	[EdadFinal] [int] NOT NULL,
	[idTipoEdad] [int] NOT NULL,
	[PesoKgMenor] [money] NOT NULL,
	[PesoKgMayor] [money] NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaImpHIS] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[ServiciosAtenSimultaneaMov]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ServiciosAtenSimultaneaMov](
	[AScorrelativo] [int] NOT NULL,
	[IdAtencion] [int] NOT NULL,
 CONSTRAINT [PK_ServiciosAtenSimultaneaMov] PRIMARY KEY CLUSTERED
(
	[AScorrelativo] ASC,
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMov] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SiCitas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SiCitas](
	[idCitaSI] [int] IDENTITY(1,1) NOT NULL,
	[idPuntoCarga] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[horaInicio] [varchar](5) NOT NULL,
	[HoraFinal] [varchar](5) NOT NULL,
	[idCuentaAtencion] [int] NULL,
	[idComprobantePago] [int] NULL,
	[idReceta] [int] NULL,
	[Paciente] [varchar](100) NOT NULL,
	[idTipoSexo] [int] NULL,
	[FechaNacimiento] [datetime] NULL,
	[idPaciente] [int] NULL,
	[idMedico] [int] NULL,
	[idMovimiento] [int] NULL,
	[idUsuario] [int] NOT NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[idEstado] [int] NOT NULL,
	[idSala] [int] NULL,
	[llaveTicket] [varchar](20) NULL,
	[Cupo] [int] NULL,
	[telefono] [varchar](10) NULL,
	[direccion] [varchar](100) NULL,
	[idProgramacion] [int] NULL,
	[idResponsable] [int] NULL,
 CONSTRAINT [PK_SiCitas] PRIMARY KEY CLUSTERED
(
	[idCitaSI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SiCitas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SiCitasDetalle]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SiCitasDetalle](
	[idCitaSI] [int] NOT NULL,
	[idProductoCpt] [int] NOT NULL,
	[cantidad] [int] NOT NULL,
	[precio] [money] NOT NULL,
	[observaciones] [varchar](200) NULL,
	[llaveTicket] [varchar](20) NULL,
 CONSTRAINT [PK_SiCitasDetalle] PRIMARY KEY CLUSTERED
(
	[idCitaSI] ASC,
	[idProductoCpt] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalle] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SiCitasSalas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SiCitasSalas](
	[idSala] [int] NOT NULL,
	[Sala] [varchar](50) NOT NULL,
	[idPuntoCarga] [int] NOT NULL,
 CONSTRAINT [PK_SiCitasSalas] PRIMARY KEY CLUSTERED
(
	[idSala] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSalas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SiFechasNoLaborables]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SiFechasNoLaborables](
	[idSala] [int] NOT NULL,
	[fechaNoLaborable] [datetime] NOT NULL,
 CONSTRAINT [PK_SiFechasNoLaborables] PRIMARY KEY CLUSTERED
(
	[idSala] ASC,
	[fechaNoLaborable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[SiFechasNoLaborables] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SiProgramacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SiProgramacion](
	[IdProgramacion] [int] IDENTITY(1,1) NOT NULL,
	[IdResponsable] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[HoraInicio] [char](5) NOT NULL,
	[HoraFin] [char](5) NOT NULL,
	[IdTurno] [int] NULL,
	[IdSala] [int] NULL,
	[FechaReg] [datetime] NULL,
	[TiempoPromedioAtencion] [int] NULL,
 CONSTRAINT [SiProgramacionMedica_PK] PRIMARY KEY NONCLUSTERED
(
	[IdProgramacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[sms_diagnosticosgraves]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[sms_diagnosticosgraves](
	[dx] [varchar](7) NOT NULL,
	[celularEspecialista] [varchar](20) NOT NULL,
	[mensaje] [varchar](80) NOT NULL,
 CONSTRAINT [PK_sms_diagnosticosgraves] PRIMARY KEY CLUSTERED
(
	[dx] ASC,
	[celularEspecialista] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[sms_diagnosticosgraves] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[sms_mensajes]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[sms_mensajes](
	[idMensaje] [int] IDENTITY(1,1) NOT NULL,
	[celular] [varchar](20) NOT NULL,
	[idCuentaAtencion] [int] NULL,
	[Mensaje] [varchar](140) NOT NULL,
	[idPaciente] [int] NULL,
	[FechaEnvio] [datetime] NULL,
	[FechaCreacion] [datetime] NOT NULL,
	[opcion] [varchar](50) NOT NULL,
	[idEstadoEnvio] [int] NOT NULL,
 CONSTRAINT [PK_sms_mensajes] PRIMARY KEY CLUSTERED
(
	[idMensaje] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[sms_mensajes] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SubclasificacionDiagnosticos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SubclasificacionDiagnosticos](
	[IdSubclasificacionDx] [int] NOT NULL,
	[Codigo] [varchar](5) NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[IdClasificacionDx] [int] NULL,
	[IdTipoServicio] [int] NULL,
 CONSTRAINT [SubclasificaciónDiagnosticos_PK] PRIMARY KEY CLUSTERED
(
	[IdSubclasificacionDx] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SunasaPacientesHistoricos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SunasaPacientesHistoricos](
	[idSunasaPacienteHistorico] [int] IDENTITY(1,1) NOT NULL,
	[idPaciente] [int] NOT NULL,
	[CodigoIAFA] [varchar](5) NULL,
	[idPaisTitular] [int] NULL,
	[idTipoDocumentoTitular] [int] NULL,
	[NroDocumentoTitular] [varchar](10) NULL,
	[ApellidoCasada] [varchar](35) NULL,
	[ValidacionRegIdentidad] [bit] NULL,
	[NroCarnetIdentidad] [varchar](10) NULL,
	[EstadoDelSeguro] [int] NULL,
	[IdAfiliacion] [int] NULL,
	[ProductoYplan] [varchar](7) NULL,
	[FechaInicioAfiliacion] [datetime] NULL,
	[FechaFinalAfiliacion] [datetime] NULL,
	[idRegimen] [int] NULL,
	[CodigoEstablecimientoIAFA] [varchar](8) NULL,
	[CodigoEstablecimientoRENAES] [varchar](8) NULL,
	[idParentesco] [int] NULL,
	[RUCempleador] [varchar](11) NULL,
	[AnteriorIdTipoDocumentoAsegurado] [int] NULL,
	[AnteriorNroDocumentoAsegurado] [varchar](10) NULL,
	[DNIusarioOperacion] [varchar](8) NULL,
	[idOperacion] [int] NULL,
	[FechaEnvio] [datetime] NULL,
	[SisSepelioParienteEncargado] [varchar](100) NULL,
	[SisSepelioDni] [varchar](8) NULL,
	[SisSepelioFnacimiento] [datetime] NULL,
	[SisSepelioSexo] [int] NULL,
	[SisNroAfiliacion] [varchar](20) NULL,
	[YaNoTieneSeguro] [bit] NULL,
 CONSTRAINT [PK_PacienteSunasa] PRIMARY KEY CLUSTERED
(
	[idSunasaPacienteHistorico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SunasaTiposAfiliacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SunasaTiposAfiliacion](
	[idAfiliacion] [int] NOT NULL,
	[Afiliacion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposSUNASAafiliacion] PRIMARY KEY CLUSTERED
(
	[idAfiliacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposAfiliacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SunasaTiposOperacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SunasaTiposOperacion](
	[idOperacion] [int] NOT NULL,
	[Operacion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposSUNASAoperacion] PRIMARY KEY CLUSTERED
(
	[idOperacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposOperacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SunasaTiposParentesco]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SunasaTiposParentesco](
	[idParentesco] [int] NOT NULL,
	[Parentesco] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposSUNASAparentesco] PRIMARY KEY CLUSTERED
(
	[idParentesco] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposParentesco] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SunasaTiposRegimen]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SunasaTiposRegimen](
	[idRegimen] [int] NOT NULL,
	[Regimen] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposSUNASAregimen] PRIMARY KEY CLUSTERED
(
	[idRegimen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposRegimen] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[sunat_onu]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[sunat_onu](
	[codigo] [varchar](20) NOT NULL,
	[descripcion] [varchar](250) NOT NULL,
 CONSTRAINT [PK_sunat_onu] PRIMARY KEY CLUSTERED
(
	[codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[sunat_onu] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Sunat_ResumenDiario]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Sunat_ResumenDiario](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[DctoRDI] [varchar](50) NULL,
	[fechaEmision] [varchar](10) NULL,
	[fechaResumen] [varchar](10) NULL,
	[tipoDcto] [varchar](2) NULL,
	[SerieDocumento] [varchar](15) NULL,
	[PacienteTipoDoc] [varchar](1) NULL,
	[PacienteNumeroDoc] [varchar](8) NULL,
	[Moneda] [varchar](3) NULL,
	[OpeGravadas] [varchar](15) NULL,
	[OpeExoneradas] [varchar](15) NULL,
	[OpeInafectas] [varchar](15) NULL,
	[OpeGratuitas] [varchar](15) NULL,
	[OtrosCargos] [varchar](15) NULL,
	[TotalIsc] [varchar](15) NULL,
	[TotalIgv] [varchar](15) NULL,
	[TotalOtros] [varchar](15) NULL,
	[ImporteVenta] [varchar](15) NULL,
	[ModTipoDcto] [varchar](5) NULL,
	[ModSerie] [varchar](5) NULL,
	[ModDocumento] [varchar](10) NULL,
	[PercepRegimen] [varchar](15) NULL,
	[PercepPorcen] [varchar](15) NULL,
	[PercepBaseImp] [varchar](15) NULL,
	[PercepMonto] [varchar](15) NULL,
	[PercepCobrar] [varchar](15) NULL,
	[Estado] [varchar](1) NULL,
	[DctoSunat] [varchar](50) NULL,
 CONSTRAINT [PK_Sunat_ResumenDiario_1] PRIMARY KEY CLUSTERED
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiario] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SuSalud_ups]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SuSalud_ups](
	[Codigo] [varchar](7) NOT NULL,
	[Descripcion] [varchar](255) NOT NULL,
 CONSTRAINT [PK_SuSalud_ups] PRIMARY KEY CLUSTERED
(
	[Codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SuSalud_ups] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[SVGEstructura]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SVGEstructura](
	[Orden] [int] NOT NULL,
	[Tipo] [varchar](20) NOT NULL,
	[SVG] [varchar](8000) NOT NULL,
	[Codigo] [varchar](20) NULL,
 CONSTRAINT [EstructuraSVG_PK] PRIMARY KEY CLUSTERED
(
	[Orden] ASC,
	[Tipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[SVGEstructura] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[tempMovimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tempMovimientos](
	[IdMovimiento] [int] NULL,
	[IdUsuario] [int] NULL
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[tempMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TipoFinanciador]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TipoFinanciador](
	[idTipoFinanciador] [int] IDENTITY(1,1) NOT NULL,
	[nombre] [varchar](50) NOT NULL,
	[denominacion] [varchar](50) NULL,
	[codigo] [varchar](11) NULL,
 CONSTRAINT [PK_TipoFinanciador] PRIMARY KEY CLUSTERED
(
	[idTipoFinanciador] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciador] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposActividades]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposActividades](
	[idTipoActividades] [int] NOT NULL,
	[actividad] [varchar](50) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposActividades] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposAlta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposAlta](
	[IdTipoAlta] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[tiposAltaSEM] [varchar](1) NULL,
 CONSTRAINT [TiposAlta_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoAlta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposAlta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCama]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCama](
	[IdTipoCama] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposCama_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoCama] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCama] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCargo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCargo](
	[idTipoCargo] [int] IDENTITY(1,1) NOT NULL,
	[Cargo] [varchar](100) NOT NULL,
 CONSTRAINT [PK_TiposCargo] PRIMARY KEY CLUSTERED
(
	[idTipoCargo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCargo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCondicionAlta]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCondicionAlta](
	[IdCondicionAlta] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[codigoCondicionAltaSEM] [varchar](1) NULL,
 CONSTRAINT [TiposCondicionAlta_PK] PRIMARY KEY CLUSTERED
(
	[IdCondicionAlta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAlta] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCondicionOcupacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCondicionOcupacion](
	[IdCondicionOcupacion] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposCondicionOcupacion_PK] PRIMARY KEY CLUSTERED
(
	[IdCondicionOcupacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCondicionPaciente]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCondicionPaciente](
	[IdTipoCondicionPaciente] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[OrdenRegHis] [int] NULL,
 CONSTRAINT [TiposCondicionPaciente_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoCondicionPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPaciente] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCondicionRecienNacido]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCondicionRecienNacido](
	[IdCondicionRN] [int] NOT NULL,
	[Descripcion] [varchar](20) NULL,
 CONSTRAINT [TiposCondicionRecienNacido_PK] PRIMARY KEY CLUSTERED
(
	[IdCondicionRN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacido] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposCondicionTrabajo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposCondicionTrabajo](
	[IdCondicionTrabajo] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[condicionTrabajoSEM] [varchar](2) NULL,
	[IndFlag] [bit] NULL,
	[idHis] [int] NULL,
 CONSTRAINT [TiposCondicionTrabajo_PK] PRIMARY KEY CLUSTERED
(
	[IdCondicionTrabajo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionTrabajo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposConsumos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposConsumos](
	[idTipoConsumo] [int] NOT NULL,
	[Descripcion] [varchar](20) NOT NULL,
 CONSTRAINT [PK_TiposConsumos] PRIMARY KEY CLUSTERED
(
	[idTipoConsumo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsumos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposDestacados]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposDestacados](
	[idDestacado] [int] NOT NULL,
	[Destacado] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposDestacados] PRIMARY KEY CLUSTERED
(
	[idDestacado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestacados] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposDestinoAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposDestinoAtencion](
	[IdDestinoAtencion] [int] NOT NULL,
	[Codigo] [char](1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[IdTipoServicio] [int] NULL,
	[TipoServicioHosp] [int] NULL,
	[DestinoSEM] [varchar](2) NULL,
	[id_destinoAseguradoSIS] [varchar](1) NULL,
 CONSTRAINT [DestinosAtencion_PK] PRIMARY KEY CLUSTERED
(
	[IdDestinoAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposDocIdentidad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposDocIdentidad](
	[IdDocIdentidad] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[CodigoSUNASA] [int] NULL,
	[CodigoHIS] [varchar](1) NULL,
	[CodigoSIS] [varchar](1) NULL,
	[IndFlag] [bit] NULL,
 CONSTRAINT [TiposDocIdentidad_PK] PRIMARY KEY CLUSTERED
(
	[IdDocIdentidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposEdad]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposEdad](
	[IdTipoEdad] [int] NOT NULL,
	[Codigo] [char](1) NOT NULL,
	[Descripcion] [varchar](10) NOT NULL,
	[tipoEdadSEM] [varchar](1) NULL,
 CONSTRAINT [TiposEdad_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoEdad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdad] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposEmpleado]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposEmpleado](
	[IdTipoEmpleado] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[TipoEmpleadoHIS] [varchar](2) NULL,
	[EsProgramado] [bit] NULL,
	[TipoEmpleadoSIS] [varchar](2) NULL,
	[EsColegiatura] [bit] NOT NULL,
	[tipoEmpleadoSEM] [varchar](2) NULL,
 CONSTRAINT [TiposEmpleado_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoEmpleado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposEstablecimientos]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposEstablecimientos](
	[IdTipo] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
 CONSTRAINT [TiposEstablecimientos_PK] PRIMARY KEY CLUSTERED
(
	[IdTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstablecimientos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposEstadoCivil]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposEstadoCivil](
	[IdEstadoCivil] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[lolcli] [varchar](2) NULL,
	[sip2000] [varchar](2) NULL,
 CONSTRAINT [TiposEstadoCivil_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoCivil] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivil] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposEstadosCita]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposEstadosCita](
	[IdEstadoCita] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposEstadosCita_PK] PRIMARY KEY CLUSTERED
(
	[IdEstadoCita] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadosCita] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposFinanciamiento]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposFinanciamiento](
	[IdTipoFinanciamiento] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[esOficina] [bit] NOT NULL,
	[esSalida] [bit] NOT NULL,
	[SeIngresPrecios] [bit] NOT NULL,
	[EsFarmacia] [bit] NOT NULL,
	[idCajaTiposComprobante] [int] NULL,
	[tipoVenta] [varchar](1) NULL,
	[SeImprimeComprobante] [bit] NULL,
	[esFuenteFinanciamiento] [bit] NOT NULL,
	[GeneraPago] [int] NULL,
	[idTipoConcepto] [int] NULL,
	[PorcPrecio] [money] NULL,
 CONSTRAINT [TiposFinanciamiento_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposGradoInstruccion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposGradoInstruccion](
	[IdGradoInstruccion] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[sip2000] [varchar](2) NULL,
 CONSTRAINT [TiposGradoInstruccion_PK] PRIMARY KEY CLUSTERED
(
	[IdGradoInstruccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposGravedadAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposGravedadAtencion](
	[IdTipoGravedad] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[codigoSEM] [varchar](1) NULL,
 CONSTRAINT [TiposGravedadAtencion_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoGravedad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposHistoriaClinica]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposHistoriaClinica](
	[IdTipoHistoria] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposHistoriaClinica_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoHistoria] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposIdiomas]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposIdiomas](
	[IdIdioma] [int] NOT NULL,
	[Codigo] [varchar](10) NOT NULL,
	[Lengua] [varchar](40) NOT NULL
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposIdiomas] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposNumeracionHistoria]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposNumeracionHistoria](
	[IdTipoNumeracion] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
 CONSTRAINT [TipoGeneracionHistoria_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoNumeracion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoria] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposOcupacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposOcupacion](
	[IdTipoOcupacion] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](50) NOT NULL,
	[lolcli] [varchar](2) NULL,
 CONSTRAINT [TiposOcupacion_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoOcupacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposOrigenAtencion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposOrigenAtencion](
	[IdOrigenAtencion] [int] NOT NULL,
	[Codigo] [char](1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[IdTipoServicio] [int] NULL,
	[TipoServicioHosp] [int] NULL,
	[id_origenAseguradoSIS] [varchar](1) NULL,
 CONSTRAINT [TiposViaAdmision_PK] PRIMARY KEY CLUSTERED
(
	[IdOrigenAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposProcedencia]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposProcedencia](
	[IdProcedencia] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposProcedencia_PK] PRIMARY KEY CLUSTERED
(
	[IdProcedencia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedencia] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposProgramacion]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposProgramacion](
	[IdTipoProgramacion] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposProgramacion_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoProgramacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacion] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposReferencia]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposReferencia](
	[IdTipoReferencia] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposReferencia_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoReferencia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferencia] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposResultadosServInterm]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposResultadosServInterm](
	[IdResultadoSI] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
 CONSTRAINT [PK_TiposResultadosServInterm] PRIMARY KEY CLUSTERED
(
	[IdResultadoSI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposResultadosServInterm] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposServicio]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposServicio](
	[IdTipoServicio] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposServicio_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicio] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposServiciosIntermedios]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposServiciosIntermedios](
	[idTipo] [int] NOT NULL,
	[Tipo] [varchar](20) NOT NULL,
 CONSTRAINT [PK_TiposServiciosIntermedios] PRIMARY KEY CLUSTERED
(
	[idTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposServiciosIntermedios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposSexo]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposSexo](
	[IdTipoSexo] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposSexo_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoSexo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexo] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposSubsector]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposSubsector](
	[IdTipoSubsector] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [TiposSubsector_PK] PRIMARY KEY CLUSTERED
(
	[IdTipoSubsector] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsector] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposTarifa]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposTarifa](
	[idTipoTarifa] [int] IDENTITY(1,1) NOT NULL,
	[codigo] [varchar](50) NOT NULL,
	[TipoTarifa] [varchar](100) NOT NULL,
	[EsFarmacia] [bit] NULL,
 CONSTRAINT [PK_TiposTarifa] PRIMARY KEY CLUSTERED
(
	[idTipoTarifa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifa] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposTarifaCpt]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposTarifaCpt](
	[idTipoTarifa] [int] NOT NULL,
	[idProductoCpt] [int] NOT NULL,
 CONSTRAINT [PK_tipostarifacpt] PRIMARY KEY CLUSTERED
(
	[idTipoTarifa] ASC,
	[idProductoCpt] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCpt] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposTransporte]    Script Date: 12/01/2026 02:48:06 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposTransporte](
	[idTipoTransporte] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposTransporte] PRIMARY KEY CLUSTERED
(
	[idTipoTransporte] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposTransporte] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[TiposViaje]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TiposViaje](
	[idTipoViaje] [int] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TiposViaje] PRIMARY KEY CLUSTERED
(
	[idTipoViaje] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[TiposViaje] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[Turnos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Turnos](
	[IdTurno] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](3) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[HoraInicio] [char](5) NOT NULL,
	[HoraFin] [char](5) NOT NULL,
	[IdTipoServicio] [int] NULL,
	[IdEspecialidad] [int] NULL,
	[idTipoActividades] [int] NULL,
	[HISTURNO] [varchar](5) NULL,
 CONSTRAINT [Turnos_PK] PRIMARY KEY CLUSTERED
(
	[IdTurno] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[Turnos] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[UPServicios]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[UPServicios](
	[IdUPS] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](50) NOT NULL,
	[estado] [bit] NOT NULL,
	[UPShis] [varchar](6) NULL,
 CONSTRAINT [PK_UPServicios] PRIMARY KEY CLUSTERED
(
	[IdUPS] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [dbo].[UPServicios] TO  SCHEMA OWNER
GO
/****** Object:  Table [dbo].[UsuariosRoles]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[UsuariosRoles](
	[IdUsuarioRol] [int] IDENTITY(1,1) NOT NULL,
	[IdRol] [int] NULL,
	[IdEmpleado] [int] NULL,
 CONSTRAINT [SeguridadUsuariosGrupos_PK] PRIMARY KEY CLUSTERED
(
	[IdUsuarioRol] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRoles] TO  SCHEMA OWNER
GO
/****** Object:  Table [Imagenes].[Procedimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Imagenes].[Procedimiento](
	[IdProcedimiento] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](20) NULL,
	[Nombre] [varchar](350) NOT NULL,
	[IdServicio] [int] NOT NULL,
	[Estado] [bit] NOT NULL,
 CONSTRAINT [PK_CPT] PRIMARY KEY CLUSTERED
(
	[IdProcedimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [Imagenes].[Procedimiento] TO  SCHEMA OWNER
GO
/****** Object:  Table [Imagenes].[Servicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Imagenes].[Servicio](
	[IdServicio] [int] IDENTITY(1,1) NOT NULL,
	[IdPuntoCarga] [int] NULL,
	[Nombre] [varchar](50) NULL,
	[Estado] [bit] NOT NULL,
 CONSTRAINT [PK_Servicio] PRIMARY KEY CLUSTERED
(
	[IdServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [Imagenes].[Servicio] TO  SCHEMA OWNER
GO
/****** Object:  Table [SANALITICOSINTF].[t_resultado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [SANALITICOSINTF].[t_resultado](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[insn_numero_movimiento] [int] NULL,
	[insn_numero_cuenta] [int] NULL,
	[insn_numero_orden] [int] NULL,
	[l_pru_id] [int] NULL,
	[o_cuenta] [varchar](50) NULL,
	[CodAna] [varchar](10) NULL,
	[l_ref_sup] [varchar](50) NULL,
	[l_ref_inf] [varchar](50) NULL,
	[p_unidades] [varchar](50) NULL,
	[ResultadoSensible] [varchar](4000) NULL,
	[ra_texto] [varchar](800) NULL,
	[flag_leido] [int] NULL,
	[idProductoCpt] [int] NULL,
	[CPT] [varchar](15) NULL,
	[fecha_registro] [datetime2](7) NULL,
	[estadoOrden] [varchar](50) NULL,
	[comentario] [varchar](max) NULL,
	[metodo] [varchar](500) NULL,
	[fechatimestamp] [datetime] NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [SANALITICOSINTF].[t_resultado] TO  SCHEMA OWNER
GO
/****** Object:  Table [SANALITICOSINTF].[tbSolicitud]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [SANALITICOSINTF].[tbSolicitud](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[insn_numero_movimiento] [int] NULL,
	[insn_numero_cuenta] [int] NULL,
	[insn_numero_orden] [int] NULL,
	[codigo_servicio] [int] NULL,
	[nombre_servicio] [varchar](200) NULL,
	[historia_paciente] [varchar](200) NULL,
	[dni_paciente] [varchar](20) NULL,
	[paterno_paciente] [varchar](100) NULL,
	[materno_paciente] [varchar](100) NULL,
	[nombres_paciente] [varchar](100) NULL,
	[fecnac_paciente] [datetime2](7) NULL,
	[edad_paciente] [int] NULL,
	[sexo_paciente] [varchar](10) NULL,
	[cmp_medico] [varchar](100) NULL,
	[nombres_medico] [varchar](100) NULL,
	[paterno_medico] [varchar](200) NULL,
	[materno_medico] [varchar](200) NULL,
	[codigo_prueba_cpt] [varchar](20) NULL,
	[Descripcion] [varchar](400) NULL,
	[idProductoCpt] [int] NULL,
	[solicitud_leida] [int] NULL,
	[fecha_aduana] [datetime2](7) NULL,
	[FechaHoraRealizaCpt] [datetime2](7) NULL,
	[FechaProgramada] [datetime2](7) NULL,
	[CodigoCie10] [varchar](200) NULL,
	[DescripcionCi] [varchar](300) NULL,
	[FechaHoraTomaMuestra] [datetime] NULL,
	[OrdMed_Pro] [varchar](100) NULL,
	[OrdenMed_Leida] [int] NULL,
	[FechaHoraConfirma] [datetime] NULL,
	[Tip_Prov_Atiende] [varchar](10) NULL,
	[sg_log_cre_feh] [datetime] NULL,
	[dteFecharegistro] [datetime] NULL,
	[dteFechamodifica] [datetime] NULL,
PRIMARY KEY CLUSTERED
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
ALTER AUTHORIZATION ON [SANALITICOSINTF].[tbSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  View [dbo].[MINSA_vPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [dbo].[MINSA_vPaciente]
AS
SELECT     dbo.Pacientes.NroHistoriaClinica AS PACHIS, dbo.Pacientes.ApellidoPaterno AS apepat, dbo.Pacientes.ApellidoMaterno AS apemat,
                      LTRIM(dbo.Pacientes.PrimerNombre) + ' ' + LTRIM(ISNULL(dbo.Pacientes.SegundoNombre, '')) AS nompac, LTRIM(dbo.Pacientes.PrimerNombre)
                      AS prinom, LTRIM(ISNULL(dbo.Pacientes.SegundoNombre, '')) AS segnom, dbo.Pacientes.IdDocIdentidad AS tipdoc,
                      dbo.TiposDocIdentidad.Descripcion AS destipdoc, dbo.Pacientes.NroDocumento AS docpac, CONVERT(varchar(10), dbo.Pacientes.FechaNacimiento,
                      103) AS fecha_nac, dbo.Pacientes.FechaNacimiento, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.IdPaciente
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.TiposDocIdentidad ON dbo.Pacientes.IdDocIdentidad = dbo.TiposDocIdentidad.IdDocIdentidad
WHERE     (dbo.Pacientes.NroDocumento > '0')




GO
ALTER AUTHORIZATION ON [dbo].[MINSA_vPaciente] TO  SCHEMA OWNER
GO
/****** Object:  View [dbo].[MINSA_VCITAPROGRAMADA]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[MINSA_VCITAPROGRAMADA]
AS
SELECT DISTINCT
                      CONVERT(VARCHAR(10), C.Fecha, 103) AS FECHA, C.HoraInicio AS HORA, C.HoraInicio AS HORARIO, C.idMedico AS CODMED,
                      LTRIM(E.ApellidoPaterno) + ' ' + LTRIM(E.ApellidoMaterno) + ' ' + E.Nombres AS NOMMED, LTRIM(C.ApellidoPaterno) + ' ' + LTRIM(C.ApellidoMaterno)
                      + ' ' + C.PrimerNombre AS PACIENTE, S.IdServicio AS CODCON, S.Nombre AS DESCON, ES.IdEspecialidad AS SERCOD, ES.Nombre AS SERDES,
                      S.codigoServicioHIS AS UPS, ES.Nombre AS DES_UPS, P.PACHIS, P.tipdoc AS TIDCOD, P.docpac AS PACDOC, P.destipdoc AS TIDDES,
                      'G' AS FLAG_EST, CG.IdCita AS CODCITA, CG.IdCita AS NUMPRE, CASE WHEN (CAST(LEFT(C.HoraInicio, 2) AS INTEGER))
                      < 12 THEN 'M' ELSE 'T' END TURNO
FROM         SIGH_EXTERNA.DBO.CITASWEBCUPOS C INNER JOIN
                      dbo.Servicios S ON C.idServicio = S.IdServicio INNER JOIN
                      dbo.Especialidades ES ON S.IdEspecialidad = ES.IdEspecialidad LEFT OUTER JOIN
                      dbo.Medicos M ON C.idMedico = M.IdMedico LEFT OUTER JOIN
                      dbo.Empleados E ON M.IdEmpleado = E.IdEmpleado LEFT OUTER JOIN
                      dbo.Citas CG ON C.Fecha = CG.Fecha AND C.idServicio = CG.IdServicio AND CAST(REPLACE(C.HoraInicio, ':', '') AS INTEGER)
                      = CAST(REPLACE(CG.HoraInicio, ':', '') AS INTEGER) LEFT OUTER JOIN
                      dbo.MINSA_vPaciente P ON CG.IdPaciente = P.PACHIS
WHERE     (C.Fecha > GETDATE() - 30) AND (C.idEstadoCitaWeb <> 2)
GO
ALTER AUTHORIZATION ON [dbo].[MINSA_VCITAPROGRAMADA] TO  SCHEMA OWNER
GO
/****** Object:  UserDefinedFunction [Imagenes].[fnt_SeleccionarProductividadImagGalenhos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Imagenes].[fnt_SeleccionarProductividadImagGalenhos](@Fecha_inicio [datetime], @Fecha_fin [datetime], @IdPuntoCarga [int])
RETURNS TABLE AS
return
SELECT
	dbo.ImagMovimiento.Fecha,
	--ImagMovimiento.IdPuntoCarga,
	FactPuntosCarga.Descripcion as PuntoCarga,
	dbo.ImagMovimientoImagenes.IdMovimiento as Movimiento,
	--dbo.ImagMovimientoImagenes.IdOrden,
	(select top 1 E.ApellidoPaterno + ' '+ E.ApellidoMaterno + ' '+ E.Nombres
				from Auditoria
				left join Empleados E on Auditoria.IdEmpleado=e.IdEmpleado
	where IdRegistro=dbo.ImagMovimientoImagenes.IdMovimiento and substring(Auditoria.Tabla,1,17)='ImagMovimiento/S/' order by FechaHora desc)as EmpleadoUltimaActualizacion,
	--dbo.ImagMovimientoImagenes.idPersonaTomaImagen,
	Empleados.ApellidoPaterno + ' '+ Empleados.ApellidoMaterno + ' ' +Empleados.Nombres as EmpleadoTomaImagen,
	 dbo.Pacientes.NroHistoriaClinica,ImagMovimientoImagenes.Paciente,
	 case dbo.Pacientes.IdTipoSexo
	 when 1 then 'M'
	 when 2 then 'F'
	 else '' end as Sexo,
	  --dbo.Pacientes.FechaNacimiento,
	(CASE
	   WHEN DATEADD(YY,DATEDIFF(YEAR,dbo.Pacientes.FechaNacimiento,dbo.ImagMovimiento.Fecha),dbo.Pacientes.FechaNacimiento)>dbo.ImagMovimiento.Fecha THEN
		DATEDIFF(YEAR,dbo.Pacientes.FechaNacimiento,dbo.ImagMovimiento.Fecha)-  1
	   ELSE
		 DATEDIFF(YEAR,dbo.Pacientes.FechaNacimiento,dbo.ImagMovimiento.Fecha)
	   END) as Edad,
	 dbo.ImagMovimientoImagenes.IdCuentaAtencion,
	 --dbo.FactOrdenServicio.idFuenteFinanciamiento,
	 dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.Servicios.Nombre AS ServicioProcedencia,
	 dbo.CajaComprobantesPago.NroSerie+'-'+ dbo.CajaComprobantesPago.NroDocumento as Recibo,
	-- dbo.ImagMovimientoCPT.idProductoCPT,
	 --dbo.FactCatalogoServicios.Codigo,
	  dbo.FactCatalogoServicios.Codigo as CodigoProcedimiento,dbo.FactCatalogoServicios.Nombre as Procedimiento, --dbo.FactCatalogoServicios.NombreMINSA,
	 --DIAGNOSTICO
	 Diagnosticos.CodigoCIE10,Diagnosticos.CodigoCIE10 +' ' +Diagnosticos.Descripcion as Diagnostico,
	   --FIN DIAGNOSTICO
	 dbo.ImagMovimientoCPT.cantidad, dbo.ImagMovimientoCPT.precio, dbo.ImagMovimientoCPT.importe AS total
FROM dbo.ImagMovimientoCPT
		inner join ImagMovimientoImagenes on ImagMovimientoCPT.idMovimiento=ImagMovimientoImagenes.idMovimiento
		inner join FactOrdenServicio on ImagMovimientoImagenes.IdOrden=FactOrdenServicio.IdOrden
		left join FactCatalogoServicios on ImagMovimientoCPT.idProductoCPT=FactCatalogoServicios.IdProducto
		left join FuentesFinanciamiento on FactOrdenServicio.idFuenteFinanciamiento=FuentesFinanciamiento.IdFuenteFinanciamiento
		left join dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio
		inner join ImagMovimiento on ImagMovimientoCPT.idMovimiento=ImagMovimiento.IdMovimiento
		left join Empleados on ImagMovimientoImagenes.idPersonaTomaImagen=Empleados.IdEmpleado
		left join Pacientes on Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente
		left join CajaComprobantesPago ON ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
		left join FactPuntosCarga on ImagMovimiento.IdPuntoCarga=FactPuntosCarga.IdPuntoCarga
		left join Diagnosticos on dbo.ImagMovimientoImagenes.idDiagnostico=Diagnosticos.IdDiagnostico
	where ImagMovimiento.Fecha>=@fecha_inicio and ImagMovimiento.Fecha<=@fecha_fin
	and dbo.ImagMovimiento.IdImagEstado=1
	and  dbo.ImagMovimiento.IdTipoConcepto=3--Salidas  por toma de  Imagen
	and ImagMovimiento.IdPuntoCarga=@IdPuntoCarga
GO
ALTER AUTHORIZATION ON [Imagenes].[fnt_SeleccionarProductividadImagGalenhos] TO  SCHEMA OWNER
GO
/****** Object:  View [dbo].[MINSA_VPROGRAMACION]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[MINSA_VPROGRAMACION]
AS
SELECT DISTINCT
                      PM.IdMedico AS MEDCOD, LTRIM(EM.ApellidoPaterno) + ' ' + LTRIM(EM.ApellidoMaterno) + ' ' + EM.Nombres AS MEDNOM,
                      CE.TiempoPromedioAtencion AS TURRAT, CONVERT(VARCHAR(6), PM.Fecha, 112) AS PERIODO, CONVERT(VARCHAR(10), PM.Fecha, 103) AS FECHA,
                      PM.HoraInicio AS HORA, PM.HoraInicio AS HORINI, PM.HoraFin AS HORFIN, S.IdServicio AS CODCON, S.Nombre AS DESCON,
                      E.IdEspecialidad AS SERCOD, E.Nombre AS DESSER, CAST(U.UPShis AS varchar(6)) AS UPS, E.Nombre AS DESUPS,
                      CASE WHEN (CAST(LEFT(T .HORAINICIO, 2) AS INTEGER)) < 12 THEN 'M' ELSE 'T' END AS TURNO,
                          (SELECT     COUNT(*) AS Expr1
                            FROM          SIGH_EXTERNA.dbo.CitasWebCupos AS CW
                            WHERE      (PM.Fecha = Fecha) AND (PM.IdServicio = idServicio) AND (PM.IdMedico = idMedico) AND isnull(idCitaBloqueada, 0) > 1) AS CUPOS,
                      S.soloTipoSexo, S.maximaEdad, S.MinimaEdad
FROM         dbo.ProgramacionMedica PM INNER JOIN
                      dbo.Especialidades E ON PM.IdEspecialidad = E.IdEspecialidad INNER JOIN
                      dbo.EspecialidadCE CE ON E.IdEspecialidad = CE.IdEspecialidad INNER JOIN
                      dbo.Servicios S ON PM.IdServicio = S.IdServicio AND E.IdEspecialidad = S.IdEspecialidad INNER JOIN
                      dbo.UPServicios U ON S.codigoServicioHIS = U.UPShis INNER JOIN
                      dbo.Turnos T ON PM.IdTurno = T .IdTurno LEFT OUTER JOIN
                      dbo.Medicos ON PM.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN
                      dbo.Empleados EM ON dbo.Medicos.IdEmpleado = EM.IdEmpleado
WHERE     (PM.Fecha > GETDATE() + 2) AND (S.IdTipoServicio = 1)


GO
ALTER AUTHORIZATION ON [dbo].[MINSA_VPROGRAMACION] TO  SCHEMA OWNER
GO
/****** Object:  View [dbo].[minsa_vTipoDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[minsa_vTipoDocumento]
AS
SELECT     IdDocIdentidad AS tidcod, Descripcion AS tiddes
FROM         dbo.TiposDocIdentidad


GO
ALTER AUTHORIZATION ON [dbo].[minsa_vTipoDocumento] TO  SCHEMA OWNER
GO
/****** Object:  Index [IX_Atenciones]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones] ON [dbo].[Atenciones]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Atenciones_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_1] ON [dbo].[Atenciones]
(
	[FechaIngreso] ASC,
	[HoraIngreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_10]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_10] ON [dbo].[Atenciones]
(
	[IdFormaPago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_2] ON [dbo].[Atenciones]
(
	[IdServicioIngreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_3]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_3] ON [dbo].[Atenciones]
(
	[IdMedicoIngreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_4]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_4] ON [dbo].[Atenciones]
(
	[IdMedicoEgreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Atenciones_5]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_5] ON [dbo].[Atenciones]
(
	[FechaEgreso] ASC,
	[HoraEgreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_6]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_6] ON [dbo].[Atenciones]
(
	[IdTipoServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Atenciones_7]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Atenciones_7] ON [dbo].[Atenciones]
(
	[IdServicioEgreso] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [ix_atenciones_8]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [ix_atenciones_8] ON [dbo].[Atenciones]
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [ix_atenciones_9]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [ix_atenciones_9] ON [dbo].[Atenciones]
(
	[idFuenteFinanciamiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_SesionDiaria]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_SesionDiaria] ON [dbo].[AtencionesConvenio]
(
	[idPaciente] ASC,
	[FechaSesion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_emergenciaCorrelativo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_emergenciaCorrelativo] ON [dbo].[AtencionesDatosAdicionales]
(
	[emergenciaCorrelativo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_NroReferenciaDestino]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_NroReferenciaDestino] ON [dbo].[AtencionesDatosAdicionales]
(
	[NroReferenciaDestino] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_AtencionesEstanciaHospitalaria]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_AtencionesEstanciaHospitalaria] ON [dbo].[AtencionesEstanciaHospitalaria]
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_FechaHora]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_FechaHora] ON [dbo].[Auditoria]
(
	[FechaHora] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Registro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Registro] ON [dbo].[Auditoria]
(
	[IdRegistro] ASC,
	[idListItem] ASC,
	[Accion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ix_tabla]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ix_tabla] ON [dbo].[Auditoria]
(
	[Tabla] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_FechaCobranza]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_FechaCobranza] ON [dbo].[CajaComprobantesPago]
(
	[FechaCobranza] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_idCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_idCuentaAtencion] ON [dbo].[CajaComprobantesPago]
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_idPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_idPaciente] ON [dbo].[CajaComprobantesPago]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_CajaComprobantesPago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_CajaComprobantesPago] ON [dbo].[CajaComprobantesPago]
(
	[NroSerie] ASC,
	[NroDocumento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_CajaComprobantesPagoFemision]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_CajaComprobantesPagoFemision] ON [dbo].[CajaComprobantesPago]
(
	[fechaEmision] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ix_fechaEmision]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ix_fechaEmision] ON [dbo].[CajaComprobantesPago]
(
	[fechaEmision] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Citas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Citas] ON [dbo].[Citas]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Citas_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Citas_1] ON [dbo].[Citas]
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Citas_2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Citas_2] ON [dbo].[Citas]
(
	[IdMedico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Citas_3]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Citas_3] ON [dbo].[Citas]
(
	[Fecha] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Programacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Programacion] ON [dbo].[Citas]
(
	[IdProgramacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Distritos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Distritos] ON [dbo].[Distritos]
(
	[IdReniec] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ind_Codigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_Codigo] ON [dbo].[FactCatalogoBienesInsumos]
(
	[Codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ind_nombre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_nombre] ON [dbo].[FactCatalogoBienesInsumos]
(
	[Nombre] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ind_Codigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_Codigo] ON [dbo].[FactCatalogoServicios]
(
	[Codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ind_nombre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_nombre] ON [dbo].[FactCatalogoServicios]
(
	[Nombre] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactCatalogoServiciosHosp]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactCatalogoServiciosHosp] ON [dbo].[FactCatalogoServiciosHosp]
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactCatalogoServiciosPtos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactCatalogoServiciosPtos] ON [dbo].[FactCatalogoServiciosPtos]
(
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenesBienes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenesBienes] ON [dbo].[FactOrdenesBienes]
(
	[idPreventa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_FactOrdenesBienes_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenesBienes_1] ON [dbo].[FactOrdenesBienes]
(
	[MovNumero] ASC,
	[MovTipo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenesBienes_2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenesBienes_2] ON [dbo].[FactOrdenesBienes]
(
	[idCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenesBienes_3]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenesBienes_3] ON [dbo].[FactOrdenesBienes]
(
	[idComprobantePago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [indFechaHoraRealizaCpt]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [indFechaHoraRealizaCpt] ON [dbo].[FactOrdenServicio]
(
	[FechaHoraRealizaCpt] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenServicio] ON [dbo].[FactOrdenServicio]
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenServicio_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenServicio_1] ON [dbo].[FactOrdenServicio]
(
	[IdServicioPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenServicio_pac]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenServicio_pac] ON [dbo].[FactOrdenServicio]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenServicioPagos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenServicioPagos] ON [dbo].[FactOrdenServicioPagos]
(
	[idOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_FactOrdenServicioPagos_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FactOrdenServicioPagos_1] ON [dbo].[FactOrdenServicioPagos]
(
	[idComprobantePago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_idPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_idPaciente] ON [dbo].[FacturacionCuentasAtencion]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Farm_formdet]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Farm_formdet] ON [dbo].[farm_formdet]
(
	[ANNOMES] ASC,
	[CODIGO_MED] ASC,
	[CODIGO_PRE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX1_farmHistPrecio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX1_farmHistPrecio] ON [dbo].[farmHistPrecio]
(
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_farmMovimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimiento] ON [dbo].[farmMovimiento]
(
	[DocumentoIdtipo] ASC,
	[DocumentoNumero] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimiento_almD]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimiento_almD] ON [dbo].[farmMovimiento]
(
	[idAlmacenDestino] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimiento_almO]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimiento_almO] ON [dbo].[farmMovimiento]
(
	[idAlmacenOrigen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimiento_feccha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimiento_feccha] ON [dbo].[farmMovimiento]
(
	[fechaCreacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_FarmMovDetalleXdcto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_FarmMovDetalleXdcto] ON [dbo].[farmMovimientoDetalle]
(
	[DocumentoNumero] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_farmMovimientoDetalle_idProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoDetalle_idProducto] ON [dbo].[farmMovimientoDetalle]
(
	[idProducto] ASC,
	[Lote] ASC,
	[FechaVencimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimientoNotaIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoNotaIngreso] ON [dbo].[farmMovimientoNotaIngreso]
(
	[idCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimientoVentas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoVentas] ON [dbo].[farmMovimientoVentas]
(
	[idPreVenta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimientoVentas_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoVentas_1] ON [dbo].[farmMovimientoVentas]
(
	[idCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimientoVentas_2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoVentas_2] ON [dbo].[farmMovimientoVentas]
(
	[IdServicioPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_farmMovimientoVentas_pac]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_farmMovimientoVentas_pac] ON [dbo].[farmMovimientoVentas]
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Paciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Paciente] ON [dbo].[his_historicoAtenciones]
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_HIS_VALIDACIONES]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_HIS_VALIDACIONES] ON [dbo].[HIS_VALIDACIONES]
(
	[CODVALIDACION] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_idPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_idPaciente] ON [dbo].[HistoriasClinicas]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_HistoriasSolicitadas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_HistoriasSolicitadas] ON [dbo].[HistoriasSolicitadas]
(
	[FechaSolicitud] ASC,
	[IdMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_HistoriasSolicitadas_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_HistoriasSolicitadas_1] ON [dbo].[HistoriasSolicitadas]
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Paciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Paciente] ON [dbo].[HistoriasSolicitadas]
(
	[IdPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimiento_fech]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimiento_fech] ON [dbo].[ImagMovimiento]
(
	[Fecha] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimiento_ptoCarga]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimiento_ptoCarga] ON [dbo].[ImagMovimiento]
(
	[IdPuntoCarga] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoCPT_idProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoCPT_idProducto] ON [dbo].[ImagMovimientoCPT]
(
	[idProductoCPT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoDetalle]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoDetalle] ON [dbo].[ImagMovimientoDetalle]
(
	[idMovimiento] ASC,
	[idProductoCPT] ASC,
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoDetalle_idProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoDetalle_idProducto] ON [dbo].[ImagMovimientoDetalle]
(
	[idProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoImagenes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoImagenes] ON [dbo].[ImagMovimientoImagenes]
(
	[IdComprobantePago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoImagenes_idCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoImagenes_idCuenta] ON [dbo].[ImagMovimientoImagenes]
(
	[IdCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ImagMovimientoImagenes_Orden]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ImagMovimientoImagenes_Orden] ON [dbo].[ImagMovimientoImagenes]
(
	[IdOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_LabItemsCptidProductoCpt11]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_LabItemsCptidProductoCpt11] ON [dbo].[LabItemsCpt]
(
	[idProductoCpt] ASC,
	[ordenXresultado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_LabMovimientoLaboratorioOrden]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_LabMovimientoLaboratorioOrden] ON [dbo].[LabMovimientoLaboratorio]
(
	[IdOrden] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_MovimientosHistoriaClinica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_MovimientosHistoriaClinica] ON [dbo].[MovimientosHistoriaClinica]
(
	[IdPaciente] ASC,
	[FechaMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_MovimientosHistoriaClinica_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_MovimientosHistoriaClinica_1] ON [dbo].[MovimientosHistoriaClinica]
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_NotaCreditoXdcto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_NotaCreditoXdcto] ON [dbo].[NotaCreditoDebito]
(
	[NroSerie] ASC,
	[NroDocumento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_NotaCreditoXfechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_NotaCreditoXfechas] ON [dbo].[NotaCreditoDebito]
(
	[FechaPagado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ind_apellido]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_apellido] ON [dbo].[Pacientes]
(
	[ApellidoPaterno] ASC,
	[ApellidoMaterno] ASC,
	[PrimerNombre] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [ind_autogenerado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [ind_autogenerado] ON [dbo].[Pacientes]
(
	[Autogenerado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Ind_NroHistoria]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ind_NroHistoria] ON [dbo].[Pacientes]
(
	[NroHistoriaClinica] ASC,
	[IdTipoNumeracion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [indFichaFamiliar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [indFichaFamiliar] ON [dbo].[Pacientes]
(
	[FichaFamiliar] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Pacientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_Pacientes] ON [dbo].[Pacientes]
(
	[NroDocumento] ASC,
	[IdDocIdentidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencion_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencion_1] ON [dbo].[PerinatalAtencion]
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionCred]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionCred] ON [dbo].[PerinatalAtencionCred]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionCred1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionCred1] ON [dbo].[PerinatalAtencionCred1]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionDiagnosticos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionDiagnosticos] ON [dbo].[PerinatalAtencionDiagnosticos]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionDiaria]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionDiaria] ON [dbo].[PerinatalAtencionDiaria]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionMedicamentos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionMedicamentos] ON [dbo].[PerinatalAtencionMedicamentos]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_PerinatalAtencionProcedimientos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_PerinatalAtencionProcedimientos] ON [dbo].[PerinatalAtencionProcedimientos]
(
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ProgramacionMedica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ProgramacionMedica] ON [dbo].[ProgramacionMedica]
(
	[IdMedico] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ProgramacionMedica_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ProgramacionMedica_1] ON [dbo].[ProgramacionMedica]
(
	[Fecha] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ProgramacionMedica_2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ProgramacionMedica_2] ON [dbo].[ProgramacionMedica]
(
	[IdEspecialidad] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ProgramacionMedica_3]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ProgramacionMedica_3] ON [dbo].[ProgramacionMedica]
(
	[IdTipoServicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_RecetaCabecera]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_RecetaCabecera] ON [dbo].[RecetaCabecera]
(
	[idCuentaAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_RecetaCabecera_1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_RecetaCabecera_1] ON [dbo].[RecetaCabecera]
(
	[idComprobantePago] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_ServiciosAtenSimultaneaFua]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ServiciosAtenSimultaneaFua] ON [dbo].[ServiciosAtenSimultaneaFua]
(
	[AScorrelativo] ASC,
	[idAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_ServiciosAtenSimultaneaMov]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_ServiciosAtenSimultaneaMov] ON [dbo].[ServiciosAtenSimultaneaMov]
(
	[IdAtencion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_SiCitasIdMovimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_SiCitasIdMovimiento] ON [dbo].[SiCitas]
(
	[idMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_sicitasidProgramacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_sicitasidProgramacion] ON [dbo].[SiCitas]
(
	[idProgramacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_SunasaPacientesHistoricos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_SunasaPacientesHistoricos] ON [dbo].[SunasaPacientesHistoricos]
(
	[idPaciente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [Ix_fechaEmision]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [Ix_fechaEmision] ON [dbo].[Sunat_ResumenDiario]
(
	[fechaEmision] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_tempMovimientos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
CREATE NONCLUSTERED INDEX [IX_tempMovimientos] ON [dbo].[tempMovimientos]
(
	[IdMovimiento] ASC,
	[IdUsuario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [dbo].[Atenciones] ADD  CONSTRAINT [DF_Atenciones_EsPacienteExterno]  DEFAULT ((0)) FOR [EsPacienteExterno]
GO
ALTER TABLE [dbo].[Atenciones] ADD  DEFAULT ((0)) FOR [ENVIADO_HISWEB]
GO
ALTER TABLE [dbo].[AtenInteGrupoHCRespuestaPaciente] ADD  CONSTRAINT [DF_AtenInteGrupoHCRespuestaPaciente_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[CajaComprobantesPago] ADD  CONSTRAINT [DF_CajaComprobantesPago_Total]  DEFAULT ((0)) FOR [Total]
GO
ALTER TABLE [dbo].[CajaComprobantesPago] ADD  CONSTRAINT [DF_CajaComprobantesPago_idTipoFinanciamiento]  DEFAULT ((1)) FOR [idTipoFinanciamiento]
GO
ALTER TABLE [dbo].[Citas] ADD  CONSTRAINT [DF__Citas__FechaSoli__407C1A4D]  DEFAULT (getdate()) FOR [FechaSolicitud]
GO
ALTER TABLE [dbo].[Citas] ADD  CONSTRAINT [DF__Citas__HoraSolic__41703E86]  DEFAULT ('1') FOR [HoraSolicitud]
GO
ALTER TABLE [dbo].[constancias] ADD  CONSTRAINT [DF_constancias_estadoConstancia]  DEFAULT ((1)) FOR [estadoConstancia]
GO
ALTER TABLE [dbo].[Diagnosticos] ADD  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[Empleados] ADD  CONSTRAINT [DF_Empleados_UltimoLogin_DF1]  DEFAULT (NULL) FOR [UltimoLogin]
GO
ALTER TABLE [dbo].[FactCatalogoPaquete] ADD  CONSTRAINT [DF_FactCatalogoPaquete_idTipoFinanciamiento]  DEFAULT ((1)) FOR [idTipoFinanciamiento]
GO
ALTER TABLE [dbo].[FactCatalogoPaquete] ADD  CONSTRAINT [DF_FactCatalogoPaquete_idUsuario]  DEFAULT ((738)) FOR [idUsuario]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosHosp] ADD  CONSTRAINT [DF_FactCatalogoServiciosHosp_SeUsaSinPrecio]  DEFAULT ((0)) FOR [SeUsaSinPrecio]
GO
ALTER TABLE [dbo].[FactReembolsos] ADD  CONSTRAINT [DF_FactReembolsos_idEstadoReembolso]  DEFAULT ((1)) FOR [idEstadoReembolso]
GO
ALTER TABLE [dbo].[FacturacionBienesFinanciamientos] ADD  CONSTRAINT [DF_FacturacionBienesFinanciamientos_idEstadoFacturacion]  DEFAULT ((1)) FOR [idEstadoFacturacion]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencionPtos] ADD  CONSTRAINT [DF_FacturacionCuentasAtencionPtos_TotalConsumos]  DEFAULT ((0)) FOR [TotalConsumos]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencionPtos] ADD  CONSTRAINT [DF_FacturacionCuentasAtencionPtos_TotalPagos]  DEFAULT ((0)) FOR [TotalPagos]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencionPtos] ADD  CONSTRAINT [DF_FacturacionCuentasAtencionPtos_TotalPagosReembolso]  DEFAULT ((0)) FOR [TotalPagosReembolso]
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos] ADD  CONSTRAINT [DF_FacturacionServicioFinanciamientos_idEstadoFacturacion]  DEFAULT ((1)) FOR [idEstadoFacturacion]
GO
ALTER TABLE [dbo].[farmInventarioDetalle] ADD  CONSTRAINT [DF_farmInventarioDetalle_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmMovimientoDetalle] ADD  CONSTRAINT [DF_farmMovimientoDetalle_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmSaldo] ADD  CONSTRAINT [DF_farmSaldo_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmSaldoDetallado] ADD  CONSTRAINT [DF_farmSaldoDetallado_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmSaldoMensual] ADD  CONSTRAINT [DF_farmSaldoMensual_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FarmSaldoMensualDetallado] ADD  CONSTRAINT [DF_FarmSaldoMensualDetallado_IdTipoSalidaBienInsumo]  DEFAULT ((1)) FOR [IdTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FuentesFinanciamiento] ADD  CONSTRAINT [DF__FuentesFi__idTip__61189672]  DEFAULT ((1)) FOR [idTipoFinanciador]
GO
ALTER TABLE [dbo].[FuentesFinanciamiento] ADD  CONSTRAINT [DF__FuentesFi__codig__620CBAAB]  DEFAULT ('00000000000') FOR [codigo]
GO
ALTER TABLE [dbo].[HIS_Cabecera] ADD  DEFAULT ((1867)) FOR [IdEstablecimiento]
GO
ALTER TABLE [dbo].[HIS_Cabecera] ADD  DEFAULT ((31)) FOR [IdServicio]
GO
ALTER TABLE [dbo].[HIS_Lotes] ADD  DEFAULT ((0)) FOR [DobleDigitacion]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] ADD  CONSTRAINT [DF_HistoriasSolicitadas_FechaHoraReg]  DEFAULT (getdate()) FOR [FechaHoraReg]
GO
ALTER TABLE [dbo].[ImagCatalgoServicioDuracion] ADD  CONSTRAINT [DF_ImagCatalgoServicioDuracion_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[ImagMovimientoDetalle] ADD  CONSTRAINT [DF_ImagMovimientoDetalle_CantidadFallada]  DEFAULT ((0)) FOR [CantidadFallada]
GO
ALTER TABLE [dbo].[ImagSala] ADD  CONSTRAINT [DF_ImagSala_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[ImagTipoModalidadSala] ADD  CONSTRAINT [DF_ImagTipoModalidadSala_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[InteoIntegracionSistema] ADD  CONSTRAINT [DF_InteoIntegracionSistema_EsProveedorActual]  DEFAULT ((0)) FOR [EsProveedorActual]
GO
ALTER TABLE [dbo].[InteoIntegracionSistema] ADD  CONSTRAINT [DF_InteoIntegracionSistema_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[InteoTipoSistema] ADD  CONSTRAINT [DF_InteoTipoSistema_EsActivo]  DEFAULT ((1)) FOR [EsActivo]
GO
ALTER TABLE [dbo].[LabMovimiento] ADD  CONSTRAINT [DF_LabMovimiento_IdLabEstado]  DEFAULT ((0)) FOR [IdLabEstado]
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica] ADD  CONSTRAINT [DF__Movimient__IdSer__0FA30D71]  DEFAULT ((1)) FOR [IdServicioOrigen]
GO
ALTER TABLE [dbo].[Pacientes] ADD  DEFAULT ((0)) FOR [validacionReniec]
GO
ALTER TABLE [dbo].[PacientesDatosAdicionales] ADD  CONSTRAINT [DF_PacientesDatosAdicionales_FNacimientoCalculada]  DEFAULT ((0)) FOR [FNacimientoCalculada]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] ADD  DEFAULT ((1)) FOR [IdClasificacionDx]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] ADD  DEFAULT ((102)) FOR [IdSubclasificacionDx]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] ADD  DEFAULT ((1)) FOR [ItemDiagnostico]
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos] ADD  DEFAULT ((1)) FOR [ItemProcedimiento]
GO
ALTER TABLE [dbo].[ProControlConfigDatos] ADD  DEFAULT ((0)) FOR [Control_Fila]
GO
ALTER TABLE [dbo].[ProControlConfigDatos] ADD  DEFAULT ((0)) FOR [Control_Columna]
GO
ALTER TABLE [dbo].[ProControles] ADD  DEFAULT ((0)) FOR [ControlOtroEESS]
GO
ALTER TABLE [dbo].[ProDiagnosticos] ADD  DEFAULT ((102)) FOR [IdSubClasificacionDX]
GO
ALTER TABLE [dbo].[ProgramacionMedica] ADD  CONSTRAINT [DF__Programac__Color__6C4FAF93]  DEFAULT ((-2147483643)) FOR [Color]
GO
ALTER TABLE [dbo].[TiposEmpleado] ADD  DEFAULT ((1)) FOR [EsColegiatura]
GO
ALTER TABLE [dbo].[ArchiveroServicio]  WITH NOCHECK ADD  CONSTRAINT [Empleados_ResponsableHistoriaServicio_FK1] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[ArchiveroServicio] CHECK CONSTRAINT [Empleados_ResponsableHistoriaServicio_FK1]
GO
ALTER TABLE [dbo].[ArchiveroServicio]  WITH NOCHECK ADD  CONSTRAINT [Servicios_ResponsableHistoriaServicio_FK1] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[ArchiveroServicio] CHECK CONSTRAINT [Servicios_ResponsableHistoriaServicio_FK1]
GO
ALTER TABLE [dbo].[AtencionCEServicios]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionCEServicios_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionCEServicios] CHECK CONSTRAINT [FK_AtencionCEServicios_Atenciones]
GO
ALTER TABLE [dbo].[AtencionCEServicios]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionCEServicios_SubclasificacionDiagnosticos] FOREIGN KEY([IdSubclasificacionDx])
REFERENCES [dbo].[SubclasificacionDiagnosticos] ([IdSubclasificacionDx])
GO
ALTER TABLE [dbo].[AtencionCEServicios] CHECK CONSTRAINT [FK_AtencionCEServicios_SubclasificacionDiagnosticos]
GO
ALTER TABLE [dbo].[Atenciones]  WITH NOCHECK ADD  CONSTRAINT [FK_Atenciones_SunasaPacientesHistoricos] FOREIGN KEY([idSunasaPacienteHistorico])
REFERENCES [dbo].[SunasaPacientesHistoricos] ([idSunasaPacienteHistorico])
GO
ALTER TABLE [dbo].[Atenciones] CHECK CONSTRAINT [FK_Atenciones_SunasaPacientesHistoricos]
GO
ALTER TABLE [dbo].[Atenciones]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_Atenciones_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[Atenciones] CHECK CONSTRAINT [Pacientes_Atenciones_FK1]
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [ClasificacionDiagnosticos_AtencionesDiagnosticos_FK1] FOREIGN KEY([IdClasificacionDx])
REFERENCES [dbo].[ClasificacionDiagnosticos] ([IdClasificacionDx])
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos] CHECK CONSTRAINT [ClasificacionDiagnosticos_AtencionesDiagnosticos_FK1]
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [Diagnosticos_AtencionesDiagnosticos_FK1] FOREIGN KEY([IdDiagnostico])
REFERENCES [dbo].[Diagnosticos] ([IdDiagnostico])
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos] CHECK CONSTRAINT [Diagnosticos_AtencionesDiagnosticos_FK1]
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesDiagnosticos_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos] CHECK CONSTRAINT [FK_AtencionesDiagnosticos_Atenciones]
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [SubclasificaciónDiagnosticos_AtencionesDiagnosticos_FK1] FOREIGN KEY([IdSubclasificacionDx])
REFERENCES [dbo].[SubclasificacionDiagnosticos] ([IdSubclasificacionDx])
GO
ALTER TABLE [dbo].[AtencionesDiagnosticos] CHECK CONSTRAINT [SubclasificaciónDiagnosticos_AtencionesDiagnosticos_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaCausaExternaMorbilidad_AtencionesEmergencia_FK1] FOREIGN KEY([IdCausaExternaMorbilidad])
REFERENCES [dbo].[EmergenciaCausaExternaMorbilidad] ([IdCausaExternaMorbilidad])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaCausaExternaMorbilidad_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaClaseAccidente_AtencionesEmergencia_FK1] FOREIGN KEY([IdClaseAccidente])
REFERENCES [dbo].[EmergenciaClaseAccidente] ([IdClaseAccidente])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaClaseAccidente_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaGrupoOcupacionalALAB_AtencionesEmergencia_FK1] FOREIGN KEY([IdGrupoOcupacionalALAB])
REFERENCES [dbo].[EmergenciaGrupoOcupacionalALAB] ([IdGrupoOcupacionalALAB])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaGrupoOcupacionalALAB_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaLugarEvento_AtencionesEmergencia_FK1] FOREIGN KEY([IdLugarEvento])
REFERENCES [dbo].[EmergenciaLugarEvento] ([IdLugarEvento])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaLugarEvento_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaPosicionLesionadoALAB_AtencionesEmergencia_FK1] FOREIGN KEY([IdPosicionLesionadoALAB])
REFERENCES [dbo].[EmergenciaPosicionLesionadoALAB] ([IdPosicionLesionadoALAB])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaPosicionLesionadoALAB_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaRelacionAgresorVictima_AtencionesEmergencia_FK1] FOREIGN KEY([IdRelacionAgresorVictima])
REFERENCES [dbo].[EmergenciaRelacionAgresorVictima] ([IdRelacionAgresorVictima])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaRelacionAgresorVictima_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaSeguridad_AtencionesEmergencia_FK1] FOREIGN KEY([IdSeguridad])
REFERENCES [dbo].[EmergenciaSeguridad] ([IdSeguridad])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaSeguridad_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaTipoAgenteAGAN_AtencionesEmergencia_FK1] FOREIGN KEY([IdTipoAgenteAGAN])
REFERENCES [dbo].[EmergenciaTipoAgenteAGAN] ([IdTipoAgenteAGAN])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaTipoAgenteAGAN_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaTipoEvento_AtencionesEmergencia_FK1] FOREIGN KEY([IdTipoEvento])
REFERENCES [dbo].[EmergenciaTipoEvento] ([IdTipoEvento])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaTipoEvento_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaTipoTransporte_AtencionesEmergencia_FK1] FOREIGN KEY([IdTipoTransporte])
REFERENCES [dbo].[EmergenciaTipoTransporte] ([IdTipoTransporte])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaTipoTransporte_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaTipoVehiculo_AtencionesEmergencia_FK1] FOREIGN KEY([IdTipoVehiculo])
REFERENCES [dbo].[EmergenciaTipoVehiculo] ([IdTipoVehiculo])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaTipoVehiculo_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [EmergenciaUbicacionLesionado_AtencionesEmergencia_FK1] FOREIGN KEY([IdUbicacionLesionado])
REFERENCES [dbo].[EmergenciaUbicacionLesionado] ([IdUbicacionLesionado])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [EmergenciaUbicacionLesionado_AtencionesEmergencia_FK1]
GO
ALTER TABLE [dbo].[AtencionesEmergencia]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesEmergencia_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionesEmergencia] CHECK CONSTRAINT [FK_AtencionesEmergencia_Atenciones]
GO
ALTER TABLE [dbo].[AtencionesEpisodiosDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesEpisodiosDetalle_Atenciones] FOREIGN KEY([idAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionesEpisodiosDetalle] CHECK CONSTRAINT [FK_AtencionesEpisodiosDetalle_Atenciones]
GO
ALTER TABLE [dbo].[AtencionesEpisodiosDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesEpisodiosDetalle_AtencionesEpisodiosCabecera] FOREIGN KEY([idPaciente], [idEpisodio])
REFERENCES [dbo].[AtencionesEpisodiosCabecera] ([idPaciente], [idEpisodio])
GO
ALTER TABLE [dbo].[AtencionesEpisodiosDetalle] CHECK CONSTRAINT [FK_AtencionesEpisodiosDetalle_AtencionesEpisodiosCabecera]
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesEstanciaHospitalaria_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria] CHECK CONSTRAINT [FK_AtencionesEstanciaHospitalaria_Atenciones]
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria]  WITH CHECK ADD  CONSTRAINT [IdMedicoOrdenaOrigen_FK1] FOREIGN KEY([IdMedicoOrdenaOrigen])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria] CHECK CONSTRAINT [IdMedicoOrdenaOrigen_FK1]
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria]  WITH NOCHECK ADD  CONSTRAINT [Medicos_OcupacionCamas_FK1] FOREIGN KEY([IdMedicoOrdena])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria] CHECK CONSTRAINT [Medicos_OcupacionCamas_FK1]
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria]  WITH NOCHECK ADD  CONSTRAINT [Servicios_OcupacionCamas_FK1] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[AtencionesEstanciaHospitalaria] CHECK CONSTRAINT [Servicios_OcupacionCamas_FK1]
GO
ALTER TABLE [dbo].[AtencionesNacimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_AtencionesNacimientos_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtencionesNacimientos] CHECK CONSTRAINT [FK_AtencionesNacimientos_Atenciones]
GO
ALTER TABLE [dbo].[AtencionesNacimientos]  WITH NOCHECK ADD  CONSTRAINT [TiposCondicionRecienNacido_AtencionesNacimientos_FK1] FOREIGN KEY([IdCondicionRN])
REFERENCES [dbo].[TiposCondicionRecienNacido] ([IdCondicionRN])
GO
ALTER TABLE [dbo].[AtencionesNacimientos] CHECK CONSTRAINT [TiposCondicionRecienNacido_AtencionesNacimientos_FK1]
GO
ALTER TABLE [dbo].[AtencionesNacimientos]  WITH NOCHECK ADD  CONSTRAINT [TiposSexo_Nacimientos_FK1] FOREIGN KEY([IdTipoSexo])
REFERENCES [dbo].[TiposSexo] ([IdTipoSexo])
GO
ALTER TABLE [dbo].[AtencionesNacimientos] CHECK CONSTRAINT [TiposSexo_Nacimientos_FK1]
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteGrupoHCPaciente_AtenInteGrupo] FOREIGN KEY([IdAtenInteGrupo])
REFERENCES [dbo].[AtenInteGrupo] ([IdAtenInteGrupo])
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente] CHECK CONSTRAINT [FK_AtenInteGrupoHCPaciente_AtenInteGrupo]
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteGrupoHCPaciente_AtenIntePregunta] FOREIGN KEY([IdPregunta])
REFERENCES [dbo].[AtenIntePregunta] ([IdPregunta])
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente] CHECK CONSTRAINT [FK_AtenInteGrupoHCPaciente_AtenIntePregunta]
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteGrupoHCPaciente_Pacientes] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[AtenInteGrupoHCPaciente] CHECK CONSTRAINT [FK_AtenInteGrupoHCPaciente_Pacientes]
GO
ALTER TABLE [dbo].[AtenInteGrupoHCRespuestaPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteGrupoHCRespuestaPaciente_AtenInteGrupoHCPaciente] FOREIGN KEY([IdGrupoHCPaciente], [IdPaciente])
REFERENCES [dbo].[AtenInteGrupoHCPaciente] ([IdGrupoHCPaciente], [IdPaciente])
GO
ALTER TABLE [dbo].[AtenInteGrupoHCRespuestaPaciente] CHECK CONSTRAINT [FK_AtenInteGrupoHCRespuestaPaciente_AtenInteGrupoHCPaciente]
GO
ALTER TABLE [dbo].[AtenInteItemPlanCrecimiento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanCrecimiento_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenInteItemPlanCrecimiento] CHECK CONSTRAINT [FK_AtenInteItemPlanCrecimiento_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenInteItemPlanDesarrollo]  WITH CHECK ADD  CONSTRAINT [FK_AtenItemPlanDesarrollo_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenInteItemPlanDesarrollo] CHECK CONSTRAINT [FK_AtenItemPlanDesarrollo_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanInmunizacion_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento] CHECK CONSTRAINT [FK_AtenInteItemPlanInmunizacion_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanInmunizacion_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento] CHECK CONSTRAINT [FK_AtenInteItemPlanInmunizacion_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanInmunizacion_FactCatalogoServicios] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[AtenInteItemPlanProcedimiento] CHECK CONSTRAINT [FK_AtenInteItemPlanInmunizacion_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[AtenInteItemPlanSuplemento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanSuplemento_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenInteItemPlanSuplemento] CHECK CONSTRAINT [FK_AtenInteItemPlanSuplemento_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenInteItemPlanSuplemento]  WITH CHECK ADD  CONSTRAINT [FK_AtenInteItemPlanSuplemento_FactCatalogoBienesInsumos] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[AtenInteItemPlanSuplemento] CHECK CONSTRAINT [FK_AtenInteItemPlanSuplemento_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[AtenIntePlanAtencion]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanAtencion_AtenInteGrupo] FOREIGN KEY([IdAtenInteGrupo])
REFERENCES [dbo].[AtenInteGrupo] ([IdAtenInteGrupo])
GO
ALTER TABLE [dbo].[AtenIntePlanAtencion] CHECK CONSTRAINT [FK_AtenIntePlanAtencion_AtenInteGrupo]
GO
ALTER TABLE [dbo].[AtenIntePlanAtencion]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanAtencion_PeriodoTiempo] FOREIGN KEY([IdPeriodoTiempo])
REFERENCES [dbo].[PeriodoTiempo] ([IdPeriodoTiempo])
GO
ALTER TABLE [dbo].[AtenIntePlanAtencion] CHECK CONSTRAINT [FK_AtenIntePlanAtencion_PeriodoTiempo]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecDetalle]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecDetalle_AtenInteItemPlanCrecimiento] FOREIGN KEY([IdItemPlanCrecimiento])
REFERENCES [dbo].[AtenInteItemPlanCrecimiento] ([IdItemPlanCrecimiento])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecDetalle] CHECK CONSTRAINT [FK_AtenIntePlanCrecDetalle_AtenInteItemPlanCrecimiento]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_Atenciones]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanCrecimientoPaciente_Establecimientos]
GO
ALTER TABLE [dbo].[AtenIntePlanCrecPacienteDet]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanCrecPacienteDet_AtenIntePlanCrecimientoPaciente] FOREIGN KEY([IdPlanCrecimientoPaciente], [IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanCrecimientoPaciente] ([IdPlanCrecimientoPaciente], [IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanCrecPacienteDet] CHECK CONSTRAINT [FK_AtenIntePlanCrecPacienteDet_AtenIntePlanCrecimientoPaciente]
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente] CHECK CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_Atenciones]
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente] CHECK CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente] CHECK CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenIntePlanIntegralPaciente] FOREIGN KEY([IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanIntegralPaciente] ([IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente] CHECK CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_AtenIntePlanIntegralPaciente]
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[AtenIntePlanDesarrolloPaciente] CHECK CONSTRAINT [FK_AtenIntePlanDesarrolloPaciente_Establecimientos]
GO
ALTER TABLE [dbo].[AtenIntePlanDesDetalle]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesDetalle_AtenInteItemDesarrollo] FOREIGN KEY([IdItemDesarrollo])
REFERENCES [dbo].[AtenInteItemDesarrollo] ([IdItemDesarrollo])
GO
ALTER TABLE [dbo].[AtenIntePlanDesDetalle] CHECK CONSTRAINT [FK_AtenIntePlanDesDetalle_AtenInteItemDesarrollo]
GO
ALTER TABLE [dbo].[AtenIntePlanDesDetalle]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesDetalle_AtenInteItemPlanDesarrollo] FOREIGN KEY([IdItemPlanDesarrollo])
REFERENCES [dbo].[AtenInteItemPlanDesarrollo] ([IdItemPlanDesarrollo])
GO
ALTER TABLE [dbo].[AtenIntePlanDesDetalle] CHECK CONSTRAINT [FK_AtenIntePlanDesDetalle_AtenInteItemPlanDesarrollo]
GO
ALTER TABLE [dbo].[AtenIntePlanDesPacienteDet]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesPacienteDet_AtenInteItemDesarrollo] FOREIGN KEY([IdItemDesarrollo])
REFERENCES [dbo].[AtenInteItemDesarrollo] ([IdItemDesarrollo])
GO
ALTER TABLE [dbo].[AtenIntePlanDesPacienteDet] CHECK CONSTRAINT [FK_AtenIntePlanDesPacienteDet_AtenInteItemDesarrollo]
GO
ALTER TABLE [dbo].[AtenIntePlanDesPacienteDet]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanDesPacienteDet_AtenIntePlanDesarrolloPaciente] FOREIGN KEY([IdPlanDesarrolloPaciente], [IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanDesarrolloPaciente] ([IdPlanDesarrolloPaciente], [IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanDesPacienteDet] CHECK CONSTRAINT [FK_AtenIntePlanDesPacienteDet_AtenIntePlanDesarrolloPaciente]
GO
ALTER TABLE [dbo].[AtenIntePlanIntegralPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanIntegralPaciente_AtenInteGrupo] FOREIGN KEY([IdAtenInteGrupo])
REFERENCES [dbo].[AtenInteGrupo] ([IdAtenInteGrupo])
GO
ALTER TABLE [dbo].[AtenIntePlanIntegralPaciente] CHECK CONSTRAINT [FK_AtenIntePlanIntegralPaciente_AtenInteGrupo]
GO
ALTER TABLE [dbo].[AtenIntePlanIntegralPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanIntegralPaciente_Pacientes] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanIntegralPaciente] CHECK CONSTRAINT [FK_AtenIntePlanIntegralPaciente_Pacientes]
GO
ALTER TABLE [dbo].[AtenIntePlanItemElaborado]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanItemElaborado_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlanItemElaborado] CHECK CONSTRAINT [FK_AtenIntePlanItemElaborado_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenIntePlanItemElaborado]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanItemElaborado_AtenIntePlanIntegralPaciente] FOREIGN KEY([IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanIntegralPaciente] ([IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanItemElaborado] CHECK CONSTRAINT [FK_AtenIntePlanItemElaborado_AtenIntePlanIntegralPaciente]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_Atenciones]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenIntePlanIntegralPaciente] FOREIGN KEY([IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanIntegralPaciente] ([IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_AtenIntePlanIntegralPaciente]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_FactCatalogoServicios] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanInmunizacionPaciente_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanProcedimientoPaciente_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[AtenIntePlanProcedimientoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanProcedimientoPaciente_Establecimientos]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_Atenciones]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenIntePlanAtencion] FOREIGN KEY([IdPlanAtencion])
REFERENCES [dbo].[AtenIntePlanAtencion] ([IdPlanAtencion])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenIntePlanAtencion]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenIntePlanIntegralPaciente1] FOREIGN KEY([IdPlanIntegralPaciente])
REFERENCES [dbo].[AtenIntePlanIntegralPaciente] ([IdPlanIntegralPaciente])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_AtenIntePlanIntegralPaciente1]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_Establecimientos]
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_FactCatalogoBienesInsumos] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[AtenIntePlanSuplementoPaciente] CHECK CONSTRAINT [FK_AtenIntePlanSuplementoPaciente_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[AtenIntePlantillaItemPlan]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlantillaItemPlan_AtenInteGrupo] FOREIGN KEY([IdAtenInteGrupo])
REFERENCES [dbo].[AtenInteGrupo] ([IdAtenInteGrupo])
GO
ALTER TABLE [dbo].[AtenIntePlantillaItemPlan] CHECK CONSTRAINT [FK_AtenIntePlantillaItemPlan_AtenInteGrupo]
GO
ALTER TABLE [dbo].[AtenIntePlantillaItemPlan]  WITH CHECK ADD  CONSTRAINT [FK_AtenIntePlantillaItemPlan_AtenInteItemPlan] FOREIGN KEY([IdAtenInteItemPlan])
REFERENCES [dbo].[AtenInteItemPlan] ([IdAtenInteItemPlan])
GO
ALTER TABLE [dbo].[AtenIntePlantillaItemPlan] CHECK CONSTRAINT [FK_AtenIntePlantillaItemPlan_AtenInteItemPlan]
GO
ALTER TABLE [dbo].[Auditoria]  WITH NOCHECK ADD  CONSTRAINT [Empleados_Auditoria_FK1] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[Auditoria] CHECK CONSTRAINT [Empleados_Auditoria_FK1]
GO
ALTER TABLE [dbo].[CajaCajeroSupervisor]  WITH NOCHECK ADD  CONSTRAINT [FK_CajaCajeroSupervisor_CajaTurno] FOREIGN KEY([IdTurno])
REFERENCES [dbo].[CajaTurno] ([IdTurno])
GO
ALTER TABLE [dbo].[CajaCajeroSupervisor] CHECK CONSTRAINT [FK_CajaCajeroSupervisor_CajaTurno]
GO
ALTER TABLE [dbo].[CajaComprobantesPago]  WITH NOCHECK ADD  CONSTRAINT [CajaLote_CajaDocumento_FK1] FOREIGN KEY([IdGestionCaja])
REFERENCES [dbo].[CajaGestion] ([IdGestionCaja])
GO
ALTER TABLE [dbo].[CajaComprobantesPago] CHECK CONSTRAINT [CajaLote_CajaDocumento_FK1]
GO
ALTER TABLE [dbo].[CajaComprobantesPago]  WITH NOCHECK ADD  CONSTRAINT [CajasTiposOrden_CajaComprobantesPago_FK1] FOREIGN KEY([IdTipoOrden])
REFERENCES [dbo].[CajasTiposOrden] ([IdTipoOrden])
GO
ALTER TABLE [dbo].[CajaComprobantesPago] CHECK CONSTRAINT [CajasTiposOrden_CajaComprobantesPago_FK1]
GO
ALTER TABLE [dbo].[CajaComprobantesPago]  WITH NOCHECK ADD  CONSTRAINT [CajaTiposDocumento_CajaDocumento_FK1] FOREIGN KEY([IdTipoComprobante])
REFERENCES [dbo].[CajaTiposComprobante] ([IdTipoComprobante])
GO
ALTER TABLE [dbo].[CajaComprobantesPago] CHECK CONSTRAINT [CajaTiposDocumento_CajaDocumento_FK1]
GO
ALTER TABLE [dbo].[CajaComprobantesPago]  WITH NOCHECK ADD  CONSTRAINT [CuentasAtencion_CajaDocumento_FK1] FOREIGN KEY([IdCuentaAtencion])
REFERENCES [dbo].[FacturacionCuentasAtencion] ([IdCuentaAtencion])
GO
ALTER TABLE [dbo].[CajaComprobantesPago] CHECK CONSTRAINT [CuentasAtencion_CajaDocumento_FK1]
GO
ALTER TABLE [dbo].[CajaDevoluciones]  WITH CHECK ADD FOREIGN KEY([idComprobantePago])
REFERENCES [dbo].[CajaComprobantesPago] ([IdComprobantePago])
GO
ALTER TABLE [dbo].[CajaGestion]  WITH NOCHECK ADD  CONSTRAINT [CajaCaja_CajaLote_FK1] FOREIGN KEY([IdCaja])
REFERENCES [dbo].[CajaCaja] ([IdCaja])
GO
ALTER TABLE [dbo].[CajaGestion] CHECK CONSTRAINT [CajaCaja_CajaLote_FK1]
GO
ALTER TABLE [dbo].[CajaGestion]  WITH NOCHECK ADD  CONSTRAINT [Empleados_CajaCajero_FK1] FOREIGN KEY([IdCajero])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[CajaGestion] CHECK CONSTRAINT [Empleados_CajaCajero_FK1]
GO
ALTER TABLE [dbo].[CajaGestion]  WITH NOCHECK ADD  CONSTRAINT [FK_CajaGestion_CajaTurno] FOREIGN KEY([IdTurno])
REFERENCES [dbo].[CajaTurno] ([IdTurno])
GO
ALTER TABLE [dbo].[CajaGestion] CHECK CONSTRAINT [FK_CajaGestion_CajaTurno]
GO
ALTER TABLE [dbo].[CajaNroDocumento]  WITH NOCHECK ADD  CONSTRAINT [CajaNroDocumento_CajaCaja_FK1] FOREIGN KEY([IdCaja])
REFERENCES [dbo].[CajaCaja] ([IdCaja])
GO
ALTER TABLE [dbo].[CajaNroDocumento] CHECK CONSTRAINT [CajaNroDocumento_CajaCaja_FK1]
GO
ALTER TABLE [dbo].[CajaNroDocumento]  WITH NOCHECK ADD  CONSTRAINT [CajaNroDocumento_CajaDocumento_FK2] FOREIGN KEY([IdTipoComprobante])
REFERENCES [dbo].[CajaTiposComprobante] ([IdTipoComprobante])
GO
ALTER TABLE [dbo].[CajaNroDocumento] CHECK CONSTRAINT [CajaNroDocumento_CajaDocumento_FK2]
GO
ALTER TABLE [dbo].[Camas]  WITH NOCHECK ADD  CONSTRAINT [EstadosCama_Camas_FK1] FOREIGN KEY([IdEstadoCama])
REFERENCES [dbo].[EstadosCama] ([IdEstadoCama])
GO
ALTER TABLE [dbo].[Camas] CHECK CONSTRAINT [EstadosCama_Camas_FK1]
GO
ALTER TABLE [dbo].[Camas]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_Camas_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[Camas] CHECK CONSTRAINT [Pacientes_Camas_FK1]
GO
ALTER TABLE [dbo].[Camas]  WITH NOCHECK ADD  CONSTRAINT [TiposCama_Camas_FK1] FOREIGN KEY([IdTiposCama])
REFERENCES [dbo].[TiposCama] ([IdTipoCama])
GO
ALTER TABLE [dbo].[Camas] CHECK CONSTRAINT [TiposCama_Camas_FK1]
GO
ALTER TABLE [dbo].[Camas]  WITH NOCHECK ADD  CONSTRAINT [TiposCondicionOcupacion_Camas_FK1] FOREIGN KEY([IdCondicionOcupacion])
REFERENCES [dbo].[TiposCondicionOcupacion] ([IdCondicionOcupacion])
GO
ALTER TABLE [dbo].[Camas] CHECK CONSTRAINT [TiposCondicionOcupacion_Camas_FK1]
GO
ALTER TABLE [dbo].[camasMovimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_camasMovimientos_Camas] FOREIGN KEY([idCama])
REFERENCES [dbo].[Camas] ([IdCama])
GO
ALTER TABLE [dbo].[camasMovimientos] CHECK CONSTRAINT [FK_camasMovimientos_Camas]
GO
ALTER TABLE [dbo].[CentrosPoblados]  WITH NOCHECK ADD  CONSTRAINT [Distritos_CentrosPoblados_FK1] FOREIGN KEY([IdDistrito])
REFERENCES [dbo].[Distritos] ([IdDistrito])
GO
ALTER TABLE [dbo].[CentrosPoblados] CHECK CONSTRAINT [Distritos_CentrosPoblados_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_Citas_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [Especialidades_Citas_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [FK_Citas_Atenciones] FOREIGN KEY([IdAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [FK_Citas_Atenciones]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [Medicos_Citas_FK1] FOREIGN KEY([IdMedico])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [Medicos_Citas_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_Citas_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [Pacientes_Citas_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [ProgramacionMedica_Citas_FK1] FOREIGN KEY([IdProgramacion])
REFERENCES [dbo].[ProgramacionMedica] ([IdProgramacion])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [ProgramacionMedica_Citas_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [Servicios_Citas_FK1] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [Servicios_Citas_FK1]
GO
ALTER TABLE [dbo].[Citas]  WITH NOCHECK ADD  CONSTRAINT [TiposEstadosCita_Citas_FK1] FOREIGN KEY([IdEstadoCita])
REFERENCES [dbo].[TiposEstadosCita] ([IdEstadoCita])
GO
ALTER TABLE [dbo].[Citas] CHECK CONSTRAINT [TiposEstadosCita_Citas_FK1]
GO
ALTER TABLE [dbo].[Diagnosticos]  WITH NOCHECK ADD  CONSTRAINT [DiagnosticosCapitulos_Diagnosticos_FK1] FOREIGN KEY([IdCapitulo])
REFERENCES [dbo].[DiagnosticosCapitulos] ([IdCapitulo])
GO
ALTER TABLE [dbo].[Diagnosticos] CHECK CONSTRAINT [DiagnosticosCapitulos_Diagnosticos_FK1]
GO
ALTER TABLE [dbo].[Diagnosticos]  WITH NOCHECK ADD  CONSTRAINT [DiagnosticosCategorias_Diagnosticos_FK1] FOREIGN KEY([IdCategoria])
REFERENCES [dbo].[DiagnosticosCategorias] ([IdCategoria])
GO
ALTER TABLE [dbo].[Diagnosticos] CHECK CONSTRAINT [DiagnosticosCategorias_Diagnosticos_FK1]
GO
ALTER TABLE [dbo].[Diagnosticos]  WITH NOCHECK ADD  CONSTRAINT [DiagnosticosGrupos_Diagnosticos_FK1] FOREIGN KEY([IdGrupo])
REFERENCES [dbo].[DiagnosticosGrupos] ([IdGrupo])
GO
ALTER TABLE [dbo].[Diagnosticos] CHECK CONSTRAINT [DiagnosticosGrupos_Diagnosticos_FK1]
GO
ALTER TABLE [dbo].[Diagnosticos]  WITH NOCHECK ADD  CONSTRAINT [TiposSexo_Diagnosticos_FK1] FOREIGN KEY([IdTipoSexo])
REFERENCES [dbo].[TiposSexo] ([IdTipoSexo])
GO
ALTER TABLE [dbo].[Diagnosticos] CHECK CONSTRAINT [TiposSexo_Diagnosticos_FK1]
GO
ALTER TABLE [dbo].[DiagnosticosCategorias]  WITH NOCHECK ADD  CONSTRAINT [DiagnosticosGrupos_DiagnosticosCategorias_FK1] FOREIGN KEY([IdGrupo])
REFERENCES [dbo].[DiagnosticosGrupos] ([IdGrupo])
GO
ALTER TABLE [dbo].[DiagnosticosCategorias] CHECK CONSTRAINT [DiagnosticosGrupos_DiagnosticosCategorias_FK1]
GO
ALTER TABLE [dbo].[DiagnosticosGrupos]  WITH NOCHECK ADD  CONSTRAINT [DiagnosticosCapitulos_DiagnosticosGrupos_FK1] FOREIGN KEY([IdCapitulo])
REFERENCES [dbo].[DiagnosticosCapitulos] ([IdCapitulo])
GO
ALTER TABLE [dbo].[DiagnosticosGrupos] CHECK CONSTRAINT [DiagnosticosCapitulos_DiagnosticosGrupos_FK1]
GO
ALTER TABLE [dbo].[Distritos]  WITH NOCHECK ADD  CONSTRAINT [Provincias_Distritos_FK1] FOREIGN KEY([IdProvincia])
REFERENCES [dbo].[Provincias] ([IdProvincia])
GO
ALTER TABLE [dbo].[Distritos] CHECK CONSTRAINT [Provincias_Distritos_FK1]
GO
ALTER TABLE [dbo].[Empleados]  WITH NOCHECK ADD  CONSTRAINT [TiposCondicionTrabajo_Empleados_FK1] FOREIGN KEY([IdCondicionTrabajo])
REFERENCES [dbo].[TiposCondicionTrabajo] ([IdCondicionTrabajo])
GO
ALTER TABLE [dbo].[Empleados] CHECK CONSTRAINT [TiposCondicionTrabajo_Empleados_FK1]
GO
ALTER TABLE [dbo].[Empleados]  WITH NOCHECK ADD  CONSTRAINT [TiposEmpleado_Empleados_FK1] FOREIGN KEY([IdTipoEmpleado])
REFERENCES [dbo].[TiposEmpleado] ([IdTipoEmpleado])
GO
ALTER TABLE [dbo].[Empleados] CHECK CONSTRAINT [TiposEmpleado_Empleados_FK1]
GO
ALTER TABLE [dbo].[Enfermeria_CatalogoValoresCombo]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_CatalogoVariables_Enfermeria_CatalogoValoresCombo] FOREIGN KEY([IdVariable])
REFERENCES [dbo].[Enfermeria_CatalogoVariables] ([IdVariable])
GO
ALTER TABLE [dbo].[Enfermeria_CatalogoValoresCombo] CHECK CONSTRAINT [FK_Enfermeria_CatalogoVariables_Enfermeria_CatalogoValoresCombo]
GO
ALTER TABLE [dbo].[Enfermeria_CatalogoVariables]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_CatalogoVariables_Enfermeria_CatalogoDominios] FOREIGN KEY([IdDominio])
REFERENCES [dbo].[Enfermeria_CatalogoDominios] ([IdDominio])
GO
ALTER TABLE [dbo].[Enfermeria_CatalogoVariables] CHECK CONSTRAINT [FK_Enfermeria_CatalogoVariables_Enfermeria_CatalogoDominios]
GO
ALTER TABLE [dbo].[Enfermeria_TratamientoDosis]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_TratamientoDosis_Enfermeria_Visitas] FOREIGN KEY([IdCuentaAtencion], [IdVisita])
REFERENCES [dbo].[Enfermeria_Visitas] ([IdCuentaAtencion], [IdVisita])
GO
ALTER TABLE [dbo].[Enfermeria_TratamientoDosis] CHECK CONSTRAINT [FK_Enfermeria_TratamientoDosis_Enfermeria_Visitas]
GO
ALTER TABLE [dbo].[Enfermeria_TratamientoDosis]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_TratamientoDosis_RecetaDetalle] FOREIGN KEY([IdReceta], [IdItem])
REFERENCES [dbo].[RecetaDetalle] ([idReceta], [idItem])
GO
ALTER TABLE [dbo].[Enfermeria_TratamientoDosis] CHECK CONSTRAINT [FK_Enfermeria_TratamientoDosis_RecetaDetalle]
GO
ALTER TABLE [dbo].[Enfermeria_ValoresCombo]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_ValoresCombo_Enfermeria_CatalogoValoresCombo] FOREIGN KEY([IdVariable], [IdValorCombo])
REFERENCES [dbo].[Enfermeria_CatalogoValoresCombo] ([IdVariable], [IdValorCombo])
GO
ALTER TABLE [dbo].[Enfermeria_ValoresCombo] CHECK CONSTRAINT [FK_Enfermeria_ValoresCombo_Enfermeria_CatalogoValoresCombo]
GO
ALTER TABLE [dbo].[Enfermeria_ValoresCombo]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_ValoresCombo_Enfermeria_Variables] FOREIGN KEY([IdCuentaAtencion], [IdVisita], [IdVariable])
REFERENCES [dbo].[Enfermeria_Variables] ([IdCuentaAtencion], [IdVisita], [IdVariable])
GO
ALTER TABLE [dbo].[Enfermeria_ValoresCombo] CHECK CONSTRAINT [FK_Enfermeria_ValoresCombo_Enfermeria_Variables]
GO
ALTER TABLE [dbo].[Enfermeria_Variables]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_Variables_Enfermeria_CatalogoVariables] FOREIGN KEY([IdVariable])
REFERENCES [dbo].[Enfermeria_CatalogoVariables] ([IdVariable])
GO
ALTER TABLE [dbo].[Enfermeria_Variables] CHECK CONSTRAINT [FK_Enfermeria_Variables_Enfermeria_CatalogoVariables]
GO
ALTER TABLE [dbo].[Enfermeria_Variables]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_Variables_Enfermeria_Visitas] FOREIGN KEY([IdCuentaAtencion], [IdVisita])
REFERENCES [dbo].[Enfermeria_Visitas] ([IdCuentaAtencion], [IdVisita])
GO
ALTER TABLE [dbo].[Enfermeria_Variables] CHECK CONSTRAINT [FK_Enfermeria_Variables_Enfermeria_Visitas]
GO
ALTER TABLE [dbo].[Enfermeria_Visitas]  WITH CHECK ADD  CONSTRAINT [FK_Enfermeria_Visitas_FacturacionCuentasAtencion] FOREIGN KEY([IdCuentaAtencion])
REFERENCES [dbo].[FacturacionCuentasAtencion] ([IdCuentaAtencion])
GO
ALTER TABLE [dbo].[Enfermeria_Visitas] CHECK CONSTRAINT [FK_Enfermeria_Visitas_FacturacionCuentasAtencion]
GO
ALTER TABLE [dbo].[EspecialidadCE]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServicios_EspecialidadCE_FK1] FOREIGN KEY([IdProductoConsulta])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[EspecialidadCE] CHECK CONSTRAINT [CatalogoServicios_EspecialidadCE_FK1]
GO
ALTER TABLE [dbo].[EspecialidadCE]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServicios_EspecialidadCE_FK2] FOREIGN KEY([IdProductoInterconsulta])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[EspecialidadCE] CHECK CONSTRAINT [CatalogoServicios_EspecialidadCE_FK2]
GO
ALTER TABLE [dbo].[EspecialidadCE]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_EspecialidadCE_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[EspecialidadCE] CHECK CONSTRAINT [Especialidades_EspecialidadCE_FK1]
GO
ALTER TABLE [dbo].[Especialidades]  WITH NOCHECK ADD  CONSTRAINT [DepartamentosHospital_Especialidades_FK1] FOREIGN KEY([IdDepartamento])
REFERENCES [dbo].[DepartamentosHospital] ([IdDepartamento])
GO
ALTER TABLE [dbo].[Especialidades] CHECK CONSTRAINT [DepartamentosHospital_Especialidades_FK1]
GO
ALTER TABLE [dbo].[Establecimientos]  WITH NOCHECK ADD  CONSTRAINT [Distritos_Establecimientos_FK1] FOREIGN KEY([IdDistrito])
REFERENCES [dbo].[Distritos] ([IdDistrito])
GO
ALTER TABLE [dbo].[Establecimientos] CHECK CONSTRAINT [Distritos_Establecimientos_FK1]
GO
ALTER TABLE [dbo].[Establecimientos]  WITH NOCHECK ADD  CONSTRAINT [TiposEstablecimientos_Establecimientos_FK1] FOREIGN KEY([IdTipo])
REFERENCES [dbo].[TiposEstablecimientos] ([IdTipo])
GO
ALTER TABLE [dbo].[Establecimientos] CHECK CONSTRAINT [TiposEstablecimientos_Establecimientos_FK1]
GO
ALTER TABLE [dbo].[EstablecimientosNoMinsa]  WITH NOCHECK ADD  CONSTRAINT [TiposSubsector_EstablecimientosNoMinsa_FK1] FOREIGN KEY([IdTipoSubsector])
REFERENCES [dbo].[TiposSubsector] ([IdTipoSubsector])
GO
ALTER TABLE [dbo].[EstablecimientosNoMinsa] CHECK CONSTRAINT [TiposSubsector_EstablecimientosNoMinsa_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [CentrosCosto_CatalogoBienesInsumos_FK1] FOREIGN KEY([IdCentroCosto])
REFERENCES [dbo].[CentrosCosto] ([IdCentroCosto])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos] CHECK CONSTRAINT [CentrosCosto_CatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactCatalogoBienesInsumos_farmTipoSalidaBienInsumo] FOREIGN KEY([idTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos] CHECK CONSTRAINT [FK_FactCatalogoBienesInsumos_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [InsumosGrupoFarmacologico_CatalogoBienesInsumos_FK1] FOREIGN KEY([IdGrupoFarmacologico])
REFERENCES [dbo].[FactInsumosGrupoFarmacologico] ([IdGrupoFarmacologico])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos] CHECK CONSTRAINT [InsumosGrupoFarmacologico_CatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [InsumosSubGrupoFarmacologico_CatalogoBienesInsumos_FK1] FOREIGN KEY([IdSubGrupoFarmacologico])
REFERENCES [dbo].[FactInsumosSubGrupoFarmacologico] ([IdSubGrupoFarmacologico])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos] CHECK CONSTRAINT [InsumosSubGrupoFarmacologico_CatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [PartidasPresupuestales_CatalogoBienesInsumos_FK1] FOREIGN KEY([IdPartida])
REFERENCES [dbo].[FactPartidasPresupuestales] ([IdPartidaPresupuestal])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumos] CHECK CONSTRAINT [PartidasPresupuestales_CatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumosHosp]  WITH NOCHECK ADD  CONSTRAINT [CatalogoBienesInsumos_PlanesCatalogoBienesInsumos_FK1] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumosHosp] CHECK CONSTRAINT [CatalogoBienesInsumos_PlanesCatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumosHosp]  WITH NOCHECK ADD  CONSTRAINT [TiposFinanciamiento_FinanciamientoCatalogoBienesInsumos_FK1] FOREIGN KEY([IdTipoFinanciamiento])
REFERENCES [dbo].[TiposFinanciamiento] ([IdTipoFinanciamiento])
GO
ALTER TABLE [dbo].[FactCatalogoBienesInsumosHosp] CHECK CONSTRAINT [TiposFinanciamiento_FinanciamientoCatalogoBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServiciosGrupo_CatalogoServicios_FK1] FOREIGN KEY([IdServicioGrupo])
REFERENCES [dbo].[FactCatalogoServiciosGrupo] ([IdServicioGrupo])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [CatalogoServiciosGrupo_CatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServiciosSeccion_CatalogoServicios_FK1] FOREIGN KEY([IdServicioSeccion])
REFERENCES [dbo].[FactCatalogoServiciosSeccion] ([IdServicioSeccion])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [CatalogoServiciosSeccion_CatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServiciosSubSeccion_CatalogoServicios_FK1] FOREIGN KEY([IdServicioSubSeccion])
REFERENCES [dbo].[FactCatalogoServiciosSubSeccion] ([IdServicioSubSeccion])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [CatalogoServiciosSubSeccion_CatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [CentrosCosto_CatalogoServicios_FK1] FOREIGN KEY([IdCentroCosto])
REFERENCES [dbo].[CentrosCosto] ([IdCentroCosto])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [CentrosCosto_CatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServiciosSubGrupo_FactCatalogoServicios_FK1] FOREIGN KEY([IdServicioSubGrupo])
REFERENCES [dbo].[FactCatalogoServiciosSubGrupo] ([IdServicioSubGrupo])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [FactCatalogoServiciosSubGrupo_FactCatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServicios]  WITH NOCHECK ADD  CONSTRAINT [PartidasPresupuestales_CatalogoServicios_FK1] FOREIGN KEY([IdPartida])
REFERENCES [dbo].[FactPartidasPresupuestales] ([IdPartidaPresupuestal])
GO
ALTER TABLE [dbo].[FactCatalogoServicios] CHECK CONSTRAINT [PartidasPresupuestales_CatalogoServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosHosp]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServicios_PlanesCatalogosServicios_FK1] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosHosp] CHECK CONSTRAINT [CatalogoServicios_PlanesCatalogosServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosHosp]  WITH NOCHECK ADD  CONSTRAINT [TiposFinanciamiento_FinanciamientoCatalogosServicios_FK1] FOREIGN KEY([IdTipoFinanciamiento])
REFERENCES [dbo].[TiposFinanciamiento] ([IdTipoFinanciamiento])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosHosp] CHECK CONSTRAINT [TiposFinanciamiento_FinanciamientoCatalogosServicios_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosPtos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactCatalogoServiciosCpt_FactCatalogoServicios] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosPtos] CHECK CONSTRAINT [FK_FactCatalogoServiciosCpt_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosPtos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactCatalogoServiciosCpt_FactPuntosCarga] FOREIGN KEY([idPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosPtos] CHECK CONSTRAINT [FK_FactCatalogoServiciosCpt_FactPuntosCarga]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSeccion]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServiciosSubGrupo_FactCatalogoServiciosSeccion_FK1] FOREIGN KEY([IdServicioSubGrupo])
REFERENCES [dbo].[FactCatalogoServiciosSubGrupo] ([IdServicioSubGrupo])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSeccion] CHECK CONSTRAINT [FactCatalogoServiciosSubGrupo_FactCatalogoServiciosSeccion_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSubGrupo]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServiciosGrupo_CatalogoServiciosSeccion_FK1] FOREIGN KEY([IdServicioGrupo])
REFERENCES [dbo].[FactCatalogoServiciosGrupo] ([IdServicioGrupo])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSubGrupo] CHECK CONSTRAINT [CatalogoServiciosGrupo_CatalogoServiciosSeccion_FK1]
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSubSeccion]  WITH NOCHECK ADD  CONSTRAINT [CatalogoServiciosSeccion_CatalogoServiciosSubSeccion_FK1] FOREIGN KEY([IdServicioSeccion])
REFERENCES [dbo].[FactCatalogoServiciosSeccion] ([IdServicioSeccion])
GO
ALTER TABLE [dbo].[FactCatalogoServiciosSubSeccion] CHECK CONSTRAINT [CatalogoServiciosSeccion_CatalogoServiciosSubSeccion_FK1]
GO
ALTER TABLE [dbo].[FactInsumosSubGrupoFarmacologico]  WITH NOCHECK ADD  CONSTRAINT [InsumosGrupoFarmacologico_InsumosSubGrupoFarmacologico_FK1] FOREIGN KEY([IdGrupoFarmacologico])
REFERENCES [dbo].[FactInsumosGrupoFarmacologico] ([IdGrupoFarmacologico])
GO
ALTER TABLE [dbo].[FactInsumosSubGrupoFarmacologico] CHECK CONSTRAINT [InsumosGrupoFarmacologico_InsumosSubGrupoFarmacologico_FK1]
GO
ALTER TABLE [dbo].[FactOrdenesBienes]  WITH NOCHECK ADD  CONSTRAINT [FK_FactOrdenesBienes_CajaComprobantesPago] FOREIGN KEY([idComprobantePago])
REFERENCES [dbo].[CajaComprobantesPago] ([IdComprobantePago])
GO
ALTER TABLE [dbo].[FactOrdenesBienes] CHECK CONSTRAINT [FK_FactOrdenesBienes_CajaComprobantesPago]
GO
ALTER TABLE [dbo].[FactOrdenesBienes]  WITH NOCHECK ADD  CONSTRAINT [FK_FactOrdenesBienes_farmMovimientoVentas] FOREIGN KEY([MovNumero], [MovTipo])
REFERENCES [dbo].[farmMovimientoVentas] ([movNumero], [movTipo])
GO
ALTER TABLE [dbo].[FactOrdenesBienes] CHECK CONSTRAINT [FK_FactOrdenesBienes_farmMovimientoVentas]
GO
ALTER TABLE [dbo].[FactOrdenServicioPagos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactOrdenServicioPagos_CajaComprobantesPago] FOREIGN KEY([idComprobantePago])
REFERENCES [dbo].[CajaComprobantesPago] ([IdComprobantePago])
GO
ALTER TABLE [dbo].[FactOrdenServicioPagos] CHECK CONSTRAINT [FK_FactOrdenServicioPagos_CajaComprobantesPago]
GO
ALTER TABLE [dbo].[FactPartidasPresupuestales]  WITH NOCHECK ADD  CONSTRAINT [FactPartidasSeccion_FactPartidasPresupuestales_FK1] FOREIGN KEY([IdPartidaSeccion])
REFERENCES [dbo].[FactPartidasSeccion] ([IdPartidaSeccion])
GO
ALTER TABLE [dbo].[FactPartidasPresupuestales] CHECK CONSTRAINT [FactPartidasSeccion_FactPartidasPresupuestales_FK1]
GO
ALTER TABLE [dbo].[FactPreventa]  WITH NOCHECK ADD  CONSTRAINT [FK_FactPreventa_Atenciones] FOREIGN KEY([idAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[FactPreventa] CHECK CONSTRAINT [FK_FactPreventa_Atenciones]
GO
ALTER TABLE [dbo].[FactPreventa]  WITH NOCHECK ADD  CONSTRAINT [FK_FactPreventa_FactOrdenServicio] FOREIGN KEY([idOrden])
REFERENCES [dbo].[FactOrdenServicio] ([IdOrden])
GO
ALTER TABLE [dbo].[FactPreventa] CHECK CONSTRAINT [FK_FactPreventa_FactOrdenServicio]
GO
ALTER TABLE [dbo].[FactPreventa]  WITH NOCHECK ADD  CONSTRAINT [FK_FactPreventa_farmEstadosPreventa] FOREIGN KEY([idEstadoPreventa])
REFERENCES [dbo].[farmEstadosPreventa] ([idEstadoPreventa])
GO
ALTER TABLE [dbo].[FactPreventa] CHECK CONSTRAINT [FK_FactPreventa_farmEstadosPreventa]
GO
ALTER TABLE [dbo].[FactPuntosCarga]  WITH NOCHECK ADD  CONSTRAINT [FK_FactPuntosCarga_UPServicios] FOREIGN KEY([IdUPS])
REFERENCES [dbo].[UPServicios] ([IdUPS])
GO
ALTER TABLE [dbo].[FactPuntosCarga] CHECK CONSTRAINT [FK_FactPuntosCarga_UPServicios]
GO
ALTER TABLE [dbo].[FactPuntosCargaBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [FactInsumosSubGrupoFarmacologico_FactPuntosCargaBienesInsumos_FK1] FOREIGN KEY([IdSubGrupoFarmacologico])
REFERENCES [dbo].[FactInsumosSubGrupoFarmacologico] ([IdSubGrupoFarmacologico])
GO
ALTER TABLE [dbo].[FactPuntosCargaBienesInsumos] CHECK CONSTRAINT [FactInsumosSubGrupoFarmacologico_FactPuntosCargaBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactPuntosCargaBienesInsumos]  WITH NOCHECK ADD  CONSTRAINT [FactPuntosCarga_FactPuntosCargaBienesInsumos_FK1] FOREIGN KEY([IdPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[FactPuntosCargaBienesInsumos] CHECK CONSTRAINT [FactPuntosCarga_FactPuntosCargaBienesInsumos_FK1]
GO
ALTER TABLE [dbo].[FactPuntosCargaServicio]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServiciosSubGrupo_FactPuntosCargaServicio_FK1] FOREIGN KEY([IdServicioSubGrupo])
REFERENCES [dbo].[FactCatalogoServiciosSubGrupo] ([IdServicioSubGrupo])
GO
ALTER TABLE [dbo].[FactPuntosCargaServicio] CHECK CONSTRAINT [FactCatalogoServiciosSubGrupo_FactPuntosCargaServicio_FK1]
GO
ALTER TABLE [dbo].[FactPuntosCargaServicio]  WITH NOCHECK ADD  CONSTRAINT [FactPuntosCarga_FactPuntosCargaServicio_FK1] FOREIGN KEY([IdPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[FactPuntosCargaServicio] CHECK CONSTRAINT [FactPuntosCarga_FactPuntosCargaServicio_FK1]
GO
ALTER TABLE [dbo].[FactReembolsos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactReembolsos_AreaTramitaSeguros] FOREIGN KEY([idAreaTramitaSeguro])
REFERENCES [dbo].[AreaTramitaSeguros] ([idAreaTramitaSeguros])
GO
ALTER TABLE [dbo].[FactReembolsos] CHECK CONSTRAINT [FK_FactReembolsos_AreaTramitaSeguros]
GO
ALTER TABLE [dbo].[FactReembolsos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactReembolsos_EstadosReembolso] FOREIGN KEY([idEstadoReembolso])
REFERENCES [dbo].[EstadosReembolso] ([idEstadoReembolso])
GO
ALTER TABLE [dbo].[FactReembolsos] CHECK CONSTRAINT [FK_FactReembolsos_EstadosReembolso]
GO
ALTER TABLE [dbo].[FactReembolsos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactReembolsos_FuentesFinanciamiento] FOREIGN KEY([idFuenteFinanciamiento])
REFERENCES [dbo].[FuentesFinanciamiento] ([IdFuenteFinanciamiento])
GO
ALTER TABLE [dbo].[FactReembolsos] CHECK CONSTRAINT [FK_FactReembolsos_FuentesFinanciamiento]
GO
ALTER TABLE [dbo].[FactReembolsosDocumentos]  WITH NOCHECK ADD  CONSTRAINT [FK_FactReembolsosDocumentos_FactReembolsos] FOREIGN KEY([idFactReembolso])
REFERENCES [dbo].[FactReembolsos] ([idFactReembolso])
GO
ALTER TABLE [dbo].[FactReembolsosDocumentos] CHECK CONSTRAINT [FK_FactReembolsosDocumentos_FactReembolsos]
GO
ALTER TABLE [dbo].[FacturacionBienesFinanciamientos]  WITH NOCHECK ADD  CONSTRAINT [FarmMovimientoVentas_FacturacionBienesFinanciamientos_FK1] FOREIGN KEY([MovNumero], [MovTipo])
REFERENCES [dbo].[farmMovimientoVentas] ([movNumero], [movTipo])
GO
ALTER TABLE [dbo].[FacturacionBienesFinanciamientos] CHECK CONSTRAINT [FarmMovimientoVentas_FacturacionBienesFinanciamientos_FK1]
GO
ALTER TABLE [dbo].[FacturacionBienesFinanciamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionBienesFinanciamientos_farmMovimientoVentasDetalle] FOREIGN KEY([MovNumero], [MovTipo], [IdProducto])
REFERENCES [dbo].[farmMovimientoVentasDetalle] ([MovNumero], [MovTipo], [idProducto])
GO
ALTER TABLE [dbo].[FacturacionBienesFinanciamientos] CHECK CONSTRAINT [FK_FacturacionBienesFinanciamientos_farmMovimientoVentasDetalle]
GO
ALTER TABLE [dbo].[FacturacionBienesPagos]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionBienesPagos_FactOrdenesBienes] FOREIGN KEY([IdOrden])
REFERENCES [dbo].[FactOrdenesBienes] ([idOrden])
GO
ALTER TABLE [dbo].[FacturacionBienesPagos] CHECK CONSTRAINT [FK_FacturacionBienesPagos_FactOrdenesBienes]
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionCatalogoPaquetes_Especialidades] FOREIGN KEY([idEspecialidadServicio])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes] CHECK CONSTRAINT [FK_FacturacionCatalogoPaquetes_Especialidades]
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionCatalogoPaquetes_FactCatalogoPaquete] FOREIGN KEY([idFactPaquete])
REFERENCES [dbo].[FactCatalogoPaquete] ([idFactPaquete])
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes] CHECK CONSTRAINT [FK_FacturacionCatalogoPaquetes_FactCatalogoPaquete]
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionCatalogoPaquetes_FactPuntosCarga] FOREIGN KEY([idPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[FacturacionCatalogoPaquetes] CHECK CONSTRAINT [FK_FacturacionCatalogoPaquetes_FactPuntosCarga]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion]  WITH NOCHECK ADD  CONSTRAINT [Empleados_FacturacionCuentasAtencion_FK1] FOREIGN KEY([IdUsuarioCrea])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion] CHECK CONSTRAINT [Empleados_FacturacionCuentasAtencion_FK1]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion]  WITH NOCHECK ADD  CONSTRAINT [Empleados_FacturacionCuentasAtencion_FK2] FOREIGN KEY([IdUsuarioModifica])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion] CHECK CONSTRAINT [Empleados_FacturacionCuentasAtencion_FK2]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion]  WITH NOCHECK ADD  CONSTRAINT [EstadosCuenta_CuentasAtencion_FK1] FOREIGN KEY([IdEstado])
REFERENCES [dbo].[EstadosCuenta] ([IdEstado])
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion] CHECK CONSTRAINT [EstadosCuenta_CuentasAtencion_FK1]
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_CuentasAtencion_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[FacturacionCuentasAtencion] CHECK CONSTRAINT [Pacientes_CuentasAtencion_FK1]
GO
ALTER TABLE [dbo].[FacturacionPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPaquetes_CajaComprobantesPago] FOREIGN KEY([idComprobantePago])
REFERENCES [dbo].[CajaComprobantesPago] ([IdComprobantePago])
GO
ALTER TABLE [dbo].[FacturacionPaquetes] CHECK CONSTRAINT [FK_FacturacionPaquetes_CajaComprobantesPago]
GO
ALTER TABLE [dbo].[FacturacionPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPaquetes_Especialidades] FOREIGN KEY([idEspecialidadServicio])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[FacturacionPaquetes] CHECK CONSTRAINT [FK_FacturacionPaquetes_Especialidades]
GO
ALTER TABLE [dbo].[FacturacionPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPaquetes_FactCatalogoPaquete] FOREIGN KEY([idFactPaquete])
REFERENCES [dbo].[FactCatalogoPaquete] ([idFactPaquete])
GO
ALTER TABLE [dbo].[FacturacionPaquetes] CHECK CONSTRAINT [FK_FacturacionPaquetes_FactCatalogoPaquete]
GO
ALTER TABLE [dbo].[FacturacionPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPaquetes_FactCatalogoServicios] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[FacturacionPaquetes] CHECK CONSTRAINT [FK_FacturacionPaquetes_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[FacturacionPaquetes]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPaquetes_FactOrdenServicioPagos] FOREIGN KEY([idOrdenPago])
REFERENCES [dbo].[FactOrdenServicioPagos] ([idOrdenPago])
GO
ALTER TABLE [dbo].[FacturacionPaquetes] CHECK CONSTRAINT [FK_FacturacionPaquetes_FactOrdenServicioPagos]
GO
ALTER TABLE [dbo].[FacturacionPreventa]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionPreventa_FactPreventa] FOREIGN KEY([idFactPreventa])
REFERENCES [dbo].[FactPreventa] ([idFactPreventa])
GO
ALTER TABLE [dbo].[FacturacionPreventa] CHECK CONSTRAINT [FK_FacturacionPreventa_FactPreventa]
GO
ALTER TABLE [dbo].[FacturacionReembolsos]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionReembolsos_FactReembolsos] FOREIGN KEY([idFactReembolso])
REFERENCES [dbo].[FactReembolsos] ([idFactReembolso])
GO
ALTER TABLE [dbo].[FacturacionReembolsos] CHECK CONSTRAINT [FK_FacturacionReembolsos_FactReembolsos]
GO
ALTER TABLE [dbo].[FacturacionServicioDespacho]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServicios_FacturacionServicioDespacho_FK1] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[FacturacionServicioDespacho] CHECK CONSTRAINT [FactCatalogoServicios_FacturacionServicioDespacho_FK1]
GO
ALTER TABLE [dbo].[FacturacionServicioDespacho]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionServicioDespacho_FactOrdenServicio] FOREIGN KEY([idOrden])
REFERENCES [dbo].[FactOrdenServicio] ([IdOrden])
GO
ALTER TABLE [dbo].[FacturacionServicioDespacho] CHECK CONSTRAINT [FK_FacturacionServicioDespacho_FactOrdenServicio]
GO
ALTER TABLE [dbo].[FacturacionServicioDevoluciones]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionServicioDevoluciones_FacturacionServicioDespacho] FOREIGN KEY([idOrden], [idProducto])
REFERENCES [dbo].[FacturacionServicioDespacho] ([idOrden], [IdProducto])
GO
ALTER TABLE [dbo].[FacturacionServicioDevoluciones] CHECK CONSTRAINT [FK_FacturacionServicioDevoluciones_FacturacionServicioDespacho]
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServicios_FacturacionServicioFinanciamientos_FK1] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos] CHECK CONSTRAINT [FactCatalogoServicios_FacturacionServicioFinanciamientos_FK1]
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos]  WITH NOCHECK ADD  CONSTRAINT [FactOrdenServicio_FacturacionServicioFinanciamientos_FK1] FOREIGN KEY([idOrden])
REFERENCES [dbo].[FactOrdenServicio] ([IdOrden])
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos] CHECK CONSTRAINT [FactOrdenServicio_FacturacionServicioFinanciamientos_FK1]
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionServicioFinanciamientos_FacturacionServicioDespacho] FOREIGN KEY([idOrden], [idProducto])
REFERENCES [dbo].[FacturacionServicioDespacho] ([idOrden], [IdProducto])
GO
ALTER TABLE [dbo].[FacturacionServicioFinanciamientos] CHECK CONSTRAINT [FK_FacturacionServicioFinanciamientos_FacturacionServicioDespacho]
GO
ALTER TABLE [dbo].[FacturacionServicioPagos]  WITH NOCHECK ADD  CONSTRAINT [FK_FacturacionServicioPagos_FactOrdenServicioPagos] FOREIGN KEY([idOrdenPago])
REFERENCES [dbo].[FactOrdenServicioPagos] ([idOrdenPago])
GO
ALTER TABLE [dbo].[FacturacionServicioPagos] CHECK CONSTRAINT [FK_FacturacionServicioPagos_FactOrdenServicioPagos]
GO
ALTER TABLE [dbo].[farmAlmacen]  WITH NOCHECK ADD  CONSTRAINT [FK_farmAlmacen_farmTipoLocal] FOREIGN KEY([idTipoLocales])
REFERENCES [dbo].[farmTipoLocal] ([idTipoLocal])
GO
ALTER TABLE [dbo].[farmAlmacen] CHECK CONSTRAINT [FK_farmAlmacen_farmTipoLocal]
GO
ALTER TABLE [dbo].[farmAlmacen]  WITH NOCHECK ADD  CONSTRAINT [FK_farmAlmacen_farmTipoSuministro] FOREIGN KEY([idTipoSuministro])
REFERENCES [dbo].[farmTipoSuministro] ([idTipoSuministro])
GO
ALTER TABLE [dbo].[farmAlmacen] CHECK CONSTRAINT [FK_farmAlmacen_farmTipoSuministro]
GO
ALTER TABLE [dbo].[farmInventario]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventario_Empleados] FOREIGN KEY([idUsuario])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[farmInventario] CHECK CONSTRAINT [FK_farmInventario_Empleados]
GO
ALTER TABLE [dbo].[farmInventario]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventario_farmEstadosInventario] FOREIGN KEY([idEstadoInventario])
REFERENCES [dbo].[farmEstadosInventario] ([idEstadoInventario])
GO
ALTER TABLE [dbo].[farmInventario] CHECK CONSTRAINT [FK_farmInventario_farmEstadosInventario]
GO
ALTER TABLE [dbo].[farmInventario]  WITH NOCHECK ADD  CONSTRAINT [FK_farmTinvent_farmMalmacen] FOREIGN KEY([idAlmacen])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmInventario] CHECK CONSTRAINT [FK_farmTinvent_farmMalmacen]
GO
ALTER TABLE [dbo].[farmInventarioCabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventarioCabecera_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmInventarioCabecera] CHECK CONSTRAINT [FK_farmInventarioCabecera_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmInventarioCabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventarioCabecera_farmInventario] FOREIGN KEY([idInventario])
REFERENCES [dbo].[farmInventario] ([idInventario])
GO
ALTER TABLE [dbo].[farmInventarioCabecera] CHECK CONSTRAINT [FK_farmInventarioCabecera_farmInventario]
GO
ALTER TABLE [dbo].[farmInventarioDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventarioDetalle_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmInventarioDetalle] CHECK CONSTRAINT [FK_farmInventarioDetalle_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmInventarioDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmInventarioDetalle_farmInventario] FOREIGN KEY([idInventario])
REFERENCES [dbo].[farmInventario] ([idInventario])
GO
ALTER TABLE [dbo].[farmInventarioDetalle] CHECK CONSTRAINT [FK_farmInventarioDetalle_farmInventario]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_Empleados] FOREIGN KEY([idUsuario])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_Empleados]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_farmAlmacen] FOREIGN KEY([idAlmacenOrigen])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_farmAlmacen]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_farmAlmacen1] FOREIGN KEY([idAlmacenDestino])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_farmAlmacen1]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_farmEstadosMovimientos] FOREIGN KEY([idEstadoMovimiento])
REFERENCES [dbo].[farmEstadosMovimientos] ([idEstadoMovimiento])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_farmEstadosMovimientos]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_farmTipoConceptos] FOREIGN KEY([idTipoConcepto])
REFERENCES [dbo].[farmTipoConceptos] ([idTipoConcepto])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_farmTipoConceptos]
GO
ALTER TABLE [dbo].[farmMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimiento_farmTipoDocumentos] FOREIGN KEY([DocumentoIdtipo])
REFERENCES [dbo].[farmTipoDocumentos] ([idTipoDocumento])
GO
ALTER TABLE [dbo].[farmMovimiento] CHECK CONSTRAINT [FK_farmMovimiento_farmTipoDocumentos]
GO
ALTER TABLE [dbo].[farmMovimientoDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoDetalle_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmMovimientoDetalle] CHECK CONSTRAINT [FK_farmMovimientoDetalle_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmMovimientoDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoDetalle_farmMovimiento] FOREIGN KEY([MovNumero], [MovTipo])
REFERENCES [dbo].[farmMovimiento] ([MovNumero], [MovTipo])
GO
ALTER TABLE [dbo].[farmMovimientoDetalle] CHECK CONSTRAINT [FK_farmMovimientoDetalle_farmMovimiento]
GO
ALTER TABLE [dbo].[farmMovimientoDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoDetalle_farmTipoSalidaBienInsumo] FOREIGN KEY([IdTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[farmMovimientoDetalle] CHECK CONSTRAINT [FK_farmMovimientoDetalle_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FarmMovimientoDonaciones]  WITH NOCHECK ADD  CONSTRAINT [FK_FarmMovimientoDonaciones_farmMovimiento] FOREIGN KEY([movNumero], [movTipo])
REFERENCES [dbo].[farmMovimiento] ([MovNumero], [MovTipo])
GO
ALTER TABLE [dbo].[FarmMovimientoDonaciones] CHECK CONSTRAINT [FK_FarmMovimientoDonaciones_farmMovimiento]
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoAlmacen_farmMovimiento] FOREIGN KEY([MovNumero], [MovTipo])
REFERENCES [dbo].[farmMovimiento] ([MovNumero], [MovTipo])
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso] CHECK CONSTRAINT [FK_farmMovimientoAlmacen_farmMovimiento]
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoNotaIngreso_farmTipoCompra] FOREIGN KEY([idTipoCompra])
REFERENCES [dbo].[farmTipoCompra] ([idTipoCompra])
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso] CHECK CONSTRAINT [FK_farmMovimientoNotaIngreso_farmTipoCompra]
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoNotaIngreso_farmTipoProceso] FOREIGN KEY([idTipoProceso])
REFERENCES [dbo].[farmTipoProceso] ([idTipoProceso])
GO
ALTER TABLE [dbo].[farmMovimientoNotaIngreso] CHECK CONSTRAINT [FK_farmMovimientoNotaIngreso_farmTipoProceso]
GO
ALTER TABLE [dbo].[farmMovimientoProgramas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoProgramas_farmComponente] FOREIGN KEY([idComponente])
REFERENCES [dbo].[farmComponente] ([idComponente])
GO
ALTER TABLE [dbo].[farmMovimientoProgramas] CHECK CONSTRAINT [FK_farmMovimientoProgramas_farmComponente]
GO
ALTER TABLE [dbo].[farmMovimientoProgramas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoProgramas_farmComponenteSub] FOREIGN KEY([idSubComponente])
REFERENCES [dbo].[farmComponenteSub] ([idSubComponente])
GO
ALTER TABLE [dbo].[farmMovimientoProgramas] CHECK CONSTRAINT [FK_farmMovimientoProgramas_farmComponenteSub]
GO
ALTER TABLE [dbo].[farmMovimientoProgramas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoProgramas_farmMovimiento] FOREIGN KEY([movNumero], [movTipo])
REFERENCES [dbo].[farmMovimiento] ([MovNumero], [MovTipo])
GO
ALTER TABLE [dbo].[farmMovimientoProgramas] CHECK CONSTRAINT [FK_farmMovimientoProgramas_farmMovimiento]
GO
ALTER TABLE [dbo].[farmMovimientoProgramas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoProgramas_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[farmMovimientoProgramas] CHECK CONSTRAINT [FK_farmMovimientoProgramas_Pacientes]
GO
ALTER TABLE [dbo].[farmMovimientoVentas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoVentas_farmMovimiento] FOREIGN KEY([movNumero], [movTipo])
REFERENCES [dbo].[farmMovimiento] ([MovNumero], [MovTipo])
GO
ALTER TABLE [dbo].[farmMovimientoVentas] CHECK CONSTRAINT [FK_farmMovimientoVentas_farmMovimiento]
GO
ALTER TABLE [dbo].[farmMovimientoVentas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoVentas_farmTipoReceta] FOREIGN KEY([idTipoReceta])
REFERENCES [dbo].[farmTipoReceta] ([idTipoReceta])
GO
ALTER TABLE [dbo].[farmMovimientoVentas] CHECK CONSTRAINT [FK_farmMovimientoVentas_farmTipoReceta]
GO
ALTER TABLE [dbo].[farmMovimientoVentas]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoVentas_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[farmMovimientoVentas] CHECK CONSTRAINT [FK_farmMovimientoVentas_Pacientes]
GO
ALTER TABLE [dbo].[farmMovimientoVentasDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoVentasDetalle_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmMovimientoVentasDetalle] CHECK CONSTRAINT [FK_farmMovimientoVentasDetalle_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmMovimientoVentasDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmMovimientoVentasDetalle_farmMovimientoVentas] FOREIGN KEY([MovNumero], [MovTipo])
REFERENCES [dbo].[farmMovimientoVentas] ([movNumero], [movTipo])
GO
ALTER TABLE [dbo].[farmMovimientoVentasDetalle] CHECK CONSTRAINT [FK_farmMovimientoVentasDetalle_farmMovimientoVentas]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_Empleados] FOREIGN KEY([idVendedor])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_Empleados]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_Empleados1] FOREIGN KEY([idUsuario])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_Empleados1]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_farmAlmacen] FOREIGN KEY([idAlmacen])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_farmAlmacen]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_farmEstadosPreventa] FOREIGN KEY([idEstadoPreventa])
REFERENCES [dbo].[farmEstadosPreventa] ([idEstadoPreventa])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_farmEstadosPreventa]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_farmTipoReceta] FOREIGN KEY([idTipoReceta])
REFERENCES [dbo].[farmTipoReceta] ([idTipoReceta])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_farmTipoReceta]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_Pacientes]
GO
ALTER TABLE [dbo].[farmPreVenta]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVenta_TiposFinanciamiento] FOREIGN KEY([idTipoFinanciamiento])
REFERENCES [dbo].[TiposFinanciamiento] ([IdTipoFinanciamiento])
GO
ALTER TABLE [dbo].[farmPreVenta] CHECK CONSTRAINT [FK_farmPreVenta_TiposFinanciamiento]
GO
ALTER TABLE [dbo].[farmPreVentaDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVentaDetalle_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmPreVentaDetalle] CHECK CONSTRAINT [FK_farmPreVentaDetalle_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmPreVentaDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_farmPreVentaDetalle_farmPreVenta] FOREIGN KEY([idPreventa])
REFERENCES [dbo].[farmPreVenta] ([idPreventa])
GO
ALTER TABLE [dbo].[farmPreVentaDetalle] CHECK CONSTRAINT [FK_farmPreVentaDetalle_farmPreVenta]
GO
ALTER TABLE [dbo].[farmSaldo]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldo_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmSaldo] CHECK CONSTRAINT [FK_farmSaldo_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmSaldo]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldo_farmAlmacen] FOREIGN KEY([idAlmacen])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmSaldo] CHECK CONSTRAINT [FK_farmSaldo_farmAlmacen]
GO
ALTER TABLE [dbo].[farmSaldo]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldo_farmTipoSalidaBienInsumo] FOREIGN KEY([IdTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[farmSaldo] CHECK CONSTRAINT [FK_farmSaldo_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmSaldoDetallado]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldoDetallado_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmSaldoDetallado] CHECK CONSTRAINT [FK_farmSaldoDetallado_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmSaldoDetallado]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldoDetallado_farmAlmacen] FOREIGN KEY([idAlmacen])
REFERENCES [dbo].[farmAlmacen] ([idAlmacen])
GO
ALTER TABLE [dbo].[farmSaldoDetallado] CHECK CONSTRAINT [FK_farmSaldoDetallado_farmAlmacen]
GO
ALTER TABLE [dbo].[farmSaldoDetallado]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldoDetallado_farmTipoSalidaBienInsumo] FOREIGN KEY([IdTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[farmSaldoDetallado] CHECK CONSTRAINT [FK_farmSaldoDetallado_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[farmSaldoMensual]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldoMensual_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[farmSaldoMensual] CHECK CONSTRAINT [FK_farmSaldoMensual_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[farmSaldoMensual]  WITH NOCHECK ADD  CONSTRAINT [FK_farmSaldoMensual_farmTipoSalidaBienInsumo] FOREIGN KEY([IdTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[farmSaldoMensual] CHECK CONSTRAINT [FK_farmSaldoMensual_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FarmSaldoMensualDetallado]  WITH NOCHECK ADD  CONSTRAINT [FK_FarmSaldoMensualDetallado_FactCatalogoBienesInsumos] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[FarmSaldoMensualDetallado] CHECK CONSTRAINT [FK_FarmSaldoMensualDetallado_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[FarmSaldoMensualDetallado]  WITH NOCHECK ADD  CONSTRAINT [FK_FarmSaldoMensualDetallado_farmTipoSalidaBienInsumo] FOREIGN KEY([IdTipoSalidaBienInsumo])
REFERENCES [dbo].[farmTipoSalidaBienInsumo] ([idTipoSalidaBienInsumo])
GO
ALTER TABLE [dbo].[FarmSaldoMensualDetallado] CHECK CONSTRAINT [FK_FarmSaldoMensualDetallado_farmTipoSalidaBienInsumo]
GO
ALTER TABLE [dbo].[FuentesFinanciamiento]  WITH NOCHECK ADD  CONSTRAINT [FK_FuentesFinanciamiento_TipoFinanciador] FOREIGN KEY([idTipoFinanciador])
REFERENCES [dbo].[TipoFinanciador] ([idTipoFinanciador])
GO
ALTER TABLE [dbo].[FuentesFinanciamiento] CHECK CONSTRAINT [FK_FuentesFinanciamiento_TipoFinanciador]
GO
ALTER TABLE [dbo].[FuentesFinanciamiento]  WITH NOCHECK ADD  CONSTRAINT [TiposFinanciamiento_FuentesFinaciamiento_FK1] FOREIGN KEY([IdTipoFinanciamiento])
REFERENCES [dbo].[TiposFinanciamiento] ([IdTipoFinanciamiento])
GO
ALTER TABLE [dbo].[FuentesFinanciamiento] CHECK CONSTRAINT [TiposFinanciamiento_FuentesFinaciamiento_FK1]
GO
ALTER TABLE [dbo].[GeneradorNroHistoriaClinica]  WITH NOCHECK ADD  CONSTRAINT [TipoGeneracionHistoria_GeneradorNroHistoriaClinica_FK1] FOREIGN KEY([IdTipoNumeracion])
REFERENCES [dbo].[TiposNumeracionHistoria] ([IdTipoNumeracion])
GO
ALTER TABLE [dbo].[GeneradorNroHistoriaClinica] CHECK CONSTRAINT [TipoGeneracionHistoria_GeneradorNroHistoriaClinica_FK1]
GO
ALTER TABLE [dbo].[HIS_Cabecera]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Cabecera_HIS_ServEstablecimiento] FOREIGN KEY([IdEstablecimiento], [IdServicio])
REFERENCES [dbo].[HIS_ServEstablecimiento] ([IdEstablecimiento], [IdServicio])
GO
ALTER TABLE [dbo].[HIS_Cabecera] CHECK CONSTRAINT [FK_HIS_Cabecera_HIS_ServEstablecimiento]
GO
ALTER TABLE [dbo].[HIS_Cabecera]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Cabecera_HIS_Turnos] FOREIGN KEY([IdTurno])
REFERENCES [dbo].[HIS_Turnos] ([IdHisTurno])
GO
ALTER TABLE [dbo].[HIS_Cabecera] CHECK CONSTRAINT [FK_HIS_Cabecera_HIS_Turnos]
GO
ALTER TABLE [dbo].[HIS_Cabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Cabecera_IdHisLote] FOREIGN KEY([IdHisLote])
REFERENCES [dbo].[HIS_Lotes] ([IdHisLote])
GO
ALTER TABLE [dbo].[HIS_Cabecera] CHECK CONSTRAINT [FK_HIS_Cabecera_IdHisLote]
GO
ALTER TABLE [dbo].[HIS_Cabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Cabecera_IdMedico] FOREIGN KEY([IdMedico])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[HIS_Cabecera] CHECK CONSTRAINT [FK_HIS_Cabecera_IdMedico]
GO
ALTER TABLE [dbo].[HIS_Cabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Cabecera_IdUsuario] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[HIS_Cabecera] CHECK CONSTRAINT [FK_HIS_Cabecera_IdUsuario]
GO
ALTER TABLE [dbo].[HIS_CodigosActividades]  WITH NOCHECK ADD  CONSTRAINT [IdTipoAtencion_IdTipoAtencion] FOREIGN KEY([IdTipoAtencion])
REFERENCES [dbo].[HIS_TipoAtencion] ([IdHisTipoAtencion])
GO
ALTER TABLE [dbo].[HIS_CodigosActividades] CHECK CONSTRAINT [IdTipoAtencion_IdTipoAtencion]
GO
ALTER TABLE [dbo].[HIS_DatosEstablecimiento]  WITH NOCHECK ADD  CONSTRAINT [HIS_DatosEstablecimiento_IdDatoEstablec] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[HIS_DatosEstablecimiento] CHECK CONSTRAINT [HIS_DatosEstablecimiento_IdDatoEstablec]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Detalle_HIS_Financiador] FOREIGN KEY([IdTipoFinanciamiento])
REFERENCES [dbo].[HIS_Financiador] ([IdCodigoFinancHis])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [FK_HIS_Detalle_HIS_Financiador]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Detalle_HIS_TipoEdad] FOREIGN KEY([IdTipoEdad])
REFERENCES [dbo].[HIS_TipoEdad] ([IdHisTipoEdad])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [FK_HIS_Detalle_HIS_TipoEdad]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Detalle_TiposCondicionPaciente] FOREIGN KEY([IdEstadoaEstablec])
REFERENCES [dbo].[TiposCondicionPaciente] ([IdTipoCondicionPaciente])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [FK_HIS_Detalle_TiposCondicionPaciente]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [FK_HIS_Detalle_TiposCondicionPaciente1] FOREIGN KEY([IdEstadoaServicio])
REFERENCES [dbo].[TiposCondicionPaciente] ([IdTipoCondicionPaciente])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [FK_HIS_Detalle_TiposCondicionPaciente1]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [HIS_Detalle_IdDistrito] FOREIGN KEY([IdDistrito])
REFERENCES [dbo].[Distritos] ([IdDistrito])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [HIS_Detalle_IdDistrito]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [HIS_Detalle_IdHisCabecera] FOREIGN KEY([IdHisCabecera])
REFERENCES [dbo].[HIS_Cabecera] ([IdHisCabecera])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [HIS_Detalle_IdHisCabecera]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [HIS_Detalle_IdHISPaciente] FOREIGN KEY([IdHisPaciente])
REFERENCES [dbo].[HIS_Paciente] ([IdHisPaciente])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [HIS_Detalle_IdHISPaciente]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [HIS_Detalle_IdTipoAtencion] FOREIGN KEY([IdTipoAtencion])
REFERENCES [dbo].[HIS_TipoAtencion] ([IdHisTipoAtencion])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [HIS_Detalle_IdTipoAtencion]
GO
ALTER TABLE [dbo].[HIS_Detalle]  WITH NOCHECK ADD  CONSTRAINT [HIS_Detalle_IdTipoFinanciamiento] FOREIGN KEY([IdTipoFinanciamiento])
REFERENCES [dbo].[TiposFinanciamiento] ([IdTipoFinanciamiento])
GO
ALTER TABLE [dbo].[HIS_Detalle] CHECK CONSTRAINT [HIS_Detalle_IdTipoFinanciamiento]
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico]  WITH CHECK ADD  CONSTRAINT [FK_HIS_DetalleDiagnostico_HIS_FACTCATALOGOSERVICIOS] FOREIGN KEY([IdCIE])
REFERENCES [dbo].[HIS_FACTCATALOGOSERVICIOS] ([IdDiagCpt])
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico] CHECK CONSTRAINT [FK_HIS_DetalleDiagnostico_HIS_FACTCATALOGOSERVICIOS]
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico]  WITH NOCHECK ADD  CONSTRAINT [HIS_DetalleDiagnostico_IdCIE] FOREIGN KEY([IdCIE])
REFERENCES [dbo].[Diagnosticos] ([IdDiagnostico])
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico] CHECK CONSTRAINT [HIS_DetalleDiagnostico_IdCIE]
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico]  WITH NOCHECK ADD  CONSTRAINT [HIS_DetalleDiagnostico_IdHisDetalle] FOREIGN KEY([IdHisDetalle])
REFERENCES [dbo].[HIS_Detalle] ([IdHisDetalle])
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico] CHECK CONSTRAINT [HIS_DetalleDiagnostico_IdHisDetalle]
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico]  WITH NOCHECK ADD  CONSTRAINT [HIS_DetalleDiagnostico_IdSubClasificacionDX] FOREIGN KEY([IdSubClasificacionDX])
REFERENCES [dbo].[SubclasificacionDiagnosticos] ([IdSubclasificacionDx])
GO
ALTER TABLE [dbo].[HIS_DetalleDiagnostico] CHECK CONSTRAINT [HIS_DetalleDiagnostico_IdSubClasificacionDX]
GO
ALTER TABLE [dbo].[HIS_DetalleDx_Verifica]  WITH CHECK ADD  CONSTRAINT [FK_HIS_DetalleDx_Verifica_HIS_Detalle_Verifica] FOREIGN KEY([IdHisDetalle])
REFERENCES [dbo].[HIS_Detalle_Verifica] ([IdHisDetalle])
GO
ALTER TABLE [dbo].[HIS_DetalleDx_Verifica] CHECK CONSTRAINT [FK_HIS_DetalleDx_Verifica_HIS_Detalle_Verifica]
GO
ALTER TABLE [dbo].[His_Establecimientos]  WITH CHECK ADD  CONSTRAINT [FK_His_Establecimientos_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[His_Establecimientos] CHECK CONSTRAINT [FK_His_Establecimientos_Establecimientos]
GO
ALTER TABLE [dbo].[HIS_EstablecPacienteHIS]  WITH NOCHECK ADD  CONSTRAINT [His_EstablecPacienteHIS_IdEstablecimiento] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[HIS_EstablecPacienteHIS] CHECK CONSTRAINT [His_EstablecPacienteHIS_IdEstablecimiento]
GO
ALTER TABLE [dbo].[HIS_EstablecPacienteHIS]  WITH NOCHECK ADD  CONSTRAINT [His_EstablecPacienteHIS_IdHisPaciente] FOREIGN KEY([IdHisPaciente])
REFERENCES [dbo].[HIS_Paciente] ([IdHisPaciente])
GO
ALTER TABLE [dbo].[HIS_EstablecPacienteHIS] CHECK CONSTRAINT [His_EstablecPacienteHIS_IdHisPaciente]
GO
ALTER TABLE [dbo].[his_historicoAtenciones]  WITH CHECK ADD  CONSTRAINT [FK_his_historicoAtenciones_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[his_historicoAtenciones] CHECK CONSTRAINT [FK_his_historicoAtenciones_Pacientes]
GO
ALTER TABLE [dbo].[HIS_Lotes]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Lotes_His_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[His_Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[HIS_Lotes] CHECK CONSTRAINT [FK_HIS_Lotes_His_Establecimientos]
GO
ALTER TABLE [dbo].[HIS_Lotes]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Lotes_His_EstadosLote] FOREIGN KEY([idEstadoLote])
REFERENCES [dbo].[His_EstadosLote] ([IdEstado])
GO
ALTER TABLE [dbo].[HIS_Lotes] CHECK CONSTRAINT [FK_HIS_Lotes_His_EstadosLote]
GO
ALTER TABLE [dbo].[HIS_Lotes]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Lotes_HIS_Meses] FOREIGN KEY([Mes])
REFERENCES [dbo].[HIS_Meses] ([IdMes])
GO
ALTER TABLE [dbo].[HIS_Lotes] CHECK CONSTRAINT [FK_HIS_Lotes_HIS_Meses]
GO
ALTER TABLE [dbo].[HIS_Paciente]  WITH CHECK ADD  CONSTRAINT [FK_HIS_Paciente_TiposDocIdentidad] FOREIGN KEY([IdTipoDocumento])
REFERENCES [dbo].[TiposDocIdentidad] ([IdDocIdentidad])
GO
ALTER TABLE [dbo].[HIS_Paciente] CHECK CONSTRAINT [FK_HIS_Paciente_TiposDocIdentidad]
GO
ALTER TABLE [dbo].[HIS_Paciente]  WITH NOCHECK ADD  CONSTRAINT [HIS_Paciente_IdEtnia] FOREIGN KEY([IdEtnia])
REFERENCES [dbo].[HIS_tabetnia] ([codetni])
GO
ALTER TABLE [dbo].[HIS_Paciente] CHECK CONSTRAINT [HIS_Paciente_IdEtnia]
GO
ALTER TABLE [dbo].[HIS_Paciente]  WITH NOCHECK ADD  CONSTRAINT [HIS_Paciente_IdNacionalidad] FOREIGN KEY([IdNacionalidad])
REFERENCES [dbo].[Paises] ([IdPais])
GO
ALTER TABLE [dbo].[HIS_Paciente] CHECK CONSTRAINT [HIS_Paciente_IdNacionalidad]
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR]  WITH CHECK ADD  CONSTRAINT [FK_HIS_ProgMedEstMR_HIS_ServEstablecimiento] FOREIGN KEY([IdEstablecimiento], [IdServicio])
REFERENCES [dbo].[HIS_ServEstablecimiento] ([IdEstablecimiento], [IdServicio])
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR] CHECK CONSTRAINT [FK_HIS_ProgMedEstMR_HIS_ServEstablecimiento]
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR]  WITH NOCHECK ADD  CONSTRAINT [IdMedico_IdMedico] FOREIGN KEY([IdMedico])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR] CHECK CONSTRAINT [IdMedico_IdMedico]
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR]  WITH NOCHECK ADD  CONSTRAINT [IdTurno_IIdTurno] FOREIGN KEY([IdTurno])
REFERENCES [dbo].[HIS_Turnos] ([IdHisTurno])
GO
ALTER TABLE [dbo].[HIS_ProgMedEstMR] CHECK CONSTRAINT [IdTurno_IIdTurno]
GO
ALTER TABLE [dbo].[HIS_ServEstablecimiento]  WITH CHECK ADD  CONSTRAINT [FK_HIS_ServEstablecimiento_His_Establecimientos] FOREIGN KEY([IdEstablecimiento])
REFERENCES [dbo].[His_Establecimientos] ([IdEstablecimiento])
GO
ALTER TABLE [dbo].[HIS_ServEstablecimiento] CHECK CONSTRAINT [FK_HIS_ServEstablecimiento_His_Establecimientos]
GO
ALTER TABLE [dbo].[HIS_ServEstablecimiento]  WITH NOCHECK ADD  CONSTRAINT [HIS_ServEstablecimiento_IdServicio] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[HIS_ServEstablecimiento] CHECK CONSTRAINT [HIS_ServEstablecimiento_IdServicio]
GO
ALTER TABLE [dbo].[HistoriasClinicas]  WITH NOCHECK ADD  CONSTRAINT [EstadosHistoriaClinica_HistoriasClinicas_FK1] FOREIGN KEY([IdEstadoHistoria])
REFERENCES [dbo].[EstadosHistoriaClinica] ([IdEstadoHistoria])
GO
ALTER TABLE [dbo].[HistoriasClinicas] CHECK CONSTRAINT [EstadosHistoriaClinica_HistoriasClinicas_FK1]
GO
ALTER TABLE [dbo].[HistoriasClinicas]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_HistoriasClinicas_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[HistoriasClinicas] CHECK CONSTRAINT [Pacientes_HistoriasClinicas_FK1]
GO
ALTER TABLE [dbo].[HistoriasClinicas]  WITH NOCHECK ADD  CONSTRAINT [TiposGeneracionHistoria_HistoriasClinicas_FK1] FOREIGN KEY([IdTipoNumeracion])
REFERENCES [dbo].[TiposNumeracionHistoria] ([IdTipoNumeracion])
GO
ALTER TABLE [dbo].[HistoriasClinicas] CHECK CONSTRAINT [TiposGeneracionHistoria_HistoriasClinicas_FK1]
GO
ALTER TABLE [dbo].[HistoriasClinicas]  WITH NOCHECK ADD  CONSTRAINT [TiposHistoriaClinica_HistoriasClinicas_FK1] FOREIGN KEY([IdTipoHistoria])
REFERENCES [dbo].[TiposHistoriaClinica] ([IdTipoHistoria])
GO
ALTER TABLE [dbo].[HistoriasClinicas] CHECK CONSTRAINT [TiposHistoriaClinica_HistoriasClinicas_FK1]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas]  WITH NOCHECK ADD  CONSTRAINT [Empleados_HistoriasSolicitadas_FK1] FOREIGN KEY([IdEmpleadoSolicita])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] CHECK CONSTRAINT [Empleados_HistoriasSolicitadas_FK1]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas]  WITH NOCHECK ADD  CONSTRAINT [MotivosPrestamoHistoria_HistoriasSolicitadas_FK1] FOREIGN KEY([IdMotivo])
REFERENCES [dbo].[MotivosMovimientoHistoria] ([IdMotivo])
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] CHECK CONSTRAINT [MotivosPrestamoHistoria_HistoriasSolicitadas_FK1]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas]  WITH NOCHECK ADD  CONSTRAINT [MovimientosHistoriaClinica_HistoriasSolicitadas_FK1] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[MovimientosHistoriaClinica] ([IdMovimiento])
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] CHECK CONSTRAINT [MovimientosHistoriaClinica_HistoriasSolicitadas_FK1]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas]  WITH NOCHECK ADD  CONSTRAINT [Pacientes_HistoriasSolicitadas_FK1] FOREIGN KEY([IdPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] CHECK CONSTRAINT [Pacientes_HistoriasSolicitadas_FK1]
GO
ALTER TABLE [dbo].[HistoriasSolicitadas]  WITH NOCHECK ADD  CONSTRAINT [Servicios_HistoriasSolicitadas_FK1] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[HistoriasSolicitadas] CHECK CONSTRAINT [Servicios_HistoriasSolicitadas_FK1]
GO
ALTER TABLE [dbo].[ImagCatalgoServicioDuracion]  WITH CHECK ADD  CONSTRAINT [FK_ImagCatalgoServicioDuracion_FactCatalogoServicios] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[ImagCatalgoServicioDuracion] CHECK CONSTRAINT [FK_ImagCatalgoServicioDuracion_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[ImagMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagCabecera_ImagEstados] FOREIGN KEY([IdImagEstado])
REFERENCES [dbo].[ImagEstados] ([IdImagEstado])
GO
ALTER TABLE [dbo].[ImagMovimiento] CHECK CONSTRAINT [FK_ImagCabecera_ImagEstados]
GO
ALTER TABLE [dbo].[ImagMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimiento_FactPuntosCarga] FOREIGN KEY([IdPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[ImagMovimiento] CHECK CONSTRAINT [FK_ImagMovimiento_FactPuntosCarga]
GO
ALTER TABLE [dbo].[ImagMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimiento_ImagTipoConceptos] FOREIGN KEY([IdTipoConcepto])
REFERENCES [dbo].[ImagTipoConceptos] ([idTipoConcepto])
GO
ALTER TABLE [dbo].[ImagMovimiento] CHECK CONSTRAINT [FK_ImagMovimiento_ImagTipoConceptos]
GO
ALTER TABLE [dbo].[ImagMovimientoCPT]  WITH NOCHECK ADD  CONSTRAINT [FactCatalogoServicios_ImagMovimientoCPT_FK1] FOREIGN KEY([idProductoCPT])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[ImagMovimientoCPT] CHECK CONSTRAINT [FactCatalogoServicios_ImagMovimientoCPT_FK1]
GO
ALTER TABLE [dbo].[ImagMovimientoCPT]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoCPT_ImagMovimiento] FOREIGN KEY([idMovimiento])
REFERENCES [dbo].[ImagMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoCPT] CHECK CONSTRAINT [FK_ImagMovimientoCPT_ImagMovimiento]
GO
ALTER TABLE [dbo].[ImagMovimientoCPT]  WITH NOCHECK ADD  CONSTRAINT [ImagMovimientoImagenes_ImagMovimientoCPT_FK1] FOREIGN KEY([idMovimiento])
REFERENCES [dbo].[ImagMovimientoImagenes] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoCPT] CHECK CONSTRAINT [ImagMovimientoImagenes_ImagMovimientoCPT_FK1]
GO
ALTER TABLE [dbo].[ImagMovimientoDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoDetalle_ImagMovimiento] FOREIGN KEY([idMovimiento])
REFERENCES [dbo].[ImagMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoDetalle] CHECK CONSTRAINT [FK_ImagMovimientoDetalle_ImagMovimiento]
GO
ALTER TABLE [dbo].[ImagMovimientoImagenes]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoRayosX_FactOrdenServicio] FOREIGN KEY([IdOrden])
REFERENCES [dbo].[FactOrdenServicio] ([IdOrden])
GO
ALTER TABLE [dbo].[ImagMovimientoImagenes] CHECK CONSTRAINT [FK_ImagMovimientoRayosX_FactOrdenServicio]
GO
ALTER TABLE [dbo].[ImagMovimientoImagenes]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoRayosX_ImagMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[ImagMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoImagenes] CHECK CONSTRAINT [FK_ImagMovimientoRayosX_ImagMovimiento]
GO
ALTER TABLE [dbo].[ImagMovimientoIngresos]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoIngresos_ImagMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[ImagMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoIngresos] CHECK CONSTRAINT [FK_ImagMovimientoIngresos_ImagMovimiento]
GO
ALTER TABLE [dbo].[ImagMovimientoSalidas]  WITH NOCHECK ADD  CONSTRAINT [FK_ImagMovimientoSalidas_ImagMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[ImagMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[ImagMovimientoSalidas] CHECK CONSTRAINT [FK_ImagMovimientoSalidas_ImagMovimiento]
GO
ALTER TABLE [dbo].[ImagSala]  WITH CHECK ADD  CONSTRAINT [FK_ImagSala_ImagTipoModalidadSala] FOREIGN KEY([IdTipoModalidadSala])
REFERENCES [dbo].[ImagTipoModalidadSala] ([IdTipoModalidadSala])
GO
ALTER TABLE [dbo].[ImagSala] CHECK CONSTRAINT [FK_ImagSala_ImagTipoModalidadSala]
GO
ALTER TABLE [dbo].[InteoIntegracionSistema]  WITH CHECK ADD  CONSTRAINT [FK_InteoIntegracionSistema_InteoProveedorSistema] FOREIGN KEY([IdProveedorSistema])
REFERENCES [dbo].[InteoProveedorSistema] ([IdProveedorSistema])
GO
ALTER TABLE [dbo].[InteoIntegracionSistema] CHECK CONSTRAINT [FK_InteoIntegracionSistema_InteoProveedorSistema]
GO
ALTER TABLE [dbo].[InteoIntegracionSistema]  WITH CHECK ADD  CONSTRAINT [FK_InteoIntegracionSistema_InteoTipoSistema] FOREIGN KEY([IdTipoSistema])
REFERENCES [dbo].[InteoTipoSistema] ([IdTipoSistema])
GO
ALTER TABLE [dbo].[InteoIntegracionSistema] CHECK CONSTRAINT [FK_InteoIntegracionSistema_InteoTipoSistema]
GO
ALTER TABLE [dbo].[LabItemsCpt]  WITH CHECK ADD  CONSTRAINT [FK_LabItemsCpt_FactCatalogoServicios] FOREIGN KEY([idProductoCpt])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[LabItemsCpt] CHECK CONSTRAINT [FK_LabItemsCpt_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[LabItemsCpt]  WITH CHECK ADD  CONSTRAINT [FK_LabItemsCpt_labGrupos] FOREIGN KEY([idGrupo])
REFERENCES [dbo].[labGrupos] ([idGrupo])
GO
ALTER TABLE [dbo].[LabItemsCpt] CHECK CONSTRAINT [FK_LabItemsCpt_labGrupos]
GO
ALTER TABLE [dbo].[LabItemsCpt]  WITH CHECK ADD  CONSTRAINT [FK_LabItemsCpt_LabItems] FOREIGN KEY([idItem])
REFERENCES [dbo].[LabItems] ([idItem])
GO
ALTER TABLE [dbo].[LabItemsCpt] CHECK CONSTRAINT [FK_LabItemsCpt_LabItems]
GO
ALTER TABLE [dbo].[LabItemsCpt]  WITH CHECK ADD  CONSTRAINT [FK_LabItemsCpt_LabItemsGrupos] FOREIGN KEY([idItemGrupo])
REFERENCES [dbo].[LabItemsGrupos] ([idItemGrupo])
GO
ALTER TABLE [dbo].[LabItemsCpt] CHECK CONSTRAINT [FK_LabItemsCpt_LabItemsGrupos]
GO
ALTER TABLE [dbo].[LabMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimiento_FactPuntosCarga] FOREIGN KEY([IdPuntoCarga])
REFERENCES [dbo].[FactPuntosCarga] ([IdPuntoCarga])
GO
ALTER TABLE [dbo].[LabMovimiento] CHECK CONSTRAINT [FK_LabMovimiento_FactPuntosCarga]
GO
ALTER TABLE [dbo].[LabMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimiento_LabEstados] FOREIGN KEY([IdLabEstado])
REFERENCES [dbo].[LabEstados] ([IdLabEstado])
GO
ALTER TABLE [dbo].[LabMovimiento] CHECK CONSTRAINT [FK_LabMovimiento_LabEstados]
GO
ALTER TABLE [dbo].[LabMovimiento]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimiento_LabTipoConceptos] FOREIGN KEY([IdTipoConcepto])
REFERENCES [dbo].[LabTipoConceptos] ([idTipoConcepto])
GO
ALTER TABLE [dbo].[LabMovimiento] CHECK CONSTRAINT [FK_LabMovimiento_LabTipoConceptos]
GO
ALTER TABLE [dbo].[LabMovimientoCPT]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoCPT_LabMovimiento] FOREIGN KEY([idMovimiento])
REFERENCES [dbo].[LabMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[LabMovimientoCPT] CHECK CONSTRAINT [FK_LabMovimientoCPT_LabMovimiento]
GO
ALTER TABLE [dbo].[LabMovimientoDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoDetalle_LabMovimiento] FOREIGN KEY([idMovimiento])
REFERENCES [dbo].[LabMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[LabMovimientoDetalle] CHECK CONSTRAINT [FK_LabMovimientoDetalle_LabMovimiento]
GO
ALTER TABLE [dbo].[LabMovimientoIngresos]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoIngresos_LabMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[LabMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[LabMovimientoIngresos] CHECK CONSTRAINT [FK_LabMovimientoIngresos_LabMovimiento]
GO
ALTER TABLE [dbo].[LabMovimientoLaboratorio]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoLaboratorio_FactOrdenServicio] FOREIGN KEY([IdOrden])
REFERENCES [dbo].[FactOrdenServicio] ([IdOrden])
GO
ALTER TABLE [dbo].[LabMovimientoLaboratorio] CHECK CONSTRAINT [FK_LabMovimientoLaboratorio_FactOrdenServicio]
GO
ALTER TABLE [dbo].[LabMovimientoLaboratorio]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoLaboratorio_LabMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[LabMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[LabMovimientoLaboratorio] CHECK CONSTRAINT [FK_LabMovimientoLaboratorio_LabMovimiento]
GO
ALTER TABLE [dbo].[LabMovimientoSalidas]  WITH NOCHECK ADD  CONSTRAINT [FK_LabMovimientoSalidas_LabMovimiento] FOREIGN KEY([IdMovimiento])
REFERENCES [dbo].[LabMovimiento] ([IdMovimiento])
GO
ALTER TABLE [dbo].[LabMovimientoSalidas] CHECK CONSTRAINT [FK_LabMovimientoSalidas_LabMovimiento]
GO
ALTER TABLE [dbo].[ListBarItems]  WITH NOCHECK ADD  CONSTRAINT [GUIListBarGrupos_GUIListBarItems_FK1] FOREIGN KEY([IdListGrupo])
REFERENCES [dbo].[ListBarGrupos] ([IdListGrupo])
GO
ALTER TABLE [dbo].[ListBarItems] CHECK CONSTRAINT [GUIListBarGrupos_GUIListBarItems_FK1]
GO
ALTER TABLE [dbo].[Medicos]  WITH NOCHECK ADD  CONSTRAINT [Empleados_Medicos_FK1] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[Medicos] CHECK CONSTRAINT [Empleados_Medicos_FK1]
GO
ALTER TABLE [dbo].[MedicosEspecialidad]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_MedicosEspecialidad_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[MedicosEspecialidad] CHECK CONSTRAINT [Especialidades_MedicosEspecialidad_FK1]
GO
ALTER TABLE [dbo].[MedicosEspecialidad]  WITH NOCHECK ADD  CONSTRAINT [Medicos_MedicosEspecialidad_FK1] FOREIGN KEY([IdMedico])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[MedicosEspecialidad] CHECK CONSTRAINT [Medicos_MedicosEspecialidad_FK1]
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica]  WITH NOCHECK ADD  CONSTRAINT [Empleados_MovimientosHistoriaClinica_FK2] FOREIGN KEY([IdEmpleadoTransporte])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica] CHECK CONSTRAINT [Empleados_MovimientosHistoriaClinica_FK2]
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica]  WITH NOCHECK ADD  CONSTRAINT [Empleados_MovimientosHistoriaClinica_FK3] FOREIGN KEY([IdEmpleadoRecepcion])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica] CHECK CONSTRAINT [Empleados_MovimientosHistoriaClinica_FK3]
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica]  WITH NOCHECK ADD  CONSTRAINT [MotivosPrestamoHistoria_PrestamosHistoriaClinica_FK1] FOREIGN KEY([IdMotivo])
REFERENCES [dbo].[MotivosMovimientoHistoria] ([IdMotivo])
GO
ALTER TABLE [dbo].[MovimientosHistoriaClinica] CHECK CONSTRAINT [MotivosPrestamoHistoria_PrestamosHistoriaClinica_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [CentrosPoblados_Pacientes_FK1] FOREIGN KEY([IdCentroPobladoDomicilio])
REFERENCES [dbo].[CentrosPoblados] ([IdCentroPoblado])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [CentrosPoblados_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [CentrosPoblados_Pacientes_FK2] FOREIGN KEY([IdCentroPobladoNacimiento])
REFERENCES [dbo].[CentrosPoblados] ([IdCentroPoblado])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [CentrosPoblados_Pacientes_FK2]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [CentrosPoblados_Pacientes_FK3] FOREIGN KEY([IdCentroPobladoProcedencia])
REFERENCES [dbo].[CentrosPoblados] ([IdCentroPoblado])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [CentrosPoblados_Pacientes_FK3]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [Paises_Pacientes_FK1] FOREIGN KEY([IdPaisDomicilio])
REFERENCES [dbo].[Paises] ([IdPais])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [Paises_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [Paises_Pacientes_FK2] FOREIGN KEY([IdPaisProcedencia])
REFERENCES [dbo].[Paises] ([IdPais])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [Paises_Pacientes_FK2]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [Paises_Pacientes_FK3] FOREIGN KEY([IdPaisNacimiento])
REFERENCES [dbo].[Paises] ([IdPais])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [Paises_Pacientes_FK3]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposDocIdentidad_Pacientes_FK1] FOREIGN KEY([IdDocIdentidad])
REFERENCES [dbo].[TiposDocIdentidad] ([IdDocIdentidad])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposDocIdentidad_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposEstadoCivil_Pacientes_FK1] FOREIGN KEY([IdEstadoCivil])
REFERENCES [dbo].[TiposEstadoCivil] ([IdEstadoCivil])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposEstadoCivil_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposGeneracionHistoria_Pacientes_FK1] FOREIGN KEY([IdTipoNumeracion])
REFERENCES [dbo].[TiposNumeracionHistoria] ([IdTipoNumeracion])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposGeneracionHistoria_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposGradoInstruccion_Pacientes_FK1] FOREIGN KEY([IdGradoInstruccion])
REFERENCES [dbo].[TiposGradoInstruccion] ([IdGradoInstruccion])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposGradoInstruccion_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposOcupacion_Pacientes_FK1] FOREIGN KEY([IdTipoOcupacion])
REFERENCES [dbo].[TiposOcupacion] ([IdTipoOcupacion])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposOcupacion_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposProcedencia_Pacientes_FK1] FOREIGN KEY([IdProcedencia])
REFERENCES [dbo].[TiposProcedencia] ([IdProcedencia])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposProcedencia_Pacientes_FK1]
GO
ALTER TABLE [dbo].[Pacientes]  WITH NOCHECK ADD  CONSTRAINT [TiposSexo_Pacientes_FK1] FOREIGN KEY([IdTipoSexo])
REFERENCES [dbo].[TiposSexo] ([IdTipoSexo])
GO
ALTER TABLE [dbo].[Pacientes] CHECK CONSTRAINT [TiposSexo_Pacientes_FK1]
GO
ALTER TABLE [dbo].[PerinatalAtencion]  WITH CHECK ADD  CONSTRAINT [FK_PerinatalAtencion_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[PerinatalAtencion] CHECK CONSTRAINT [FK_PerinatalAtencion_Pacientes]
GO
ALTER TABLE [dbo].[PerinatalAtencion]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencion_PerinatalAtencionCred1] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencionCred1] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencion] NOCHECK CONSTRAINT [FK_PerinatalAtencion_PerinatalAtencionCred1]
GO
ALTER TABLE [dbo].[PerinatalAtencionCred]  WITH CHECK ADD  CONSTRAINT [FK_PerinatalAtencionCred_Atenciones] FOREIGN KEY([idAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionCred] CHECK CONSTRAINT [FK_PerinatalAtencionCred_Atenciones]
GO
ALTER TABLE [dbo].[PerinatalAtencionCred]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionCRED_PerinatalAtencion] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencion] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionCred] CHECK CONSTRAINT [FK_PerinatalAtencionCRED_PerinatalAtencion]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalAtencion] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencion] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] CHECK CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalAtencion]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalListas] FOREIGN KEY([idLista])
REFERENCES [dbo].[PerinatalListas] ([idLista])
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] CHECK CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalListas]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalModulos] FOREIGN KEY([idModulo])
REFERENCES [dbo].[PerinatalModulos] ([idModulo])
GO
ALTER TABLE [dbo].[PerinatalAtencionDiagnosticos] CHECK CONSTRAINT [FK_PerinatalAtencionesDiagnosticos_PerinatalModulos]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiaria]  WITH CHECK ADD  CONSTRAINT [FK_PerinatalAtencionDiaria_Atenciones] FOREIGN KEY([idAtencion])
REFERENCES [dbo].[Atenciones] ([IdAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionDiaria] CHECK CONSTRAINT [FK_PerinatalAtencionDiaria_Atenciones]
GO
ALTER TABLE [dbo].[PerinatalAtencionDiaria]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionDiaria_PerinatalAtencion] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencion] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionDiaria] CHECK CONSTRAINT [FK_PerinatalAtencionDiaria_PerinatalAtencion]
GO
ALTER TABLE [dbo].[PerinatalAtencionMedicamentos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionMedicamentos_PerinatalAtencion] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencion] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionMedicamentos] CHECK CONSTRAINT [FK_PerinatalAtencionMedicamentos_PerinatalAtencion]
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalAtencion] FOREIGN KEY([idPerinatalAtencion])
REFERENCES [dbo].[PerinatalAtencion] ([idPerinatalAtencion])
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos] CHECK CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalAtencion]
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalListas] FOREIGN KEY([idLista])
REFERENCES [dbo].[PerinatalListas] ([idLista])
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos] CHECK CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalListas]
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalModulos] FOREIGN KEY([idModulo])
REFERENCES [dbo].[PerinatalModulos] ([idModulo])
GO
ALTER TABLE [dbo].[PerinatalAtencionProcedimientos] CHECK CONSTRAINT [FK_PerinatalAtencionProcedimientos_PerinatalModulos]
GO
ALTER TABLE [dbo].[PerinatalCatalogoCie10]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalCatalogoDiagnosticos_Diagnosticos] FOREIGN KEY([idDiagnostico])
REFERENCES [dbo].[Diagnosticos] ([IdDiagnostico])
GO
ALTER TABLE [dbo].[PerinatalCatalogoCie10] CHECK CONSTRAINT [FK_PerinatalCatalogoDiagnosticos_Diagnosticos]
GO
ALTER TABLE [dbo].[PerinatalCatalogoCpt]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalCatalogoDeProcedimientos_FactCatalogoServicios] FOREIGN KEY([idProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[PerinatalCatalogoCpt] CHECK CONSTRAINT [FK_PerinatalCatalogoDeProcedimientos_FactCatalogoServicios]
GO
ALTER TABLE [dbo].[PerinatalCatalogoCptAutomaticos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalCatalogoDeProcedimientosAutomaticos_PerinatalCatalogoDeProcedimientos] FOREIGN KEY([idModulo], [idLista], [idProducto])
REFERENCES [dbo].[PerinatalCatalogoCpt] ([idModulo], [idLista], [idProducto])
GO
ALTER TABLE [dbo].[PerinatalCatalogoCptAutomaticos] CHECK CONSTRAINT [FK_PerinatalCatalogoDeProcedimientosAutomaticos_PerinatalCatalogoDeProcedimientos]
GO
ALTER TABLE [dbo].[PerinatalCatalogoCptMaximaDosis]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalCatalogoDeProcedimientosMaxDosis_PerinatalCatalogoDeProcedimientos] FOREIGN KEY([idModulo], [idLista], [idProducto])
REFERENCES [dbo].[PerinatalCatalogoCpt] ([idModulo], [idLista], [idProducto])
GO
ALTER TABLE [dbo].[PerinatalCatalogoCptMaximaDosis] CHECK CONSTRAINT [FK_PerinatalCatalogoDeProcedimientosMaxDosis_PerinatalCatalogoDeProcedimientos]
GO
ALTER TABLE [dbo].[PerinatalCatalogoMedicamentos]  WITH NOCHECK ADD  CONSTRAINT [FK_PerinatalCatalogoMedicamentos_FactCatalogoBienesInsumos] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[PerinatalCatalogoMedicamentos] CHECK CONSTRAINT [FK_PerinatalCatalogoMedicamentos_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[ProCabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCabecera_Programas] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProCabecera] CHECK CONSTRAINT [FK_ProCabecera_Programas]
GO
ALTER TABLE [dbo].[ProCabeceraConfigDatos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCabeceraConfigDatos_Programas] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProCabeceraConfigDatos] CHECK CONSTRAINT [FK_ProCabeceraConfigDatos_Programas]
GO
ALTER TABLE [dbo].[ProCabeceraDato]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCabeceraDato_ProCabecera] FOREIGN KEY([IdPrograma], [IdProCabecera])
REFERENCES [dbo].[ProCabecera] ([IdPrograma], [IdProcabecera])
GO
ALTER TABLE [dbo].[ProCabeceraDato] CHECK CONSTRAINT [FK_ProCabeceraDato_ProCabecera]
GO
ALTER TABLE [dbo].[ProCabeceraDato]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCabeceraDato_ProCabeceraConfigDatos] FOREIGN KEY([IdPrograma], [IdCabDato])
REFERENCES [dbo].[ProCabeceraConfigDatos] ([IdPrograma], [IdCabDato])
GO
ALTER TABLE [dbo].[ProCabeceraDato] CHECK CONSTRAINT [FK_ProCabeceraDato_ProCabeceraConfigDatos]
GO
ALTER TABLE [dbo].[ProCatalogoControles]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoControles_Programas] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProCatalogoControles] CHECK CONSTRAINT [FK_ProCatalogoControles_Programas]
GO
ALTER TABLE [dbo].[ProCatalogoDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoDiagnosticos_Diagnosticos] FOREIGN KEY([IdDiagnostico])
REFERENCES [dbo].[Diagnosticos] ([IdDiagnostico])
GO
ALTER TABLE [dbo].[ProCatalogoDiagnosticos] CHECK CONSTRAINT [FK_ProCatalogoDiagnosticos_Diagnosticos]
GO
ALTER TABLE [dbo].[ProCatalogoDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoDiagnosticos_Programas1] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProCatalogoDiagnosticos] CHECK CONSTRAINT [FK_ProCatalogoDiagnosticos_Programas1]
GO
ALTER TABLE [dbo].[ProCatalogoProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoProcedimientos_FactCatalogoServicios1] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoServicios] ([IdProducto])
GO
ALTER TABLE [dbo].[ProCatalogoProcedimientos] CHECK CONSTRAINT [FK_ProCatalogoProcedimientos_FactCatalogoServicios1]
GO
ALTER TABLE [dbo].[ProCatalogoProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoProcedimientos_ProCatalogoDiagnosticos] FOREIGN KEY([IdPrograma], [IdDiagnostico])
REFERENCES [dbo].[ProCatalogoDiagnosticos] ([IdPrograma], [IdDiagnostico])
GO
ALTER TABLE [dbo].[ProCatalogoProcedimientos] CHECK CONSTRAINT [FK_ProCatalogoProcedimientos_ProCatalogoDiagnosticos]
GO
ALTER TABLE [dbo].[ProCatalogoTratamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoTratamientos_FactCatalogoBienesInsumos] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[FactCatalogoBienesInsumos] ([IdProducto])
GO
ALTER TABLE [dbo].[ProCatalogoTratamientos] CHECK CONSTRAINT [FK_ProCatalogoTratamientos_FactCatalogoBienesInsumos]
GO
ALTER TABLE [dbo].[ProCatalogoTratamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProCatalogoTratamientos_Programas] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProCatalogoTratamientos] CHECK CONSTRAINT [FK_ProCatalogoTratamientos_Programas]
GO
ALTER TABLE [dbo].[ProControlConfigDatos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProControlConfigDatos_Programas] FOREIGN KEY([IdPrograma])
REFERENCES [dbo].[Programas] ([IdPrograma])
GO
ALTER TABLE [dbo].[ProControlConfigDatos] CHECK CONSTRAINT [FK_ProControlConfigDatos_Programas]
GO
ALTER TABLE [dbo].[ProControlDato]  WITH NOCHECK ADD  CONSTRAINT [FK_ProControlDato_ProControlConfigDatos] FOREIGN KEY([IdPrograma], [IdControlDato])
REFERENCES [dbo].[ProControlConfigDatos] ([IdPrograma], [IdControlDato])
GO
ALTER TABLE [dbo].[ProControlDato] CHECK CONSTRAINT [FK_ProControlDato_ProControlConfigDatos]
GO
ALTER TABLE [dbo].[ProControlDato]  WITH NOCHECK ADD  CONSTRAINT [FK_ProControlDato_ProControles] FOREIGN KEY([IdPrograma], [IdProCabecera], [IdControl])
REFERENCES [dbo].[ProControles] ([IdPrograma], [IdProCabecera], [IdControl])
GO
ALTER TABLE [dbo].[ProControlDato] CHECK CONSTRAINT [FK_ProControlDato_ProControles]
GO
ALTER TABLE [dbo].[ProControles]  WITH NOCHECK ADD  CONSTRAINT [FK_ProControles_ProCabecera] FOREIGN KEY([IdPrograma], [IdProCabecera])
REFERENCES [dbo].[ProCabecera] ([IdPrograma], [IdProcabecera])
GO
ALTER TABLE [dbo].[ProControles] CHECK CONSTRAINT [FK_ProControles_ProCabecera]
GO
ALTER TABLE [dbo].[ProControles]  WITH NOCHECK ADD  CONSTRAINT [FK_ProControles_ProCatalogoControles] FOREIGN KEY([IdPrograma], [IdControl])
REFERENCES [dbo].[ProCatalogoControles] ([IdPrograma], [IdControl])
GO
ALTER TABLE [dbo].[ProControles] CHECK CONSTRAINT [FK_ProControles_ProCatalogoControles]
GO
ALTER TABLE [dbo].[ProDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProDiagnosticos_Diagnosticos] FOREIGN KEY([IdDiagnostico])
REFERENCES [dbo].[Diagnosticos] ([IdDiagnostico])
NOT FOR REPLICATION
GO
ALTER TABLE [dbo].[ProDiagnosticos] CHECK CONSTRAINT [FK_ProDiagnosticos_Diagnosticos]
GO
ALTER TABLE [dbo].[ProDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProDiagnosticos_ProControles] FOREIGN KEY([IdPrograma], [IdProCabecera], [IdControl])
REFERENCES [dbo].[ProControles] ([IdPrograma], [IdProCabecera], [IdControl])
GO
ALTER TABLE [dbo].[ProDiagnosticos] CHECK CONSTRAINT [FK_ProDiagnosticos_ProControles]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [DepartamentosHospital_ProgramacionMedica_FK1] FOREIGN KEY([IdDepartamento])
REFERENCES [dbo].[DepartamentosHospital] ([IdDepartamento])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [DepartamentosHospital_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_ProgramacionMedica_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [Especialidades_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [Medicos_ProgramacionMedica_FK1] FOREIGN KEY([IdMedico])
REFERENCES [dbo].[Medicos] ([IdMedico])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [Medicos_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [Servicios_ProgramacionMedica_FK1] FOREIGN KEY([IdServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [Servicios_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [TiposProgramacion_ProgramacionMedica_FK1] FOREIGN KEY([IdTipoProgramacion])
REFERENCES [dbo].[TiposProgramacion] ([IdTipoProgramacion])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [TiposProgramacion_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_ProgramacionMedica_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [TiposServicio_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProgramacionMedica]  WITH NOCHECK ADD  CONSTRAINT [Turnos_ProgramacionMedica_FK1] FOREIGN KEY([IdTurno])
REFERENCES [dbo].[Turnos] ([IdTurno])
GO
ALTER TABLE [dbo].[ProgramacionMedica] CHECK CONSTRAINT [Turnos_ProgramacionMedica_FK1]
GO
ALTER TABLE [dbo].[ProProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProProcedimientos_ProControles] FOREIGN KEY([IdPrograma], [IdProCabecera], [IdControl])
REFERENCES [dbo].[ProControles] ([IdPrograma], [IdProCabecera], [IdControl])
GO
ALTER TABLE [dbo].[ProProcedimientos] CHECK CONSTRAINT [FK_ProProcedimientos_ProControles]
GO
ALTER TABLE [dbo].[ProProcedimientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProProcedimientos_TiposResultadosServInterm] FOREIGN KEY([IdResultado])
REFERENCES [dbo].[TiposResultadosServInterm] ([IdResultadoSI])
GO
ALTER TABLE [dbo].[ProProcedimientos] CHECK CONSTRAINT [FK_ProProcedimientos_TiposResultadosServInterm]
GO
ALTER TABLE [dbo].[ProTratamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProTratamientos_ProCatalogoTratamientos] FOREIGN KEY([IdPrograma], [IdProducto])
REFERENCES [dbo].[ProCatalogoTratamientos] ([IdPrograma], [IdProducto])
GO
ALTER TABLE [dbo].[ProTratamientos] CHECK CONSTRAINT [FK_ProTratamientos_ProCatalogoTratamientos]
GO
ALTER TABLE [dbo].[ProTratamientos]  WITH NOCHECK ADD  CONSTRAINT [FK_ProTratamientos_ProControles] FOREIGN KEY([IdPrograma], [IdProCabecera], [IdControl])
REFERENCES [dbo].[ProControles] ([IdPrograma], [IdProCabecera], [IdControl])
GO
ALTER TABLE [dbo].[ProTratamientos] CHECK CONSTRAINT [FK_ProTratamientos_ProControles]
GO
ALTER TABLE [dbo].[Provincias]  WITH NOCHECK ADD  CONSTRAINT [Departamentos_Provincias_FK1] FOREIGN KEY([IdDepartamento])
REFERENCES [dbo].[Departamentos] ([IdDepartamento])
GO
ALTER TABLE [dbo].[Provincias] CHECK CONSTRAINT [Departamentos_Provincias_FK1]
GO
ALTER TABLE [dbo].[RecetaCabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_RecetaCabecera_RecetaEstados] FOREIGN KEY([idEstado])
REFERENCES [dbo].[RecetaEstados] ([idEstado])
GO
ALTER TABLE [dbo].[RecetaCabecera] CHECK CONSTRAINT [FK_RecetaCabecera_RecetaEstados]
GO
ALTER TABLE [dbo].[RecetaDetalle]  WITH NOCHECK ADD  CONSTRAINT [FK_RecetaDetalle_RecetaCabecera] FOREIGN KEY([idReceta])
REFERENCES [dbo].[RecetaCabecera] ([idReceta])
GO
ALTER TABLE [dbo].[RecetaDetalle] CHECK CONSTRAINT [FK_RecetaDetalle_RecetaCabecera]
GO
ALTER TABLE [dbo].[RecetaDetalle]  WITH CHECK ADD  CONSTRAINT [FK_RecetaDetalle_RecetaDosis] FOREIGN KEY([idDosisRecetada])
REFERENCES [dbo].[RecetaDosis] ([idDosis])
GO
ALTER TABLE [dbo].[RecetaDetalle] CHECK CONSTRAINT [FK_RecetaDetalle_RecetaDosis]
GO
ALTER TABLE [dbo].[RecetaDetalle]  WITH CHECK ADD  CONSTRAINT [FK_RecetaDetalle_RecetaEstadosDetalle] FOREIGN KEY([idEstadoDetalle])
REFERENCES [dbo].[RecetaEstadosDetalle] ([idEstadoDetalle])
GO
ALTER TABLE [dbo].[RecetaDetalle] CHECK CONSTRAINT [FK_RecetaDetalle_RecetaEstadosDetalle]
GO
ALTER TABLE [dbo].[RecetaDetalleItem]  WITH CHECK ADD  CONSTRAINT [FK_RecetaDetalleItem_RecetaCabecera] FOREIGN KEY([idReceta])
REFERENCES [dbo].[RecetaCabecera] ([idReceta])
GO
ALTER TABLE [dbo].[RecetaDetalleItem] CHECK CONSTRAINT [FK_RecetaDetalleItem_RecetaCabecera]
GO
ALTER TABLE [dbo].[RecetaViaAdministracion]  WITH CHECK ADD  CONSTRAINT [FK_RecetaViaAdministracion_RecetaClasificacionViasAdmin] FOREIGN KEY([IdCategoria])
REFERENCES [dbo].[RecetaClasificacionViasAdmin] ([IdCategoria])
GO
ALTER TABLE [dbo].[RecetaViaAdministracion] CHECK CONSTRAINT [FK_RecetaViaAdministracion_RecetaClasificacionViasAdmin]
GO
ALTER TABLE [dbo].[RolesItems]  WITH NOCHECK ADD  CONSTRAINT [ListBarItems_RolesItems_FK1] FOREIGN KEY([IdListItem])
REFERENCES [dbo].[ListBarItems] ([IdListItem])
GO
ALTER TABLE [dbo].[RolesItems] CHECK CONSTRAINT [ListBarItems_RolesItems_FK1]
GO
ALTER TABLE [dbo].[RolesItems]  WITH NOCHECK ADD  CONSTRAINT [SeguridadGrupos_SeguridadGruposPermisos_FK1] FOREIGN KEY([IdRol])
REFERENCES [dbo].[Roles] ([IdRol])
GO
ALTER TABLE [dbo].[RolesItems] CHECK CONSTRAINT [SeguridadGrupos_SeguridadGruposPermisos_FK1]
GO
ALTER TABLE [dbo].[RolesPermisos]  WITH NOCHECK ADD  CONSTRAINT [Permisos_RolesPermisos_FK1] FOREIGN KEY([IdPermiso])
REFERENCES [dbo].[Permisos] ([IdPermiso])
GO
ALTER TABLE [dbo].[RolesPermisos] CHECK CONSTRAINT [Permisos_RolesPermisos_FK1]
GO
ALTER TABLE [dbo].[RolesPermisos]  WITH NOCHECK ADD  CONSTRAINT [Roles_RolesPermisos_FK1] FOREIGN KEY([IdRol])
REFERENCES [dbo].[Roles] ([IdRol])
GO
ALTER TABLE [dbo].[RolesPermisos] CHECK CONSTRAINT [Roles_RolesPermisos_FK1]
GO
ALTER TABLE [dbo].[Servicios]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_Servicios_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[Servicios] CHECK CONSTRAINT [Especialidades_Servicios_FK1]
GO
ALTER TABLE [dbo].[Servicios]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_Servicios_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[Servicios] CHECK CONSTRAINT [TiposServicio_Servicios_FK1]
GO
ALTER TABLE [dbo].[ServiciosAtenSimultanea]  WITH CHECK ADD  CONSTRAINT [FK_ServiciosAtenSimultanea_Servicios] FOREIGN KEY([idServicio])
REFERENCES [dbo].[Servicios] ([IdServicio])
GO
ALTER TABLE [dbo].[ServiciosAtenSimultanea] CHECK CONSTRAINT [FK_ServiciosAtenSimultanea_Servicios]
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaFua]  WITH CHECK ADD  CONSTRAINT [FK_ServiciosAtenSimultaneaFua_TiposServiciosIntermedios] FOREIGN KEY([idTipo])
REFERENCES [dbo].[TiposServiciosIntermedios] ([idTipo])
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaFua] CHECK CONSTRAINT [FK_ServiciosAtenSimultaneaFua_TiposServiciosIntermedios]
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaFuaEquiv]  WITH CHECK ADD  CONSTRAINT [FK_ServiciosAtenSimultaneaFuaEquiv_TiposEdad] FOREIGN KEY([idTipoEdad])
REFERENCES [dbo].[TiposEdad] ([IdTipoEdad])
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaFuaEquiv] CHECK CONSTRAINT [FK_ServiciosAtenSimultaneaFuaEquiv_TiposEdad]
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaImpHIS]  WITH CHECK ADD  CONSTRAINT [FK_ServiciosAtenSimultaneaImpHIS_TiposEdad] FOREIGN KEY([idTipoEdad])
REFERENCES [dbo].[TiposEdad] ([IdTipoEdad])
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaImpHIS] CHECK CONSTRAINT [FK_ServiciosAtenSimultaneaImpHIS_TiposEdad]
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaImpHIS]  WITH CHECK ADD  CONSTRAINT [FK_ServiciosAtenSimultaneaImpHIS_TiposServiciosIntermedios] FOREIGN KEY([idTipo])
REFERENCES [dbo].[TiposServiciosIntermedios] ([idTipo])
GO
ALTER TABLE [dbo].[ServiciosAtenSimultaneaImpHIS] CHECK CONSTRAINT [FK_ServiciosAtenSimultaneaImpHIS_TiposServiciosIntermedios]
GO
ALTER TABLE [dbo].[SubclasificacionDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [ClasificacionDiagnosticos_SubclasificaciónDiagnosticos_FK1] FOREIGN KEY([IdClasificacionDx])
REFERENCES [dbo].[ClasificacionDiagnosticos] ([IdClasificacionDx])
GO
ALTER TABLE [dbo].[SubclasificacionDiagnosticos] CHECK CONSTRAINT [ClasificacionDiagnosticos_SubclasificaciónDiagnosticos_FK1]
GO
ALTER TABLE [dbo].[SubclasificacionDiagnosticos]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_SubclasificaciónDiagnosticos_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[SubclasificacionDiagnosticos] CHECK CONSTRAINT [TiposServicio_SubclasificaciónDiagnosticos_FK1]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_Pacientes] FOREIGN KEY([idPaciente])
REFERENCES [dbo].[Pacientes] ([IdPaciente])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_Pacientes]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposDocIdentidad] FOREIGN KEY([idTipoDocumentoTitular])
REFERENCES [dbo].[TiposDocIdentidad] ([IdDocIdentidad])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposDocIdentidad]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposDocIdentidad1] FOREIGN KEY([AnteriorIdTipoDocumentoAsegurado])
REFERENCES [dbo].[TiposDocIdentidad] ([IdDocIdentidad])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposDocIdentidad1]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposSUNASAafiliacion] FOREIGN KEY([IdAfiliacion])
REFERENCES [dbo].[SunasaTiposAfiliacion] ([idAfiliacion])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposSUNASAafiliacion]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposSUNASAoperacion] FOREIGN KEY([idOperacion])
REFERENCES [dbo].[SunasaTiposOperacion] ([idOperacion])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposSUNASAoperacion]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposSUNASAparentesco] FOREIGN KEY([idParentesco])
REFERENCES [dbo].[SunasaTiposParentesco] ([idParentesco])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposSUNASAparentesco]
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos]  WITH NOCHECK ADD  CONSTRAINT [FK_PacientesSunasa_TiposSUNASAregimen] FOREIGN KEY([idRegimen])
REFERENCES [dbo].[SunasaTiposRegimen] ([idRegimen])
GO
ALTER TABLE [dbo].[SunasaPacientesHistoricos] CHECK CONSTRAINT [FK_PacientesSunasa_TiposSUNASAregimen]
GO
ALTER TABLE [dbo].[TiposDestinoAtencion]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_TiposDestinoAtencion_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[TiposDestinoAtencion] CHECK CONSTRAINT [TiposServicio_TiposDestinoAtencion_FK1]
GO
ALTER TABLE [dbo].[TiposOrigenAtencion]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_TiposOrigenAtencion_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[TiposOrigenAtencion] CHECK CONSTRAINT [TiposServicio_TiposOrigenAtencion_FK1]
GO
ALTER TABLE [dbo].[TiposTarifaCpt]  WITH NOCHECK ADD  CONSTRAINT [FK_TiposTarifaCpt_TiposTarifa] FOREIGN KEY([idTipoTarifa])
REFERENCES [dbo].[TiposTarifa] ([idTipoTarifa])
GO
ALTER TABLE [dbo].[TiposTarifaCpt] CHECK CONSTRAINT [FK_TiposTarifaCpt_TiposTarifa]
GO
ALTER TABLE [dbo].[Turnos]  WITH NOCHECK ADD  CONSTRAINT [Especialidades_Turnos_FK1] FOREIGN KEY([IdEspecialidad])
REFERENCES [dbo].[Especialidades] ([IdEspecialidad])
GO
ALTER TABLE [dbo].[Turnos] CHECK CONSTRAINT [Especialidades_Turnos_FK1]
GO
ALTER TABLE [dbo].[Turnos]  WITH NOCHECK ADD  CONSTRAINT [TiposServicio_Turnos_FK1] FOREIGN KEY([IdTipoServicio])
REFERENCES [dbo].[TiposServicio] ([IdTipoServicio])
GO
ALTER TABLE [dbo].[Turnos] CHECK CONSTRAINT [TiposServicio_Turnos_FK1]
GO
ALTER TABLE [dbo].[UsuariosRoles]  WITH NOCHECK ADD  CONSTRAINT [Empleados_UsuariosRoles_FK1] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleados] ([IdEmpleado])
GO
ALTER TABLE [dbo].[UsuariosRoles] CHECK CONSTRAINT [Empleados_UsuariosRoles_FK1]
GO
ALTER TABLE [dbo].[UsuariosRoles]  WITH NOCHECK ADD  CONSTRAINT [SeguridadGrupos_SeguridadUsuariosGrupos_FK1] FOREIGN KEY([IdRol])
REFERENCES [dbo].[Roles] ([IdRol])
GO
ALTER TABLE [dbo].[UsuariosRoles] CHECK CONSTRAINT [SeguridadGrupos_SeguridadUsuariosGrupos_FK1]
GO
ALTER TABLE [Imagenes].[Procedimiento]  WITH CHECK ADD  CONSTRAINT [FK_CPT_Servicio] FOREIGN KEY([IdServicio])
REFERENCES [Imagenes].[Servicio] ([IdServicio])
GO
ALTER TABLE [Imagenes].[Procedimiento] CHECK CONSTRAINT [FK_CPT_Servicio]
GO
/****** Object:  StoredProcedure [dbo].[a_categoriaeessSeleccionarPorCatAbreviatura]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[a_categoriaeessSeleccionarPorCatAbreviatura]
	@Cat_Abreviatura [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT cat_IdCategoriaEESS,
		cat_Abreviatura ,
		cat_Descripcion,
		cat_Nivel,
		cat_IdEstado
	FROM a_categoriaeess
	WHERE LTRIM(RTRIM(cat_Abreviatura)) = LTRIM(RTRIM(@Cat_Abreviatura))
GO
ALTER AUTHORIZATION ON [dbo].[a_categoriaeessSeleccionarPorCatAbreviatura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AbreTablaFox]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AbreTablaFox]
	@TablaDBF [varchar](50),
	@Filtro [varchar](50),
	@Order [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL= 'SELECT *  FROM ' + @TablaDBF

IF @Filtro <>''
	BEGIN
		SET @SQL=@SQL + ' where ' + @Filtro
	END

IF @Order <>''
	BEGIN
		SET @SQL=@SQL + ' order by ' + @Order
	END

EXEC (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AbreTablaFox] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaAtencionesNacimientosEliminaAtencionesHijoMadre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaAtencionesNacimientosEliminaAtencionesHijoMadre]
	@IdPacienteNacido [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
UPDATE AtencionesNacimientos set idPacienteNacido=null where idPacienteNacido=@IdPacienteNacido
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
DELETE from  AtencionesHijoMadre where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaAtencionesNacimientosEliminaAtencionesHijoMadre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[actualizaCamasDeObservacionConNull]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[actualizaCamasDeObservacionConNull]
WITH EXECUTE AS CALLER
AS
update dbo.Atenciones set dbo.atenciones.IdCamaEgreso =
     (select top 1 dbo.AtencionesEstanciaHospitalaria.IdServicio from dbo.AtencionesEstanciaHospitalaria
	 where dbo.AtencionesEstanciaHospitalaria.IdAtencion =dbo.Atenciones.IdAtencion and
	 dbo.AtencionesEstanciaHospitalaria.IdServicio=dbo.Atenciones.IdServicioEgreso
	 order by dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion desc)
where
      dbo.atenciones.IdTipoServicio =2 and dbo.Atenciones.IdCamaEgreso is null
	  and not(dbo.Atenciones.FechaEgreso is null) and
	  dbo.atenciones.IdServicioEgreso in (select idservicio from servicios where EsObservacionEmergencia =1)
GO
ALTER AUTHORIZATION ON [dbo].[actualizaCamasDeObservacionConNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaCamasXIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaCamasXIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
update Camas set IdPaciente = null, IdEstadoCama = 1
 where IdPaciente =@IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaCamasXIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaCorrelativosPorAnio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaCorrelativosPorAnio]
	@Anio [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from farmMovimiento where year(fechaCreacion)=@Anio
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaCorrelativosPorAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaDatosPacienteBoleta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaDatosPacienteBoleta]
	@IdComprobantePago [int],
	@IdPaciente [int],
	@RazonSocial [varchar](50)
WITH EXECUTE AS CALLER
AS
UPDATE CajaComprobantesPago
SET idPaciente=@IdPaciente,
RazonSocial=@RazonSocial
WHERE idComprobantePago= @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaDatosPacienteBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFacturacionPaquetePorProductoYComprobante]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFacturacionPaquetePorProductoYComprobante]
	@IdProducto [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPaquetes set AtencionId =null where idProducto=@IdProducto
AND idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFacturacionPaquetePorProductoYComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFacturacionPaquetesEnCaso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFacturacionPaquetesEnCaso]
	@IdMovimiento [int],
	@IdProducto [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
UPDATE FacturacionPaquetes
SET AtencionId =@IdMovimiento
WHERE idProducto=@IdProducto
AND idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFacturacionPaquetesEnCaso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPago]
	@AtencionId [int],
	@IdComprobantePago [int],
	@IdOrdenPago [int],
	@IdProducto [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
UPDATE FacturacionPaquetes set AtencionId=@AtencionId
WHERE idComprobantePago=@IdComprobantePago
and idOrdenPago=@IdOrdenPago
and idProducto=@IdProducto
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

 --actualiza IdPaciente en Boleta
UPDATE CajaComprobantesPago set idPaciente=@IdPaciente
WHERE idComprobantePago=@IdComprobantePago
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPagoIdNull]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPagoIdNull]
	@IdComprobantePago [int],
	@IdOrdenPago [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
UPDATE FacturacionPaquetes set AtencionId=null
WHERE idComprobantePago=@IdComprobantePago
and idOrdenPago=@IdOrdenPago
and idProducto=@IdProducto
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

 --actualiza IdPaciente en Boleta
UPDATE CajaComprobantesPago set idPaciente=null
WHERE idComprobantePago=@IdComprobantePago
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFacturacionPaquetesYCajaComprobantesPagoIdNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFarmMovimientoVentasXmovNumero]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFarmMovimientoVentasXmovNumero]
	@IdServicioPaciente [int],
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
update farmMovimientoVentas set idServicioPaciente=@IdServicioPaciente
where movNumero=@MovNumero and movTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFarmMovimientoVentasXmovNumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaFechaEgresoEnCEparaLosQtienenDx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaFechaEgresoEnCEparaLosQtienenDx]
	@horaEgreso [char](5),
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
update atenciones set fechaEgreso=fechaIngreso,horaEgreso=@horaEgreso where idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaFechaEgresoEnCEparaLosQtienenDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaIdPacienteEnTodasLasTablas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaIdPacienteEnTodasLasTablas]
	@IdPacienteEncontradoConHC [int],
	@IdPacienteActualConHCoTemp [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
update cajaComprobantesPago set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update camas set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update citas set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update constancias set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FactOrdenesBienes set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FactOrdenServicio set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FarmMovimientoNotaIngreso set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FarmMovimientoProgramas set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FarmMovimientoVentas set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FarmPreVenta set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update HistoriasSolicitadas set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update MovimientosFormatosHistoriaClinica set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update MovimientosHistoriaClinica set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update FacturacionCuentasAtencion set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update atenciones set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update SunasaPacientesHistoricos set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update PerinatalAtencion set idPaciente=@IdPacienteEncontradoConHC where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete from HistoriasClinicas where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete from pacientes where idPaciente=@IdPacienteActualConHCoTemp
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaIdPacienteEnTodasLasTablas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaIdPacienteEnTodasLasTablasSegunNroCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaIdPacienteEnTodasLasTablasSegunNroCuenta]
	@IdPacienteNew [int],
	@IdCuentaAtencion [int],
	@IdAtencion [int],
	@IdCama [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
update farmMovimientoVentas set idPaciente=@IdPacienteNew where idCuentaAtencion= @IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update factOrdenesBienes set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update CajaComprobantesPago set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update factOrdenServicio set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FarmMovimientoNotaIngreso set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FarmPreVenta set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update Atenciones set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update facturacionCuentasAtencion set idPaciente=@IdPacienteNew where idCuentaAtencion=@IdCuentaAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update HistoriasSolicitadas set idPaciente=@IdPacienteNew where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update MovimientosHistoriaClinica set idPaciente=@IdPacienteNew where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update Citas set idPaciente=@IdPacienteNew where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update Camas set idPaciente=@IdPacienteNew where idCama=@IdCama
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update AtencionesDatosAdicionales set DireccionDomicilio=(select DireccionDomicilio from Pacientes where idPaciente=@IdPacienteNew) where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaIdPacienteEnTodasLasTablasSegunNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaIdServicioNULL]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaIdServicioNULL]
	@IdServicioPaciente [int],
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
update factOrdenServicio set idServicioPaciente=@IdServicioPaciente where idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaIdServicioNULL] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaImporteDeCabeceraMovimientos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaImporteDeCabeceraMovimientos]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.Total AS totalMovimiento, dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.MovNumero,
                    dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio,
                    dbo.farmMovimientoDetalle.Total, dbo.farmMovimiento.fechaCreacion,dbo.farmMovimiento.idTipoConcepto
                FROM          dbo.farmMovimiento INNER JOIN
                                     dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                                     dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
                 where dbo.farmMovimiento.fechaCreacion Between @FechaInicio
                            and @FechaFin
                 ORDER BY dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaImporteDeCabeceraMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaPreciosParaFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaPreciosParaFarmacia]
	@idProducto [int],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumosHosp where idProducto=@idProducto
and idTipoFinanciamiento=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaPreciosParaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizarAtencionesIdEstadoAtencion0]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizarAtencionesIdEstadoAtencion0]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
update Atenciones set idEstadoAtencion=0
where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ActualizarAtencionesIdEstadoAtencion0] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaAutomaticaDetalle]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaAutomaticaDetalle]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
UPDATE RecetaDetalle SET cantidadDespachada=0 WHERE idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaAutomaticaDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaCabecerarXEstadoYComprobantePago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaCabecerarXEstadoYComprobantePago]
	@IdComprobantePago [int],
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
/*update RecetaCabecera
set idEstado=3,idComprobantePago=@IdComprobantePago
where idReceta=@IdReceta*/
update RecetaCabecera
set idEstado=3
where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaCabecerarXEstadoYComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaCabeceraYDetalle]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaCabeceraYDetalle]
	@IdCuentaAtencion [int],
	@IdReceta [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
/*
	IF (@IdCuentaAtencion > 0)
		BEGIN
		             UPDATE  RecetaCabecera SET idEstado=1 WHERE IdReceta=@IdReceta;
                                        delete from  RecetaDetalleItem  WHERE IdReceta=@IdReceta;
		END
	ELSE
		BEGIN
			UPDATE RecetaCabecera SET idEstado=1 WHERE idComprobantePago=@IdComprobantePago;
            delete from  RecetaDetalleItem  WHERE IdReceta=(select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago);
		END

		IF (@IdReceta > 0)
			BEGIN
				UPDATE RecetaDetalle SET cantidadDespachada=0 WHERE idReceta=@IdReceta
			END
	        else
		if @IdComprobantePago>0
                BEGIN
				   UPDATE RecetaDetalle SET cantidadDespachada=0 WHERE idReceta=(select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
			    END  */
    IF (@IdCuentaAtencion > 0)
		BEGIN
		    UPDATE  RecetaCabecera SET idEstado=1 WHERE IdReceta=@IdReceta;
                    delete from  RecetaDetalleItem  WHERE IdReceta=@IdReceta;
		END
	ELSE
		BEGIN
			UPDATE RecetaCabecera SET idEstado=1 WHERE idreceta=(
			                                         select top 1 recetadetalleitem.idreceta from recetadetalleitem
                                                     where recetadetalleitem.idComprobantePago=@IdComprobantePago);
                          delete from  RecetaDetalleItem  WHERE  idComprobantePago=@IdComprobantePago              ;
		END
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaCabeceraYDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaCabeceraYDetalleItem]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaCabeceraYDetalleItem]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
UPDATE RecetaCabecera SET idEstado=2  WHERE idreceta=(select top 1 recetadetalleitem.idreceta from recetadetalleitem
                                                     where recetadetalleitem.idComprobantePago=@IdComprobantePago)
update RecetaDetalleItem  set idestado=2 where idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaCabeceraYDetalleItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaCabeceraYDetalleSoloBoletaAnulada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaCabeceraYDetalleSoloBoletaAnulada]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
/*UPDATE RecetaDetalle SET cantidadDespachada=0 WHERE idReceta=
                (select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
delete from  RecetaDetalleItem  WHERE idReceta=
                (select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
UPDATE RecetaCabecera SET idEstado=1,idComprobantePago=null WHERE idComprobantePago=@IdComprobantePago*/
UPDATE RecetaCabecera SET idEstado=1 WHERE idreceta=(select top 1 recetadetalleitem.idreceta from recetadetalleitem
                                                     where recetadetalleitem.idComprobantePago=@IdComprobantePago)
delete from  RecetaDetalleItem  WHERE idComprobantePago=@IdComprobantePago


GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaCabeceraYDetalleSoloBoletaAnulada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ActualizaRecetaCabeceraYDetalleSoloPagantes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ActualizaRecetaCabeceraYDetalleSoloPagantes]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
/*
			UPDATE RecetaCabecera SET idEstado=3  WHERE idComprobantePago=@IdComprobantePago
			UPDATE RecetaDetalle SET cantidadDespachada=0 WHERE idReceta=(select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
                                        delete from RecetaDetalleItem  where idReceta=  (select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
*/

UPDATE RecetaCabecera SET idEstado=3  WHERE idreceta=(select top 1 recetadetalleitem.idreceta from recetadetalleitem
                                                     where recetadetalleitem.idComprobantePago=@IdComprobantePago)
update RecetaDetalleItem  set idestado=3 where idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ActualizaRecetaCabeceraYDetalleSoloPagantes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AdmisionBuscarPacientesAltaMedica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AdmisionBuscarPacientesAltaMedica]
	@lcFecha [varchar](10),
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
if @lcFecha<>''
	if @IdServicio<>0
		begin
			SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
								 dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
								 dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
								 AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
								  dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso,
								  dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, CONVERT(char(10), dbo.Atenciones.FechaEgresoAdministrativo, 103)
								  AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
							   dbo.Atenciones.idEstadoAtencion
			FROM         dbo.Atenciones LEFT OUTER JOIN
								  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
								  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
								  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
								  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
			WHERE        dbo.Atenciones.FechaEgreso is null and dbo.Atenciones.FechaIngreso=CONVERT(DATETIME,@lcFecha,103) and dbo.Atenciones.idTipoServicio in (2,4) and dbo.atenciones.EsPacienteExterno<>1
						 and dbo.Atenciones.IdServicioEgreso=@IdServicio
							  order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
		end
	else
		begin
			SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
								 dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
								 dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
								 AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
								  dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso,
								  dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, CONVERT(char(10), dbo.Atenciones.FechaEgresoAdministrativo, 103)
								  AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
							   dbo.Atenciones.idEstadoAtencion
			FROM         dbo.Atenciones LEFT OUTER JOIN
								  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
								  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
								  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
								  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
			WHERE        dbo.Atenciones.FechaEgreso is null and dbo.Atenciones.FechaIngreso=CONVERT(DATETIME,@lcFecha,103) and dbo.Atenciones.idTipoServicio in (2,4) and dbo.atenciones.EsPacienteExterno<>1
							  order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
		end

else

	if @IdServicio<>0
		begin
			SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
								 dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
								 dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
								 AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
								  dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso,
								  dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, CONVERT(char(10), dbo.Atenciones.FechaEgresoAdministrativo, 103)
								  AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
							   dbo.Atenciones.idEstadoAtencion
			FROM         dbo.Atenciones LEFT OUTER JOIN
								  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
								  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
								  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
								  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
			WHERE        dbo.Atenciones.FechaEgreso is null and dbo.Atenciones.idTipoServicio in (2,4) and dbo.atenciones.EsPacienteExterno<>1
						 and dbo.Atenciones.IdServicioEgreso=@IdServicio
							  order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
		end
	else
		begin
			SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
								 dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
								 dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
								 AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
								  dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso,
								  dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, CONVERT(char(10), dbo.Atenciones.FechaEgresoAdministrativo, 103)
								  AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
							   dbo.Atenciones.idEstadoAtencion
			FROM         dbo.Atenciones LEFT OUTER JOIN
								  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
								  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
								  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
								  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
			WHERE        dbo.Atenciones.FechaEgreso is null and dbo.Atenciones.idTipoServicio in (2,4) and dbo.atenciones.EsPacienteExterno<>1
							  order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
		end
GO
ALTER AUTHORIZATION ON [dbo].[AdmisionBuscarPacientesAltaMedica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AnulaPagosConsultaCEporPaquetes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AnulaPagosConsultaCEporPaquetes]
	@Anulado [int],
	@Atendido [int],
	@IdCuentaAtencion [int],
	@IdPuntoCArga [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenSErvicioPagos set idEstadoFacturacion=@Anulado
where idEstadoFacturacion=@Atendido and idOrden=(select idOrden from factOrdenServicio where idCuentaAtencion=@IdCuentaAtencion  and idPuntoCArga=@IdPuntoCArga)
GO
ALTER AUTHORIZATION ON [dbo].[AnulaPagosConsultaCEporPaquetes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AnularCptGeneradasEnCitas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AnularCptGeneradasEnCitas]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
declare @idOrden int
  select @idOrden=(select top 1 idOrden from FactOrdenServicio where IdCuentaAtencion =@idcuenta and IdPuntoCarga =6)
  update FactOrdenServicio set idestadofacturacion=9 where IdOrden =@idOrden
  update FactOrdenServicioPagos set IdEstadoFacturacion =9 where idOrden =@idOrden
  update FacturacionServicioFinanciamientos set idEstadoFacturacion =9 where idOrden =@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[AnularCptGeneradasEnCitas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioAgregar]
	@IdServicio [int],
	@IdEmpleado [int],
	@IdArchivero [int] OUTPUT,
	@EsConsultorioAsignado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ArchiveroServicio (
IdServicio,IdEmpleado,EsConsultorioAsignado) values (
@IdServicio,@IdEmpleado,@EsConsultorioAsignado)
set @IdArchivero = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioEliminar]
	@IdArchivero [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ArchiveroServicio
where IdArchivero = @IdArchivero
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioEliminarXIdEmpleado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioEliminarXIdEmpleado]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
delete from ArchiveroServicio where idEmpleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioEliminarXIdEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL =  'select
         distinct ArchiveroServicio.IdEmpleado,
         Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
         from
         (ArchiveroServicio
        left join Empleados on ArchiveroServicio.IdEmpleado = Empleados.IdEmpleado) where  ' +  @lcFiltro
else
   SET  @SQL =  'select
         distinct ArchiveroServicio.IdEmpleado,
         Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
         from
         (ArchiveroServicio
        left join Empleados on ArchiveroServicio.IdEmpleado = Empleados.IdEmpleado) '


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioModificar]
	@IdServicio [int],
	@IdEmpleado [int],
	@IdArchivero [int],
	@EsConsultorioAsignado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ArchiveroServicio
set
IdServicio = @IdServicio,
IdEmpleado = @IdEmpleado,
EsConsultorioAsignado=@EsConsultorioAsignado
where IdArchivero = @IdArchivero
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioSeleccionarHistoriasSolicitadas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioSeleccionarHistoriasSolicitadas]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select
HistoriasSolicitadas.IdHistoriaSolicitada,
convert(char(10), HistoriasSolicitadas.FechaSolicitud,103) + ' ' + HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,
convert(char(10), HistoriasSolicitadas.FechaRequerida,103) + ' ' + HistoriasSolicitadas.HoraRequerida as FechaRequerida
,HistoriasSolicitadas.IdServicio,
Servicios.Codigo,
Servicios.Nombre,
Pacientes.IdPaciente,
Pacientes.IdTipoNumeracion,
Pacientes.NroHistoriaClinica,
Pacientes.ApellidoPaterno + ' ' + Pacientes.ApellidoMaterno + ' ' + Pacientes.PrimerNombre as Nombre
from HistoriasSolicitadas
left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
left join ArchiveroServicio on Servicios.IdServicio = ArchiveroServicio.IdServicio
left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente
where ArchiveroServicio.IdEmpleado = @IdEmpleado
and IdMovimiento is null
order by HistoriasSolicitadas.IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioSeleccionarHistoriasSolicitadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioSeleccionarPorId]
	@IdArchivero [int]
WITH EXECUTE AS CALLER
AS
select * from ArchiveroServicio
where IdArchivero = @IdArchivero
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiveroServicioXidEmpleado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ArchiveroServicioXidEmpleado]
	@lIdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select
         Servicios.IdServicio,
         Servicios.Codigo + ' - ' + Servicios.Nombre as NombreServicio,ArchiveroServicio.EsConsultorioAsignado
         from
         (ArchiveroServicio
         left join Servicios on ArchiveroServicio.IdServicio = Servicios.IdServicio)
         where ArchiveroServicio.IdEmpleado =@lIdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[ArchiveroServicioXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ArchiverosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ArchiverosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select distinct ArchiveroServicio.IdEmpleado,
LTRIM(Empleados.ApellidoPaterno) + ' ' + LTRIM(Empleados.ApellidoMaterno) + ' ' + LTRIM(Empleados.Nombres) AS ApAmNo
from (ArchiveroServicio left join Empleados on ArchiveroServicio.IdEmpleado = Empleados.IdEmpleado)
order by ApAmNo
GO
ALTER AUTHORIZATION ON [dbo].[ArchiverosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AreaTramitaSegurosDevuelveTodosSegunFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AreaTramitaSegurosDevuelveTodosSegunFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)

If @Filtro <> ' '

	SET  @SQL = 'select * from AreaTramitaSeguros Where ' +   @Filtro + ' order by descripcion'

ELSE
	SET  @SQL = 'select * from AreaTramitaSeguros order by descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AreaTramitaSegurosDevuelveTodosSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionCantidadServiciosFacturados]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionCantidadServiciosFacturados]
	@IdAtencion [int],
	@Cantidad [int] OUTPUT
WITH EXECUTE AS CALLER
AS
select @Cantidad = count(*) from FacturacionServicios where IdAtencion = @IdAtencion and IdEstadoFacturacion <> 1
GO
ALTER AUTHORIZATION ON [dbo].[AtencionCantidadServiciosFacturados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesActivasFiltraXanioIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesActivasFiltraXanioIngreso]
	@lnAnio [int]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idTipoServicio<=3 and idEstadoAtencion<>0 and year(fechaIngreso)=@lnAnio
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesActivasFiltraXanioIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesActualizaCreditoHospitalario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesActualizaCreditoHospitalario]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
update Atenciones set idFormaPago=5 where idTipoServicio<>1 and idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesActualizaCreditoHospitalario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesActualizaIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesActualizaIdPaciente]
	@IdCuentaAtencion [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
update Atenciones set idPaciente=@idPaciente where  idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesActualizaIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesActualizarEdadPorTipoEdad]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesActualizarEdadPorTipoEdad]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
update dbo.Atenciones set edad=11 Where (Edad = 12) And (IdTipoEdad = 2)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update dbo.Atenciones set edad=23 Where (Edad = 24) And (IdTipoEdad = 4)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesActualizarEdadPorTipoEdad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesAgregar]
	@HoraIngreso [char](5),
	@FechaIngreso [datetime],
	@IdTipoServicio [int],
	@IdPaciente [int],
	@IdAtencion [int] OUTPUT,
	@IdTipoCondicionALEstab [int],
	@FechaEgresoAdministrativo [datetime],
	@IdCamaEgreso [int],
	@IdCamaIngreso [int],
	@IdServicioEgreso [int],
	@IdTipoAlta [int],
	@IdCondicionAlta [int],
	@IdTipoEdad [int],
	@IdOrigenAtencion [int],
	@IdDestinoAtencion [int],
	@HoraEgresoAdministrativo [char](5),
	@IdTipoCondicionAlServicio [int],
	@HoraEgreso [char](5),
	@FechaEgreso [datetime],
	@IdMedicoEgreso [int],
	@Edad [int],
	@IdEspecialidadMedico [int],
	@IdMedicoIngreso [int],
	@IdServicioIngreso [int],
	@IdTipoGravedad [int],
	@IdCuentaAtencion [int],
	@idFormaPago [int],
	@IdUsuarioAuditoria [int],
	@idFuenteFinanciamiento [int],
	@idEstadoAtencion [int],
	@EsPacienteExterno [bit],
	@idSunasaPacienteHistorico [int],
	@HoraInicioAtencion [char](5),
	@EpsPorcentaje [money]
WITH EXECUTE AS CALLER
AS
insert into Atenciones (
HoraIngreso,FechaIngreso,IdTipoServicio,
IdPaciente,IdTipoCondicionALEstab,
FechaEgresoAdministrativo,IdCamaEgreso,IdCamaIngreso,
IdServicioEgreso,IdTipoAlta,IdCondicionAlta,IdTipoEdad,IdOrigenAtencion,IdDestinoAtencion,
HoraEgresoAdministrativo,IdTipoCondicionAlServicio,HoraEgreso,FechaEgreso,IdMedicoEgreso,
Edad,IdEspecialidadMedico,IdMedicoIngreso,IdServicioIngreso,IdTipoGravedad,IdCuentaAtencion,
idFormaPago,idFuenteFinanciamiento,idEstadoAtencion,EsPacienteExterno,idSunasaPacienteHistorico,
HoraInicioAtencion,EpsPorcentaje)
values (
@HoraIngreso,@FechaIngreso,@IdTipoServicio,
@IdPaciente,@IdTipoCondicionALEstab,
@FechaEgresoAdministrativo,@IdCamaEgreso,@IdCamaIngreso,
@IdServicioEgreso,@IdTipoAlta,@IdCondicionAlta,@IdTipoEdad,@IdOrigenAtencion,@IdDestinoAtencion,
@HoraEgresoAdministrativo,@IdTipoCondicionAlServicio,@HoraEgreso,@FechaEgreso,@IdMedicoEgreso,
@Edad,@IdEspecialidadMedico,@IdMedicoIngreso,@IdServicioIngreso,@IdTipoGravedad,@IdCuentaAtencion,
@idFormaPago,@idFuenteFinanciamiento,@idEstadoAtencion,@EsPacienteExterno,@idSunasaPacienteHistorico,
@HoraInicioAtencion,@EpsPorcentaje)
set @IdAtencion = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesBusquedaDeAtenciones]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesBusquedaDeAtenciones]
	@IdPaciente [int],
	@IdTipoNumeracion [int],
	@NroHistoriaClinica [int],
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL = ' SELECT DISTINCT
	  dbo.FacturacionCuentasAtencion.IdCuentaAtencion, dbo.EstadosCuenta.Descripcion AS EstadoCuenta, dbo.Atenciones.IdPaciente,
	  dbo.Atenciones.IdAtencion, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso,
	  dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	  dbo.Pacientes.SegundoNombre, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
	  dbo.FacturacionCuentasAtencion.IdEstado, dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion,
	  dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdServicioIngreso
	FROM         dbo.Atenciones LEFT OUTER JOIN
	                     dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                     dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                     dbo.EstadosCuenta ON dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado LEFT OUTER JOIN
	                     dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	WHERE Atenciones.idEstadoAtencion<>0 '

 IF  @ApellidoPaterno <> ''
	BEGIN
			SET @SQL = @SQL + ' and Pacientes.ApellidoPaterno like ''' + @ApellidoPaterno +  '%'''
	END
 IF  @ApellidoMaterno <> ''
	BEGIN
		SET @SQL = @SQL + ' and Pacientes.ApellidoMaterno like ''' + @ApellidoMaterno +  '%'''
	END

 IF  @PrimerNombre <> ''
	BEGIN
		SET @SQL = @SQL + ' and Pacientes.PrimerNombre like ''%' + @PrimerNombre +  '%'''
	END

IF @NroHistoriaClinica <> 0
	BEGIN
		SET @SQL = @SQL + ' and Pacientes.NroHistoriaClinica = ' + @NroHistoriaClinica
	END

IF @IdTipoNumeracion <> 0
	BEGIN
		SET @SQL = @SQL + ' and Pacientes.IdTipoNumeracion = ' + @IdTipoNumeracion
	END

IF @IdPaciente <> 0
	BEGIN
		SET @SQL = @SQL + ' and Pacientes.IdPaciente = ' + @IdPaciente
	END
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesBusquedaDeAtenciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCensoEstanciaHospitalariaPacientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesCensoEstanciaHospitalariaPacientes]
WITH EXECUTE AS CALLER
AS
SELECT  DISTINCT P.NRODOCUMENTO as NroDocumento ,P.APELLIDOPATERNO as Apellido_Paterno, P.APELLIDOMATERNO as Apellido_Materno,RTRIM(LTRIM(UPPER(ISNULL(P.PrimerNombre,'')) + ' ' + RTRIM(LTRIM(UPPER(ISNULL(P.SEGUNDONOMBRE,'')))) + ' ' +  RTRIM(LTRIM(UPPER(ISNULL(P.TERCERNOMBRE,'')))))) AS Nombres,  CONVERT (VARCHAR, P.FECHANACIMIENTO,103) AS Fec_Nac,C.CODIGO AS NroCama,
S2.NOMBRE as Servicio_Ingreso_Origen, CONVERT (VARCHAR,A.FECHAINGRESO,103)+'  '+A.HORAINGRESO AS FechaHora_IngresoEstabl,S.NOMBRE as Servicio_Actual_Atencion
,A.IDCUENTAATENCION AS IdCuenta_Atencion,F.TotalPorPagar,0 as RGBRojo,0 as RGBVerde, 0 as RGBAzul
FROM Atenciones A
INNER JOIN PACIENTES P ON  P.IDPACIENTE=A.IDPACIENTE
INNER JOIN TiposDocIdentidad DOC ON DOC.IDDOCIDENTIDAD=P.IDDOCIDENTIDAD
INNER JOIN CAMAS C ON C.IDPACIENTE=P.IDPACIENTE
INNER JOIN SERVICIOS S ON S.IDSERVICIO=C.IdServicioUbicacionActual
INNER JOIN AtencionesEstanciaHospitalaria AEH ON AEH.IDATENCION=A.IDATENCION
INNER JOIN SERVICIOS S2 ON S2.IDSERVICIO=A.IDSERVICIOINGRESO
INNER JOIN FacturacionCuentasAtencion F ON F.IDCUENTAATENCION=A.IDCUENTAATENCION
WHERE C.IDCONDICIONOCUPACION=1  AND AEH.FECHADESOCUPACION IS NULL AND A.FECHAEGRESOADMINISTRATIVO IS NULL
AND A.IDESTADOATENCION=1
order by F.TotalPorPagar
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCensoEstanciaHospitalariaPacientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCEparaFormatoHIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesCEparaFormatoHIS]
	@idServicioIngreso [int],
	@IdMedico [int],
	@lcFechaIngreso [datetime],
	@lcFechaAlta [datetime],
	@filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
if @filtro=''
   SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.Edad, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso,
                      dbo.Atenciones.IdDestinoAtencion, dbo.Atenciones.IdTipoCondicionAlServicio, dbo.Atenciones.IdTipoCondicionALEstab,
                      dbo.Atenciones.IdServicioIngreso, dbo.Atenciones.IdMedicoIngreso, dbo.Atenciones.IdEspecialidadMedico, dbo.Atenciones.IdMedicoEgreso,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Atenciones.IdOrigenAtencion, dbo.Atenciones.FechaEgresoAdministrativo,
                      dbo.Atenciones.HoraEgresoAdministrativo, dbo.Atenciones.IdCondicionAlta, dbo.Atenciones.IdTipoAlta, dbo.Atenciones.IdServicioEgreso,
                      dbo.Atenciones.IdCamaIngreso, dbo.Atenciones.IdCamaEgreso, dbo.Atenciones.IdTipoGravedad, dbo.Atenciones.IdTipoEdad,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento,
                      dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno, dbo.Atenciones.idSunasaPacienteHistorico, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.IdTipoSexo, dbo.Provincias.Nombre AS provincia, dbo.Distritos.Nombre AS distrito, dbo.Departamentos.Nombre AS dpto,
                      dbo.Pacientes.NroDocumento, dbo.Pacientes.IdDocIdentidad, dbo.Pacientes.IdEtnia, dbo.FuentesFinanciamiento.CodigoHIS,
                      dbo.Pacientes.FichaFamiliar, dbo.TiposEdad.IdTipoEdad AS Expr1, dbo.TiposEdad.Descripcion AS tEdad, dbo.Pacientes.FechaNacimiento,
                      LTRIM(dbo.Pacientes.PrimerNombre) + ' ' + LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + dbo.Pacientes.ApellidoMaterno AS Paciente1,
                      dbo.CentrosPoblados.Nombre AS CentroPoblado,FuentesFinanciamiento.descripcion ffinanciamiento,dbo.Pacientes.DireccionDomicilio
    FROM         dbo.Departamentos RIGHT OUTER JOIN
                      dbo.Provincias RIGHT OUTER JOIN
                      dbo.Pacientes LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoDomicilio = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Distritos ON dbo.Pacientes.IdDistritoDomicilio = dbo.Distritos.IdDistrito ON dbo.Provincias.IdProvincia = dbo.Distritos.IdProvincia ON
                      dbo.Departamentos.IdDepartamento = dbo.Provincias.IdDepartamento RIGHT OUTER JOIN
                      dbo.Atenciones LEFT OUTER JOIN
                      dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
                      dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
                 where       dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@lcFechaIngreso, 103)) and (CONVERT(DATETIME,@lcFechaAlta , 103))
                               and  dbo.Atenciones.IdMedicoIngreso = @IdMedico  and dbo.Atenciones.idestadoAtencion<>0
                               and dbo.Atenciones.idServicioIngreso= @idServicioIngreso
                 order  by     dbo.atenciones.fechaIngreso
else
   SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.Edad, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso,
                      dbo.Atenciones.IdDestinoAtencion, dbo.Atenciones.IdTipoCondicionAlServicio, dbo.Atenciones.IdTipoCondicionALEstab,
                      dbo.Atenciones.IdServicioIngreso, dbo.Atenciones.IdMedicoIngreso, dbo.Atenciones.IdEspecialidadMedico, dbo.Atenciones.IdMedicoEgreso,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Atenciones.IdOrigenAtencion, dbo.Atenciones.FechaEgresoAdministrativo,
                      dbo.Atenciones.HoraEgresoAdministrativo, dbo.Atenciones.IdCondicionAlta, dbo.Atenciones.IdTipoAlta, dbo.Atenciones.IdServicioEgreso,
                      dbo.Atenciones.IdCamaIngreso, dbo.Atenciones.IdCamaEgreso, dbo.Atenciones.IdTipoGravedad, dbo.Atenciones.IdTipoEdad,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento,
                      dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno, dbo.Atenciones.idSunasaPacienteHistorico, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.IdTipoSexo, dbo.Provincias.Nombre AS provincia, dbo.Distritos.Nombre AS distrito, dbo.Departamentos.Nombre AS dpto,
                      dbo.Pacientes.NroDocumento, dbo.Pacientes.IdDocIdentidad, dbo.Pacientes.IdEtnia, dbo.FuentesFinanciamiento.CodigoHIS,
                      dbo.Pacientes.FichaFamiliar, dbo.TiposEdad.IdTipoEdad AS Expr1, dbo.TiposEdad.Descripcion AS tEdad, dbo.Pacientes.FechaNacimiento,
                       dbo.Pacientes.ApellidoPaterno+' '+ dbo.Pacientes.ApellidoMaterno+' '+dbo.Pacientes.PrimerNombre as Paciente, dbo.CentrosPoblados.Nombre AS CentroPoblado,
                      dbo.Servicios.codigoServicioHIS,FuentesFinanciamiento.descripcion ffinanciamiento,dbo.Pacientes.DireccionDomicilio
   FROM         dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad ON
                      dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.Departamentos RIGHT OUTER JOIN
                      dbo.Provincias RIGHT OUTER JOIN
                      dbo.Pacientes LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoDomicilio = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Distritos ON dbo.Pacientes.IdDistritoDomicilio = dbo.Distritos.IdDistrito ON dbo.Provincias.IdProvincia = dbo.Distritos.IdProvincia ON
                      dbo.Departamentos.IdDepartamento = dbo.Provincias.IdDepartamento ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
     where        dbo.Atenciones.idestadoAtencion<>0 and dbo.Atenciones.IdTipoServicio =1 and
                  dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@lcFechaIngreso, 103)) and (CONVERT(DATETIME,@lcFechaAlta , 103))
     order  by     dbo.atenciones.idpaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCEparaFormatoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCEseleccionarCITADOS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesCEseleccionarCITADOS]
	@lcFechaIngreso [datetime]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Servicios.Nombre AS Consultorio,dbo.Atenciones.HoraEgreso,
             dbo.Atenciones.IdAtencion,dbo.Atenciones.idServicioIngreso
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     (dbo.Atenciones.IdTipoServicio = 1) AND (dbo.Atenciones.idEstadoAtencion <> 0)
          and fechaIngreso=CONVERT(DATETIME,@lcFechaIngreso ,103)
ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCEseleccionarCITADOS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCEseleccionarCitadosYAtendidos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesCEseleccionarCitadosYAtendidos]
	@lcFechaIngreso [datetime],
	@idServicioIngreso [int]
WITH EXECUTE AS CALLER
AS
SELECT   *
FROM         dbo.Atenciones
WHERE     (dbo.Atenciones.IdTipoServicio = 1) AND (dbo.Atenciones.idEstadoAtencion <> 0)
          and dbo.Atenciones.fechaIngreso=CONVERT(DATETIME,@lcFechaIngreso ,103)
          and dbo.Atenciones.idServicioIngreso=@idServicioIngreso
ORDER BY dbo.Atenciones.HoraIngreso  desc
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCEseleccionarCitadosYAtendidos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCEseleccionarPorFechaServicioMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesCEseleccionarPorFechaServicioMedico]
	@lnIdMedicoIngreso [int],
	@lnIdServicioIngreso [int],
	@lcFechaIngreso [datetime]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idtipoServicio=1 and fechaIngreso=CONVERT(DATETIME,@lcFechaIngreso ,103)  and  idServicioIngreso=@lnIdServicioIngreso  and idMedicoIngreso=@lnIdMedicoIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCEseleccionarPorFechaServicioMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesCEseleccionarPorFechaServicioMedicoCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesCEseleccionarPorFechaServicioMedicoCuenta]
	@lnIdCuentaAtencion [int],
	@lnIdMedicoIngreso [int],
	@lnIdServicioIngreso [int],
	@lcFechaIngreso [datetime]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idtipoServicio=1 and fechaIngreso=CONVERT(DATETIME,@lcFechaIngreso,103)  and  idServicioIngreso=@lnIdServicioIngreso and
      idMedicoIngreso=@lnIdMedicoIngreso  and idCuentaAtencion=@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesCEseleccionarPorFechaServicioMedicoCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesConsultaExternaPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesConsultaExternaPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.Atenciones.FechaIngreso,dbo.Atenciones.idAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdDestinoAtencion, dbo.Pacientes.ApellidoPaterno,
                         dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,dbo.Atenciones.idCuentaAtencion
FROM     dbo.Atenciones LEFT OUTER JOIN
                          dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
where dbo.Atenciones.idtipoServicio=1 and dbo.Atenciones.idestadoAtencion<>0
                       and  dbo.Atenciones.FechaIngreso Between @FechaInicio and @FechaFin
order by dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConsultaExternaPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesConvenioAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesConvenioAgregar]
	@idPaciente [int],
	@idProducto [int],
	@nroOficio [varchar](20),
	@fechaSesion [datetime],
	@importeSesion [money],
	@IdAtencionesConvenio [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesConvenio(idPaciente,nroOficio,FechaSesion,ImporteSesion,idUsuario,idProducto)
 values (@idPaciente,@nroOficio,@fechaSesion,@importeSesion,@IdUsuarioAuditoria,@idProducto)
set @IdAtencionesConvenio = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtencionesConvenio,'AtencionesConvenio'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConvenioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesConvenioEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesConvenioEliminar]
	@IdAtencionesConvenio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesConvenio
where
IdAtencionesConvenio = @IdAtencionesConvenio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencionesConvenio,'AtencionesConvenio'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConvenioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesConvenioModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesConvenioModificar]
	@idPaciente [int],
	@idProducto [int],
	@nroOficio [varchar](20),
	@fechaSesion [datetime],
	@importeSesion [money],
	@IdAtencionesConvenio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesConvenio
set
idPaciente=@idPaciente,
nroOficio=@nroOficio,
fechaSesion=@fechaSesion,
importeSesion=@importeSesion,
idProducto=@idProducto
where IdAtencionesConvenio = @IdAtencionesConvenio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtencionesConvenio,'AtencionesConvenio'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConvenioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesConvenioSeleccionarPorFechaSesion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesConvenioSeleccionarPorFechaSesion]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesConvenio.*, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                      + ' ' + dbo.Pacientes.PrimerNombre AS dPaciente,dbo.Pacientes.nroHistoriaClinica as nroHistoriaClinica
FROM         dbo.AtencionesConvenio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.AtencionesConvenio.idPaciente = dbo.Pacientes.IdPaciente
where    (dbo.AtencionesConvenio.fechaSesion Between  @FechaEgrIni and  @FechaEgrFin)
order by   year(dbo.AtencionesConvenio.fechaSesion) ,month(dbo.AtencionesConvenio.fechaSesion),
                   dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.AtencionesConvenio.idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesConvenioSeleccionarPorFechaSesion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesActualizaRN]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesActualizaRN]
	@idAtencion [int],
	@RecienNacido [bit]
WITH EXECUTE AS CALLER
AS
update AtencionesDatosAdicionales set RecienNacido=@RecienNacido
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesActualizaRN] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesAgregar]
	@idAtencion [int],
	@DireccionDomicilio [varchar](100),
	@NombreAcompaniante [varchar](100),
	@Observacion [varchar](200),
	@ProximaCita [datetime],
	@NumeroDeHijos [int],
	@IdSiaSis [int],
	@FuaCodigoPrestacion [varchar](3),
	@SisCodigo [varchar](2),
	@IdTipoReferenciaDestino [int],
	@IdTipoReferenciaOrigen [int],
	@IdEstablecimientoDestino [int],
	@IdEstablecimientoOrigen [int],
	@IdEstablecimientoNoMinsaDestino [int],
	@IdEstablecimientoNoMinsaOrigen [int],
	@HuboInfeccionIntraHospitalaria [bit],
	@TieneNecropsia [bit],
	@IdMedicoRespNacimiento [int],
	@RecienNacido [bit],
	@NroReferenciaOrigen [varchar](20),
	@NroReferenciaDestino [varchar](20),
	@referenciaOservicio [varchar](7),
	@referenciaOidDiagnostico [int],
	@referenciaDservicio [varchar](7),
	@referenciaDfextension [datetime],
	@referenciaDftramite [datetime],
	@referenciaOdniMedico [varchar](8),
	@acompanianteDNI [varchar](8),
	@emergenciaCorrelativo [varchar](10),
	@sisAfiliacion [varchar](30),
	@idAtencionEmeg_CE [int],
	@ReferenciaMedicoOColeg [varchar](6),
	@ReferenciaMedicoOIdcolegio [varchar](2),
	@idServicioDestino [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesDatosAdicionales (
	idAtencion,DireccionDomicilio,NombreAcompaniante,Observacion,ProximaCita,NumeroDeHijos,IdSiaSis,FuaCodigoPrestacion,SisCodigo,
	IdTipoReferenciaDestino,IdTipoReferenciaOrigen,IdEstablecimientoDestino,IdEstablecimientoOrigen,IdEstablecimientoNoMinsaDestino,IdEstablecimientoNoMinsaOrigen,
	HuboInfeccionIntraHospitalaria,TieneNecropsia,IdMedicoRespNacimiento,RecienNacido,NroReferenciaOrigen,NroReferenciaDestino,
	referenciaOservicio,referenciaOidDiagnostico,referenciaDservicio,referenciaDfextension,referenciaDftramite,referenciaOdniMedico,
        acompanianteDNI,emergenciaCorrelativo,sisAfiliacion,idAtencionEmeg_CE,ReferenciaMedicoOColeg,ReferenciaMedicoOIdcolegio,idServicioDestino
	) values (
	@idAtencion,@DireccionDomicilio,@NombreAcompaniante,@Observacion,@ProximaCita,@NumeroDeHijos,@IdSiaSis,@FuaCodigoPrestacion,@SisCodigo,
	@IdTipoReferenciaDestino,@IdTipoReferenciaOrigen,@IdEstablecimientoDestino,@IdEstablecimientoOrigen,@IdEstablecimientoNoMinsaDestino,@IdEstablecimientoNoMinsaOrigen,
	@HuboInfeccionIntraHospitalaria,@TieneNecropsia,@IdMedicoRespNacimiento,@RecienNacido,@NroReferenciaOrigen,@NroReferenciaDestino,
	@referenciaOservicio,@referenciaOidDiagnostico,@referenciaDservicio,@referenciaDfextension,@referenciaDftramite,@referenciaOdniMedico,
        @acompanianteDNI,@emergenciaCorrelativo,@sisAfiliacion,@idAtencionEmeg_CE,@ReferenciaMedicoOColeg,@ReferenciaMedicoOIdcolegio,@idServicioDestino
	)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesEliminar]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesDatosAdicionales
where idAtencion = @idAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idAtencion,'AtencionesDatosAdicionales'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesModificar]
	@idAtencion [int],
	@DireccionDomicilio [varchar](100),
	@NombreAcompaniante [varchar](100),
	@Observacion [varchar](200),
	@ProximaCita [datetime],
	@NumeroDeHijos [int],
	@IdSiaSis [int],
	@FuaCodigoPrestacion [varchar](3),
	@SisCodigo [varchar](2),
	@IdTipoReferenciaDestino [int],
	@IdTipoReferenciaOrigen [int],
	@IdEstablecimientoDestino [int],
	@IdEstablecimientoOrigen [int],
	@IdEstablecimientoNoMinsaDestino [int],
	@IdEstablecimientoNoMinsaOrigen [int],
	@HuboInfeccionIntraHospitalaria [bit],
	@TieneNecropsia [bit],
	@IdMedicoRespNacimiento [int],
	@RecienNacido [bit],
	@NroReferenciaOrigen [varchar](20),
	@NroReferenciaDestino [varchar](20),
	@referenciaOservicio [varchar](7),
	@referenciaOidDiagnostico [int],
	@referenciaDservicio [varchar](7),
	@referenciaDfextension [datetime],
	@referenciaDftramite [datetime],
	@referenciaOdniMedico [varchar](8),
	@acompanianteDNI [varchar](8),
	@emergenciaCorrelativo [varchar](10),
	@sisAfiliacion [varchar](30),
	@idAtencionEmeg_CE [int],
	@ReferenciaMedicoOColeg [varchar](6),
	@ReferenciaMedicoOIdcolegio [varchar](2),
	@idServicioDestino [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesDatosAdicionales
	set
	DireccionDomicilio = @DireccionDomicilio,
	NombreAcompaniante = @NombreAcompaniante,
	Observacion = @Observacion,
	ProximaCita=@ProximaCita,
	NumeroDeHijos=@NumeroDeHijos,
	IdSiaSis=@IdSiaSis,
	FuaCodigoPrestacion=@FuaCodigoPrestacion,
	SisCodigo=@SisCodigo,
	IdTipoReferenciaDestino = @IdTipoReferenciaDestino,
	IdTipoReferenciaOrigen = @IdTipoReferenciaOrigen,
	IdEstablecimientoDestino = @IdEstablecimientoDestino,
	IdEstablecimientoOrigen = @IdEstablecimientoOrigen,
	IdEstablecimientoNoMinsaDestino = @IdEstablecimientoNoMinsaDestino,
	IdEstablecimientoNoMinsaOrigen = @IdEstablecimientoNoMinsaOrigen,
	HuboInfeccionIntraHospitalaria = @HuboInfeccionIntraHospitalaria,
	TieneNecropsia = @TieneNecropsia,
	IdMedicoRespNacimiento = @IdMedicoRespNacimiento,
	RecienNacido = @RecienNacido,
	NroReferenciaOrigen=@NroReferenciaOrigen,
	referenciaOidDiagnostico=@referenciaOidDiagnostico,
	NroReferenciaDestino=@NroReferenciaDestino,
	referenciaOservicio=@referenciaOservicio,
	referenciaDservicio=@referenciaDservicio,
	referenciaDfextension=@referenciaDfextension,
	referenciaDftramite=@referenciaDftramite,
	referenciaOdniMedico=@referenciaOdniMedico,
	acompanianteDNI=@acompanianteDNI,
	emergenciaCorrelativo=@emergenciaCorrelativo,
	sisAfiliacion=@sisAfiliacion,
	idAtencionEmeg_CE=@idAtencionEmeg_CE	,
    ReferenciaMedicoOColeg =@ReferenciaMedicoOColeg,
    ReferenciaMedicoOIdcolegio=@ReferenciaMedicoOIdcolegio,
            idServicioDestino=@idServicioDestino
	where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesModificarImprimioFicha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesModificarImprimioFicha]
	@idAtencion [int],
	@SeImprimioFicha [bit]
WITH EXECUTE AS CALLER
AS
UPDATE AtencionesDatosAdicionales SET
		SeImprimioFicha = @SeImprimioFicha
	WHERE idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesModificarImprimioFicha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionar1eraFila]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionar1eraFila]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
IF @idAtencion = 0
	BEGIN
		Select * from AtencionesDatosAdicionales
	END
ELSE
	BEGIN
		Select * from AtencionesDatosAdicionales where idAtencion=@idAtencion
	END
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionar1eraFila] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionarDxRefOrigen]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionarDxRefOrigen]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDatosAdicionales.idAtencion, dbo.AtencionesDatosAdicionales.referenciaOidDiagnostico,
           dbo.Diagnosticos.CodigoCIE2004,dbo.Diagnosticos.Descripcion
FROM         dbo.AtencionesDatosAdicionales LEFT OUTER JOIN
           dbo.Diagnosticos ON dbo.AtencionesDatosAdicionales.referenciaOidDiagnostico = dbo.Diagnosticos.IdDiagnostico
where dbo.AtencionesDatosAdicionales.idAtencion =@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionarDxRefOrigen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionarPorId]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesDatosAdicionales
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdCuenta]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDatosAdicionales.*
             FROM         dbo.AtencionesDatosAdicionales INNER JOIN
                                  dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion
             Where dbo.Atenciones.IdCuentaAtencion = @lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.Atenciones.IdPaciente, dbo.AtencionesDatosAdicionales.*, dbo.Atenciones.idEstadoAtencion
FROM            dbo.Atenciones INNER JOIN
                         dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
WHERE     dbo.Atenciones.IdPaciente=@idpaciente and  dbo.Atenciones.idEstadoAtencion<>0
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSeleccionarXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSeleccionarXidAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDatosAdicionales.*, dbo.Establecimientos.Nombre AS EstablecimientoOrigen,
                      Establecimientos_1.Nombre AS EstablecimientoDestino,dbo.Establecimientos.Codigo as codigoOrigen,
                      Establecimientos_1.Codigo as codigoDestino
FROM         dbo.AtencionesDatosAdicionales LEFT OUTER JOIN
                      dbo.Establecimientos Establecimientos_1 ON
                      dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino = Establecimientos_1.IdEstablecimiento LEFT OUTER JOIN
                      dbo.Establecimientos ON dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen = dbo.Establecimientos.IdEstablecimiento
where dbo.AtencionesDatosAdicionales.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSeleccionarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesSItieneCodigoPrestacionSIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesSItieneCodigoPrestacionSIS]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.AtencionesDatosAdicionales.FuaCodigoPrestacion,
                                    dbo.Servicios.UsaGalenHos,dbo.Atenciones.idTipoServicio,dbo.Servicios.UsaFua, dbo.AtencionesDatosAdicionales.idSiaSis
                 FROM         dbo.Atenciones INNER JOIN
                                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
                 Where dbo.Atenciones.IdCuentaAtencion = @lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesSItieneCodigoPrestacionSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDatosAdicionalesXfechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDatosAdicionalesXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.Edad, dbo.Atenciones.IdTipoEdad, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.IdDocIdentidad,
                      dbo.Pacientes.NroDocumento, dbo.Pacientes.IdTipoSexo, dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen,
                      Establecimientos_1.Codigo AS EESSdestinoRenaes, dbo.AtencionesDatosAdicionales.referenciaOservicio,
                      dbo.AtencionesDatosAdicionales.referenciaDservicio, dbo.AtencionesDatosAdicionales.referenciaDfextension,
                      dbo.AtencionesDatosAdicionales.referenciaDftramite, dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino, dbo.Atenciones.IdAtencion,
                      dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaEgreso, dbo.Establecimientos.Codigo AS EESSorigenRenaes
FROM         dbo.AtencionesDatosAdicionales INNER JOIN
                      dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                      dbo.Establecimientos ON dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen = dbo.Establecimientos.IdEstablecimiento LEFT OUTER JOIN
                      dbo.Establecimientos AS Establecimientos_1 ON
                      dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino = Establecimientos_1.IdEstablecimiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
       WHERE     ((NOT (dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen IS NULL)) OR  (NOT (dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino IS NULL)))
          and (dbo.Atenciones.FechaEgreso  Between  @FechaInicio and  @FechaFin) and dbo.Atenciones.idEstadoAtencion<>0


GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDatosAdicionalesXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesDatosAdicionalesXfiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[atencionesDatosAdicionalesXfiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)
--seT  @SQL =  'select * from atencionesDatosAdicionales where ' + @Filtro
set @sql='SELECT     dbo.AtencionesDatosAdicionales.*, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdDestinoAtencion
FROM         dbo.Atenciones INNER JOIN
dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion where ' + @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[atencionesDatosAdicionalesXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDePacienteElmismoDiaCE]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDePacienteElmismoDiaCE]
	@lnIdPaciente [int],
	@ldFecha [datetime]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idEstadoAtencion=1 and fechaIngreso=CONVERT(DATETIME,@ldFecha,103) and idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDePacienteElmismoDiaCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosAgregar]
	@IdSubclasificacionDx [int],
	@IdClasificacionDx [int],
	@IdDiagnostico [int],
	@IdAtencionDiagnostico [int] OUTPUT,
	@IdAtencion [int],
	@labConfHIS [varchar](3),
	@grupoHIS [int],
	@subGrupoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesDiagnosticos (
IdSubclasificacionDx,IdClasificacionDx,IdDiagnostico,IdAtencion,labConfHIS,grupoHIS,subGrupoHIS) values (
@IdSubclasificacionDx,@IdClasificacionDx,@IdDiagnostico,@IdAtencion,@labConfHIS,@grupoHIS,@subGrupoHIS)
set @IdAtencionDiagnostico = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtencionDiagnostico,'AtencionesDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosCEparaFormatoHIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosCEparaFormatoHIS]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion as dDiagnostico, dbo.Diagnosticos.CodigoCIE2004 as CodigoCIE10, dbo.Diagnosticos.ClaseDxHIS
                 FROM         dbo.AtencionesDiagnosticos INNER JOIN dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
                 where dbo.AtencionesDiagnosticos.idAtencion= @idAtencion
    ORDER BY dbo.Diagnosticos.CodigoCIE2004
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosCEparaFormatoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosEgresoSeleccionarPorAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosEgresoSeleccionarPorAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select
SubClasificacionDiagnosticos.IdClasificacionDx,
SubClasificacionDiagnosticos.IdSubClasificacionDx,
 Diagnosticos.CodigoCIE2004 as CodigoDx, Diagnosticos.descripcion as DescripcionDx
from  (SubClasificacionDiagnosticos
left join AtencionesDiagnosticos
on SubClasificacionDiagnosticos.IdSubClasificacionDx = AtencionesDiagnosticos.IdSubClasificacionDx
and SubClasificacionDiagnosticos.IdClasificacionDx = AtencionesDiagnosticos.IdClasificacionDx
and AtencionesDiagnosticos.IdAtencion = @IdAtencion)
left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
where SubClasificacionDiagnosticos.IdTipoServicio = 3
and SubClasificacionDiagnosticos.IdClasificacionDx in (3,4,5)
order by SubClasificacionDiagnosticos.IdSubClasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosEgresoSeleccionarPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosEliminar]
	@IdAtencionDiagnostico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesDiagnosticos
where IdAtencionDiagnostico = @IdAtencionDiagnostico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencionDiagnostico,'AtencionesDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosEliminarPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosEliminarPorIdAtencion]
	@lIdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesDiagnosticos where IdClasificacionDx = 6 and IdAtencion = @lIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosEliminarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosEliminarXIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosEliminarXIdAtencion]
	@lIdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesDiagnosticos where IdAtencion = @lIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosEliminarXIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosModificar]
	@IdSubclasificacionDx [int],
	@IdClasificacionDx [int],
	@IdDiagnostico [int],
	@IdAtencionDiagnostico [int],
	@IdAtencion [int],
	@grupoHIS [int],
	@subGrupoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesDiagnosticos
set
IdSubclasificacionDx = @IdSubclasificacionDx,
IdClasificacionDx = @IdClasificacionDx,
IdDiagnostico = @IdDiagnostico,
IdAtencion = @IdAtencion,
grupoHIS=@grupoHIS,
subGrupoHIS=@subGrupoHIS

where IdAtencionDiagnostico = @IdAtencionDiagnostico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtencionDiagnostico,'AtencionesDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosModificarTodosCampos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosModificarTodosCampos]
	@IdSubclasificacionDx [int],
	@IdClasificacionDx [int],
	@IdDiagnostico [int],
	@IdAtencionDiagnostico [int],
	@IdAtencion [int],
	@labConfHIS [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtencionesDiagnosticos SET
        IdSubclasificacionDx = @IdSubclasificacionDx,
        IdClasificacionDx = @IdClasificacionDx,
        IdDiagnostico = @IdDiagnostico,
        IdAtencion = @IdAtencion,
        labConfHIS = @labConfHIS
   WHERE IdAtencionDiagnostico = @IdAtencionDiagnostico;

    EXEC AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtencionDiagnostico,'AtencionesDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosModificarTodosCampos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosParaSip2000]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosParaSip2000]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      Diagnosticos.CodigoCIE2004
               FROM         AtencionesDiagnosticos LEFT OUTER JOIN
                                    Diagnosticos ON AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
               Where AtencionesDiagnosticos.idAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosParaSip2000] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarCEatendidosPorFechasSexoTipodx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarCEatendidosPorFechasSexoTipodx]
	@TipoSexo [int],
	@TipoDx [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
if @TipoSexo=0
	   begin
		SELECT      dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioIngreso AS IdServicioIngreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente,dbo.Atenciones.IdCuentaAtencion
		FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico LEFT OUTER JOIN
		                      dbo.Especialidades LEFT OUTER JOIN
		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad RIGHT OUTER JOIN
		                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                     and  (dbo.Atenciones.IdTipoServicio = 1)   AND (dbo.AtencionesDiagnosticos.IdSubclasificacionDx = 102)
			       and dbo.Atenciones.idEstadoAtencion<>0
		ORDER BY Ddiagnostico, dbo.AtencionesDiagnosticos.IdDiagnostico


	   end
	else
	   begin
		SELECT      dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioIngreso AS IdServicioIngreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente ,dbo.Atenciones.IdCuentaAtencion
		FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico LEFT OUTER JOIN
		                      dbo.Especialidades LEFT OUTER JOIN
		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad RIGHT OUTER JOIN
		                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                     and  (dbo.Atenciones.IdTipoServicio = 1)      AND (dbo.AtencionesDiagnosticos.IdSubclasificacionDx = 102)  and dbo.Pacientes.IdTipoSexo=@TipoSexo
			       and dbo.Atenciones.idEstadoAtencion<>0
	   end
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarCEatendidosPorFechasSexoTipodx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarComplicaciones]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarComplicaciones]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select
AtencionesDiagnosticos.IdDiagnostico,
Diagnosticos.CodigoCIE2004,
Diagnosticos.Descripcion,
AtencionesDiagnosticos.IdSubClasificacionDx as IdTipoDiagnostico,
convert(varchar(5), AtencionesDiagnosticos.IdSubClasificacionDx) + ' ' + SubClasificacionDiagnosticos.Descripcion as DescripcionTipoDx
from (AtencionesDiagnosticos left join SubClasificacionDiagnosticos
on AtencionesDiagnosticos.IdSubClasificacionDx = SubClasificacionDiagnosticos.IdSubClasificacionDx)
left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
where AtencionesDiagnosticos.IdClasificacionDx = 6 and AtencionesDiagnosticos.IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarComplicaciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarEmergenciaEgresadosPorFechasSexoTipodx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarEmergenciaEgresadosPorFechasSexoTipodx]
	@TipoSexo [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
if @TipoSexo=0
	   begin
		SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente,dbo.Atenciones.IdCuentaAtencion
		FROM         dbo.Especialidades INNER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
		                      dbo.AtencionesDiagnosticos INNER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
		                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                      and   (dbo.Atenciones.IdTipoServicio in (2,4))  and not (dbo.AtencionesDiagnosticos.IdSubclasificacionDx is null)
			        and dbo.Atenciones.idEstadoAtencion<>0
		order  by   Ddiagnostico,dbo.AtencionesDiagnosticos.idDiagnostico

	   end
	else
	   begin
		SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente ,dbo.Atenciones.IdCuentaAtencion
		FROM         dbo.Especialidades INNER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
		                      dbo.AtencionesDiagnosticos INNER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
		                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                     and  (dbo.Atenciones.IdTipoServicio in (2,4))      and dbo.Pacientes.IdTipoSexo=@TipoSexo and not (dbo.AtencionesDiagnosticos.IdSubclasificacionDx is null)
			      and dbo.Atenciones.idEstadoAtencion<>0
		order  by   Ddiagnostico,dbo.AtencionesDiagnosticos.idDiagnostico


	   end


GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarEmergenciaEgresadosPorFechasSexoTipodx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosEgresadosPorFechasSexoTipodx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosEgresadosPorFechasSexoTipodx]
	@TipoSexo [int],
	@TipoDx [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
if @TipoSexo=0
	   begin
		SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente, dbo.atenciones.IdCuentaAtencion
		FROM         dbo.Especialidades INNER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
		                      dbo.AtencionesDiagnosticos INNER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
		                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                      and   (dbo.Atenciones.IdTipoServicio = 3)  and (dbo.AtencionesDiagnosticos.IdSubclasificacionDx=@TipoDx)
			        and dbo.Atenciones.idEstadoAtencion<>0
		order  by   Ddiagnostico,dbo.AtencionesDiagnosticos.idDiagnostico

	   end
	else
	   begin
		SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
		                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
		                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
		                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
		                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
		                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
		                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
		                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio
			        ,dbo.atenciones.idFormaPago,dbo.atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente , dbo.atenciones.IdCuentaAtencion
		FROM         dbo.Especialidades INNER JOIN
		                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN

		                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
		                      dbo.AtencionesDiagnosticos INNER JOIN
		                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
		                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
		                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
		                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
	             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
		                     and  (dbo.Atenciones.IdTipoServicio = 3)  and (dbo.AtencionesDiagnosticos.IdSubclasificacionDx=@TipoDx)     and dbo.Pacientes.IdTipoSexo=@TipoSexo
			       and dbo.Atenciones.idEstadoAtencion<>0
	   end
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosEgresadosPorFechasSexoTipodx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosFallecidosPorFechasSexoTipodx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosFallecidosPorFechasSexoTipodx]
	@TipoSexo [int],
	@TipoDx [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
if @TipoSexo=0
   begin
	SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
	                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
	                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
	                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
	                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
	                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
	                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
	                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio,dbo.Atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente,dbo.Atenciones.IdCuentaAtencion
	FROM         dbo.Especialidades INNER JOIN
	                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
	                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
	                      dbo.AtencionesDiagnosticos INNER JOIN
	                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
	                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
	                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
            where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
	                      and   (dbo.Atenciones.IdTipoServicio = 3) AND (dbo.Atenciones.IdCondicionAlta = 4) and (dbo.AtencionesDiagnosticos.IdSubclasificacionDx=@TipoDx)
		       and dbo.Atenciones.idEstadoAtencion<>0
	order  by   Ddiagnostico,dbo.AtencionesDiagnosticos.idDiagnostico

   end
else
   begin
	SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS Ddiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
	                      dbo.Atenciones.Edad AS EdadNum, dbo.Atenciones.FechaIngreso AS FechaIngreso, dbo.Atenciones.HoraIngreso AS HoraIngreso,
	                      dbo.Atenciones.FechaEgreso AS FechaEgreso, dbo.Atenciones.HoraEgreso AS HoraEgreso, dbo.Atenciones.IdCondicionAlta AS IdCondicionAlta,
	                      dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
	                      dbo.Pacientes.FechaNacimiento AS FechaNacimiento, dbo.Pacientes.IdTipoSexo AS idTipoSexo,
	                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica, dbo.CentrosPoblados.IdDistrito AS idDistritoProcedencia, dbo.Servicios.Nombre AS Dservicio,
	                      dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
	                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio,dbo.Atenciones.idFuenteFinanciamiento,
	                      ltrim(dbo.Pacientes.ApellidoPaterno)+' '+LTRIM(dbo.Pacientes.apellidomaterno)+' '+dbo.Pacientes.PrimerNombre as Paciente ,dbo.Atenciones.IdCuentaAtencion
	FROM         dbo.Especialidades INNER JOIN
	                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
	                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
	                      dbo.AtencionesDiagnosticos INNER JOIN
	                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
	                      dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso LEFT OUTER JOIN
	                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado
             where             (dbo.Atenciones.FechaEgreso is not null) and (dbo.Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin)
	                     and  (dbo.Atenciones.IdTipoServicio = 3) AND (dbo.Atenciones.IdCondicionAlta = 4)  and (dbo.AtencionesDiagnosticos.IdSubclasificacionDx=@TipoDx)     and dbo.Pacientes.IdTipoSexo=@TipoSexo
		       and dbo.Atenciones.idEstadoAtencion<>0
	order  by   Ddiagnostico,dbo.AtencionesDiagnosticos.idDiagnostico

   end
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarHospitalizadosFallecidosPorFechasSexoTipodx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarPorAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarPorAtencion]
	@IdAtencion [int],
	@TipoDiagnostico [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.AtencionesDiagnosticos.IdDiagnostico, dbo.Diagnosticos.CodigoCIE2004,
                         dbo.Diagnosticos.Descripcion, dbo.Diagnosticos.ClaseDxHIS,
                         dbo.AtencionesDiagnosticos.labConfHIS,
                         dbo.AtencionesDiagnosticos.IdSubclasificacionDx AS IdTipoDiagnostico, CONVERT(varchar(5),
                         dbo.SubclasificacionDiagnosticos.Codigo)
                         + '  =  ' + dbo.SubclasificacionDiagnosticos.Descripcion AS DescripcionTipoDx,
                         dbo.AtencionesDiagnosticos.GrupoHIS, dbo.AtencionesDiagnosticos.SubGrupoHIS,
                         dbo.AtencionesDiagnosticos.IdAtencion, dbo.AtencionesDiagnosticos.IdClasificacionDx
FROM            dbo.AtencionesDiagnosticos INNER JOIN
                         dbo.Diagnosticos ON
                         dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico LEFT OUTER JOIN
                         dbo.SubclasificacionDiagnosticos ON
                         dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx
where AtencionesDiagnosticos.IdAtencion = @IdAtencion
and AtencionesDiagnosticos.IdClasificacionDx = @TipoDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarPorAtencionSinInterconsulta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarPorAtencionSinInterconsulta]
	@IdAtencion [int],
	@TipoDiagnostico [int]
WITH EXECUTE AS CALLER
AS
select
AtencionesDiagnosticos.IdDiagnostico,
Diagnosticos.CodigoCIE2004,
Diagnosticos.Descripcion,
AtencionesDiagnosticos.IdSubClasificacionDx as IdTipoDiagnostico,
convert(varchar(5), SubClasificacionDiagnosticos.Codigo) + '  =  ' + SubClasificacionDiagnosticos.Descripcion as DescripcionTipoDx
from (AtencionesDiagnosticos left join SubClasificacionDiagnosticos
on AtencionesDiagnosticos.IdSubClasificacionDx = SubClasificacionDiagnosticos.IdSubClasificacionDx)
left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
where AtencionesDiagnosticos.IdAtencion = @IdAtencion
and AtencionesDiagnosticos.IdClasificacionDx = @TipoDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarPorAtencionSinInterconsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarPorId]
	@IdAtencionDiagnostico [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesDiagnosticos
where IdAtencionDiagnostico = @IdAtencionDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarPorIdAtencionIdDx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarPorIdAtencionIdDx]
	@IdAtencion [int],
	@IdDiagnostico [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesDiagnosticos
where IdAtencion = @IdAtencion and IdDiagnostico=@IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarPorIdAtencionIdDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarPorNroCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarPorNroCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.AtencionesDiagnosticos.IdAtencion,
                     dbo.AtencionesDiagnosticos.IdAtencionDiagnostico,dbo.AtencionesDiagnosticos.IdDiagnostico
FROM         dbo.Atenciones RIGHT OUTER JOIN
                      dbo.AtencionesDiagnosticos ON dbo.Atenciones.IdAtencion = dbo.AtencionesDiagnosticos.IdAtencion LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
WHERE dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion
order by dbo.AtencionesDiagnosticos.IdAtencionDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarPorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarTodosPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarTodosPorIdAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
select
             AtencionesDiagnosticos.IdDiagnostico,
             Diagnosticos.CodigoCIE2004,
             Diagnosticos.Descripcion,
             Diagnosticos.ClaseDxHIS,
             AtencionesDiagnosticos.labConfHIS,AtencionesDiagnosticos.idAtencionDiagnostico,
             AtencionesDiagnosticos.IdSubClasificacionDx as IdTipoDiagnostico,
             convert(varchar(5), SubClasificacionDiagnosticos.Codigo) + '  =  ' + SubClasificacionDiagnosticos.Descripcion as DescripcionTipoDx
             from (AtencionesDiagnosticos left join SubClasificacionDiagnosticos
             on AtencionesDiagnosticos.IdSubClasificacionDx = SubClasificacionDiagnosticos.IdSubClasificacionDx)
             left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
             where AtencionesDiagnosticos.IdAtencion = @lnIdAtencion
             order by AtencionesDiagnosticos.idAtencionDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarTodosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionarXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionarXidAtencion]
	@ml_idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion,
                     dbo.Diagnosticos.codigoCIEsinPto
             FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
             where idAtencion=@ml_idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosSeleccionPorIdAtencionDiagnosticoLab]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosSeleccionPorIdAtencionDiagnosticoLab]
	@IdDiagnostico [int],
	@IdAtencion [int],
	@labConfHIS [varchar](3)
WITH EXECUTE AS CALLER
AS
DECLARE @VarLabConfHIS VARCHAR(3);

    IF @labConfHIS IS NULL
    BEGIN
        SET @VarLabConfHIS = '';
    END
    ELSE
    BEGIN
        SET @VarLabConfHIS = RTRIM(LTRIM(@labConfHIS));
    END;

    IF @VarLabConfHIS = ''
    BEGIN
        SELECT IdAtencionDiagnostico, IdSubclasificacionDx, IdClasificacionDx,
            IdDiagnostico, IdAtencion, labConfHIS
        FROM AtencionesDiagnosticos
        WHERE IdDiagnostico = @IdDiagnostico AND IdAtencion = @IdAtencion
            AND (RTRIM(LTRIM(labConfHIS)) = @VarLabConfHIS OR labConfHIS IS NULL);
    END
    ELSE
    BEGIN
        SELECT IdAtencionDiagnostico, IdSubclasificacionDx, IdClasificacionDx,
            IdDiagnostico, IdAtencion, labConfHIS
        FROM AtencionesDiagnosticos
        WHERE IdDiagnostico = @IdDiagnostico AND IdAtencion = @IdAtencion
            AND ISNULL(labConfHIS, '0') = ISNULL(@labConfHIS, '0');
    END;
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosSeleccionPorIdAtencionDiagnosticoLab] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosXidAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
select
               AtencionesDiagnosticos.IdDiagnostico,
               Diagnosticos.CodigoCIE2004,
               Diagnosticos.Descripcion,
               Diagnosticos.ClaseDxHIS,
               AtencionesDiagnosticos.labConfHIS,
               AtencionesDiagnosticos.IdSubClasificacionDx as IdTipoDiagnostico,
               convert(varchar(5), SubClasificacionDiagnosticos.Codigo) + '  =  ' + SubClasificacionDiagnosticos.Descripcion as DescripcionTipoDx
             from (AtencionesDiagnosticos left join SubClasificacionDiagnosticos
               on AtencionesDiagnosticos.IdSubClasificacionDx = SubClasificacionDiagnosticos.IdSubClasificacionDx)
               left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
             where AtencionesDiagnosticos.IdAtencion = @lnIdAtencion
               and AtencionesDiagnosticos.IdClasificacionDx = 1
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesDiagnosticosXidCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesDiagnosticosXidCuentaAtencion]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.AtencionesDiagnosticos.IdAtencion,
                                       dbo.AtencionesDiagnosticos.IdAtencionDiagnostico,dbo.AtencionesDiagnosticos.IdDiagnostico
                  FROM         dbo.Atenciones RIGHT OUTER JOIN
                                        dbo.AtencionesDiagnosticos ON dbo.Atenciones.IdAtencion = dbo.AtencionesDiagnosticos.IdAtencion LEFT OUTER JOIN
                                        dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
                  WHERE dbo.Atenciones.IdCuentaAtencion=@lnIdCuentaAtencion
                  order by dbo.AtencionesDiagnosticos.IdAtencionDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesDiagnosticosXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEliminar]
	@IdAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Atenciones
where IdAtencion = @IdAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencion,'Atenciones'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaAgregar]
	@IdTipoAgenteAGAN [int],
	@IdGrupoOcupacionalALAB [int],
	@IdPosicionLesionadoALAB [int],
	@IdUbicacionLesionado [int],
	@IdTipoTransporte [int],
	@IdTipoVehiculo [int],
	@IdClaseAccidente [int],
	@IdRelacionAgresorVictima [int],
	@IdSeguridad [int],
	@IdTipoEvento [int],
	@IdLugarEvento [int],
	@IdCausaExternaMorbilidad [int],
	@IdAtencion [int],
	@IdAtencionEmergencia [int] OUTPUT,
	@comoLlego [int],
	@tipoAtencion [int],
	@idEstadoLlegada [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesEmergencia (
IdTipoAgenteAGAN,IdGrupoOcupacionalALAB,IdPosicionLesionadoALAB,IdUbicacionLesionado,IdTipoTransporte,
IdTipoVehiculo,IdClaseAccidente,IdRelacionAgresorVictima,IdSeguridad,IdTipoEvento,IdLugarEvento,
IdCausaExternaMorbilidad,IdAtencion,comoLlego,tipoAtencion,idEstadoLlegada ) values (
@IdTipoAgenteAGAN,@IdGrupoOcupacionalALAB,@IdPosicionLesionadoALAB,@IdUbicacionLesionado,@IdTipoTransporte,
@IdTipoVehiculo,@IdClaseAccidente,@IdRelacionAgresorVictima,@IdSeguridad,@IdTipoEvento,@IdLugarEvento,
@IdCausaExternaMorbilidad,@IdAtencion,@comoLlego,@tipoAtencion,@idEstadoLlegada )
set @IdAtencionEmergencia = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaEliminar]
	@IdAtencionEmergencia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEmergencia
where IdAtencionEmergencia = @IdAtencionEmergencia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencionEmergencia,'AtencionesEmergencia'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaEliminarXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaEliminarXidAtencion]
	@lIdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEmergencia where IdAtencion = @lIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaModificar]
	@IdTipoAgenteAGAN [int],
	@IdGrupoOcupacionalALAB [int],
	@IdPosicionLesionadoALAB [int],
	@IdUbicacionLesionado [int],
	@IdTipoTransporte [int],
	@IdTipoVehiculo [int],
	@IdClaseAccidente [int],
	@IdRelacionAgresorVictima [int],
	@IdSeguridad [int],
	@IdTipoEvento [int],
	@IdLugarEvento [int],
	@IdCausaExternaMorbilidad [int],
	@IdAtencion [int],
	@IdAtencionEmergencia [int],
	@comoLlego [int],
	@tipoAtencion [int],
	@idEstadoLlegada [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesEmergencia
set
IdTipoAgenteAGAN = @IdTipoAgenteAGAN,
IdGrupoOcupacionalALAB = @IdGrupoOcupacionalALAB,
IdPosicionLesionadoALAB = @IdPosicionLesionadoALAB,
IdUbicacionLesionado = @IdUbicacionLesionado,
IdTipoTransporte = @IdTipoTransporte,
IdTipoVehiculo = @IdTipoVehiculo,
IdClaseAccidente = @IdClaseAccidente,
IdRelacionAgresorVictima = @IdRelacionAgresorVictima,
IdSeguridad = @IdSeguridad,
IdTipoEvento = @IdTipoEvento,
IdLugarEvento = @IdLugarEvento,
IdCausaExternaMorbilidad = @IdCausaExternaMorbilidad,
IdAtencion = @IdAtencion,
comoLlego=@comoLlego,
tipoAtencion=@tipoAtencion,
idEstadoLlegada=@idEstadoLlegada
where IdAtencionEmergencia = @IdAtencionEmergencia
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaSegunFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaSegunFiltro]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select Atenciones.IdPaciente ,Atenciones.IdAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica,  TiposNumeracionHistoria.Descripcion as TipoNumeracion, " + _
        "convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso," + _
        "convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso" + _
        ", Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad, Pacientes.IdTipoNumeracion, Atenciones.IdServicioIngreso " + _
        " From ((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio) " + _
        "left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente) " + _
        "left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaSeleccionarIdPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaSeleccionarIdPorIdAtencion]
	@IdAtencion [int],
	@IdAtencionEmergencia [int] OUTPUT
WITH EXECUTE AS CALLER
AS
select @IdAtencionEmergencia = IdAtencionEmergencia from AtencionesEmergencia
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaSeleccionarIdPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaSeleccionarPorId]
	@IdAtencionEmergencia [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesEmergencia
where IdAtencionEmergencia = @IdAtencionEmergencia
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEmergenciaXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEmergenciaXidAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.AtencionesEmergencia.IdAtencion, dbo.AtencionesEmergencia.IdCausaExternaMorbilidad,
                         dbo.EmergenciaCausaExternaMorbilidad.MotivoSEM, dbo.AtencionesEmergencia.comoLlego,
                         dbo.AtencionesEmergencia.idEstadoLlegada
FROM            dbo.AtencionesEmergencia INNER JOIN
                         dbo.EmergenciaCausaExternaMorbilidad ON
                         dbo.AtencionesEmergencia.IdCausaExternaMorbilidad = dbo.EmergenciaCausaExternaMorbilidad.IdCausaExternaMorbilidad
 where dbo.AtencionesEmergencia.IdAtencion=@lnIdAtencion

GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEmergenciaXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosCabeceraAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosCabeceraAgregar]
	@idPaciente [int],
	@idEpisodio [int],
	@FechaApertura [datetime],
	@FechaCierre [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesEpisodiosCabecera (
idPaciente,idEpisodio,FechaApertura,FechaCierre) values (
@idPaciente,@idEpisodio,@FechaApertura,@FechaCierre)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPaciente,'AtencionesEpisodiosCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosCabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosCabeceraEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosCabeceraEliminar]
	@idPaciente [int],
	@idEpisodio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEpisodiosCabecera
where idPaciente = @idPaciente and idEpisodio=@idEpisodio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPaciente,'AtencionesEpisodiosCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosCabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosCabeceraModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosCabeceraModificar]
	@idPaciente [int],
	@idEpisodio [int],
	@FechaApertura [datetime],
	@FechaCierre [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesEpisodiosCabecera
set
idEpisodio = @idEpisodio,
FechaApertura = @FechaApertura,
FechaCierre = @FechaCierre
where idPaciente = @idPaciente and idEpisodio=@idEpisodio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPaciente,'AtencionesEpisodiosCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosCabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosCabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosCabeceraSeleccionarPorId]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesEpisodiosCabecera
where idPaciente = @idPaciente order by idEpisodio
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosCabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleAgregar]
	@idPaciente [int],
	@idEpisodio [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesEpisodiosDetalle (
idPaciente,idEpisodio,idAtencion) values (
@idPaciente,@idEpisodio,@idAtencion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPaciente,'AtencionesEpisodiosDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleEliminaNull]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleEliminaNull]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEpisodiosDetalle where not idatencion in
            (select dbo.atenciones.idatencion from dbo.atenciones where dbo.atenciones.idatencion=dbo.AtencionesEpisodiosDetalle.idatencion)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleEliminaNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleEliminar]
	@idPaciente [int],
	@idEpisodio [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEpisodiosDetalle
where idPaciente = @idPaciente and idEpisodio=@idEpisodio and idAtencion=@idAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPaciente,'AtencionesEpisodiosDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleModificar]
	@idPaciente [int],
	@idEpisodio [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesEpisodiosDetalle
set
idEpisodio = @idEpisodio,
idAtencion = @idAtencion
where idPaciente = @idPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPaciente,'AtencionesEpisodiosDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleSeleccionarPorId]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesEpisodiosDetalle
where idPaciente = @idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEpisodiosDetalleSeleccionarXpaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEpisodiosDetalleSeleccionarXpaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesEpisodiosDetalle.idEpisodio, dbo.AtencionesEpisodiosCabecera.FechaApertura, dbo.AtencionesEpisodiosCabecera.FechaCierre,
                      dbo.TiposServicio.Descripcion AS TipoServicio, dbo.Servicios.Nombre AS Servicio, dbo.Atenciones.FechaIngreso, dbo.Atenciones.IdCuentaAtencion,
                      dbo.AtencionesEpisodiosCabecera.idPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdTipoServicio, Servicios_1.Nombre AS ServIng
FROM         dbo.Servicios Servicios_1 RIGHT OUTER JOIN
                      dbo.Atenciones ON Servicios_1.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio RIGHT OUTER JOIN
                      dbo.AtencionesEpisodiosDetalle INNER JOIN
                      dbo.AtencionesEpisodiosCabecera ON dbo.AtencionesEpisodiosDetalle.idPaciente = dbo.AtencionesEpisodiosCabecera.idPaciente AND
                      dbo.AtencionesEpisodiosDetalle.idEpisodio = dbo.AtencionesEpisodiosCabecera.idEpisodio ON
                      dbo.Atenciones.IdAtencion = dbo.AtencionesEpisodiosDetalle.idAtencion
WHERE     (dbo.AtencionesEpisodiosCabecera.idPaciente = @idPaciente)
ORDER BY dbo.AtencionesEpisodiosDetalle.idEpisodio desc, dbo.Atenciones.FechaIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEpisodiosDetalleSeleccionarXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaActualServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaActualServicio]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT top 1   dbo.Servicios.Nombre as servicio, '  Cama: ' + isnull(dbo.Camas.Codigo,'')  AS ServicioCama
              FROM  dbo.AtencionesEstanciaHospitalaria LEFT OUTER JOIN
                      dbo.Camas ON dbo.AtencionesEstanciaHospitalaria.IdCama = dbo.Camas.IdCama LEFT OUTER JOIN
                      dbo.Servicios ON dbo.AtencionesEstanciaHospitalaria.IdServicio = dbo.Servicios.IdServicio
              where dbo.AtencionesEstanciaHospitalaria.IdAtencion =@idAtencion
               ORDER BY dbo.AtencionesEstanciaHospitalaria.Secuencia DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaActualServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaAgregar]
	@DiasEstancia [decimal](18, 0),
	@IdAtencion [int],
	@IdFacturacionServicio [int],
	@IdMedicoOrdena [int],
	@IdCama [int],
	@IdServicio [int],
	@HoraDesocupacion [char](5),
	@FechaDesocupacion [datetime],
	@HoraOcupacion [char](5),
	@FechaOcupacion [datetime],
	@Secuencia [int],
	@IdEstanciaHospitalaria [int] OUTPUT,
	@LlegoAlServicio [int],
	@idProducto [int],
	@IdMedicoOrdenaOrigen [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesEstanciaHospitalaria (
DiasEstancia,IdAtencion,IdFacturacionServicio,IdMedicoOrdena,IdCama,IdServicio,HoraDesocupacion,FechaDesocupacion,HoraOcupacion,FechaOcupacion,Secuencia,LlegoAlServicio,idProducto,IdMedicoOrdenaOrigen) values (
@DiasEstancia,@IdAtencion,@IdFacturacionServicio,@IdMedicoOrdena,@IdCama,@IdServicio,@HoraDesocupacion,@FechaDesocupacion,@HoraOcupacion,@FechaOcupacion,@Secuencia,@LlegoAlServicio,@idProducto,@IdMedicoOrdenaOrigen)
set @IdEstanciaHospitalaria = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstanciaHospitalaria,'AtencionesEstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaEliminar]
	@IdEstanciaHospitalaria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEstanciaHospitalaria
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstanciaHospitalaria,'AtencionesEstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaEliminaXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaEliminaXidAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesEstanciaHospitalaria where IdAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaEliminaXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaListaMedicos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaListaMedicos]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesEstanciaHospitalaria.IdAtencion, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
            dbo.AtencionesEstanciaHospitalaria.Secuencia
FROM         dbo.Empleados RIGHT OUTER JOIN
                      dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado RIGHT OUTER JOIN
                      dbo.AtencionesEstanciaHospitalaria ON dbo.Medicos.IdMedico = dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena
where not (dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena IS NULL) and   dbo.AtencionesEstanciaHospitalaria.IdAtencion=@idAtencion
order by dbo.AtencionesEstanciaHospitalaria.Secuencia
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaListaMedicos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaModificar]
	@DiasEstancia [decimal](18, 0),
	@IdAtencion [int],
	@IdFacturacionServicio [int],
	@IdMedicoOrdena [int],
	@IdCama [int],
	@IdServicio [int],
	@HoraDesocupacion [char](5),
	@FechaDesocupacion [datetime],
	@HoraOcupacion [char](5),
	@FechaOcupacion [datetime],
	@Secuencia [int],
	@IdEstanciaHospitalaria [int],
	@LlegoAlServicio [int],
	@idProducto [int],
	@IdMedicoOrdenaOrigen [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesEstanciaHospitalaria
set
DiasEstancia = @DiasEstancia,
IdAtencion = @IdAtencion,
IdFacturacionServicio = @IdFacturacionServicio,
IdMedicoOrdena = @IdMedicoOrdena,
IdCama = @IdCama,
IdServicio = @IdServicio,
HoraDesocupacion = @HoraDesocupacion,
FechaDesocupacion = @FechaDesocupacion,
HoraOcupacion = @HoraOcupacion,
FechaOcupacion = @FechaOcupacion,
Secuencia = @Secuencia,
LlegoAlServicio=@LlegoAlServicio,
idProducto=@idProducto,
IdMedicoOrdenaOrigen=@IdMedicoOrdenaOrigen
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstanciaHospitalaria,'AtencionesEstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaPorIdCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaPorIdCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/* SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.AtencionesEstanciaHospitalaria.FechaOcupacion, dbo.AtencionesEstanciaHospitalaria.HoraOcupacion,
                      dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion, dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion,
                      dbo.AtencionesEstanciaHospitalaria.IdServicio
FROM         dbo.Atenciones RIGHT OUTER JOIN
                      dbo.AtencionesEstanciaHospitalaria ON dbo.Atenciones.IdAtencion = dbo.AtencionesEstanciaHospitalaria.IdAtencion
WHERE  dbo.Atenciones.idCuentaAtencion=@idCuentaAtencion
ORDER by dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,dbo.AtencionesEstanciaHospitalaria.HoraOcupacion   */

SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.AtencionesEstanciaHospitalaria.FechaOcupacion, dbo.AtencionesEstanciaHospitalaria.HoraOcupacion,
                      dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion, dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion,
                      dbo.AtencionesEstanciaHospitalaria.IdServicio
FROM         dbo.Atenciones INNER JOIN
                      dbo.AtencionesEstanciaHospitalaria ON dbo.Atenciones.IdAtencion = dbo.AtencionesEstanciaHospitalaria.IdAtencion
WHERE  dbo.Atenciones.idCuentaAtencion=@idCuentaAtencion
ORDER by dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,dbo.AtencionesEstanciaHospitalaria.HoraOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaSeleccionarHospitalizados]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaSeleccionarHospitalizados]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.AtencionesEstanciaHospitalaria.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServicio,
                      dbo.Especialidades.Nombre AS dEspecialidad, dbo.DepartamentosHospital.Nombre AS dDpto,
                      dbo.DepartamentosHospital.IdDepartamento AS CodDpto, dbo.Servicios.IdEspecialidad AS CodEspecialidad,
                      dbo.Servicios.IdTipoServicio AS Expr1
FROM         dbo.Servicios LEFT OUTER JOIN
                      dbo.DepartamentosHospital RIGHT OUTER JOIN
                      dbo.Especialidades ON dbo.DepartamentosHospital.IdDepartamento = dbo.Especialidades.IdDepartamento ON
                      dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad RIGHT OUTER JOIN
                      dbo.AtencionesEstanciaHospitalaria ON dbo.Servicios.IdServicio = dbo.AtencionesEstanciaHospitalaria.IdServicio
Where (dbo.Servicios.IdTipoServicio = 3)
ORDER BY dbo.AtencionesEstanciaHospitalaria.IdAtencion,dbo.AtencionesEstanciaHospitalaria.secuencia
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaSeleccionarHospitalizados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorId]
	@IdEstanciaHospitalaria [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesEstanciaHospitalaria
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesEstanciaHospitalaria
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion, dbo.AtencionesEstanciaHospitalaria.DiasEstancia, dbo.Atenciones.IdServicioEgreso,
                      dbo.AtencionesEstanciaHospitalaria.IdServicio, dbo.AtencionesEstanciaHospitalaria.idProducto, dbo.Servicios.Nombre,
                      dbo.Atenciones.IdFormaPago AS IdTipoFinanciamiento, dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,
                      dbo.AtencionesEstanciaHospitalaria.HoraOcupacion, dbo.Atenciones.idFuenteFinanciamiento,
                      dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion, dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion,
                      dbo.AtencionesEstanciaHospitalaria.LlegoAlServicio, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.FechaEgreso,
                      dbo.Atenciones.HoraEgreso, dbo.AtencionesEstanciaHospitalaria.IdCama, dbo.Pacientes.NroDocumento
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente RIGHT OUTER JOIN
                      dbo.Servicios RIGHT OUTER JOIN
                      dbo.AtencionesEstanciaHospitalaria ON dbo.Servicios.IdServicio = dbo.AtencionesEstanciaHospitalaria.IdServicio ON
                      dbo.Atenciones.IdAtencion = dbo.AtencionesEstanciaHospitalaria.IdAtencion
WHERE dbo.Atenciones.IdCuentaAtencion= @IdCuentaAtencion
ORDER BY dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,dbo.AtencionesEstanciaHospitalaria.HoraOcupacion
*/
SELECT        dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
                         dbo.AtencionesEstanciaHospitalaria.DiasEstancia, dbo.Atenciones.IdServicioEgreso,
                         dbo.AtencionesEstanciaHospitalaria.IdServicio, dbo.AtencionesEstanciaHospitalaria.idProducto,
                          dbo.Servicios.Nombre, dbo.Atenciones.IdFormaPago AS IdTipoFinanciamiento,
                         dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraOcupacion, dbo.Atenciones.idFuenteFinanciamiento,
                         dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion,
                         dbo.AtencionesEstanciaHospitalaria.LlegoAlServicio, dbo.Atenciones.FechaIngreso,
                         dbo.Atenciones.HoraIngreso, dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso,
                         dbo.AtencionesEstanciaHospitalaria.IdCama, dbo.Pacientes.NroDocumento
FROM            dbo.Servicios INNER JOIN
                         dbo.AtencionesEstanciaHospitalaria ON
                         dbo.Servicios.IdServicio = dbo.AtencionesEstanciaHospitalaria.IdServicio INNER JOIN
                         dbo.Atenciones ON
                         dbo.AtencionesEstanciaHospitalaria.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
                         dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE dbo.Atenciones.IdCuentaAtencion= @IdCuentaAtencion
ORDER BY dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,dbo.AtencionesEstanciaHospitalaria.HoraOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaSeleccionarPorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaSeleccionarTodosPorCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaSeleccionarTodosPorCuentaAtencion]
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select EstanciaHospitalaria.IdServicio,
             EstanciaHospitalaria.FechaOcupacion,
             EstanciaHospitalaria.HoraOcupacion,
             EstanciaHospitalaria.IdCama,
             Camas.Codigo as CodigoCama,
             Servicios.Codigo as CodigoServicio,
             Servicios.Nombre as NombreServicio,
             EstanciaHospitalaria.IdMedicoOrdena as IdMedicoOrdena,
             Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres as NombreMedico,
             FactCatalogoServicios.PrecioUnitario
             ,EstanciaHospitalaria.FechaOcupacion + '' + EstanciaHospitalaria.HoraOcupacion FhOcupacion
             ,EstanciaHospitalaria.FechaDesOcupacion + '' + EstanciaHospitalaria.HoraDesOcupacion FhDesOcupacion
             from (((EstanciaHospitalaria left join Servicios on EstanciaHospitalaria.IdServicio = Servicios.IdServicio)
             left join Medicos on EstanciaHospitalaria.IdMedicoOrdena = Medicos.IdMedico)
             left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
             left join Camas on EstanciaHospitalaria.IdCama = Camas.IdCama
             left join FactCatalogoServicios on Servicios.IdProducto = FactCatalogoServicios.IdProducto
             Where EstanciaHospitalaria.IdCuentaAtencion = @lIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaSeleccionarTodosPorCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesEstanciaHospitalariaXidAtencionIdServicioIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesEstanciaHospitalariaXidAtencionIdServicioIngreso]
	@lnIdServicioIngreso [int],
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
if @lnIdServicioIngreso=0
    SELECT        dbo.Servicios.EsObservacionEmergencia, Medicos_1.Colegiatura,
                         dbo.Servicios.codigoServicioSEM, dbo.AtencionesEstanciaHospitalaria.IdServicio,
                         dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion, dbo.Atenciones.IdAtencion,
                         dbo.Camas.Codigo AS Cama, dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraOcupacion,
				( SELECT     dbo.Medicos.Colegiatura FROM dbo.Medicos
                where dbo.Medicos.IdMedico =dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena
               ) as lcColegiaturaMedico
    FROM            dbo.Atenciones INNER JOIN
                         dbo.AtencionesEstanciaHospitalaria ON
                         dbo.Atenciones.IdAtencion = dbo.AtencionesEstanciaHospitalaria.IdAtencion LEFT OUTER JOIN
                         dbo.Servicios ON
                         dbo.AtencionesEstanciaHospitalaria.IdServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN
                         dbo.Medicos AS Medicos_1 ON
                         dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena = Medicos_1.IdMedico LEFT OUTER JOIN
                         dbo.Camas ON dbo.AtencionesEstanciaHospitalaria.IdCama = dbo.Camas.IdCama
              WHERE  dbo.Atenciones.IdAtencion=@lnIdAtencion
else
   SELECT        dbo.Servicios.EsObservacionEmergencia, dbo.Medicos.Colegiatura,
                         dbo.Servicios.codigoServicioSEM, dbo.AtencionesEstanciaHospitalaria.IdServicio,
                         dbo.AtencionesEstanciaHospitalaria.FechaDesocupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraDesocupacion, dbo.Atenciones.IdAtencion,
                         dbo.Camas.Codigo AS Cama, dbo.AtencionesEstanciaHospitalaria.FechaOcupacion,
                         dbo.AtencionesEstanciaHospitalaria.HoraOcupacion,
              ( SELECT     dbo.Medicos.Colegiatura FROM dbo.Medicos
                where dbo.Medicos.IdMedico =dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena
               ) as lcColegiaturaMedico
    FROM            dbo.Atenciones INNER JOIN
                         dbo.AtencionesEstanciaHospitalaria ON
                         dbo.Atenciones.IdAtencion = dbo.AtencionesEstanciaHospitalaria.IdAtencion LEFT OUTER JOIN
                         dbo.Servicios ON
                         dbo.AtencionesEstanciaHospitalaria.IdServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN
                         dbo.Medicos ON
                         dbo.AtencionesEstanciaHospitalaria.IdMedicoOrdena = dbo.Medicos.IdMedico LEFT OUTER JOIN
                         dbo.Camas ON dbo.AtencionesEstanciaHospitalaria.IdCama = dbo.Camas.IdCama
              WHERE dbo.AtencionesEstanciaHospitalaria.IdServicio=@lnIdServicioIngreso
                    and dbo.Atenciones.IdAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesEstanciaHospitalariaXidAtencionIdServicioIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFacturacionCuentasAtencionidFuenteFinanciamientoNull]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFacturacionCuentasAtencionidFuenteFinanciamientoNull]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dTarifario,
                     dbo.FuentesFinanciamiento.Descripcion AS dPlan, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.FechaIngreso,
                     dbo.EstadosCuenta.Descripcion AS EstadoCuenta, dbo.EstadosAtencion.Descripcion AS EstadoAtencion,
                     dbo.EstadosCuenta.IdEstado, dbo.EstadosAtencion.IdEstadoAtencion
FROM         dbo.Atenciones INNER JOIN
                     dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion INNER JOIN
                     dbo.EstadosAtencion ON dbo.Atenciones.idEstadoAtencion = dbo.EstadosAtencion.IdEstadoAtencion LEFT OUTER JOIN
                     dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                     dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                     dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
where (dbo.Atenciones.IdFormaPago is null) or (dbo.Atenciones.idFuenteFinanciamiento is null)
ORDER BY dbo.atenciones.idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFacturacionCuentasAtencionidFuenteFinanciamientoNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltra]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltra]
	@lcFiltro [varchar](2000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3000)

   SET  @SQL =  'SELECT DISTINCT
                   dbo.FacturacionCuentasAtencion.IdCuentaAtencion, dbo.EstadosCuenta.Descripcion AS EstadoCuenta, dbo.Atenciones.IdPaciente,
                   dbo.Atenciones.IdAtencion, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso,
                   dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                   dbo.Pacientes.SegundoNombre, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
                   dbo.FacturacionCuentasAtencion.IdEstado, dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion,
                   dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdServicioIngreso
                 FROM         dbo.Atenciones LEFT OUTER JOIN
                                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                      dbo.EstadosCuenta ON dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado LEFT OUTER JOIN
                                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio      '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltra] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraDatosCabecera]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraDatosCabecera]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdPaciente, dbo.TiposFinanciamiento.tipoVenta, dbo.Atenciones.FechaEgreso, dbo.FacturacionCuentasAtencion.IdEstado,
                      dbo.EstadosCuenta.Descripcion AS estadoCta, dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.IdServicioIngreso,
                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdAtencion,
                      dbo.Atenciones.IdCamaEgreso, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno,
                      dbo.TiposFinanciamiento.Descripcion AS dTipoFinanciamiento, dbo.Atenciones.IdCondicionAlta, dbo.Pacientes.IdTipoSexo,
                      dbo.AtencionesDatosAdicionales.IdTipoReferenciaOrigen, dbo.AtencionesDatosAdicionales.NroReferenciaDestino, dbo.Pacientes.SegundoNombre,
                      dbo.Atenciones.IdOrigenAtencion,dbo.Atenciones.HoraEgreso ,dbo.Pacientes.NroDocumento,dbo.Pacientes.FechaNacimiento,
                      dbo.Atenciones.HoraIngreso
FROM         dbo.Atenciones INNER JOIN
                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     dbo.Atenciones.IdCuentaAtencion =@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraDatosCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraDatosParaFormatoSIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraDatosParaFormatoSIS]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                                  dbo.Pacientes.FechaNacimiento, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.FechaIngreso, dbo.Medicos.IdMedico,
                                  dbo.Empleados.ApellidoPaterno AS MedicoPaterno, dbo.Empleados.ApellidoMaterno AS MedicoMaterno, dbo.Empleados.Nombres AS MedicoNombres,
                                  dbo.Empleados.DNI AS MedicoDni, dbo.Medicos.Colegiatura AS MedicoColegiatura,
                                  dbo.AtencionesDatosAdicionales.IdEstablecimientoNoMinsaOrigen , dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen,dbo.AtencionesDatosAdicionales.IdTipoReferenciaOrigen
             FROM         dbo.Empleados LEFT OUTER JOIN
                                  dbo.Medicos RIGHT OUTER JOIN
                                  dbo.Atenciones INNER JOIN
                                  dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion ON
                                  dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             where dbo.Atenciones.idAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraDatosParaFormatoSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraDiagnosticosPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraDiagnosticosPorIdAtencion]
	@idAtencion [int],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
If @idTipoServicio=3       --hospitalizacion
            SELECT dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS dDiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
                           dbo.SubclasificacionDiagnosticos.Descripcion AS dTipo
            FROM dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                          dbo.SubclasificacionDiagnosticos ON
                           dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx LEFT OUTER JOIN
                          dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
             Where dbo.AtencionesDiagnosticos.idAtencion=@idAtencion  and dbo.AtencionesDiagnosticos.IdClasificacionDx = 3
    Else
            SELECT dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion AS dDiagnostico, dbo.Diagnosticos.CodigoCIE10 AS Cie10,
                          dbo.SubclasificacionDiagnosticos.Descripcion AS dTipo
             FROM dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                           dbo.SubclasificacionDiagnosticos ON
                          dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx LEFT OUTER JOIN
                          dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
             Where dbo.AtencionesDiagnosticos.idAtencion=@idAtencion  and dbo.AtencionesDiagnosticos.IdClasificacionDx = 2
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraDiagnosticosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraEgresosPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraEgresosPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.AtencionesDatosAdicionales.DireccionDomicilio, dbo.AtencionesDatosAdicionales.NombreAcompaniante,
                      dbo.AtencionesDatosAdicionales.Observacion, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS CodServicio,
                      dbo.Camas.Codigo AS CodCama
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Camas ON dbo.Atenciones.IdCamaEgreso = dbo.Camas.IdCama LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio FULL OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
 Where dbo.Atenciones.idAtencion= @idAtencion and dbo.Atenciones.idEstadoAtencion<>0
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraEgresosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraIngresosPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraIngresosPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.AtencionesDatosAdicionales.DireccionDomicilio, dbo.AtencionesDatosAdicionales.NombreAcompaniante,
                      dbo.AtencionesDatosAdicionales.Observacion, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS CodServicio,
                      dbo.Camas.Codigo AS CodCama
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Camas ON dbo.Atenciones.IdCamaIngreso = dbo.Camas.IdCama LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio FULL OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
 Where dbo.Atenciones.idAtencion=@idAtencion and dbo.Atenciones.idEstadoAtencion<>0
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraIngresosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltrarConsultaExterna]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltrarConsultaExterna]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select FacturacionCuentasAtencion.IdCuentaAtencion, Atenciones.IdPaciente ,Atenciones.IdAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica, Pacientes.FechaNacimiento as FecNacim,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso
        , Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad,
        Citas.IdCita, Pacientes.IdTipoNumeracion, Atenciones.IdServicioIngreso, atenciones.idMedicoIngreso, atenciones.horaEgreso,TiposNumeracionHistoria.Descripcion as TipoNumeracion,atenciones.idCuentaAtencion as NroCuenta
         From ((((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
        left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
        left join Citas on Citas.IdAtencion = Atenciones.IdAtencion)
        left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
        left join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = Atenciones.IdCuentaAtencion  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltrarConsultaExterna] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltrarEmergencia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltrarEmergencia]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select FacturacionCuentasAtencion.IdCuentaAtencion,  Atenciones.IdTipoServicio, TiposServicio.Descripcion as TipoServicio, Atenciones.IdPaciente ,Atenciones.IdAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica,Pacientes.FechaNacimiento as FecNacim,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
        convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso
        , Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad, Pacientes.IdTipoNumeracion, Atenciones.IdServicioIngreso,  TiposNumeracionHistoria.Descripcion as TipoNumeracion,atenciones.idCuentaAtencion as NroCuenta
         From ((((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
         left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
         left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
         left join TiposServicio on Atenciones.IdTipoServicio = TiposServicio.IdTipoServicio)
         left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltrarEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltrarHospitalizacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltrarHospitalizacion]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select FacturacionCuentasAtencion.IdCuentaAtencion, Atenciones.IdPaciente ,Atenciones.IdAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica,Pacientes.FechaNacimiento as FecNacim,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
        convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
        convert(char(10),Atenciones.FechaEgresoAdministrativo,103) as FechaEgresoAdministrativo, Atenciones.HoraEgresoAdministrativo
        , FacturacionCuentasAtencion.IdEstado , atenciones.idCuentaAtencion as NroCuenta ,Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad, Pacientes.IdTipoNumeracion
        , Diagnosticos.CodigoCIE2004 as DxPrincipal, TiposAlta.Descripcion as TipoAlta, TiposCondicionAlta.Descripcion as CondicionAlta, Atenciones.IdServicioIngreso, TiposNumeracionHistoria.Descripcion as TipoNumeracion
         From ((((((((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
         left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
         left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
         left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
         left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
         and AtencionesDiagnosticos.IdClasificacionDx = 3
         and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
         left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)
         left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
         left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
         left join EstadosCuenta on EstadosCuenta.IdEstado = FacturacionCuentasAtencion.IdEstado  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltrarHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesFiltrarObservacionEmergencia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesFiltrarObservacionEmergencia]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select Atenciones.IdPaciente ,Atenciones.IdAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
        convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso
        , Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad, Pacientes.IdTipoNumeracion, Atenciones.IdServicioIngreso
         From ((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
        left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
        left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[atencionesFiltrarObservacionEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltrarPacientesParaIngresarProcedimientos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltrarPacientesParaIngresarProcedimientos]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'select Atenciones.IdPaciente ,Atenciones.IdAtencion, CuentasAtencion.IdCuentaAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso
        , Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad,
        Pacientes.IdTipoNumeracion
         From (((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
        left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
        left join CuentasAtencion on CuentasAtencion.IdAtencion = Atenciones.IdAtencion)
        left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltrarPacientesParaIngresarProcedimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesFiltraTransferenciasPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesFiltraTransferenciasPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
Select AtencionesEstanciaHospitalaria.IdServicio,
                 AtencionesEstanciaHospitalaria.FechaOcupacion,
                 AtencionesEstanciaHospitalaria.HoraOcupacion,
                AtencionesEstanciaHospitalaria.IdCama,AtencionesEstanciaHospitalaria.idEstanciaHospitalaria,
                 Camas.Codigo as CodigoCama,
                 Servicios.Codigo as CodigoServicio,
                Servicios.Nombre as NombreServicio,
                 AtencionesEstanciaHospitalaria.IdMedicoOrdena as IdMedicoOrdena,
                 Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres as NombreMedico
 from (((AtencionesEstanciaHospitalaria left join Servicios on AtencionesEstanciaHospitalaria.IdServicio = Servicios.IdServicio)
                left join Medicos on AtencionesEstanciaHospitalaria.IdMedicoOrdena = Medicos.IdMedico)
                 left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
                 left join Camas on AtencionesEstanciaHospitalaria.IdCama = Camas.IdCama
Where     AtencionesEstanciaHospitalaria.idAtencion = @idAtencion
order by AtencionesEstanciaHospitalaria.FechaOcupacion,AtencionesEstanciaHospitalaria.HoraOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesFiltraTransferenciasPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesHijoMadreAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesHijoMadreAgregar]
	@idAtencion [int],
	@idAtencionMadre [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesHijoMadre (
idAtencion,idAtencionMadre) values (
@idAtencion,@idAtencionMadre)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idAtencion,'AtencionesHijoMadre'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesHijoMadreAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesHijoMadreEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesHijoMadreEliminar]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesHijoMadre
where idAtencion = @idAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idAtencion,'AtencionesHijoMadre'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesHijoMadreEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesHijoMadreModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesHijoMadreModificar]
	@idAtencion [int],
	@idAtencionMadre [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesHijoMadre
set
idAtencionMadre = @idAtencionMadre
where idAtencion = @idAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idAtencion,'AtencionesHijoMadre'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesHijoMadreModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesHijoMadreSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesHijoMadreSeleccionarPorId]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesHijoMadre
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesHijoMadreSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesLabSinDxSinCptAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesLabSinDxSinCptAgregar]
	@idAtencion [int],
	@Grupo [int],
	@SubGrupo [int],
	@lab [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesLabSinDxSinCpt (
idAtencion,Grupo,SubGrupo,lab) values (
@idAtencion,@Grupo,@SubGrupo,@lab)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesLabSinDxSinCptAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesLabSinDxSinCptEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesLabSinDxSinCptEliminar]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesLabSinDxSinCpt
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesLabSinDxSinCptEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesLabSinDxSinCptSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesLabSinDxSinCptSeleccionarPorId]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesLabSinDxSinCpt
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesLabSinDxSinCptSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesListaCuentasXpaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesListaCuentasXpaciente]
	@ml_idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.TiposServicio.Descripcion, dbo.Atenciones.*
     FROM         dbo.Atenciones LEFT OUTER JOIN
                          dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
     WHERE dbo.Atenciones.idPaciente=@ml_idPaciente
     ORDER BY dbo.Atenciones.FechaIngreso DESC, dbo.Atenciones.HoraIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesListaCuentasXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesMaxAtencionesXPacienteYCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesMaxAtencionesXPacienteYCuenta]
	@lIdPaciente [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select max(IdAtencion) as IdMaxAtencion from Atenciones where IdPaciente = @lIdPaciente  and IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesMaxAtencionesXPacienteYCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesMaxAtencionesXPacienteYTipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesMaxAtencionesXPacienteYTipoServicio]
	@lIdPaciente [int],
	@lTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select max(IdAtencion) as IdMaxAtencion from Atenciones where IdPaciente = @lIdPaciente and IdTipoServicio = @lTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[atencionesMaxAtencionesXPacienteYTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesModificar]
	@HoraIngreso [char](5),
	@FechaIngreso [datetime],
	@IdTipoServicio [int],
	@IdPaciente [int],
	@IdAtencion [int],
	@IdTipoCondicionALEstab [int],
	@FechaEgresoAdministrativo [datetime],
	@IdCamaEgreso [int],
	@IdCamaIngreso [int],
	@IdServicioEgreso [int],
	@IdTipoAlta [int],
	@IdCondicionAlta [int],
	@IdTipoEdad [int],
	@IdOrigenAtencion [int],
	@IdDestinoAtencion [int],
	@HoraEgresoAdministrativo [char](5),
	@IdTipoCondicionAlServicio [int],
	@HoraEgreso [char](5),
	@FechaEgreso [datetime],
	@IdMedicoEgreso [int],
	@Edad [int],
	@IdEspecialidadMedico [int],
	@IdMedicoIngreso [int],
	@IdServicioIngreso [int],
	@IdTipoGravedad [int],
	@IdCuentaAtencion [int],
	@idFormaPago [int],
	@IdUsuarioAuditoria [int],
	@idFuenteFinanciamiento [int],
	@idEstadoAtencion [int],
	@EsPacienteExterno [bit],
	@idSunasaPacienteHistorico [int],
	@HoraInicioAtencion [char](5),
	@EpsPorcentaje [money]
WITH EXECUTE AS CALLER
AS
update Atenciones
set
HoraIngreso = @HoraIngreso,
FechaIngreso = @FechaIngreso,
IdTipoServicio = @IdTipoServicio,
IdPaciente = @IdPaciente,
IdTipoCondicionALEstab = @IdTipoCondicionALEstab,
FechaEgresoAdministrativo = @FechaEgresoAdministrativo,
IdCamaEgreso = @IdCamaEgreso,
IdCamaIngreso = @IdCamaIngreso,
IdServicioEgreso = @IdServicioEgreso,
IdTipoAlta = @IdTipoAlta,
IdCondicionAlta = @IdCondicionAlta,
IdTipoEdad = @IdTipoEdad,
IdOrigenAtencion = @IdOrigenAtencion,
IdDestinoAtencion = @IdDestinoAtencion,
HoraEgresoAdministrativo = @HoraEgresoAdministrativo,
IdTipoCondicionAlServicio = @IdTipoCondicionAlServicio,
HoraEgreso = @HoraEgreso,
FechaEgreso = @FechaEgreso,
IdMedicoEgreso = @IdMedicoEgreso,
Edad = @Edad,
IdEspecialidadMedico = @IdEspecialidadMedico,
IdMedicoIngreso = @IdMedicoIngreso,
IdServicioIngreso = @IdServicioIngreso,
IdTipoGravedad = @IdTipoGravedad,
IdCuentaAtencion = @IdCuentaAtencion,
idFormaPago=@idFormaPago,
idFuenteFinanciamiento=@idFuenteFinanciamiento,
idEstadoAtencion=@idEstadoAtencion,
EsPacienteExterno=@EsPacienteExterno,
idSunasaPacienteHistorico=@idSunasaPacienteHistorico,
HoraInicioAtencion=@HoraInicioAtencion,
EpsPorcentaje=@EpsPorcentaje
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosAgregar]
	@IdAtencion [int],
	@IdCondicionRN [int],
	@IdTipoSexo [int],
	@Peso [float],
	@Talla [float],
	@EdadSemanas [int],
	@FechaNacimiento [datetime],
	@IdNacimiento [int] OUTPUT,
	@apgar_1 [int],
	@apgar_5 [int],
	@ClamplajeFecha [datetime],
	@NroOrdenHijoEnParto [int],
	@NroOrdenHijo [int],
	@idPacienteNacido [int],
	@docIdentidad [varchar](20),
	@IdDocIdentidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesNacimientos (
IdAtencion,IdCondicionRN,IdTipoSexo,Peso,Talla,EdadSemanas,FechaNacimiento,apgar_1,apgar_5,ClamplajeFecha,NroOrdenHijoEnParto,NroOrdenHijo,idPacienteNacido,
docIdentidad,IdDocIdentidad)
 values (
@IdAtencion,@IdCondicionRN,@IdTipoSexo,@Peso,@Talla,@EdadSemanas,@FechaNacimiento,@apgar_1,@apgar_5,@ClamplajeFecha,@NroOrdenHijoEnParto,@NroOrdenHijo,@idPacienteNacido,
@docIdentidad,@IdDocIdentidad)
set @IdNacimiento = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosAsignaNULLidPacienteNacido]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosAsignaNULLidPacienteNacido]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
update AtencionesNacimientos set idPacienteNacido=null where idPacienteNacido=@idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosAsignaNULLidPacienteNacido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosEliminar]
	@IdNacimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesNacimientos
where IdNacimiento = @IdNacimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosEliminarXIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosEliminarXIdAtencion]
	@lIdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesNacimientos where IdAtencion = @lIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosEliminarXIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosModificar]
	@IdAtencion [int],
	@IdCondicionRN [int],
	@IdTipoSexo [int],
	@Peso [float],
	@Talla [float],
	@EdadSemanas [int],
	@FechaNacimiento [datetime],
	@IdNacimiento [int],
	@apgar_1 [int],
	@apgar_5 [int],
	@ClamplajeFecha [datetime],
	@NroOrdenHijoEnParto [int],
	@NroOrdenHijo [int],
	@idPacienteNacido [int],
	@docIdentidad [varchar](20),
	@IdDocIdentidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesNacimientos
set
IdAtencion = @IdAtencion,
IdCondicionRN = @IdCondicionRN,
IdTipoSexo = @IdTipoSexo,
Peso = @Peso,
Talla = @Talla,
EdadSemanas = @EdadSemanas,
FechaNacimiento = @FechaNacimiento,
ClamplajeFecha=@ClamplajeFecha,
NroOrdenHijoEnParto=@NroOrdenHijoEnParto,
NroOrdenHijo=@NroOrdenHijo,
idPacienteNacido=@idPacienteNacido,
docIdentidad =@docIdentidad,
IdDocIdentidad=@IdDocIdentidad
where IdNacimiento = @IdNacimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosSeleccionarPorAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosSeleccionarPorAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.AtencionesNacimientos.FechaNacimiento, dbo.AtencionesNacimientos.EdadSemanas,
                         dbo.AtencionesNacimientos.Talla, dbo.AtencionesNacimientos.Peso,
                         dbo.AtencionesNacimientos.IdCondicionRN,
                         dbo.TiposCondicionRecienNacido.Descripcion AS CondicionRN,
                         dbo.AtencionesNacimientos.IdTipoSexo, dbo.TiposSexo.Descripcion AS Sexo,
                         dbo.AtencionesNacimientos.apgar_1, dbo.AtencionesNacimientos.apgar_5,
                         dbo.AtencionesNacimientos.ClamplajeFecha,
                         dbo.AtencionesNacimientos.NroOrdenHijoEnParto, dbo.AtencionesNacimientos.NroOrdenHijo,
                         dbo.AtencionesNacimientos.docIdentidad, dbo.AtencionesNacimientos.IdDocIdentidad
FROM            dbo.AtencionesNacimientos INNER JOIN
                         dbo.TiposSexo ON
                         dbo.AtencionesNacimientos.IdTipoSexo = dbo.TiposSexo.IdTipoSexo INNER JOIN
                         dbo.TiposCondicionRecienNacido ON
                         dbo.AtencionesNacimientos.IdCondicionRN = dbo.TiposCondicionRecienNacido.IdCondicionRN
where @IdAtencion = IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosSeleccionarPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosSeleccionarPorFiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)

seT  @SQL =  'select * from AtencionesNacimientos where  ' + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosSeleccionarPorId]
	@IdNacimiento [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesNacimientos
where IdNacimiento = @IdNacimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosSeleccionarXIdNacimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosSeleccionarXIdNacimiento]
	@IdNacimiento [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesNacimientos where idNacimiento=@IdNacimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosSeleccionarXIdNacimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosSeleccionarXidPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosSeleccionarXidPaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesNacimientos where idPacienteNacido=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosSeleccionarXidPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosXidAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesNacimientos where idAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesNacimientosXidPacienteDeMadre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesNacimientosXidPacienteDeMadre]
	@ml_IdPacienteMadre [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesNacimientos.FechaNacimiento, dbo.AtencionesNacimientos.EdadSemanas, dbo.AtencionesNacimientos.Talla,
                                          dbo.AtencionesNacimientos.Peso, CASE dbo.AtencionesNacimientos.IdTipoSexo WHEN 1 THEN 'Masculino' ELSE 'Femenino' END AS Sexo,
                                          dbo.AtencionesNacimientos.idAtencion , dbo.Atenciones.idPaciente, dbo.AtencionesNacimientos.idNacimiento
                     FROM         dbo.Atenciones LEFT OUTER JOIN
                                          dbo.AtencionesNacimientos ON dbo.Atenciones.IdAtencion = dbo.AtencionesNacimientos.IdAtencion
                     Where (dbo.AtencionesNacimientos.IdCondicionRN = 1) and dbo.Atenciones.IdPaciente=@ml_IdPacienteMadre
                     Order by dbo.AtencionesNacimientos.IdAtencion desc
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesNacimientosXidPacienteDeMadre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesParaAtencionPagantesDelMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesParaAtencionPagantesDelMedico]
	@ldFechaIngreso [datetime],
	@lnIdServicioIngreso [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                                  dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.IdOrden,
                                  dbo.FactOrdenServicio.IdEstadoFacturacion , dbo.Atenciones.IdFormaPago, dbo.Atenciones.idCuentaAtencion,
                                  dbo.FactOrdenServicio.idTipoFinanciamiento
             FROM         dbo.Atenciones RIGHT OUTER JOIN
                                  dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
             WHERE     dbo.Atenciones.FechaIngreso   =  CONVERT(DATETIME,@ldFechaIngreso,103)
                       AND dbo.Atenciones.IdServicioIngreso=@lnIdServicioIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesParaAtencionPagantesDelMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesParaMDW]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesParaMDW]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.FechaEgreso, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Atenciones.IdDestinoAtencion, dbo.FacturacionCuentasAtencion.IdEstado, dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.IdTipoServicio,
                      dbo.Atenciones.FechaEgresoAdministrativo, dbo.Atenciones.IdPaciente, dbo.Servicios.Nombre, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.FacturacionCuentasAtencion.FechaCreacion, dbo.Atenciones.IdFormaPago,
                      dbo.Atenciones.EsPacienteExterno, dbo.Atenciones.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento,
                      dbo.Atenciones.HoraEgreso,DBO.Atenciones.IdAtencion
FROM         dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion ON dbo.Pacientes.IdPaciente = dbo.FacturacionCuentasAtencion.IdPaciente ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion
WHERE     (dbo.Atenciones.idEstadoAtencion = 1)
ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesParaMDW] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesParaSip2000]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesParaSip2000]
	@lcFechaInicio [datetime],
	@lcFechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                                  + ' ' + dbo.Pacientes.PrimerNombre AS nPaciente, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdDocIdentidad,
                                  dbo.AtencionesDatosAdicionales.DireccionDomicilio, dbo.Pacientes.IdTipoOcupacion, dbo.Atenciones.Edad, dbo.Pacientes.IdEstadoCivil,
                                  dbo.Pacientes.Telefono, dbo.Pacientes.IdDistritoDomicilio, dbo.Pacientes.IdGradoInstruccion, dbo.Pacientes.GrupoSanguineo, dbo.Pacientes.FactorRh,
                                  dbo.Pacientes.IdCentroPobladoDomicilio, dbo.Pacientes.SegundoNombre, dbo.Servicios.IdEspecialidad, dbo.Atenciones.IdServicioIngreso,
                                  dbo.Servicios.Nombre AS dServicio,dbo.AtencionesDatosAdicionales.idEstablecimientoOrigen,dbo.AtencionesDatosAdicionales.idEstablecimientoDestino
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             WHERE dbo.Atenciones.fechaIngreso between CONVERT(DATETIME,@lcFechaInicio,103) and CONVERT(DATETIME,@lcFechaFinal,103)
                   and dbo.Servicios.IdEspecialidad = 31 and dbo.Atenciones.idEstadoAtencion>0
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesParaSip2000] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesPorIdAtencionConTurnoYfuentefinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[atencionesPorIdAtencionConTurnoYfuentefinanciamiento]
	@idatencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Turnos.codigo AS dturno, dbo.FuentesFinanciamiento.Descripcion AS dfuente, dbo.Atenciones.*
FROM         dbo.Atenciones INNER JOIN
                      dbo.Citas ON dbo.Atenciones.IdAtencion = dbo.Citas.IdAtencion INNER JOIN
                      dbo.ProgramacionMedica ON dbo.Citas.IdProgramacion = dbo.ProgramacionMedica.IdProgramacion INNER JOIN
                      dbo.Turnos ON dbo.ProgramacionMedica.IdTurno = dbo.Turnos.IdTurno LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
where dbo.Atenciones.idatencion=@idatencion
GO
ALTER AUTHORIZATION ON [dbo].[atencionesPorIdAtencionConTurnoYfuentefinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosAgregar]
	@NroOrden [char](10),
	@IdMedicoRealiza [int],
	@IdServicioRealiza [int],
	@IdDetalleProducto [int],
	@IdCuentaAtencion [int],
	@HoraRealizacion [char](5),
	@FechaRealizacion [datetime],
	@IdProcedimiento [int],
	@IdAtencionProcedimiento [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtencionesProcedimientos (
NroOrden,IdMedicoRealiza,IdServicioRealiza,IdDetalleProducto,IdCuentaAtencion,HoraRealizacion,FechaRealizacion,IdProcedimiento) values (
@NroOrden,@IdMedicoRealiza,@IdServicioRealiza,@IdDetalleProducto,@IdCuentaAtencion,@HoraRealizacion,@FechaRealizacion,@IdProcedimiento)
set @IdAtencionProcedimiento = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtencionProcedimiento,'AtencionesProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosEliminar]
	@IdAtencionProcedimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtencionesProcedimientos
where IdAtencionProcedimiento = @IdAtencionProcedimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencionProcedimiento,'AtencionesProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosModificar]
	@NroOrden [char](10),
	@IdMedicoRealiza [int],
	@IdServicioRealiza [int],
	@IdDetalleProducto [int],
	@IdCuentaAtencion [int],
	@HoraRealizacion [char](5),
	@FechaRealizacion [datetime],
	@IdProcedimiento [int],
	@IdAtencionProcedimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtencionesProcedimientos
set
NroOrden = @NroOrden,
IdMedicoRealiza = @IdMedicoRealiza,
IdServicioRealiza = @IdServicioRealiza,
IdDetalleProducto = @IdDetalleProducto,
IdCuentaAtencion = @IdCuentaAtencion,
HoraRealizacion = @HoraRealizacion,
FechaRealizacion = @FechaRealizacion,
IdProcedimiento = @IdProcedimiento
where IdAtencionProcedimiento = @IdAtencionProcedimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtencionProcedimiento,'AtencionesProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select Procedimientos.CodigoCPT2004 as Codigo, Procedimientos.Descripcion
from (AtencionProcedimientos
left join AtencionProcedimientoDetalle on AtencionProcedimientos.IdAtencionProcedimiento = AtencionProcedimientoDetalle.IdAtencionProcedimiento)
left join Procedimientos on AtencionProcedimientoDetalle.IdProcedimiento = Procedimientos.IdProcedimiento
where
AtencionProcedimientos.IdCuentaAtencion = @IdCuentaAtencion
order by AtencionProcedimientoDetalle.IdAtencionProcDetalle
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionEInterconsulta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionEInterconsulta]
	@IdCuentaAtencion [int],
	@IdInterconsulta [int]
WITH EXECUTE AS CALLER
AS
select
AtencionesProcedimientos.IdProcedimiento,
Procedimientos.CodigoCPT2004 as CodigoCPT,
Procedimientos.Descripcion,
AtencionesProcedimientos.IdMedicoRealiza,
Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres as NombreMedico,
AtencionesProcedimientos.IdServicioRealiza,
Servicios.Nombre as NombreServicio,
AtencionesProcedimientos.FechaRealizacion,
AtencionesProcedimientos.HoraRealizacion,
AtencionesProcedimientos.IdDetalleProducto
from (((AtencionesProcedimientos
left join Procedimientos on AtencionesProcedimientos.IdProcedimiento = Procedimientos.IdProcedimiento)
left join Medicos on AtencionesProcedimientos.IdMedicoRealiza = Medicos.IdMedico)
left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
left join Servicios on AtencionesProcedimientos.IdServicioRealiza = Servicios.IdServicio
where AtencionesProcedimientos.IdCuentaAtencion = @IdCuentaAtencion
and AtencionesProcedimientos.IdInterconsulta = @IdInterconsulta
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionEInterconsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionSinInterconsulta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionSinInterconsulta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select
AtencionesProcedimientos.IdProcedimiento,
Procedimientos.CodigoCPT2004 as CodigoCPT,
Procedimientos.Descripcion,
AtencionesProcedimientos.IdMedicoRealiza,
Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres as NombreMedico,
AtencionesProcedimientos.IdServicioRealiza,
Servicios.Nombre as NombreServicio,
AtencionesProcedimientos.FechaRealizacion,
AtencionesProcedimientos.HoraRealizacion,
AtencionesProcedimientos.IdDetalleProducto
from (((AtencionesProcedimientos
left join Procedimientos on AtencionesProcedimientos.IdProcedimiento = Procedimientos.IdProcedimiento)
left join Medicos on AtencionesProcedimientos.IdMedicoRealiza = Medicos.IdMedico)
left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
left join Servicios on AtencionesProcedimientos.IdServicioRealiza = Servicios.IdServicio
where AtencionesProcedimientos.IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosSeleccionarPorCuentaAtencionSinInterconsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesProcedimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesProcedimientosSeleccionarPorId]
	@IdAtencionProcedimiento [int]
WITH EXECUTE AS CALLER
AS
select * from AtencionesProcedimientos
where IdAtencionProcedimiento = @IdAtencionProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesProcedimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesQueTuvoElPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesQueTuvoElPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.Edad, dbo.Atenciones.FechaIngreso,
                      dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdFormaPago, dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso,
                      dbo.FuentesFinanciamiento.Descripcion AS FuenteFinanciamiento, dbo.TiposServicio.Descripcion AS TipoServicio,
             dbo.Atenciones.idTipoServicio
FROM         dbo.Atenciones INNER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento INNER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
WHERE dbo.Atenciones.idPaciente=@idPaciente
ORDER BY dbo.Atenciones.FechaIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesQueTuvoElPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesQueTuvoElPacienteConstancias]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesQueTuvoElPacienteConstancias]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT atenciones.idAtencion, atenciones.idPaciente, atenciones.Edad, atenciones.FechaIngreso, atenciones.HoraIngreso, atenciones.IdFormaPago, atenciones.FechaEgreso, atenciones.HoraEgreso, atenciones.idMedicoIngreso, atenciones.idMedicoEgreso, atenciones.idTipoServicio, TiposServicio.Descripcion,atenciones.idCuentaAtencion as NroCuenta
FROM atenciones, TiposServicio
WHERE atenciones.idPaciente=@idPaciente AND atenciones.idEstadoAtencion<>0 AND TiposServicio.idTipoServicio=atenciones.idTipoServicio
ORDER BY atenciones.FechaIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesQueTuvoElPacienteConstancias] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesQueTuvoElPacienteConstanciasPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesQueTuvoElPacienteConstanciasPorId]
	@idPaciente [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT atenciones.idAtencion, atenciones.idPaciente, atenciones.Edad, atenciones.FechaIngreso, atenciones.HoraIngreso, atenciones.IdFormaPago, atenciones.FechaEgreso, atenciones.HoraEgreso, atenciones.idMedicoIngreso, atenciones.idMedicoEgreso, atenciones.idTipoServicio, TiposServicio.Descripcion,atenciones.idCuentaAtencion as NroCuenta
FROM atenciones, TiposServicio
WHERE atenciones.idPaciente=@idPaciente AND atenciones.idAtencion=@idAtencion  AND atenciones.idEstadoAtencion<>0 AND TiposServicio.idTipoServicio=atenciones.idTipoServicio
ORDER BY atenciones.FechaIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesQueTuvoElPacienteConstanciasPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesQueTuvoElPacienteEnGeneral]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesQueTuvoElPacienteEnGeneral]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT atenciones.idCuentaAtencion, atenciones.idAtencion, atenciones.idPaciente, TiposFinanciamiento.Descripcion, atenciones.Edad, atenciones.FechaIngreso, atenciones.HoraIngreso, atenciones.IdFormaPago, atenciones.FechaEgreso, atenciones.HoraEgreso, atenciones.idServicioIngreso, Servicios.nombre
FROM atenciones, TiposFinanciamiento, Servicios
WHERE atenciones.idPaciente=@idPaciente AND atenciones.idFormaPago<>0 AND atenciones.idFormaPago=TiposFinanciamiento.idTipoFinanciamiento AND servicios.idServicio=atenciones.idServicioIngreso
ORDER BY FechaIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesQueTuvoElPacienteEnGeneral] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesReporteParaHistoriaClinica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesReporteParaHistoriaClinica]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     CONVERT(varchar(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdServicioIngreso,
                      dbo.Servicios.Nombre AS Servicio, dbo.Atenciones.IdEspecialidadMedico, dbo.Especialidades.Nombre AS EspecialidadMedico,
                      dbo.Atenciones.IdMedicoIngreso, dbo.Empleados.ApellidoPaterno AS ApellidoPaternoMedico,
                      dbo.Empleados.ApellidoMaterno AS ApellidoMaternoMedico, dbo.Empleados.Nombres AS NombresMedico, dbo.Atenciones.Edad,
                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                      dbo.Pacientes.TercerNombre, dbo.Pacientes.FechaNacimiento, dbo.AtencionesDatosAdicionales.DireccionDomicilio,
                      dbo.Departamentos.IdDepartamento AS IdDepartamentoDomicilio, dbo.Departamentos.Nombre AS DepartamentoDomicilio,
                      dbo.Provincias.IdProvincia AS IdProvinciaDomicilio, dbo.Provincias.Nombre AS ProvinciaDomicilio, dbo.Distritos.IdDistrito AS IdDistritoDomicilio,
                      dbo.Distritos.Nombre AS DistritoDomicilio, dbo.CentrosPoblados.IdCentroPoblado AS IdCentroPobladoDomicilio,
                      dbo.CentrosPoblados.Nombre AS CentroPobladoDomicilio, dbo.Pacientes.Telefono, dbo.Pacientes.IdDocIdentidad,
                      dbo.TiposDocIdentidad.Descripcion AS TipoDocumento, dbo.Pacientes.NroDocumento, dbo.AtencionesDatosAdicionales.Observacion,
                      dbo.AtencionesDatosAdicionales.NombreAcompaniante, dbo.Pacientes.IdTipoSexo, dbo.TiposEstadoCivil.Descripcion AS EstadoCivil,
		      ISNULL(dbo.PacientesDatosAdicionales.FNacimientoCalculada, 0) AS FNacimientoCalculada,dbo.atenciones.IdDestinoAtencion,
		      dbo.atenciones.IdCuentaAtencion  ,dbo.Pacientes.Observacion as obsPaciente
FROM         dbo.TiposNumeracionHistoria
RIGHT OUTER JOIN      dbo.Pacientes ON dbo.TiposNumeracionHistoria.IdTipoNumeracion = dbo.Pacientes.IdTipoNumeracion
LEFT OUTER JOIN       dbo.PacientesDatosAdicionales ON dbo.Pacientes.IdPaciente = dbo.PacientesDatosAdicionales.IdPaciente
LEFT OUTER JOIN       dbo.TiposEstadoCivil ON dbo.Pacientes.IdEstadoCivil = dbo.TiposEstadoCivil.IdEstadoCivil
LEFT OUTER JOIN  dbo.Distritos ON dbo.Pacientes.IdDistritoDomicilio = dbo.Distritos.IdDistrito
LEFT JOIN  dbo.Provincias ON dbo.Distritos.IdProvincia = dbo.Provincias.IdProvincia
LEFT JOIN  dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento
LEFT JOIN dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoDomicilio = dbo.CentrosPoblados.IdDistrito
LEFT OUTER JOIN       dbo.TiposDocIdentidad ON dbo.Pacientes.IdDocIdentidad = dbo.TiposDocIdentidad.IdDocIdentidad
RIGHT OUTER JOIN      dbo.Empleados
INNER JOIN            dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado
INNER JOIN            dbo.Atenciones ON dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso ON
                      dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
LEFT OUTER JOIN       dbo.Especialidades ON dbo.Atenciones.IdEspecialidadMedico = dbo.Especialidades.IdEspecialidad
LEFT OUTER JOIN       dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
LEFT OUTER JOIN       dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
where dbo.Atenciones.IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesReporteParaHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionaCitasPagadas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionaCitasPagadas]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                    dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                    dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdFormaPago
                    FROM         dbo.Atenciones RIGHT OUTER JOIN
                    dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                    dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
                    Where  dbo.Atenciones.idFormaPago=1 and  dbo.Atenciones.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionaCitasPagadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarCEPorCuentaPorHistoriaPorApellidosPorServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarCEPorCuentaPorHistoriaPorApellidosPorServicio]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'SELECT     dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion AS NroCuenta, dbo.Pacientes.ApellidoPaterno,
                                  dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica,
                                  dbo.Pacientes.FichaFamiliar, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso,
                                  dbo.Atenciones.HoraIngreso, dbo.Atenciones.HoraEgreso, dbo.Servicios.Nombre AS ServicioIngreso, dbo.Atenciones.Edad AS Edad, dbo.Citas.IdCita,
                                  dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso, dbo.Atenciones.IdMedicoIngreso,
                                  dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdFormaPago,
                                  dbo.TiposFinanciamiento.GeneraPago,dbo.Servicios.idEspecialidad,dbo.Atenciones.EpsPorcentaje
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                  dbo.Citas ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                                  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarCEPorCuentaPorHistoriaPorApellidosPorServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarCEPorFechaIngresoYplan]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarCEPorFechaIngresoYplan]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.Edad, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso,
                      dbo.Atenciones.IdDestinoAtencion, dbo.Atenciones.IdTipoCondicionAlServicio, dbo.Atenciones.IdTipoCondicionALEstab,
                      dbo.Atenciones.IdServicioIngreso, dbo.Atenciones.IdMedicoIngreso, dbo.Atenciones.IdEspecialidadMedico, dbo.Atenciones.IdMedicoEgreso,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Atenciones.IdOrigenAtencion, dbo.Atenciones.FechaEgresoAdministrativo,
                      dbo.Atenciones.HoraEgresoAdministrativo, dbo.Atenciones.IdCondicionAlta, dbo.Atenciones.IdTipoAlta, dbo.Atenciones.IdServicioEgreso,
                      dbo.Atenciones.IdCamaIngreso, dbo.Atenciones.IdCamaEgreso, dbo.Atenciones.IdTipoGravedad, dbo.Atenciones.IdTipoEdad,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento,
                      dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno, dbo.Atenciones.idSunasaPacienteHistorico,
                      LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente,
                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.EstadosCuenta.Descripcion AS dEstadoCuenta,
                      dbo.Servicios.Nombre AS dServicio, dbo.FacturacionCuentasAtencion.IdEstado, dbo.AtencionesDatosAdicionales.IdSiaSis,
                      dbo.AtencionesDatosAdicionales.SisCodigo,dbo.Pacientes.Email,dbo.Pacientes.Telefono
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones INNER JOIN
                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
where	          dbo.Atenciones.fechaIngreso Between @FechaInicio and @FechaFin  and dbo.Atenciones.idEstadoAtencion<>0
		and dbo.Atenciones.idTipoServicio=1  and dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
order by      dbo.Atenciones.fechaIngreso,dbo.Atenciones.horaIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarCEPorFechaIngresoYplan] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdMedicoEgreso, dbo.Medicos.Colegiatura,
                                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Atenciones.FechaIngreso,
                                      dbo.Atenciones.FechaEgreso , dbo.Servicios.Nombre, dbo.Atenciones.Edad, dbo.Camas.codigo
                 FROM         dbo.Medicos RIGHT OUTER JOIN
                                      dbo.Servicios RIGHT OUTER JOIN
                                      dbo.Atenciones LEFT OUTER JOIN
                                      dbo.Camas ON dbo.Atenciones.IdCamaEgreso = dbo.Camas.IdCama ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso ON
                                      dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoEgreso LEFT OUTER JOIN
                                      dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
                 Where (Not (dbo.Atenciones.FechaEgreso Is Null)) and dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuentaConexion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuentaConexion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdMedicoEgreso, dbo.Medicos.Colegiatura,
                                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Atenciones.FechaIngreso,
                                      dbo.Atenciones.FechaEgreso , dbo.Servicios.Nombre, dbo.Atenciones.Edad, dbo.Camas.codigo
                 FROM         dbo.Medicos RIGHT OUTER JOIN
                                      dbo.Servicios RIGHT OUTER JOIN
                                      dbo.Atenciones LEFT OUTER JOIN
                                      dbo.Camas ON dbo.Atenciones.IdCamaEgreso = dbo.Camas.IdCama ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso ON
                                      dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoEgreso LEFT OUTER JOIN
                                      dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
                 Where (Not (dbo.Atenciones.FechaEgreso Is Null)) and dbo.Atenciones.IdCuentaAtencion= @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarDatosCabeceraBoletaHRCxCuentaConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarEmergenciaPorAnioDeIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarEmergenciaPorAnioDeIngreso]
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.IdEspecialidad AS CodEspecialidad,
                      dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto, dbo.DepartamentosHospital.Nombre AS dDpto,
                      dbo.Servicios.Codigo AS CodigoServicio, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                      dbo.CentrosPoblados.IdDistrito AS IdDistritoP,dbo.Pacientes.IdTipoNumeracion
FROM         dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
                      dbo.CentrosPoblados RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.CentrosPoblados.IdCentroPoblado = dbo.Pacientes.IdCentroPobladoProcedencia ON
                      dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento ON
                      dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
where             (Atenciones.IdTipoServicio in (2,4))  and dbo.Atenciones.FechaIngreso is not null and year(dbo.Atenciones.FechaIngreso)=@anio
	        and dbo.Atenciones.idEstadoAtencion<>0
order by         dDpto,CodDpto,dEspecialidad,CodEspecialidad,dServicio,IdServicioEgreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarEmergenciaPorAnioDeIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarEmergenciaPorFechasDeEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarEmergenciaPorFechasDeEgresoMedico]
	@ldFechaEgresoIni [varchar](10),
	@ldFechaEgresoFin [varchar](10),
	@lcFiltro [varchar](2000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3000)

   SET  @SQL =  'SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                            dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                            dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ
                      FROM         dbo.Atenciones LEFT OUTER JOIN
                                            dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                            dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
                    where (dbo.Atenciones.FechaEgreso is not null) and dbo.Atenciones.FechaEgreso Between  (CONVERT(DATETIME,'+@ldFechaEgresoIni+',103)) and
                                (CONVERT(DATETIME,'+@ldFechaEgresoFin+',103))  and   (dbo.Atenciones.IdTipoServicio  in (2,4))
                         and dbo.Atenciones.idEstadoAtencion<>0     '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarEmergenciaPorFechasDeEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarEmergPorCuentaPorHistoriaPorApellidosPorServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarEmergPorCuentaPorHistoriaPorApellidosPorServicio]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)

   SET  @SQL =  'SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
                                   dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                                   dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
                                   AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso,
                                   dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso,
                                   dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, CONVERT(char(10), dbo.Atenciones.FechaEgresoAdministrativo, 103)
                                   AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
                         dbo.Atenciones.idEstadoAtencion,dbo.atenciones.idMedicoEgreso
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                   dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                   dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                   dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarEmergPorCuentaPorHistoriaPorApellidosPorServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospEmergPorFechaAltaMedicaYplan]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospEmergPorFechaAltaMedicaYplan]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=0    --ambos
	SELECT     dbo.Atenciones.*, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.EstadosCuenta.Descripcion AS dEstadoCuenta,
	                      dbo.Servicios.Nombre AS dServicio,dbo.FacturacionCuentasAtencion.idEstado
	FROM         dbo.TiposServicio RIGHT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente ON
	                      dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
	where	          dbo.Atenciones.fechaEgreso Between @FechaInicio and @FechaFin  and dbo.Atenciones.idEstadoAtencion<>0
		         and dbo.Atenciones.idTipoServicio>1 and dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
	order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
else
if @idTipoServicio=3    --solo hospitalizacion
	SELECT     dbo.Atenciones.*, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.EstadosCuenta.Descripcion AS dEstadoCuenta,
	                      dbo.Servicios.Nombre AS dServicio
	FROM         dbo.TiposServicio RIGHT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente ON
	                      dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
	where	          dbo.Atenciones.fechaEgreso Between @FechaInicio and @FechaFin  and dbo.Atenciones.idEstadoAtencion<>0
		         and  dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
		         and dbo.Atenciones.idTipoServicio=3
	order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
else     -- solo emergencia
	SELECT     dbo.Atenciones.*, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.EstadosCuenta.Descripcion AS dEstadoCuenta,
	                      dbo.Servicios.Nombre AS dServicio
	FROM         dbo.TiposServicio RIGHT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente ON
	                      dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
	where	          dbo.Atenciones.fechaEgreso Between @FechaInicio and @FechaFin  and dbo.Atenciones.idEstadoAtencion<>0
		         and  dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
		         and dbo.Atenciones.idTipoServicio in (2,4)
	order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospEmergPorFechaAltaMedicaYplan] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedico]
	@OrdenFiltro [varchar](13),
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @OrdenFiltro = 'HC'
		SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
		                     dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
		                     dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
		                     dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
		                     dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
		                     dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
		                     dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino,dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad,
		                     dbo.Pacientes.IdEtnia ,dbo.TiposAlta.tiposaltasem, dbo.Empleados.DNI,dbo.Empleados.idTipoDocumento,dbo.Medicos.idColegioHIS,
		                     dbo.Empleados.IdTipoEmpleado,
		                     (select dbo.TiposGravedadAtencion.codigoSEM from dbo.TiposGravedadAtencion
		                      where  dbo.TiposGravedadAtencion.IdTipoGravedad = dbo.atenciones.IdTipoGravedad  ) as tipoGravedadSEM
		FROM         dbo.AtencionesDatosAdicionales INNER JOIN
		                     dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
		                     dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
		                     dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
		                     dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
		                     dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
		                     dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
		                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente left outer join
				                     dbo.TiposAlta on dbo.Atenciones.IdTipoAlta=dbo.TiposAlta.IdTipoAlta  left outer join
				                     dbo.Empleados on dbo.Medicos.IdEmpleado =dbo.Empleados.IdEmpleado

		where (dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin ) and   (dbo.Atenciones.IdTipoServicio <>1)
		                    and dbo.Atenciones.idEstadoAtencion<>0
		order by dbo.Pacientes.NroHistoriaClinica
ELSE
		IF @OrdenFiltro = 'FECHAEGRESO'
				SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
				                     dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
				                     dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
				                     dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
				                     dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
				                     dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
				                     dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino,dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad,
		                     dbo.Pacientes.IdEtnia ,dbo.TiposAlta.tiposaltasem, dbo.Empleados.DNI,dbo.Empleados.idTipoDocumento,dbo.Medicos.idColegioHIS,
		                     dbo.Empleados.IdTipoEmpleado,
		                     (select dbo.TiposGravedadAtencion.codigoSEM from dbo.TiposGravedadAtencion
		                      where  dbo.TiposGravedadAtencion.IdTipoGravedad = dbo.atenciones.IdTipoGravedad  ) as tipoGravedadSEM
				FROM         dbo.AtencionesDatosAdicionales INNER JOIN
				                     dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
				                     dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                     dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                     dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN

				                     dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
				                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente left outer join
				                     dbo.TiposAlta on dbo.Atenciones.IdTipoAlta=dbo.TiposAlta.IdTipoAlta  left outer join
				                     dbo.Empleados on dbo.Medicos.IdEmpleado =dbo.Empleados.IdEmpleado
				where (dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin ) and   (dbo.Atenciones.IdTipoServicio <>1)
				                    and dbo.Atenciones.idEstadoAtencion<>0
				order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
		ELSE
				SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
				                     dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
				                     dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
				                     dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
				                     dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
				                     dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
				                     dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino,dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad,
		                     dbo.Pacientes.IdEtnia ,dbo.TiposAlta.tiposaltasem, dbo.Empleados.DNI,dbo.Empleados.idTipoDocumento,dbo.Medicos.idColegioHIS    ,
		                     dbo.Empleados.IdTipoEmpleado,
		                     (select dbo.TiposGravedadAtencion.codigoSEM from dbo.TiposGravedadAtencion
		                      where  dbo.TiposGravedadAtencion.IdTipoGravedad = dbo.atenciones.IdTipoGravedad  ) as tipoGravedadSEM
				FROM         dbo.AtencionesDatosAdicionales INNER JOIN
				                     dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
				                     dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                     dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                     dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
				                     dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
				                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente left outer join
				                     dbo.TiposAlta on dbo.Atenciones.IdTipoAlta=dbo.TiposAlta.IdTipoAlta left outer join
				                     dbo.Empleados on dbo.Medicos.IdEmpleado =dbo.Empleados.IdEmpleado
				where (dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin)  and   (dbo.Atenciones.IdTipoServicio <>1)
				                    and dbo.Atenciones.idEstadoAtencion<>0
				order by dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoEmergencia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoEmergencia]
	@OrdenFiltro [varchar](20),
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @OrdenFiltro = 'HC'
	BEGIN
		SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
		                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
		                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ
		FROM         dbo.Atenciones LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		where (dbo.Atenciones.FechaEgreso is not null) and dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin  and   (dbo.Atenciones.IdTipoServicio  in (2,4))
		   and dbo.Atenciones.idEstadoAtencion<>0

		order by dbo.Pacientes.NroHistoriaClinica
	END
ELSE
	BEGIN
		SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
		                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
		                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ
		FROM         dbo.Atenciones LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		where (dbo.Atenciones.FechaEgreso is not null) and dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin  and   (dbo.Atenciones.IdTipoServicio  in (2,4))
		   and dbo.Atenciones.idEstadoAtencion<>0
		order by dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre

	END
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoTiposEdad]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoTiposEdad]
	@OrdenFiltro [varchar](20),
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @OrdenFiltro = 'HC'
	BEGIN
		SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
		                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
		                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
		                      dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
		                      dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM,
		                      dbo.TiposEdad.tipoEdadSEM
		FROM         dbo.TiposEdad RIGHT OUTER JOIN
		                      dbo.Atenciones ON dbo.TiposEdad.IdTipoEdad = dbo.Atenciones.IdTipoEdad LEFT OUTER JOIN
		                      dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
		                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
		                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
		                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		where dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin and   (dbo.Atenciones.IdTipoServicio = 3)
		                      and dbo.Atenciones.idEstadoAtencion<>0
		order by dbo.Pacientes.NroHistoriaClinica
	END
ELSE
	BEGIN
		IF @OrdenFiltro = 'FECHAEGRESO'
			BEGIN
				SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
				                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
				                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
				                      dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
				                      dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM,
				                      dbo.TiposEdad.tipoEdadSEM
				FROM         dbo.TiposEdad RIGHT OUTER JOIN
				                      dbo.Atenciones ON dbo.TiposEdad.IdTipoEdad = dbo.Atenciones.IdTipoEdad LEFT OUTER JOIN
				                      dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
				                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
				where dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin and   (dbo.Atenciones.IdTipoServicio = 3)
				                      and dbo.Atenciones.idEstadoAtencion<>0
				order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
			END
		ELSE
			BEGIN
				SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
				                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
				                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
				                      dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
				                      dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM,
				                      dbo.TiposEdad.tipoEdadSEM
				FROM         dbo.TiposEdad RIGHT OUTER JOIN
				                      dbo.Atenciones ON dbo.TiposEdad.IdTipoEdad = dbo.Atenciones.IdTipoEdad LEFT OUTER JOIN
				                      dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
				                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
				where dbo.Atenciones.FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin and   (dbo.Atenciones.IdTipoServicio = 3)
				                      and dbo.Atenciones.idEstadoAtencion<>0
				order by dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospEmergPorFechasDeEgresoMedicoTiposEdad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospEmergPorFechasEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospEmergPorFechasEgresoMedico]
	@ldFechaEgresoIni [datetime],
	@ldFechaEgresoFin [datetime],
	@lcOrdenFiltro [varchar](13)
WITH EXECUTE AS CALLER
AS
IF @lcOrdenFiltro='HC'
            SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                  dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                  dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
                                  dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
                                  dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
                                  dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
                                  dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino
             FROM         dbo.AtencionesDatosAdicionales INNER JOIN
                                  dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                                  dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                                  dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             where dbo.Atenciones.FechaEgreso Between  (CONVERT(DATETIME,@ldFechaEgresoIni,103)) and
                                 (CONVERT(DATETIME,@ldFechaEgresoFin,103))  and   (dbo.Atenciones.IdTipoServicio <>1)
                                 and dbo.Atenciones.idEstadoAtencion<>0
            order by dbo.Pacientes.NroHistoriaClinica
else
IF @lcOrdenFiltro='FECHAEGRESO'
            SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                  dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                  dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
                                  dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
                                  dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
                                  dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
                                  dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino
             FROM         dbo.AtencionesDatosAdicionales INNER JOIN
                                  dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                                  dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                                  dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             where dbo.Atenciones.FechaEgreso Between  (CONVERT(DATETIME,@ldFechaEgresoIni,103)) and
                                 (CONVERT(DATETIME,@ldFechaEgresoFin,103))  and   (dbo.Atenciones.IdTipoServicio <>1)
                                 and dbo.Atenciones.idEstadoAtencion<>0
             order by dbo.Atenciones.fechaEgreso,dbo.Atenciones.horaEgreso
else

            SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                  dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                  dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
                                  dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
                                  dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
                                  dbo.Pacientes.IdDistritoProcedencia, dbo.Pacientes.IdDistritoDomicilio, dbo.Servicios.EsObservacionEmergencia,
                                  dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino
             FROM         dbo.AtencionesDatosAdicionales INNER JOIN
                                  dbo.Atenciones ON dbo.AtencionesDatosAdicionales.idAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                                  dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                                  dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             where dbo.Atenciones.FechaEgreso Between  (CONVERT(DATETIME,@ldFechaEgresoIni,103)) and
                                 (CONVERT(DATETIME,@ldFechaEgresoFin,103))  and   (dbo.Atenciones.IdTipoServicio <>1)
                                 and dbo.Atenciones.idEstadoAtencion<>0
             order by dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospEmergPorFechasEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospitalizadosPorAnioDeIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospitalizadosPorAnioDeIngreso]
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.IdEspecialidad AS CodEspecialidad,
                      dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto, dbo.DepartamentosHospital.Nombre AS dDpto,
                      dbo.Servicios.Codigo AS CodigoServicio, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                      dbo.CentrosPoblados.IdDistrito as IdDistritoP, dbo.Pacientes.IdTipoNumeracion
FROM         dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
                      dbo.CentrosPoblados RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.CentrosPoblados.IdCentroPoblado = dbo.Pacientes.IdCentroPobladoProcedencia ON
                      dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento ON
                      dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
where             Atenciones.IdTipoServicio = 3  and dbo.Atenciones.FechaIngreso is not null and year(dbo.Atenciones.FechaIngreso)=@anio
	       and dbo.Atenciones.idEstadoAtencion<>0
order by         dDpto,CodDpto,dEspecialidad,CodEspecialidad,dServicio,IdServicioEgreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospitalizadosPorAnioDeIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospitalizadosPorFechasDeEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospitalizadosPorFechasDeEgresoMedico]
	@ldFechaEgresoIni [varchar](10),
	@ldFechaEgresoFin [varchar](10),
	@lcFiltro [varchar](2000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3000)

   SET  @SQL =  'SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                            dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                            dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
                                            dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
                                            dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM,
                                            dbo.TiposEdad.tipoEdadSEM
                      FROM         dbo.TiposEdad RIGHT OUTER JOIN
                                            dbo.Atenciones ON dbo.TiposEdad.IdTipoEdad = dbo.Atenciones.IdTipoEdad LEFT OUTER JOIN
                                            dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                                            dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                            dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                                            dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                            dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
                      where dbo.Atenciones.FechaEgreso Between  (CONVERT(DATETIME,'+@ldFechaEgresoIni+',103)) and
                                              (CONVERT(DATETIME,'+@ldFechaEgresoFin+',103))  and   (dbo.Atenciones.IdTipoServicio = 3)
                                            and dbo.Atenciones.idEstadoAtencion<>0     '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospitalizadosPorFechasDeEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarHospPorCuentaPorHistoriaPorApellidosPorServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarHospPorCuentaPorHistoriaPorApellidosPorServicio]
	@lcFiltro [varchar](1500),
	@lcParametro289 [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3500)
if @lcParametro289='1'     /* Sql2000*/
   SET  @SQL =  ' Select  distinct dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno,
                                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica,
                                      dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso,
                                      CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso, CONVERT(char(10),
                                      dbo.Atenciones.FechaEgresoAdministrativo, 103) AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo,
                                      dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion,
                                      dbo.Diagnosticos.CodigoCIE2004 AS DxPrincipal, dbo.TiposAlta.Descripcion AS TipoAlta, dbo.TiposCondicionAlta.Descripcion AS CondicionAlta,
                                      dbo.Atenciones.IdServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,
                                      dbo.FuentesFinanciamiento.Descripcion AS [Plan],dbo.Atenciones.idEstadoAtencion,dbo.atenciones.idMedicoEgreso
                FROM         dbo.Atenciones LEFT OUTER JOIN
                                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
                                      dbo.AtencionesDiagnosticos ON dbo.Atenciones.IdAtencion = dbo.AtencionesDiagnosticos.IdAtencion AND
                                      dbo.AtencionesDiagnosticos.IdClasificacionDx = 3 AND dbo.AtencionesDiagnosticos.IdSubclasificacionDx = 301 LEFT OUTER JOIN
                                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico LEFT OUTER JOIN
                                      dbo.TiposAlta ON dbo.Atenciones.IdTipoAlta = dbo.TiposAlta.IdTipoAlta LEFT OUTER JOIN
                                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta ' +  @lcFiltro
else
    if @lcParametro289='2'     /* Sql2008R2*/
       SET  @SQL =  ' Select  dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno,
                                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica,
                                      dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso,
                                      CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso, CONVERT(char(10),
                                      dbo.Atenciones.FechaEgresoAdministrativo, 103) AS FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo,
                                      dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad, dbo.Pacientes.IdTipoNumeracion,
                                      dbo.Diagnosticos.CodigoCIE2004 AS DxPrincipal, dbo.TiposAlta.Descripcion AS TipoAlta, dbo.TiposCondicionAlta.Descripcion AS CondicionAlta,
                                      dbo.Atenciones.IdServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,
                                      dbo.FuentesFinanciamiento.Descripcion AS [Plan],dbo.Atenciones.idEstadoAtencion
                FROM         dbo.Atenciones LEFT OUTER JOIN
                                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
                                      dbo.AtencionesDiagnosticos ON dbo.Atenciones.IdAtencion = dbo.AtencionesDiagnosticos.IdAtencion AND
                                      dbo.AtencionesDiagnosticos.IdClasificacionDx = 3 AND dbo.AtencionesDiagnosticos.IdSubclasificacionDx = 301 LEFT OUTER JOIN
                                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico LEFT OUTER JOIN
                                      dbo.TiposAlta ON dbo.Atenciones.IdTipoAlta = dbo.TiposAlta.IdTipoAlta LEFT OUTER JOIN
                                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarHospPorCuentaPorHistoriaPorApellidosPorServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarIdAtencionXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarIdAtencionXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select idAtencion from atenciones where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarIdAtencionXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarMedicoEgresoPorCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarMedicoEgresoPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdMedicoIngreso, dbo.Medicos.IdEmpleado, dbo.Atenciones.IdCuentaAtencion, LTRIM(dbo.Empleados.ApellidoPaterno)
                      + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS dMedico,
                      dbo.Medicos.idColegioHIS
FROM         dbo.Empleados INNER JOIN
                      dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoEgreso
             WHERE  dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarMedicoEgresoPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarMedicoPorCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarMedicoPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdMedicoIngreso, dbo.Medicos.IdEmpleado, dbo.Atenciones.IdCuentaAtencion, LTRIM(dbo.Empleados.ApellidoPaterno)
                      + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS dMedico,
                      dbo.Medicos.idColegioHIS ,dbo.Atenciones.IdAtencion
FROM         dbo.Empleados INNER JOIN
                      dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso
             WHERE  dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarMedicoPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarNroHistoriaClinicaNull]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarNroHistoriaClinicaNull]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.NroHistoriaClinica
FROM         dbo.Atenciones LEFT OUTER JOIN
                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
Where (dbo.Pacientes.NroHistoriaClinica Is Null)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarNroHistoriaClinicaNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServPARTIC]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServPARTIC]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)
   SET  @SQL =  'SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
                                   dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                                   dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
                                   AS FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad,
                                   dbo.Pacientes.IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,
                                   dbo.FuentesFinanciamiento.Descripcion AS [Plan], dbo.Atenciones.idEstadoAtencion, dbo.TiposFinanciamiento.GeneraPago
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                   dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                   dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                   dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                   dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServPARTIC] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServSEGUROS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServSEGUROS]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)
   SET  @SQL =  'SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion,
                                  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                                  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.FechaNacimiento AS FecNacim, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
                                  AS FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Servicios.Nombre AS ServicioActual, dbo.Atenciones.Edad AS Edad,
                                  dbo.Pacientes.IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,
                                  dbo.FuentesFinanciamiento.Descripcion AS [Plan], dbo.Atenciones.idEstadoAtencion, dbo.TiposFinanciamiento.GeneraPago
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPacExtPorCuentaHistoriaApellidosServSEGUROS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPacExtPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPacExtPorFechas]
	@ldFechaIni [datetime],
	@ldFechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                          dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
                          dbo.EstadosCuenta.Descripcion AS EstadoPlan, dbo.Servicios.Nombre AS UltimoServicio, CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103)
                          AS FechaIngreso, dbo.Atenciones.HoraIngreso,
                          dbo.Pacientes.FechaNacimiento AS FecNacim, dbo.Atenciones.Edad AS Edad
             FROM         dbo.Atenciones INNER JOIN
                          dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                          dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                          dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                          dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                          dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             WHERE         dbo.atenciones.EsPacienteExterno=1 and dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@ldFechaIni,103)) and (CONVERT(DATETIME,@ldFechaFin,103))
                  order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPacExtPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorAnioDeEgresoAdministrativo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorAnioDeEgresoAdministrativo]
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.IdEspecialidad AS CodEspecialidad,
                      dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto, dbo.DepartamentosHospital.Nombre AS dDpto,
                      dbo.Servicios.Codigo AS CodigoServicio, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                      dbo.CentrosPoblados.IdDistrito AS IdDistritoP
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
where            Atenciones.IdTipoServicio = 3  and dbo.Atenciones.FechaEgresoAdministrativo is not null and  year(dbo.Atenciones.FechaEgresoAdministrativo)=@anio and IdServicioEgreso>0
	       and Atenciones.idEstadoAtencion<>0
order by         dDpto,CodDpto,dEspecialidad,CodEspecialidad,dServicio,IdServicioEgreso,dbo.Atenciones.FechaEgresoAdministrativo
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorAnioDeEgresoAdministrativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorAnioDeEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorAnioDeEgresoMedico]
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.IdEspecialidad AS CodEspecialidad,
                      dbo.Especialidades.Nombre AS dEspecialidad, dbo.Especialidades.IdDepartamento AS CodDpto, dbo.DepartamentosHospital.Nombre AS dDpto,
                      dbo.Servicios.Codigo AS CodigoServicio, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                    dbo.CentrosPoblados.IdDistrito AS IdDistritoP
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
where             Atenciones.IdTipoServicio = 3  and dbo.Atenciones.FechaEgreso is not null and year(dbo.Atenciones.FechaEgreso)=@anio
	        and .Atenciones.idEstadoAtencion<>0
order by         dDpto,CodDpto,dEspecialidad,CodEspecialidad,dServicio,IdServicioEgreso,dbo.Atenciones.FechaEgreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorAnioDeEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaEgresoMedico]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@IdFuenteFinanciamiento [int],
	@SoloConsultaExterna [int]
WITH EXECUTE AS CALLER
AS
If @SoloConsultaExterna = 1

	SELECT       dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
                                  dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
                                  dbo.TiposFinanciamiento.GeneraPago
             FROM           dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE       dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1 and  ( dbo.Atenciones.fechaIngreso BETWEEN @FechaInicio and  @FechaFin)

Else

	SELECT       dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
                                  dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
                                  dbo.TiposFinanciamiento.GeneraPago
             FROM           dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE       dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio<>1 and  ( dbo.Atenciones.fechaEgreso  BETWEEN @FechaInicio and  @FechaFin)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYfuenteFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYfuenteFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
                      dbo.TiposFinanciamiento.GeneraPago, dbo.TiposFinanciamiento.Descripcion AS DtipoFinanciamiento,
                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     ( dbo.Atenciones.fechaEgreso BETWEEN  @FechaInicio and  @FechaFin) and dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYfuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYtipofinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYtipofinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Atenciones.IdFormaPago, dbo.Atenciones.FechaEgreso, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.idEstadoAtencion
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     ( dbo.Atenciones.fechaEgreso BETWEEN  @FechaInicio and  @FechaFin) and dbo.Atenciones.IdFormaPago=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaEgresoMedicoYtipofinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoSinAlta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoSinAlta]
	@FechaIni [datetime],
	@FechaFin [datetime],
	@IdFuenteFinanciamiento [int],
	@SoloConsultaExterna [int]
WITH EXECUTE AS CALLER
AS
If @SoloConsultaExterna = 1
	BEGIN
                           If @IdFuenteFinanciamiento > 0
			SELECT        dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
				                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
				                      dbo.TiposFinanciamiento.GeneraPago
			              FROM           dbo.Atenciones LEFT OUTER JOIN
				                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
			WHERE       (dbo.Atenciones.fechaEgreso is null) and dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1 and
	                                               ( dbo.Atenciones.fechaIngreso BETWEEN @FechaIni and @FechaFin) and dbo.Atenciones.idFuenteFinanciamiento=@IdFuenteFinanciamiento
                           else
			SELECT        dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
				                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
				                      dbo.TiposFinanciamiento.GeneraPago
			              FROM           dbo.Atenciones LEFT OUTER JOIN
				                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
			WHERE       (dbo.Atenciones.fechaEgreso is null) and dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1 and
	                                               ( dbo.Atenciones.fechaIngreso BETWEEN @FechaIni and @FechaFin)

	END
Else IF @SoloConsultaExterna = 2
	BEGIN
                           If @IdFuenteFinanciamiento > 0
			SELECT        dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
				                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
				                      dbo.TiposFinanciamiento.GeneraPago
			              FROM           dbo.Atenciones LEFT OUTER JOIN
				                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
			WHERE       (dbo.Atenciones.fechaEgreso is null) and dbo.Atenciones.idEstadoAtencion<>0 and  dbo.Atenciones.idTipoServicio<>1 and
	                                               ( dbo.Atenciones.fechaIngreso BETWEEN @FechaIni and @FechaFin)  and dbo.Atenciones.idFuenteFinanciamiento=@IdFuenteFinanciamiento
                          else
			SELECT        dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
				                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
				                      dbo.TiposFinanciamiento.GeneraPago
			              FROM           dbo.Atenciones LEFT OUTER JOIN
				                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
				                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
				                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
			WHERE       (dbo.Atenciones.fechaEgreso is null) and dbo.Atenciones.idEstadoAtencion<>0 and  dbo.Atenciones.idTipoServicio<>1 and
	                                               ( dbo.Atenciones.fechaIngreso BETWEEN @FechaIni and @FechaFin)

	END
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoSinAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoYfuenteFinanciamientoSinAlta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoYfuenteFinanciamientoSinAlta]
	@ldFechaIni [datetime],
	@ldFechaFin [datetime],
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
                                  dbo.TiposFinanciamiento.GeneraPago, dbo.TiposFinanciamiento.Descripcion AS DtipoFinanciamiento,
                                  dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento
             FROM          dbo.Atenciones LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             WHERE       dbo.Atenciones.fechaIngreso BETWEEN  @ldFechaIni and  @ldFechaFin and dbo.Atenciones.idFuenteFinanciamiento=@IdFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaIngresoMedicoYfuenteFinanciamientoSinAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaIngresoYespecialidadDelServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaIngresoYespecialidadDelServicio]
	@IdEspecialidad [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.IdTipoSexo, dbo.TiposOrigenAtencion.Descripcion AS Motivo,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.TiposDestinoAtencion.Descripcion AS Destino,
                      dbo.AtencionesDatosAdicionales.NombreAcompaniante, dbo.Servicios.IdEspecialidad, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Empleados.ApellidoPaterno AS Mpaterno, dbo.Empleados.ApellidoMaterno AS Mmaterno, dbo.Empleados.Nombres AS Mnombres,
                      dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdServicioIngreso, dbo.Servicios.Nombre AS dservicio, dbo.Atenciones.IdTipoEdad,
                      dbo.Atenciones.FechaEgresoAdministrativo, dbo.Atenciones.HoraEgresoAdministrativo
FROM         dbo.Servicios RIGHT OUTER JOIN
                      dbo.TiposDestinoAtencion RIGHT OUTER JOIN
                      dbo.Atenciones LEFT OUTER JOIN
                      dbo.Medicos ON dbo.Atenciones.IdMedicoEgreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                      dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado ON
                      dbo.TiposDestinoAtencion.IdDestinoAtencion = dbo.Atenciones.IdDestinoAtencion LEFT OUTER JOIN
                      dbo.TiposOrigenAtencion ON dbo.Atenciones.IdOrigenAtencion = dbo.TiposOrigenAtencion.IdOrigenAtencion ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente FULL OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
WHERE     (dbo.Servicios.IdEspecialidad = @IdEspecialidad) AND (dbo.Atenciones.idEstadoAtencion = 1) and
	     (dbo.Atenciones.FechaIngreso Between  @FechaInicio and  @FechaFin)
ORDER BY dbo.Atenciones.IdCuentaAtencion DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaIngresoYespecialidadDelServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechaIngresoYfuenteFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechaIngresoYfuenteFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
                      dbo.TiposFinanciamiento.Descripcion AS DtipoFinanciamiento, dbo.TiposFinanciamiento.GeneraPago,
                      dbo.FuentesFinanciamiento.Descripcion AS DfuenteFinanciamiento
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     ( dbo.Atenciones.fechaIngreso BETWEEN  @FechaInicio and  @FechaFin) and dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechaIngresoYfuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechasDeEgresoAdministrativo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechasDeEgresoAdministrativo]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE dbo.Atenciones.FechaEgresoAdministrativo Between  (@FechaEgresoIni) and  (@FechaEgresoFin)
       and   (dbo.Atenciones.IdTipoServicio = 3) and dbo.Atenciones.idEstadoAtencion<>0
ORDER BY dbo.Atenciones.FechaEgresoAdministrativo,dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechasDeEgresoAdministrativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicio]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
	                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
	                      dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
	                      dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
	                      dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
	                      dbo.Servicios.codigoServicioHIS, dbo.Empleados.IdEmpleado, dbo.TiposEmpleado.TipoEmpleadoHIS, dbo.Empleados.CodigoPlanilla,
	                      dbo.Distritos.IdDistrito
	FROM         dbo.Distritos RIGHT OUTER JOIN
	                      dbo.Pacientes ON dbo.Distritos.IdDistrito = dbo.Pacientes.IdDistritoDomicilio RIGHT OUTER JOIN
	                      dbo.Servicios RIGHT OUTER JOIN
	                      dbo.Empleados INNER JOIN
	                      dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
	                      dbo.TiposEmpleado ON dbo.Empleados.IdTipoEmpleado = dbo.TiposEmpleado.IdTipoEmpleado RIGHT OUTER JOIN
	                      dbo.Atenciones ON dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso ON
	                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta ON
	                      dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
	where  (dbo.Atenciones.FechaIngreso Between  @FechaEgrIni and  @FechaEgrFin)  and   (dbo.Atenciones.IdTipoServicio = @idTipoServicio)
                        and dbo.Atenciones.idEstadoAtencion<>0
             order by dbo.Atenciones.FechaIngreso,dbo.Atenciones.HoraIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicioOconexion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicioOconexion]
	@lcMes [int],
	@lcAnio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                  dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.SegundoNombre AS SegundoNombre, dbo.Pacientes.TercerNombre AS TercerNombre,
                                  dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ,
                                  dbo.Pacientes.IdTipoSexo, dbo.Servicios.codigoServicioSEM, dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
                                  dbo.FuentesFinanciamiento.CodigoFuenteFinanciamientoSEM, dbo.Medicos.Colegiatura, dbo.Servicios.ubicacionSEM, dbo.TiposEdad.tipoEdadSEM,
                                  dbo.Servicios.codigoServicioHIS, dbo.Empleados.IdEmpleado, dbo.TiposEmpleado.TipoEmpleadoHIS, dbo.Empleados.CodigoPlanilla,
                                  dbo.Distritos.IdDistrito, dbo.Medicos.LoteHIS, dbo.TiposEdad.Codigo AS EdadCodigo,
                                  dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS dEmpleado, dbo.Medicos.idColegioHIS,
                                  dbo.Empleados.DNI, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdEtnia, dbo.FuentesFinanciamiento.CodigoHIS AS HISfuenteFinanciamiento,
                                  dbo.Pacientes.IdPaisProcedencia, dbo.TiposDocIdentidad.CodigoHIS AS HIStipoDocumento,dbo.Pacientes.FichaFamiliar,dbo.empleados.idTipoDocumento,
                                dbo.Pacientes.fechaNacimiento
             FROM         dbo.Pacientes LEFT OUTER JOIN
                                  dbo.TiposDocIdentidad ON dbo.Pacientes.IdDocIdentidad = dbo.TiposDocIdentidad.IdDocIdentidad LEFT OUTER JOIN
                                  dbo.Distritos ON dbo.Pacientes.IdDistritoDomicilio = dbo.Distritos.IdDistrito RIGHT OUTER JOIN
                                  dbo.Empleados INNER JOIN
                                  dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
                                  dbo.TiposEmpleado ON dbo.Empleados.IdTipoEmpleado = dbo.TiposEmpleado.IdTipoEmpleado RIGHT OUTER JOIN
                                  dbo.Servicios RIGHT OUTER JOIN
                                  dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso ON
                                  dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso LEFT OUTER JOIN
                                  dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                                  dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta ON
                                  dbo.Pacientes.idPaciente = dbo.Atenciones.idPaciente
          where  month(dbo.Atenciones.FechaIngreso)=@lcMes and year(dbo.Atenciones.FechaIngreso)=@lcAnio  and   (dbo.Atenciones.IdTipoServicio = 1)
                                   and dbo.Atenciones.idEstadoAtencion<>0
order by dbo.Empleados.IdEmpleado,dbo.Atenciones.FechaIngreso,dbo.Atenciones.HoraIngreso,dbo.Servicios.codigoServicioHIS
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFechasDeIngresoYtipoServicioOconexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFAltaMedica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFAltaMedica]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int],
	@idEstadoCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.FacturacionCuentasAtencion.IdEstado AS DestadoCta
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
            WHERE       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and  dbo.FacturacionCuentasAtencion.IdEstado=@idEstadoCuenta and
		      dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaEgreso Between @FechaInicio and @FechaFin and
			dbo.Atenciones.idTipoServicio>1
GO
ALTER AUTHORIZATION ON [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFAltaMedica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFingreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFingreso]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int],
	@idEstadoCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.FacturacionCuentasAtencion.IdEstado AS DestadoCta
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
            WHERE       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and  dbo.FacturacionCuentasAtencion.IdEstado=@idEstadoCuenta and
		      dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaIngreso Between @FechaInicio and @FechaFin and
		       dbo.Atenciones.idTipoServicio=1
GO
ALTER AUTHORIZATION ON [dbo].[atencionesSeleccionarPorFuenteFinanciamientoFingreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta]
	@ldFechaIni [datetime],
	@ldFechaFin [datetime],
	@IdFuenteFinanciamiento [int],
	@idEstadoCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT           dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                                      dbo.FacturacionCuentasAtencion.IdEstado AS DestadoCta
                FROM            dbo.Atenciones INNER JOIN
                                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
              WHERE          dbo.Atenciones.idFuenteFinanciamiento=@IdFuenteFinanciamiento and  dbo.FacturacionCuentasAtencion.IdEstado=@idEstadoCuenta and
                                      dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaIngreso Between  @ldFechaIni  and @ldFechaFin and
                                      dbo.Atenciones.idTipoServicio>1
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorId]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from Atenciones
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.*, dbo.FuentesFinanciamiento.Descripcion,dbo.Pacientes.NroDocumento,
                    dbo.Pacientes.idDocIdentidad,dbo.Pacientes.Email, dbo.Pacientes.FechaNacimiento,dbo.Pacientes.idTipoSexo,
                    dbo.Pacientes.telefono,dbo.Pacientes.idDistritoDomicilio
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
where   dbo.Atenciones.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesAtencionesdatosadicionalesPacientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesAtencionesdatosadicionalesPacientes]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.*, dbo.AtencionesDatosAdicionales.*, dbo.FacturacionCuentasAtencion.*,
                  dbo.Pacientes.observacion as obs_pacientes, dbo.AtencionesDatosAdicionales.observacion as obs_AtencionesDatosAdicionales
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
where    dbo.Atenciones.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesAtencionesdatosadicionalesPacientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesCitasAtencionesdatosadicionalesPacientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesCitasAtencionesdatosadicionalesPacientes]
	@idCita [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.*, dbo.Citas.*, dbo.AtencionesDatosAdicionales.*, dbo.FacturacionCuentasAtencion.*,
                  dbo.Pacientes.observacion as obs_pacientes, dbo.AtencionesDatosAdicionales.observacion as obs_AtencionesDatosAdicionales

FROM         dbo.Citas RIGHT OUTER JOIN
                      dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion ON
                      dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion
where   dbo.Citas.idCita=@idCita
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdAtencionEnAtencionesCitasAtencionesdatosadicionalesPacientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdAtencionTipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdAtencionTipoServicio]
	@idAtencion [int],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=1
	SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.*, dbo.FuentesFinanciamiento.Descripcion, dbo.Servicios.Nombre AS DSERVICIO
	FROM         dbo.Atenciones LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	where   dbo.Atenciones.idAtencion=@idAtencion
else
	SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.*, dbo.FuentesFinanciamiento.Descripcion, dbo.Servicios.Nombre AS DSERVICIO
	FROM         dbo.Atenciones LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	where   dbo.Atenciones.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdAtencionTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesSeleccionarPorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesSeleccionarPorIdCuentaAtencion]
	@lnIdCuentaAtencion [int],
	@mda_FechaInicio [datetime],
	@mda_FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idCuentaAtencion=@lnIdCuentaAtencion
            and idFormaPago=1 and fechaEgreso>=CONVERT(DATETIME,@mda_FechaInicio,103)
            and fechaEgreso<=CONVERT(DATETIME,@mda_FechaFin,103)
GO
ALTER AUTHORIZATION ON [dbo].[atencionesSeleccionarPorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdFuenteFinanciamiento]
	@lnIdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select idAtencion from atenciones where idFuenteFinanciamiento=@lnIdFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorIdPaciente]
	@idPaciente [int],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=1 or @idTipoServicio=3
	SELECT     dbo.Atenciones.*, dbo.FacturacionCuentasAtencion.IdEstado, dbo.FuentesFinanciamiento.Descripcion AS dPlan
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE dbo.Atenciones.idPaciente=@idPaciente and dbo.Atenciones.idTipoServicio=@idTipoServicio and dbo.Atenciones.idEstadoAtencion <>0
	order by dbo.Atenciones.fechaIngreso,dbo.Atenciones.horaIngreso
else
	SELECT     dbo.Atenciones.*, dbo.FacturacionCuentasAtencion.IdEstado, dbo.FuentesFinanciamiento.Descripcion AS dPlan
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE dbo.Atenciones.idPaciente=@idPaciente and dbo.Atenciones.idTipoServicio in (2,4)  and dbo.Atenciones.idEstadoAtencion <>0
	order by dbo.Atenciones.fechaIngreso,dbo.Atenciones.horaIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorMedicoIngresoYfechasIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorMedicoIngresoYfechasIngreso]
	@idMedicoIngreso [int],
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServ
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
where (dbo.Atenciones.FechaIngreso Between  @FechaIni and  @FechaFin) and dbo.Atenciones.idMedicoIngreso=@idMedicoIngreso
	and dbo.Atenciones.idEstadoAtencion<>0
order  by dbo.Atenciones.idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorMedicoIngresoYfechasIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarPorTipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarPorTipoServicio]
	@idTipoServicio [int],
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=1
	SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosCuenta.Descripcion AS EstadoPlan, dbo.Servicios.Nombre AS UltimoServicio, dbo.TiposFinanciamiento.Descripcion AS T_Financiamiento,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10),
	                      dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Pacientes.FechaNacimiento AS FecNacim,
	                      dbo.Atenciones.Edad AS Edad
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             WHERE   dbo.Atenciones.idTipoServicio=@idTipoServicio and  (dbo.Atenciones.FechaIngreso Between  @FechaIni and  @FechaFin) and EsPacienteExterno<>1
	ORDER BY  dbo.Atenciones.IdCuentaAtencion DESC
else
   if  @idTipoServicio  =2
	SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosCuenta.Descripcion AS EstadoPlan, dbo.Servicios.Nombre AS UltimoServicio, dbo.TiposFinanciamiento.Descripcion AS T_Financiamiento,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10),
	                      dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Pacientes.FechaNacimiento AS FecNacim,
	                      dbo.Atenciones.Edad AS Edad
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE   dbo.Atenciones.idTipoServicio in (2,4) and  (dbo.Atenciones.FechaIngreso Between  @FechaIni and  @FechaFin) and EsPacienteExterno<>1
	ORDER BY  dbo.Atenciones.IdCuentaAtencion DESC
   else
	SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosCuenta.Descripcion AS EstadoPlan, dbo.Servicios.Nombre AS UltimoServicio, dbo.TiposFinanciamiento.Descripcion AS T_Financiamiento,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, dbo.Atenciones.HoraIngreso, CONVERT(char(10),
	                      dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Pacientes.FechaNacimiento AS FecNacim,
	                      dbo.Atenciones.Edad AS Edad
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
            WHERE   dbo.Atenciones.idTipoServicio=@idTipoServicio and  (dbo.Atenciones.FechaIngreso Between  @FechaIni and  @FechaFin) and EsPacienteExterno<>1
	ORDER BY  dbo.Atenciones.IdCuentaAtencion DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarPorTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarServicioEgresoXCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarServicioEgresoXCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Servicios.Nombre  as ServicioE,
            LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS Paciente,
           dbo.Pacientes.NroHistoriaClinica
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
where dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idcuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarServicioEgresoXCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarSoloNULLenEpisodiosDetalle]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarSoloNULLenEpisodiosDetalle]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.AtencionesEpisodiosDetalle.idAtencion AS idAtencionEC,dbo.Atenciones.fechaIngreso,dbo.Atenciones.fechaEgreso,dbo.Atenciones.IdTipoServicio,dbo.Atenciones.idPaciente
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.AtencionesEpisodiosDetalle ON dbo.Atenciones.IdAtencion = dbo.AtencionesEpisodiosDetalle.idAtencion
WHERE     (dbo.AtencionesEpisodiosDetalle.idAtencion IS NULL) and not (dbo.Atenciones.fechaEgreso is null)
order by     dbo.Atenciones.fechaIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarSoloNULLenEpisodiosDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarTSyFFporCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarTSyFFporCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.TiposServicio.Descripcion AS TiposServicio, dbo.FuentesFinanciamiento.Descripcion AS FuenteFinanciamiento
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
where dbo.Atenciones.IdCuentaAtencion = @idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarTSyFFporCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarXanio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarXanio]
	@lnAnio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, RTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + RTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + RTRIM(dbo.Pacientes.PrimerNombre)
                      AS Paciente, dbo.Pacientes.NroHistoriaClinica AS historia, dbo.Especialidades.Nombre AS especialidad
FROM         dbo.Servicios INNER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad INNER JOIN
                      dbo.Atenciones INNER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso
where dbo.Atenciones.idTipoServicio<=3 and dbo.Atenciones.idEstadoAtencion<>0 and year(dbo.Atenciones.fechaIngreso)=@lnAnio
order by dbo.Atenciones.idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarXanio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarXanioIngreso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarXanioIngreso]
	@anio [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Atenciones.*, dbo.TiposServicio.Descripcion AS TipoServicio, dbo.DepartamentosHospital.Nombre AS Dpto
FROM         dbo.Especialidades INNER JOIN
                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
                      dbo.Atenciones INNER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso
where  year(dbo.Atenciones.fechaIngreso)=@anio and dbo.Atenciones.idEstadoAtencion<>0
ORDER BY dbo.Atenciones.IdPaciente, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarXanioIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarXfechaEgresoMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarXfechaEgresoMedico]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
if @idFuenteFinanciamiento=0
  select * from atenciones where idestadoatencion<>0 and FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin
else
   select * from atenciones where idestadoatencion<>0 and  idFuenteFinanciamiento=@idFuenteFinanciamiento and
                                                    FechaEgreso Between @FechaEgresoIni and @FechaEgresoFin
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarXfechaEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesSeleccionarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[atencionesSeleccionarXIdCuentaAtencion]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idCuentaAtencion=@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[atencionesSeleccionarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarXidentificador]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                                  dbo.Pacientes.NroHistoriaClinica
             FROM           dbo.Atenciones LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
             where           dbo.Atenciones.idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionarXidProgramacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionarXidProgramacion]
	@idProgramacion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Atenciones.idEstadoAtencion, dbo.Citas.IdProgramacion, dbo.Citas.HoraInicio,
                      dbo.Citas.HoraFin
FROM         dbo.Atenciones INNER JOIN
                      dbo.Citas ON dbo.Atenciones.IdAtencion = dbo.Citas.IdAtencion
WHERE     (dbo.Citas.IdProgramacion = @idProgramacion) and dbo.Atenciones.idEstadoAtencion<>0
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionarXidProgramacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesSeleccionarXtipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesSeleccionarXtipoFinanciamiento]
	@lnIdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idFormaPago=@lnIdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[atencionesSeleccionarXtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSeleccionaSoloSISxFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSeleccionaSoloSISxFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS TipoServicio, dbo.Servicios.Nombre AS Servicio, dbo.Atenciones.FechaIngreso,
                      dbo.Atenciones.FechaEgreso , dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdFormaPago,dbo.Atenciones.IdTipoServicio
 FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
 Where (dbo.Atenciones.IdFormaPago = 2) And (dbo.Atenciones.idEstadoAtencion <> 0)
       and dbo.Atenciones.fechaIngreso Between @FechaInicio and @FechaFin
 ORDER BY dbo.Atenciones.IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSeleccionaSoloSISxFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSelecionarPorCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSelecionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.Atenciones.FechaIngreso, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago, dbo.Pacientes.ApellidoPaterno,
                         dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.SegundoNombre, dbo.Pacientes.IdTipoSexo,
                         dbo.Pacientes.FechaNacimiento, dbo.Pacientes.IdDocIdentidad, dbo.Pacientes.NroDocumento, dbo.Atenciones.IdPaciente, dbo.TiposFinanciamiento.tipoVenta,
                         dbo.Atenciones.FechaEgreso, dbo.FacturacionCuentasAtencion.IdEstado, dbo.EstadosCuenta.Descripcion AS estadoCta, dbo.Atenciones.idFuenteFinanciamiento,
                         dbo.Atenciones.IdServicioIngreso, dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdAtencion,
                         dbo.Atenciones.IdCamaEgreso, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno,
                         dbo.TiposFinanciamiento.Descripcion AS dTipoFinanciamiento, dbo.FuentesFinanciamiento.idAreaTramitaSeguros, dbo.Atenciones.Edad, dbo.Atenciones.IdTipoEdad,
                         dbo.TiposEdad.Descripcion AS tedad, dbo.Atenciones.IdMedicoIngreso, dbo.Atenciones.IdMedicoEgreso, dbo.Medicos.IdEmpleado, dbo.Atenciones.HoraIngreso,
                         dbo.Atenciones.IdDestinoAtencion, dbo.AtencionesDatosAdicionales.IdTipoReferenciaOrigen, dbo.AtencionesDatosAdicionales.NroReferenciaDestino,
                         dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen, dbo.AtencionesDatosAdicionales.IdEstablecimientoDestino,
                         dbo.AtencionesDatosAdicionales.NroReferenciaOrigen, dbo.AtencionesDatosAdicionales.IdTipoReferenciaDestino,
                         dbo.AtencionesDatosAdicionales.IdEstablecimientoNoMinsaOrigen, dbo.AtencionesDatosAdicionales.IdEstablecimientoNoMinsaDestino,
                         dbo.Servicios.IdEspecialidad, dbo.Atenciones.HoraEgreso, dbo.Pacientes.IdEtnia, dbo.Atenciones.IdServicioEgreso, dbo.Atenciones.IdOrigenAtencion,dbo.Atenciones.EpsPorcentaje,
                         dbo.Servicios.Nombre as Consultorio
FROM            dbo.Atenciones INNER JOIN
                         dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                         dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                         dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                         dbo.Medicos ON dbo.Atenciones.IdMedicoIngreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                         dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad LEFT OUTER JOIN
                         dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                         dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                         dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                         dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                         dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE        (dbo.Atenciones.IdCuentaAtencion = @idCuentaAtencion)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSelecionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSinAdmHospitalizacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSinAdmHospitalizacion]
	@ProvieneDeEmergencia [int]
WITH EXECUTE AS CALLER
AS
if @ProvieneDeEmergencia=2
	SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Servicios.Nombre AS ServicioEgreso, dbo.Atenciones.IdAtencion,
                      dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdFormaPago,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.Pacientes.IdTipoNumeracion, dbo.AtencionesDatosAdicionales.idServicioDestino
     FROM         dbo.Atenciones INNER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion
	WHERE     (NOT (dbo.Atenciones.FechaEgreso IS NULL)) AND (dbo.Atenciones.IdDestinoAtencion = 21) AND (NOT
	                          ((SELECT     TOP 1 ult.idatencion
	                              FROM         atenciones ult
	                              WHERE     ult.idTipoServicio = 3   and ult.idEstadoAtencion<>0 AND ult.idPaciente = dbo.atenciones.idPaciente
	                              ORDER BY ult.idatencion DESC) > dbo.Atenciones.IdAtencion)
                                      or
                                   (SELECT     TOP 1 ult.idatencion
	                              FROM         atenciones ult
	                              WHERE     ult.idTipoServicio = 3   and ult.idEstadoAtencion<>0 AND ult.idPaciente = dbo.atenciones.idPaciente
	                              ORDER BY ult.idatencion DESC) is null
                                   )
                  AND (dbo.Atenciones.idEstadoAtencion <>0) and datediff(day,dbo.Atenciones.fechaEgreso,getdate())<=2
	ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
else
   SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Servicios.Nombre AS Consultorio, dbo.Atenciones.IdAtencion,
                      dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdFormaPago,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.Pacientes.IdTipoNumeracion, dbo.AtencionesDatosAdicionales.idServicioDestino
   FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
   WHERE     (NOT (dbo.Atenciones.FechaEgreso IS NULL)) AND (dbo.Atenciones.IdDestinoAtencion = 11) AND (
	                          (not(SELECT     TOP 1 ult.idatencion
	                              FROM         atenciones ult
	                              WHERE     ult.idTipoServicio = 3  and ult.idEstadoAtencion<>0 AND ult.idPaciente = dbo.atenciones.idPaciente
	                              ORDER BY ult.idatencion DESC) > dbo.Atenciones.IdAtencion)
                                           or
                                           (SELECT     TOP 1 ult.idatencion
	                              FROM         atenciones ult
	                              WHERE     ult.idTipoServicio = 3  and ult.idEstadoAtencion<>0 AND ult.idPaciente = dbo.atenciones.idPaciente
	                              ORDER BY ult.idatencion DESC) is null ) AND (dbo.Atenciones.idEstadoAtencion <>0)
	ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSinAdmHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSisPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesSisPorFechas]
	@lcFechaInicio [datetime],
	@lcFechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                                  dbo.Pacientes.NroHistoriaClinica, dbo.TiposServicio.Descripcion AS TipoServicio, dbo.Servicios.Nombre AS Servicio, dbo.Atenciones.FechaIngreso,
                                  dbo.Atenciones.FechaEgreso , dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdFormaPago,dbo.Atenciones.IdTipoServicio
             FROM         dbo.Pacientes RIGHT OUTER JOIN
                                  dbo.Servicios RIGHT OUTER JOIN
                                  dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio ON
                                  dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
             Where (dbo.Atenciones.IdFormaPago = 2) And (dbo.Atenciones.idEstadoAtencion <> 0)
                   and dbo.Atenciones.fechaIngreso>=CONVERT(DATETIME, @lcFechaInicio,103) and dbo.Atenciones.fechaIngreso<=CONVERT(DATETIME,@lcFechaFinal,103)
             ORDER BY dbo.Atenciones.IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSisPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesSoloCEconFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesSoloCEconFuenteFinanciamiento]
	@FechaIni [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
if @idFuenteFinanciamiento=0
SELECT     dbo.Atenciones.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion, dbo.Servicios.IdEspecialidad,
                      dbo.Atenciones.IdTipoServicio, dbo.Atenciones.idEstadoAtencion,dbo.Atenciones.idFormaPago,
             dbo.Atenciones.idCuentaAtencion,dbo.Atenciones.FechaEgreso,dbo.Atenciones.IdMedicoIngreso
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE     (dbo.Atenciones.IdTipoServicio = 1) AND (dbo.Atenciones.idEstadoAtencion <>0) and
           dbo.Atenciones.fechaIngreso Between @FechaIni and @FechaFin
ORDER BY dbo.Atenciones.idFuenteFinanciamiento, dbo.Servicios.IdEspecialidad
else
SELECT      dbo.Atenciones.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion, dbo.Servicios.IdEspecialidad,
                      dbo.Atenciones.IdTipoServicio, dbo.Atenciones.idEstadoAtencion,dbo.Atenciones.idFormaPago,
             dbo.Atenciones.idCuentaAtencion,dbo.Atenciones.FechaEgreso,dbo.Atenciones.IdMedicoIngreso
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE     (dbo.Atenciones.IdTipoServicio = 1) AND (dbo.Atenciones.idEstadoAtencion<>0) and
          (dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento) and
           dbo.Atenciones.fechaIngreso Between @FechaIni and @FechaFin
ORDER BY dbo.Atenciones.idFuenteFinanciamiento, dbo.Servicios.IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesSoloCEconFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesTFinanciamientoXidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesTFinanciamientoXidAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.Atenciones.IdCuentaAtencion, dbo.TiposFinanciamiento.Descripcion
            FROM   dbo.Atenciones LEFT OUTER JOIN dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
           where dbo.Atenciones.idAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesTFinanciamientoXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesTiempoAtencionCE]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesTiempoAtencionCE]
	@Anio [int],
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
if @Anio>0
	SELECT     dbo.Servicios.Nombre AS consultorio, dbo.Especialidades.Nombre AS especialidad, dbo.DepartamentosHospital.Nombre AS dpto,
						  dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdAtencion, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso,
						  dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Atenciones.IdPaciente, dbo.HistoriasClinicas.FechaCreacion,
						  dbo.TiposIdiomas.Lengua, dbo.HIS_tabetnia.etnias
	FROM         dbo.Especialidades INNER JOIN
						  dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
						  dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
						  dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso INNER JOIN
						  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente LEFT OUTER JOIN
						  dbo.HIS_tabetnia ON dbo.Pacientes.IdEtnia = dbo.HIS_tabetnia.codetni LEFT OUTER JOIN
						  dbo.TiposIdiomas ON dbo.Pacientes.IdIdioma = dbo.TiposIdiomas.IdIdioma
	WHERE dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1 and year(dbo.Atenciones.fechaIngreso)=@Anio
	ORDER BY month(dbo.Atenciones.FechaIngreso), day(dbo.Atenciones.FechaIngreso), dbo.Servicios.Nombre, dbo.Atenciones.HoraEgreso
else
	SELECT     dbo.Servicios.Nombre AS consultorio, dbo.Especialidades.Nombre AS especialidad, dbo.DepartamentosHospital.Nombre AS dpto,
						  dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.IdAtencion, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso,
						  dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.Atenciones.IdPaciente, dbo.HistoriasClinicas.FechaCreacion,
						  dbo.TiposIdiomas.Lengua, dbo.HIS_tabetnia.etnias
	FROM         dbo.Especialidades INNER JOIN
						  dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad INNER JOIN
						  dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento INNER JOIN
						  dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso INNER JOIN
						  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente LEFT OUTER JOIN
						  dbo.HIS_tabetnia ON dbo.Pacientes.IdEtnia = dbo.HIS_tabetnia.codetni LEFT OUTER JOIN
						  dbo.TiposIdiomas ON dbo.Pacientes.IdIdioma = dbo.TiposIdiomas.IdIdioma
	WHERE dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1 and
	      (dbo.Atenciones.fechaIngreso Between @FechaEgresoIni and @FechaEgresoFin)
	ORDER BY month(dbo.Atenciones.FechaIngreso), day(dbo.Atenciones.FechaIngreso), dbo.Servicios.Nombre, dbo.Atenciones.HoraEgreso

GO
ALTER AUTHORIZATION ON [dbo].[AtencionesTiempoAtencionCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesUsuarioPC]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesUsuarioPC]
	@Atencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.Usuario, dbo.Auditoria.nombrePc, dbo.Auditoria.IdRegistro
FROM         dbo.Auditoria INNER JOIN
                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE     (dbo.Auditoria.idListItem = 102) AND (dbo.Auditoria.Accion = 'A') AND (dbo.Auditoria.IdRegistro = @Atencion)
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesUsuarioPC] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesXidAtencionCondicionAlta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesXidAtencionCondicionAlta]
	@ml_dCondicionAlta [varchar](100),
	@ml_idAtencion [int]
WITH EXECUTE AS CALLER
AS
If @ml_dCondicionAlta = ''
         SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio,
                                        dbo.Atenciones.IdFuenteFinanciamiento , dbo.FuentesFinanciamiento.Descripcion,dbo.Atenciones.EpsPorcentaje
                  FROM         dbo.Atenciones LEFT OUTER JOIN
                                        dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
                   where       dbo.Atenciones.IdAtencion=@ml_idAtencion
    Else
         SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio,
                        dbo.Atenciones.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion, dbo.TiposCondicionAlta.Descripcion AS dCondicionAlta,
                        dbo.Atenciones.EpsPorcentaje
                  FROM         dbo.Atenciones LEFT OUTER JOIN
                        dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                        dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
                  where       dbo.Atenciones.IdAtencion=@ml_idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesXidAtencionCondicionAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select idAtencion from atenciones where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[atencionesXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesXidPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtencionesXidPaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
sELECT    dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.TiposServicio.Descripcion AS TipoServicio,
                          dbo.Especialidades.Nombre AS Especialidad, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno)
                          + ' ' + dbo.Empleados.Nombres AS Medico, dbo.Atenciones.IdAtencion, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdPaciente,
                         dbo.Atenciones.idEstadoAtencion,dbo.Atenciones.idTipoServicio, dbo.Atenciones.idCondicionAlta,dbo.Atenciones.fechaEgreso,
                         dbo.Atenciones.IdDestinoAtencion, dbo.Atenciones.idFuenteFinanciamiento
     FROM         dbo.TiposServicio RIGHT OUTER JOIN
                          dbo.Especialidades LEFT OUTER JOIN
                          dbo.Atenciones LEFT OUTER JOIN
                          dbo.Medicos ON dbo.Atenciones.IdMedicoIngreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                          dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                          dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio ON
                          dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio
     WHERE   dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.IdPaciente=@lnIdPaciente
     ORDER BY dbo.Atenciones.FechaIngreso DESC, dbo.Atenciones.HoraIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesXidPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[atencionesXtipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[atencionesXtipoFinanciamiento]
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.GeneraPago
             FROM         dbo.Atenciones LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
             WHERE dbo.Atenciones.idcuentaAtencion=@lIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[atencionesXtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtencionesXtrimestreSexoRangoEdadAnios]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AtencionesXtrimestreSexoRangoEdadAnios]
	@anio [int],
	@Trimestre [int],
	@edadAnio1 [int],
	@edadAnio2 [int],
	@idTipoSexo [int],
	@idFuenteFinanciamiento [int],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @Trimestre=1
   if @idTipoServicio=0
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 1) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 3) and
	                      dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio <=3
   else
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 1) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 3) and
	                      dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio =@idTipoServicio
else
if @trimestre=2
    if @idTipoServicio=0
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 4) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 6) and
	                      dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio <=3
    else
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 4) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 6) and
	                      dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio =@idTipoServicio
else
if @trimestre=3
    if @idTipoServicio=0
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 7) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 9) and
	                       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio <=3
   else
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 7) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 9) and
	                       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio =@idTipoServicio
else
     if @idTipoServicio=0
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 10) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 12) and
	                       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio <=3
    else
	SELECT     dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	WHERE     (dbo.Pacientes.IdTipoSexo = @idTipoSexo) AND (dbo.Atenciones.idEstadoAtencion <> 0) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento,
	                      dbo.Atenciones.FechaIngreso) >=@edadAnio1) AND (DATEDIFF(year, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso) <= @edadAnio2) AND
	                      (YEAR(dbo.Atenciones.FechaIngreso) = @anio) AND (MONTH(dbo.Atenciones.FechaIngreso) >= 10) AND (MONTH(dbo.Atenciones.FechaIngreso) <= 12) and
	                       dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and dbo.Atenciones.idTipoServicio =@idTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[AtencionesXtrimestreSexoRangoEdadAnios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenHospCensoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenHospCensoAgregar]
	@IdRangoCensoHosp [int],
	@RangoInicial [money],
	@RangoFinal [money],
	@RGBRojo [int],
	@RGBVerde [int],
	@RGBAzul [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenHospCenso (
IdRangoCensoHosp,RangoInicial,RangoFinal,RGBRojo,RGBVerde,RGBAzul) values (
@IdRangoCensoHosp,@RangoInicial,@RangoFinal,@RGBRojo,@RGBVerde,@RGBAzul)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdRangoCensoHosp,'AtenHospCenso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenHospCensoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenHospCensoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenHospCensoEliminar]
	@IdRangoCensoHosp [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenHospCenso
where IdRangoCensoHosp = @IdRangoCensoHosp
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdRangoCensoHosp,'AtenHospCenso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenHospCensoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenHospCensoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenHospCensoModificar]
	@IdRangoCensoHosp [int],
	@RangoInicial [money],
	@RangoFinal [money],
	@RGBRojo [int],
	@RGBVerde [int],
	@RGBAzul [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenHospCenso
set
RangoInicial = @RangoInicial,
RangoFinal = @RangoFinal,
RGBRojo = @RGBRojo,
RGBVerde = @RGBVerde,
RGBAzul = @RGBAzul
where IdRangoCensoHosp = @IdRangoCensoHosp
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdRangoCensoHosp,'AtenHospCenso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenHospCensoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenHospCensoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenHospCensoSeleccionarPorId]
	@IdRangoCensoHosp [int]
WITH EXECUTE AS CALLER
AS
select * from AtenHospCenso
where IdRangoCensoHosp = @IdRangoCensoHosp
GO
ALTER AUTHORIZATION ON [dbo].[AtenHospCensoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteBuscarPlanIntegralPorPacienteYGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteBuscarPlanIntegralPorPacienteYGrupo]
	@IdAtenInteGrupo [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT IdPlanIntegralPaciente,IdPaciente, IdAtenInteGrupo, FechaElaboracion
	FROM AtenIntePlanIntegralPaciente
	WHERE IdPaciente = @IdPaciente AND IdAtenInteGrupo = @IdAtenInteGrupo;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteBuscarPlanIntegralPorPacienteYGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGenerarPlanCrecimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGenerarPlanCrecimiento]
	@IdPlanIntegralPaciente [bigint],
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @IdItemPlanCrecimiento bigint;
	DECLARE @IdPlanCrecimientoPaciente INT;
	DECLARE @IdTriajeVariable int, @IdPlanAtencion int, @NumeroSesion INT, @OrdenItem INT;
	DECLARE @EdadAnio int, @EdadMes int, @EdadDia INT;
	DECLARE @FechaProgramada datetime, @FechaNacimientoPaciente datetime;

	DECLARE VarCursor_plan CURSOR FOR
	SELECT IP.IdItemPlanCrecimiento, IP.IdPlanAtencion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia
	FROM AtenInteItemPlanCrecimiento AS IP
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
	WHERE PA.IdAtenInteGrupo = @IdAtenInteGrupo;

	SET @FechaNacimientoPaciente = (SELECT FechaNacimiento FROM Pacientes WHERE IdPaciente = @IdPaciente);

	IF @FechaNacimientoPaciente IS NOT NULL
	BEGIN
		-- SE EXTRAE SOLO LA FECHA SIN LAS HORAS
		SET @FechaNacimientoPaciente =  DATEADD(dd, 0, DATEDIFF(dd, 0, @FechaNacimientoPaciente));

		OPEN VarCursor_plan;
		FETCH NEXT FROM VarCursor_plan INTO @IdItemPlanCrecimiento, @IdPlanAtencion,
							@NumeroSesion, @EdadAnio, @EdadMes, @EdadDia;
		WHILE @@FETCH_STATUS = 0
		BEGIN
			SET @IdPlanCrecimientoPaciente = (SELECT IdPlanCrecimientoPaciente FROM AtenIntePlanCrecimientoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente
													AND IdPlanAtencion = @IdPlanAtencion
													AND IdAtenInteItemPlan = @IdAtenInteItemPlan);
													-- AND NumeroSesion = @NumeroSesion);

			IF @IdPlanCrecimientoPaciente IS NULL
			BEGIN
				SET @IdPlanCrecimientoPaciente = ISNULL((SELECT max(IdPlanCrecimientoPaciente) + 1
											FROM AtenIntePlanCrecimientoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente), 1);


				SET @FechaProgramada =  DATEADD(yyyy, @EdadAnio, @FechaNacimientoPaciente);
				SET @FechaProgramada =  DATEADD(mm, @EdadMes, @FechaProgramada);
				SET @FechaProgramada =  DATEADD(dd, @EdadDia, @FechaProgramada);


				INSERT INTO AtenIntePlanCrecimientoPaciente(IdPlanCrecimientoPaciente,
						IdPlanIntegralPaciente, IdPlanAtencion, IdAtenInteItemPlan,
						FechaProgramada, NumeroSesion)
				VALUES(@IdPlanCrecimientoPaciente,
						@IdPlanIntegralPaciente, @IdPlanAtencion, @IdAtenInteItemPlan,
						@FechaProgramada, @NumeroSesion);

			END
			ELSE
			BEGIN
				UPDATE AtenIntePlanCrecimientoPaciente SET NumeroSesion = @NumeroSesion
				WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente;
			END;

			DECLARE VarCursor_plan_detalle CURSOR FOR
			SELECT IP.IdTriajeVariable, IP.OrdenItem
			FROM AtenIntePlanCrecDetalle AS IP
			WHERE IP.IdItemPlanCrecimiento = @IdItemPlanCrecimiento;

			OPEN VarCursor_plan_detalle;
			FETCH NEXT FROM VarCursor_plan_detalle INTO @IdTriajeVariable, @OrdenItem;
			WHILE @@FETCH_STATUS = 0
			BEGIN
				IF NOT EXISTS(SELECT 1 FROM AtenIntePlanCrecPacienteDet WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
								AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente AND IdTriajeVariable = @IdTriajeVariable)
				BEGIN
					INSERT INTO AtenIntePlanCrecPacienteDet(IdPlanCrecimientoPaciente,
							IdPlanIntegralPaciente, IdTriajeVariable, OrdenItem)
					VALUES(@IdPlanCrecimientoPaciente,
							@IdPlanIntegralPaciente, @IdTriajeVariable, @OrdenItem);
				END
				ELSE
				BEGIN
					UPDATE AtenIntePlanCrecPacienteDet SET OrdenItem = @OrdenItem
					WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
									AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente AND IdTriajeVariable = @IdTriajeVariable

				END;
				FETCH NEXT FROM VarCursor_plan_detalle INTO @IdTriajeVariable, @OrdenItem;
			END;
			CLOSE VarCursor_plan_detalle;
			DEALLOCATE VarCursor_plan_detalle

			FETCH NEXT FROM VarCursor_plan INTO @IdItemPlanCrecimiento, @IdPlanAtencion,
							@NumeroSesion, @EdadAnio, @EdadMes, @EdadDia;
		END;
		CLOSE VarCursor_plan;
		DEALLOCATE VarCursor_plan
	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGenerarPlanCrecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGenerarPlanDesarrollo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGenerarPlanDesarrollo]
	@IdPlanIntegralPaciente [bigint],
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @IdItemPlanDesarrollo bigint;
	DECLARE @IdPlanDesarrolloPaciente INT;
	DECLARE @IdItemDesarrollo int, @IdPlanAtencion int, @NumeroSesion INT, @OrdenItem INT;
	DECLARE @EdadAnio int, @EdadMes int, @EdadDia INT;
	DECLARE @FechaProgramada datetime, @FechaNacimientoPaciente datetime;

	DECLARE VarCursor_plan CURSOR FOR
	SELECT IP.IdItemPlanDesarrollo, IP.IdPlanAtencion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia
	FROM AtenInteItemPlanDesarrollo AS IP
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
	WHERE PA.IdAtenInteGrupo = @IdAtenInteGrupo;

	SET @FechaNacimientoPaciente = (SELECT FechaNacimiento FROM Pacientes WHERE IdPaciente = @IdPaciente);

	IF @FechaNacimientoPaciente IS NOT NULL
	BEGIN
		SET @FechaNacimientoPaciente =  DATEADD(dd, 0, DATEDIFF(dd, 0, @FechaNacimientoPaciente));

		OPEN VarCursor_plan;
		FETCH NEXT FROM VarCursor_plan INTO @IdItemPlanDesarrollo, @IdPlanAtencion,
							@NumeroSesion, @EdadAnio, @EdadMes, @EdadDia;
		WHILE @@FETCH_STATUS = 0
		BEGIN
			SET @IdPlanDesarrolloPaciente = (SELECT IdPlanDesarrolloPaciente FROM AtenIntePlanDesarrolloPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente
													AND IdPlanAtencion = @IdPlanAtencion
													AND IdAtenInteItemPlan = @IdAtenInteItemPlan);
													-- AND NumeroSesion = @NumeroSesion);

			IF @IdPlanDesarrolloPaciente IS NULL
			BEGIN
				SET @IdPlanDesarrolloPaciente = ISNULL((SELECT max(IdPlanDesarrolloPaciente) + 1
											FROM AtenIntePlanDesarrolloPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente), 1);


				SET @FechaProgramada =  DATEADD(yyyy, @EdadAnio, @FechaNacimientoPaciente);
				SET @FechaProgramada =  DATEADD(mm, @EdadMes, @FechaProgramada);
				SET @FechaProgramada =  DATEADD(dd, @EdadDia, @FechaProgramada);


				INSERT INTO AtenIntePlanDesarrolloPaciente(IdPlanDesarrolloPaciente,
						IdPlanIntegralPaciente, IdPlanAtencion, IdAtenInteItemPlan,
						FechaProgramada, NumeroSesion)
				VALUES(@IdPlanDesarrolloPaciente,
						@IdPlanIntegralPaciente, @IdPlanAtencion, @IdAtenInteItemPlan,
						@FechaProgramada, @NumeroSesion);

			END
			ELSE
			BEGIN
				SET @FechaProgramada =  DATEADD(yyyy, @EdadAnio, @FechaNacimientoPaciente);
				SET @FechaProgramada =  DATEADD(mm, @EdadMes, @FechaProgramada);
				SET @FechaProgramada =  DATEADD(dd, @EdadDia, @FechaProgramada);

				UPDATE AtenIntePlanDesarrolloPaciente SET NumeroSesion = @NumeroSesion,
					FechaProgramada = @FechaProgramada
				WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente;
			END;

			DECLARE VarCursor_plan_detalle CURSOR FOR
			SELECT IP.IdItemDesarrollo, IP.OrdenItem
			FROM AtenIntePlanDesDetalle AS IP
			WHERE IP.IdItemPlanDesarrollo = @IdItemPlanDesarrollo;

			OPEN VarCursor_plan_detalle;
			FETCH NEXT FROM VarCursor_plan_detalle INTO @IdItemDesarrollo, @OrdenItem;
			WHILE @@FETCH_STATUS = 0
			BEGIN
				IF NOT EXISTS(SELECT 1 FROM AtenIntePlanDesPacienteDet WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
								AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente AND IdItemDesarrollo = @IdItemDesarrollo)
				BEGIN
					INSERT INTO AtenIntePlanDesPacienteDet(IdPlanDesarrolloPaciente,
							IdPlanIntegralPaciente, IdItemDesarrollo, OrdenItem)
					VALUES(@IdPlanDesarrolloPaciente,
							@IdPlanIntegralPaciente, @IdItemDesarrollo, @OrdenItem);
				END
				ELSE
				BEGIN
					UPDATE AtenIntePlanDesPacienteDet SET OrdenItem = @OrdenItem
					WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
									AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente AND IdItemDesarrollo = @IdItemDesarrollo
				END;
				FETCH NEXT FROM VarCursor_plan_detalle INTO @IdItemDesarrollo, @OrdenItem;
			END;
			CLOSE VarCursor_plan_detalle;
			DEALLOCATE VarCursor_plan_detalle

			FETCH NEXT FROM VarCursor_plan INTO @IdItemPlanDesarrollo, @IdPlanAtencion,
							@NumeroSesion, @EdadAnio, @EdadMes, @EdadDia;
		END;
		CLOSE VarCursor_plan;
		DEALLOCATE VarCursor_plan
	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGenerarPlanDesarrollo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGenerarPlanProcedimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGenerarPlanProcedimiento]
	@IdPlanIntegralPaciente [bigint],
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @IdPlanProcedimientoPaciente INT;
	DECLARE @IdProducto int, @IdPlanAtencion int, @NumeroDosis INT;
	DECLARE @EdadAnio int, @EdadMes int, @EdadDia INT;
	DECLARE @FechaProgramada datetime, @FechaNacimientoPaciente datetime;

	DECLARE VarCursor_plan CURSOR FOR
	SELECT IP.IdPlanAtencion, IP.IdProducto, IP.NumeroDosis,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia
	FROM AtenInteItemPlanProcedimiento AS IP
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
	WHERE IP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND PA.IdAtenInteGrupo = @IdAtenInteGrupo;

	SET @FechaNacimientoPaciente = (SELECT FechaNacimiento FROM Pacientes WHERE IdPaciente = @IdPaciente);

	IF @FechaNacimientoPaciente IS NOT NULL
	BEGIN
		SET @FechaNacimientoPaciente =  DATEADD(dd, 0, DATEDIFF(dd, 0, @FechaNacimientoPaciente));

		OPEN VarCursor_plan;
		FETCH NEXT FROM VarCursor_plan INTO @IdPlanAtencion, @IdProducto, @NumeroDosis, @EdadAnio, @EdadMes, @EdadDia;
		WHILE @@FETCH_STATUS = 0
		BEGIN
			SET @IdPlanProcedimientoPaciente = (SELECT IdPlanProcedimientoPaciente FROM AtenIntePlanProcedimientoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente
													AND IdProducto = @IdProducto
													AND IdPlanAtencion = @IdPlanAtencion
													AND IdAtenInteItemPlan = @IdAtenInteItemPlan
													AND NumeroDosis = @NumeroDosis);

			IF @IdPlanProcedimientoPaciente IS NULL
			BEGIN
				SET @IdPlanProcedimientoPaciente = ISNULL((SELECT max(IdPlanProcedimientoPaciente) + 1
											FROM AtenIntePlanProcedimientoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente), 1);


				SET @FechaProgramada =  DATEADD(yyyy, @EdadAnio, @FechaNacimientoPaciente);
				SET @FechaProgramada =  DATEADD(mm, @EdadMes, @FechaProgramada);
				SET @FechaProgramada =  DATEADD(dd, @EdadDia, @FechaProgramada);


				INSERT INTO AtenIntePlanProcedimientoPaciente(IdPlanProcedimientoPaciente,
						IdPlanIntegralPaciente, IdProducto, IdPlanAtencion, IdAtenInteItemPlan,
						FechaProgramada, NumeroDosis)
				VALUES(@IdPlanProcedimientoPaciente,
						@IdPlanIntegralPaciente, @IdProducto, @IdPlanAtencion, @IdAtenInteItemPlan,
						@FechaProgramada, @NumeroDosis);
			END;

			FETCH NEXT FROM VarCursor_plan INTO @IdPlanAtencion, @IdProducto, @NumeroDosis, @EdadAnio, @EdadMes, @EdadDia;
		END;
		CLOSE VarCursor_plan;
		DEALLOCATE VarCursor_plan
	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGenerarPlanProcedimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGenerarPlanSuplemento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGenerarPlanSuplemento]
	@IdPlanIntegralPaciente [bigint],
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @IdPlanSuplementoPaciente INT;
	DECLARE @IdProducto int, @IdPlanAtencion int, @NumeroDosis INT;
	DECLARE @EdadAnio int, @EdadMes int, @EdadDia INT;
	DECLARE @FechaProgramada datetime, @FechaNacimientoPaciente datetime;

	DECLARE VarCursor_plan CURSOR FOR
	SELECT IP.IdPlanAtencion, IP.IdProducto, IP.NumeroDosis,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia
	FROM AtenInteItemPlanSuplemento AS IP
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
	WHERE PA.IdAtenInteGrupo = @IdAtenInteGrupo;
	-- WHERE IP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND PA.IdAtenInteGrupo = @IdAtenInteGrupo;

	SET @FechaNacimientoPaciente = (SELECT FechaNacimiento FROM Pacientes WHERE IdPaciente = @IdPaciente);

	IF @FechaNacimientoPaciente IS NOT NULL
	BEGIN
		-- 	separar solo la fecha sin considerar las horas
		SET @FechaNacimientoPaciente =  DATEADD(dd, 0, DATEDIFF(dd, 0, @FechaNacimientoPaciente));

		OPEN VarCursor_plan;
		FETCH NEXT FROM VarCursor_plan INTO @IdPlanAtencion, @IdProducto, @NumeroDosis, @EdadAnio, @EdadMes, @EdadDia;
		WHILE @@FETCH_STATUS = 0
		BEGIN
			SET @IdPlanSuplementoPaciente = (SELECT IdPlanSuplementoPaciente FROM AtenIntePlanSuplementoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente
													AND IdProducto = @IdProducto
													AND IdPlanAtencion = @IdPlanAtencion
													AND IdAtenInteItemPlan = @IdAtenInteItemPlan
													AND NumeroDosis = @NumeroDosis);

			IF @IdPlanSuplementoPaciente IS NULL
			BEGIN
				SET @IdPlanSuplementoPaciente = ISNULL((SELECT max(IdPlanSuplementoPaciente) + 1
											FROM AtenIntePlanSuplementoPaciente
												WHERE IdPlanIntegralPaciente = @IdPlanIntegralPaciente), 1);


				SET @FechaProgramada =  DATEADD(yyyy, @EdadAnio, @FechaNacimientoPaciente);
				SET @FechaProgramada =  DATEADD(mm, @EdadMes, @FechaProgramada);
				SET @FechaProgramada =  DATEADD(dd, @EdadDia, @FechaProgramada);


				INSERT INTO AtenIntePlanSuplementoPaciente(IdPlanSuplementoPaciente,
						IdPlanIntegralPaciente, IdProducto, IdPlanAtencion, IdAtenInteItemPlan,
						FechaProgramada, NumeroDosis)
				VALUES(@IdPlanSuplementoPaciente,
						@IdPlanIntegralPaciente, @IdProducto, @IdPlanAtencion, @IdAtenInteItemPlan,
						@FechaProgramada, @NumeroDosis);
			END;

			FETCH NEXT FROM VarCursor_plan INTO @IdPlanAtencion, @IdProducto, @NumeroDosis, @EdadAnio, @EdadMes, @EdadDia;
		END;
		CLOSE VarCursor_plan;
		DEALLOCATE VarCursor_plan
	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGenerarPlanSuplemento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoAgregar]
	@IdAtenInteGrupo [int] OUTPUT,
	@AtencionIntegralGrupo [varchar](50),
	@DesdeAnio [int],
	@DesdeMes [int],
	@DesdeDia [int],
	@HastaAnio [int],
	@HastaMes [int],
	@HastaDia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteGrupo (
AtencionIntegralGrupo,DesdeAnio,DesdeMes,DesdeDia,HastaAnio,HastaMes,HastaDia) values (
@AtencionIntegralGrupo,@DesdeAnio,@DesdeMes,@DesdeDia,@HastaAnio,@HastaMes,@HastaDia)
set @IdAtenInteGrupo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtenInteGrupo,'AtenInteGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoEliminar]
	@IdAtenInteGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteGrupo
where IdAtenInteGrupo = @IdAtenInteGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtenInteGrupo,'AtenInteGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCPacienteAgregar]
	@IdPaciente [int] OUTPUT,
	@IdGrupoHCPaciente [int],
	@IdAtenInteGrupo [int],
	@IdPregunta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteGrupoHCPaciente (
IdGrupoHCPaciente,IdAtenInteGrupo,IdPregunta) values (
@IdGrupoHCPaciente,@IdAtenInteGrupo,@IdPregunta)
set @IdPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPaciente,'AtenInteGrupoHCPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCPacienteEliminar]
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteGrupoHCPaciente
where IdPaciente = @IdPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPaciente,'AtenInteGrupoHCPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCPacienteModificar]
	@IdPaciente [int],
	@IdGrupoHCPaciente [int],
	@IdAtenInteGrupo [int],
	@IdPregunta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteGrupoHCPaciente
set
IdGrupoHCPaciente = @IdGrupoHCPaciente,
IdAtenInteGrupo = @IdAtenInteGrupo,
IdPregunta = @IdPregunta
where IdPaciente = @IdPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPaciente,'AtenInteGrupoHCPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCPacienteSeleccionarPorId]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteGrupoHCPaciente
where IdPaciente = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRespuestaPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRespuestaPacienteAgregar]
	@IdGrupoHCPaciente [int] OUTPUT,
	@IdPaciente [int],
	@ItemRespuesta [int],
	@ValorTexto [varchar](255),
	@ValorNumero [money],
	@ValorFecha [datetime],
	@ValorNumeroFin [money],
	@ValorFechaFin [datetime],
	@ValorEspecificacion [varchar](1500),
	@EsActivo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteGrupoHCRespuestaPaciente (
IdPaciente,ItemRespuesta,ValorTexto,ValorNumero,ValorFecha,ValorNumeroFin,ValorFechaFin,ValorEspecificacion,EsActivo) values (
@IdPaciente,@ItemRespuesta,@ValorTexto,@ValorNumero,@ValorFecha,@ValorNumeroFin,@ValorFechaFin,@ValorEspecificacion,@EsActivo)
set @IdGrupoHCPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGrupoHCPaciente,'AtenInteGrupoHCRespuestaPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRespuestaPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRespuestaPacienteEliminar]
	@IdGrupoHCPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteGrupoHCRespuestaPaciente
where IdGrupoHCPaciente = @IdGrupoHCPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdGrupoHCPaciente,'AtenInteGrupoHCRespuestaPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRespuestaPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRespuestaPacienteModificar]
	@IdGrupoHCPaciente [int],
	@IdPaciente [int],
	@ItemRespuesta [int],
	@ValorTexto [varchar](255),
	@ValorNumero [money],
	@ValorFecha [datetime],
	@ValorNumeroFin [money],
	@ValorFechaFin [datetime],
	@ValorEspecificacion [varchar](1500),
	@EsActivo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteGrupoHCRespuestaPaciente
set
IdPaciente = @IdPaciente,
ItemRespuesta = @ItemRespuesta,
ValorTexto = @ValorTexto,
ValorNumero = @ValorNumero,
ValorFecha = @ValorFecha,
ValorNumeroFin = @ValorNumeroFin,
ValorFechaFin = @ValorFechaFin,
ValorEspecificacion = @ValorEspecificacion,
EsActivo = @EsActivo
where IdGrupoHCPaciente = @IdGrupoHCPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdGrupoHCPaciente,'AtenInteGrupoHCRespuestaPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRespuestaPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRespuestaPacienteSeleccionarPorId]
	@IdGrupoHCPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteGrupoHCRespuestaPaciente
where IdGrupoHCPaciente = @IdGrupoHCPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRespuestaPacienteVerificarAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRespuestaPacienteVerificarAgregar]
	@IdGrupoHCPaciente [int],
	@IdPaciente [int],
	@ItemRespuesta [int],
	@ValorTexto [varchar](255),
	@ValorNumero [money],
	@ValorFecha [datetime],
	@ValorNumeroFin [money],
	@ValorFechaFin [datetime],
	@ValorEspecificacion [varchar](1500),
	@EsActivo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarItenRespuesta AS INT;

	SET @VarItenRespuesta = (SELECT ItemRespuesta FROM AtenInteGrupoHCRespuestaPaciente
							WHERE IdPaciente = @IdPaciente AND IdGrupoHCPaciente = @IdGrupoHCPaciente
								AND ItemRespuesta = @ItemRespuesta);
	IF @VarItenRespuesta IS NULL
	BEGIN
		INSERT INTO AtenInteGrupoHCRespuestaPaciente (IdGrupoHCPaciente,
			IdPaciente,ItemRespuesta,ValorTexto,ValorNumero,ValorFecha,
			ValorNumeroFin,ValorFechaFin,ValorEspecificacion,EsActivo)
		VALUES (@IdGrupoHCPaciente,
			@IdPaciente,@ItemRespuesta,@ValorTexto,@ValorNumero,@ValorFecha,
			@ValorNumeroFin,@ValorFechaFin,@ValorEspecificacion, 1)
	END
	ELSE
	BEGIN
		UPDATE AtenInteGrupoHCRespuestaPaciente SET
			ValorTexto = @ValorTexto,
			ValorNumero = @ValorNumero,
			ValorFecha = @ValorFecha,
			ValorNumeroFin = @ValorNumeroFin,
			ValorFechaFin = @ValorFechaFin,
			ValorEspecificacion = @ValorEspecificacion,
			EsActivo = 1
		WHERE IdPaciente = @IdPaciente AND IdGrupoHCPaciente = @IdGrupoHCPaciente
								AND ItemRespuesta = @ItemRespuesta
	END;

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGrupoHCPaciente,'AtenInteGrupoHCRespuestaPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRespuestaPacienteVerificarAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoHCRptaPacienteEliminarPorPregunta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoHCRptaPacienteEliminarPorPregunta]
	@IdGrupoHCPaciente [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenInteGrupoHCRespuestaPaciente SET EsActivo = 0
	WHERE IdPaciente = @IdPaciente AND IdGrupoHCPaciente = @IdGrupoHCPaciente;
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdGrupoHCPaciente,'AtenInteGrupoHCRespuestaPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoHCRptaPacienteEliminarPorPregunta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoModificar]
	@IdAtenInteGrupo [int],
	@AtencionIntegralGrupo [varchar](50),
	@DesdeAnio [int],
	@DesdeMes [int],
	@DesdeDia [int],
	@HastaAnio [int],
	@HastaMes [int],
	@HastaDia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteGrupo
set
AtencionIntegralGrupo = @AtencionIntegralGrupo,
DesdeAnio = @DesdeAnio,
DesdeMes = @DesdeMes,
DesdeDia = @DesdeDia,
HastaAnio = @HastaAnio,
HastaMes = @HastaMes,
HastaDia = @HastaDia
where IdAtenInteGrupo = @IdAtenInteGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtenInteGrupo,'AtenInteGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteGrupoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteGrupoSeleccionarPorId]
	@IdAtenInteGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteGrupo
where IdAtenInteGrupo = @IdAtenInteGrupo
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteGrupoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteHcPreguntasPorGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteHcPreguntasPorGrupo]
	@InIdAtenInteGrupo [int]
WITH EXECUTE AS CALLER
AS
SELECT GI.IdHCItem, GI.Numeracion, GI.IdGrupoHCItem, I.NombreHCItem,
		IP.IdHCItemPregunta, IP.IdPregunta, P.Pregunta,
		IP.RequiereEspecificar, IP.LabelEspecificacion, IP.ControlEjeX,
		IP.ControlEjeY, IP.ControlTipo, IP.ControlAncho, IP.ControlAlto,
		IP.ControlEjeXLabEsp, IP.ControlEjeYLabEsp, IP.ControlAltoLabEsp,
		IP.ControlAnchoLabEsp, IP.ControlEjeXEsp, IP.ControlEjeYEsp, IP.ControlAltoEsp,
		IP.ControlAnchoEsp, IP.ControlMaxCaracteresEsp, IP.TipoDato
	FROM AtenInteGrupoHCItem AS GI
	INNER JOIN AtenInteHCItem As I ON GI.IdHCItem = I.IdHCItem
	LEFT OUTER JOIN (AtenInteHCItemPregunta AS IP
	INNER JOIN AtenIntePregunta P ON IP.EsActivo = 1 AND IP.IdPregunta = P.IdPregunta) ON GI.IdGrupoHCItem = IP.IdGrupoHCItem
	-- WHERE GI.EsActivo = 1 AND GI.IdAtenInteGrupo = @InIdAtenInteGrupo
	ORDER BY GI.Orden, IP.Orden;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteHcPreguntasPorGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemDesarrolloAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemDesarrolloAgregar]
	@IdItemDesarrollo [int] OUTPUT,
	@ItemDesarrollo [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemDesarrollo (
ItemDesarrollo) values (
@ItemDesarrollo)
set @IdItemDesarrollo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemDesarrollo,'AtenInteItemDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrolloAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemDesarrolloEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemDesarrolloEliminar]
	@IdItemDesarrollo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemDesarrollo
where IdItemDesarrollo = @IdItemDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemDesarrollo,'AtenInteItemDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrolloEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemDesarrolloModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemDesarrolloModificar]
	@IdItemDesarrollo [int],
	@ItemDesarrollo [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemDesarrollo
set
ItemDesarrollo = @ItemDesarrollo
where IdItemDesarrollo = @IdItemDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemDesarrollo,'AtenInteItemDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrolloModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemDesarrolloPacientePendiente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemDesarrolloPacientePendiente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarIdAtencion int;
	DECLARE @VarFechaAtencion  DateTime;
	DECLARE @VarFechaAtencionLimite DateTime;


	SET @VarIdAtencion = (SELECT TOP 1 IdAtencion FROM AtenIntePlanDesarrolloPaciente
							WHERE IdAtencion = @IdAtencion);
	SET @VarFechaAtencion = (SELECT FechaIngreso FROM dbo.Atenciones
								WHERE IdAtencion = @IdAtencion)

	IF @VarIdAtencion IS NOT NULL
	BEGIN
		SELECT TOP 1 IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
			PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
			PA.EdadAnio, PA.EdadMes, PA.EdadDia,
			CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS EvaluacionDesc,
			E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion, IP.Evaluacion
		FROM AtenIntePlanDesarrolloPaciente AS IP
			INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
			INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
			LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
		WHERE IP.IdAtencion = @IdAtencion ORDER BY IP.FechaProgramada DESC;
	END
	ELSE
	BEGIN
		IF @VarFechaAtencion IS NULL
		BEGIN
			SET @VarFechaAtencion = getDate();
		END;

		--SET @VarFechaAtencionLimite = DATEADD(MONTH, -1, @VarFechaAtencion)
		SET @VarFechaAtencionLimite = DATEADD(MONTH, -12, @VarFechaAtencion)

		SELECT TOP 1 IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
			PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
			PA.EdadAnio, PA.EdadMes, PA.EdadDia,
			CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS EvaluacionDesc,
			E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion, IP.Evaluacion
		FROM AtenIntePlanDesarrolloPaciente AS IP
			INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
			INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
			LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
		WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
			AND IP.FechaEjecucion IS NULL
			AND (IP.FechaProgramada >= @VarFechaAtencionLimite AND IP.FechaProgramada <= @VarFechaAtencion) )
			-- OR IP.IdAtencion = @IdAtencion
		ORDER BY IP.FechaProgramada DESC;

	END
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrolloPacientePendiente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemDesarrolloSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemDesarrolloSeleccionarPorId]
	@IdItemDesarrollo [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemDesarrollo
where IdItemDesarrollo = @IdItemDesarrollo
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemDesarrolloSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanAgregar]
	@IdAtenInteItemPlan [int] OUTPUT,
	@ItemPlan [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemPlan (
ItemPlan) values (
@ItemPlan)
set @IdAtenInteItemPlan = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtenInteItemPlan,'AtenInteItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanCrecimientoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanCrecimientoAgregar]
	@IdItemPlanCrecimiento [bigint] OUTPUT,
	@IdPlanAtencion [int],
	@NumeroSesion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemPlanCrecimiento (
IdPlanAtencion,NumeroSesion) values (
@IdPlanAtencion,@NumeroSesion)
set @IdItemPlanCrecimiento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemPlanCrecimiento,'AtenInteItemPlanCrecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanCrecimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanCrecimientoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanCrecimientoEliminar]
	@IdItemPlanCrecimiento [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemPlanCrecimiento
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemPlanCrecimiento,'AtenInteItemPlanCrecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanCrecimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanCrecimientoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanCrecimientoModificar]
	@IdItemPlanCrecimiento [bigint],
	@IdPlanAtencion [int],
	@NumeroSesion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemPlanCrecimiento
set
IdPlanAtencion = @IdPlanAtencion,
NumeroSesion = @NumeroSesion
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemPlanCrecimiento,'AtenInteItemPlanCrecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanCrecimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanCrecimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanCrecimientoSeleccionarPorId]
	@IdItemPlanCrecimiento [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemPlanCrecimiento
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanCrecimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanDesarrolloAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanDesarrolloAgregar]
	@IdItemPlanDesarrollo [bigint] OUTPUT,
	@IdPlanAtencion [int],
	@NumeroSesion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemPlanDesarrollo (
IdPlanAtencion,NumeroSesion) values (
@IdPlanAtencion,@NumeroSesion)
set @IdItemPlanDesarrollo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemPlanDesarrollo,'AtenInteItemPlanDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanDesarrolloAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanDesarrolloEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanDesarrolloEliminar]
	@IdItemPlanDesarrollo [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemPlanDesarrollo
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemPlanDesarrollo,'AtenInteItemPlanDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanDesarrolloEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanDesarrolloModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanDesarrolloModificar]
	@IdItemPlanDesarrollo [bigint],
	@IdPlanAtencion [int],
	@NumeroSesion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemPlanDesarrollo
set
IdPlanAtencion = @IdPlanAtencion,
NumeroSesion = @NumeroSesion
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemPlanDesarrollo,'AtenInteItemPlanDesarrollo'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanDesarrolloModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanDesarrolloSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanDesarrolloSeleccionarPorId]
	@IdItemPlanDesarrollo [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemPlanDesarrollo
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanDesarrolloSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanEliminar]
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemPlan
where IdAtenInteItemPlan = @IdAtenInteItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtenInteItemPlan,'AtenInteItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanModificar]
	@IdAtenInteItemPlan [int],
	@ItemPlan [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemPlan
set
ItemPlan = @ItemPlan
where IdAtenInteItemPlan = @IdAtenInteItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtenInteItemPlan,'AtenInteItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanProcedimientoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanProcedimientoAgregar]
	@IdItemPlanProcedimiento [bigint] OUTPUT,
	@IdPlanAtencion [int],
	@IdProducto [int],
	@NumeroDosis [tinyint],
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemPlanProcedimiento (
IdPlanAtencion,IdProducto,NumeroDosis,IdAtenInteItemPlan) values (
@IdPlanAtencion,@IdProducto,@NumeroDosis,@IdAtenInteItemPlan)
set @IdItemPlanProcedimiento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemPlanProcedimiento,'AtenInteItemPlanProcedimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanProcedimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanProcedimientoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanProcedimientoEliminar]
	@IdItemPlanProcedimiento [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemPlanProcedimiento
where IdItemPlanProcedimiento = @IdItemPlanProcedimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemPlanProcedimiento,'AtenInteItemPlanProcedimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanProcedimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanProcedimientoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanProcedimientoModificar]
	@IdItemPlanProcedimiento [bigint],
	@IdPlanAtencion [int],
	@IdProducto [int],
	@NumeroDosis [tinyint],
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemPlanProcedimiento
set
IdPlanAtencion = @IdPlanAtencion,
IdProducto = @IdProducto,
NumeroDosis = @NumeroDosis,
IdAtenInteItemPlan = @IdAtenInteItemPlan
where IdItemPlanProcedimiento = @IdItemPlanProcedimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemPlanProcedimiento,'AtenInteItemPlanProcedimiento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanProcedimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanProcedimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanProcedimientoSeleccionarPorId]
	@IdItemPlanProcedimiento [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemPlanProcedimiento
where IdItemPlanProcedimiento = @IdItemPlanProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanProcedimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanSeleccionarPorId]
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemPlan
where IdAtenInteItemPlan = @IdAtenInteItemPlan
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanSuplementoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanSuplementoAgregar]
	@ItemPlanSuplemento [bigint] OUTPUT,
	@IdPlanAtencion [int],
	@IdProducto [int],
	@NumeroDosis [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteItemPlanSuplemento (
IdPlanAtencion,IdProducto,NumeroDosis) values (
@IdPlanAtencion,@IdProducto,@NumeroDosis)
set @ItemPlanSuplemento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@ItemPlanSuplemento,'AtenInteItemPlanSuplemento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSuplementoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanSuplementoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanSuplementoEliminar]
	@ItemPlanSuplemento [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteItemPlanSuplemento
where ItemPlanSuplemento = @ItemPlanSuplemento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@ItemPlanSuplemento,'AtenInteItemPlanSuplemento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSuplementoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanSuplementoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanSuplementoModificar]
	@ItemPlanSuplemento [bigint],
	@IdPlanAtencion [int],
	@IdProducto [int],
	@NumeroDosis [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteItemPlanSuplemento
set
IdPlanAtencion = @IdPlanAtencion,
IdProducto = @IdProducto,
NumeroDosis = @NumeroDosis
where ItemPlanSuplemento = @ItemPlanSuplemento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@ItemPlanSuplemento,'AtenInteItemPlanSuplemento'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSuplementoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteItemPlanSuplementoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteItemPlanSuplementoSeleccionarPorId]
	@ItemPlanSuplemento [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenInteItemPlanSuplemento
where ItemPlanSuplemento = @ItemPlanSuplemento
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteItemPlanSuplementoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarCrecimientoPacientePendientesDet]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarCrecimientoPacientePendientesDet]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarIdPlanCrecimientoPaciente INT;
	DECLARE @VarIdPlanIntegralPaciente bigint;


	-- SESSION DE CRECIMIENTO A EJECUTAR POR EDAD DEL PACIENTE
	SELECT TOP 1 @VarIdPlanIntegralPaciente = IP.IdPlanIntegralPaciente,
				@VarIdPlanCrecimientoPaciente = IP.IdPlanCrecimientoPaciente
	FROM AtenIntePlanCrecimientoPaciente AS IP
	INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion ORDER BY IP.FechaProgramada DESC;

	-- LISTADOS DE PLAN DE CRECIMIENTO
	SELECT IPD.IdPlanCrecimientoPaciente, IPD.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.FechaEjecucion,
		IPD.IdTriajeVariable, S.TriajeVariable, IPD.OrdenItem, IPD.VariableValor
	FROM AtenIntePlanCrecPacienteDet AS IPD
		INNER JOIN AtenIntePlanCrecimientoPaciente AS IP ON IPD.IdPlanCrecimientoPaciente = IP.IdPlanCrecimientoPaciente
											AND IPD.IdPlanIntegralPaciente = IP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN [SIGH_EXTERNA].dbo.TriajeVariable AS S ON S.IdTriajeVariable = IPD.IdTriajeVariable
	WHERE IPD.IdPlanCrecimientoPaciente = @VarIdPlanCrecimientoPaciente AND IPD.IdPlanIntegralPaciente = @VarIdPlanIntegralPaciente
	ORDER BY IPD.OrdenItem;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarCrecimientoPacientePendientesDet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarDesarrolloPacienteDetPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarDesarrolloPacienteDetPorId]
	@IdPlanIntegralPaciente [int],
	@IdPlanDesarrolloPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT IPD.IdPlanDesarrolloPaciente, IPD.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.FechaEjecucion,
		IPD.IdItemDesarrollo, S.ItemDesarrollo, IPD.OrdenItem, IPD.EjecutaAccion
	FROM AtenIntePlanDesPacienteDet AS IPD
		INNER JOIN AtenIntePlanDesarrolloPaciente AS IP ON IPD.IdPlanDesarrolloPaciente = IP.IdPlanDesarrolloPaciente
											AND IPD.IdPlanIntegralPaciente = IP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN AtenInteItemDesarrollo AS S ON S.IdItemDesarrollo = IPD.IdItemDesarrollo
	WHERE IPD.IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
				AND IPD.IdPlanIntegralPaciente = @IdPlanIntegralPaciente
	ORDER BY IPD.OrdenItem;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarDesarrolloPacienteDetPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarDesarrolloPacientePendientesDet]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarDesarrolloPacientePendientesDet]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarIdPlanDesarrolloPaciente INT;
	DECLARE @VarIdPlanIntegralPaciente bigint;
	DECLARE @VarFechaAtencion  DateTime;
	DECLARE @VarFechaAtencionLimite DateTime;
	DECLARE @VarIdAtencion  int;

	/*SET @VarIdPlanIntegralPaciente = (SELECT IdPlanIntegralPaciente FROM AtenIntePlanDesarrolloPaciente
										WHERE IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente);*/

	SET @VarIdAtencion = (SELECT TOP 1 IdAtencion FROM AtenIntePlanDesarrolloPaciente WHERE IdAtencion = @IdAtencion);
	SET @VarFechaAtencion = (SELECT FechaIngreso FROM dbo.Atenciones WHERE IdAtencion = @IdAtencion)

	IF @VarIdAtencion IS NOT NULL
	BEGIN
		SELECT TOP 1 @VarIdPlanIntegralPaciente = IP.IdPlanIntegralPaciente,
					@VarIdPlanDesarrolloPaciente = IP.IdPlanDesarrolloPaciente
		FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		WHERE IP.IdAtencion = @IdAtencion ORDER BY IP.FechaProgramada DESC;
	END
	ELSE
	BEGIN
		IF @VarFechaAtencion IS NULL
		BEGIN
			SET @VarFechaAtencion = getDate();
		END;

		-- SET @VarFechaAtencionLimite = DATEADD(MONTH, -1, @VarFechaAtencion)
		SET @VarFechaAtencionLimite = DATEADD(MONTH, -12, @VarFechaAtencion)

		SELECT TOP 1 @VarIdPlanIntegralPaciente = IP.IdPlanIntegralPaciente,
					@VarIdPlanDesarrolloPaciente = IP.IdPlanDesarrolloPaciente
		FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
			AND IP.FechaEjecucion IS NULL AND
				(IP.FechaProgramada >= @VarFechaAtencionLimite AND IP.FechaProgramada <=@VarFechaAtencion))
			-- OR IP.IdAtencion = @IdAtencion
		ORDER BY IP.FechaProgramada DESC;
	END;
	EXEC dbo.AtenInteListarDesarrolloPacienteDetPorId @VarIdPlanIntegralPaciente, @VarIdPlanDesarrolloPaciente;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarDesarrolloPacientePendientesDet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanCrecimientoPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanCrecimientoPaciente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanCrecimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanCrecimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
	GROUP BY IP.IdPlanCrecimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.NumeroSesion, IP.FechaProgramada, IP.FechaEjecucion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, E.IdEstablecimiento, E.Nombre
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanCrecimientoPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanCrecimientoPacienteDet]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanCrecimientoPacienteDet]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IPD.IdPlanCrecimientoPaciente, IPD.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.FechaEjecucion,
		IPD.IdTriajeVariable, S.TriajeVariable, IPD.OrdenItem, IPD.VariableValor
	FROM AtenIntePlanCrecPacienteDet AS IPD
		INNER JOIN AtenIntePlanCrecimientoPaciente AS IP ON IPD.IdPlanCrecimientoPaciente = IP.IdPlanCrecimientoPaciente
											AND IPD.IdPlanIntegralPaciente = IP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN [SIGH_EXTERNA].dbo.TriajeVariable AS S ON S.IdTriajeVariable = IPD.IdTriajeVariable
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	ORDER BY IP.FechaProgramada, IP.NumeroSesion, IPD.OrdenItem;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanCrecimientoPacienteDet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanCrecimientoPacientePendientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanCrecimientoPacientePendientes]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanCrecimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanCrecimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion
	GROUP BY IP.IdPlanCrecimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.NumeroSesion, IP.FechaProgramada, IP.FechaEjecucion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, E.IdEstablecimiento, E.Nombre
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanCrecimientoPacientePendientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanDesarrolloPacienteDet]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanDesarrolloPacienteDet]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IPD.IdPlanDesarrolloPaciente, IPD.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.FechaEjecucion,
		IPD.IdItemDesarrollo, S.ItemDesarrollo, IPD.OrdenItem, IPD.EjecutaAccion
	FROM AtenIntePlanDesPacienteDet AS IPD
		INNER JOIN AtenIntePlanDesarrolloPaciente AS IP ON IPD.IdPlanDesarrolloPaciente = IP.IdPlanDesarrolloPaciente
											AND IPD.IdPlanIntegralPaciente = IP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN AtenInteItemDesarrollo AS S ON S.IdItemDesarrollo = IPD.IdItemDesarrollo
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	ORDER BY IP.FechaProgramada, IP.NumeroSesion, IPD.OrdenItem;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanDesarrolloPacienteDet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanDesarrolloPacientePendientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanDesarrolloPacientePendientes]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS Evaluacion,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion
	GROUP BY IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.NumeroSesion, IP.FechaProgramada, IP.FechaEjecucion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.Evaluacion, E.IdEstablecimiento, E.Nombre
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanDesarrolloPacientePendientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanDesarrolloPacienteVencidos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanDesarrolloPacienteVencidos]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarFechaAtencion  DateTime;
	DECLARE @VarFechaAtencionLimite DateTime;

	SET @VarFechaAtencion = (SELECT FechaIngreso FROM dbo.Atenciones
								WHERE IdAtencion = @IdAtencion)

	IF @VarFechaAtencion IS NULL
	BEGIN
		SET @VarFechaAtencion = getDate();
	END;

	SELECT IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS EvaluacionDesc,
		E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion, IP.Evaluacion
	FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE IP.IdAtencion IS NULL
		AND (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.FechaProgramada < @VarFechaAtencion )
	ORDER BY IP.FechaProgramada;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanDesarrolloPacienteVencidos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanIntegralDesarrolloPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanIntegralDesarrolloPaciente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS Evaluacion,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
	GROUP BY IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.NumeroSesion, IP.FechaProgramada, IP.FechaEjecucion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia, IP.Evaluacion, E.IdEstablecimiento, E.Nombre
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanIntegralDesarrolloPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanIntegralProcedimientosPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanIntegralProcedimientosPaciente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanAtencion, PA.Descripcion
	FROM AtenIntePlanProcedimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoServicios AS S ON S.idProducto = IP.idProducto
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	GROUP BY IP.IdPlanAtencion, PA.Descripcion, PA.EdadAnio, PA.EdadMes, PA.EdadDia
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanIntegralProcedimientosPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanProcedimientosPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanProcedimientosPaciente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanProcedimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.IdProducto, S.Codigo, S.Nombre, IP.NumeroDosis,
		IP.FechaProgramada, IP.FechaEjecucion, PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanProcedimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoServicios AS S ON S.idProducto = IP.idProducto
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	ORDER BY IP.FechaProgramada, IP.NumeroDosis;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanProcedimientosPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanProcedimientosPacientePendientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanProcedimientosPacientePendientes]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT PA.IdPlanAtencion, PA.Descripcion
	FROM AtenIntePlanProcedimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoServicios AS S ON S.idProducto = IP.idProducto
	WHERE ((PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion) AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	GROUP BY PA.IdPlanAtencion, PA.Descripcion, PA.EdadAnio, PA.EdadMes, PA.EdadDia
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanProcedimientosPacientePendientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanSuplementoPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanSuplementoPaciente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanSuplementoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.IdProducto, S.Nombre, IP.NumeroDosis,
		IP.FechaProgramada, IP.FechaEjecucion, PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento
	FROM AtenIntePlanSuplementoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoBienesInsumos AS S ON S.idProducto = IP.idProducto
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	ORDER BY IP.FechaProgramada, IP.NumeroDosis;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanSuplementoPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanSuplementoPacienteGrupos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanSuplementoPacienteGrupos]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanAtencion, PA.Descripcion
	FROM AtenIntePlanSuplementoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		-- INNER JOIN FactCatalogoBienesInsumos AS S ON S.idProducto = IP.idProducto
	WHERE PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	GROUP BY IP.IdPlanAtencion, PA.Descripcion, PA.EdadAnio, PA.EdadMes, PA.EdadDia
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanSuplementoPacienteGrupos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPlanSuplementoPacientePendGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPlanSuplementoPacientePendGrupo]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT PA.IdPlanAtencion, PA.Descripcion
	FROM AtenIntePlanSuplementoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		-- INNER JOIN FactCatalogoBienesInsumos AS S ON S.idProducto = IP.idProducto
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion
	GROUP BY PA.IdPlanAtencion, PA.Descripcion, PA.EdadAnio, PA.EdadMes, PA.EdadDia
	ORDER BY PA.EdadAnio, PA.EdadMes, PA.EdadDia;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPlanSuplementoPacientePendGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarPreguntasPorPacienteYGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarPreguntasPorPacienteYGrupo]
	@IdPaciente [int],
	@IdAtenInteGrupo [int]
WITH EXECUTE AS CALLER
AS
SELECT GP.IdPaciente, GP.IdGrupoHCPaciente, GP.IdAtenInteGrupo,
		GP.IdPregunta, P.Pregunta, P.TipoRespuesta, P.TipoValorRespuesta
	FROM AtenInteGrupoHCPaciente AS GP
	INNER JOIN AtenIntePregunta P ON GP.IdPregunta = P.IdPregunta
	WHERE GP.IdPaciente = @IdPaciente AND GP.IdAtenInteGrupo = @IdAtenInteGrupo
	ORDER BY GP.IdPregunta;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarPreguntasPorPacienteYGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarProcedimientosPacientePendientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarProcedimientosPacientePendientes]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanProcedimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.IdProducto, S.Codigo, S.Nombre, IP.NumeroDosis,
		IP.FechaProgramada,
			-- CASE ISNULL(IP.FechaEjecucion, 0) WHEN 0 THEN 0 ELSE 1 END AS EsEjecutada,
		IP.FechaEjecucion, PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion, IP.CodigoHIS
	FROM AtenIntePlanProcedimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoServicios AS S ON S.idProducto = IP.idProducto
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE ((PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion) AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
	ORDER BY IP.FechaProgramada, IP.NumeroDosis;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarProcedimientosPacientePendientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarRespuestasPorPacienteYGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarRespuestasPorPacienteYGrupo]
	@IdPaciente [int],
	@IdAtenInteGrupo [int]
WITH EXECUTE AS CALLER
AS
SELECT GP.IdPaciente, GP.IdGrupoHCPaciente, GP.IdAtenInteGrupo,
		GP.IdPregunta, P.Pregunta, P.TipoRespuesta, P.TipoValorRespuesta,
		RP.ItemRespuesta, RP.ValorTexto, RP.ValorNumero, RP.ValorFecha,
		RP.ValorNumeroFin, RP.ValorEspecificacion
	FROM AtenInteGrupoHCRespuestaPaciente AS RP
	INNER JOIN AtenInteGrupoHCPaciente AS GP ON RP.EsActivo = 1 AND RP.IdPaciente = GP.IdPaciente
					AND RP.IdGrupoHCPaciente = GP.IdGrupoHCPaciente
	INNER JOIN AtenIntePregunta P ON GP.IdPregunta = P.IdPregunta
	WHERE GP.IdPaciente = @IdPaciente AND GP.IdAtenInteGrupo = @IdAtenInteGrupo
	ORDER BY GP.IdPregunta;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarRespuestasPorPacienteYGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteListarSuplementoPacientePendientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteListarSuplementoPacientePendientes]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanSuplementoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.IdProducto, S.Nombre, IP.NumeroDosis,
		IP.FechaProgramada,
		IP.FechaEjecucion, PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion
	FROM AtenIntePlanSuplementoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		INNER JOIN FactCatalogoBienesInsumos AS S ON S.idProducto = IP.idProducto
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		-- AND IP.IdAtenInteItemPlan = @IdAtenInteItemPlan
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion
	ORDER BY IP.FechaProgramada, IP.NumeroDosis;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteListarSuplementoPacientePendientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanAtecionPacienteEliminaEjecucion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanAtecionPacienteEliminaEjecucion]
	@IdAtencion [int],
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
DECLARE @IdPlanDesarrolloPaciente INT;
	DECLARE @IdPlanCrecimientoPaciente INT;
	DECLARE @IdPlanIntegralPaciente BIGINT;


	DECLARE VarCursorDesarrollo CURSOR FOR
	SELECT IdPlanDesarrolloPaciente, IdPlanIntegralPaciente FROM AtenIntePlanDesarrolloPaciente
	WHERE IdAtencion = @IdAtencion

	OPEN VarCursorDesarrollo;
	FETCH NEXT FROM VarCursorDesarrollo INTO @IdPlanDesarrolloPaciente, @IdPlanIntegralPaciente

	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE AtenIntePlanDesPacienteDet SET EjecutaAccion = NULL
		WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente

		FETCH NEXT FROM VarCursorDesarrollo INTO @IdPlanDesarrolloPaciente, @IdPlanIntegralPaciente
	END
	CLOSE VarCursorDesarrollo
	DEALLOCATE VarCursorDesarrollo


	DECLARE VarCursorCrecimiento CURSOR FOR
	SELECT IdPlanCrecimientoPaciente, IdPlanIntegralPaciente FROM AtenIntePlanCrecimientoPaciente
	WHERE IdAtencion = @IdAtencion

	OPEN VarCursorCrecimiento;
	FETCH NEXT FROM VarCursorCrecimiento INTO @IdPlanCrecimientoPaciente, @IdPlanIntegralPaciente

	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE AtenIntePlanCrecPacienteDet SET VariableValor = NULL
		WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente

		FETCH NEXT FROM VarCursorCrecimiento INTO @IdPlanCrecimientoPaciente, @IdPlanIntegralPaciente
	END
	CLOSE VarCursorCrecimiento
	DEALLOCATE VarCursorCrecimiento


	UPDATE AtenIntePlanDesarrolloPaciente SET Evaluacion = NULL, FechaEjecucion = NULL,
		IdAtencion = NULL, IdEstablecimiento = NULL
	WHERE IdAtencion = @IdAtencion

	UPDATE AtenIntePlanCrecimientoPaciente SET FechaEjecucion = NULL, IdAtencion = NULL,
		IdEstablecimiento = NULL
	WHERE IdAtencion = @IdAtencion

	UPDATE AtenIntePlanProcedimientoPaciente SET FechaEjecucion = NULL, IdAtencion = NULL,
		IdEstablecimiento = NULL
	WHERE IdAtencion = @IdAtencion

	UPDATE AtenIntePlanSuplementoPaciente SET FechaEjecucion = NULL, IdAtencion = NULL,
		IdEstablecimiento = NULL
	WHERE IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtecionPacienteEliminaEjecucion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanAtencionAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanAtencionAgregar]
	@IdPlanAtencion [int] OUTPUT,
	@IdAtenInteGrupo [int],
	@IdPeriodoTiempo [int],
	@EdadAnio [int],
	@EdadMes [int],
	@EdadDia [int],
	@Descripcion [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanAtencion (
IdAtenInteGrupo,IdPeriodoTiempo,EdadAnio,EdadMes,EdadDia,Descripcion) values (
@IdAtenInteGrupo,@IdPeriodoTiempo,@EdadAnio,@EdadMes,@EdadDia,@Descripcion)
set @IdPlanAtencion = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanAtencion,'AtenIntePlanAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanAtencionEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanAtencionEliminar]
	@IdPlanAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanAtencion
where IdPlanAtencion = @IdPlanAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanAtencion,'AtenIntePlanAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanAtencionModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanAtencionModificar]
	@IdPlanAtencion [int],
	@IdAtenInteGrupo [int],
	@IdPeriodoTiempo [int],
	@EdadAnio [int],
	@EdadMes [int],
	@EdadDia [int],
	@Descripcion [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlanAtencion
set
IdAtenInteGrupo = @IdAtenInteGrupo,
IdPeriodoTiempo = @IdPeriodoTiempo,
EdadAnio = @EdadAnio,
EdadMes = @EdadMes,
EdadDia = @EdadDia,
Descripcion = @Descripcion
where IdPlanAtencion = @IdPlanAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanAtencion,'AtenIntePlanAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanAtencionSeleccionarPorId]
	@IdPlanAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanAtencion
where IdPlanAtencion = @IdPlanAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecDetalleAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecDetalleAgregar]
	@IdItemPlanCrecimiento [bigint] OUTPUT,
	@IdTriajeVariable [int],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanCrecDetalle (
IdTriajeVariable,OrdenItem) values (
@IdTriajeVariable,@OrdenItem)
set @IdItemPlanCrecimiento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemPlanCrecimiento,'AtenIntePlanCrecDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecDetalleEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecDetalleEliminar]
	@IdItemPlanCrecimiento [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanCrecDetalle
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemPlanCrecimiento,'AtenIntePlanCrecDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecDetalleModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecDetalleModificar]
	@IdItemPlanCrecimiento [bigint],
	@IdTriajeVariable [int],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlanCrecDetalle
set
IdTriajeVariable = @IdTriajeVariable,
OrdenItem = @OrdenItem
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemPlanCrecimiento,'AtenIntePlanCrecDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecDetalleSeleccionarPorId]
	@IdItemPlanCrecimiento [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanCrecDetalle
where IdItemPlanCrecimiento = @IdItemPlanCrecimiento
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecimientoPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecimientoPacienteAgregar]
	@IdPlanCrecimientoPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroSesion [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanCrecimientoPaciente (
IdPlanIntegralPaciente,IdPlanAtencion,IdAtenInteItemPlan,FechaProgramada,FechaEjecucion,NumeroSesion,IdAtencion,IdEstablecimiento) values (
@IdPlanIntegralPaciente,@IdPlanAtencion,@IdAtenInteItemPlan,@FechaProgramada,@FechaEjecucion,@NumeroSesion,@IdAtencion,@IdEstablecimiento)
set @IdPlanCrecimientoPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecimientoPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecimientoPacienteEliminar]
	@IdPlanCrecimientoPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanCrecimientoPaciente
where IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecimientoPacienteModFechaProgramada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecimientoPacienteModFechaProgramada]
	@IdPlanCrecimientoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@FechaProgramada [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanCrecimientoPaciente SET
		FechaProgramada = @FechaProgramada
	WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPacienteModFechaProgramada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecimientoPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecimientoPacienteModificar]
	@IdPlanCrecimientoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroSesion [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanCrecimientoPaciente SET
		-- IdPlanIntegralPaciente = @IdPlanIntegralPaciente,
		-- IdPlanAtencion = @IdPlanAtencion,
		-- IdAtenInteItemPlan = @IdAtenInteItemPlan,
		-- FechaProgramada = @FechaProgramada,
		FechaEjecucion = @FechaEjecucion,
		-- NumeroSesion = @NumeroSesion,
		IdAtencion = @IdAtencion,
		IdEstablecimiento = @IdEstablecimiento
	WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecimientoPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecimientoPacienteSeleccionarPorId]
	@IdPlanCrecimientoPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanCrecimientoPaciente
where IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecimientoPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecPacienteDetAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecPacienteDetAgregar]
	@IdPlanCrecimientoPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@IdTriajeVariable [int],
	@VariableValor [money],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanCrecPacienteDet (
IdPlanIntegralPaciente,IdTriajeVariable,VariableValor,OrdenItem) values (
@IdPlanIntegralPaciente,@IdTriajeVariable,@VariableValor,@OrdenItem)
set @IdPlanCrecimientoPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecPacienteDet'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecPacienteDetAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecPacienteDetEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecPacienteDetEliminar]
	@IdPlanCrecimientoPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanCrecPacienteDet
where IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecPacienteDet'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecPacienteDetEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecPacienteDetModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecPacienteDetModificar]
	@IdPlanCrecimientoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@IdTriajeVariable [int],
	@VariableValor [money],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanCrecPacienteDet SET
	-- IdPlanIntegralPaciente = @IdPlanIntegralPaciente,
	-- IdTriajeVariable = @IdTriajeVariable,
	VariableValor = @VariableValor
	-- OrdenItem = @OrdenItem
	WHERE IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
		AND IdTriajeVariable = @IdTriajeVariable
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanCrecimientoPaciente,'AtenIntePlanCrecPacienteDet'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecPacienteDetModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanCrecPacienteDetSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanCrecPacienteDetSeleccionarPorId]
	@IdPlanCrecimientoPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanCrecPacienteDet
where IdPlanCrecimientoPaciente = @IdPlanCrecimientoPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanCrecPacienteDetSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesarrolloPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesarrolloPacienteAgregar]
	@IdPlanDesarrolloPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@Evaluacion [int],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroSesion [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanDesarrolloPaciente (
IdPlanIntegralPaciente,Evaluacion,IdPlanAtencion,IdAtenInteItemPlan,FechaProgramada,FechaEjecucion,NumeroSesion,IdAtencion,IdEstablecimiento) values (
@IdPlanIntegralPaciente,@Evaluacion,@IdPlanAtencion,@IdAtenInteItemPlan,@FechaProgramada,@FechaEjecucion,@NumeroSesion,@IdAtencion,@IdEstablecimiento)
set @IdPlanDesarrolloPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanDesarrolloPaciente,'AtenIntePlanDesarrolloPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesarrolloPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesarrolloPacienteEliminar]
	@IdPlanDesarrolloPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanDesarrolloPaciente
where IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanDesarrolloPaciente,'AtenIntePlanDesarrolloPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesarrolloPacienteModFechaProgramada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesarrolloPacienteModFechaProgramada]
	@IdPlanDesarrolloPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@FechaProgramada [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanDesarrolloPaciente SET
		FechaProgramada = @FechaProgramada
	WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPacienteModFechaProgramada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesarrolloPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesarrolloPacienteModificar]
	@IdPlanDesarrolloPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@Evaluacion [int],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroSesion [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanDesarrolloPaciente SET
		Evaluacion = @Evaluacion,
		-- IdPlanAtencion = @IdPlanAtencion,
		-- IdAtenInteItemPlan = @IdAtenInteItemPlan,
		-- FechaProgramada = @FechaProgramada,
		FechaEjecucion = @FechaEjecucion,
		-- NumeroSesion = @NumeroSesion,
		IdAtencion = @IdAtencion,
		IdEstablecimiento = @IdEstablecimiento
	WHERE IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesarrolloPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesarrolloPacienteSeleccionarPorId]
	@IdPlanDesarrolloPaciente [int],
	@IdPlanIntegralPaciente [bigint]
WITH EXECUTE AS CALLER
AS
SELECT IP.IdPlanDesarrolloPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		CASE ISNULL(IP.Evaluacion, 0) WHEN 0 THEN '' WHEN 1 THEN 'NORMAL' ELSE 'DEFICIT' END AS EvaluacionDesc,
		E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion, IP.Evaluacion,
		IP.IdAtenInteItemPlan
	FROM AtenIntePlanDesarrolloPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE IP.IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
			AND IP.IdPlanIntegralPaciente = @IdPlanIntegralPaciente;
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesarrolloPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesDetalleAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesDetalleAgregar]
	@IdItemPlanDesarrollo [bigint] OUTPUT,
	@IdItemDesarrollo [int],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanDesDetalle (
IdItemDesarrollo,OrdenItem) values (
@IdItemDesarrollo,@OrdenItem)
set @IdItemPlanDesarrollo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdItemPlanDesarrollo,'AtenIntePlanDesDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesDetalleEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesDetalleEliminar]
	@IdItemPlanDesarrollo [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanDesDetalle
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdItemPlanDesarrollo,'AtenIntePlanDesDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesDetalleModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesDetalleModificar]
	@IdItemPlanDesarrollo [bigint],
	@IdItemDesarrollo [int],
	@OrdenItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlanDesDetalle
set
IdItemDesarrollo = @IdItemDesarrollo,
OrdenItem = @OrdenItem
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdItemPlanDesarrollo,'AtenIntePlanDesDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesDetalleSeleccionarPorId]
	@IdItemPlanDesarrollo [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanDesDetalle
where IdItemPlanDesarrollo = @IdItemPlanDesarrollo
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesPacienteDetAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesPacienteDetAgregar]
	@IdPlanDesarrolloPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@IdItemDesarrollo [int],
	@OrdenItem [int],
	@EjecutaAccion [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanDesPacienteDet (
IdPlanIntegralPaciente,IdItemDesarrollo,OrdenItem,EjecutaAccion) values (
@IdPlanIntegralPaciente,@IdItemDesarrollo,@OrdenItem,@EjecutaAccion)
set @IdPlanDesarrolloPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanDesarrolloPaciente,'AtenIntePlanDesPacienteDet'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesPacienteDetAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesPacienteDetEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesPacienteDetEliminar]
	@IdPlanDesarrolloPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanDesPacienteDet
where IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanDesarrolloPaciente,'AtenIntePlanDesPacienteDet'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesPacienteDetEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesPacienteDetModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesPacienteDetModificar]
	@IdPlanDesarrolloPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@IdItemDesarrollo [int],
	@OrdenItem [int],
	@EjecutaAccion [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanDesPacienteDet SET
		-- OrdenItem = @OrdenItem,
		EjecutaAccion = @EjecutaAccion
	where IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
		AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
		AND IdItemDesarrollo = @IdItemDesarrollo
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesPacienteDetModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanDesPacienteDetSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanDesPacienteDetSeleccionarPorId]
	@IdPlanDesarrolloPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanDesPacienteDet
where IdPlanDesarrolloPaciente = @IdPlanDesarrolloPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanDesPacienteDetSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanIntegralPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanIntegralPacienteAgregar]
	@IdPlanIntegralPaciente [bigint] OUTPUT,
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@FechaElaboracion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanIntegralPaciente (
IdAtenInteGrupo,IdPaciente,FechaElaboracion) values (
@IdAtenInteGrupo,@IdPaciente,@FechaElaboracion)
set @IdPlanIntegralPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanIntegralPaciente,'AtenIntePlanIntegralPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanIntegralPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanIntegralPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanIntegralPacienteEliminar]
	@IdPlanIntegralPaciente [bigint],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanIntegralPaciente
where IdPlanIntegralPaciente = @IdPlanIntegralPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanIntegralPaciente,'AtenIntePlanIntegralPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanIntegralPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanIntegralPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanIntegralPacienteModificar]
	@IdPlanIntegralPaciente [bigint],
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@FechaElaboracion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlanIntegralPaciente
set
IdAtenInteGrupo = @IdAtenInteGrupo,
IdPaciente = @IdPaciente,
FechaElaboracion = @FechaElaboracion
where IdPlanIntegralPaciente = @IdPlanIntegralPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanIntegralPaciente,'AtenIntePlanIntegralPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanIntegralPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanIntegralPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanIntegralPacienteSeleccionarPorId]
	@IdPlanIntegralPaciente [bigint]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanIntegralPaciente
where IdPlanIntegralPaciente = @IdPlanIntegralPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanIntegralPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanItemElaboradoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanItemElaboradoAgregar]
	@IdAtenInteItemPlan [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@EsElaborado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanItemElaborado (
IdPlanIntegralPaciente,EsElaborado) values (
@IdPlanIntegralPaciente,@EsElaborado)
set @IdAtenInteItemPlan = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdAtenInteItemPlan,'AtenIntePlanItemElaborado'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanItemElaboradoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanItemElaboradoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanItemElaboradoEliminar]
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanItemElaborado
where IdAtenInteItemPlan = @IdAtenInteItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtenInteItemPlan,'AtenIntePlanItemElaborado'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanItemElaboradoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanItemElaboradoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanItemElaboradoModificar]
	@IdAtenInteItemPlan [int],
	@IdPlanIntegralPaciente [bigint],
	@EsElaborado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlanItemElaborado
set
IdPlanIntegralPaciente = @IdPlanIntegralPaciente,
EsElaborado = @EsElaborado
where IdAtenInteItemPlan = @IdAtenInteItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdAtenInteItemPlan,'AtenIntePlanItemElaborado'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanItemElaboradoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanItemElaboradoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanItemElaboradoSeleccionarPorId]
	@IdAtenInteItemPlan [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanItemElaborado
where IdAtenInteItemPlan = @IdAtenInteItemPlan
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanItemElaboradoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanProcedimientoPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanProcedimientoPacienteAgregar]
	@IdPlanProcedimientoPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@IdProducto [int],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroDosis [tinyint],
	@CodigoHIS [varchar](7),
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanProcedimientoPaciente (
IdPlanIntegralPaciente,IdProducto,IdPlanAtencion,IdAtenInteItemPlan,FechaProgramada,FechaEjecucion,NumeroDosis,CodigoHIS,IdAtencion,IdEstablecimiento) values (
@IdPlanIntegralPaciente,@IdProducto,@IdPlanAtencion,@IdAtenInteItemPlan,@FechaProgramada,@FechaEjecucion,@NumeroDosis,@CodigoHIS,@IdAtencion,@IdEstablecimiento)
set @IdPlanProcedimientoPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanProcedimientoPaciente,'AtenIntePlanProcedimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanProcedimientoPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanProcedimientoPacienteEliminar]
	@IdPlanProcedimientoPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanProcedimientoPaciente
where IdPlanProcedimientoPaciente = @IdPlanProcedimientoPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanProcedimientoPaciente,'AtenIntePlanProcedimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanProcedimientoPacienteModFechaProgramada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanProcedimientoPacienteModFechaProgramada]
	@IdPlanProcedimientoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@FechaProgramada [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanProcedimientoPaciente SET
		FechaProgramada = @FechaProgramada
	WHERE IdPlanProcedimientoPaciente = @IdPlanProcedimientoPaciente
			AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanProcedimientoPaciente,'AtenIntePlanProcedimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPacienteModFechaProgramada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanProcedimientoPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanProcedimientoPacienteModificar]
	@IdPlanProcedimientoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@IdProducto [int],
	@IdPlanAtencion [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroDosis [tinyint],
	@CodigoHIS [varchar](7),
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanProcedimientoPaciente SET
		IdProducto = @IdProducto,
		-- IdPlanAtencion = @IdPlanAtencion,
		-- IdAtenInteItemPlan = @IdAtenInteItemPlan,
		-- FechaProgramada = @FechaProgramada,
		FechaEjecucion = @FechaEjecucion,
		-- NumeroDosis = @NumeroDosis,
		CodigoHIS = @CodigoHIS,
		IdAtencion = @IdAtencion,
		IdEstablecimiento = @IdEstablecimiento
	WHERE IdPlanProcedimientoPaciente = @IdPlanProcedimientoPaciente
			AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanProcedimientoPaciente,'AtenIntePlanProcedimientoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanProcedimientoPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanProcedimientoPacienteSeleccionarPorId]
	@IdPlanProcedimientoPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanProcedimientoPaciente
where IdPlanProcedimientoPaciente = @IdPlanProcedimientoPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanProcedimientoPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanSuplementoPacienteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanSuplementoPacienteAgregar]
	@IdPlanSuplementoPaciente [int] OUTPUT,
	@IdPlanIntegralPaciente [bigint],
	@IdPlanAtencion [int],
	@IdProducto [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroDosis [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlanSuplementoPaciente (
IdPlanIntegralPaciente,IdPlanAtencion,IdProducto,IdAtenInteItemPlan,FechaProgramada,FechaEjecucion,NumeroDosis,IdAtencion,IdEstablecimiento) values (
@IdPlanIntegralPaciente,@IdPlanAtencion,@IdProducto,@IdAtenInteItemPlan,@FechaProgramada,@FechaEjecucion,@NumeroDosis,@IdAtencion,@IdEstablecimiento)
set @IdPlanSuplementoPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanSuplementoPaciente,'AtenIntePlanSuplementoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanSuplementoPacienteEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanSuplementoPacienteEliminar]
	@IdPlanSuplementoPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlanSuplementoPaciente
where IdPlanSuplementoPaciente = @IdPlanSuplementoPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanSuplementoPaciente,'AtenIntePlanSuplementoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanSuplementoPacienteModFechaProgramada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanSuplementoPacienteModFechaProgramada]
	@IdPlanSuplementoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@FechaProgramada [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanSuplementoPaciente SET
		FechaProgramada = @FechaProgramada
	WHERE IdPlanSuplementoPaciente = @IdPlanSuplementoPaciente
			AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanSuplementoPaciente,'AtenIntePlanSuplementoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPacienteModFechaProgramada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanSuplementoPacienteModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanSuplementoPacienteModificar]
	@IdPlanSuplementoPaciente [int],
	@IdPlanIntegralPaciente [bigint],
	@IdPlanAtencion [int],
	@IdProducto [int],
	@IdAtenInteItemPlan [int],
	@FechaProgramada [datetime],
	@FechaEjecucion [datetime],
	@NumeroDosis [int],
	@IdAtencion [int],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE AtenIntePlanSuplementoPaciente SET
		-- IdPlanAtencion = @IdPlanAtencion,
		-- IdProducto = @IdProducto,
		-- IdAtenInteItemPlan = @IdAtenInteItemPlan,
		-- FechaProgramada = @FechaProgramada,
		FechaEjecucion = @FechaEjecucion,
		-- NumeroDosis = @NumeroDosis,
		IdAtencion = @IdAtencion,
		IdEstablecimiento = @IdEstablecimiento
	WHERE IdPlanSuplementoPaciente = @IdPlanSuplementoPaciente
			AND IdPlanIntegralPaciente = @IdPlanIntegralPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanSuplementoPaciente,'AtenIntePlanSuplementoPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlanSuplementoPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlanSuplementoPacienteSeleccionarPorId]
	@IdPlanSuplementoPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlanSuplementoPaciente
where IdPlanSuplementoPaciente = @IdPlanSuplementoPaciente
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlanSuplementoPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlantillaItemPlanAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlantillaItemPlanAgregar]
	@IdPlantillaItemPlan [int] OUTPUT,
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePlantillaItemPlan (
IdAtenInteGrupo,IdAtenInteItemPlan) values (
@IdAtenInteGrupo,@IdAtenInteItemPlan)
set @IdPlantillaItemPlan = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlantillaItemPlan,'AtenIntePlantillaItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlantillaItemPlanAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlantillaItemPlanEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlantillaItemPlanEliminar]
	@IdPlantillaItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePlantillaItemPlan
where IdPlantillaItemPlan = @IdPlantillaItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlantillaItemPlan,'AtenIntePlantillaItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlantillaItemPlanEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlantillaItemPlanModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlantillaItemPlanModificar]
	@IdPlantillaItemPlan [int],
	@IdAtenInteGrupo [int],
	@IdAtenInteItemPlan [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePlantillaItemPlan
set
IdAtenInteGrupo = @IdAtenInteGrupo,
IdAtenInteItemPlan = @IdAtenInteItemPlan
where IdPlantillaItemPlan = @IdPlantillaItemPlan
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlantillaItemPlan,'AtenIntePlantillaItemPlan'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlantillaItemPlanModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePlantillaItemPlanSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePlantillaItemPlanSeleccionarPorId]
	@IdPlantillaItemPlan [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePlantillaItemPlan
where IdPlantillaItemPlan = @IdPlantillaItemPlan
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePlantillaItemPlanSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePreguntaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePreguntaAgregar]
	@IdPregunta [int] OUTPUT,
	@Pregunta [varchar](70),
	@TipoRespuesta [int],
	@TipoValorRespuesta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenIntePregunta (
Pregunta,TipoRespuesta,TipoValorRespuesta) values (
@Pregunta,@TipoRespuesta,@TipoValorRespuesta)
set @IdPregunta = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPregunta,'AtenIntePregunta'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePreguntaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePreguntaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePreguntaEliminar]
	@IdPregunta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenIntePregunta
where IdPregunta = @IdPregunta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPregunta,'AtenIntePregunta'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePreguntaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePreguntaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePreguntaModificar]
	@IdPregunta [int],
	@Pregunta [varchar](70),
	@TipoRespuesta [int],
	@TipoValorRespuesta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenIntePregunta
set
Pregunta = @Pregunta,
TipoRespuesta = @TipoRespuesta,
TipoValorRespuesta = @TipoValorRespuesta
where IdPregunta = @IdPregunta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPregunta,'AtenIntePregunta'
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePreguntaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenIntePreguntaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenIntePreguntaSeleccionarPorId]
	@IdPregunta [int]
WITH EXECUTE AS CALLER
AS
select * from AtenIntePregunta
where IdPregunta = @IdPregunta
GO
ALTER AUTHORIZATION ON [dbo].[AtenIntePreguntaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteTriajeVariablePacientePendiente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteTriajeVariablePacientePendiente]
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdAtenInteItemPlan [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT TOP 1 IP.IdPlanCrecimientoPaciente, IP.IdPlanIntegralPaciente, IP.IdPlanAtencion,
		PA.Descripcion, IP.FechaProgramada, IP.FechaEjecucion, IP.NumeroSesion,
		PA.EdadAnio, PA.EdadMes, PA.EdadDia,
		E.IdEstablecimiento, E.Nombre AS Establecimiento, IP.IdAtencion
	FROM AtenIntePlanCrecimientoPaciente AS IP
		INNER JOIN AtenIntePlanIntegralPaciente AS PP ON IP.IdPlanIntegralPaciente = PP.IdPlanIntegralPaciente
		INNER JOIN AtenIntePlanAtencion AS PA ON IP.IdPlanAtencion = PA.IdPlanAtencion
		LEFT JOIN Establecimientos As E ON E.IdEstablecimiento = IP.IdEstablecimiento
	WHERE (PP.IdAtenInteGrupo = @IdAtenInteGrupo AND PP.IdPaciente = @IdPaciente
		AND IP.FechaEjecucion IS NULL AND IP.FechaProgramada <= getDate())
		OR IP.IdAtencion = @IdAtencion ORDER BY IP.FechaProgramada DESC;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteTriajeVariablePacientePendiente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorPesoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorPesoAgregar]
	@IdValorPeso [int] OUTPUT,
	@IdTipoSexo [int],
	@EdadMeses [int],
	@NroDesviacion [int],
	@ValorPeso [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteValorPeso (
IdTipoSexo,EdadMeses,NroDesviacion,ValorPeso) values (
@IdTipoSexo,@EdadMeses,@NroDesviacion,@ValorPeso)
set @IdValorPeso = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdValorPeso,'AtenInteValorPeso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPesoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorPesoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorPesoEliminar]
	@IdValorPeso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteValorPeso
where IdValorPeso = @IdValorPeso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdValorPeso,'AtenInteValorPeso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPesoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorPesoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorPesoModificar]
	@IdValorPeso [int],
	@IdTipoSexo [int],
	@EdadMeses [int],
	@NroDesviacion [int],
	@ValorPeso [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteValorPeso
set
IdTipoSexo = @IdTipoSexo,
EdadMeses = @EdadMeses,
NroDesviacion = @NroDesviacion,
ValorPeso = @ValorPeso
where IdValorPeso = @IdValorPeso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdValorPeso,'AtenInteValorPeso'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPesoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorPesoPorSexoYDesviacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorPesoPorSexoYDesviacion]
	@InIdTipoSexo [int],
	@NroDesviacion [int]
WITH EXECUTE AS CALLER
AS
SELECT IdValorPeso, IdTipoSexo, EdadMeses, NroDesviacion, ValorPeso
	FROM AtenInteValorPeso
	WHERE IdTipoSexo = @InIdTipoSexo AND NroDesviacion = @NroDesviacion
	ORDER BY EdadMeses;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPesoPorSexoYDesviacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorPesoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorPesoSeleccionarPorId]
	@IdValorPeso [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteValorPeso
where IdValorPeso = @IdValorPeso
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorPesoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorTallaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorTallaAgregar]
	@IdValorTalla [int] OUTPUT,
	@IdTipoSexo [int],
	@EdadMeses [int],
	@NroDesviacion [int],
	@ValorTalla [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into AtenInteValorTalla (
IdTipoSexo,EdadMeses,NroDesviacion,ValorTalla) values (
@IdTipoSexo,@EdadMeses,@NroDesviacion,@ValorTalla)
set @IdValorTalla = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdValorTalla,'AtenInteValorTalla'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTallaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorTallaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorTallaEliminar]
	@IdValorTalla [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from AtenInteValorTalla
where IdValorTalla = @IdValorTalla
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdValorTalla,'AtenInteValorTalla'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTallaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorTallaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorTallaModificar]
	@IdValorTalla [int],
	@IdTipoSexo [int],
	@EdadMeses [int],
	@NroDesviacion [int],
	@ValorTalla [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update AtenInteValorTalla
set
IdTipoSexo = @IdTipoSexo,
EdadMeses = @EdadMeses,
NroDesviacion = @NroDesviacion,
ValorTalla = @ValorTalla
where IdValorTalla = @IdValorTalla
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdValorTalla,'AtenInteValorTalla'
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTallaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorTallaPorSexoYDesviacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorTallaPorSexoYDesviacion]
	@InIdTipoSexo [int],
	@NroDesviacion [int]
WITH EXECUTE AS CALLER
AS
SELECT IdValorTalla, IdTipoSexo, EdadMeses, NroDesviacion, ValorTalla
	FROM AtenInteValorTalla
	WHERE IdTipoSexo = @InIdTipoSexo AND NroDesviacion = @NroDesviacion
	ORDER BY EdadMeses;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTallaPorSexoYDesviacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteValorTallaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteValorTallaSeleccionarPorId]
	@IdValorTalla [int]
WITH EXECUTE AS CALLER
AS
select * from AtenInteValorTalla
where IdValorTalla = @IdValorTalla
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteValorTallaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteVerificaIngresaPlanIntegralPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteVerificaIngresaPlanIntegralPaciente]
	@IdPlanIntegralPaciente [bigint] OUTPUT,
	@IdAtenInteGrupo [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
SET @IdPlanIntegralPaciente = (SELECT IdPlanIntegralPaciente FROM AtenIntePlanIntegralPaciente
							WHERE IdPaciente = @IdPaciente AND IdAtenInteGrupo = @IdAtenInteGrupo);

	IF @IdPlanIntegralPaciente IS NULL
	BEGIN

		INSERT INTO AtenIntePlanIntegralPaciente (IdPaciente,
			IdAtenInteGrupo, FechaElaboracion)
		VALUES (@IdPaciente,
			@IdAtenInteGrupo, getDate())

		SET @IdPlanIntegralPaciente = @@IDENTITY;
	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteVerificaIngresaPlanIntegralPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AtenInteVerificaIngresaPreguntaPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AtenInteVerificaIngresaPreguntaPaciente]
	@IdGrupoHCPaciente [int] OUTPUT,
	@IdPaciente [int],
	@IdAtenInteGrupo [int],
	@IdPregunta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
SET @IdGrupoHCPaciente = (SELECT IdGrupoHCPaciente FROM AtenInteGrupoHCPaciente
							WHERE IdPaciente = @IdPaciente AND IdAtenInteGrupo = @IdAtenInteGrupo
								AND IdPregunta = @IdPregunta);
	IF @IdGrupoHCPaciente IS NULL
	BEGIN
		SET @IdGrupoHCPaciente = ISNULL((SELECT MAX(IdGrupoHCPaciente) + 1 FROM AtenInteGrupoHCPaciente
							WHERE IdPaciente = @IdPaciente), 1);

		INSERT INTO AtenInteGrupoHCPaciente (IdPaciente,
			IdGrupoHCPaciente, IdAtenInteGrupo, IdPregunta)
		VALUES (@IdPaciente,
			@IdGrupoHCPaciente, @IdAtenInteGrupo, @IdPregunta)

	END;
GO
ALTER AUTHORIZATION ON [dbo].[AtenInteVerificaIngresaPreguntaPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AuditoriaAgregar]
	@IdEmpleado [int],
	@Accion [char](1),
	@IdRegistro [int],
	@Tabla [varchar](50)
WITH EXECUTE AS CALLER
AS
insert into Auditoria (
IdEmpleado,Accion,IdRegistro,Tabla,FechaHora) values (
@IdEmpleado,@Accion,@IdRegistro,@Tabla,getdate())
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaAgregarV]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaAgregarV]
	@IdEmpleado [int],
	@Accion [char](1),
	@IdRegistro [int],
	@Tabla [varchar](50),
	@idListItem [int],
	@nombrePC [varchar](30),
	@observaciones [varchar](100)
WITH EXECUTE AS CALLER
AS
insert into Auditoria (
IdEmpleado,Accion,IdRegistro,Tabla,FechaHora,idListItem,nombrePC,observaciones) values (
@IdEmpleado,@Accion,@IdRegistro,@Tabla,getdate(),@idListItem,@nombrePC,@observaciones)
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaAgregarV] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AuditoriaEliminar]
	@IdAuditoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Auditoria
where IdAuditoria = @IdAuditoria
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaFiltrarCitasPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaFiltrarCitasPorIdAtencion]
	@idAtencion [int],
	@idListItem [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.Usuario, dbo.Auditoria.nombrePc,dbo.Auditoria.FechaHora ,
           ltrim(dbo.Empleados.ApellidoPaterno)+' '+ltrim(dbo.Empleados.ApellidoMaterno )+' '+dbo.Empleados.Nombres as dUsuario
FROM         dbo.Auditoria INNER JOIN
                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE     (dbo.Auditoria.IdRegistro =  @idAtencion) and (dbo.Auditoria.idListItem = @idListItem) AND (dbo.Auditoria.Accion = 'A')
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaFiltrarCitasPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaFiltrarIdListItem]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaFiltrarIdListItem]
	@idListItem [int]
WITH EXECUTE AS CALLER
AS
SELECT   top 1  dbo.Empleados.Usuario, dbo.Auditoria.nombrePc,dbo.Auditoria.FechaHora ,
           ltrim(dbo.Empleados.ApellidoPaterno)+' '+ltrim(dbo.Empleados.ApellidoMaterno )+' '+dbo.Empleados.Nombres as dUsuario
FROM         dbo.Auditoria INNER JOIN
                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE      (dbo.Auditoria.idListItem = @idListItem) AND (dbo.Auditoria.Accion = 'A')
order by  dbo.Auditoria.FechaHora desc
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaFiltrarIdListItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaFiltrarSoloRecalculos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AuditoriaFiltrarSoloRecalculos]
WITH EXECUTE AS CALLER
AS
select * from auditoria where tabla='Recalculó Cta' and idListItem=613 order by idRegistro
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaFiltrarSoloRecalculos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaInsertaDesdeReniec]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AuditoriaInsertaDesdeReniec]
	@FechaServidor [datetime],
	@DniAbuscar [int],
	@IdEmpleado [int],
	@NombrePC [varchar](30),
	@Observaciones [varchar](100)
WITH EXECUTE AS CALLER
AS
insert auditoria (fechaHora,tabla,idRegistro,accion,idEmpleado,IdListItem,nombrepc,observaciones)
values (@FechaServidor,'ConsultaReniec',@DniAbuscar,'A', @IdEmpleado,9999, @NombrePC,@Observaciones)
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaInsertaDesdeReniec] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[AuditoriaModificar]
	@IdEmpleado [int],
	@Accion [char](1),
	@IdRegistro [int],
	@Tabla [varchar](50),
	@IdAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Auditoria
set
IdEmpleado = @IdEmpleado,
Accion = @Accion,
IdRegistro = @IdRegistro,
Tabla = @Tabla,
FechaHora = getdate()
where IdAuditoria = @IdAuditoria
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaPorFechasUsuario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaPorFechasUsuario]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idUsuario [int]
WITH EXECUTE AS CALLER
AS
if @idUsuario=0
	SELECT     dbo.Auditoria.*,  dbo.Empleados.ApellidoPaterno,
	                      dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.Usuario
	FROM         dbo.Auditoria LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
             WHERE         (dbo.Auditoria.FechaHora BETWEEN  @FechaInicio and  @FechaFin)
	ORDER BY  dbo.Auditoria.FechaHora, dbo.Auditoria.idListItem desc
else
	SELECT     dbo.Auditoria.*,  dbo.Empleados.ApellidoPaterno,
	                      dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.Usuario
	FROM         dbo.Auditoria LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
             WHERE    (dbo.Auditoria.FechaHora BETWEEN  @FechaInicio and  @FechaFin) AND dbo.Auditoria.IdEmpleado=@idUsuario
	ORDER BY  dbo.Auditoria.FechaHora, dbo.Auditoria.idListItem desc

--if @idUsuario=0
--	SELECT     dbo.Auditoria.FechaHora, dbo.Auditoria.Tabla, dbo.Auditoria.IdRegistro, dbo.Auditoria.Accion, dbo.Empleados.ApellidoPaterno,
--	                      dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.Usuario
--	FROM         dbo.Auditoria LEFT OUTER JOIN
--	                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
 --            WHERE         (dbo.Auditoria.FechaHora BETWEEN  @FechaInicio and  @FechaFin)
--	ORDER BY  dbo.Auditoria.FechaHora
--else
--	SELECT     dbo.Auditoria.FechaHora, dbo.Auditoria.Tabla, dbo.Auditoria.IdRegistro, dbo.Auditoria.Accion, dbo.Empleados.ApellidoPaterno,
--	                      dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.Usuario
--	FROM         dbo.Auditoria LEFT OUTER JOIN
--	                      dbo.Empleados ON dbo.Auditoria.IdEmpleado = dbo.Empleados.IdEmpleado
 --            WHERE    (dbo.Auditoria.FechaHora BETWEEN  @FechaInicio and  @FechaFin) AND dbo.Auditoria.IdEmpleado=@idUsuario
--	ORDER BY  dbo.Auditoria.FechaHora
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaPorFechasUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaPorTabla]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaPorTabla]
	@tabla [varchar](50)
WITH EXECUTE AS CALLER
AS
select top 20 * from auditoria where tabla=@tabla ORDER by FechaHora desc
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaPorTabla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaPorTablaFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaPorTablaFechas]
	@tabla [varchar](50),
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
select * from auditoria where tabla=@tabla and (FechaHora BETWEEN  @FechaInicio and  @FechaFin)
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaPorTablaFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AuditoriaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AuditoriaSeleccionarPorId]
	@IdAuditoria [int]
WITH EXECUTE AS CALLER
AS
select * from Auditoria
where IdAuditoria = @IdAuditoria
GO
ALTER AUTHORIZATION ON [dbo].[AuditoriaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AveriguaConsumosDeConsultoriosExternos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AveriguaConsumosDeConsultoriosExternos]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT LabMovimientoLaboratorio.idCuentaAtencion, LabMovimientoCPT.* ,LabMovimientoLaboratorio.Eo_EG
FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio, atenciones
WHERE LabMovimientoCPT.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimientoLaboratorio.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103)
AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
AND LabMovimiento.idLabEstado<>0 AND LabMovimientoCPT.IdProductoCPT=@IdProducto
AND atenciones.idtiposervicio=1 AND atenciones.idCuentaAtencion=LabMovimientoLaboratorio.idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AveriguaConsumosDeConsultoriosExternos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AveriguaConsumosDeEmergencia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AveriguaConsumosDeEmergencia]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT LabMovimientoLaboratorio.idCuentaAtencion, LabMovimientoCPT.* ,LabMovimientoLaboratorio.Eo_EG
FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio, atenciones
WHERE LabMovimientoCPT.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimientoLaboratorio.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
AND LabMovimiento.idLabEstado<>0 AND LabMovimientoCPT.IdProductoCPT=@IdProducto
AND (atenciones.idtiposervicio=2 OR atenciones.idtiposervicio=4) AND atenciones.idCuentaAtencion=LabMovimientoLaboratorio.idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AveriguaConsumosDeEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AveriguaConsumosDeExternos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AveriguaConsumosDeExternos]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT LabMovimientoLaboratorio.idCuentaAtencion, LabMovimientoCPT.* ,LabMovimientoLaboratorio.Eo_EG
FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
WHERE LabMovimientoCPT.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimientoLaboratorio.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103)
AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
AND LabMovimiento.idLabEstado<>0 AND LabMovimientoCPT.IdProductoCPT=@IdProducto
and LabMovimientoLaboratorio.idCuentaAtencion IS NULL
GO
ALTER AUTHORIZATION ON [dbo].[AveriguaConsumosDeExternos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[AveriguaConsumosDeHospitalizacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[AveriguaConsumosDeHospitalizacion]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT LabMovimientoLaboratorio.idCuentaAtencion, LabMovimientoCPT.* ,LabMovimientoLaboratorio.Eo_EG
FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio, atenciones
WHERE LabMovimientoCPT.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimientoLaboratorio.idMovimiento=LabMovimiento.idMovimiento
AND LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
AND LabMovimiento.idLabEstado<>0 AND LabMovimientoCPT.IdProductoCPT=@IdProducto
AND atenciones.idtiposervicio=3
AND atenciones.idCuentaAtencion=LabMovimientoLaboratorio.idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[AveriguaConsumosDeHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BloqueaTabla]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BloqueaTabla]
WITH EXECUTE AS CALLER
AS
select * from paises
GO
ALTER AUTHORIZATION ON [dbo].[BloqueaTabla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BoletasDeFarmaciaParaSOATxCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BoletasDeFarmaciaParaSOATxCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdPaciente, dbo.Pacientes.NroHistoriaClinica,
                                  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.FactCatalogoBienesInsumos.Codigo,
                                  dbo.FactCatalogoBienesInsumos.Nombre, dbo.FacturacionBienesPagos.CantidadPagar AS cantidad,
                                  dbo.FacturacionBienesPagos.PrecioVenta AS precio, dbo.FacturacionBienesPagos.TotalPagar AS total, dbo.FacturacionBienesPagos.IdProducto
             FROM         dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                                  dbo.FactOrdenesBienes INNER JOIN
                                  dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago ON
                                  dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
             WHERE  dbo.CajaComprobantesPago.IdTipoOrden<>1 and dbo.CajaComprobantesPago.IdEstadoComprobante=4 and dbo.CajaComprobantesPago.IdCuentaAtencion= @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[BoletasDeFarmaciaParaSOATxCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BoletasDeServicioParaSOATxCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BoletasDeServicioParaSOATxCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdPaciente, dbo.Pacientes.NroHistoriaClinica,
                                 dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.FactCatalogoServicios.Codigo,
                                 dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioPagos.Cantidad, dbo.FacturacionServicioPagos.Precio,
                                 dbo.FacturacionServicioPagos.Total, dbo.FacturacionServicioPagos.idProducto
FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                 dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                 dbo.Pacientes RIGHT OUTER JOIN
                                 dbo.CajaComprobantesPago ON dbo.Pacientes.IdPaciente = dbo.CajaComprobantesPago.IdPaciente RIGHT OUTER JOIN
                                 dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                 dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago
WHERE  dbo.CajaComprobantesPago.IdTipoOrden=1 and dbo.CajaComprobantesPago.IdEstadoComprobante=4 and dbo.CajaComprobantesPago.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[BoletasDeServicioParaSOATxCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaAtencionesCE]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BuscaAtencionesCE]
	@lcFechaAtencionInicial [datetime],
	@lcFechaAtencionFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Servicios.Nombre AS servicio, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdMedicoIngreso,
                      dbo.Especialidades.Nombre AS Especialidad, dbo.DepartamentosHospital.Nombre AS dpto, dbo.Atenciones.IdDestinoAtencion,
                      dbo.Atenciones.HoraEgreso
FROM         dbo.DepartamentosHospital RIGHT OUTER JOIN
                      dbo.Especialidades ON dbo.DepartamentosHospital.IdDepartamento = dbo.Especialidades.IdDepartamento FULL OUTER JOIN
                      dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad FULL OUTER JOIN
                      dbo.Citas RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso
Where (dbo.Atenciones.IdTipoServicio = 1) and dbo.Atenciones.IdEstadoAtencion<>0 and not (dbo.Citas.IdCita is null)
                        and  dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@lcFechaAtencionInicial,103)) and (CONVERT(DATETIME, @lcFechaAtencionFinal,103))
order by dbo.DepartamentosHospital.Nombre,dbo.Especialidades.Nombre,dbo.Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[BuscaAtencionesCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaAtencionesCptCEparaFormatoHIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[BuscaAtencionesCptCEparaFormatoHIS]
	@lnIdCuentaAtencion [int],
	@lnIdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                     FacturacionServicioDespacho.labConfHIS,
                                     dbo.FacturacionServicioDespacho.Cantidad, dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total,
                                     dbo.FactOrdenServicio.IdCuentaAtencion,dbo.FactOrdenServicio.IdOrden,dbo.FactOrdenServicio.idServicioPaciente as idServicio,
                                    dbo.FacturacionServicioDespacho.grupoHIS,dbo.FacturacionServicioDespacho.subGrupoHIS
                FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                     dbo.FacturacionServicioDespacho ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
                                     dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden
                Where (dbo.FactOrdenServicio.idPuntoCarga = @lnIdPuntoCarga) And (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9)
                      and dbo.FactOrdenServicio.IdCuentaAtencion=@lnIdCuentaAtencion
                ORDER BY dbo.FactCatalogoServicios.Codigo
GO
ALTER AUTHORIZATION ON [dbo].[BuscaAtencionesCptCEparaFormatoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaAtencionesDxCEparaFormatoHIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BuscaAtencionesDxCEparaFormatoHIS]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDiagnosticos.*, dbo.Diagnosticos.Descripcion as dDiagnostico, dbo.Diagnosticos.CodigoCIE2004 as CodigoCIE10
FROM         dbo.AtencionesDiagnosticos INNER JOIN dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
WHERE dbo.AtencionesDiagnosticos.idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[BuscaAtencionesDxCEparaFormatoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaCEAtencionesDx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BuscaCEAtencionesDx]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select SubClasificacionDiagnosticos.IdClasificacionDx,SubClasificacionDiagnosticos.IdSubClasificacionDx,
                       Diagnosticos.CodigoCIE2004 as CodigoDx, Diagnosticos.descripcion as DescripcionDx
                 from  (SubClasificacionDiagnosticos left join AtencionesDiagnosticos on SubClasificacionDiagnosticos.IdSubClasificacionDx = AtencionesDiagnosticos.IdSubClasificacionDx
                         and SubClasificacionDiagnosticos.IdClasificacionDx = AtencionesDiagnosticos.IdClasificacionDx
                         and AtencionesDiagnosticos.IdAtencion = @idAtencion) left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
                 WHERE     (dbo.SubclasificacionDiagnosticos.IdTipoServicio = 1) AND (dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx = 102)
                 order by SubClasificacionDiagnosticos.IdSubClasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[BuscaCEAtencionesDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaDx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BuscaDx]
	@FechaAtencionInicial [datetime],
	@FechaAtencionFinal [datetime],
	@lnIdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
If @lnIdEspecialidad > 0
	BEGIN
		   SELECT dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE10, dbo.Diagnosticos.Descripcion,
	                               dbo.Atenciones.FechaIngreso, dbo.AtencionesDiagnosticos.IdClasificacionDx, dbo.AtencionesDiagnosticos.IdSubclasificacionDx,
	                               dbo.Atenciones.IdTipoServicio , dbo.Servicios.IdServicio, dbo.Servicios.IdEspecialidad, dbo.Servicios.Nombre
	                 FROM    dbo.Servicios RIGHT OUTER JOIN
	                               dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso RIGHT OUTER JOIN
	                               dbo.AtencionesDiagnosticos LEFT OUTER JOIN
	                               dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico ON
	                               dbo.Atenciones.idAtencion = dbo.AtencionesDiagnosticos.idAtencion
	                 where    not (dbo.Diagnosticos.CodigoCIE10 is null ) and dbo.Atenciones.idTipoServicio=1 and dbo.AtencionesDiagnosticos.IdSubclasificacionDx=102 and dbo.Atenciones.IdEstadoAtencion<>0
	                              and  dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@FechaAtencionInicial,103)) and (CONVERT(DATETIME,@FechaAtencionFinal,103))
			   and dbo.Servicios.IdEspecialidad=@lnIdEspecialidad
	END
Else
	BEGIN
		    SELECT dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE10, dbo.Diagnosticos.Descripcion,
	                               dbo.Atenciones.FechaIngreso, dbo.AtencionesDiagnosticos.IdClasificacionDx, dbo.AtencionesDiagnosticos.IdSubclasificacionDx,
	                               dbo.Atenciones.IdTipoServicio , dbo.Servicios.IdServicio, dbo.Servicios.IdEspecialidad, dbo.Servicios.Nombre
	                 FROM    dbo.Servicios RIGHT OUTER JOIN
	                               dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso RIGHT OUTER JOIN
	                               dbo.AtencionesDiagnosticos LEFT OUTER JOIN
	                               dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico ON
	                               dbo.Atenciones.idAtencion = dbo.AtencionesDiagnosticos.idAtencion
	                 where    not (dbo.Diagnosticos.CodigoCIE10 is null ) and dbo.Atenciones.idTipoServicio=1 and dbo.AtencionesDiagnosticos.IdSubclasificacionDx=102 and dbo.Atenciones.IdEstadoAtencion<>0
	                              and  dbo.Atenciones.FechaIngreso Between (CONVERT(DATETIME,@FechaAtencionInicial,103)) and (CONVERT(DATETIME,@FechaAtencionFinal,103))
	                 ORDER BY dbo.Diagnosticos.CodigoCIE10
	END
GO
ALTER AUTHORIZATION ON [dbo].[BuscaDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaOtrosCPTyExamenesparaFormatoHIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[BuscaOtrosCPTyExamenesparaFormatoHIS]
	@lnIdCuentaAtencion [int],
	@lnIdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactCatalogoServicios.IdProducto,
										 dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
										 dbo.FacturacionServicioDespacho.labConfHIS, dbo.FacturacionServicioDespacho.Cantidad,
										 dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total,
										 dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdOrden,
										 dbo.FacturacionServicioDespacho.GrupoHIS,
										 dbo.FacturacionServicioDespacho.SubGrupoHIS
				FROM            dbo.FactOrdenServicio INNER JOIN
										 dbo.FacturacionServicioDespacho ON
										 dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioDespacho.idOrden INNER JOIN
										 dbo.FactCatalogoServicios ON
										 dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto
                Where (dbo.FactOrdenServicio.idPuntoCarga = @lnIdPuntoCarga) And (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9)
                      and dbo.FactOrdenServicio.IdCuentaAtencion=@lnIdCuentaAtencion
                UNION ALL
		    SELECT dbo.RecetaCabecera.IdPuntoCarga,dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo,dbo.FactCatalogoServicios.Nombre,
					'' AS labConfHIS,1 AS Cantidad,0 as Precio,0 as Total,dbo.RecetaCabecera.idCuentaAtencion,0 as IdOrden,0 as grupoHIS,0 as subGrupoHIS
                FROM dbo.RecetaDetalle
				INNER JOIN dbo.RecetaCabecera on dbo.RecetaDetalle.idReceta=dbo.RecetaCabecera.idReceta
				INNER JOIN dbo.FactCatalogoServicios ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoServicios.IdProducto
                WHERE dbo.RecetaCabecera.idCuentaAtencion=@lnIdCuentaAtencion AND dbo.RecetaCabecera.IdPuntoCarga<>5
GO
ALTER AUTHORIZATION ON [dbo].[BuscaOtrosCPTyExamenesparaFormatoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[BuscaProductosPorVencer]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[BuscaProductosPorVencer]
	@FechaMaxima [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldoDetallado.idAlmacen, dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Lote,
                                      dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad, dbo.farmAlmacen.descripcion,
                                      dbo.FactCatalogoBienesInsumos.Nombre , dbo.FactCatalogoBienesInsumos.Codigo
                 FROM         dbo.farmSaldoDetallado LEFT OUTER JOIN
                                      dbo.farmAlmacen ON dbo.farmSaldoDetallado.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                 WHERE dbo.farmSaldoDetallado.cantidad>0  and not (dbo.farmAlmacen.codigoSismed is null)  AND  dbo.farmSaldoDetallado.fechaVencimiento Between (CONVERT(DATETIME,'01/01/2000',103)) and @FechaMaxima and
                       (select top 1    dbo.FarmSaldo.cantidad from dbo.FarmSaldo where dbo.FarmSaldo.idAlmacen=dbo.farmSaldoDetallado.idAlmacen and dbo.farmSaldo.idProducto=dbo.farmSaldoDetallado.idProducto and dbo.FarmSaldo.idTipoSalidaBienInsumo=dbo.farmSaldoDetallado.idTipoSalidaBienInsumo ) >0
                 ORDER BY dbo.farmAlmacen.descripcion, dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[BuscaProductosPorVencer] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaActualizaDatosDeFactura]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaActualizaDatosDeFactura]
	@SubTotal [money],
	@Ruc [char](11),
	@RazonSocial [varchar](50),
	@Igv [money],
	@Total [money],
	@FechaCobranza [datetime],
	@IdComprobantePagoActual [int],
	@TieneCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago
set Subtotal= @SubTotal
      ,ruc=@Ruc
      ,razonSocial=@RazonSocial
      ,igv= @Igv
     ,total= @Total
     ,IdEstadoComprobante=4
     ,fechaCobranza=@FechaCobranza
     ,TieneCredito=@TieneCredito
where idComprobantePago=@IdComprobantePagoActual
GO
ALTER AUTHORIZATION ON [dbo].[CajaActualizaDatosDeFactura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaActualizaDatosDeServicioYServicioPago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaActualizaDatosDeServicioYServicioPago]
	@IdComprobantePagoActual [int],
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
update FactOrdenServicioPagos set idEstadoFacturacion=4 where idComprobantePago=@IdComprobantePagoActual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FactOrdenServicio set idEstadoFacturacion=4 where idOrden=@IdOrden
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaActualizaDatosDeServicioYServicioPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaCajaAgregar]
	@Descripcion [varchar](250),
	@Codigo [varchar](10),
	@IdCaja [int] OUTPUT,
	@LoginPc [varchar](50),
	@ImpresoraDefault [varchar](50),
	@Impresora2 [varchar](50),
	@SerieImpresoraDefault [varchar](20),
	@SerieImpresora2 [varchar](20),
	@idTipoComprobante [int],
	@FormatoImp2Cinta [bit],
	@FormatoImpDefaultCinta [bit],
	@IdTipoComprobante2 [int],
	@idPartida [int],
	@idCentroCosto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaCaja (
Descripcion,Codigo,LoginPc,ImpresoraDefault,Impresora2,SerieImpresoraDefault,SerieImpresora2,idTipoComprobante,IdTipoComprobante2,FormatoImp2Cinta,FormatoImpDefaultCinta,idPartida,idCentroCosto) values (
@Descripcion,@Codigo,@LoginPc,@ImpresoraDefault,@Impresora2,@SerieImpresoraDefault,@SerieImpresora2,@idTipoComprobante,@IdTipoComprobante2,@FormatoImp2Cinta,@FormatoImpDefaultCinta,@idPartida,@idCentroCosto)
set @IdCaja = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaCajaEliminar]
	@IdCaja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaCaja
where IdCaja = @IdCaja
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCaja,'CajaCaja'
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaCajaModificar]
	@Descripcion [varchar](250),
	@Codigo [varchar](10),
	@IdCaja [int],
	@LoginPc [varchar](50),
	@ImpresoraDefault [varchar](50),
	@Impresora2 [varchar](50),
	@SerieImpresoraDefault [varchar](20),
	@SerieImpresora2 [varchar](20),
	@idTipoComprobante [int],
	@FormatoImp2Cinta [bit],
	@FormatoImpDefaultCinta [bit],
	@IdTipoComprobante2 [int],
	@idPartida [int],
	@idCentroCosto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaCaja
set
Descripcion = @Descripcion,
Codigo = @Codigo,
LoginPc=@LoginPc,
ImpresoraDefault=@ImpresoraDefault,
Impresora2=@Impresora2,
SerieImpresoraDefault=@SerieImpresoraDefault,
SerieImpresora2=@SerieImpresora2,
idTipoComprobante=@idTipoComprobante,
FormatoImp2Cinta=@FormatoImp2Cinta,
FormatoImpDefaultCinta=@FormatoImpDefaultCinta,
IdTipoComprobante2=@IdTipoComprobante2,
idPartida=@idPartida ,
idCentroCosto=@idCentroCosto
where IdCaja = @IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaSegunFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajaSegunFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL =  'Select * from CajaCaja where  ' +  @lcFiltro
else
   SET  @SQL =  'Select * from CajaCaja '


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajaSeleccionarPorId]
	@IdCaja [int]
WITH EXECUTE AS CALLER
AS
Select * from CajaCaja where IdCaja = @IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaSeleccionarPorNombrePC]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajaSeleccionarPorNombrePC]
	@LoginPc [varchar](50)
WITH EXECUTE AS CALLER
AS
select *
from CajaCaja
where loginPc=@LoginPc
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaSeleccionarPorNombrePC] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajaSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select IdCaja, Descripcion from CajaCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajeroRealizarFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajeroRealizarFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'Select s.IdCajero,case s.EstadoCajero when "1" then "Si" else "No" end as EstadoCajero ,  s.IdEmpleado, e.ApellidoPaterno,e.ApellidoMaterno,e.Nombres
                                 from CajaCajero s, Empleados e where s.IdEmpleado = e.IdEmpleado     '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroRealizarFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[cajacajeroSeleccionarSegunUsuarioYCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[cajacajeroSeleccionarSegunUsuarioYCaja]
	@IdCaja [int],
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
Select * from cajacajero where idempleado = @IdEmpleado
     and idCaja = @IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[cajacajeroSeleccionarSegunUsuarioYCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajeroSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajeroSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from CajaCajero
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajeroSeleccionarTodosParaLista]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaCajeroSeleccionarTodosParaLista]
WITH EXECUTE AS CALLER
AS
Select ca.IdCajero, e.ApellidoPaterno + ' ' + e.ApellidoMaterno + ' ' + e.Nombres as NombreCompleto from CajaCajero ca, Empleados e
            where ca.IdEmpleado = e.IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroSeleccionarTodosParaLista] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[cajacajeroSeleccionarXidEmpleado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[cajacajeroSeleccionarXidEmpleado]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
Select * from cajacajero where idempleado = @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[cajacajeroSeleccionarXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajeroSupervisorEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaCajeroSupervisorEliminar]
	@IdCajeroSupervisor [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaCajeroSupervisor
where IdCajeroSupervisor = @IdCajeroSupervisor
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCajeroSupervisor,'CajaCajeroSupervisor'
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroSupervisorEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaCajeroSupervisorSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaCajeroSupervisorSeleccionarPorId]
	@IdCajeroSupervisor [int]
WITH EXECUTE AS CALLER
AS
select * from CajaCajeroSupervisor
where IdCajeroSupervisor = @IdCajeroSupervisor
GO
ALTER AUTHORIZATION ON [dbo].[CajaCajeroSupervisorSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoAnuladosSunat]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoAnuladosSunat]
WITH EXECUTE AS CALLER
AS
select NroSerie ,nrodocumento,
(select top 1 FechaHora  from Auditoria where auditoria.IdRegistro=CajaComprobantesPago.IdComprobantePago
  and  auditoria.Accion='E' and Auditoria.idListItem=702   ) as fechaAnulacion
 from CajaComprobantesPago
where LEFT(nroSerie,1) in ('B','F') and IdEstadoComprobante =9 and YEAR(FechaCobranza)=YEAR(getdate())
order by fechaAnulacion
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoAnuladosSunat] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFechas]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
if @NroDocumento<>''
begin
	SELECT     dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial,
	                      dbo.CajaComprobantesPago.idTurno, dbo.CajaTurno.Descripcion, dbo.CajaComprobantesPago.idCaja, dbo.CajaCaja.Descripcion AS dCaja,
	                      dbo.CajaComprobantesPago.IdCajero, dbo.Empleados.IdEmpleado, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
	                      dbo.Empleados.Nombres, dbo.CajaComprobantesPago.idFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFormaPago,
	                      dbo.Pacientes.ApellidoPaterno AS Apaterno, dbo.Pacientes.ApellidoMaterno AS Amaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdCuentaAtencion,
	                      dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaEstadosComprobante.Descripcion AS dEstado, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajasTiposOrden.Descripcion AS dBienServicio, dbo.CajaComprobantesPago.idFarmacia, dbo.farmAlmacen.descripcion AS dFarmacia,
	                      dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaComprobantesPago.SubTotal,dbo.CajaComprobantesPago.Adelantos,dbo.CajaComprobantesPago.exoneraciones,
	                      dbo.CajaComprobantesPago.total,CajaComprobantesPago.ruc,dbo.CajaComprobantesPago.IdComprobantePago,dbo.Pacientes.IdPaciente,
	                      dbo.CajaComprobantesPago.Total,dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.IGV,dbo.CajaComprobantesPago.RUC,
	                      dbo.CajaComprobantesPago.DNI,dbo.CajaComprobantesPago.TieneCredito
	FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
	                      dbo.farmAlmacen ON dbo.CajaComprobantesPago.idFarmacia = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.CajasTiposOrden ON dbo.CajaComprobantesPago.IdTipoOrden = dbo.CajasTiposOrden.IdTipoOrden LEFT OUTER JOIN
	                      dbo.CajaEstadosComprobante ON
	                      dbo.CajaComprobantesPago.IdEstadoComprobante = dbo.CajaEstadosComprobante.IdEstadoComprobante LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.CajaComprobantesPago.idFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.CajaComprobantesPago.IdCajero = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
	                      dbo.CajaCaja ON dbo.CajaComprobantesPago.idCaja = dbo.CajaCaja.IdCaja LEFT OUTER JOIN
	                      dbo.CajaTurno ON dbo.CajaComprobantesPago.idTurno = dbo.CajaTurno.IdTurno
	where            dbo.CajaComprobantesPago.NroSerie=@NroSerie and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
             ORDER BY dbo.CajaComprobantesPago.FechaCobranza desc
  end
else
  begin
             --------------exec CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFechas '','','22/01/2009 00:00:00','22/01/2009 23:59:00'
	SELECT     dbo.CajaCaja.Descripcion AS Caja, dbo.CajaTurno.Descripcion AS Turno, dbo.CajaComprobantesPago.FechaCobranza AS Fecha,
	                      dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total, dbo.CajaComprobantesPago.IdCuentaAtencion,
	                      dbo.CajaEstadosComprobante.Descripcion AS Estado, dbo.Empleados.ApellidoPaterno AS CajeroApPat,
	                      dbo.Empleados.ApellidoMaterno AS CajeroApMat, dbo.Empleados.Nombres AS CajeroNombres, dbo.CajasTiposOrden.Descripcion AS BienServicio,
	                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.idTurno, dbo.CajaComprobantesPago.idCaja,
	                      dbo.CajaComprobantesPago.IdCajero, dbo.Empleados.IdEmpleado, dbo.CajaComprobantesPago.idFormaPago,
	                      dbo.TiposFinanciamiento.Descripcion AS dFormaPago, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajaComprobantesPago.idFarmacia, dbo.farmAlmacen.descripcion AS dFarmacia,dbo.CajaComprobantesPago.exoneraciones,
						  dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaComprobantesPago.subTotal,dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.IGV,
						  dbo.CajaComprobantesPago.RUC,dbo.CajaComprobantesPago.IdComprobantePago,dbo.CajaComprobantesPago.DNI ,dbo.CajaComprobantesPago.TieneCredito
	FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
	                      dbo.farmAlmacen ON dbo.CajaComprobantesPago.idFarmacia = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.CajasTiposOrden ON dbo.CajaComprobantesPago.IdTipoOrden = dbo.CajasTiposOrden.IdTipoOrden LEFT OUTER JOIN
	                      dbo.CajaEstadosComprobante ON
	                      dbo.CajaComprobantesPago.IdEstadoComprobante = dbo.CajaEstadosComprobante.IdEstadoComprobante LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.CajaComprobantesPago.idFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.CajaComprobantesPago.IdCajero = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
	                      dbo.CajaCaja ON dbo.CajaComprobantesPago.idCaja = dbo.CajaCaja.IdCaja LEFT OUTER JOIN
	                      dbo.CajaTurno ON dbo.CajaComprobantesPago.idTurno = dbo.CajaTurno.IdTurno
	WHERE     (dbo.CajaComprobantesPago.FechaCobranza BETWEEN  @FechaInicio and  @FechaFin)
	ORDER BY dbo.CajaComprobantesPago.FechaCobranza desc
end
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFemision]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFemision]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
if @NroDocumento<>''
begin
	SELECT     dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial,
	                      dbo.CajaComprobantesPago.idTurno, dbo.CajaTurno.Descripcion, dbo.CajaComprobantesPago.idCaja, dbo.CajaCaja.Descripcion AS dCaja,
	                      dbo.CajaComprobantesPago.IdCajero, dbo.Empleados.IdEmpleado, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
	                      dbo.Empleados.Nombres, dbo.CajaComprobantesPago.idFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFormaPago,
	                      dbo.Pacientes.ApellidoPaterno AS Apaterno, dbo.Pacientes.ApellidoMaterno AS Amaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.fechaEmision as FechaCobranza, dbo.CajaComprobantesPago.IdCuentaAtencion,
	                      dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaEstadosComprobante.Descripcion AS dEstado, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajasTiposOrden.Descripcion AS dBienServicio, dbo.CajaComprobantesPago.idFarmacia, dbo.farmAlmacen.descripcion AS dFarmacia,
	                      dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaComprobantesPago.SubTotal,dbo.CajaComprobantesPago.Adelantos,dbo.CajaComprobantesPago.exoneraciones,
	                      dbo.CajaComprobantesPago.total,CajaComprobantesPago.ruc,dbo.CajaComprobantesPago.IdComprobantePago,dbo.Pacientes.IdPaciente,
	                      dbo.CajaComprobantesPago.Total,dbo.CajaComprobantesPago.IGV,dbo.CajaComprobantesPago.RUC,
	                      dbo.CajaComprobantesPago.DNI,dbo.CajaComprobantesPago.TieneCredito
	FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
	                      dbo.farmAlmacen ON dbo.CajaComprobantesPago.idFarmacia = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.CajasTiposOrden ON dbo.CajaComprobantesPago.IdTipoOrden = dbo.CajasTiposOrden.IdTipoOrden LEFT OUTER JOIN
	                      dbo.CajaEstadosComprobante ON
	                      dbo.CajaComprobantesPago.IdEstadoComprobante = dbo.CajaEstadosComprobante.IdEstadoComprobante LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.CajaComprobantesPago.idFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.CajaComprobantesPago.IdCajero = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
	                      dbo.CajaCaja ON dbo.CajaComprobantesPago.idCaja = dbo.CajaCaja.IdCaja LEFT OUTER JOIN
	                      dbo.CajaTurno ON dbo.CajaComprobantesPago.idTurno = dbo.CajaTurno.IdTurno
	where            dbo.CajaComprobantesPago.NroSerie=@NroSerie and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
             ORDER BY dbo.CajaComprobantesPago.fechaEmision desc
  end
else
  begin
             --------------exec CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFechas '','','22/01/2009 00:00:00','22/01/2009 23:59:00'
	SELECT     dbo.CajaCaja.Descripcion AS Caja, dbo.CajaTurno.Descripcion AS Turno, dbo.CajaComprobantesPago.fechaEmision AS Fecha,
	                      dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total, dbo.CajaComprobantesPago.IdCuentaAtencion,
	                      dbo.CajaEstadosComprobante.Descripcion AS Estado, dbo.Empleados.ApellidoPaterno AS CajeroApPat,
	                      dbo.Empleados.ApellidoMaterno AS CajeroApMat, dbo.Empleados.Nombres AS CajeroNombres, dbo.CajasTiposOrden.Descripcion AS BienServicio,
	                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.idTurno, dbo.CajaComprobantesPago.idCaja,
	                      dbo.CajaComprobantesPago.IdCajero, dbo.Empleados.IdEmpleado, dbo.CajaComprobantesPago.idFormaPago,
	                      dbo.TiposFinanciamiento.Descripcion AS dFormaPago, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajaComprobantesPago.idFarmacia, dbo.farmAlmacen.descripcion AS dFarmacia,dbo.CajaComprobantesPago.exoneraciones,
						  dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaComprobantesPago.subTotal,dbo.CajaComprobantesPago.fechaEmision as FechaCobranza,dbo.CajaComprobantesPago.IGV,
						  dbo.CajaComprobantesPago.RUC,dbo.CajaComprobantesPago.IdComprobantePago,dbo.CajaComprobantesPago.DNI ,dbo.CajaComprobantesPago.TieneCredito
	FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
	                      dbo.farmAlmacen ON dbo.CajaComprobantesPago.idFarmacia = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.CajasTiposOrden ON dbo.CajaComprobantesPago.IdTipoOrden = dbo.CajasTiposOrden.IdTipoOrden LEFT OUTER JOIN
	                      dbo.CajaEstadosComprobante ON
	                      dbo.CajaComprobantesPago.IdEstadoComprobante = dbo.CajaEstadosComprobante.IdEstadoComprobante LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.CajaComprobantesPago.idFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                      dbo.Empleados ON dbo.CajaComprobantesPago.IdCajero = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
	                      dbo.CajaCaja ON dbo.CajaComprobantesPago.idCaja = dbo.CajaCaja.IdCaja LEFT OUTER JOIN
	                      dbo.CajaTurno ON dbo.CajaComprobantesPago.idTurno = dbo.CajaTurno.IdTurno
	WHERE     (dbo.CajaComprobantesPago.fechaEmision BETWEEN  @FechaInicio and  @FechaFin)
	ORDER BY dbo.CajaComprobantesPago.fechaEmision desc
end
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoFiltroPorNroSerieDocumentoOporRangoFemision] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoPorSerieDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoPorSerieDocumento]
	@nroSerie [varchar](4),
	@NroDocumento [varchar](8)
WITH EXECUTE AS CALLER
AS
SELECT     IdComprobantePago,IdCaja,NroSerie, NroDocumento
FROM         dbo.CajaComprobantesPago
WHERE  @nroSerie=nroSerie AND  @NroDocumento=NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoPorSerieDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoProductosPorIdComprobante]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoProductosPorIdComprobante]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar AS totalPorPagar, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdCajero, dbo.Pacientes.NroHistoriaClinica, dbo.FactOrdenesBienes.idOrden,
                      dbo.FactOrdenesBienes.idComprobantePago, dbo.CajaComprobantesPago.IdPaciente, dbo.FacturacionBienesPagos.IdProducto,
                      dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto, dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga,
                      dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.Exoneraciones, dbo.FactOrdenesBienes.idPreventa, dbo.CajaComprobantesPago.Adelantos,
                      dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaComprobantesPago.idCaja, dbo.CajaCaja.Descripcion AS nombreCaja,
                      dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2,
			 dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2,dbo.FactCatalogoBienesInsumos.codigoSUNAT
FROM         dbo.FactOrdenesBienes INNER JOIN
                      dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja ON
                      dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago INNER JOIN
                      dbo.FacturacionBienesPagos INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                      dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE       dbo.CajaComprobantesPago.IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoProductosPorIdComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumento]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar AS totalPorPagar, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdCajero, dbo.Pacientes.NroHistoriaClinica, dbo.FactOrdenesBienes.idOrden,
                      dbo.FactOrdenesBienes.idComprobantePago, dbo.CajaComprobantesPago.IdPaciente, dbo.FacturacionBienesPagos.IdProducto,
                      dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto, dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga,
                      dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.Exoneraciones, dbo.FactOrdenesBienes.idPreventa, dbo.CajaComprobantesPago.Adelantos,
                      dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaComprobantesPago.idCaja, dbo.CajaCaja.Descripcion AS nombreCaja,
                      dbo.CajaComprobantesPago.IdTipoComprobante,dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2,
			dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2,dbo.CajaCaja.FormatoImpDefaultCinta,  dbo.CajaCaja.FormatoImp2Cinta
FROM         dbo.FactOrdenesBienes INNER JOIN
                      dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja ON
                      dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago INNER JOIN
                      dbo.FacturacionBienesPagos INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                      dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
where            dbo.CajaComprobantesPago.NroSerie=@NroSerie and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumentoConexion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumentoConexion]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar AS totalPorPagar, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdCajero, dbo.Pacientes.NroHistoriaClinica, dbo.FactOrdenesBienes.idOrden,
                      dbo.FactOrdenesBienes.idComprobantePago, dbo.CajaComprobantesPago.IdPaciente, dbo.FacturacionBienesPagos.IdProducto,
     dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto, dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga,
                      dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.Exoneraciones, dbo.FactOrdenesBienes.idPreventa, dbo.CajaComprobantesPago.Adelantos,
                      dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaComprobantesPago.idCaja, dbo.CajaCaja.Descripcion AS nombreCaja,
                      dbo.FactOrdenesBienes.idUsuarioExonera, dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.IdTipoComprobante,
   dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2, dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2,(select ApellidoPaterno + ' ' + ApellidoMaterno + ' '+ Nombres  from Empleados where IdEmpleado =FactOrdenesBienes.idUsuario ) as UsuarioDespacho,FactOrdenesBienes.Paquete as NombrePaquete,
	case when dbo.Pacientes.NroDocumento IS not null then dbo.Pacientes.NroDocumento  else FactOrdenesBienes.DNI collate database_default end  as DniPaciente,
	dbo.CajaCaja.FormatoImpDefaultCinta,  dbo.CajaCaja.FormatoImp2Cinta,dbo.CajaComprobantesPago.DNI,dbo.CajaComprobantesPago.IdTipoOrden
FROM         dbo.FacturacionBienesPagos INNER JOIN
                      dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja INNER JOIN
                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago ON
                      dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
where            dbo.CajaComprobantesPago.NroSerie=@NroSerie and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoProductosPorNroSerieNroDocumentoConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoSeleccionarPaquetes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoSeleccionarPaquetes]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                  dbo.CajaComprobantesPago.*
 FROM       dbo.CajaComprobantesPago LEFT OUTER JOIN
                  dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
where dbo.CajaComprobantesPago.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoSeleccionarPaquetes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoSeleccionarXidCajaGestion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoSeleccionarXidCajaGestion]
	@IdCajaGestion [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago
where  idGestionCaja=@IdCajaGestion
ordER BY FechaCobranza DESC
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoSeleccionarXidCajaGestion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoServicioAnulaBoleta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoServicioAnulaBoleta]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle set cantidadDespachada=0 where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoServicioAnulaBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoServiciosPorIdComprobantePago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoServiciosPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FactCatalogoServicios.Nombre AS Nombre,
                      dbo.FacturacionServicioPagos.Precio AS Precio, dbo.FacturacionServicioPagos.Total AS total, dbo.FacturacionServicioPagos.Total AS Importe,
                      dbo.FacturacionServicioPagos.idProducto AS idProductoCPT, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.idCaja, dbo.CajaComprobantesPago.idFormaPago, dbo.CajaComprobantesPago.Exoneraciones,
                      dbo.CajaComprobantesPago.Adelantos, dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaCaja.Descripcion AS nombreCaja,dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2,
			dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2,dbo.FactCatalogoServicios.codigoSUNAT
FROM         dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja INNER JOIN
                      dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE    dbo.CajaComprobantesPago.IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoServiciosPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumento]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FactCatalogoServicios.Nombre AS Nombre,
                      dbo.FacturacionServicioPagos.Precio AS Precio, dbo.FacturacionServicioPagos.Total AS total, dbo.FacturacionServicioPagos.Total AS Importe,
                      dbo.FacturacionServicioPagos.idProducto AS idProductoCPT, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno,

                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.idCaja, dbo.CajaComprobantesPago.idFormaPago, dbo.CajaComprobantesPago.Exoneraciones,
                      dbo.CajaComprobantesPago.Adelantos, dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaCaja.Descripcion AS nombreCaja,dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2,
			dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2,dbo.CajaCaja.FormatoImpDefaultCinta,  dbo.CajaCaja.FormatoImp2Cinta
FROM         dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja INNER JOIN
                      dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE    dbo.CajaComprobantesPago.NroSerie=@NroSerie AND dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumentoConexion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumentoConexion]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FactCatalogoServicios.Nombre AS Nombre,
                      dbo.FacturacionServicioPagos.Precio AS Precio, dbo.FacturacionServicioPagos.Total AS total, dbo.FacturacionServicioPagos.Total AS Importe,
              dbo.FacturacionServicioPagos.idProducto AS idProductoCPT, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC,
                      dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante,
                      dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja,
                      dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno,
                      dbo.CajaComprobantesPago.idCaja, dbo.CajaComprobantesPago.idFormaPago, dbo.CajaComprobantesPago.Exoneraciones,
                      dbo.CajaComprobantesPago.Adelantos, dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal,
                      dbo.CajaComprobantesPago.Observaciones, dbo.CajaCaja.Descripcion AS nombreCaja, dbo.FactOrdenServicioPagos.idUsuarioExonera,
   dbo.CajaCaja.ImpresoraDefault, dbo.CajaCaja.Impresora2, dbo.CajaCaja.SerieImpresoraDefault, dbo.CajaCaja.SerieImpresora2 ,
   (select ApellidoPaterno + ' ' + ApellidoMaterno + ' '+ Nombres  from Empleados where IdEmpleado =FactOrdenServicioPagos.idUsuario ) as UsuarioDespacho,'' as NombrePaquete,
	case when dbo.Pacientes.NroDocumento IS not null then dbo.Pacientes.NroDocumento  else '' collate database_default end  as DniPaciente,
	dbo.CajaCaja.FormatoImpDefaultCinta,  dbo.CajaCaja.FormatoImp2Cinta,dbo.CajaComprobantesPago.DNI
FROM         dbo.CajaCaja INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.CajaCaja.IdCaja = dbo.CajaComprobantesPago.idCaja INNER JOIN
                      dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE    dbo.CajaComprobantesPago.NroSerie=@NroSerie AND dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoServiciosPorNroSerieNroDocumentoConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoUltimaBoletaDelAnio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoUltimaBoletaDelAnio]
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
select  top 1 *  from CajaComprobantesPago where fechaCobranza<=convert(datetime,@fecha,103) order by fechaCobranza desc
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoUltimaBoletaDelAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantePagoXmovnumero]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantePagoXmovnumero]
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.CajaComprobantesPago.RazonSocial,
                      dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.FechaCobranza
FROM         dbo.FactOrdenesBienes INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
where dbo.FactOrdenesBienes.MovNumero=@movNumero and dbo.FactOrdenesBienes.MovTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantePagoXmovnumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesAnularComprobanteYOrdenBienInsumo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesAnularComprobanteYOrdenBienInsumo]
	@IdComprobantePago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago set IdEstadoComprobante = 9
	where IdComprobantePago = @IdComprobantePago

	update FactOrdenesBienesInsumo set IdEstadoOrden = 9 ,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
	where IdComprobantePago = @IdComprobantePago

	update FacturacionBienesInsumos set IdEstadoFacturacion = 9,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
	where IdComprobantePago = @IdComprobantePago and IdEstadoFacturacion = 4 and IdTipoFinanciamiento in (1,2)

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobantePago,'CajaComprobantesPago'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesAnularComprobanteYOrdenBienInsumo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesAnularComprobanteYOrdenServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesAnularComprobanteYOrdenServicio]
	@IdComprobantePago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago set IdEstadoComprobante = 9
	where IdComprobantePago = @IdComprobantePago

	update FactOrdenesServicio set IdEstadoOrden = 9 ,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
	where IdComprobantePago = @IdComprobantePago

	update FacturacionServicios set IdEstadoFacturacion = 9,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
		where IdComprobantePago = @IdComprobantePago and IdEstadoFacturacion = 4 and IdTipoFinanciamiento in (1,2)

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobantePago,'CajaComprobantesPago'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesAnularComprobanteYOrdenServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleBienesInsumosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleBienesInsumosAgregar]
	@SubTotalPagado [money],
	@Cantidad [int],
	@PrecioUnitario [money],
	@IdComprobanteDetalleBienes [int] OUTPUT,
	@IdFacturacionBienes [int],
	@EsPagoACuenta [int],
	@IdComprobantePago [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaComprobantesDetalleBienesInsumos (
SubTotalPagado,Cantidad,PrecioUnitario,IdFacturacionBienes,EsPagoACuenta,IdComprobantePago,IdProducto) values (
@SubTotalPagado,@Cantidad,@PrecioUnitario,@IdFacturacionBienes,@EsPagoACuenta,@IdComprobantePago,@IdProducto)
set @IdComprobanteDetalleBienes = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdComprobanteDetalleBienes,'CajaComprobantesDetalleBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleBienesInsumosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleBienesInsumosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleBienesInsumosEliminar]
	@IdComprobanteDetalleBienes [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaComprobantesDetalleBienesInsumos
where IdComprobanteDetalleBienes = @IdComprobanteDetalleBienes
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobanteDetalleBienes,'CajaComprobantesDetalleBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleBienesInsumosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleBienesInsumosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleBienesInsumosModificar]
	@SubTotalPagado [money],
	@Cantidad [int],
	@PrecioUnitario [money],
	@IdComprobanteDetalleBienes [int],
	@IdFacturacionBienes [int],
	@EsPagoACuenta [int],
	@IdComprobantePago [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesDetalleBienesInsumos
set
SubTotalPagado = @SubTotalPagado,
Cantidad = @Cantidad,
PrecioUnitario = @PrecioUnitario,
IdFacturacionBienes = @IdFacturacionBienes,
EsPagoACuenta = @EsPagoACuenta,
IdComprobantePago = @IdComprobantePago,
IdProducto = @IdProducto
where IdComprobanteDetalleBienes = @IdComprobanteDetalleBienes
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdComprobanteDetalleBienes,'CajaComprobantesDetalleBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleBienesInsumosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleBienesInsumosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleBienesInsumosSeleccionarPorId]
	@IdComprobanteDetalleBienes [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesDetalleBienesInsumos
where IdComprobanteDetalleBienes = @IdComprobanteDetalleBienes
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleBienesInsumosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleServiciosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleServiciosAgregar]
	@IdFacturacionServicio [int],
	@EsPagoACuenta [int],
	@IdProducto [int],
	@SubTotalPagado [money],
	@Cantidad [money],
	@PrecioUnitario [money],
	@IdComprobantePago [int],
	@IdComprobanteDetalleServicio [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaComprobantesDetalleServicios (
IdFacturacionServicio,EsPagoACuenta,IdProducto,SubTotalPagado,Cantidad,PrecioUnitario,IdComprobantePago) values (
@IdFacturacionServicio,@EsPagoACuenta,@IdProducto,@SubTotalPagado,@Cantidad,@PrecioUnitario,@IdComprobantePago)
set @IdComprobanteDetalleServicio = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdComprobanteDetalleServicio,'CajaComprobantesDetalleServicios'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleServiciosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleServiciosEliminar]
	@IdComprobanteDetalleServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaComprobantesDetalleServicios
where IdComprobanteDetalleServicio = @IdComprobanteDetalleServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobanteDetalleServicio,'CajaComprobantesDetalleServicios'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleServiciosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleServiciosModificar]
	@IdFacturacionServicio [int],
	@EsPagoACuenta [int],
	@IdProducto [int],
	@SubTotalPagado [money],
	@Cantidad [money],
	@PrecioUnitario [money],
	@IdComprobantePago [int],
	@IdComprobanteDetalleServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesDetalleServicios
set
IdFacturacionServicio = @IdFacturacionServicio,
EsPagoACuenta = @EsPagoACuenta,
IdProducto = @IdProducto,
SubTotalPagado = @SubTotalPagado,
Cantidad = @Cantidad,
PrecioUnitario = @PrecioUnitario,
IdComprobantePago = @IdComprobantePago
where IdComprobanteDetalleServicio = @IdComprobanteDetalleServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdComprobanteDetalleServicio,'CajaComprobantesDetalleServicios'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDetalleServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDetalleServiciosSeleccionarPorId]
	@IdComprobanteDetalleServicio [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesDetalleServicios
where IdComprobanteDetalleServicio = @IdComprobanteDetalleServicio
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDetalleServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDevolverComprobanteYOrdenBienInsumo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDevolverComprobanteYOrdenBienInsumo]
	@IdComprobantePago [int],
	@IdComprobantePagoDevolucion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesInsumos set IdEstadoFacturacion = 6, IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
	where IdComprobantePago = @IdComprobantePago and IdEstadoFacturacion = 5 and IdTipoFinanciamiento in (1,2)

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobantePago,'CajaComprobantesPago'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDevolverComprobanteYOrdenBienInsumo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesDevolverComprobanteYOrdenServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesDevolverComprobanteYOrdenServicio]
	@IdComprobantePago [int],
	@IdComprobantePagoDevolucion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicios set IdEstadoFacturacion = 6, IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
	IdUsuarioModifica = @IdUsuarioAuditoria,
	FechaModificacion = getdate()
		where IdComprobantePago = @IdComprobantePago and IdEstadoFacturacion = 5 and IdTipoFinanciamiento in (1,2)

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobantePago,'CajaComprobantesPago'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesDevolverComprobanteYOrdenServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoActualizaDatosSunat]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoActualizaDatosSunat]
	@idComprobantePago [int],
	@SunatTotalIgv [money],
	@SunatOpeInafectas [money]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago set SunatOpeInafectas=@SunatOpeInafectas,SunatTotalIgv=@SunatTotalIgv where IdComprobantePago =@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoActualizaDatosSunat] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoActualizaFechaCobranza]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoActualizaFechaCobranza]
	@idComprobantePago [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago set FechaCobranza=@fecha where idComprobantePago=@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoActualizaFechaCobranza] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoActualizaTieneCredito]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoActualizaTieneCredito]
	@idComprobantePago [int],
	@TieneCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago set TieneCredito=@TieneCredito where idComprobantePago=@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoActualizaTieneCredito] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoActualizaXpacienteYComprobante]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoActualizaXpacienteYComprobante]
	@idPaciente [int],
	@IdComprobantePago [int],
	@lbEsNull [bit]
WITH EXECUTE AS CALLER
AS
if @lbEsNull=1
    update CajaComprobantesPago set idPaciente=null
                 where idComprobantePago=@IdComprobantePago
else
    update CajaComprobantesPago set idPaciente=@idPaciente
                 where idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoActualizaXpacienteYComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoAgregar]
	@TipoCambio [money],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@RazonSocial [varchar](100),
	@RUC [char](11),
	@SubTotal [money],
	@IGV [money],
	@IdComprobantePago [int] OUTPUT,
	@FechaCobranza [datetime],
	@IdTipoOrden [int],
	@Observaciones [varchar](250),
	@IdTipoComprobante [int],
	@IdCuentaAtencion [int],
	@IdEstadoComprobante [int],
	@IdGestionCaja [int],
	@IdTipoPago [int],
	@Total [money],
	@IdUsuarioAuditoria [int],
	@idPaciente [int],
	@idformaPago [int],
	@idFarmacia [int],
	@idCaja [int],
	@idTurno [int],
	@idCajero [int],
	@Exoneraciones [money],
	@Dctos [money],
	@Adelantos [money],
	@idTipoFinanciamiento [int],
	@DNI [varchar](11),
	@TieneCredito [varchar](1),
	@fechaEmision [datetime],
	@SunatTotalIgv [money],
	@SunatOpeInafectas [money]
WITH EXECUTE AS CALLER
AS
insert into CajaComprobantesPago (
TipoCambio,NroSerie,NroDocumento,RazonSocial,RUC,SubTotal,IGV,FechaCobranza,IdTipoOrden,Observaciones,
IdTipoComprobante,IdCuentaAtencion,IdEstadoComprobante,IdGestionCaja,IdTipoPago,Total,idpaciente,idformapago,
idFarmacia,idCaja,idTurno,idCajero,Exoneraciones,Dctos,Adelantos,idTipoFinanciamiento,DNI,TieneCredito,
fechaEmision,SunatTotalIgv,SunatOpeInafectas)
values (
@TipoCambio,@NroSerie,@NroDocumento,@RazonSocial,@RUC,@SubTotal,@IGV,@FechaCobranza,@IdTipoOrden,@Observaciones,
@IdTipoComprobante,@IdCuentaAtencion,@IdEstadoComprobante,@IdGestionCaja,@IdTipoPago,@Total,@idPaciente,@idformaPago,
@idFarmacia,@idCaja,@idTurno,@idCajero,@Exoneraciones,@Dctos,@Adelantos,@idTipoFinanciamiento,@DNI,@TieneCredito,
@fechaEmision,@SunatTotalIgv,@SunatOpeInafectas)
set @IdComprobantePago = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoChequeaSiYaPago]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoChequeaSiYaPago]
	@IdCuentaAtencion [int],
	@lnIdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionServicioPagos.idProducto
                        FROM         dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                             dbo.FactOrdenServicioPagos ON
                                             dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago RIGHT OUTER JOIN
                                             dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
                        WHERE dbo.CajaComprobantesPago.IdEstadoComprobante= 4 and
                              dbo.CajaComprobantesPago.IdCuentaAtencion=@IdCuentaAtencion  and
                              dbo.FacturacionServicioPagos.idProducto=@lnIdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoChequeaSiYaPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoEliminar]
	@IdComprobantePago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaComprobantesPago
where IdComprobantePago = @IdComprobantePago
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdComprobantePago,'CajaComprobantesPago'
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoModificaIdPacienteYRazonSocial]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoModificaIdPacienteYRazonSocial]
	@IdPaciente [int],
	@RazonSocial [varchar](150),
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago
set idPaciente=@IdPaciente, RazonSocial=@RazonSocial
 where idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoModificaIdPacienteYRazonSocial] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoModificar]
	@TipoCambio [money],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@RazonSocial [varchar](100),
	@RUC [char](11),
	@SubTotal [money],
	@IGV [money],
	@IdComprobantePago [int],
	@FechaCobranza [datetime],
	@IdTipoOrden [int],
	@Observaciones [varchar](250),
	@IdTipoComprobante [int],
	@IdCuentaAtencion [int],
	@IdEstadoComprobante [int],
	@IdGestionCaja [int],
	@IdTipoPago [int],
	@Total [money],
	@IdUsuarioAuditoria [int],
	@idPaciente [int],
	@idformaPago [int],
	@idFarmacia [int],
	@idCaja [int],
	@idTurno [int],
	@idCajero [int],
	@DNI [varchar](11),
	@TieneCredito [varchar](1),
	@fechaEmision [datetime],
	@SunatTotalIgv [money],
	@SunatOpeInafectas [money]
WITH EXECUTE AS CALLER
AS
update CajaComprobantesPago
set
TipoCambio = @TipoCambio,
NroSerie = @NroSerie,
NroDocumento = @NroDocumento,
RazonSocial = @RazonSocial,
RUC = @RUC,
SubTotal = @SubTotal,
IGV = @IGV,
FechaCobranza = @FechaCobranza,
IdTipoOrden = @IdTipoOrden,
Observaciones = @Observaciones,
IdTipoComprobante = @IdTipoComprobante,
IdCuentaAtencion = @IdCuentaAtencion,
IdEstadoComprobante = @IdEstadoComprobante,
IdGestionCaja = @IdGestionCaja,
IdTipoPago = @IdTipoPago,
Total = @Total,
idPaciente=@idPaciente,
idFormaPago=@idformaPago,
idFarmacia =@idFarmacia,
idCaja=@idCaja,
idTurno=@idTurno,
idCajero =@idCajero,
DNI=@DNI,
TieneCredito=@TieneCredito  ,
fechaEmision=@fechaEmision,
 SunatTotalIgv =@SunatTotalIgv ,
 SunatOpeInafectas=@SunatOpeInafectas
where IdComprobantePago = @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoParaTipoTarifa]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoParaTipoTarifa]
	@NroSerie [char](4),
	@NroDocumento [char](7)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                                       dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                                       dbo.FactCatalogoServicios.NombreMINSA AS NombreProducto, dbo.FactCatalogoServicios.Nombre AS Nombre,
                                       dbo.FacturacionServicioPagos.Precio AS Precio, dbo.FacturacionServicioPagos.Total AS total, dbo.FacturacionServicioPagos.Total AS Importe,
                                       dbo.FacturacionServicioPagos.idProducto AS idProductoCPT, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                                       dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno,
                                       dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                                       dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC,
                                       dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante,
                                       dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja,
                                       dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos,
                                       dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno,
                                       dbo.CajaComprobantesPago.idCaja, dbo.CajaComprobantesPago.idFormaPago, dbo.CajaComprobantesPago.Exoneraciones,
                                       dbo.CajaComprobantesPago.Adelantos, dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal, dbo.FactCatalogoServicios.IdPartida,
                                       dbo.TiposTarifaCpt.idTipoTarifa
                  FROM         dbo.TiposTarifaCpt LEFT OUTER JOIN
                                       dbo.FactCatalogoServicios ON dbo.TiposTarifaCpt.idProductoCpt = dbo.FactCatalogoServicios.IdProducto RIGHT OUTER JOIN
                                       dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                       dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                       dbo.CajaComprobantesPago ON
                                       dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                                       dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
                  WHERE    dbo.CajaComprobantesPago.NroSerie=@NroSerie AND dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoParaTipoTarifa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoParaTipoTarifaFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoParaTipoTarifaFechas]
	@FechaIni [datetime],
	@fechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                                       dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                                       dbo.FactCatalogoServicios.NombreMINSA AS NombreProducto, dbo.FactCatalogoServicios.Nombre AS Nombre,
                                       dbo.FacturacionServicioPagos.Precio AS Precio, dbo.FacturacionServicioPagos.Total AS total, dbo.FacturacionServicioPagos.Total AS Importe,
                                       dbo.FacturacionServicioPagos.idProducto AS idProductoCPT, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                                       dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno,
                                       dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                                       dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC,
                                       dbo.CajaComprobantesPago.Total AS totalboleta, dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante,
                                       dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja,
                                       dbo.CajaComprobantesPago.IdTipoPago, dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos,
                                       dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno,
                                       dbo.CajaComprobantesPago.idCaja, dbo.CajaComprobantesPago.idFormaPago, dbo.CajaComprobantesPago.Exoneraciones,
                                       dbo.CajaComprobantesPago.Adelantos, dbo.CajaComprobantesPago.IGV, dbo.CajaComprobantesPago.SubTotal, dbo.FactCatalogoServicios.IdPartida,
                                       dbo.TiposTarifaCpt.idTipoTarifa
                  FROM         dbo.TiposTarifaCpt LEFT OUTER JOIN
                                       dbo.FactCatalogoServicios ON dbo.TiposTarifaCpt.idProductoCpt = dbo.FactCatalogoServicios.IdProducto RIGHT OUTER JOIN
                                       dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                       dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                       dbo.CajaComprobantesPago ON
                                       dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                                       dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
                  WHERE       dbo.CajaComprobantesPago.fechaCobranza between @fechaIni and @fechaFin
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoParaTipoTarifaFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoPorFechasConNombreCajas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoPorFechasConNombreCajas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.CajaCaja.Codigo AS cajaCodigo, dbo.CajaCaja.Descripcion AS caja, dbo.CajaComprobantesPago.*
FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
                      dbo.CajaCaja ON dbo.CajaComprobantesPago.idCaja = dbo.CajaCaja.IdCaja
WHERE      (dbo.CajaComprobantesPago.FechaCobranza BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.CajaCaja.Codigo, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoPorFechasConNombreCajas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarAdelantosPorIdCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarAdelantosPorIdCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     IdCuentaAtencion, Adelantos, IdEstadoComprobante
FROM         dbo.CajaComprobantesPago
WHERE     (IdCuentaAtencion = @idCuentaAtencion) AND (IdEstadoComprobante = 4)
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarAdelantosPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarFarmaciaPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarFarmaciaPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.Total, dbo.CajaComprobantesPago.IdTipoOrden, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                      dbo.FactOrdenesBienes.idPreventa, dbo.FactOrdenesBienes.idCuentaAtencion, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.farmMovimiento.idAlmacenOrigen
FROM         dbo.farmMovimiento RIGHT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.farmMovimiento.MovNumero = dbo.FactOrdenesBienes.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.FactOrdenesBienes.MovTipo RIGHT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
WHERE    (dbo.CajaComprobantesPago.FechaCobranza Between @FechaInicio and @FechaFin) AND  dbo.CajaComprobantesPago.IdTipoOrden<>1
                 and  dbo.FactOrdenesBienes.idPreventa>0 and dbo.FactOrdenesBienes.idCuentaAtencion=null and dbo.CajaComprobantesPago.IdEstadoComprobante=4
                 and dbo.farmMovimiento.idAlmacenOrigen=@idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarFarmaciaPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPagosACuentaPorIdCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPagosACuentaPorIdCuenta]
	@idCuentaAtencion [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Total,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion
FROM         dbo.FactOrdenServicioPagos LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON
                      dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
where dbo.CajaComprobantesPago.IdCuentaAtencion=@idCuentaAtencion and  dbo.FactOrdenServicioPagos.IdEstadoFacturacion=4 and
           dbo.FacturacionServicioPagos.idProducto=@idProducto */

SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Total,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion
FROM         dbo.FactOrdenServicioPagos INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago INNER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
WHERE     (dbo.CajaComprobantesPago.IdCuentaAtencion = @idCuentaAtencion) AND (dbo.FactOrdenServicioPagos.IdEstadoFacturacion = 4) AND
                      (dbo.FacturacionServicioPagos.idProducto = @idProducto)
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPagosACuentaPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago
WHERE     FechaCobranza BETWEEN  @FechaInicio and  @FechaFin
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPorFechasSoloFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPorFechasSoloFarmacia]
	@FechaInicio [varchar](50),
	@HoraInicio [varchar](50),
	@FechaFin [varchar](50),
	@HoraFin [varchar](50),
	@TodasFarmacias [int],
	@IdAlmacen [int]
WITH EXECUTE AS CALLER
AS
IF @TodasFarmacias=0
	BEGIN
		SELECT     NroSerie, NroDocumento, FechaCobranza, IdEstadoComprobante, IdTipoOrden, IdTipoComprobante, idFarmacia
		From dbo.CajaComprobantesPago
		Where (IdTipoOrden >1) and (FechaCobranza Between CONVERT(DATETIME,@FechaInicio + ' ' + @HoraInicio +  ':00',103) and CONVERT(DATETIME,@FechaFin + ' ' +  @HoraFin + ':59',103))
		and idFarmacia=@IdAlmacen
		order  by FechaCobranza,NroSerie, NroDocumento
	END
ELSE
	BEGIN
		SELECT     NroSerie, NroDocumento, FechaCobranza, IdEstadoComprobante, IdTipoOrden, IdTipoComprobante, idFarmacia
		From dbo.CajaComprobantesPago
		Where (IdTipoOrden >1) and (FechaCobranza Between CONVERT(DATETIME,@FechaInicio + ' ' + @HoraInicio +  ':00',103) and CONVERT(DATETIME,@FechaFin + ' ' +  @HoraFin + ':59',103))
		order  by FechaCobranza,NroSerie, NroDocumento
	END
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPorFechasSoloFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPorId]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago
where IdComprobantePago = @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPorMovnumero]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPorMovnumero]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.*, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo
FROM         dbo.CajaComprobantesPago RIGHT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago
WHERE         dbo.FactOrdenesBienes.MovNumero=@MovNumero and dbo.FactOrdenesBienes.MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPorMovnumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarPorNroSerieNroDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarPorNroSerieNroDocumento]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8)
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago
where NroSerie=@NroSerie and NroDocumento=@NroDocumento --and idestadocomprobante<>9
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarPorNroSerieNroDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSeleccionarXIdCuentaAtencionIdServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSeleccionarXIdCuentaAtencionIdServicio]
	@IdCuentaAtencion [int],
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionServicioPagos.idProducto
FROM         dbo.CajaComprobantesPago RIGHT OUTER JOIN
                     dbo.FactOrdenServicioPagos ON
                     dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago RIGHT OUTER JOIN
                     dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
WHERE dbo.CajaComprobantesPago.IdEstadoComprobante= 4 and
      dbo.CajaComprobantesPago.IdCuentaAtencion=@IdCuentaAtencion and
      dbo.FacturacionServicioPagos.idProducto=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSeleccionarXIdCuentaAtencionIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoSoloServicioXitem]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoSoloServicioXitem]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.Cantidad, dbo.FacturacionServicioPagos.Precio,
                      dbo.FacturacionServicioPagos.Total , dbo.FacturacionServicioPagos.idProducto,
                      dbo.FactOrdenServicioPagos.idOrden, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                      + ' ' + dbo.Pacientes.PrimerNombre AS Paciente, dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.Total AS totalboleta,
                      dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdCuentaAtencion, dbo.CajaComprobantesPago.Dctos,
                      dbo.CajaComprobantesPago.Exoneraciones, dbo.CajaComprobantesPago.IdPaciente,dbo.FactOrdenServicioPagos.idOrdenPago,
                      dbo.FactOrdenServicioPagos.idOrden,dbo.CajaComprobantesPago.idComprobantePago,dbo.CajaComprobantesPago.TieneCredito
FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON
                      dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     (dbo.CajaComprobantesPago.IdEstadoComprobante = 4) AND (dbo.CajaComprobantesPago.IdTipoOrden = 1) and
                    (dbo.CajaComprobantesPago.FechaCobranza Between @FechaInicio and @FechaFin) and  dbo.FacturacionServicioPagos.idProducto=@idProducto
order by  dbo.CajaComprobantesPago.FechaCobranza
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoSoloServicioXitem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagosSeleccionarPorIdTipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagosSeleccionarPorIdTipoFinanciamiento]
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from cajaComprobantesPago where idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagosSeleccionarPorIdTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoTotalPorGestion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoTotalPorGestion]
	@IdGestionCaja [int]
WITH EXECUTE AS CALLER
AS
select sum(total) as total from CajaComprobantesPago
    where IdGestionCaja = @IdGestionCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoTotalPorGestion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXcuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select *
from CajaComprobantesPago
where IdCuentaAtencion =@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXfechasExoneradosFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXfechasExoneradosFarmacia]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      distinct dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.Total,
                       dbo.CajaComprobantesPago.Exoneraciones, LTRIM(dbo.Empleados.ApellidoPaterno)
                      + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS EmpExonera, dbo.CajaComprobantesPago.IdEstadoComprobante,
                      dbo.CajaComprobantesPago.RazonSocial
FROM         dbo.CajaComprobantesPago INNER JOIN
                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago LEFT OUTER JOIN
                      dbo.Empleados ON dbo.FactOrdenesBienes.idUsuarioExonera = dbo.Empleados.IdEmpleado
WHERE     (dbo.CajaComprobantesPago.IdEstadoComprobante = 4) AND (dbo.CajaComprobantesPago.Exoneraciones > 0)  and
                  (dbo.CajaComprobantesPago.FechaCobranza BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXfechasExoneradosFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXfechasExoneradosServicios]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXfechasExoneradosServicios]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      distinct dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
	     dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.idComprobantePago,
                      dbo.FactOrdenServicioPagos.ImporteExonerado, dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.idUsuarioExonera,
                      Empleados_1.IdEmpleado, RTRIM(Empleados_2.ApellidoPaterno) + ' ' + RTRIM(Empleados_2.ApellidoMaterno)
                      + ' ' + Empleados_2.Nombres AS EmpExonera, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.IdCuentaAtencion, RTRIM(Empleados_1.ApellidoPaterno)
                      + ' ' + RTRIM(Empleados_1.ApellidoMaterno) + ' ' + Empleados_1.Nombres AS EmpCajero, dbo.CajaComprobantesPago.IdEstadoComprobante,
                      dbo.CajaComprobantesPago.Exoneraciones,  dbo.CajaComprobantesPago.Total
FROM         dbo.Empleados Empleados_1 RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos INNER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago ON
                      Empleados_1.IdEmpleado = dbo.CajaComprobantesPago.IdCajero LEFT OUTER JOIN
                      dbo.Empleados Empleados_2 ON dbo.FactOrdenServicioPagos.idUsuarioExonera = Empleados_2.IdEmpleado
WHERE     (dbo.CajaComprobantesPago.IdEstadoComprobante = 4) AND (dbo.CajaComprobantesPago.Exoneraciones > 0) and
                  (dbo.CajaComprobantesPago.FechaCobranza BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.CajaComprobantesPago.FechaCobranza,dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXfechasExoneradosServicios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXidCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXidCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
Select * from CajaComprobantesPago where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXimagenes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXimagenes]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimiento.IdImagEstado, dbo.ImagMovimientoImagenes.IdComprobantePago, dbo.ImagMovimiento.Fecha,
                       dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimientoImagenes.IdCuentaAtencion
             FROM         dbo.ImagMovimientoImagenes LEFT OUTER JOIN
                                  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento
             Where (dbo.ImagMovimiento.IdImagEstado =1) and  dbo.ImagMovimientoImagenes.IdComprobantePago= @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXimagenes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXlaboratorio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXlaboratorio]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.IdComprobantePago, dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.Fecha,
                                     dbo.LabMovimiento.IdLabEstado,dbo.LabMovimientoLaboratorio.IdCuentaAtencion
                FROM         dbo.LabMovimientoLaboratorio LEFT OUTER JOIN
                                     dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento
                Where (dbo.LabMovimiento.IdLabEstado <> 0) and  dbo.LabMovimientoLaboratorio.IdComprobantePago= @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXlaboratorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXnroSerieYDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXnroSerieYDocumento]
	@NroSerie [varchar](50),
	@NroDocumento [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                          dbo.FacturacionServicioPagos.Precio as PrecioUnitario, dbo.FacturacionServicioPagos.Total as totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                          dbo.FactCatalogoServicios.Nombre as NombreProducto, dbo.FactCatalogoServicios.Nombre as Nombre, dbo.FacturacionServicioPagos.Precio as Precio,
                          dbo.FacturacionServicioPagos.Total as total,dbo.FacturacionServicioPagos.Total as Importe, dbo.FacturacionServicioPagos.idProducto as idProductoCPT,
                          dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.FechaCreacion,
                          dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                          dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                          dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC, dbo.CajaComprobantesPago.Total As totalboleta ,
                          dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.IdCuentaAtencion,
                          dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja, dbo.CajaComprobantesPago.IdTipoPago,
                          dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos, dbo.CajaComprobantesPago.IdPaciente,
                          dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno, dbo.CajaComprobantesPago.idCaja,
                          dbo.CajaComprobantesPago.idFormaPago,dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.adelantos,
                          dbo.CajaComprobantesPago.IGV , dbo.CajaComprobantesPago.Subtotal,dbo.FactCatalogoServicios.idPartida
     FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                          dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                          dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                          dbo.CajaComprobantesPago ON
                          dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                          dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
     WHERE    dbo.CajaComprobantesPago.NroSerie=@NroSerie AND dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXnroSerieYDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesPagoXnroSerieYDocumentoFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaComprobantesPagoXnroSerieYDocumentoFechas]
	@FechaIni [datetime],
	@fechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.idOrdenPago, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                          dbo.FacturacionServicioPagos.Precio as PrecioUnitario, dbo.FacturacionServicioPagos.Total as totalPorPagar, dbo.FactCatalogoServicios.Codigo,
                          dbo.FactCatalogoServicios.Nombre as NombreProducto, dbo.FactCatalogoServicios.Nombre as Nombre, dbo.FacturacionServicioPagos.Precio as Precio,
                          dbo.FacturacionServicioPagos.Total as total,dbo.FacturacionServicioPagos.Total as Importe, dbo.FacturacionServicioPagos.idProducto as idProductoCPT,
                          dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.FechaCreacion,
                          dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                          dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                          dbo.CajaComprobantesPago.RazonSocial, dbo.CajaComprobantesPago.RUC, dbo.CajaComprobantesPago.Total As totalboleta ,
                          dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.IdCuentaAtencion,
                          dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.CajaComprobantesPago.IdGestionCaja, dbo.CajaComprobantesPago.IdTipoPago,
                          dbo.CajaComprobantesPago.IdTipoOrden, dbo.CajaComprobantesPago.Dctos, dbo.CajaComprobantesPago.IdPaciente,
                          dbo.CajaComprobantesPago.IdCajero, dbo.CajaComprobantesPago.idTurno, dbo.CajaComprobantesPago.idCaja,
                          dbo.CajaComprobantesPago.idFormaPago,dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.adelantos,
                          dbo.CajaComprobantesPago.IGV , dbo.CajaComprobantesPago.Subtotal,dbo.FactCatalogoServicios.idPartida
     FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                          dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                          dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                          dbo.CajaComprobantesPago ON
                          dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                          dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
     WHERE       dbo.CajaComprobantesPago.fechaCobranza between @fechaIni and @fechaFin
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesPagoXnroSerieYDocumentoFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaComprobantesSeleccionarPorCuentaAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaComprobantesSeleccionarPorCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CajaComprobantesSeleccionarPorCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesAgregar]
	@idDevolucion [int] OUTPUT,
	@idComprobantePago [int],
	@montoDevuelto [money],
	@montoTotal [money],
	@fechaDevolucion [datetime],
	@idUsuario [int],
	@motivo [varchar](2000),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaDevoluciones (
idComprobantePago,montoDevuelto,montoTotal,fechaDevolucion,idUsuario, motivo) values (
@idComprobantePago,@montoDevuelto,@montoTotal,@fechaDevolucion,@idUsuario, @motivo)
set @idDevolucion = @@identity

update cajacomprobantespago set idestadocomprobante = 6
where idComprobantePago = @idcomprobantepago --se actualiza estado a devuelto cuando se graba la tabla de devoluciones

delete citas
from citas c
where c.IdAtencion in (
				select A.Idatencion
				from Atenciones A inner join CajaComprobantesPago cc
				on A.IdCuentaAtencion=cc.IdCuentaAtencion
				where cc.IdComprobantePago=@idcomprobantepago
				)
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesBuscar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesBuscar]
	@IdComprobante [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT cd.idComprobantePago, cd.idDevolucion, cd.montoTotal, p.PrimerNombre, p.ApellidoPaterno, p.ApellidoMaterno , cc.Total, cd.fechaDevolucion, e.Usuario
			FROM CajaDevoluciones cd join CajaComprobantesPago cc
					on cd.idComprobantePago=cc.IdComprobantePago join Pacientes p
					on cc.IdPaciente=p.IdPaciente join Empleados e
					on cd.idUsuario= e.IdEmpleado

		WHERE (cd.idComprobantePago = @IdComprobante)
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesBuscar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesBuscarApellido]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesBuscarApellido]
	@ApellidoPaterno [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT cd.idComprobantePago, cd.idDevolucion, cd.montoTotal, p.PrimerNombre, p.ApellidoPaterno, p.ApellidoMaterno , cc.Total, cd.fechaDevolucion, e.Usuario
			FROM CajaDevoluciones cd join CajaComprobantesPago cc
					on cd.idComprobantePago=cc.IdComprobantePago join Pacientes p
					on cc.IdPaciente=p.IdPaciente join Empleados e
					on cd.idUsuario= e.IdEmpleado

		WHERE (p.ApellidoPaterno like '%' + @ApellidoPaterno + '%')
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesBuscarApellido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesBuscarApellido2]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesBuscarApellido2]
	@ApellidoMaterno [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT cd.idComprobantePago, cd.idDevolucion, cd.montoTotal, p.PrimerNombre, p.ApellidoPaterno, p.ApellidoMaterno , cc.Total, cd.fechaDevolucion, e.Usuario
			FROM CajaDevoluciones cd join CajaComprobantesPago cc
					on cd.idComprobantePago=cc.IdComprobantePago join Pacientes p
					on cc.IdPaciente=p.IdPaciente join Empleados e
					on cd.idUsuario= e.IdEmpleado

		WHERE (p.ApellidoMaterno like '%' + @ApellidoMaterno + '%')
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesBuscarApellido2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesConsultarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesConsultarTodos]
WITH EXECUTE AS CALLER
AS
SELECT * FROM CajaDevoluciones
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesConsultarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesEliminar]
	@idcomprobantepago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaDevoluciones
where idcomprobantepago = @idcomprobantepago

update cajacomprobantespago set idestadocomprobante = 4
where idComprobantePago = @idcomprobantepago --se actualiza estado a devuelto cuando se graba la tabla de devoluciones
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesFiltrar]
	@IdComprobante [varchar](10),
	@ApellidoPaterno [varchar](100),
	@ApellidoMaterno [varchar](100),
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @IdComprobante <> ''
	BEGIN
		SELECT cd.idComprobantePago, cd.idDevolucion, cd.montoTotal, p.PrimerNombre, p.ApellidoPaterno, p.ApellidoMaterno , cc.Total, cd.fechaDevolucion, e.Usuario
			FROM CajaDevoluciones cd join CajaComprobantesPago cc
					on cd.idComprobantePago=cc.IdComprobantePago join Pacientes p
					on cc.IdPaciente=p.IdPaciente join Empleados e
					on cd.idUsuario= e.IdEmpleado

		WHERE (cd.idComprobantePago = @IdComprobante) or
				(p.ApellidoPaterno like '%' + @ApellidoPaterno + '%') or
				(p.ApellidoMaterno like '%' + @ApellidoMaterno + '%') or
				(cd.fechaDevolucion between @FechaInicio and @FechaFin)
		ORDER BY cd.idComprobantePago
END
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesModificar]
	@idDevolucion [int],
	@idComprobantePago [int],
	@montoDevuelto [money],
	@montoTotal [money],
	@fechaDevolucion [datetime],
	@idUsuario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaDevoluciones
set
idComprobantePago = @idComprobantePago,
montoDevuelto = @montoDevuelto,
montoTotal = @montoTotal,
fechaDevolucion = @fechaDevolucion,
idUsuario = @idUsuario
where idDevolucion = @idDevolucion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idDevolucion,'CajaDevoluciones'
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesPorFechasUsuario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesPorFechasUsuario]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
select cc.IdComprobantePago, cc.NroSerie, cc.NroDocumento,p.PrimerNombre  + ' ' + p.ApellidoPaterno + ' ' + p.ApellidoMaterno as Paciente, cc.Total, cd.fechaDevolucion, e.Usuario, cd.motivo
from CajaDevoluciones cd join CajaComprobantesPago cc
on cd.idComprobantePago=cc.IdComprobantePago join Pacientes p
on cc.IdPaciente=p.IdPaciente join Empleados e
on cd.idUsuario= e.IdEmpleado
where cd.fechaDevolucion between @FechaInicio and @FechaFin
order by cd.fechaDevolucion
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesPorFechasUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevolucionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaDevolucionesSeleccionarPorId]
	@idDevolucion [int]
WITH EXECUTE AS CALLER
AS
select * from CajaDevoluciones
where idDevolucion = @idDevolucion
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevolucionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaDevuelveNombreImpresoraPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaDevuelveNombreImpresoraPorId]
	@IdCaja [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM CajaCaja
WHERE idCaja=@IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaDevuelveNombreImpresoraPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaFormaPagoComprobanteAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaFormaPagoComprobanteAgregar]
	@IdTipoFormaPago [int],
	@IdTipoMoneda [int],
	@IdComprobantePago [int],
	@Importe [money],
	@TotalSoles [money],
	@TipoCambio [money],
	@IdFormaPago [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaFormaPagoComprobante (
IdTipoFormaPago,IdTipoMoneda,IdComprobantePago,Importe,TotalSoles,TipoCambio) values (
@IdTipoFormaPago,@IdTipoMoneda,@IdComprobantePago,@Importe,@TotalSoles,@TipoCambio)
set @IdFormaPago = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFormaPago,'CajaFormaPagoComprobante'
GO
ALTER AUTHORIZATION ON [dbo].[CajaFormaPagoComprobanteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionActualizaFechaCierre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionActualizaFechaCierre]
	@fechaCierre [datetime],
	@idGestionCaja [int]
WITH EXECUTE AS CALLER
AS
update CajaGestion set FechaCierre=@fechaCierre, EstadoLote='C' where idGestionCaja=@idGestionCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionActualizaFechaCierre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionActualizaFechaCierreXidCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionActualizaFechaCierreXidCaja]
	@fechaCierre [datetime],
	@idCaja [int]
WITH EXECUTE AS CALLER
AS
update CajaGestion set FechaCierre=@fechaCierre, EstadoLote='C' where idCaja=@idCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionActualizaFechaCierreXidCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionAgregar]
	@TotalCobrado [char](10),
	@FechaCierre [datetime],
	@IdTurno [int],
	@IdCaja [int],
	@IdCajero [int],
	@EstadoLote [char](1),
	@FechaApertura [datetime],
	@IdGestionCaja [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaGestion
( TotalCobrado,FechaCierre,IdTurno,IdCaja,IdCajero,EstadoLote,FechaApertura)
values ( @TotalCobrado,@FechaCierre,@IdTurno,@IdCaja,@IdCajero,@EstadoLote,@FechaApertura)
set @IdGestionCaja = @@identity
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGestionCaja,'CajaGestion'
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionEliminar]
	@IdGestionCaja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaGestion
where IdGestionCaja = @IdGestionCaja
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdGestionCaja,'CajaGestion'
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionFiltrar]
	@lcFiltro1 [varchar](2000),
	@lcFiltro2 [varchar](2000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(4000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)

   SET  @SQL1 =  'select distinct CajaGestion.IdGestionCaja, CajaGestion.FechaApertura, CajaGestion.FechaCierre
            , CajaGestion.IdCaja, CajaCaja.Descripcion as DescCaja, CajaGestion.IdTurno, CajaTurno.Descripcion as DescTurno
             from ((((CajaGestion
             left join CajaComprobantesPago on CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja)
             left join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = CajaComprobantesPago.IdCuentaAtencion)
             left join Pacientes on FacturacionCuentasAtencion.IDPaciente = Pacientes.IdPaciente)
             left join CajaCaja on CajaCaja.IdCaja = CajaGestion.IdCaja)
             left join CajaTurno on CajaTurno.IdTurno = CajaGestion.IdTurno     '+@lcFiltro1

   SET  @SQL2 =  'select CajaGestion.IdGestionCaja
            , CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento, CajaEstadosComprobante.Descripcion as EstadoComprobante,
              CajaComprobantesPago.FechaCobranza as Fecha
            , Pacientes.NroHistoriaClinica,CajaComprobantesPago.RazonSocial,CajaComprobantesPago.Total,CajasTiposOrden.Descripcion as TipoOrden ,
            CajaComprobantesPago.IdCuentaAtencion,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, CajaComprobantesPago.IdTipoOrden, CajaComprobantesPago.IdTipoPago
            , CajaComprobantesPago.RUC,  CajaComprobantesPago.IdEstadoComprobante
            , CajasTiposOrden.Descripcion as TipoOrden
            , case CajaComprobantesPago.IdTipoOrden
             when 2 then (select IdOrden from FactOrdenesServicio where FactOrdenesServicio.IdComprobantePago = CajaComprobantesPago.IdComprobantePago)
             when 1 then (select IdOrden from FactOrdenesBienesInsumo where FactOrdenesBienesInsumo.IdComprobantePago = CajaComprobantesPago.IdComprobantePago)
             when 3 then (select IdOrden from FactOrdenesBienesInsumo where FactOrdenesBienesInsumo.IdComprobantePago = CajaComprobantesPago.IdComprobantePago)
             End
            from (((((CajaGestion
             left join CajaComprobantesPago on CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja)
             left join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = CajaComprobantesPago.IdCuentaAtencion)
             left join Pacientes on CajaComprobantesPago.IDPaciente = Pacientes.IDPaciente)
             left join CajaCaja on CajaCaja.IdCaja = CajaGestion.IdCaja)
             left join CajaTurno on CajaTurno.IdTurno = CajaGestion.IdTurno)
             left join CajaEstadosComprobante on CajaEstadosComprobante.IdEstadoComprobante = CajaComprobantesPago.IdEstadoComprobante
             left join CajasTiposOrden on CajasTiposOrden.IdTipoOrden = CajaComprobantesPago.IdTipoOrden '+@lcFiltro2

   SET  @SQL = 'SHAPE {'+@SQL1 + '}  APPEND ({ '+@SQL2+'  AS title_chap RELATE IdGestionCaja TO IdGestionCaja) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionModificar]
	@TotalCobrado [char](10),
	@FechaCierre [datetime],
	@IdTurno [int],
	@IdCaja [int],
	@IdCajero [int],
	@EstadoLote [char](1),
	@FechaApertura [datetime],
	@IdGestionCaja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaGestion
set  TotalCobrado = @TotalCobrado,
FechaCierre = @FechaCierre,
IdTurno = @IdTurno,
IdCaja = @IdCaja,
IdCajero = @IdCajero,
EstadoLote = @EstadoLote,
FechaApertura = @FechaApertura
where IdGestionCaja = @IdGestionCaja
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdGestionCaja,'CajaGestion'
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionPorCajeroCajaYTurno]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionPorCajeroCajaYTurno]
	@IdCajero [int],
	@IdCaja [int],
	@IdTurno [int]
WITH EXECUTE AS CALLER
AS
select * from CajaGestion
     where IdCajero = @IdCajero
     and IdCaja = @IdCaja
     and IdTurno = @IdTurno
     and EstadoLote = 'A'
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionPorCajeroCajaYTurno] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionSeleccionarPorId]
	@IdGestionCaja [int]
WITH EXECUTE AS CALLER
AS
select * from CajaGestion
where IdGestionCaja = @IdGestionCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaGestionSeleccionarXFiltroOrdenadoXFApertura]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaGestionSeleccionarXFiltroOrdenadoXFApertura]
	@Filtro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
SET @SQL='SELECT * FROM CajaGestion WHERE '  + @Filtro +  ' order by FechaApertura desc'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CajaGestionSeleccionarXFiltroOrdenadoXFApertura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaLoteCuadreAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaLoteCuadreAgregar]
	@IdLote [int],
	@Diferencia [money],
	@CuadreUsuario [money],
	@Calculado [money],
	@IdLoteCuadre [int] OUTPUT,
	@IdTipoFormaPago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaLoteCuadre (
IdLote,Diferencia,CuadreUsuario,Calculado,IdTipoFormaPago) values (
@IdLote,@Diferencia,@CuadreUsuario,@Calculado,@IdTipoFormaPago)
set @IdLoteCuadre = @@Identity
--Cerramos el Lote
Update CajaLote set EstadoLote = 'C' where IdLote = @IdLote
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdLoteCuadre,'CajaLoteCuadre'
GO
ALTER AUTHORIZATION ON [dbo].[CajaLoteCuadreAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaLoteCuadreEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaLoteCuadreEliminar]
	@IdLoteCuadre [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
--Abrimos el Lote
Update CajaLote set EstadoLote = 'A' where IdLote in (Select IdLote from CajaLoteCuadre where IdLoteCuadre = @IdLoteCuadre )

Delete from CajaLoteCuadre
where IdLoteCuadre = @IdLoteCuadre
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdLoteCuadre,'CajaLoteCuadre'
GO
ALTER AUTHORIZATION ON [dbo].[CajaLoteCuadreEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaLoteCuadreModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaLoteCuadreModificar]
	@IdLote [int],
	@Diferencia [money],
	@CuadreUsuario [money],
	@Calculado [money],
	@IdLoteCuadre [int],
	@IdTipoFormaPago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaLoteCuadre
set
IdLote = @IdLote,
Diferencia = @Diferencia,
CuadreUsuario = @CuadreUsuario,
Calculado = @Calculado,
IdTipoFormaPago = @IdTipoFormaPago
where IdLoteCuadre = @IdLoteCuadre
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdLoteCuadre,'CajaLoteCuadre'
GO
ALTER AUTHORIZATION ON [dbo].[CajaLoteCuadreModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoAgregar]
	@IdTipoComprobante [int],
	@NroDocumento [char](12),
	@NroSerie [varchar](4),
	@NroDocumentoFinal [char](12),
	@IdCaja [int],
	@NroDocumentoInicial [char](12),
	@FacturaSinIGV [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CajaNroDocumento (
IdCaja,IdTipoComprobante,NroDocumento,NroSerie,NroDocumentoFinal,NroDocumentoInicial,
FacturaSinIGV) values (
@IdCaja,@IdTipoComprobante,@NroDocumento,@NroSerie,@NroDocumentoFinal,@NroDocumentoInicial,
@FacturaSinIGV)
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoEliminar]
	@IdTipoComprobante [int],
	@IdCaja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CajaNroDocumento
where IdTipoComprobante = @IdTipoComprobante and
IdCaja = @IdCaja
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCaja,'CajaNroDocumento'
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoEliminarXidCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoEliminarXidCaja]
	@lIdCaja [int]
WITH EXECUTE AS CALLER
AS
Delete from CajaNroDocumento where IdCaja = @lIdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoEliminarXidCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoEliminarXiIdCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoEliminarXiIdCaja]
	@IdCaja [int]
WITH EXECUTE AS CALLER
AS
delete from CajaNroDocumento where idCaja=@IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoEliminarXiIdCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoModificar]
	@IdTipoComprobante [int],
	@NroDocumento [char](12),
	@NroSerie [varchar](4),
	@NroDocumentoFinal [char](12),
	@IdCaja [int],
	@NroDocumentoInicial [char](12),
	@FacturaSinIGV [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CajaNroDocumento
set
NroDocumento = @NroDocumento,
NroSerie = @NroSerie,
NroDocumentoFinal = @NroDocumentoFinal,
NroDocumentoInicial = @NroDocumentoInicial,
FacturaSinIGV=@FacturaSinIGV
where IdTipoComprobante = @IdTipoComprobante and
IdCaja = @IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoSeleccionarPorId]
	@IdTipoComprobante [int],
	@IdCaja [int]
WITH EXECUTE AS CALLER
AS
select * from CajaNroDocumento
where IdTipoComprobante = @IdTipoComprobante and
IdCaja = @IdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoSeleccionarPorIdCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoSeleccionarPorIdCaja]
	@lIdCaja [int]
WITH EXECUTE AS CALLER
AS
DECLARE @param377 varchar(30);
set @param377 = (select ValorTexto from Parametros where IdParametro=377)
if @param377='s'
	begin
		Select nd.IdCaja,nd.IdTipoComprobante,tc.Descripcion TipoComprobante
					 ,nd.NroSerie,nd.nroDocumento,nd.nroDocumentoInicial,nd.nroDocumentoFinal,
					 nd.FacturaSinIGV
					 from CajaNroDocumento nd,CajaTiposComprobante tc
					 Where nd.IdTipoComprobante = tc.IdTipoComprobante
					 and nd.IdCaja = @lIdCaja
					 and nd.IdTipoComprobante in (2,3)
					 Union All
					 Select 0,IdTipoComprobante,Descripcion TipoComprobante
					 ,'','','','',''
					 From CajaTiposComprobante
					 where IdTipoComprobante not in (Select IdTipoComprobante from
					 CajaNroDocumento where IdCaja = @lIdCaja)
					 and IdTipoComprobante in (2,3)
	end
else
	begin
		Select nd.IdCaja,nd.IdTipoComprobante,tc.Descripcion TipoComprobante
					 ,nd.NroSerie,nd.nroDocumento,nd.nroDocumentoInicial,nd.nroDocumentoFinal,
					 nd.FacturaSinIGV
					 from CajaNroDocumento nd,CajaTiposComprobante tc
					 Where nd.IdTipoComprobante = tc.IdTipoComprobante
					 and nd.IdCaja = @lIdCaja
					 Union All
					 Select 0,IdTipoComprobante,Descripcion TipoComprobante
					 ,'','','','',''
					 From CajaTiposComprobante
					 where IdTipoComprobante not in (Select IdTipoComprobante from
					 CajaNroDocumento where IdCaja = @lIdCaja)
	end
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoSeleccionarPorIdCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoSeleccionarPorIdCajaYTipoComprobante]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoSeleccionarPorIdCajaYTipoComprobante]
	@tipoComprobante [int],
	@lIdCaja [int]
WITH EXECUTE AS CALLER
AS
Select nroserie,nroDocumento,nroDocumentoInicial,nroDocumentoFinal,*
             from CajaNroDocumento
             Where IdTipoComprobante = @tipoComprobante
             and IdCaja = @lIdCaja
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoSeleccionarPorIdCajaYTipoComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaNroDocumentoXidCajaTipoComprobante]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaNroDocumentoXidCajaTipoComprobante]
	@IdCaja [int],
	@IdTipoComprobante [int]
WITH EXECUTE AS CALLER
AS
Select * from CajaNroDocumento where IdCaja = @IdCaja and IdTipoComprobante = @IdTipoComprobante
GO
ALTER AUTHORIZATION ON [dbo].[CajaNroDocumentoXidCajaTipoComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoActualizaFarmaciaActualizaServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoActualizaFarmaciaActualizaServicio]
	@ReembolsoPagadoFarmacia [money],
	@IdOrdenPago [int],
	@IdOrden [int],
	@ReembolsoPagadoServicio [money],
	@IdProductoFarmacia [int],
	@IdProductoServicio [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--Farmacia
update FacturacionServicioPagos set Precio=@ReembolsoPagadoFarmacia,total=@ReembolsoPagadoFarmacia
where idOrdenPago=@IdOrdenPago and idProducto=@IdProductoFarmacia
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FacturacionServicioDespacho set  Precio=@ReembolsoPagadoFarmacia,total=@ReembolsoPagadoFarmacia
where idOrden=@IdOrden and idProducto=@IdProductoFarmacia
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

--Servicios
update FacturacionServicioPagos set Precio=@ReembolsoPagadoServicio,total=@ReembolsoPagadoServicio
where idOrdenPago=@IdOrdenPago and idProducto=@IdProductoServicio
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FacturacionServicioDespacho set  Precio=@ReembolsoPagadoServicio,total=@ReembolsoPagadoServicio
where idOrden=@IdOrden and idProducto=@IdProductoServicio
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoActualizaFarmaciaActualizaServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoActualizaFarmaciaAddServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoActualizaFarmaciaAddServicio]
	@ReembolsoPagadoFarmacia [money],
	@IdOrdenPago [int],
	@IdOrden [int],
	@ReembolsoPagadoServicio [money],
	@IdProductoFarmacia [int],
	@IdProductoServicio [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--Farmacia
update FacturacionServicioPagos set Precio=@ReembolsoPagadoFarmacia,total=@ReembolsoPagadoFarmacia
where idOrdenPago=@IdOrdenPago and idProducto=@IdProductoFarmacia

IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FacturacionServicioDespacho set  Precio=@ReembolsoPagadoFarmacia,total=@ReembolsoPagadoFarmacia
where idOrden=@IdOrden and idProducto=@IdProductoFarmacia

IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

--Servicios
insert into FacturacionServicioPagos (idOrdenPago,idProducto,cantidad,precio,total)
values(@IdOrdenPago,@IdProductoServicio,1,@ReembolsoPagadoServicio,@ReembolsoPagadoServicio)

IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

insert into FacturacionServicioDespacho (idOrden,idProducto,cantidad,precio,total)
values(@IdOrden,@IdProductoServicio, 1,@ReembolsoPagadoServicio,@ReembolsoPagadoServicio)

IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoActualizaFarmaciaAddServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoActualizaServicioAddFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoActualizaServicioAddFarmacia]
	@IdOrdenPago [int],
	@IdOrden [int],
	@ReembolsoPagadoServicio [money],
	@IdProductoFarmacia [int],
	@IdProductoServicio [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--Farmacia
insert into FacturacionServicioPagos (idOrdenPago,idProducto,cantidad,precio,total)
values(@IdOrdenPago,@IdProductoFarmacia,1,@ReembolsoPagadoServicio,@ReembolsoPagadoServicio)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

insert into FacturacionServicioDespacho (idOrden,idProducto,cantidad,precio,total)
values(@IdOrden,@IdProductoFarmacia, 1,@ReembolsoPagadoServicio,@ReembolsoPagadoServicio)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

--Servicios
update FacturacionServicioPagos set Precio=@ReembolsoPagadoServicio,total=@ReembolsoPagadoServicio
where idOrdenPago=@IdOrdenPago and idProducto=@IdProductoServicio
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END


update FacturacionServicioDespacho set  Precio=@ReembolsoPagadoServicio,total=@ReembolsoPagadoServicio
where idOrden=@IdOrden and idProducto=@IdProductoServicio
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoActualizaServicioAddFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoActualizaServiciosYfarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoActualizaServiciosYfarmacia]
	@IdOrdenPago [int],
	@IdOrden [int],
	@TotalFactura [money]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioPagos
set Precio=@TotalFactura,
total=@TotalFactura
where idOrdenPago=@IdOrdenPago

update FacturacionServicioDespacho set  Precio=@TotalFactura
,total=@TotalFactura where idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoActualizaServiciosYfarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoAddFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoAddFarmacia]
	@TotalFactura [money],
	@IdOrdenPago [int],
	@IdOrden [int],
	@IdProductoFarmacia [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--Farmacia
insert into FacturacionServicioPagos (idOrdenPago,idProducto,cantidad,precio,total)
values(@IdOrdenPago,@IdProductoFarmacia,1,@TotalFactura,@TotalFactura)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

insert into FacturacionServicioDespacho (idOrden,idProducto,cantidad,precio,total)
values(@IdOrden,@IdProductoFarmacia, 1,@TotalFactura,@TotalFactura)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoAddFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoAddServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoAddServicio]
	@TotalFactura [money],
	@IdOrdenPago [int],
	@IdOrden [int],
	@IdProductoServicio [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--Farmacia
insert into FacturacionServicioPagos (idOrdenPago,idProducto,cantidad,precio,total)
values(@IdOrdenPago,@IdProductoServicio,1,@TotalFactura,@TotalFactura)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

insert into FacturacionServicioDespacho (idOrden,idProducto,cantidad,precio,total)
values(@IdOrden,@IdProductoServicio, 1,@TotalFactura,@TotalFactura)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoAddServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsoEliminaFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsoEliminaFarmacia]
	@IdOrdenPago [int],
	@IdProducto [int],
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION

delete from FacturacionServicioPagos where idOrdenPago=@IdOrdenPago and idProducto=@IdProducto
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

delete from FacturacionServicioDespacho where idOrden=@IdOrden and idProducto=@IdProducto
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsoEliminaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaReembolsosAnterioresXfactura]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaReembolsosAnterioresXfactura]
	@Serie [varchar](50),
	@Numero [varchar](50),
	@IdTipoComprobante [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento,
                        dbo.FactReembolsos.idTipoComprobante , dbo.FactReembolsos.idTipoConsumo, dbo.FactReembolsos.IdFactReembolso
                 FROM   dbo.FactReembolsosDocumentos INNER JOIN
                        dbo.FactReembolsos ON dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FactReembolsos.idFactReembolso
                 WHERE dbo.FactReembolsosDocumentos.NroSerie=@Serie
                       AND dbo.FactReembolsosDocumentos.NroDocumento =@Numero
                       AND dbo.FactReembolsos.idTipoComprobante=@IdTipoComprobante
                 ORDER BY dbo.FactReembolsos.idFactReembolso DESC
GO
ALTER AUTHORIZATION ON [dbo].[CajaReembolsosAnterioresXfactura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaTiposComprobanteFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaTiposComprobanteFarmacia]
	@IdTipoComprobante [int],
	@IdCaja [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.CajaTiposComprobante.Descripcion, dbo.CajaNroDocumento.NroSerie, dbo.CajaNroDocumento.NroDocumento, dbo.CajaNroDocumento.IdCaja,
                         dbo.CajaTiposComprobante.IdTipoComprobante
FROM    dbo.CajaNroDocumento LEFT OUTER JOIN
                         dbo.CajaTiposComprobante ON dbo.CajaNroDocumento.IdTipoComprobante = dbo.CajaTiposComprobante.IdTipoComprobante
Where (dbo.CajaTiposComprobante.IdTipoComprobante = @IdTipoComprobante )
                       and (dbo.CajaNroDocumento.IdCaja =  @IdCaja )
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposComprobanteFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaTiposComprobanteSeleccionarDocFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaTiposComprobanteSeleccionarDocFarmacia]
WITH EXECUTE AS CALLER
AS
select * from CajaTiposComprobante where IdTipoComprobante in (1,4) order  by Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposComprobanteSeleccionarDocFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaTiposComprobanteSeleccionarDocSunat]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CajaTiposComprobanteSeleccionarDocSunat]
WITH EXECUTE AS CALLER
AS
DECLARE @param377 varchar(30);
	set @param377 = (select ValorTexto from Parametros where IdParametro=377)
	if @param377='s'
		begin
		select * from CajaTiposComprobante where IdTipoComprobante in (2,3) order  by Descripcion
		end
	else
		begin
		select * from CajaTiposComprobante order  by Descripcion
		end
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposComprobanteSeleccionarDocSunat] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaTiposComprobanteSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaTiposComprobanteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select *  from CajaTiposComprobante order  by Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[CajaTiposComprobanteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajaTurnoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajaTurnoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from CajaTurno
GO
ALTER AUTHORIZATION ON [dbo].[CajaTurnoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CajerosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CajerosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT distinct dbo.ListBarGrupos.IdListGrupo, dbo.ListBarGrupos.Clave, dbo.ListBarGrupos.Texto, dbo.ListBarGrupos.Indice,rtrim(dbo.Empleados.ApellidoPaterno)+' '+rtrim(dbo.Empleados.ApellidoMaterno)+' '+rtrim(dbo.Empleados.Nombres) as dCajero, dbo.Empleados.IdEmpleado
                FROM dbo.Empleados LEFT OUTER JOIN dbo.UsuariosRoles ON dbo.Empleados.IdEmpleado = dbo.UsuariosRoles.IdEmpleado LEFT OUTER JOIN
                      dbo.RolesItems ON dbo.UsuariosRoles.IdRol = dbo.RolesItems.IdRol LEFT OUTER JOIN
                      dbo.ListBarItems ON dbo.RolesItems.IdListItem = dbo.ListBarItems.IdListItem LEFT OUTER JOIN
                      dbo.ListBarGrupos ON dbo.ListBarGrupos.IdListGrupo = dbo.ListBarItems.IdListGrupo
                Where (dbo.ListBarItems.IdListGrupo = 700)
                ORDER BY dCajero
GO
ALTER AUTHORIZATION ON [dbo].[CajerosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasActualizaIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasActualizaIdPaciente]
	@lIdPaciente [int],
	@lIdCama [int]
WITH EXECUTE AS CALLER
AS
update Camas
         set IdPaciente = @lIdPaciente , IdEstadoCama = 3, idCondicionOcupacion=1
         where IdCama = @lIdCama
GO
ALTER AUTHORIZATION ON [dbo].[CamasActualizaIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasActualizarXIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasActualizarXIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
update Camas set IdPaciente = null, IdEstadoCama = 1
where IdPaciente = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[CamasActualizarXIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasAgregar]
	@Y [int],
	@X [int],
	@IdPaciente [int],
	@IdServicioUbicacionActual [int],
	@Codigo [char](5),
	@IdEstadoCama [int],
	@IdCondicionOcupacion [int],
	@IdTiposCama [int],
	@IdServicioPropietario [int],
	@IdCama [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Camas (
Y,X,IdPaciente,IdServicioUbicacionActual,Codigo,IdEstadoCama,IdCondicionOcupacion,IdTiposCama,IdServicioPropietario) values (
@Y,@X,@IdPaciente,@IdServicioUbicacionActual,@Codigo,@IdEstadoCama,@IdCondicionOcupacion,@IdTiposCama,@IdServicioPropietario)
set @IdCama = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCama,'Camas'
GO
ALTER AUTHORIZATION ON [dbo].[CamasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasBuscarCodigoDeCama]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasBuscarCodigoDeCama]
	@lcCodigoCama [varchar](5),
	@IdServicioPropietario [int]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.Camas.*, dbo.Servicios.Nombre AS ServicioActual
                 FROM     dbo.Camas LEFT OUTER JOIN
                          dbo.Servicios ON dbo.Camas.IdServicioUbicacionActual = dbo.Servicios.IdServicio
                 WHERE    dbo.Camas.codigo=@lcCodigoCama
                           and dbo.Camas.idServicioUbicacionActual=@IdServicioPropietario
GO
ALTER AUTHORIZATION ON [dbo].[CamasBuscarCodigoDeCama] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasEliminar]
	@IdCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Camas
where IdCama = @IdCama
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCama,'Camas'
GO
ALTER AUTHORIZATION ON [dbo].[CamasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasLimpiaIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasLimpiaIdPaciente]
	@lIdPaciente [int]
WITH EXECUTE AS CALLER
AS
update Camas set IdPaciente = null, IdEstadoCama = 1
             where IdPaciente = @lIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[CamasLimpiaIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasModificar]
	@Y [int],
	@X [int],
	@IdPaciente [int],
	@IdServicioUbicacionActual [int],
	@Codigo [char](5),
	@IdEstadoCama [int],
	@IdCondicionOcupacion [int],
	@IdTiposCama [int],
	@IdServicioPropietario [int],
	@IdCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Camas
set
Y = @Y,
X = @X,
IdPaciente = @IdPaciente,
IdServicioUbicacionActual = @IdServicioUbicacionActual,
Codigo = @Codigo,
IdEstadoCama = @IdEstadoCama,
IdCondicionOcupacion = @IdCondicionOcupacion,
IdTiposCama = @IdTiposCama,
IdServicioPropietario = @IdServicioPropietario
where IdCama = @IdCama
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCama,'Camas'
GO
ALTER AUTHORIZATION ON [dbo].[CamasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasMovimientosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasMovimientosAgregar]
	@IdMovimiento [int] OUTPUT,
	@IdCama [int],
	@IdServicio [int],
	@fechaIngreso [datetime],
	@fechaSalida [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CamasMovimientos (idCama,idServicio,FechaIngreso,FechaSalida)
 values (@IdCama,@IdServicio,@fechaIngreso,@fechaSalida)
set @IdMovimiento = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'CamasMovimiento'
GO
ALTER AUTHORIZATION ON [dbo].[CamasMovimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasMovimientosEliminarPorCama]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasMovimientosEliminarPorCama]
	@IdCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CamasMovimientos
where IdCama = @IdCama
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCama,'CamasMovimiento'
GO
ALTER AUTHORIZATION ON [dbo].[CamasMovimientosEliminarPorCama] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasMovimientosSeleccionarPorCama]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasMovimientosSeleccionarPorCama]
	@IdCama [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.camasMovimientos.*, dbo.Servicios.Nombre AS dServicio
FROM         dbo.camasMovimientos LEFT OUTER JOIN
                      dbo.Servicios ON dbo.camasMovimientos.idServicio = dbo.Servicios.IdServicio
 where  dbo.camasMovimientos.IdCama = @IdCama
order by dbo.camasMovimientos.fechaingreso desc
GO
ALTER AUTHORIZATION ON [dbo].[CamasMovimientosSeleccionarPorCama] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasMovimientosSeleccionarPorServicioAnioMes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasMovimientosSeleccionarPorServicioAnioMes]
	@Anio [int],
	@Mes [int],
	@idServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.camasMovimientos.*
FROM         dbo.camasMovimientos
WHERE     (YEAR(FechaIngreso) = @Anio) AND (MONTH(FechaIngreso) = @Mes) AND (idServicio = @idServicio)
GO
ALTER AUTHORIZATION ON [dbo].[CamasMovimientosSeleccionarPorServicioAnioMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasObtenerConElMismoCodigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasObtenerConElMismoCodigo]
	@codigo [varchar](5),
	@IdCama [int]
WITH EXECUTE AS CALLER
AS
select Camas.IdCama, Servicios.Nombre
     From Camas
     left join Servicios on Servicios.IdServicio = Camas.IdServicioUbicacionActual
     where Camas.codigo = @codigo
    and Camas.IdCama <>  @IdCama
GO
ALTER AUTHORIZATION ON [dbo].[CamasObtenerConElMismoCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasProgramadasPorAnio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasProgramadasPorAnio]
	@lnAnio [int],
	@lbSoloHospitalizacion [bit]
WITH EXECUTE AS CALLER
AS
if @lbSoloHospitalizacion=1
      SELECT  dbo.camasMovimientos.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio,dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.DepartamentosHospital.Nombre AS Ddpto,dbo.Especialidades.IdDepartamento AS CodDpto,dbo.Servicios.IdTipoServicio AS idTipoServicio
                 FROM   dbo.camasMovimientos LEFT OUTER JOIN dbo.Servicios ON dbo.camasMovimientos.idServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento
                 Where  dbo.Servicios.IdTipoServicio=3 and Year(dbo.camasMovimientos.FechaIngreso) =@lnAnio
                 order by dbo.camasMovimientos.idServicio,dbo.camasMovimientos.fechaIngreso
else
   SELECT  dbo.camasMovimientos.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio,dbo.Servicios.IdEspecialidad AS CodEspecialidad, dbo.Especialidades.Nombre AS dEspecialidad, dbo.DepartamentosHospital.Nombre AS Ddpto,dbo.Especialidades.IdDepartamento AS CodDpto,dbo.Servicios.IdTipoServicio AS idTipoServicio
                 FROM   dbo.camasMovimientos LEFT OUTER JOIN dbo.Servicios ON dbo.camasMovimientos.idServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento
                 Where (dbo.Servicios.IdTipoServicio in (2,4)) and Year(dbo.camasMovimientos.FechaIngreso) = @lnAnio
                 order by dbo.camasMovimientos.idServicio,dbo.camasMovimientos.fechaIngreso
GO
ALTER AUTHORIZATION ON [dbo].[CamasProgramadasPorAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarDisponibilidadPorServicioUbicacionActual]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarDisponibilidadPorServicioUbicacionActual]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select IdCama, Codigo, EstadosCama.Descripcion as Estado,
Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno,
Pacientes.PrimerNombre,Pacientes.SegundoNombre as SegundoNombre
, Pacientes.NroHistoriaClinica
from (Camas left join EstadosCama on Camas.IdEstadoCama = EstadosCama.IdEstadoCama)
left join Pacientes on Camas.IdPaciente = Pacientes.IdPaciente
where IdServicioPropietario  = @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarDisponibilidadPorServicioUbicacionActual] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarPorId]
	@IdCama [int]
WITH EXECUTE AS CALLER
AS
select * from Camas
where IdCama = @IdCama
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarPorIdentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarPorIdentificador]
	@lnIdCama [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Camas.*, dbo.Servicios.Nombre AS dservicio
                  FROM         dbo.Camas LEFT OUTER JOIN
                          dbo.Servicios ON dbo.Camas.IdServicioUbicacionActual = dbo.Servicios.IdServicio
                  where dbo.Camas.idCama =@lnIdCama
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarPorIdentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarPorIdPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from Camas where idpaciente=@idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarPorIdServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarPorIdServicio]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Servicios.codigoServicioSuSalud, dbo.Camas.*
FROM         dbo.Camas LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Camas.IdServicioPropietario = dbo.Servicios.IdServicio
WHERE dbo.Camas.idServicioPropietario=@idServicio
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarPorIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarPorServicioUbicacionActual]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarPorServicioUbicacionActual]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from Camas
where IdServicioUbicacionActual = @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarPorServicioUbicacionActual] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarXcodigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarXcodigo]
	@codigo [varchar](5)
WITH EXECUTE AS CALLER
AS
select * from Camas where Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CamasSeleccionarXdptoServicioEspecialidad]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CamasSeleccionarXdptoServicioEspecialidad]
	@ml_TipoReporte [int],
	@lnMes [int],
	@ml_lnAnio [int],
	@ml_idDepartamento1 [int],
	@ml_idEspecialidad1 [int],
	@ml_idServicio1 [int],
	@ml_idServicio2 [int]
WITH EXECUTE AS CALLER
AS
if @ml_TipoReporte=1      /*Por departamento*/
                   SELECT dbo.camasMovimientos.*, dbo.Servicios.Nombre AS Expr1, dbo.Servicios.IdEspecialidad AS Expr2, dbo.Servicios.IdTipoServicio AS Expr3, dbo.Especialidades.IdDepartamento AS idDpto
                               FROM  dbo.Especialidades RIGHT OUTER JOIN dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad RIGHT OUTER JOIN dbo.camasMovimientos ON dbo.Servicios.IdServicio = dbo.camasMovimientos.idServicio
                               Where (dbo.Servicios.IdTipoServicio = 3) and year(dbo.camasMovimientos.fechaIngreso)= @ml_lnAnio and month(dbo.camasMovimientos.fechaIngreso)=@lnMes
                               and (dbo.Especialidades.IdDepartamento=@ml_idDepartamento1)
            else
                 if @ml_TipoReporte=2   /*Por un Servicio*/
                    SELECT  dbo.camasMovimientos.*, dbo.Servicios.Nombre AS Expr1, dbo.Servicios.IdEspecialidad AS Expr2, dbo.Servicios.IdTipoServicio AS Expr3
                                  FROM   dbo.camasMovimientos LEFT OUTER JOIN dbo.Servicios ON dbo.camasMovimientos.idServicio = dbo.Servicios.IdServicio
                                  Where (dbo.Servicios.IdTipoServicio = 3) and year(dbo.camasMovimientos.fechaIngreso)=@ml_lnAnio  and month(dbo.camasMovimientos.fechaIngreso)=@lnMes
                                  and (dbo.Servicios.IdEspecialidad=@ml_idEspecialidad1)
            else
                if @ml_TipoReporte=3  /*Por dos Especialidades*/
                   select * from camasMovimientos where year(fechaIngreso)=@ml_lnAnio and month(fechaIngreso)=@lnMes and (idServicio=@ml_idServicio1 or idServicio=@ml_idServicio2 )
               else
                     select * from camasMovimientos where year(fechaIngreso)=@ml_lnAnio  and month(fechaIngreso)=@lnMes
GO
ALTER AUTHORIZATION ON [dbo].[CamasSeleccionarXdptoServicioEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CargaCamaDisponible]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CargaCamaDisponible]
	@ml_IdServicioConCamaDisponible [int]
WITH EXECUTE AS CALLER
AS
select idCama from camas where idEstadoCama=1 and idServicioUbicacionActual=@ml_IdServicioConCamaDisponible
GO
ALTER AUTHORIZATION ON [dbo].[CargaCamaDisponible] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[cargaCamasDisponiblesXtipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[cargaCamasDisponiblesXtipoServicio]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.Camas.Codigo, dbo.Camas.IdServicioUbicacionActual, dbo.Camas.IdEstadoCama, dbo.Servicios.Nombre AS dservicio,
                      dbo.Especialidades.Nombre AS despecialidad, dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Camas.IdCama,dbo.Servicios.IdTipoServicio
             FROM     dbo.Camas LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Camas.IdServicioUbicacionActual = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento
             order by dbo.Camas.IdServicioUbicacionActual
GO
ALTER AUTHORIZATION ON [dbo].[cargaCamasDisponiblesXtipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosActualizaNULLenIdPartida]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosActualizaNULLenIdPartida]
	@IdPartida [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoBienesInsumos set IdPartida=null where idPartida=@IdPartida
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosActualizaNULLenIdPartida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosActualizaPRECIOS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosActualizaPRECIOS]
	@PrCompraNew [money],
	@PrDistribucionNew [money],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
update factCatalogoBienesInsumos
set PrecioCompra=@PrCompraNew,PrecioDistribucion=@PrDistribucionNew
where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosActualizaPRECIOS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
   SET  @SQL =  'Select cb.IdProducto,cb.Codigo,cb.Nombre,cb.NombreComercial,tb.Descripcion DescTiposDeBienesEInsumos
             from FactCatalogoBienesInsumos cb left join  TiposDeBienesEInsumos tb
             on cb.IdSubGrupoFarmacologico = tb.IdSubGrupoFarmacologico where  ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosFiltrarDonacionesXcodigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosFiltrarDonacionesXcodigo]
	@lcCodigo [varchar](50)
WITH EXECUTE AS CALLER
AS
select PrecioDonacion as PrecioUnitario from FactCatalogoBienesInsumos where codigo=@lcCodigo
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosFiltrarDonacionesXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosHospPorCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosHospPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT         dbo.farmMovimientoVentasDetalle.idProducto, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,
                         dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento
FROM            dbo.farmMovimientoVentasDetalle INNER JOIN
                         dbo.farmMovimientoVentas ON dbo.farmMovimientoVentasDetalle.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                         dbo.farmMovimientoVentasDetalle.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
                         dbo.FactCatalogoBienesInsumosHosp ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
where dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosHospPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosHospSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosHospSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoBienesInsumosHosp.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
             FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosHospSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosHospSeleccionarXIdProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosHospSeleccionarXIdProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumosHosp where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosHospSeleccionarXIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosResumenSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosResumenSeleccionarPorFiltro]
	@Filtro [varchar](50),
	@Order [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
IF @FILTRO = ' '
	SET  @SQL =  'SELECT  idProducto,codigo,Nombre
                                      From FactCatalogoBienesInsumos' +  @Order

ELSE
	SET  @SQL = 'SELECT  idProducto,codigo,Nombre
			          From FactCatalogoBienesInsumos Where ' + @Filtro + ' ' + @Order


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosResumenSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosSeleccionarPorFiltro]
	@Filtro [varchar](50),
	@Order [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
IF @FILTRO = ' '
	Begin
		SET  @SQL = 'SELECT  *  From FactCatalogoBienesInsumos ' + @Order
              End
ELSE
	Begin
		SET  @SQL =    'SELECT  *
			From FactCatalogoBienesInsumos
			Where ' + @Filtro + ' ' + @Order
             End
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesInsumosSeleccionarSoloConPreciosEnSIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesInsumosSeleccionarSoloConPreciosEnSIS]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoBienesInsumos.IdProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,dbo.FactCatalogoBienesInsumos.tipoProducto
                 FROM          dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
                 Where          (dbo.FactCatalogoBienesInsumosHosp.idTipoFinanciamiento = 2) And (dbo.FactCatalogoBienesInsumosHosp.Activo = 1)
                 ORDER BY  dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesInsumosSeleccionarSoloConPreciosEnSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CatalogoBienesSeleccionarPorIdProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.*, dbo.farmTipoSalidaBienInsumo.tipo
FROM         dbo.FactCatalogoBienesInsumos LEFT OUTER JOIN
                      dbo.farmTipoSalidaBienInsumo ON
                      dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
              Where dbo.FactCatalogoBienesInsumos.IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoBienesSeleccionarPorIdYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoBienesSeleccionarPorIdYtipoFinanciamiento]
	@idProducto [int],
	@TipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumosHosp.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
             FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
             WHERE     dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = @TipoFinanciamiento
                                and dbo.FactCatalogoBienesInsumos.idProducto = @idProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoBienesSeleccionarPorIdYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServicioActualizaNULLenIdPartida]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServicioActualizaNULLenIdPartida]
	@IdPartida [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set IdPartida=null where idPartida=@IdPartida
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServicioActualizaNULLenIdPartida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosActualizaPartidaXidProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosActualizaPartidaXidProducto]
	@ValorIdPartidaNULL [int],
	@IdPartida [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
IF @ValorIdPartidaNULL=1
	BEGIN
		update FactCatalogoServicios set IdPartida=null where idProducto=@IdProducto and idPartida=@IdPartida
	END
ELSE
	BEGIN
		update FactCatalogoServicios set IdPartida=@IdPartida where idProducto=@IdProducto
	END
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosActualizaPartidaXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServicioSeleccionarPorIdYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServicioSeleccionarPorIdYtipoFinanciamiento]
	@idProducto [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select  FactCatalogoServicios.Codigo,
		               FactCatalogoServicios.Nombre as NombreProducto, FactCatalogoServiciosHosp.PrecioUnitario,FactCatalogoServiciosHosp.SeUsaSinPrecio
		    From    FactCatalogoServiciosHosp
		               left join FactCatalogoServicios
		    on       FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto
		    Where
		               FactCatalogoServiciosHosp.IdTipoFinanciamiento = @idProducto
		               and FactCatalogoServicios.idProducto = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServicioSeleccionarPorIdYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosHospEliminarXidProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosHospEliminarXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosHosp where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosHospEliminarXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosHospPorCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosHospPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.FacturacionServicioDespacho.IdProducto, dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento
FROM            dbo.FacturacionServicioDespacho INNER JOIN
                         dbo.FactCatalogoServiciosHosp ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto INNER JOIN
                         dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE        (dbo.FactOrdenServicio.IdCuentaAtencion = @idCuentaAtencion )
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosHospPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosHospSeleccionarXidProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosHospSeleccionarXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosHospSeleccionarXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosHospSeleccionarXidProductoIdTipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosHospSeleccionarXidProductoIdTipoFinanciamiento]
	@IdProducto [int],
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp
	where idProducto=@IdProducto
             and idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosHospSeleccionarXidProductoIdTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarPorIdProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     *
             From dbo.FactCatalogoServicios
             Where IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarSoloAdministrativos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarSoloAdministrativos]
WITH EXECUTE AS CALLER
AS
SELECT     IdProducto, Codigo, Nombre, IdServicioSubGrupo,idEstado
                 From FactCatalogoServicios
                 Where (IdServicioSubGrupo = 24)
                 ORDER BY Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarSoloAdministrativos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnParticular]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnParticular]
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
if @IdPuntoCarga=2600        --otros Servicios diferentes a LABORATORIO/IMAGENES/CAJA/CONSUMOenSERVICIO
    begin
	SELECT        dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre + ' <<' + rtrim(dbo.FactPuntosCarga.Descripcion)+'>>' AS nombre,
                         dbo.FactCatalogoServicios.idEstado, dbo.FactCatalogoServiciosPtos.idPuntoCarga
    FROM            dbo.FactPuntosCarga INNER JOIN
                         dbo.FactCatalogoServiciosPtos ON dbo.FactPuntosCarga.IdPuntoCarga = dbo.FactCatalogoServiciosPtos.idPuntoCarga LEFT OUTER JOIN
                         dbo.FactCatalogoServicios ON dbo.FactCatalogoServiciosPtos.idProducto = dbo.FactCatalogoServicios.IdProducto RIGHT OUTER JOIN
                         dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
    WHERE       not (dbo.FactCatalogoServiciosPtos.idPuntoCarga in (20,21,22,23,2,3,32,11,38,99,1))
	AND (dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = 1)
	AND (dbo.FactCatalogoServicios.EsCPT = 1)
    ORDER BY  dbo.FactCatalogoServicios.Nombre
    /*
    SELECT   distinct     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo,
	                      dbo.FactCatalogoServicios.Nombre,
						  dbo.FactCatalogoServicios.idEstado
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
                                  dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
             WHERE       not (dbo.FactCatalogoServiciosPtos.idPuntoCarga in (20,21,22,23,2,3,32,11,38))
	           AND (dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = 1)
	           AND (dbo.FactCatalogoServicios.EsCPT = 1)
             ORDER BY  dbo.FactCatalogoServicios.Nombre
    */
    end
else
    SELECT   distinct     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.idEstado
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
                                  dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
             WHERE       (dbo.FactCatalogoServiciosPtos.idPuntoCarga = @IdPuntoCarga
	           AND (dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = 1)
	           AND (dbo.FactCatalogoServicios.EsCPT = 1))
             ORDER BY  dbo.FactCatalogoServicios.Nombre

GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnParticular] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnSIS]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnSIS]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                      dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento, dbo.FactCatalogoServicios.EsCPT, dbo.FactCatalogoServiciosHosp.PrecioUnitario,
                                      dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.idEstado
                 FROM          dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
                 WHERE      (dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = 2) AND ( (dbo.FactCatalogoServiciosHosp.PrecioUnitario > 0) OR  (dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio = 1)) AND
                                     (dbo.FactCatalogoServicios.EsCPT = 1)
                 ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarSoloConPreciosEnSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarSoloPtoCargaYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarSoloPtoCargaYtipoFinanciamiento]
	@IdPuntoCarga [int],
	@lnIdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT  distinct     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.idEstado
                 FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
                                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
                 WHERE       (dbo.FactCatalogoServiciosPtos.idPuntoCarga = @IdPuntoCarga
		           AND (dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = @lnIdTipoFinanciamiento)
		           AND (dbo.FactCatalogoServicios.EsCPT = 1))
                 ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarSoloPtoCargaYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.FactCatalogoServicios.*
             From dbo.FactCatalogoServicios
             ORDER BY Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarTodosOrdenadoXnombre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarTodosOrdenadoXnombre]
WITH EXECUTE AS CALLER
AS
select  * from FactCatalogoServicios order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarTodosOrdenadoXnombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CatalogoServiciosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CatalogoServiciosSeleccionarXidentificador]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServicios where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CatalogoServiciosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosCostoAgregar]
	@Codigo [varchar](10),
	@IdCentroCosto [int] OUTPUT,
	@Descripcion [varchar](255),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CentrosCosto (
Codigo,Descripcion) values (
@Codigo,@Descripcion)
set @IdCentroCosto = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCentroCosto,'CentrosCosto'
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosCostoEliminar]
	@IdCentroCosto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CentrosCosto
where IdCentroCosto = @IdCentroCosto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCentroCosto,'CentrosCosto'
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CentrosCostoFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'Select *
            from CentrosCosto   ' +  @lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosCostoModificar]
	@Codigo [varchar](10),
	@IdCentroCosto [int],
	@Descripcion [varchar](255),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CentrosCosto
set
Codigo = @Codigo,
Descripcion = @Descripcion
where IdCentroCosto = @IdCentroCosto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCentroCosto,'CentrosCosto'
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosCostoSeleccionarPorId]
	@IdCentroCosto [int]
WITH EXECUTE AS CALLER
AS
select * from CentrosCosto
where IdCentroCosto = @IdCentroCosto
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CentrosCostoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from CentrosCosto order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosCostosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CentrosCostosSeleccionarXidentificador]
	@IdCentroCosto [int]
WITH EXECUTE AS CALLER
AS
select * from centrosCosto where idCentroCosto=@IdCentroCosto
GO
ALTER AUTHORIZATION ON [dbo].[CentrosCostosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosPobladosDevuelveDptoProvDistritoSegunIdCentroPoblado]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CentrosPobladosDevuelveDptoProvDistritoSegunIdCentroPoblado]
	@IdCentroPoblado [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CentrosPoblados.IdCentroPoblado, dbo.CentrosPoblados.Nombre AS nCentroPoblado, dbo.CentrosPoblados.IdDistrito,
                      dbo.Distritos.Nombre AS nDistrito, dbo.Distritos.IdProvincia, dbo.Provincias.Nombre AS nProvincia, dbo.Provincias.IdDepartamento,
                      dbo.Departamentos.Nombre AS nDpto
FROM         dbo.CentrosPoblados LEFT OUTER JOIN
                      dbo.Distritos ON dbo.CentrosPoblados.IdDistrito = dbo.Distritos.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias ON dbo.Distritos.IdProvincia = dbo.Provincias.IdProvincia LEFT OUTER JOIN
                      dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento
WHERE dbo.CentrosPoblados.idCentroPoblado=@IdCentroPoblado
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPobladosDevuelveDptoProvDistritoSegunIdCentroPoblado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosPobladosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosPobladosEliminar]
	@IdCentroPoblado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CentrosPoblados
where IdCentroPoblado = @IdCentroPoblado
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPobladosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosPobladosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosPobladosModificar]
	@IdDistrito [int],
	@Nombre [varchar](50),
	@IdCentroPoblado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CentrosPoblados
set
IdDistrito = @IdDistrito,
Nombre = @Nombre
where IdCentroPoblado = @IdCentroPoblado
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPobladosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosPobladosSeleccionarPorDistrito]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CentrosPobladosSeleccionarPorDistrito]
	@IdDistrito [int]
WITH EXECUTE AS CALLER
AS
select IdCentroPoblado, Nombre,
(Convert(varchar(10),IdCentroPoblado) + ' = ' + Nombre) as DescripcionLarga
 from CentrosPoblados
where IdDistrito = @IdDistrito
order by Nombre
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPobladosSeleccionarPorDistrito] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CentrosPobladosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CentrosPobladosSeleccionarPorId]
	@IdCentroPoblado [int]
WITH EXECUTE AS CALLER
AS
select * from CentrosPoblados
where IdCentroPoblado = @IdCentroPoblado
GO
ALTER AUTHORIZATION ON [dbo].[CentrosPobladosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ChequeaSiEsPagosAcuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ChequeaSiEsPagosAcuenta]
	@IdComprobantePago [int],
	@IdPagosACuenta [int],
	@IdTipoOrden [int]
WITH EXECUTE AS CALLER
AS
If @IdTipoOrden = 1
	SELECT        dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FacturacionServicioPagos.idProducto,
                         dbo.FacturacionServicioPagos.Total
	FROM            dbo.FactOrdenServicioPagos INNER JOIN
                         dbo.FacturacionServicioPagos ON
                         dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago

			 WHERE dbo.FactOrdenServicioPagos.idComprobantePago = @IdComprobantePago
Else
	SELECT        dbo.FactOrdenesBienes.idComprobantePago, dbo.FacturacionBienesPagos.TotalPagar as Total,
                         dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FacturacionBienesPagos.IdProducto
	FROM            dbo.FactOrdenesBienes INNER JOIN
                         dbo.FacturacionBienesPagos ON
                         dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden
			 WHERE    dbo.FactOrdenesBienes.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ChequeaSiEsPagosAcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CierraPreVentasFarmaciaDelDiaAnterior]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CierraPreVentasFarmaciaDelDiaAnterior]
	@FechaCreacion [datetime],
	@HoraCreacion [char](5)
WITH EXECUTE AS CALLER
AS
Update farmPreVenta
set idEstadoPreventa=0
where idEstadoPreventa=1 and FechaCreacion<@FechaCreacion and horaCreacion<@HoraCreacion
GO
ALTER AUTHORIZATION ON [dbo].[CierraPreVentasFarmaciaDelDiaAnterior] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizaDatosDeReporgramacionXmedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasActualizaDatosDeReporgramacionXmedico]
	@IdResponsableNew [int],
	@IdAtencion [int],
	@IdProgramacionNew [int]
WITH EXECUTE AS CALLER
AS
UPDATE Atenciones set idMedicoIngreso= @IdResponsableNew  where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

UPDATE Citas set idMedico=@IdResponsableNew, idProgramacion=@IdProgramacionNew where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizaDatosDeReporgramacionXmedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizaDatosDeReprogramacionXfecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasActualizaDatosDeReprogramacionXfecha]
	@IdAtencion [int],
	@IdProgramacionNew [int],
	@Fecha [datetime],
	@IdServicioCENew [int] = 0
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
--SCCQ 21/02/2020 Cambio7 Inicio
if @IdServicioCENew=0--No se envió parámetro de idServicioCENew, toma valor por defecto 0
	BEGIN
--SCCQ 21/02/2020 Cambio7 Fin
		UPDATE Atenciones set FechaIngreso=@Fecha where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END

		UPDATE HistoriasSolicitadas set FechaRequerida=@Fecha where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END

		update Citas set fecha=@Fecha, idProgramacion=@IdProgramacionNew where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END
--SCCQ 21/02/2020 Cambio7 Inicio
	END
else --Se envió parámetro de idServicioCENew
	BEGIN
		UPDATE Atenciones set FechaIngreso=@Fecha, IdServicioIngreso=@IdServicioCENew where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END

		UPDATE HistoriasSolicitadas set FechaRequerida=@Fecha, IdServicio=@IdServicioCENew where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END

		update Citas set fecha=@Fecha, idProgramacion=@IdProgramacionNew, IdServicio=@IdServicioCENew where idAtencion=@IdAtencion
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RETURN
			END

	END
--SCCQ 21/02/2020 Cambio7 Fin
COMMIT
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarCEDisponiblesXFecha]    Script Date: 10/03/2020 10:50:22 a. m. ******/

GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizaDatosDeReprogramacionXfecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizaDatosXpaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasActualizaDatosXpaciente]
	@HoraInicio [char](5),
	@FechaIngreso [datetime],
	@IdMedicoIngreso [int],
	@IdServicioIngreso [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION

update atenciones
set FechaIngreso=@FechaIngreso, HoraIngreso=@HoraInicio, idMedicoIngreso=@IdMedicoIngreso,idServicioIngreso=@IdServicioIngreso
where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update HistoriasSolicitadas
set  idServicio=@IdServicioIngreso,FechaRequerida=@FechaIngreso,HoraRequerida=@HoraInicio
where idAtencion=@IdAtencion
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

delete from citas where idAtencion=@IdAtencion  --Elimina cita actual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizaDatosXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizarCitaPagada]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasActualizarCitaPagada]
	@IdAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
declare @HoraRequerida char(5)
declare @FechaRequerida datetime
declare @IdPaciente int
declare @Observacion varchar(150)
declare @IdServicio int
declare @NroFilas int

--Actualiza el estado de la cita
update Citas set IdEstadoCita = 4 where IdAtencion = @IdAtencion

	--Crea una solicitud automatica de historia clinica
	select @IdServicio = idServicio, @IdPaciente = IdPaciente, @FechaRequerida = Fecha, @HoraRequerida = HoraInicio from Citas where IdAtencion = @IdAtencion
	set @NroFilas = @@rowcount

	if @NroFilas > 0
	begin
		set @Observacion = "CITA CE - Ubicar historia clínica para el día: " + convert(char(10), @FechaRequerida, 103) + " a las " + @HoraRequerida + " horas."
		insert into HistoriasSolicitadas (
		IdMotivo,HoraRequerida,FechaRequerida,HoraSolicitud,FechaSolicitud,IdPaciente,IdEmpleadoSolicita,IdMovimiento,Observacion,IdServicio)
		values (1, @HoraRequerida, @FechaRequerida, convert(char(5), getdate(), 108), getdate(), @IdPaciente, @IdUsuarioAuditoria, null,  @Observacion, @IdServicio)
	end

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCita,'Citas'
GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizarCitaPagada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizarCitaPagadaDEBB]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasActualizarCitaPagadaDEBB]
	@IdAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
--BEGIN TRANSACTION

declare @HoraRequerida char(5)
declare @FechaRequerida datetime
declare @IdPaciente int
declare @Observacion varchar(150)
declare @IdServicio int
declare @NroFilas int
            --Actualiza el estado de la cita
             update Citas set IdEstadoCita = 4 where IdAtencion = @IdAtencion

	--Crea una solicitud automatica de historia clinica
	select @IdServicio = idServicio, @IdPaciente = IdPaciente, @FechaRequerida = Fecha, @HoraRequerida = HoraInicio from Citas where IdAtencion = @IdAtencion
	set @NroFilas = @@rowcount

	if @NroFilas > 0
	begin
                         update HistoriasSolicitadas set IdEmpleadoSolicita=@IdUsuarioAuditoria where idPaciente=@idPaciente and FechaRequerida=@FechaRequerida and IdServicio=@IdServicio
	end


--COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizarCitaPagadaDEBB] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasActualizarConIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasActualizarConIdAtencion]
	@idAtencion [int],
	@IdCita [int]
WITH EXECUTE AS CALLER
AS
update Citas set IdAtencion = @idAtencion where IdCita = @IdCita
GO
ALTER AUTHORIZATION ON [dbo].[CitasActualizarConIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasAgregar]
	@HoraSolicitud [char](5),
	@FechaSolicitud [datetime],
	@IdProducto [int],
	@IdProgramacion [int],
	@IdServicio [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@IdCita [int] OUTPUT,
	@Fecha [datetime],
	@IdEstadoCita [int],
	@IdMedico [int],
	@IdEspecialidad [int],
	@IdAtencion [int],
	@IdPaciente [int],
	@EsCitaAdicional [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarHoraFinProgramacion char(5), @VarHoraFin char(5);

	SELECT @VarHoraFinProgramacion = HoraFinProgramacion, @VarHoraFin = HoraFin
	FROM ProgramacionMedica WHERE IdProgramacion = @IdProgramacion;

	IF @VarHoraFinProgramacion IS NULL
	BEGIN
		SET @VarHoraFinProgramacion = @VarHoraFin;
	END

	IF @VarHoraFinProgramacion <= @HoraInicio
	BEGIN
		SET @EsCitaAdicional = 1;
	END
	---inicio WABG 24/07/2023 TKE002
	IF EXISTS (
		SELECT
	   [IdCita]
	   FROM Citas
	   WHERE HoraSolicitud = @HoraSolicitud
		AND Fecha = @Fecha
		AND HoraInicio = @HoraInicio
		AND HoraFin = @HoraFin
		AND IdMedico = @IdMedico
		AND IdEspecialidad = @IdEspecialidad
		AND IdServicio = @IdServicio
		AND IdProgramacion = @IdProgramacion
		AND IdProducto = @IdProducto
	)
	BEGIN
		RAISERROR('El Cupo ya no esta disponible.', 16, 1);
		RETURN;
	END
	---fin WABG 24/07/2023 TKE002
	INSERT INTO Citas (HoraSolicitud, FechaSolicitud, IdProducto, IdProgramacion,
			IdServicio, HoraFin, HoraInicio, Fecha, IdEstadoCita, IdMedico,
			IdEspecialidad, IdAtencion, IdPaciente, EsCitaAdicional)
	VALUES (@HoraSolicitud, @FechaSolicitud, @IdProducto, @IdProgramacion,
			@IdServicio,@HoraFin, @HoraInicio, @Fecha, @IdEstadoCita, @IdMedico,
			@IdEspecialidad, @IdAtencion, @IdPaciente, @EsCitaAdicional)


	SET @IdCita = @@Identity

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCita,'Citas'

	IF @EsCitaAdicional = 1
	BEGIN
		IF (SELECT HoraFinProgramacion FROM ProgramacionMedica WHERE IdProgramacion = @IdProgramacion) IS NULL
		BEGIN
			UPDATE ProgramacionMedica SET  HoraFinProgramacion = HoraFin
			WHERE IdProgramacion = @IdProgramacion;
		END
	END;
GO
ALTER AUTHORIZATION ON [dbo].[CitasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasAgregar]
	@IdCitaBloqueada [int] OUTPUT,
	@HoraBloqueo [char](5),
	@FechaBloqueo [datetime],
	@IdMedico [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@Fecha [datetime],
	@IdUsuario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into CitasBloqueadas (
HoraBloqueo,FechaBloqueo,IdMedico,HoraFin,HoraInicio,Fecha,IdUsuario) values (
@HoraBloqueo,@FechaBloqueo,@IdMedico,@HoraFin,@HoraInicio,@Fecha,@IdUsuario)
set @IdCitaBloqueada = @@Identity

/*exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCitaBloqueada,'CitasBloqueadas'*/
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasEliminar]
	@IdCitaBloqueada [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas
where IdCitaBloqueada = @IdCitaBloqueada
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCitaBloqueada,'CitasBloqueadas'
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasEliminarPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasEliminarPorFechas]
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas where Fecha  Between @FechaInicial and @FechaFinal
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasEliminarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasEliminarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasEliminarPorId]
	@IdCitaBloqueada [int]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas where IdCitaBloqueada=@IdCitaBloqueada
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasEliminarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasEliminarPorUsuario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasEliminarPorUsuario]
	@IdUsuario [int]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas
where IdUsuario = @IdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasEliminarPorUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasEliminarXusuario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasEliminarXusuario]
	@lIdUsuario [int]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas where horaBloqueo<>'Web' and idUsuario=@lIdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasEliminarXusuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasModificar]
	@IdCitaBloqueada [int],
	@HoraBloqueo [char](5),
	@FechaBloqueo [datetime],
	@IdMedico [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@Fecha [datetime],
	@IdUsuario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update CitasBloqueadas
set
HoraBloqueo = @HoraBloqueo,
FechaBloqueo = @FechaBloqueo,
IdMedico = @IdMedico,
HoraFin = @HoraFin,
HoraInicio = @HoraInicio,
Fecha = @Fecha,
IdUsuario = @IdUsuario
where IdCitaBloqueada = @IdCitaBloqueada
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCitaBloqueada,'CitasBloqueadas'
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasSeleccionarPorId]
	@IdCitaBloqueada [int]
WITH EXECUTE AS CALLER
AS
select * from CitasBloqueadas
where IdCitaBloqueada = @IdCitaBloqueada
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasSeleccionarTodas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasSeleccionarTodas]
WITH EXECUTE AS CALLER
AS
select * from CitasBloqueadas
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasSeleccionarTodas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasBloqueadasWEBEliminarXFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasBloqueadasWEBEliminarXFechas]
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
delete from CitasBloqueadas where HoraBloqueo ='Web' and Fecha  Between @FechaInicial and @FechaFinal
GO
ALTER AUTHORIZATION ON [dbo].[CitasBloqueadasWEBEliminarXFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasEliminar]
	@IdCita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Citas
where IdCita = @IdCita
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCita,'Citas'
GO
ALTER AUTHORIZATION ON [dbo].[CitasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[citasFormaCitaActualiza]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[citasFormaCitaActualiza]
	@idCuentaAtencion [int],
	@formaCita [varchar](1)
WITH EXECUTE AS CALLER
AS
update Citas set formacita =@formacita where IdAtencion =(
                  select top 1 IdAtencion from Atenciones
                  where Atenciones.IdAtencion =citas.IdAtencion  and
                  Atenciones.IdCuentaAtencion =@idCuentaatencion )
GO
ALTER AUTHORIZATION ON [dbo].[citasFormaCitaActualiza] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[citasFormaCitaSeleccionaXcuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[citasFormaCitaSeleccionaXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select formacita from Citas where  IdAtencion =(
                  select top 1 IdAtencion from Atenciones
                  where Atenciones.IdAtencion =citas.IdAtencion  and
                  Atenciones.IdCuentaAtencion =@idCuentaatencion )
GO
ALTER AUTHORIZATION ON [dbo].[citasFormaCitaSeleccionaXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasModificar]
	@HoraSolicitud [char](5),
	@FechaSolicitud [datetime],
	@IdProducto [int],
	@IdProgramacion [int],
	@IdServicio [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@IdCita [int],
	@Fecha [datetime],
	@IdEstadoCita [int],
	@IdMedico [int],
	@IdEspecialidad [int],
	@IdAtencion [int],
	@IdPaciente [int],
	@EsCitaAdicional [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Citas
set
HoraSolicitud = @HoraSolicitud,
FechaSolicitud = @FechaSolicitud,
IdProducto = @IdProducto,
IdProgramacion = @IdProgramacion,
IdServicio = @IdServicio,
HoraFin = @HoraFin,
HoraInicio = @HoraInicio,
Fecha = @Fecha,
IdEstadoCita = @IdEstadoCita,
IdMedico = @IdMedico,
IdEspecialidad = @IdEspecialidad,
IdAtencion = @IdAtencion,
IdPaciente = @IdPaciente,
EsCitaAdicional=@EsCitaAdicional
where IdCita = @IdCita
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCita,'Citas'
GO
ALTER AUTHORIZATION ON [dbo].[CitasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasMuestraAteriores]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasMuestraAteriores]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.Atenciones.FechaIngreso AS Fecha, dbo.Servicios.Nombre AS Consultorio, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
                                       TiposCondicionPaciente_1.Descripcion AS CE, dbo.TiposCondicionPaciente.Descripcion AS CS,
                                       (CASE WHEN DBO.Atenciones.HoraEgreso IS null THEN 'N' ELSE 'S' END) AS Atendido
                  FROM          dbo.Servicios RIGHT OUTER JOIN
                                       dbo.Atenciones LEFT OUTER JOIN
                                       dbo.TiposCondicionPaciente TiposCondicionPaciente_1 ON
                                       dbo.Atenciones.IdTipoCondicionALEstab = TiposCondicionPaciente_1.IdTipoCondicionPaciente LEFT OUTER JOIN
                                       dbo.TiposCondicionPaciente ON dbo.Atenciones.IdTipoCondicionAlServicio = dbo.TiposCondicionPaciente.IdTipoCondicionPaciente LEFT OUTER JOIN
                                       dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
                                       dbo.Servicios.idServicio = dbo.Atenciones.IdServicioIngreso
                  WHERE        dbo.Atenciones.idTipoServicio=1 and dbo.Atenciones.idEstadoAtencion>0  and dbo.Atenciones.idPaciente=@IdPaciente
                  ORDER BY   dbo.Atenciones.FechaIngreso DESC,dbo.Atenciones.horaIngreso desc
GO
ALTER AUTHORIZATION ON [dbo].[CitasMuestraAteriores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasNOexistentes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasNOexistentes]
WITH EXECUTE AS CALLER
AS
select *,(select top 1 idMedicoIngreso from Atenciones where IdAtencion =HistoriasSolicitadas.IdAtencion  ) as idMedico
                                  from HistoriasSolicitadas where  LEFT(HistoriasSolicitadas.Observacion,4) ='CITA' and
										 (select top 1 IdPaciente from Citas where
										  Fecha=HistoriasSolicitadas.FechaRequerida  and
										  HoraInicio=HistoriasSolicitadas.HoraRequerida  and
										  IdPaciente=HistoriasSolicitadas.IdPaciente  and
										  IdServicio=HistoriasSolicitadas.IdServicio
										   ) is null
GO
ALTER AUTHORIZATION ON [dbo].[CitasNOexistentes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasPorAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasPorAtencion]
	@IdServicio [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Citas.IdCita, dbo.Citas.IdProgramacion, dbo.Citas.Fecha, dbo.Citas.HoraInicio, dbo.Citas.IdAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.idDistritoDomicilio,
          dbo.Pacientes.PrimerNombre , dbo.Pacientes.SegundoNombre, dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroHistoriaClinica,dbo.Citas.idServicio, dbo.Pacientes.idDocIdentidad, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdTipoSexo,dbo.Pacientes.idPaciente,
	dbo.Atenciones.idFuenteFinanciamiento
FROM       dbo.Citas LEFT OUTER JOIN
                     dbo.Pacientes ON dbo.Citas.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
		dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion
WHERE  dbo.Citas.Fecha =@Fecha
       and dbo.Citas.idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CitasPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarBloqueadasPorMedicoYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarBloqueadasPorMedicoYFecha]
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
select * from CitasBloqueadas
where IdMedico = @IdMedico
and Fecha = @Fecha
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarBloqueadasPorMedicoYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarDisponiblesPorMedicoEspecialidadYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarDisponiblesPorMedicoEspecialidadYFecha]
	@IdMedico [int],
	@IdEspecialidad [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
select Medicos.IdMedico, ProgramacionMedica.HoraInicio
, ProgramacionMedica.HoraFin, ProgramacionMedica.IdEspecialidad
, Especialidades.Nombre, EspecialidadCE.TiempoPromedioAtencion as tpaEspecialidadCE,
ProgramacionMedica.Fecha, ProgramacionMedica.IdProgramacion,ProgramacionMedica.TiempoPromedioAtencion,
ProgramacionMedica.IdServicio
 from
(((ProgramacionMedica inner join Medicos on ProgramacionMedica.IdMedico = Medicos.IdMedico)
inner join Especialidades on ProgramacionMedica.IdEspecialidad = Especialidades.IdEspecialidad)
inner join EspecialidadCE on EspecialidadCE.IdEspecialidad = Especialidades.IdEspecialidad)
where ProgramacionMedica.IdTipoServicio = 1
and Medicos.IdMedico = @IdMedico
and ProgramacionMedica.Fecha = @Fecha
and ProgramacionMedica.IdEspecialidad = @IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarDisponiblesPorMedicoEspecialidadYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarDisponiblesPorMedicoYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarDisponiblesPorMedicoYFecha]
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
select Medicos.IdMedico, ProgramacionMedica.HoraInicio
, ProgramacionMedica.HoraFin, Especialidades.IdEspecialidad
, Especialidades.Nombre, ProgramacionMedica.Fecha,
Especialidades.TiempoPromedioAtencion as TiempoPromedioConsulta, ProgramacionMedica.IdProgramacion
 from
(((ProgramacionMedica inner join Medicos
on ProgramacionMedica.IdMedico = Medicos.IdMedico)
inner join MedicosEspecialidad
on Medicos.IdMedico = MedicosEspecialidad.IdMedico)
inner join Especialidades
on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
where ProgramacionMedica.IdTipoServicio = 1
and Medicos.IdMedico = @IdMedico
and ProgramacionMedica.Fecha = @Fecha
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarDisponiblesPorMedicoYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPacientePorMedicoYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPacientePorMedicoYFecha]
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Citas.HoraInicio AS HI, dbo.Citas.HoraFin AS HF, dbo.Pacientes.ApellidoPaterno AS ApPaterno, dbo.Pacientes.ApellidoMaterno AS ApMaterno,
                      dbo.Pacientes.PrimerNombre AS Nombre, dbo.Citas.FechaSolicitud, dbo.Citas.HoraSolicitud
FROM         dbo.Citas INNER JOIN
                      dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Citas.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     Citas.IdMedico = @IdMedico and Citas.Fecha = @Fecha
order by citas.HoraInicio


--select citas.HoraInicio as HI, citas.HoraFin as HF,
--pacientes.apellidoPaterno as ApPaterno,
--pacientes.ApellidoMAterno as ApMaterno,
--pacientes.primerNombre as Nombre,
--citas.FechaSolicitud,
--citas.HoraSolicitud
--from citas left join pacientes
--on citas.idpaciente = pacientes.idpaciente
--where
--Citas.IdMedico = @IdMedico
--and Citas.Fecha = @Fecha
--order by citas.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPacientePorMedicoYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorId]
	@IdCita [int]
WITH EXECUTE AS CALLER
AS
select * from Citas
where IdCita = @IdCita
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorIdProgramacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorIdProgramacion]
	@idProgramacion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Citas.*
FROM         dbo.Citas INNER JOIN
                      dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion
WHERE     (dbo.Atenciones.idEstadoAtencion <> 0) and dbo.Citas.idProgramacion=@idProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorIdProgramacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorMedicoYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorMedicoYFecha]
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     *
FROM         dbo.Citas C INNER JOIN
                      dbo.Atenciones ON C.IdAtencion = dbo.Atenciones.IdAtencion
WHERE      IdMedico = @IdMedico and Fecha = @Fecha
ORDER BY C.Fecha, C.HoraInicio

--select *
--from Citas As C
--where IdMedico = @IdMedico
--and Fecha = @Fecha
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorMedicoYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorNroCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorNroCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
        dbo.Citas.IdCita,dbo.Citas.IdProgramacion
FROM         dbo.Atenciones INNER JOIN
                      dbo.Citas ON dbo.Atenciones.IdAtencion = dbo.Citas.IdAtencion
WHERE   dbo.Atenciones.IdCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorPacienteYFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorPacienteYFecha]
	@IdPaciente [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     CONVERT(char(10), dbo.Citas.Fecha, 103) AS Fecha, dbo.Citas.HoraInicio, dbo.Citas.HoraFin, dbo.Citas.IdMedico,
                      dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS Nombre, dbo.Citas.IdServicio,
                      dbo.Servicios.Nombre AS NombreServicio, dbo.Citas.IdEspecialidad, dbo.Citas.IdCita
FROM         dbo.Citas INNER JOIN
                      dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Citas.IdServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Medicos ON dbo.Citas.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN
                      dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE     (dbo.Atenciones.idEstadoAtencion = 1) and dbo.citas.IdPaciente = @IdPaciente

--select convert(char(10), Fecha, 103) as Fecha, citas.HoraInicio, citas.HoraFin,citas.IdMedico,
--Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno  + ' ' + Empleados.Nombres as Nombre,
--citas.IdServicio, Servicios.Nombre as NombreServicio ,citas.IdEspecialidad , citas.IdCita
--from ((citas left join Servicios
--on Citas.IdServicio = Servicios.IdServicio) left join Medicos
--on Citas.IdMedico = Medicos.IdMedico) left join Empleados
--on Medicos.IdEmpleado = Empleados.IdEmpleado
--where IdPaciente = @IdPaciente -- and Fecha >= @Fecha
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorPacienteYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorServicioTurnoFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorServicioTurnoFecha]
	@Fecha [datetime],
	@IdServicio [int],
	@IdTurno [int],
	@Hora [varchar](5)
WITH EXECUTE AS CALLER
AS
SELECT dbo.Citas.IdProgramacion, dbo.Citas.Fecha, dbo.Citas.HoraInicio,dbo.Citas.HoraFin, dbo.ProgramacionMedica.IdTurno,
       dbo.Citas.idServicio
FROM   dbo.Citas inner join dbo.ProgramacionMedica on dbo.ProgramacionMedica.IdProgramacion=dbo.Citas.IdProgramacion
WHERE  dbo.Citas.Fecha = @Fecha
       and dbo.Citas.idServicio=@IdServicio and dbo.ProgramacionMedica.IdTurno=@IdTurno and dbo.Citas.HoraInicio>=@Hora
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorServicioTurnoFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarPorServicioYfecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarPorServicioYfecha]
	@IdServicio [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Citas.IdProgramacion, dbo.Citas.Fecha, dbo.Citas.HoraInicio, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.idDistritoDomicilio,
          dbo.Pacientes.PrimerNombre , dbo.Pacientes.SegundoNombre, dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroHistoriaClinica,dbo.Citas.idServicio, dbo.Pacientes.idDocIdentidad, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdTipoSexo,dbo.Pacientes.idPaciente
FROM         dbo.Citas LEFT OUTER JOIN
                     dbo.Pacientes ON dbo.Citas.IdPaciente = dbo.Pacientes.IdPaciente
WHERE  dbo.Citas.Fecha =@Fecha
       and dbo.Citas.idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarPorServicioYfecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleccionarXfechaMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CitasSeleccionarXfechaMedico]
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
select *
from Citas
where fecha=@Fecha and idMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleccionarXfechaMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CitasSeleeccionarPacientePorMedicoFechaHoras]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CitasSeleeccionarPacientePorMedicoFechaHoras]
	@IdMedico [int],
	@Fecha [datetime],
	@HoraInicial [char](5),
	@HoraFinal [char](5)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Citas.HoraInicio AS HI, dbo.Citas.HoraFin AS HF, dbo.Pacientes.ApellidoPaterno AS ApPaterno, dbo.Pacientes.ApellidoMaterno AS ApMaterno,
                      dbo.Pacientes.PrimerNombre AS Nombre, dbo.Citas.FechaSolicitud, dbo.Citas.HoraSolicitud
FROM         dbo.Citas INNER JOIN
                      dbo.Atenciones ON dbo.Citas.IdAtencion = dbo.Atenciones.IdAtencion INNER JOIN
                      dbo.Pacientes ON dbo.Citas.IdPaciente = dbo.Pacientes.IdPaciente
WHERE  Citas.IdMedico = @IdMedico and Citas.Fecha =@Fecha
       and  dbo.Citas.HoraInicio>=@HoraInicial and  dbo.Citas.HOraInicio<@HoraFinal
order by citas.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[CitasSeleeccionarPacientePorMedicoFechaHoras] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ColegiosHISseleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ColegiosHISseleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from HIS_colegios
order by cod_col
GO
ALTER AUTHORIZATION ON [dbo].[ColegiosHISseleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ComprobanteFarmaciaSeleccionarPorSerieDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ComprobanteFarmaciaSeleccionarPorSerieDocumento]
	@NroSerie [int],
	@NroDocumento [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoBienesInsumos.Codigo AS codigo, dbo.FactCatalogoBienesInsumos.Nombre AS nombreProducto,
                    dbo.FacturacionBienesInsumos.*, dbo.CajaComprobantesPago.NroSerie AS nroSerie, dbo.CajaComprobantesPago.NroDocumento AS nroDocumento,
                    dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                    dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.CajaComprobantesPago.IdEstadoComprobante AS IdEstadoComprobante,
                     dbo.CajaComprobantesPago.IdTipoOrden AS Expr11, dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja,
                     dbo.CajaGestion.IdTurno AS idTurno, dbo.CajaGestion.FechaCierre AS Expr15, dbo.CajaGestion.IdCajero AS Expr16,
                     dbo.FacturacionCuentasAtencion.IdPaciente AS Expr17, dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno,
                     dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre,
                     dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica, dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago,
                     dbo.CajaComprobantesPago.Dctos,dbo.CajaComprobantesPago.idCuentaAtencion,
                     dbo.FacturacionBienesInsumos.idFacturacionBienes AS idFacturacionProducto,dbo.CajaComprobantesPago.idPaciente AS idPaciente
               FROM         dbo.Pacientes RIGHT OUTER JOIN
                     dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                     dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                     dbo.CajaComprobantesPago INNER JOIN
                     dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
                     dbo.FacturacionBienesInsumos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FacturacionBienesInsumos.IdComprobantePago ON
                     dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FacturacionBienesInsumos.IdProducto ON
                     dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.CajaComprobantesPago.IdCuentaAtencion ON
                     dbo.Pacientes.IdPaciente = dbo.FacturacionCuentasAtencion.IdPaciente
               Where (dbo.CajaComprobantesPago.IdTipoOrden = 2 or dbo.CajaComprobantesPago.IdTipoOrden = 3)
                     and dbo.CajaComprobantesPago.NroSerie=@NroSerie
                     and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[ComprobanteFarmaciaSeleccionarPorSerieDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ComprobanteServicioSeleccionarPorSerieDocumento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ComprobanteServicioSeleccionarPorSerieDocumento]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento, dbo.FacturacionServicios.*,
                     dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                     dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                     dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno,dbo.Pacientes.nroHistoriaClinica,
                     dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja AS Expr4,
                     dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                     dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                     dbo.FactCatalogoServicios.Nombre AS NombreProducto,
                     dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                     dbo.CajaComprobantesPago.Dctos,dbo.CajaComprobantesPago.idCuentaAtencion,
                     dbo.FacturacionServicios.idFacturacionServicio AS idFacturacionProducto,dbo.CajaComprobantesPago.idPaciente AS idPaciente
               FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                     dbo.FacturacionServicios ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicios.IdProducto LEFT OUTER JOIN
                     dbo.CajaComprobantesPago LEFT OUTER JOIN
                     dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja LEFT OUTER JOIN
                     dbo.FacturacionCuentasAtencion ON
                     dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                     dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente ON
                     dbo.FacturacionServicios.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
               Where (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                     and dbo.CajaComprobantesPago.NroSerie=@NroSerie
                     and dbo.CajaComprobantesPago.NroDocumento=@NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[ComprobanteServicioSeleccionarPorSerieDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CompruebaDatos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CompruebaDatos]
	@Tabla [nvarchar](50),
	@Campo [nvarchar](50),
	@Valor [nvarchar](50)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(1000);
SET @sql = 'SELECT *  FROM ' +(@Tabla) +  '  WHERE '+ @campo + '= ''' + @valor + '''';

EXEC sp_executesql @sql
GO
ALTER AUTHORIZATION ON [dbo].[CompruebaDatos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CondicionPacienteAlEstablecimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CondicionPacienteAlEstablecimiento]
	@IdPaciente [int],
	@FechaIngreso [datetime],
	@IdAtencion [int],
	@IdTipoCondicionPaciente [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @UltimoAnioIngreso int
set @UltimoAnioIngreso = 0

select top 1 @UltimoAnioIngreso = Year(FechaIngreso) from Atenciones
where IdPaciente = @IdPaciente
and FechaIngreso <= @FechaIngreso
and IdAtencion <> @IdAtencion
order by FechaIngreso desc

if @UltimoAnioIngreso = 0
begin
	set @IdTipoCondicionPaciente = 1
	return
end

if @UltimoAnioIngreso = year(@FechaIngreso)
begin
	set @IdTipoCondicionPaciente = 2
	return
end

if @UltimoAnioIngreso < year(@FechaIngreso)
begin
	set @IdTipoCondicionPaciente = 3
	return
end
GO
ALTER AUTHORIZATION ON [dbo].[CondicionPacienteAlEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CondicionPacienteAlServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CondicionPacienteAlServicio]
	@IdPaciente [int],
	@FechaIngreso [datetime],
	@IdServicio [int],
	@IdAtencion [int],
	@IdTipoCondicionPaciente [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @UltimoAnioIngreso int
set @UltimoAnioIngreso = 0

select top 1 @UltimoAnioIngreso = Year(FechaIngreso) from Atenciones
where IdPaciente = @IdPaciente
and FechaIngreso <= @FechaIngreso
and IdServicioIngreso <= @IdServicio
and IdAtencion <> @IdAtencion
order by FechaIngreso desc

if @UltimoAnioIngreso = 0
begin
	set @IdTipoCondicionPaciente = 1
	return
end

if @UltimoAnioIngreso = year(@FechaIngreso)
begin
	set @IdTipoCondicionPaciente = 2
	return
end

if @UltimoAnioIngreso < year(@FechaIngreso)
begin
	set @IdTipoCondicionPaciente = 3
	return
end
GO
ALTER AUTHORIZATION ON [dbo].[CondicionPacienteAlServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasActualizaIDENT]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[constanciasActualizaIDENT]
	@IdentNuevo [int]
WITH EXECUTE AS CALLER
AS
dbcc checkident (constancias,reseed,@IdentNuevo)
GO
ALTER AUTHORIZATION ON [dbo].[constanciasActualizaIDENT] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[constanciasAgregar]
	@idConstancia [int] OUTPUT,
	@idAtencion [int],
	@idPaciente [int],
	@idResponsable [int],
	@idServicio [int],
	@idMedico [int],
	@idTipoConstancia [int],
	@fecha [datetime],
	@pc [varchar](32),
	@recibo [varchar](20),
	@observaciones [text]
WITH EXECUTE AS CALLER
AS
insert into constancias (
idAtencion,idPaciente,idResponsable,idServicio,idMedico,idTipoConstancia,fecha,pc,recibo,observaciones) values (
@idAtencion,@idPaciente,@idResponsable,@idServicio,@idMedico,@idTipoConstancia,@fecha,@pc,@recibo,@observaciones)
set @idConstancia = @@identity
--exec AuditoriaAgregar @idResponsable ,'A',@idConstancia,'constancias'
GO
ALTER AUTHORIZATION ON [dbo].[constanciasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciaSeleccionaPorFecha]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConstanciaSeleccionaPorFecha]
	@HC [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
if @HC =0
 begin
  SELECT dbo.constancias.idConstancia, dbo.constancias.idAtencion, dbo.Pacientes.NroHistoriaClinica, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ', ' + dbo.Pacientes.PrimerNombre AS ApNom, dbo.constancias.idPaciente, dbo.constancias.idResponsable, dbo.constancias.idServicio, dbo.servicios.nombre, dbo.constancias.idMedico, dbo.constancias.idTipoConstancia, dbo.ConstanciasTipo.NombreConstancia, dbo.constancias.fecha, dbo.constancias.PC, dbo.constancias.recibo, dbo.constancias.observaciones, dbo.constancias.estadoConstancia
  FROM dbo.constancias, dbo.pacientes, dbo.servicios, dbo.ConstanciasTipo
  WHERE dbo.constancias.fecha>=@Fecha AND dbo.pacientes.idPaciente=dbo.Constancias.idPaciente AND dbo.servicios.idServicio=dbo.constancias.idServicio AND dbo.ConstanciasTipo.idTipoConstancia=dbo.constancias.idTipoConstancia
  ORDER BY dbo.constancias.fecha DESC
 end
else
begin
  SELECT dbo.constancias.idConstancia, dbo.constancias.idAtencion, dbo.Pacientes.NroHistoriaClinica, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ', ' + dbo.Pacientes.PrimerNombre AS ApNom, dbo.constancias.idPaciente, dbo.constancias.idResponsable, dbo.constancias.idServicio, dbo.servicios.nombre, dbo.constancias.idMedico, dbo.constancias.idTipoConstancia, dbo.ConstanciasTipo.NombreConstancia, dbo.constancias.fecha, dbo.constancias.PC, dbo.constancias.recibo, dbo.constancias.observaciones, dbo.constancias.estadoConstancia
  FROM dbo.constancias, dbo.pacientes, dbo.servicios, dbo.ConstanciasTipo
  WHERE dbo.constancias.fecha>=@Fecha AND dbo.pacientes.idPaciente=dbo.Constancias.idPaciente AND dbo.pacientes.NroHistoriaClinica=@HC AND dbo.servicios.idServicio=dbo.constancias.idServicio AND dbo.ConstanciasTipo.idTipoConstancia=dbo.constancias.idTipoConstancia
  ORDER BY dbo.constancias.fecha DESC
end
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciaSeleccionaPorFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[constanciasEliminar]
	@idConstancia [int]
WITH EXECUTE AS CALLER
AS
UPDATE constancias
SET estadoConstancia=0
where idConstancia = @idConstancia
GO
ALTER AUTHORIZATION ON [dbo].[constanciasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[constanciasModificar]
	@idConstancia [int],
	@recibo [varchar](20),
	@idResponsable [int]
WITH EXECUTE AS CALLER
AS
update constancias
set idResponsable = @idResponsable, recibo = @recibo
where idConstancia = @idConstancia
GO
ALTER AUTHORIZATION ON [dbo].[constanciasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasMuestraUltimoIDENT]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[constanciasMuestraUltimoIDENT]
WITH EXECUTE AS CALLER
AS
SELECT IDENT_CURRENT('constancias') as UltimaConstancia
GO
ALTER AUTHORIZATION ON [dbo].[constanciasMuestraUltimoIDENT] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasSeleccionaMedico]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConstanciasSeleccionaMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ', ' + dbo.Empleados.Nombres AS ApNom, dbo.medicos.colegiatura FROM dbo.Medicos, dbo.Empleados
WHERE dbo.medicos.IdMedico = @IdMedico AND dbo.empleados.idEmpleado=dbo.medicos.idEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasSeleccionaMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[constanciasSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[constanciasSeleccionarPorId]
	@idConstancia [int]
WITH EXECUTE AS CALLER
AS
select * from constancias
where idConstancia = @idConstancia
GO
ALTER AUTHORIZATION ON [dbo].[constanciasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConstanciasSeleccionarXidentificador]
	@IdConstancia [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.constancias.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                  dbo.Pacientes.NroHistoriaClinica
FROM        dbo.constancias LEFT OUTER JOIN
                  dbo.Pacientes ON dbo.constancias.idPaciente = dbo.Pacientes.IdPaciente
WHERE    dbo.constancias.idConstancia=@IdConstancia
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasTipoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConstanciasTipoAgregar]
	@idTipoConstancia [int],
	@NombreConstancia [char](15),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ConstanciasTipo (
idTipoConstancia,NombreConstancia) values (
@idTipoConstancia,@NombreConstancia)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idTipoConstancia,'ConstanciasTipo'
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasTipoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasTipoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConstanciasTipoEliminar]
	@idTipoConstancia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ConstanciasTipo
where idTipoConstancia = @idTipoConstancia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idTipoConstancia,'ConstanciasTipo'
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasTipoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasTipoModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConstanciasTipoModificar]
	@idTipoConstancia [int],
	@NombreConstancia [char](15),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ConstanciasTipo
set
NombreConstancia = @NombreConstancia
where idTipoConstancia = @idTipoConstancia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idTipoConstancia,'ConstanciasTipo'
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasTipoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConstanciasTipoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConstanciasTipoSeleccionarPorId]
	@idTipoConstancia [int]
WITH EXECUTE AS CALLER
AS
select * from ConstanciasTipo
where idTipoConstancia = @idTipoConstancia
GO
ALTER AUTHORIZATION ON [dbo].[ConstanciasTipoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaAjusteXAlmacen]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaAjusteXAlmacen]
	@IdAlmacenA [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldo.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
               FROM         dbo.farmSaldo LEFT OUTER JOIN
			        dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
               WHERE      dbo.farmSaldo.idAlmacen=@IdAlmacenA
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaAjusteXAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaatencionesporidAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaatencionesporidAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from atenciones where idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaatencionesporidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaBloqueaTablaXidTipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaBloqueaTablaXidTipoFinanciamiento]
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento where idTipoFinanciamiento=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaBloqueaTablaXidTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaCajaComprobantePagoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConsultaCajaComprobantePagoServicio]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM RecetaCabecera WHERE idReceta=(select top 1 recetaDetalleItem.idreceta from recetaDetalleItem where recetaDetalleItem.idComprobantePago=@IdComprobantePago)
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaCajaComprobantePagoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaFactCatalogoServiciosPtosXidProducto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaFactCatalogoServiciosPtosXidProducto]
	@IdProducto [int],
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
select * from  FactCatalogoServiciosPtos
where idProducto=@IdProducto
and idPuntoCarga=@IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaFactCatalogoServiciosPtosXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaFactCatalogoServiciosXcodigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaFactCatalogoServiciosXcodigo]
	@CodigoCpt [varchar](50)
WITH EXECUTE AS CALLER
AS
select idProducto,NombreMINSA
from  FactCatalogoServicios
where codigo=@CodigoCpt
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaFactCatalogoServiciosXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaFactCatalogoServiciosXSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaFactCatalogoServiciosXSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select    FactCatalogoServicios.Codigo,
	FactCatalogoServicios.Nombre as NombreProducto, FactCatalogoServiciosHosp.PrecioUnitario,FactCatalogoServiciosHosp.SeUsaSinPrecio,
	FactCatalogoServiciosHosp.IdProducto,FactCatalogoServiciosHosp.IdTipoFinanciamiento
From      FactCatalogoServiciosHosp
	left join FactCatalogoServicios
on         FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaFactCatalogoServiciosXSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultafarmSaldoXIdAlmacen]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultafarmSaldoXIdAlmacen]
	@idAlmacen [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select cantidad from farmSaldo where idAlmacen=@idAlmacen
                                 and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[ConsultafarmSaldoXIdAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaFechaEgresoEnCEparaLosQtienenDx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaFechaEgresoEnCEparaLosQtienenDx]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso, dbo.AtencionesDiagnosticos.IdAtencion,
                     dbo.AtencionesDiagnosticos.idDiagnostico , dbo.Atenciones.idCuentaAtencion
FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                     dbo.Atenciones ON dbo.AtencionesDiagnosticos.IdAtencion = dbo.Atenciones.IdAtencion
Where (dbo.AtencionesDiagnosticos.idDiagnostico > 0) And (dbo.Atenciones.FechaEgreso Is Null) And (dbo.Atenciones.IdTipoServicio = 1) and (dbo.Atenciones.idEstadoAtencion<>0)
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaFechaEgresoEnCEparaLosQtienenDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaPreVentaXfarmMovimientoVentas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaPreVentaXfarmMovimientoVentas]
	@Texto2 [varchar](9),
	@Texto1 [varchar](9)
WITH EXECUTE AS CALLER
AS
SELECT idPreVenta FROM farmMovimientoVentas where movNumero= @Texto2  and movTipo=@Texto1
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaPreVentaXfarmMovimientoVentas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaRecetaCabeceraAutomatica]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConsultaRecetaCabeceraAutomatica]
	@IdCuentaAtencion [int],
	@IdReceta [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
IF (@IdCuentaAtencion > 0)
	SELECT *
	FROM RecetaCabecera
	WHERE idReceta=@IdReceta
ELSE
	SELECT *
	FROM RecetaCabecera
	WHERE idReceta=(select top 1 recetaDetalleItem.idreceta from recetaDetalleItem where recetaDetalleItem.idComprobantePago=@IdComprobantePago)
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaRecetaCabeceraAutomatica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaRecetaCabeceraXIdPuntoCarga]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaRecetaCabeceraXIdPuntoCarga]
	@DocumentoDespacho [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.*, dbo.RecetaDetalleItem.DocumentoDespacho
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalleItem ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalleItem.idReceta
where dbo.RecetaCabecera.idPuntoCarga=5 and ltrim(dbo.RecetaDetalleItem.DocumentoDespacho)=@DocumentoDespacho
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaRecetaCabeceraXIdPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaRecetaDetallePorID]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaRecetaDetallePorID]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM RecetaDetalle where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaRecetaDetallePorID] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaRecetaDetalleXIdReceta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaRecetaDetalleXIdReceta]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaDetalle   where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaRecetaDetalleXIdReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultarFacturacionReembolsosXidFactReembolso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultarFacturacionReembolsosXidFactReembolso]
	@IdFactReembolso [int]
WITH EXECUTE AS CALLER
AS
select *
from FacturacionReembolsos
where idFactReembolso=@IdFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[ConsultarFacturacionReembolsosXidFactReembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultarFuentesFinanciamientoXidFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultarFuentesFinanciamientoXidFuenteFinanciamiento]
WITH EXECUTE AS CALLER
AS
select idFuenteFinanciamiento,Descripcion from FuentesFinanciamiento order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[ConsultarFuentesFinanciamientoXidFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaServiciosXidServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaServiciosXidServicio]
	@idServicio [int]
WITH EXECUTE AS CALLER
AS
select idEspecialidad from Servicios where idServicio=@idServicio
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaServiciosXidServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsultaTiposFinanciamientoXidTipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsultaTiposFinanciamientoXidTipoFinanciamiento]
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento where idTipoFinanciamiento=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[ConsultaTiposFinanciamientoXidTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoCptEnImagenesPorIdAntencionConSeguro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConsumoCptEnImagenesPorIdAntencionConSeguro]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimientoCPT.cantidad, dbo.ImagMovimiento.IdImagEstado,
	             dbo.ImagMovimientoImagenes.ResultadoFinal,
	             dbo.ImagMovimiento.IdMovimiento,dbo.ImagMovimiento.IdPuntoCarga,dbo.ImagMovimientoCPT.idProductoCPT,
	             dbo.ImagMovimientoImagenes.IdOrden
              FROM          dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.ImagMovimientoCPT LEFT OUTER JOIN
                                  dbo.Atenciones INNER JOIN
                                  dbo.ImagMovimientoImagenes ON dbo.Atenciones.IdCuentaAtencion = dbo.ImagMovimientoImagenes.IdCuentaAtencion INNER JOIN
                                  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento ON
                                  dbo.ImagMovimientoCPT.idMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento ON
                                  dbo.FactCatalogoServicios.idProducto = dbo.ImagMovimientoCPT.idProductoCPT
             Where          dbo.ImagMovimiento.IdImagEstado=1 and dbo.Atenciones.idAtencion = @IdAtencion
             ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoCptEnImagenesPorIdAntencionConSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoCptEnImagenesPorIdAntencionParaParticulares]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ConsumoCptEnImagenesPorIdAntencionParaParticulares]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimientoCPT.cantidad,
	             dbo.ImagMovimiento.IdImagEstado,dbo.ImagMovimientoImagenes.ResultadoFinal,
	             dbo.ImagMovimiento.IdMovimiento,dbo.ImagMovimiento.IdPuntoCarga,dbo.ImagMovimientoCPT.idProductoCPT,
	             dbo.ImagMovimientoImagenes.IdOrden
              FROM          dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.CajaComprobantesPago INNER JOIN
                                  dbo.Atenciones ON dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion RIGHT OUTER JOIN
                                  dbo.ImagMovimiento INNER JOIN
                                  dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento RIGHT OUTER JOIN
                                  dbo.ImagMovimientoCPT ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento ON
                                  dbo.CajaComprobantesPago.IdComprobantePago = dbo.ImagMovimientoImagenes.IdComprobantePago ON
                                  dbo.FactCatalogoServicios.idProducto = dbo.ImagMovimientoCPT.idProductoCPT
             Where          dbo.ImagMovimiento.IdImagEstado=1 and dbo.Atenciones.idAtencion = @IdAtencion
             ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoCptEnImagenesPorIdAntencionParaParticulares] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoCptEnLaboratorioPorIdAntencionConSeguro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsumoCptEnLaboratorioPorIdAntencionConSeguro]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoLaboratorio.IdOrden,
                                  dbo.LabMovimiento.IdLabEstado,dbo.LabMovimientoCPT.idProductoCpt
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.Atenciones RIGHT OUTER JOIN
                                  dbo.LabMovimiento INNER JOIN
                                  dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento RIGHT OUTER JOIN
                                  dbo.LabMovimientoCPT ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento ON
                                  dbo.Atenciones.IdCuentaAtencion = dbo.LabMovimientoLaboratorio.IdCuentaAtencion ON
                                  dbo.FactCatalogoServicios.idProducto = dbo.LabMovimientoCPT.idProductoCPT
             Where dbo.LabMovimiento.IdLabEstado>0 and dbo.Atenciones.idAtencion = @IdAtencion
             ORDER BY dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoCptEnLaboratorioPorIdAntencionConSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoCptEnLaboratorioPorIdAntencionParaParticulares]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsumoCptEnLaboratorioPorIdAntencionParaParticulares]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoLaboratorio.IdOrden,
                                  dbo.LabMovimiento.IdLabEstado,dbo.LabMovimientoCPT.idProductoCPT
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.LabMovimientoCPT LEFT OUTER JOIN
                                  dbo.CajaComprobantesPago INNER JOIN
                                  dbo.LabMovimientoLaboratorio ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.LabMovimientoLaboratorio.IdComprobantePago INNER JOIN
                                  dbo.Atenciones ON dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
                                  dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento ON
                                  dbo.LabMovimientoCPT.idMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento ON
                                  dbo.FactCatalogoServicios.idProducto = dbo.LabMovimientoCPT.idProductoCPT
             Where          dbo.LabMovimiento.IdLabEstado>0 and dbo.Atenciones.idAtencion = @IdAtencion
             ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoCptEnLaboratorioPorIdAntencionParaParticulares] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoMedicamentosPorIdAntencionConSeguroYparticular]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsumoMedicamentosPorIdAntencionConSeguroYparticular]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad,
                                  dbo.farmMovimiento.idEstadoMovimiento
             FROM           dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                  dbo.farmMovimientoVentasDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoVentasDetalle.idProducto ON
                                  dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                                  dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                                  dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
             Where         dbo.farmMovimiento.movTipo='S' and    dbo.farmMovimiento.idEstadoMovimiento=1 and dbo.Atenciones.idAtencion = @IdAtencion
             ORDER BY  dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoMedicamentosPorIdAntencionConSeguroYparticular] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ConsumoMedicamentosPorIdCuentaConSeguroYparticular]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ConsumoMedicamentosPorIdCuentaConSeguroYparticular]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 100 PERCENT dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad,
                      dbo.farmMovimiento.idEstadoMovimiento
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoVentasDetalle.idProducto ON
                      dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo
WHERE     (dbo.farmMovimiento.MovTipo = 'S') AND (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.farmMovimientoVentas.idCuentaAtencion = @IdCuentaAtencion)
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ConsumoMedicamentosPorIdCuentaConSeguroYparticular] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CptExcepcionesRecetasHISSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CptExcepcionesRecetasHISSeleccionarPorId]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM CptExcepcionesRecetasHIS
	where IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[CptExcepcionesRecetasHISSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CptHistoricosPorPaciente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CptHistoricosPorPaciente]
	@IdPaciente [int],
	@IdPuntoCarga [int],
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
/*
SELECT     dbo.ImagMovimiento.Fecha, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimientoCPT.cantidad,
           dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS Responsable,
           dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimientoImagenes.IdCuentaAtencion, dbo.ImagMovimientoImagenes.IdComprobantePago,
           dbo.FactOrdenServicio.IdOrden
FROM         dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento LEFT OUTER JOIN
                      dbo.Empleados ON dbo.ImagMovimientoImagenes.idPersonaTomaImagen = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden RIGHT OUTER JOIN
                      dbo.ImagMovimientoCPT ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto
WHERE      dbo.ImagMovimiento.idImagEstado=1 and dbo.FactOrdenServicio.IdPaciente = @IdPaciente and dbo.ImagMovimiento.IdPuntoCarga = @IdPuntoCarga
                    and dbo.ImagMovimiento.IdMovimiento<>@IdMovimiento
ORDER BY dbo.ImagMovimiento.Fecha DESC
*/
SELECT        dbo.ImagMovimiento.Fecha, dbo.FactCatalogoServicios.Codigo,
                         dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimientoCPT.cantidad,
                         dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres
                          AS Responsable, dbo.ImagMovimiento.IdMovimiento,
                         dbo.ImagMovimientoImagenes.IdCuentaAtencion,
                         dbo.ImagMovimientoImagenes.IdComprobantePago, dbo.FactOrdenServicio.IdOrden
FROM            dbo.Empleados RIGHT OUTER JOIN
                         dbo.ImagMovimiento INNER JOIN
                         dbo.ImagMovimientoImagenes ON
                         dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento INNER JOIN
                         dbo.FactCatalogoServicios INNER JOIN
                         dbo.ImagMovimientoCPT ON
                         dbo.FactCatalogoServicios.IdProducto = dbo.ImagMovimientoCPT.idProductoCPT ON
                         dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento INNER JOIN
                         dbo.FactOrdenServicio ON
                         dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden ON
                         dbo.Empleados.IdEmpleado = dbo.ImagMovimientoImagenes.idPersonaTomaImagen
WHERE      dbo.ImagMovimiento.idImagEstado=1 and dbo.FactOrdenServicio.IdPaciente = @IdPaciente and dbo.ImagMovimiento.IdPuntoCarga = @IdPuntoCarga
                    and dbo.ImagMovimiento.IdMovimiento<>@IdMovimiento
ORDER BY dbo.ImagMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[CptHistoricosPorPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CptHistoricosPorPacienteLab]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CptHistoricosPorPacienteLab]
	@IdPaciente [int],
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.LabMovimiento.Fecha, dbo.LabMovimiento.IdMovimiento, dbo.FactCatalogoServicios.Codigo,
                  dbo.FactCatalogoServicios.Nombre, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoLaboratorio.IdCuentaAtencion,
                  dbo.LabMovimientoLaboratorio.IdComprobantePago , dbo.LabMovimientoLaboratorio.idOrden
 FROM      dbo.LabMovimientoLaboratorio INNER JOIN
                 dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento LEFT OUTER JOIN
		dbo.FactOrdenServicio ON dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden RIGHT OUTER JOIN
             dbo.FactCatalogoServicios RIGHT OUTER JOIN
             dbo.LabMovimientoCPT ON dbo.FactCatalogoServicios.IdProducto = dbo.LabMovimientoCPT.idProductoCPT ON
             dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.IdMovimiento
WHERE dbo.LabMovimiento.idLabEstado<>0 and dbo.FactOrdenServicio.IdPaciente= @IdPaciente
               and dbo.LabMovimiento.IdMovimiento<>@IdMovimiento
ORDER BY dbo.LabMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[CptHistoricosPorPacienteLab] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CreaTemporalPacientesAdepurar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CreaTemporalPacientesAdepurar]
WITH EXECUTE AS CALLER
AS
delete from reporte5

INSERT INTO Reporte5 (idPaciente , ApellidoPaterno,Apellidomaterno,PrimerNombre ,SegundoNombre ,
                      NroHistoriaClinica,seProceso ,paciente,NroDocumento,IdDocIdentidad,
		      FechaNacimiento,idTipoSexo,autogenerado )
SELECT idpaciente,ApellidoPaterno,Apellidomaterno,PrimerNombre,SEGUNDONOMBRE,
       NroHistoriaClinica,0,ApellidoPaterno+' '+Apellidomaterno+' '+PrimerNombre+' '+isnull(SEGUNDONOMBRE,'.') as Paciente ,NroDocumento,IdDocIdentidad,
       FechaNacimiento,idTipoSexo,autogenerado
         FROM Pacientes
         where IdTipoNumeracion <=2 and not (NroHistoriaClinica is null)
GO
ALTER AUTHORIZATION ON [dbo].[CreaTemporalPacientesAdepurar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuentaPruebas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CuentaPruebas]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50),
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=0     --todos
	SELECT SUM(labmovimientoCPT.cantidad) as SUMA
	FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
	WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
	LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
	LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
else
    if   @idTipoServicio=99     --externos con boleta
        SELECT SUM(labmovimientoCPT.cantidad) as SUMA
		FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
		WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
		LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
		not (LabMovimientoLaboratorio.IdComprobantePago is null) and
		LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103) and
	   (select CajaComprobantesPago.IdCuentaAtencion from CajaComprobantesPago where
		           CajaComprobantesPago.IdComprobantePago=LabMovimientoLaboratorio.IdComprobantePago) is null
    else                        --CE,Hosp o Emergencia  con boleta
         SELECT SUM(labmovimientoCPT.cantidad) as SUMA
		FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
		WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
		LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
		not (LabMovimientoLaboratorio.IdComprobantePago is null) and
		LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103) and
	   (SELECT     dbo.Atenciones.IdTipoServicio
        FROM         dbo.CajaComprobantesPago INNER JOIN
        dbo.Atenciones ON dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
        where dbo.CajaComprobantesPago.IdComprobantePago = LabMovimientoLaboratorio.IdComprobantePago )=@idTipoServicio

GO
ALTER AUTHORIZATION ON [dbo].[CuentaPruebas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuentaPruebas1]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CuentaPruebas1]
	@IdProducto [int],
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50),
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
if @idTipoServicio=0     --todos
	SELECT 0 as SUMA
	FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
	WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
	LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
	LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
else
    if   @idTipoServicio=99     --externos con cuenta
        SELECT SUM(labmovimientoCPT.cantidad) as SUMA
		FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
		WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
		LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
		not (LabMovimientoLaboratorio.IdCuentaAtencion  is null) and
		LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103) and
	   (select idTipoServicio from atenciones where atenciones.EsPacienteExterno =1 and
		    atenciones.IdCuentaAtencion=LabMovimientoLaboratorio.IdCuentaAtencion) >0
    else                        --CE,Hosp o Emergencia  con cuenta
         SELECT SUM(labmovimientoCPT.cantidad) as SUMA
		FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio
		WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
		LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT= @IdProducto AND
		not (LabMovimientoLaboratorio.IdCuentaAtencion  is null) and
		LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103) and
	   (select idTipoServicio from atenciones where atenciones.EsPacienteExterno =0 and
	   atenciones.IdCuentaAtencion=LabMovimientoLaboratorio.IdCuentaAtencion)=@idTipoServicio

GO
ALTER AUTHORIZATION ON [dbo].[CuentaPruebas1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuentaPruebasConResultados]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CuentaPruebasConResultados]
	@IdProducto [int],
	@IdAnalisis [varchar](50),
	@FechaInicial [varchar](50),
	@FechaFinal [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT SUM(labmovimientoCPT.cantidad) as SUMA
FROM LabMovimientoCPT, LabMovimiento, LabMovimientoLaboratorio, LabResultado
WHERE LabMovimiento.idLabEstado<>'0' AND LabMovimiento.idMovimiento=LabMovimientoLaboratorio.idMovimiento AND
LabMovimientoLaboratorio.idMovimiento=LabMovimientoCPT.idMovimiento AND LabMovimientoCPT.idProductoCPT=@IdProducto AND
labResultado.idAnalisis=@IdAnalisis AND LabMovimientoLaboratorio.idOrden=labResultado.idOrden AND
LabMovimiento.fecha>=CONVERT(DATETIME,@FechaInicial,103) AND LabMovimiento.fecha<=CONVERT(DATETIME,@FechaFinal,103)
GO
ALTER AUTHORIZATION ON [dbo].[CuentaPruebasConResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuentasAtencionSeleccionarIdPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CuentasAtencionSeleccionarIdPorIdAtencion]
	@IdAtencion [int],
	@IdCuentaAtencion [int] OUTPUT
WITH EXECUTE AS CALLER
AS
select @IdCuentaAtencion  = IdCuentaAtencion from Atenciones
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CuentasAtencionSeleccionarIdPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuentasYtarifasSeleccionar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CuentasYtarifasSeleccionar]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dTarifario,
                     dbo.FuentesFinanciamiento.Descripcion AS dPlan, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.FechaIngreso,
                     dbo.EstadosCuenta.Descripcion AS EstadoCuenta, dbo.EstadosAtencion.Descripcion AS EstadoAtencion
FROM         dbo.Atenciones INNER JOIN
                     dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion INNER JOIN
                     dbo.EstadosAtencion ON dbo.Atenciones.idEstadoAtencion = dbo.EstadosAtencion.IdEstadoAtencion LEFT OUTER JOIN
                     dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                     dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                     dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
ORDER BY dbo.atenciones.idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[CuentasYtarifasSeleccionar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[CuposProgramadosPorMedicosPorFechas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[CuposProgramadosPorMedicosPorFechas]
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.ProgramacionMedica.HoraInicio, dbo.Especialidades.IdEspecialidad, dbo.ProgramacionMedica.HoraFin,
          dbo.ProgramacionMedica.IdEspecialidad AS Expr1, dbo.Especialidades.Nombre, dbo.EspecialidadCE.TiempoPromedioAtencion,
          dbo.ProgramacionMedica.Fecha, dbo.ProgramacionMedica.IdProgramacion, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
          dbo.Empleados.Nombres, dbo.ProgramacionMedica.idServicio
FROM         dbo.ProgramacionMedica INNER JOIN
          dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico INNER JOIN
          dbo.Especialidades ON dbo.ProgramacionMedica.IdEspecialidad = dbo.Especialidades.IdEspecialidad INNER JOIN
          dbo.EspecialidadCE ON dbo.EspecialidadCE.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
          dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
 Where ProgramacionMedica.IdTipoServicio = 1
 and ProgramacionMedica.Fecha Between @FechaInicial and @FechaFinal
 order by Medicos.IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[CuposProgramadosPorMedicosPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DatosGestionCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DatosGestionCaja]
	@IdGestionCaja [int]
WITH EXECUTE AS CALLER
AS
select Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres,
CajaTurno.Descripcion as Turno, EstadoLote, convert(char(17), FechaApertura, 113) as FechaApertura,convert(Char(17), FechaCierre, 113) As FechaCierre
From (CajaGestion
left join Empleados on Empleados.IdEmpleado = CajaGestion.IdCajero)
left join CajaTurno on CajaTurno.IdTurno = CajaGestion.IdTurno
where IdGestionCaja = @IdGestionCaja
GO
ALTER AUTHORIZATION ON [dbo].[DatosGestionCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[dbfFormatoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[dbfFormatoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from formato
GO
ALTER AUTHORIZATION ON [dbo].[dbfFormatoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosAgregar]
	@IdDepartamento [int],
	@Nombre [varchar](20)
WITH EXECUTE AS CALLER
AS
insert into departamentos (iddepartamento,nombre)
values (@IdDepartamento,@Nombre)
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosEliminar]
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Departamentos
where IdDepartamento = @IdDepartamento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDepartamento,'Departamentos'
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalAgregar]
	@Nombre [varchar](50),
	@IdDepartamento [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into DepartamentosHospital (
Nombre) values (
@Nombre)
set @IdDepartamento = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdDepartamento,'DepartamentosHospital'
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalEliminar]
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from DepartamentosHospital
where IdDepartamento = @IdDepartamento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDepartamento,'DepartamentosHospital'
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalModificar]
	@Nombre [varchar](50),
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update DepartamentosHospital
set
Nombre = @Nombre
where IdDepartamento = @IdDepartamento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDepartamento,'DepartamentosHospital'
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalSeleccionaPorTipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalSeleccionaPorTipoServicio]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select Distinct DepartamentosHospital.IdDepartamento, DepartamentosHospital.Nombre
             From (DepartamentosHospital inner join Especialidades on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento)
             inner join Servicios on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
             where IdTipoServicio = @IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalSeleccionaPorTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalSeleccionarPorId]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select * from DepartamentosHospital
where IdDepartamento = @IdDepartamento
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosHospitalSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepartamentosHospitalSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdDepartamento, convert(varchar(5),IdDepartamento) + ' = ' + Nombre as DescripcionLarga
from DepartamentosHospital
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosHospitalSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosModificar]
	@Nombre [varchar](20),
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Departamentos
set
Nombre = @Nombre
where IdDepartamento = @IdDepartamento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDepartamento,'Departamentos'
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DepartamentosSeleccionarPorId]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select * from Departamentos
where IdDepartamento = @IdDepartamento
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepartamentosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdDepartamento, Nombre,
(Convert(varchar(5), IdDepartamento) + ' = ' + Nombre) as DescripcionLarga
 from Departamentos
order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosSeleccionarTodosCampos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepartamentosSeleccionarTodosCampos]
WITH EXECUTE AS CALLER
AS
select * from Departamentos
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosSeleccionarTodosCampos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepartamentosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepartamentosSeleccionarXidentificador]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select * from Departamentos where idDepartamento=@IdDepartamento
GO
ALTER AUTHORIZATION ON [dbo].[DepartamentosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DepuraPtoCarga]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DepuraPtoCarga]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
update factCatalogoServiciosPtos set idPuntoCarga=2 where idPuntoCarga=32
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete from factCatalogoServiciosPtos  where idPuntoCarga=38
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete from factPuntosCarga  where idPuntoCarga=38 or idPuntoCarga=32
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[DepuraPtoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DesagregaCuentasItemsXServHosp]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DesagregaCuentasItemsXServHosp]
	@IdProductoCpt [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.TiposTarifaCpt.idProductoCpt, dbo.TiposTarifaCpt.idTipoTarifa
FROM         dbo.TiposTarifaCpt LEFT OUTER JOIN  dbo.FactCatalogoServicios ON dbo.TiposTarifaCpt.idProductoCpt = dbo.FactCatalogoServicios.IdProducto
Where dbo.TiposTarifaCpt.idProductoCpt=@IdProductoCpt
GO
ALTER AUTHORIZATION ON [dbo].[DesagregaCuentasItemsXServHosp] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DescripcionOcupacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DescripcionOcupacion]
	@idTipoOcupacion [int]
WITH EXECUTE AS CALLER
AS
SELECT descripcion FROM TiposOcupacion WHERE idTipoOcupacion=@idTipoOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[DescripcionOcupacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevolucionesMedicamentosXcuentaIdproductoMovNumero]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevolucionesMedicamentosXcuentaIdproductoMovNumero]
	@IdCuentaAtencion [int],
	@idProducto [int],
	@MovNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionBienesDevoluciones.*
                 FROM         dbo.FacturacionBienesDevoluciones LEFT OUTER JOIN
                                      dbo.farmMovimientoNotaIngreso ON dbo.FacturacionBienesDevoluciones.MovNumeroE = dbo.farmMovimientoNotaIngreso.MovNumero
                 WHERE dbo.farmMovimientoNotaIngreso.idCuentaAtencion =@IdCuentaAtencion
                       and dbo.FacturacionBienesDevoluciones.MovNumero= @MovNumero  and dbo.FacturacionBienesDevoluciones.MovTipo='S'
                       and dbo.FacturacionBienesDevoluciones.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[DevolucionesMedicamentosXcuentaIdproductoMovNumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveCabeceraDeVentasOpreventa]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DevuelveCabeceraDeVentasOpreventa]
	@tipoVenta [varchar](1),
	@IdAlmacen [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
if @tipoVenta='D'
begin
	SELECT      dbo.farmMovimientoVentas.movNumero, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.fechaCreacion,
	                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.DocumentoNumero AS dalmacen, dbo.farmEstadosMovimientos.Estado,
	                      dbo.TiposFinanciamiento.Descripcion, dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.Total,
	                      LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS Paciente,
	                      dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.farmMovimientoVentas.idFuenteFinanciamiento,dbo.farmMovimientoVentas.idPreventa
	FROM         dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo INNER JOIN
	                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.farmMovimientoVentas.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
	WHERE     (dbo.farmMovimiento.MovTipo='S') and  (dbo.farmMovimiento.idAlmacenOrigen=@IdAlmacen)   and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimiento.fechaCreacion DESC,dbo.farmMovimientoVentas.movNumero desc

end
else
begin

	SELECT     ltrim(str(dbo.farmPreVenta.idPreventa))+'F' AS movNumero1, dbo.farmPreVenta.idTipoFinanciamiento, dbo.farmPreVenta.FechaCreacion,
                                 dbo.farmPreVenta.idEstadoPreventa AS idEstadoMovimiento,  dbo.farmAlmacen.descripcion AS dAlmacen,
                                dbo.farmEstadosPreventa.Estado, dbo.TiposFinanciamiento.Descripcion, dbo.farmPreVenta.idCuentaAtencion,
	                      dbo.farmPreVenta.Total, dbo.farmPreVenta.idPreventa AS movNumero
	FROM         dbo.farmPreVenta LEFT OUTER JOIN
	                      dbo.farmAlmacen ON dbo.farmPreVenta.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
	                      dbo.farmEstadosPreventa ON dbo.farmPreVenta.idEstadoPreventa = dbo.farmEstadosPreventa.idEstadoPreventa LEFT OUTER JOIN
	                      dbo.TiposFinanciamiento ON dbo.farmPreVenta.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
	WHERE       (dbo.farmPreVenta.idAlmacen=@IdAlmacen)   and (dbo.farmPreVenta.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmPreVenta.fechaCreacion DESC,dbo.farmPreVenta.horaCreacion desc
end
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveCabeceraDeVentasOpreventa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveCantidadCitasYaAsignadas]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveCantidadCitasYaAsignadas]
	@IdMedico [int],
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.Atenciones.*
From dbo.Atenciones
Where dbo.Atenciones.idtipoServicio=1 and FechaIngreso Between @FechaInicial and @FechaFinal
      and idMedicoIngreso=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveCantidadCitasYaAsignadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveCantidadDeCitasAdicionales]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveCantidadDeCitasAdicionales]
	@IdMedico [int],
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.Citas.*
From dbo.Citas
Where dbo.Citas.esCitaAdicional=1 and Fecha Between @FechaInicial and @FechaFinal
      and idMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveCantidadDeCitasAdicionales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveCodigoEnTablaHIS_TabDiag]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveCodigoEnTablaHIS_TabDiag]
	@Diag [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from tabDiag where Diag=@Diag
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveCodigoEnTablaHIS_TabDiag] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveDatosDeLaMadreDelPacienteActual]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveDatosDeLaMadreDelPacienteActual]
	@lnIdNacimientoSeleccionado1 [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                                     dbo.Pacientes.NroHistoriaClinica , dbo.AtencionesNacimientos.IdNacimiento
                         FROM         dbo.Atenciones RIGHT OUTER JOIN
                                     dbo.AtencionesNacimientos ON dbo.Atenciones.IdAtencion = dbo.AtencionesNacimientos.IdAtencion LEFT OUTER JOIN
                                     dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
                         Where     dbo.AtencionesNacimientos.IdNacimiento= @lnIdNacimientoSeleccionado1
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveDatosDeLaMadreDelPacienteActual] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveDescripcionTipoServicioSegunIdTipoServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveDescripcionTipoServicioSegunIdTipoServicio]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select * from TiposServicio where idTipoServicio=@IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveDescripcionTipoServicioSegunIdTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveDiagnosticoSegunSubComponente]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveDiagnosticoSegunSubComponente]
	@IdSubComponente [int]
WITH EXECUTE AS CALLER
AS
select * from farmComponenteSub where idSubComponente=@IdSubComponente
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveDiagnosticoSegunSubComponente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEspecialidadesDelHospital]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEspecialidadesDelHospital]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL = 'SELECT DISTINCT dbo.Especialidades.IdEspecialidad, dbo.Especialidades.Nombre, CONVERT(varchar(5), dbo.Especialidades.IdEspecialidad)
			 + '' = '' + LTRIM(dbo.Especialidades.Nombre) + '' ('' + LTRIM(dbo.TiposServicio.Descripcion) + '')'' AS DescripcionLarga,
				  dbo.TiposServicio.Descripcion
		FROM         dbo.Especialidades INNER JOIN
				    dbo.Servicios ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
				   dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
		WHERE       dbo.Servicios.IdTipoServicio IN ' + @Filtro + ' ORDER BY dbo.TiposServicio.Descripcion, dbo.Especialidades.Nombre'

EXEC (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEspecialidadesDelHospital] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEspecialidadesDelHospitalfiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEspecialidadesDelHospitalfiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'SELECT DISTINCT dbo.Especialidades.IdEspecialidad, dbo.Especialidades.Nombre, CONVERT(varchar(5), dbo.Especialidades.IdEspecialidad)
                           + " =" + LTRIM(dbo.Especialidades.Nombre) + " (" + LTRIM(dbo.TiposServicio.Descripcion) + ")" AS DescripcionLarga,
                           dbo.TiposServicio.Descripcion
             FROM         dbo.Especialidades INNER JOIN
                                  dbo.Servicios ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
                                  dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
             WHERE       dbo.Servicios.IdTipoServicio IN      '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEspecialidadesDelHospitalfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDeEstadoCuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDeEstadoCuenta]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'select descripcion as lcEstado from EstadosCuenta where '  +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDeEstadoCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDeFacturacion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDeFacturacion]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'select descripcion as lcEstado from EstadosFacturacion where '  +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDeFacturacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDeImagen]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDeImagen]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL ='select estado as lcEstado from ImagEstados  where ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDeImagen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDeLaboratorio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDeLaboratorio]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL ='select estado as lcEstado from LabEstados  where ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDeLaboratorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDelInventario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDelInventario]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL ='select estado as lcEstado from FarmEstadosInventario  where  ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDelInventario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDelMovimiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDelMovimiento]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL ='select estado as lcEstado from FarmEstadosMovimientos  where  ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDelMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoActualDePreventa]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoActualDePreventa]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL ='select estado as lcEstado from FarmEstadosPreVenta  where ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoActualDePreventa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveEstadoReceta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveEstadoReceta]
	@IdEstadoReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaEstados where idEstado=@IdEstadoReceta
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveEstadoReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveHIS_SITUACIOporDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DevuelveHIS_SITUACIOporDescripcion]
WITH EXECUTE AS CALLER
AS
select IdHisSituacio,valores,descripcio,codigo  from HIS_situacio
--SCCQ 13/04/2020 Cambio 2 Inicio
where LABHISWEB=1
--SCCQ 13/04/2020 Cambio 2 Fin
order by valores

GO
ALTER AUTHORIZATION ON [dbo].[DevuelveHIS_SITUACIOporDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveListaDeUsuariosDelSistema]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveListaDeUsuariosDelSistema]
WITH EXECUTE AS CALLER
AS
SELECT IdEmpleado, Usuario
             From dbo.Empleados
             Where (Usuario Is Not Null)
             ORDER BY Usuario
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveListaDeUsuariosDelSistema] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveListaMedicosSegunServicio]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveListaMedicosSegunServicio]
	@IdServicioHospital [int]
WITH EXECUTE AS CALLER
AS
DECLARE @EspecialidadServicio INTEGER

IF EXISTS (select idEspecialidad from Servicios where idServicio=@IdServicioHospital)
	BEGIN
		SET @EspecialidadServicio=(select idEspecialidad from Servicios where idServicio=@IdServicioHospital)
	END
ELSE
	BEGIN
		SET @EspecialidadServicio=0
	END

SELECT     dbo.MedicosEspecialidad.IdEspecialidad, dbo.MedicosEspecialidad.IdMedico, dbo.Medicos.Colegiatura, dbo.Medicos.IdEmpleado,
	     dbo.Empleados.ApellidoPaterno , dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.CodigoPlanilla
FROM        dbo.Medicos LEFT OUTER JOIN
	     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                  dbo.MedicosEspecialidad ON dbo.Medicos.IdMedico = dbo.MedicosEspecialidad.IdMedico
WHERE    dbo.MedicosEspecialidad.idEspecialidad=@EspecialidadServicio
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveListaMedicosSegunServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveMovimientoEnLabImaFar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DevuelveMovimientoEnLabImaFar]
	@movimiento [varchar](20) OUTPUT,
	@idOrdenPago [int],
	@idTipoOrden [int],
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
declare @idOrden int
declare @idOrden1 int
declare @idMovimiento int
declare @idMovimiento1 int
declare @dctoNumero varchar(12)
declare @EpsPorcentaje money
select @EpsPorcentaje =(select EpsPorcentaje  from Atenciones  where IdCuentaAtencion =@idCuenta )
select @Movimiento= '.'
if @EpsPorcentaje>0
	if @idTipoOrden=1
	   begin
		   --servicios
		   select @idOrden =(select idOrden  from FactOrdenServicioPagos where idOrdenPago =@idOrdenPago)
		   select @idOrden1=@idOrden-1
		   if @idOrden1>0
			   select @idMovimiento=(select IdMovimiento  from LabMovimientoLaboratorio where IdOrden =@idOrden1)
			   if @idMovimiento>0
			      begin
				     select @Movimiento= 'LabMov: '+convert(varchar(12),@idMovimiento )
				  end
			   else
			      begin
					  select @idMovimiento1=(select IdMovimiento  from ImagMovimientoImagenes   where IdOrden =@idOrden1)
					  if @idMovimiento1>0
					     begin
						    select @Movimiento= 'ImgMov: '+convert(varchar(12),@idMovimiento1)
					     end
					  else
					     begin
					        select @dctoNumero= (SELECT  dbo.farmMovimiento.DocumentoNumero
								  FROM         dbo.farmMovimientoVentas INNER JOIN
								  dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
								  dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo INNER JOIN
								  dbo.FactOrdenServicio INNER JOIN
								  dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden ON
								  dbo.farmMovimiento.fechaCreacion = dbo.FactOrdenServicioPagos.FechaCreacion AND
								  dbo.farmMovimientoVentas.idCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion
								  WHERE     dbo.FactOrdenServicioPagos.idOrdenPago=@idOrdenPago)
							if @dctoNumero<>''
							   begin
							      select @Movimiento= 'FarDcto: '+@dctoNumero
							   end
					     end
				  end
	   end
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveMovimientoEnLabImaFar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveMovimientosDeNotaIngresos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveMovimientosDeNotaIngresos]
	@FechaInicio [varchar](50),
	@IdAlmacenDestino [int],
	@FechaFin [varchar](50),
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
If @IdAlmacenDestino=2 or @IdAlmacenDestino=3


If @IdCuentaAtencion > 0

SELECT    dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino, farmAlmacen_2.descripcion AS fOrigen,
                          dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimiento.fechaCreacion,
                          dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento,
                          dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,
                          dbo.farmMovimientoNotaIngreso.idCuentaAtencion as NroCuenta
                 FROM         dbo.farmMovimiento INNER JOIN
                          dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                          dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo LEFT OUTER JOIN
                          dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                          dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
                          dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen

	  WHERE     dbo.farmMovimiento.MovTipo='E' and  dbo.farmMovimiento.idAlmacenDestino=@IdAlmacenDestino  and dbo.farmMovimiento.fechaCreacion Between  (CONVERT(DATETIME,@FechaInicio,103)) and  (CONVERT(DATETIME,@FechaFin,103)) and dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@IdCuentaAtencion
                ORDER BY dbo.farmMovimiento.fechaCreacion DESC, dbo.farmMovimiento.movNumero desc

Else

	  SELECT    dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino, farmAlmacen_2.descripcion AS fOrigen,
                          dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimiento.fechaCreacion,
                          dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento,
                          dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,
                          dbo.farmMovimientoNotaIngreso.idCuentaAtencion as NroCuenta
                 FROM         dbo.farmMovimiento INNER JOIN
                          dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                          dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo LEFT OUTER JOIN
                          dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                          dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
                          dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	  WHERE     dbo.farmMovimiento.MovTipo='E' and  dbo.farmMovimiento.idAlmacenDestino=@IdAlmacenDestino and dbo.farmMovimiento.fechaCreacion Between  (CONVERT(DATETIME,@FechaInicio,103)) and  (CONVERT(DATETIME,@FechaFin,103))
                ORDER BY dbo.farmMovimiento.fechaCreacion DESC, dbo.farmMovimiento.movNumero desc

else


If @IdCuentaAtencion > 0
SELECT    dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino, farmAlmacen_2.descripcion AS fOrigen,
                          dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimiento.fechaCreacion,
                          dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento,
                          dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,
                          dbo.farmMovimientoNotaIngreso.idCuentaAtencion as NroCuent,CONCAT(dbo.Pacientes.PrimerNombre,' ',dbo.Pacientes.SegundoNombre,' ', dbo.Pacientes.ApellidoMaterno,' ',dbo.Pacientes.ApellidoPaterno) as Paciente, dbo.farmMovimiento.Observaciones as Observaciones
                 FROM         dbo.farmMovimiento INNER JOIN
                          dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                          dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo LEFT OUTER JOIN
                          dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                          dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
                          dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
						  dbo.Pacientes ON dbo.Pacientes.Idpaciente=dbo.farmMovimientoNotaIngreso.Idpaciente LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	  WHERE     dbo.farmMovimiento.MovTipo='E' and  dbo.farmMovimiento.idAlmacenDestino=@IdAlmacenDestino  and dbo.farmMovimiento.fechaCreacion Between  (CONVERT(DATETIME,@FechaInicio,103)) and  (CONVERT(DATETIME,@FechaFin,103)) and dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@IdCuentaAtencion
                ORDER BY dbo.farmMovimiento.fechaCreacion DESC, dbo.farmMovimiento.movNumero desc
Else
	  SELECT    dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino, farmAlmacen_2.descripcion AS fOrigen,
                          dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimiento.fechaCreacion,
                          dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento,
                          dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,
                          dbo.farmMovimientoNotaIngreso.idCuentaAtencion as NroCuen,CONCAT(dbo.Pacientes.PrimerNombre,' ',dbo.Pacientes.SegundoNombre,' ', dbo.Pacientes.ApellidoMaterno,' ',dbo.Pacientes.ApellidoPaterno) as Paciente,dbo.farmMovimiento.Observaciones as Observaciones
                 FROM         dbo.farmMovimiento INNER JOIN
                          dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                          dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo LEFT OUTER JOIN
						  dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                          dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
                          dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
						  dbo.Pacientes ON dbo.Pacientes.Idpaciente=dbo.farmMovimientoNotaIngreso.Idpaciente LEFT OUTER JOIN
                          dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	  WHERE     dbo.farmMovimiento.MovTipo='E' and  dbo.farmMovimiento.idAlmacenDestino=@IdAlmacenDestino and dbo.farmMovimiento.fechaCreacion Between  (CONVERT(DATETIME,@FechaInicio,103)) and  (CONVERT(DATETIME,@FechaFin,103))
                ORDER BY dbo.farmMovimiento.fechaCreacion DESC, dbo.farmMovimiento.movNumero desc

-- RHA 12/01/2021 CAMBIO 52 FIN
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveMovimientosDeNotaIngresos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveNombreEstablecimientoRenaes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveNombreEstablecimientoRenaes]
	@Codigo [varchar](100)
WITH EXECUTE AS CALLER
AS
select NOmbre from Establecimientos
where Codigo=@Codigo
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveNombreEstablecimientoRenaes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelvePrecioSegunTipoConcepto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DevuelvePrecioSegunTipoConcepto]
	@IdProducto [int],
	@IdTipoPrecioParaNiNs [int],
	@sghPrecioCompra [int],
	@sghPrecioDistribucion [int],
	@sghPrecioVentaContado [int],
	@sghPrecioDonacion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT CASE (@IdTipoPrecioParaNiNs)
        WHEN @sghPrecioCompra THEN
            (Select PrecioCompra as lnPrecio from FactCatalogoBienesInsumos where idProducto=@IdProducto)
        WHEN @sghPrecioDistribucion THEN
            (Select PrecioDistribucion as lnPrecio  from FactCatalogoBienesInsumos where idProducto=@IdProducto)
        WHEN @sghPrecioVentaContado THEN
            (Select PrecioUnitario as lnPrecio from  FactCatalogoBienesInsumosHosp where Activo = 1 AND idTipoFinanciamiento=1 and idProducto=@IdProducto)
        WHEN @sghPrecioDonacion THEN
            (Select PrecioDonacion as lnPrecio from FactCatalogoBienesInsumos where idProducto=@IdProducto)
END as lnPrecio*/

    IF @IdTipoPrecioParaNiNs = @sghPrecioCompra
    BEGIN
        Select PrecioCompra as lnPrecio from FactCatalogoBienesInsumos where idProducto=@IdProducto
    END
    ELSE IF @IdTipoPrecioParaNiNs = @sghPrecioDistribucion
    BEGIN
        Select PrecioDistribucion as lnPrecio  from FactCatalogoBienesInsumos where idProducto=@IdProducto
    END
    ELSE IF @IdTipoPrecioParaNiNs = @sghPrecioVentaContado
    BEGIN
        Select PrecioUnitario as lnPrecio from  FactCatalogoBienesInsumosHosp where Activo = 1 AND idTipoFinanciamiento=1 and idProducto=@IdProducto
    END
    ELSE IF @IdTipoPrecioParaNiNs = @sghPrecioDonacion
    BEGIN
        Select PrecioDonacion as lnPrecio from FactCatalogoBienesInsumos where idProducto=@IdProducto
    END;
GO
ALTER AUTHORIZATION ON [dbo].[DevuelvePrecioSegunTipoConcepto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelvePrecioSegunTipoFinanciamiento]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelvePrecioSegunTipoFinanciamiento]
	@IdProducto [int],
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select PrecioUnitario as lnPrecio from  FactCatalogoBienesInsumosHosp where idTipoFinanciamiento=@IdtipoFinanciamiento and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[DevuelvePrecioSegunTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveRedondeoEnCadaBoletaFarmacia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveRedondeoEnCadaBoletaFarmacia]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FactOrdenesBienes.idPreventa,
                                      dbo.FactOrdenesBienes.idComprobantePago, dbo.farmPreVentaDetalle.*, dbo.farmPreVenta.idEstadoPreventa
                 FROM           dbo.farmPreVenta RIGHT OUTER JOIN
                                      dbo.farmPreVentaDetalle ON dbo.farmPreVenta.idPreventa = dbo.farmPreVentaDetalle.idPreventa LEFT OUTER JOIN
                                      dbo.FactOrdenesBienes ON dbo.farmPreVentaDetalle.idPreventa = dbo.FactOrdenesBienes.idPreventa
                 Where           (dbo.farmPreVenta.idEstadoPreventa = 2) and  dbo.FactOrdenesBienes.idComprobantePago= @IdComprobantePago
                 ORDER BY   dbo.FactOrdenesBienes.idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveRedondeoEnCadaBoletaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveServiciosDelHospital]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveServiciosDelHospital]
	@Filtro [varchar](100),
	@FiltroTipoEstado [varchar](100),
	@FiltroEspecialidades [varchar](100),
	@Orden [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL ='SELECT     dbo.Servicios.IdServicio, LTRIM(dbo.Servicios.Nombre) + ''  ('' + LTRIM(dbo.Especialidades.Nombre)
                     + '')  ('' + LTRIM(dbo.TiposServicio.Descripcion) + '')'' AS DservicioHosp
FROM         dbo.Servicios LEFT OUTER JOIN
                     dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                     dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
WHERE     dbo.Servicios.IdTipoServicio in ' + @Filtro + ' ' + @FiltroTipoEstado + ' ' + @FiltroEspecialidades +
' ' + @Orden

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveServiciosDelHospital] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveServiciosDelHospitalFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveServiciosDelHospitalFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'SELECT     dbo.Servicios.IdServicio, LTRIM(dbo.Servicios.Nombre) + "  (" + LTRIM(dbo.Especialidades.Nombre)
                                  + ")  (" + LTRIM(dbo.TiposServicio.Descripcion) + ")" AS DservicioHosp
             FROM         dbo.Servicios LEFT OUTER JOIN
                                  dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                                  dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
             WHERE     dbo.Servicios.IdTipoServicio in      '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveServiciosDelHospitalFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveServiciosQueSonPuntosCarga]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveServiciosQueSonPuntosCarga]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3000)

   SET  @SQL =  'SELECT     dbo.Servicios.IdServicio, LTRIM(dbo.Servicios.Nombre) + "  (" + LTRIM(dbo.Especialidades.Nombre)
                      + ")  (" + LTRIM(dbo.TiposServicio.Descripcion) + ")" AS DservicioHosp, dbo.FactPuntosCarga.IdPuntoCarga
              FROM         dbo.Servicios INNER JOIN
                      dbo.FactPuntosCarga ON dbo.Servicios.IdServicio = dbo.FactPuntosCarga.idServicio LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
             WHERE    dbo.Servicios.IdTipoServicio in      '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveServiciosQueSonPuntosCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveSiElInventarioYaExiste]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveSiElInventarioYaExiste]
	@NroInventario [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from farmInventario where numeroInventario=@NroInventario
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveSiElInventarioYaExiste] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveSiPagoConsultaMedicaEnCaja]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DevuelveSiPagoConsultaMedicaEnCaja]
	@IdAtencion [int],
	@MotivoSalidaHistoria [varchar](1)
WITH EXECUTE AS CALLER
AS
If @MotivoSalidaHistoria = '1'            --ce


	   SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdFormaPago,dbo.Atenciones.idCuentaAtencion,
                dbo.FactOrdenServicio.idTipoFinanciamiento
                FROM         dbo.Atenciones RIGHT OUTER JOIN
                dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
                Where  dbo.Atenciones.idAtencion=@IdAtencion
	  and (dbo.Atenciones.IdTipoServicio = 1)

else
If @MotivoSalidaHistoria = '2'             --hospitalizacion


	   SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdFormaPago,dbo.Atenciones.idCuentaAtencion,
                dbo.FactOrdenServicio.idTipoFinanciamiento
                FROM         dbo.Atenciones RIGHT OUTER JOIN
                dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
                Where  dbo.Atenciones.idAtencion=@IdAtencion
	  and (dbo.Atenciones.IdTipoServicio = 3)

else
If @MotivoSalidaHistoria = '3'                  --emergencia


	   SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdFormaPago,dbo.Atenciones.idCuentaAtencion,
                dbo.FactOrdenServicio.idTipoFinanciamiento
                FROM         dbo.Atenciones RIGHT OUTER JOIN
                dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
                Where  dbo.Atenciones.idAtencion=@IdAtencion
	  and (dbo.Atenciones.IdTipoServicio in (2,4))
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveSiPagoConsultaMedicaEnCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveSubAreaDondeLaboraElUsuarioDelSistema]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveSubAreaDondeLaboraElUsuarioDelSistema]
	@idLaboraArea [int],
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
select idLaboraSubArea from EmpleadosLugarDeTrabajo
where idLaboraArea=@idLaboraArea
and idEmpleado=@idEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveSubAreaDondeLaboraElUsuarioDelSistema] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DevuelveUbigeoDetalladoDelHospital]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DevuelveUbigeoDetalladoDelHospital]
	@SeleccionaFilaParametro208 [varchar](150)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Establecimientos.IdEstablecimiento, dbo.Establecimientos.Codigo, dbo.Establecimientos.Nombre, dbo.Establecimientos.IdDistrito,
                          dbo.Distritos.Nombre AS ndistrito, dbo.Provincias.Nombre AS nprov, dbo.Departamentos.Nombre AS ndpto, dbo.Provincias.IdProvincia,  dbo.Provincias.IdDepartamento
             FROM         dbo.Provincias RIGHT OUTER JOIN  dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento RIGHT OUTER JOIN
                          dbo.Distritos ON dbo.Provincias.IdProvincia = dbo.Distritos.IdProvincia RIGHT OUTER JOIN
                          dbo.Establecimientos ON dbo.Distritos.IdDistrito = dbo.Establecimientos.IdDistrito
             WHERE     (dbo.Establecimientos.Codigo = @SeleccionaFilaParametro208 )
GO
ALTER AUTHORIZATION ON [dbo].[DevuelveUbigeoDetalladoDelHospital] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosActualizaClaseDxHis]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosActualizaClaseDxHis]
	@claseDxHis [varchar](1),
	@codigoCie2004 [varchar](7),
	@EsActivo [bit]
WITH EXECUTE AS CALLER
AS
update diagnosticos set claseDxHis=@claseDxHis, EsActivo = @EsActivo where LEFT(codigoCie2004,5)=@codigoCie2004 AND EsActivo = 1
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosActualizaClaseDxHis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosAgregar]
	@Intrahospitalario [bit],
	@IdDiagnostico [int] OUTPUT,
	@Descripcion [varchar](250),
	@CodigoCIE9 [char](5),
	@CodigoCIE10 [char](7),
	@CodigoExportacion [char](5),
	@IdTipoSexo [int],
	@Morbilidad [bit],
	@IdCategoria [int],
	@Restriccion [bit],
	@EdadMaxDias [int],
	@EdadMinDias [int],
	@CodigoCIE2004 [char](7),
	@IdCapitulo [int],
	@IdGrupo [int],
	@Gestacion [bit],
	@DescripcionMINSA [varchar](250),
	@codigoCIEsinPto [varchar](7),
	@FechaInicioVigencia [datetime],
	@EsActivo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @FechaInicioVigenciaMaxima DATETIME;

	SET @FechaInicioVigenciaMaxima = (SELECT MAX(FechaInicioVigencia) FROM Diagnosticos
								WHERE CodigoCIE2004 = @CodigoCIE2004)

	IF @FechaInicioVigenciaMaxima IS NOT NULL
	BEGIN
		IF @FechaInicioVigenciaMaxima <= @FechaInicioVigencia
			SET @EsActivo = 1
		ELSE
			SET @EsActivo = 0
	END
	ELSE
		SET @EsActivo = 1

	BEGIN TRANSACTION

	IF @EsActivo = 1
	BEGIN
		UPDATE Diagnosticos SET EsActivo = 0
		WHERE CodigoCIE2004 = @CodigoCIE2004

		IF @@ERROR <> 0 GOTO MyError
	END

	INSERT INTO Diagnosticos (
	Intrahospitalario,Descripcion,CodigoCIE9,CodigoCIE10,CodigoExportacion,
	IdTipoSexo,Morbilidad,IdCategoria,Restriccion,EdadMaxDias,EdadMinDias,
	CodigoCIE2004,IdCapitulo,IdGrupo,Gestacion,
	DescripcionMINSA,codigoCIEsinPto, FechaInicioVigencia, EsActivo)
	VALUES (
	@Intrahospitalario,@Descripcion,@CodigoCIE9,@CodigoCIE10,@CodigoExportacion,
	@IdTipoSexo,@Morbilidad,@IdCategoria,@Restriccion,@EdadMaxDias,@EdadMinDias,
	@CodigoCIE2004,@IdCapitulo,@IdGrupo,@Gestacion,
	@DescripcionMINSA,@codigoCIEsinPto,@FechaInicioVigencia, @EsActivo)

	IF @@ERROR <> 0 GOTO MyError

	SET @IdDiagnostico = @@Identity
MyError:
	IF @@ERROR = 0
	BEGIN
		COMMIT TRANSACTION
	END
	ELSE
	BEGIN
		ROLLBACK TRANSACTION
	END

	exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdDiagnostico,'Diagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosAgregarPorCodigoDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosAgregarPorCodigoDescripcion]
	@CodigoCie2004 [varchar](7),
	@Descripcion [varchar](250)
WITH EXECUTE AS CALLER
AS
INSERT INTO diagnosticos (CodigoCIE2004,Descripcion)
VALUES (@CodigoCie2004, @Descripcion)
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosAgregarPorCodigoDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosAgregarPorCodigoDescripcionDatosCompletos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosAgregarPorCodigoDescripcionDatosCompletos]
	@CodigoCie2004 [varchar](7),
	@Descripcion [varchar](250),
	@EdadMaxDias [int],
	@EdadMinDias [int],
	@IdTipoSexo [int],
	@FechaInicioVigencia [datetime],
	@EsActivo [bit]
WITH EXECUTE AS CALLER
AS
DECLARE @IdDiagnostico int;

	SET @IdDiagnostico = (SELECT IdDiagnostico FROM diagnosticos WHERE codigoCie2004=@CodigoCie2004
							AND Descripcion = @Descripcion)

	IF @IdDiagnostico IS NULL
	BEGIN
		INSERT INTO diagnosticos (CodigoCIE2004,Descripcion, EdadMaxDias,
				EdadMinDias, IdTipoSexo, FechaInicioVigencia, EsActivo)
		VALUES (@CodigoCie2004, @Descripcion, @EdadMaxDias,
			@EdadMinDias, @IdTipoSexo, @FechaInicioVigencia, @EsActivo)
	END
	ELSE
	BEGIN
		IF  @EsActivo = 0
			UPDATE diagnosticos SET
				EsActivo = @EsActivo
			WHERE IdDiagnostico = @IdDiagnostico
		ELSE
			UPDATE diagnosticos SET
				EsActivo = @EsActivo,
				EdadMaxDias = @EdadMaxDias,
				EdadMinDias = @EdadMinDias,
				IdTipoSexo = @IdTipoSexo
			WHERE IdDiagnostico = @IdDiagnostico
	END
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosAgregarPorCodigoDescripcionDatosCompletos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCapitulosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCapitulosAgregar]
	@Descripcion [varchar](255),
	@Codigo [varchar](20),
	@IdCapitulo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into DiagnosticosCapitulos (
Descripcion,Codigo) values (
@Descripcion,@Codigo)
set @IdCapitulo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCapitulo,'DiagnosticosCapitulos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCapitulosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCapitulosEliminar]
	@IdCapitulo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from DiagnosticosCapitulos
where IdCapitulo = @IdCapitulo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCapitulo,'DiagnosticosCapitulos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCapitulosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCapitulosModificar]
	@Descripcion [varchar](255),
	@Codigo [varchar](20),
	@IdCapitulo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update DiagnosticosCapitulos
set
Descripcion = @Descripcion,
Codigo = @Codigo
where IdCapitulo = @IdCapitulo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCapitulo,'DiagnosticosCapitulos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCapitulosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCapitulosSeleccionarPorId]
	@IdCapitulo [int]
WITH EXECUTE AS CALLER
AS
select * from DiagnosticosCapitulos
where IdCapitulo = @IdCapitulo
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCapitulosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCapitulosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCapitulo, Descripcion,
(Convert(varchar(5), IdCapitulo) + ' = ' + Descripcion) as DescripcionLarga
 from DiagnosticosCapitulos
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCapitulosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCategoriasAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCategoriasAgregar]
	@IdGrupo [int],
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdCategoria [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into DiagnosticosCategorias (
IdGrupo,Descripcion,Codigo) values (
@IdGrupo,@Descripcion,@Codigo)
set @IdCategoria = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCategoria,'DiagnosticosCategorias'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategoriasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCategoriasEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCategoriasEliminar]
	@IdCategoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from DiagnosticosCategorias
where IdCategoria = @IdCategoria
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCategoria,'DiagnosticosCategorias'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategoriasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCategoriasModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCategoriasModificar]
	@IdGrupo [int],
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdCategoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update DiagnosticosCategorias
set
IdGrupo = @IdGrupo,
Descripcion = @Descripcion,
Codigo = @Codigo
where IdCategoria = @IdCategoria
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCategoria,'DiagnosticosCategorias'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategoriasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCategoriasSeleccionarPorGrupo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCategoriasSeleccionarPorGrupo]
	@IdGrupo [int]
WITH EXECUTE AS CALLER
AS
select IdCategoria, Descripcion,
(Convert(varchar(5), IdCategoria) + ' = ' + Descripcion) as DescripcionLarga
 from DiagnosticosCategorias
where IdGrupo = @IdGrupo
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategoriasSeleccionarPorGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosCategoriasSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosCategoriasSeleccionarPorId]
	@IdCategoria [int]
WITH EXECUTE AS CALLER
AS
select * from DiagnosticosCategorias
where IdCategoria = @IdCategoria
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosCategoriasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosEliminar]
	@IdDiagnostico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Diagnosticos
where IdDiagnostico = @IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosEliminarValidar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosEliminarValidar]
	@IdDiagnostico [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarErrorNumber INT
	SET @VarErrorNumber = 0;
	IF (SELECT COUNT(1) FROM AtencionesDiagnosticos WHERE IdDiagnostico = @IdDiagnostico) > 0
	BEGIN
		SET @VarErrorNumber = 1;
	END
	IF @VarErrorNumber = 0
	BEGIN
		IF (SELECT COUNT(1) FROM PerinatalCatalogoCie10 WHERE IdDiagnostico = @IdDiagnostico) > 0
		BEGIN
			SET @VarErrorNumber = 2;
		END
	END

	IF @VarErrorNumber = 0
	BEGIN
		IF (SELECT COUNT(1) FROM ProCatalogoDiagnosticos WHERE IdDiagnostico = @IdDiagnostico) > 0
		BEGIN
			SET @VarErrorNumber = 3;
		END
	END

	IF @VarErrorNumber = 0
		BEGIN
		IF (SELECT COUNT(1) FROM ProDiagnosticos WHERE IdDiagnostico = @IdDiagnostico) > 0
		BEGIN
			SET @VarErrorNumber = 4;
		END
	END

	IF @VarErrorNumber = 0
	BEGIN
		IF (SELECT COUNT(1) FROM HIS_DetalleDiagnostico WHERE IdCIE = @IdDiagnostico) > 0
		BEGIN
			SET @VarErrorNumber = 5;
		END
	END
	SELECT @IdDiagnostico AS IdDiagnostico, @VarErrorNumber AS ErrorNumber
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosEliminarValidar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosFiltrar]
	@lcFiltro [varchar](1000),
	@lbUSAcodigoCIEsinPto [bit]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lbUSAcodigoCIEsinPto=1
   if @lcFiltro<>''
          SET  @SQL =  'select Iddiagnostico, codigoCIEsinPto, Descripcion,CodigoCIE10, CodigoCIE9, EsActivo, FechaInicioVigencia from Diagnosticos  ' +  @lcFiltro
   else
          SET  @SQL =  'select Iddiagnostico, codigoCIEsinPto, Descripcion,CodigoCIE10, CodigoCIE9, EsActivo, FechaInicioVigencia from Diagnosticos '
else
   if @lcFiltro<>''
          SET  @SQL =  'select Iddiagnostico, CodigoCIE2004, Descripcion,CodigoCIE10, CodigoCIE9, EsActivo, FechaInicioVigencia from Diagnosticos  ' +  @lcFiltro
   else
          SET  @SQL =  'select Iddiagnostico, CodigoCIE2004, Descripcion,CodigoCIE10, CodigoCIE9, EsActivo, FechaInicioVigencia from Diagnosticos  '
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosGruposAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosGruposAgregar]
	@IdCapitulo [int],
	@Descripcion [varchar](255),
	@IdGrupo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into DiagnosticosGrupos (
IdCapitulo,Descripcion) values (
@IdCapitulo,@Descripcion)
set @IdGrupo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGrupo,'DiagnosticosGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGruposAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosGruposEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosGruposEliminar]
	@IdGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from DiagnosticosGrupos
where IdGrupo = @IdGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdGrupo,'DiagnosticosGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGruposEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosGruposModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosGruposModificar]
	@IdCapitulo [int],
	@Descripcion [varchar](255),
	@IdGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update DiagnosticosGrupos
set
IdCapitulo = @IdCapitulo,
Descripcion = @Descripcion
where IdGrupo = @IdGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdGrupo,'DiagnosticosGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGruposModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosGruposSeleccionarPorCapitulo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosGruposSeleccionarPorCapitulo]
	@IdCapitulo [int]
WITH EXECUTE AS CALLER
AS
select IdGrupo, Descripcion,
(Convert(varchar(5), IdGrupo) + ' = ' + Descripcion) as DescripcionLarga
 from DiagnosticosGrupos
where IdCapitulo = @IdCapitulo
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGruposSeleccionarPorCapitulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosGruposSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosGruposSeleccionarPorId]
	@IdGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from DiagnosticosGrupos
where IdGrupo = @IdGrupo
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosGruposSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosModificar]
	@Intrahospitalario [bit],
	@IdDiagnostico [int],
	@Descripcion [varchar](250),
	@CodigoCIE9 [char](5),
	@CodigoCIE10 [char](7),
	@CodigoExportacion [char](5),
	@IdTipoSexo [int],
	@Morbilidad [bit],
	@IdCategoria [int],
	@Restriccion [bit],
	@EdadMaxDias [int],
	@EdadMinDias [int],
	@CodigoCIE2004 [char](7),
	@IdCapitulo [int],
	@IdGrupo [int],
	@Gestacion [bit],
	@DescripcionMINSA [varchar](250),
	@codigoCIEsinPto [varchar](7),
	@FechaInicioVigencia [datetime],
	@EsActivo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @FechaInicioVigenciaMaxima DATETIME;

	IF @EsActivo = 1
	BEGIN
		SET @FechaInicioVigenciaMaxima = (SELECT MAX(FechaInicioVigencia) FROM Diagnosticos
									WHERE CodigoCIE2004 = @CodigoCIE2004 AND IdDiagnostico != @IdDiagnostico)

		IF @FechaInicioVigenciaMaxima IS NOT NULL
		BEGIN
			IF @FechaInicioVigenciaMaxima > @FechaInicioVigencia
				SET @EsActivo = 0
		END
	END

	BEGIN TRANSACTION

	IF @EsActivo = 1
	BEGIN
		UPDATE Diagnosticos SET EsActivo = 0
		WHERE CodigoCIE2004 = @CodigoCIE2004

		IF @@ERROR <> 0 GOTO MyError
	END

	UPDATE Diagnosticos SET
		Intrahospitalario = @Intrahospitalario,
		Descripcion = @Descripcion,
		CodigoCIE9 = @CodigoCIE9,
		CodigoCIE10 = @CodigoCIE10,
		CodigoExportacion = @CodigoExportacion,
		IdTipoSexo = @IdTipoSexo,
		Morbilidad = @Morbilidad,
		IdCategoria = @IdCategoria,
		Restriccion = @Restriccion,
		EdadMaxDias = @EdadMaxDias,
		EdadMinDias = @EdadMinDias,
		CodigoCIE2004 = @CodigoCIE2004,
		IdCapitulo = @IdCapitulo,
		IdGrupo = @IdGrupo,
		Gestacion = @Gestacion,
		DescripcionMINSA=@DescripcionMINSA,
		codigoCIEsinPto=@codigoCIEsinPto,
		FechaInicioVigencia = @FechaInicioVigencia,
		EsActivo = @EsActivo
	WHERE IdDiagnostico = @IdDiagnostico

	IF @@ERROR <> 0 GOTO MyError

MyError:
	IF @@ERROR = 0
	BEGIN
		COMMIT TRANSACTION
	END
	ELSE
	BEGIN
		ROLLBACK TRANSACTION
	END
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDiagnostico,'Diagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosModificarCodigoCIEsinPto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosModificarCodigoCIEsinPto]
	@IdDiagnostico [int],
	@codigoCIEsinPto [varchar](7)
WITH EXECUTE AS CALLER
AS
UPDATE diagnosticos
SET  codigoCIEsinPto= @codigoCIEsinPto
WHERE IdDiagnostico=@IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosModificarCodigoCIEsinPto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosModificarDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosModificarDescripcion]
	@IdDiagnostico [int],
	@Descripcion [varchar](250)
WITH EXECUTE AS CALLER
AS
UPDATE diagnosticos
SET  Descripcion= @Descripcion
WHERE IdDiagnostico=@IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosModificarDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosModificarDescripcionYOtroDatos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosModificarDescripcionYOtroDatos]
	@IdDiagnostico [int],
	@Descripcion [varchar](250),
	@EdadMaxDias [int],
	@EdadMinDias [int],
	@IdTipoSexo [int],
	@FechaInicioVigencia [datetime],
	@EsActivo [bit]
WITH EXECUTE AS CALLER
AS
IF  @EsActivo = 0
	BEGIN
		UPDATE diagnosticos SET
			EsActivo = @EsActivo
		WHERE IdDiagnostico=@IdDiagnostico
	END
	ELSE
	BEGIN
		UPDATE diagnosticos SET
			-- Descripcion= @Descripcion
			EsActivo = @EsActivo,
			EdadMaxDias = @EdadMaxDias,
			EdadMinDias = @EdadMinDias,
			IdTipoSexo = @IdTipoSexo
		WHERE IdDiagnostico=@IdDiagnostico
	END
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosModificarDescripcionYOtroDatos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosPrioridadesXdx]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosPrioridadesXdx]
	@dx [varchar](7)
WITH EXECUTE AS CALLER
AS
select * from DiagnosticosPrioridades where dx=@dx
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosPrioridadesXdx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarPorCie10devuelveDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarPorCie10devuelveDescripcion]
	@CodigoCie2004 [varchar](100)
WITH EXECUTE AS CALLER
AS
select descripcion from Diagnosticos where CodigoCie2004=@CodigoCie2004
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarPorCie10devuelveDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarPorCodigoCIE2004]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarPorCodigoCIE2004]
	@CodigoCIE2004 [varchar](7),
	@lbSoloMuestraDxGalenHos [bit]
WITH EXECUTE AS CALLER
AS
if @lbSoloMuestraDxGalenHos=1
      select IdDiagnostico from Diagnosticos where CodigoCIE2004 = @CodigoCIE2004 and   (not (descripcionMINSA is null))
else
      select IdDiagnostico from Diagnosticos where CodigoCIE2004 =  @CodigoCIE2004
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarPorCodigoCIE2004] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarPorId]
	@IdDiagnostico [int]
WITH EXECUTE AS CALLER
AS
select * from Diagnosticos
where IdDiagnostico = @IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
--AtencionesDiagnosticos.idClasificacionDX=3=Diagnósticos de Egreso
SELECT Diagnosticos.idDiagnostico, Diagnosticos.codigoCIE10, diagnosticos.descripcion
FROM AtencionesDiagnosticos, Diagnosticos
WHERE (AtencionesDiagnosticos.idClasificacionDX=3 or IdSubclasificacionDx=102) AND Diagnosticos.idDiagnostico=AtencionesDiagnosticos.idDiagnostico AND AtencionesDiagnosticos.idAtencion=@IdAtencion
GROUP BY Diagnosticos.idDiagnostico, Diagnosticos.codigoCIE10, diagnosticos.descripcion
ORDER BY diagnosticos.descripcion
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarTodoCamposPorCodigoCie2004]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarTodoCamposPorCodigoCie2004]
	@CodigoCie2004 [varchar](7)
WITH EXECUTE AS CALLER
AS
select * from  diagnosticos  where codigoCie2004=@CodigoCie2004 AND EsActivo = 1
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarTodoCamposPorCodigoCie2004] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from Diagnosticos
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarXCodigo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarXCodigo]
	@CodigoDx [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT IdDiagnostico, Intrahospitalario,Descripcion,CodigoCIE9,
		CodigoCIE10,CodigoExportacion,IdTipoSexo,Morbilidad,IdCategoria,
		Restriccion,EdadMaxDias,EdadMinDias,CodigoCIE2004,IdCapitulo,IdGrupo,
		Gestacion,DescripcionMINSA,codigoCIEsinPto, FechaInicioVigencia, EsActivo
	FROM Diagnosticos WHERE ltrim(rtrim(codigoCie2004))=@CodigoDx
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarXCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPto]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPto]
	@CodigoCIEsinPto [varchar](50)
WITH EXECUTE AS CALLER
AS
select descripcion from Diagnosticos where codigoCIEsinPto=@CodigoCIEsinPto
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPtoDevuelveDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPtoDevuelveDescripcion]
	@CodigoCIEsinPto [varchar](50)
WITH EXECUTE AS CALLER
AS
select descripcion from Diagnosticos where CodigoCIEsinPto=@CodigoCIEsinPto
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSeleccionarXcodigoCIEsinPtoDevuelveDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DiagnosticosSoloPartosSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DiagnosticosSoloPartosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.DiagnosticosSoloPartos.codigoCie10, dbo.Diagnosticos.IdDiagnostico, dbo.Diagnosticos.Descripcion
FROM         dbo.DiagnosticosSoloPartos LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.DiagnosticosSoloPartos.codigoCie10 = dbo.Diagnosticos.CodigoCIE2004
GO
ALTER AUTHORIZATION ON [dbo].[DiagnosticosSoloPartosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DisminuyeDevolucionesDePacientes]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DisminuyeDevolucionesDePacientes]
	@MovNumero [varchar](50),
	@MovTipo [varchar](50),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM FacturacionBienesDevoluciones where MovNumero=@MovNumero
AND movTipo=@MovTipo
AND idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[DisminuyeDevolucionesDePacientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DistritoAgregar]
	@IdDistrito [int],
	@Nombre [varchar](50),
	@IdProvincia [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO Distritos (IdDistrito, Nombre, IdProvincia)
VALUES (@IdDistrito, @Nombre, @IdProvincia)
GO
ALTER AUTHORIZATION ON [dbo].[DistritoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DistritosEliminar]
	@IdDistrito [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Distritos
where IdDistrito = @IdDistrito
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDistrito,'Distritos'
GO
ALTER AUTHORIZATION ON [dbo].[DistritosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosModificar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DistritosModificar]
	@IdProvincia [int],
	@Nombre [varchar](50),
	@IdDistrito [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Distritos
set
IdProvincia = @IdProvincia,
Nombre = @Nombre
where IdDistrito = @IdDistrito
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDistrito,'Distritos'
GO
ALTER AUTHORIZATION ON [dbo].[DistritosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarPorDepartamentoYDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarPorDepartamentoYDescripcion]
	@lcfiltro [varchar](1000),
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
declare @FiltroDes varchar(100)
select @FiltroDes='%' + @lcfiltro+'%'


SELECT     dbo.Distritos.IdDistrito, dbo.Distritos.Nombre, dbo.Distritos.IdProvincia
FROM         dbo.Provincias INNER JOIN
                      dbo.Distritos ON dbo.Provincias.IdProvincia = dbo.Distritos.IdProvincia
WHERE     (dbo.Provincias.IdDepartamento = @IdDepartamento) and  dbo.Distritos.Nombre LIKE @FiltroDes
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarPorDepartamentoYDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarPorId]
	@IdDistrito [int]
WITH EXECUTE AS CALLER
AS
select * from Distritos
where IdDistrito = @IdDistrito
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarPorProvincia]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarPorProvincia]
	@IdProvincia [int]
WITH EXECUTE AS CALLER
AS
select IdDistrito, Nombre,
(Convert(varchar(8), IdDistrito) + ' = ' + Nombre) as DescripcionLarga
 from Distritos
where IdProvincia = @IdProvincia
order by Nombre
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarPorProvincia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarPorProvinciaYDescripcion]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarPorProvinciaYDescripcion]
	@lcfiltro [varchar](1000),
	@IdProvincia [int]
WITH EXECUTE AS CALLER
AS
declare @FiltroDes varchar(100)
select @FiltroDes='%' + @lcfiltro+'%'


SELECT [IdDistrito], [Nombre], [IdProvincia] From [Distritos] Where [IdProvincia] = @IdProvincia  AND [Nombre] LIKE @FiltroDes
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarPorProvinciaYDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarTodo]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarTodo]
WITH EXECUTE AS CALLER
AS
select * from Distritos
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DistritosSeleccionarXfiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[DistritosSeleccionarXfiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from Distritos where ' + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[DistritosSeleccionarXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[DonacionesXcuenta]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[DonacionesXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT      dbo.farmMovimiento.fechaCreacion AS [Fecha Atencion], dbo.farmAlmacen.descripcion AS [Punto Carga],
                                  dbo.farmMovimiento.DocumentoNumero AS [N° Dcto], dbo.FactCatalogoBienesInsumos.Codigo,
                                  dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento,
                                  dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio,dbo.farmMovimientoDetalle.Total
             FROM           dbo.farmMovimiento LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen RIGHT OUTER JOIN
                                  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto FULL OUTER JOIN
                                  dbo.FarmMovimientoDonaciones ON dbo.farmMovimiento.MovNumero = dbo.FarmMovimientoDonaciones.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.FarmMovimientoDonaciones.MovTipo
             Where dbo.farmMovimiento.idEstadoMovimiento=1 and dbo.FarmMovimientoDonaciones.idCuentaAtencion=@idCuentaAtencion
             ORDER BY dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.DocumentoNumero, dbo.FactCatalogoBienesInsumos.Nombre */

SELECT     dbo.farmMovimiento.fechaCreacion AS [Fecha Atencion], dbo.farmAlmacen.descripcion AS [Punto Carga],
                      dbo.farmMovimiento.DocumentoNumero AS [N° Dcto], dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen INNER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                      dbo.FarmMovimientoDonaciones ON dbo.farmMovimiento.MovNumero = dbo.FarmMovimientoDonaciones.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.FarmMovimientoDonaciones.movTipo
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.FarmMovimientoDonaciones.idCuentaAtencion = @idCuentaAtencion)
ORDER BY dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.DocumentoNumero, dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[DonacionesXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[eliminaTodosReembolsoXidReembolso]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[eliminaTodosReembolsoXidReembolso]
	@idReembolso [int]
WITH EXECUTE AS CALLER
AS
delete from FactReembolsosdocumentos where idFactReembolso =@idreembolso
  delete from FacturacionReembolsos where idFactReembolso =@idreembolso
  delete from FactReembolsos where idFactReembolso =@idreembolso
GO
ALTER AUTHORIZATION ON [dbo].[eliminaTodosReembolsoXidReembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaCausaExternaMorbilidadSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaCausaExternaMorbilidadSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCausaExternaMorbilidad, convert(varchar(2) , IdCausaExternaMorbilidad) + ' = ' + Descripcion + '(' +  Codigo  + ')' as DescripcionLarga from EmergenciaCausaExternaMorbilidad
order by  IdCausaExternaMorbilidad
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaCausaExternaMorbilidadSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaClaseAccidenteSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaClaseAccidenteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdClaseAccidente,
(Convert(varchar(5), IdClaseAccidente) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaClaseAccidente
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaClaseAccidenteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaGrupoOcupacionalALABSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaGrupoOcupacionalALABSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdGrupoOcupacionalALAB,
(Convert(varchar(5), IdGrupoOcupacionalALAB) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaGrupoOcupacionalALAB
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaGrupoOcupacionalALABSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaLugarEventoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaLugarEventoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdLugarEvento,
(Convert(varchar(5), IdLugarEvento) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaLugarEvento
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaLugarEventoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaPosicionLesionadoALABSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaPosicionLesionadoALABSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdPosicionLesionadoALAB,
(Convert(varchar(5), IdPosicionLesionadoALAB) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaPosicionLesionadoALAB
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaPosicionLesionadoALABSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaRelacionAgresorVictimaSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaRelacionAgresorVictimaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdRelacionAgresorVictima,
(Convert(varchar(5), IdRelacionAgresorVictima) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaRelacionAgresorVictima
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaRelacionAgresorVictimaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaSeguridadSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaSeguridadSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdSeguridad,
(Convert(varchar(5), IdSeguridad) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaSeguridad
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaSeguridadSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaTipoAgenteAGANSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaTipoAgenteAGANSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoAgenteAGAN,
(Convert(varchar(5), IdTipoAgenteAGAN) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaTipoAgenteAGAN
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoAgenteAGANSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaTipoEventoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaTipoEventoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoEvento,
(Convert(varchar(5), IdTipoEvento) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaTipoEvento
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoEventoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaTipoTransporteSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaTipoTransporteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoTransporte,
(Convert(varchar(5), IdTipoTransporte) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaTipoTransporte
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoTransporteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaTipoVehiculoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaTipoVehiculoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoVehiculo,
(Convert(varchar(5), IdTipoVehiculo) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaTipoVehiculo
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaTipoVehiculoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmergenciaUbicacionLesionadoSeleccionarTodos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmergenciaUbicacionLesionadoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdUbicacionLesionado,
(Convert(varchar(5), IdUbicacionLesionado) + ' = ' + Descripcion) as DescripcionLarga
 from EmergenciaUbicacionLesionado
GO
ALTER AUTHORIZATION ON [dbo].[EmergenciaUbicacionLesionadoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosAgregar]
	@Usuario [varchar](20),
	@Clave [varchar](200),
	@FechaAlta [datetime],
	@FechaIngreso [datetime],
	@CodigoPlanilla [varchar](8),
	@DNI [char](20),
	@IdTipoEmpleado [int],
	@IdCondicionTrabajo [int],
	@Nombres [varchar](50),
	@ApellidoMaterno [varchar](50),
	@ApellidoPaterno [varchar](50),
	@IdEmpleado [int] OUTPUT,
	@IdUsuarioAuditoria [int],
	@LoginEstado [int],
	@LoginPC [varchar](50),
	@FechaNacimiento [datetime],
	@idTipoDestacado [int],
	@IdEstablecimientoExterno [int],
	@HisCodigoDigitador [varchar](20),
	@ReniecAutorizado [bit],
	@idTipoDocumento [int],
	@idSupervisor [int],
	@EsActivo [bit],
	@idTipoSexo [int],
	@idPais [int]
WITH EXECUTE AS CALLER
AS
insert into Empleados (
    Usuario,Clave,FechaAlta,FechaIngreso,CodigoPlanilla,DNI,IdTipoEmpleado,IdCondicionTrabajo,Nombres,ApellidoMaterno,ApellidoPaterno,LoginEstado,LoginPC,FechaNacimiento,
   idTipoDestacado,IdEstablecimientoExterno,HisCodigoDigitador,ReniecAutorizado,idTipoDocumento,idSupervisor,EsActivo,idTipoSexo
   --SCCQ 26/03/2020 Cambio2 Inicio
   ,idPais
   --SCCQ 26/03/2020 Cambio2 Fin
   )
   values (
   @Usuario,@Clave,@FechaAlta,@FechaIngreso,@CodigoPlanilla,@DNI,@IdTipoEmpleado,@IdCondicionTrabajo,@Nombres,@ApellidoMaterno,@ApellidoPaterno,@LoginEstado,@LoginPC,@FechaNacimiento,
   @idTipoDestacado,@IdEstablecimientoExterno,@HisCodigoDigitador,@ReniecAutorizado ,@idTipoDocumento,@idSupervisor,@EsActivo,@idTipoSexo
      --SCCQ 26/03/2020 Cambio2 Inicio
   ,@idPais
   --SCCQ 26/03/2020 Cambio2 Fin
   )
set @IdEmpleado = @@Identity
/****** Object:  StoredProcedure [dbo].[EmpleadosModificar]    Script Date: 26/03/2020 10:01:26 ******/
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosCargosAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosCargosAgregar]
	@IdTipoCargo [int],
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
Insert Into EmpleadosCargos (idCargo,idEmpleado) Values (@IdTipoCargo,@IdEmpleado)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosCargosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosCargosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosCargosEliminar]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
delete EmpleadosCargos where idEmpleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosCargosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosCargosLugarDeTrabajoArchiveroServicioEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosCargosLugarDeTrabajoArchiveroServicioEliminar]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
delete EmpleadosCargos where idEmpleado=@IdEmpleado --cargos
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete EmpleadosLugarDeTrabajo where idEmpleado=@IdEmpleado --Lugar donde Labora
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
delete ArchiveroServicio where idEmpleado=@IdEmpleado --archivero (Archivo Clinico)
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosCargosLugarDeTrabajoArchiveroServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosCargosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosCargosSeleccionarPorFiltro]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'SELECT     dbo.EmpleadosCargos.idEmpleado, dbo.EmpleadosCargos.idCargo, dbo.TiposCargo.Cargo
                         FROM      dbo.EmpleadosCargos LEFT OUTER JOIN dbo.TiposCargo ON dbo.EmpleadosCargos.idCargo = dbo.TiposCargo.idTipoCargo
                         WHERE '   +  @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosCargosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosChequeaNoTengaMovimientos]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosChequeaNoTengaMovimientos]
	@mensaje [varchar](50) OUTPUT,
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
select @mensaje=''
if exists (select * from ImagMovimientoImagenes  where idPersonaTomaImagen =@idEmpleado )
   select @mensaje='Tiene datos en Imágenes como RESPONSABLE'
else
   if exists (select * from LabMovimientoLaboratorio   where idPersonaTomaLab =@idEmpleado )
      select @mensaje='Tiene datos en Laboratorio como RESPONSABLE'
   else
	   if exists (select * from farmMovimientoProgramas    where idCoordinador =@idEmpleado or idPrescriptor =@idEmpleado )
		  select @mensaje='Tiene datos en Farmacia -> Intervención Sanitaria como COORDINADOR/PRESCRIPTOR'
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosChequeaNoTengaMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDeImagen]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDeImagen]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2500)
SET @SQL = 'SELECT    dbo.Empleados.IdEmpleado, LTRIM(dbo.Empleados.ApellidoPaterno) +  " " + LTRIM(dbo.Empleados.ApellidoMaterno) +  " " + dbo.Empleados.Nombres AS ApNom, dbo.EmpleadosCargos.idCargo
             FROM      dbo.Empleados LEFT OUTER JOIN dbo.EmpleadosCargos ON dbo.Empleados.IdEmpleado = dbo.EmpleadosCargos.idEmpleado
             Where ' + @Filtro +
             ' ORDER BY LTRIM(dbo.Empleados.ApellidoPaterno) + " " + LTRIM(dbo.Empleados.ApellidoMaterno) + " " + dbo.Empleados.Nombres'
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDeImagen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDeLab]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDeLab]
	@IdFiltro [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.empleados.IdEmpleado, LTRIM(dbo.empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.empleados.ApellidoMaterno) + ' ' + dbo.empleados.Nombres AS ApNom, dbo.empleadosCargos.idCargo
FROM dbo.usuariosRoles, dbo.empleados LEFT OUTER JOIN dbo.empleadosCargos ON dbo.empleados.IdEmpleado = dbo.empleadosCargos.idEmpleado
WHERE dbo.empleados.idEmpleado=dbo.usuariosRoles.idEmpleado AND dbo.usuariosRoles.idRol= @IdFiltro
ORDER BY LTRIM(dbo.empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.empleados.ApellidoMaterno) + ' ' + dbo.empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDeLab] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDevuelveCoordinadores]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDevuelveCoordinadores]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.Empleados.IdEmpleado, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS ApNom, dbo.EmpleadosCargos.idCargo
             FROM      dbo.Empleados LEFT OUTER JOIN dbo.EmpleadosCargos ON dbo.Empleados.IdEmpleado = dbo.EmpleadosCargos.idEmpleado
             Where (dbo.EmpleadosCargos.idCargo =3)
             ORDER BY LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDevuelveCoordinadores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDevuelveNombre]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDevuelveNombre]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select ltrim(ApellidoPaterno)+' '+ltrim(ApellidoMaterno)+' '+Nombres as dEmpleado from empleados where idempleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDevuelveNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDevuelveNombreUsuario]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDevuelveNombreUsuario]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select Usuario from empleados where idempleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDevuelveNombreUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDevuelvePrescriptores]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDevuelvePrescriptores]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.IdEmpleado, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS ApNom, dbo.EmpleadosCargos.idCargo
            FROM      dbo.Empleados LEFT OUTER JOIN dbo.EmpleadosCargos ON dbo.Empleados.IdEmpleado = dbo.EmpleadosCargos.idEmpleado
            Where (dbo.EmpleadosCargos.idCargo =2)
            ORDER BY LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDevuelvePrescriptores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosDevuelveSoloServicioSocial]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosDevuelveSoloServicioSocial]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.IdEmpleado, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno)
                        + ' ' + dbo.Empleados.Nombres AS ApNom, dbo.EmpleadosLugarDeTrabajo.idLaboraArea, dbo.EmpleadosLugarDeTrabajo.idLaboraSubArea
         FROM         dbo.Empleados RIGHT OUTER JOIN
                                  dbo.EmpleadosLugarDeTrabajo ON dbo.Empleados.IdEmpleado = dbo.EmpleadosLugarDeTrabajo.idEmpleado
         Where (dbo.EmpleadosLugarDeTrabajo.idLaboraSubArea = 9) And (dbo.EmpleadosLugarDeTrabajo.idLaboraArea = 4)
         ORDER BY LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosDevuelveSoloServicioSocial] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosEliminar]
	@IdEmpleado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from UsuariosRoles where IdEmpleado=@IdEmpleado
delete from Empleados where IdEmpleado = @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosFiltrar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select IdEmpleado, CodigoPlanilla, ApellidoPaterno, ApellidoMaterno, Nombres, DNI,
             TiposEmpleado.Descripcion as TipoEmpleado, TiposCondicionTrabajo.Descripcion as CondicionTrabajo
             from (Empleados left join TiposEmpleado on Empleados.IdTipoEmpleado = TiposEmpleado.IdTipoEmpleado)
             left join TiposCondicionTrabajo on Empleados.IdCondicionTrabajo = TiposCondicionTrabajo.IdCondicionTrabajo  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosLugarDeTrabajoAgregar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosLugarDeTrabajoAgregar]
	@IdEmpleado [int],
	@IdLaboraArea [int],
	@IdLaboraSubArea [int]
WITH EXECUTE AS CALLER
AS
insert into EmpleadosLugarDeTrabajo  (idEmpleado,idLaboraArea,idLaboraSubArea)
values (@IdEmpleado,@IdLaboraArea,@IdLaboraSubArea)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosLugarDeTrabajoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosLugarDeTrabajoEliminar]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosLugarDeTrabajoEliminar]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
delete EmpleadosLugarDeTrabajo where idEmpleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosLugarDeTrabajoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorFiltro]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL = 'select * from EmpleadosLugarDeTrabajo where '  + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorId]    Script Date: 12/01/2026 02:48:07 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorId]
	@lnIdUsuario [int]
WITH EXECUTE AS CALLER
AS
select * from EmpleadosLugarDeTrabajo where idEmpleado=@lnIdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosLugarDeTrabajoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosMedicosConsultar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosMedicosConsultar]
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from medicos
where idEmpleado=@idEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosMedicosConsultar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosModificar]
	@Usuario [varchar](20),
	@Clave [varchar](200),
	@FechaAlta [datetime],
	@FechaIngreso [datetime],
	@CodigoPlanilla [varchar](8),
	@DNI [char](20),
	@IdTipoEmpleado [int],
	@IdCondicionTrabajo [int],
	@Nombres [varchar](50),
	@ApellidoMaterno [varchar](50),
	@ApellidoPaterno [varchar](50),
	@IdEmpleado [int],
	@IdUsuarioAuditoria [int],
	@LoginEstado [int],
	@LoginPC [varchar](50),
	@FechaNacimiento [datetime],
	@idTipoDestacado [int],
	@IdEstablecimientoExterno [int],
	@HisCodigoDigitador [varchar](20),
	@ReniecAutorizado [bit],
	@idTipoDocumento [int],
	@idSupervisor [int],
	@EsActivo [bit],
	@idTipoSexo [int],
	@idPais [int]
WITH EXECUTE AS CALLER
AS
update Empleados
set
Usuario = @Usuario,
Clave = @Clave,
FechaAlta = @FechaAlta,
FechaIngreso = @FechaIngreso,
CodigoPlanilla = @CodigoPlanilla,
DNI = @DNI,
IdTipoEmpleado = @IdTipoEmpleado,
IdCondicionTrabajo = @IdCondicionTrabajo,
Nombres = @Nombres,
ApellidoMaterno = @ApellidoMaterno,
ApellidoPaterno = @ApellidoPaterno,
LoginEstado=@LoginEstado,
LoginPC=@LoginPC,
FechaNacimiento=@FechaNacimiento,
idTipoDestacado=@idTipoDestacado,
IdEstablecimientoExterno=@IdEstablecimientoExterno,
HisCodigoDigitador=@HisCodigoDigitador,
ReniecAutorizado=@ReniecAutorizado,
idTipoDocumento=@idTipoDocumento,
idSupervisor=@idSupervisor,
EsActivo=@EsActivo,
idTipoSexo=@idTipoSexo
--SCCQ 26/03/2020 Cambio2 Inicio
, idPais=@idPais
--SCCQ 26/03/2020 Cambio2 Fin
where IdEmpleado = @IdEmpleado

GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosObtenerConElMismoDNI]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosObtenerConElMismoDNI]
	@lnIdTipoDocumento [int],
	@lcDNI [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from empleados where idTipoDocumento=@lnIdTipoDocumento  and DNI=@lcDNI
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosObtenerConElMismoDNI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosObtenerDatosDigitador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosObtenerDatosDigitador]
	@ml_idUsuario [int]
WITH EXECUTE AS CALLER
AS
SELECT IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres AS NombreDigitador, HisCodigoDigitador FROM EMPLEADOS
WHERE IdEmpleado = @ml_idUsuario
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosObtenerDatosDigitador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosObtenerDatosEstablecimientoPorUsuario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosObtenerDatosEstablecimientoPorUsuario]
	@ml_idUsuario [int]
WITH EXECUTE AS CALLER
AS
Select D.IdDepartamento, D.Nombre as NombreDepartamento,
 P.IdProvincia, P.Nombre as NombreProvincia,
 DS.IdDistrito, DS.Nombre as NombreDistrito,
 E.IdEstablecimiento, E.Codigo, E.Nombre as NombreEstablecimiento
 from Departamentos D inner join Provincias P
 on D.IdDepartamento = P.IdDepartamento inner join Distritos DS
 on P.IdProvincia = DS.IdProvincia inner join Establecimientos E
 on DS.IdDistrito = E.IdDistrito
 Where E.IdEstablecimiento = (Select IdEstablecimientoExterno from Empleados where IdEmpleado = @ml_idUsuario)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosObtenerDatosEstablecimientoPorUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosObtenerListaMedicosMR]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosObtenerListaMedicosMR]
	@IdEpecialidad [int]
WITH EXECUTE AS CALLER
AS
SELECT
E.IdEmpleado,
M.IdMedico,
E.ApellidoPaterno + ' ' + E.ApellidoMaterno + ' ' + E.Nombres AS Nombre,
E.IdEstablecimientoExterno
From Empleados E inner join Medicos M
ON E.IdEmpleado = M.IdEmpleado inner join MedicosEspecialidad ME
ON M.IdMedico = ME.IdMedico
AND ME.IdEspecialidad = @IdEpecialidad
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosObtenerListaMedicosMR] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EMPLEADOSporIdMedicoIdEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EMPLEADOSporIdMedicoIdEstablecimiento]
	@ml_IdMedico [int],
	@IdEstabelecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT COUNT(E.IDEMPLEADO) FROM EMPLEADOS E INNER JOIN MEDICOS M
 ON E.IDEMPLEADO = M.IDEMPLEADO
 Where M.IdMedico = @ml_IdMedico
AND E.IDESTABLECIMIENTOEXTERNO = @IdEstabelecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EMPLEADOSporIdMedicoIdEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosRetornaLoginUsuario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosRetornaLoginUsuario]
	@idCodigoUsuario [int]
WITH EXECUTE AS CALLER
AS
SELECT usuario FROM empleados WHERE idempleado=@idCodigoUsuario
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosRetornaLoginUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarParaExoneracionBienesInsumos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarParaExoneracionBienesInsumos]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual  or IdEmpleado in (
         select distinct IdEmpleadoExonera from FacturacionBienesInsumos where IdCuentaAtencion= @lIdCuentaAtencion
         and not IdEmpleadoExonera is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarParaExoneracionBienesInsumos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaBienesInsumos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaBienesInsumos]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual or IdEmpleado in (
         select distinct IdEmpleadoModifica from FacturacionBienesInsumos where IdCuentaAtencion= @lIdCuentaAtencion
         and not IdEmpleadoAutorizaPendiente is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaBienesInsumos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaServicio]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual  or IdEmpleado in (
         select distinct IdEmpleadoModifica from FacturacionServicios where IdCuentaAtencion= @lIdCuentaAtencion
         and not IdEmpleadoAutorizaPendiente is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarParaModificacionDeCuentaServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarParaPendientePagoBienesInsumos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarParaPendientePagoBienesInsumos]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual or IdEmpleado in (
         select distinct IdEmpleadoAutorizaPendiente from FacturacionBienesInsumos where IdCuentaAtencion=
        @lIdCuentaAtencion and not IdEmpleadoAutorizaPendiente is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarParaPendientePagoBienesInsumos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarPorCodigoPlanilla]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarPorCodigoPlanilla]
	@CodigoPlanilla [varchar](8)
WITH EXECUTE AS CALLER
AS
SELECT IdEmpleado, CodigoPlanilla, ApellidoPaterno, ApellidoMaterno, Nombres, DNI, TiposEmpleado.Descripcion as TipoEmpleado, TiposCondicionTrabajo.Descripcion as CondicionTrabajo
FROM (Empleados left join TiposEmpleado on Empleados.IdTipoEmpleado = TiposEmpleado.IdTipoEmpleado)
left join TiposCondicionTrabajo on Empleados.IdCondicionTrabajo = TiposCondicionTrabajo.IdCondicionTrabajo
WHERE Empleados.codigoPlanilla=@CodigoPlanilla
ORDER BY ApellidoPaterno, ApellidoMaterno, Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarPorCodigoPlanilla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarPorDNI]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarPorDNI]
	@DNI [varchar](8)
WITH EXECUTE AS CALLER
AS
SELECT IdEmpleado, CodigoPlanilla, ApellidoPaterno, ApellidoMaterno, Nombres, DNI,
      TiposEmpleado.Descripcion as TipoEmpleado, TiposCondicionTrabajo.Descripcion as CondicionTrabajo,
      FechaIngreso,TiposCondicionTrabajo.condicionTrabajoSEM, TiposEmpleado.tipoEmpleadoSEM
FROM (Empleados left join TiposEmpleado on Empleados.IdTipoEmpleado = TiposEmpleado.IdTipoEmpleado)
left join TiposCondicionTrabajo on Empleados.IdCondicionTrabajo = TiposCondicionTrabajo.IdCondicionTrabajo
WHERE Empleados.DNI=@DNI
ORDER BY ApellidoPaterno, ApellidoMaterno, Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarPorDNI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarPorFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)

SET  @SQL =  'SELECT    dbo.Empleados.IdEmpleado, RTRIM(dbo.Empleados.ApellidoPaterno) + " "  + RTRIM(dbo.Empleados.ApellidoMaterno)
                                          + " " + dbo.Empleados.Nombres AS Empleado, dbo.EmpleadosLugarDeTrabajo.idLaboraArea, dbo.EmpleadosLugarDeTrabajo.idLaboraSubArea
                         FROM      dbo.Empleados RIGHT OUTER JOIN
                                         dbo.EmpleadosLugarDeTrabajo ON dbo.Empleados.IdEmpleado = dbo.EmpleadosLugarDeTrabajo.idEmpleado ' +  @Filtro +
                         ' ORDER BY RTRIM(dbo.Empleados.ApellidoPaterno) + " " + RTRIM(dbo.Empleados.ApellidoMaterno) + " " + dbo.Empleados.Nombres'


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarPorId]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from Empleados
where IdEmpleado = @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarPorIdEmpleado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarPorIdEmpleado]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from empleados where idempleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarPorIdEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, CodigoPlanilla, ApellidoPaterno, ApellidoMaterno, Nombres, DNI,
TiposEmpleado.Descripcion as TipoEmpleado, TiposCondicionTrabajo.Descripcion as CondicionTrabajo,
 ltrim(ApellidoPaterno)+' '+ ltrim(ApellidoMaterno)+' '+ ltrim(Nombres) as dEmpleado
  from
(Empleados left join TiposEmpleado on Empleados.IdTipoEmpleado = TiposEmpleado.IdTipoEmpleado)
left join TiposCondicionTrabajo on Empleados.IdCondicionTrabajo = TiposCondicionTrabajo.IdCondicionTrabajo
order by ApellidoPaterno, ApellidoMaterno, Nombres
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXcodigoPlanilla]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXcodigoPlanilla]
	@CodigoPlanilla [varchar](8)
WITH EXECUTE AS CALLER
AS
select Empleados.IdEmpleado from Empleados where Empleados.CodigoPlanilla = @CodigoPlanilla
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXcodigoPlanilla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXcolegiatura]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXcolegiatura]
	@lcCOLEGIATURA [varchar](6)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Medicos.Colegiatura, dbo.Empleados.*
             FROM         dbo.Medicos LEFT OUTER JOIN
                      dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
             WHERE dbo.Medicos.Colegiatura=@lcCOLEGIATURA
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXcolegiatura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXidentificadorYcodigoPlanilla]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXidentificadorYcodigoPlanilla]
	@IdEmpleado [int],
	@CodigoPlanilla [varchar](8)
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno, ApellidoMaterno, Nombres from Empleados
     where CodigoPlanilla = @CodigoPlanilla  and
     IdEmpleado <> @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXidentificadorYcodigoPlanilla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXidentificadorYCuentaAutorizaPendiente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXidentificadorYCuentaAutorizaPendiente]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual  or IdEmpleado in (
         select distinct IdEmpleadoAutorizaPendiente from FacturacionServicios where IdCuentaAtencion=
        @lIdCuentaAtencion and not IdEmpleadoAutorizaPendiente is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXidentificadorYCuentaAutorizaPendiente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXidentificadorYCuentaExonera]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXidentificadorYCuentaExonera]
	@lIdEmpleadoActual [int],
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno + ' ' + ApellidoMaterno + ' ' + Nombres as Nombre from Empleados
         where IdEmpleado = @lIdEmpleadoActual or IdEmpleado in (
         select distinct IdEmpleadoExonera from FacturacionServicios where IdCuentaAtencion= @lIdCuentaAtencion
         and not IdEmpleadoExonera is null)
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXidentificadorYCuentaExonera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXidentificadorYusuario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXidentificadorYusuario]
	@IdEmpleado [int],
	@Usuario [varchar](20)
WITH EXECUTE AS CALLER
AS
select IdEmpleado, ApellidoPaterno, ApellidoMaterno, Nombres from Empleados
     where Usuario =  @Usuario and
    IdEmpleado <> @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXidentificadorYusuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EmpleadosXusuario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EmpleadosXusuario]
	@sUsuario [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT * FROM Empleados WHERE usuario=@sUsuario
GO
ALTER AUTHORIZATION ON [dbo].[EmpleadosXusuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_CatalogoDominiosSeleccionar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_CatalogoDominiosSeleccionar]
WITH EXECUTE AS CALLER
AS
select * from enfermeria_catalogodominios
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoDominiosSeleccionar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_CatalogoVariablesSeleccionar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_CatalogoVariablesSeleccionar]
WITH EXECUTE AS CALLER
AS
select * from enfermeria_catalogoVariables
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoVariablesSeleccionar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_CatalogoVisitas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_CatalogoVisitas]
	@idcuentaatencion [int]
WITH EXECUTE AS CALLER
AS
select idvisita,fechahoravisita
from enfermeria_visitas
where idcuentaatencion=@idcuentaatencion
order by idvisita asc
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_CatalogoVisitas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarDatosActualesPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarDatosActualesPaciente]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT TOP 1 dbo.Atenciones.IdPaciente,dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdAtencion,dbo.Pacientes.iddocidentidad,dbo.TiposDocIdentidad.Descripcion as DocIdentidad,dbo.Pacientes.nrodocumento, dbo.Atenciones.IdCuentaAtencion AS NroCuenta, dbo.Pacientes.ApellidoPaterno,
                                  dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre,
				  ltrim(dbo.Pacientes.nrohistoriaclinica) +' (' +dbo.TiposNumeracionHistoria.descripcion + ')'  as Historia,
                                  s1.Nombre AS ServicioIngreso,s2.Nombre AS ServicioEgreso, dbo.Atenciones.Edad AS Edad,
                                  dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdServicioIngreso, dbo.Atenciones.IdMedicoIngreso,
                                  dbo.Atenciones.IdServicioEgreso, dbo.Atenciones.IdMedicoEgreso,
                                  dbo.Atenciones.idEstadoAtencion, s1.idEspecialidad as IdEspecialidadIngreso,s2.idEspecialidad as IdEspecialidadEgreso,dbo.AtencionesEstanciaHospitalaria.Idcama,dbo.Camas.Codigo as Cama,dbo.FacturacionCuentasAtencion.IdEstado
             FROM         	  dbo.Atenciones INNER JOIN dbo.FacturacionCuentasAtencion
				  ON dbo.Atenciones.IdCuentaAtencion=dbo.FacturacionCuentasAtencion.IdCuentaAtencion  LEFT OUTER JOIN
                                  dbo.Servicios as S1 ON dbo.Atenciones.IdServicioIngreso = s1.IdServicio LEFT OUTER JOIN
                                  dbo.Servicios as s2 ON dbo.Atenciones.IdServicioEgreso = s2.IdServicio LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                  dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
			          LEFT OUTER JOIN dbo.TiposDocIdentidad ON dbo.Pacientes.iddocidentidad=dbo.TiposDocIdentidad.iddocidentidad
				  LEFT OUTER JOIN dbo.AtencionesEstanciaHospitalaria ON dbo.Atenciones.IdAtencion=dbo.AtencionesEstanciaHospitalaria.IdAtencion
				  LEFT OUTER JOIN dbo.Camas on dbo.Camas.IdCama=AtencionesEstanciaHospitalaria.Idcama
WHERE dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion
ORDER BY AtencionesEstanciaHospitalaria.IdEstanciaHospitalaria DESC
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarDatosActualesPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarMedicamentoDosisDia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarMedicamentoDosisDia]
	@IdCuentaAtencion [int],
	@IdReceta [int],
	@IdItem [int],
	@IdDiaVIsita [int],
	@Dosis [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.IdEmpleado, dbo.Enfermeria_TratamientoDosis.IdCuentaAtencion, dbo.Enfermeria_TratamientoDosis.IdVisita,
                      dbo.Enfermeria_TratamientoDosis.IdDiaVisita, dbo.Enfermeria_TratamientoDosis.IdReceta, dbo.Enfermeria_TratamientoDosis.IdItem,
                      dbo.Enfermeria_TratamientoDosis.Dosis, dbo.Enfermeria_TratamientoDosis.DatoProrenata, dbo.Empleados.ApellidoPaterno,
                      dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.TiposEmpleado.Descripcion, dbo.Enfermeria_Visitas.FechaHoraVisita
FROM         dbo.Enfermeria_Visitas INNER JOIN
                      dbo.Enfermeria_TratamientoDosis ON dbo.Enfermeria_Visitas.IdCuentaAtencion = dbo.Enfermeria_TratamientoDosis.IdCuentaAtencion AND
                      dbo.Enfermeria_Visitas.IdVisita = dbo.Enfermeria_TratamientoDosis.IdVisita INNER JOIN
                      dbo.Empleados ON dbo.Enfermeria_Visitas.IdEmpleadoEnfermera = dbo.Empleados.IdEmpleado INNER JOIN
                      dbo.TiposEmpleado ON dbo.Empleados.IdTipoEmpleado = dbo.TiposEmpleado.IdTipoEmpleado
WHERE     dbo.Enfermeria_TratamientoDosis.idCuentaAtencion = @IdCuentaAtencion AND dbo.Enfermeria_TratamientoDosis.IdDiaVIsita =@IdDiaVIsita
AND dbo.Enfermeria_TratamientoDosis.Dosis = @Dosis AND dbo.Enfermeria_TratamientoDosis.IdReceta = @IdReceta AND dbo.Enfermeria_TratamientoDosis.IdItem =@IdItem
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarMedicamentoDosisDia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarMedicamentosVisita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarMedicamentosVisita]
	@IdCuentaAtencion [int],
	@IdVisita [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.idMedicoReceta, dbo.RecetaDetalle.idEstadoDetalle,dbo.RecetaEstadosDetalle.Estado, dbo.Medicos.IdEmpleado,
                    dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.RecetaDetalle.idItem,
                    dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre as Medicamento, dbo.RecetaDetalle.CantidadPedida,
                    dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaDetalle.idDosisRecetada,
                    dbo.RecetaDetalle.MotivoAnulacionMedico,dbo.Enfermeria_TratamientoDosis.Dosis,dbo.Enfermeria_TratamientoDosis.DatoProrenata
FROM dbo.Enfermeria_TratamientoDosis INNER JOIN
		    dbo.RecetaCabecera ON dbo.Enfermeria_TratamientoDosis.idReceta = dbo.RecetaCabecera.idReceta
		    AND dbo.Enfermeria_TratamientoDosis.idCuentaAtencion=dbo.RecetaCabecera.idCuentaAtencion  INNER JOIN
                    dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
		    AND dbo.Enfermeria_TratamientoDosis.idItem = dbo.RecetaDetalle.idItem INNER JOIN
                    dbo.RecetaEstadosDetalle ON dbo.RecetaDetalle.idEstadoDetalle = dbo.RecetaEstadosDetalle.idEstadoDetalle INNER JOIN
                    dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                    dbo.Medicos ON dbo.RecetaCabecera.idMedicoReceta = dbo.Medicos.IdMedico INNER JOIN
                    dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE     dbo.RecetaCabecera.IdPuntoCarga = 5 AND dbo.RecetaDetalle.idDosisRecetada is not null
AND dbo.Enfermeria_TratamientoDosis.idCuentaAtencion = @IdCuentaAtencion AND dbo.Enfermeria_TratamientoDosis.IdVisita = @IdVisita
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarMedicamentosVisita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarTotalDosificadoMedicamento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarTotalDosificadoMedicamento]
	@IdReceta [int],
	@IdItem [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaDetalle.idReceta,dbo.RecetaDetalle.idItem,dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaEstadosDetalle.Estado, dbo.RecetaDetalle.idEstadoDetalle, COUNT(*) AS CantidadDosificada
FROM         dbo.Enfermeria_TratamientoDosis INNER JOIN
                      dbo.RecetaDetalle ON dbo.Enfermeria_TratamientoDosis.IdReceta = dbo.RecetaDetalle.idReceta AND
                      dbo.Enfermeria_TratamientoDosis.IdItem = dbo.RecetaDetalle.idItem INNER JOIN
                      dbo.RecetaEstadosDetalle ON dbo.RecetaDetalle.idEstadoDetalle = dbo.RecetaEstadosDetalle.idEstadoDetalle INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE dbo.RecetaDetalle.idDosisRecetada<>0 AND dbo.RecetaDetalle.idReceta=@IdReceta AND dbo.RecetaDetalle.idItem=@IdItem
AND NOT dbo.Enfermeria_TratamientoDosis.Dosis IS NULL
GROUP BY dbo.RecetaDetalle.idReceta,dbo.RecetaDetalle.idItem,dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaEstadosDetalle.Estado, dbo.RecetaDetalle.idEstadoDetalle
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarTotalDosificadoMedicamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarTotalDosificadoProrenata]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarTotalDosificadoProrenata]
	@IdReceta [int],
	@IdItem [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaDetalle.idReceta,dbo.RecetaDetalle.idItem,dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaEstadosDetalle.Estado, dbo.RecetaDetalle.idEstadoDetalle,
			sum(dbo.Enfermeria_TratamientoDosis.DatoProrenata) AS CantidadDosificada
FROM         dbo.Enfermeria_TratamientoDosis INNER JOIN
                      dbo.RecetaDetalle ON dbo.Enfermeria_TratamientoDosis.IdReceta = dbo.RecetaDetalle.idReceta AND
                      dbo.Enfermeria_TratamientoDosis.IdItem = dbo.RecetaDetalle.idItem INNER JOIN
                      dbo.RecetaEstadosDetalle ON dbo.RecetaDetalle.idEstadoDetalle = dbo.RecetaEstadosDetalle.idEstadoDetalle INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE dbo.RecetaDetalle.idDosisRecetada=0 AND dbo.RecetaDetalle.idReceta=@IdReceta AND dbo.RecetaDetalle.idItem=@IdItem
GROUP BY dbo.RecetaDetalle.idReceta,dbo.RecetaDetalle.idItem,dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaEstadosDetalle.Estado, dbo.RecetaDetalle.idEstadoDetalle
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarTotalDosificadoProrenata] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultarUltimaVisita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultarUltimaVisita]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select top 1 * from enfermeria_visitas
where IdCuentaAtencion=@IdCuentaAtencion
order by idvisita desc
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultarUltimaVisita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ConsultaValoresVariableGrafico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ConsultaValoresVariableGrafico]
	@IdCuentaAtencion [int],
	@IdVariable [int],
	@IdVisita [int]
WITH EXECUTE AS CALLER
AS
select e.IdCuentaAtencion,e.IdVisita,e.IdVariable,e.VariableDato
from enfermeria_variables e inner join enfermeria_visitas v on e.IdVisita=v.IdVisita
where e.IdCuentaAtencion=@IdCuentaAtencion and e.IdVariable=@IdVariable
and v.IngresoValorizacion=1
and e.IdVisita<=@IdVisita
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ConsultaValoresVariableGrafico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_RecDetalleModificarEstadoConcluido]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_RecDetalleModificarEstadoConcluido]
	@idReceta [int],
	@idItem [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle
set idEstadoDetalle=4
where idReceta = @idReceta and idItem=@idItem
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idReceta,'RecetaDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_RecDetalleModificarEstadoConcluido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_RecetasDespachadasPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_RecetasDespachadasPorCuenta]
	@IdCuentaAtencion [int],
	@FechaVisita [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.idMedicoReceta, dbo.RecetaDetalle.idEstadoDetalle,dbo.RecetaEstadosDetalle.Estado, dbo.Medicos.IdEmpleado,
                    dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.RecetaDetalle.idItem,
                    dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre as Medicamento, dbo.RecetaDetalle.CantidadPedida,
                    dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaDetalle.idDosisRecetada,
                    dbo.RecetaDetalle.MotivoAnulacionMedico,'' as Dosis, '' as DatoProrenata
FROM          dbo.RecetaCabecera INNER JOIN
                    dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta INNER JOIN
                    dbo.RecetaEstadosDetalle ON dbo.RecetaDetalle.idEstadoDetalle = dbo.RecetaEstadosDetalle.idEstadoDetalle INNER JOIN
                    dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                    dbo.Medicos ON dbo.RecetaCabecera.idMedicoReceta = dbo.Medicos.IdMedico INNER JOIN
                    dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE     (dbo.RecetaCabecera.IdPuntoCarga = 5) AND (dbo.RecetaCabecera.idCuentaAtencion = @IdCuentaAtencion and dbo.RecetaDetalle.idDosisRecetada is not null)
and dbo.RecetaCabecera.IdEstado=2  AND dbo.RecetaCabecera.FechaReceta <= @FechaVisita
and not dbo.RecetaDetalle.CantidadDespachada is null
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_RecetasDespachadasPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_TotalDatosGrafico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_TotalDatosGrafico]
WITH EXECUTE AS CALLER
AS
SELECT * FROM enfermeria_CatalogoVariables
WHERE Tipo in ('ValorEntero','ValorDouble') and EsDatoGrafico=1
--WHERE Tipo='ValorEntero' and EsDatoGrafico=1
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TotalDatosGrafico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_TratamientoDosisAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_TratamientoDosisAgregar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdDiaVisita [int],
	@IdReceta [int],
	@IdItem [int],
	@Dosis [int],
	@DatoProrenata [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Enfermeria_TratamientoDosis (
IdCuentaAtencion,IdVisita,IdDiaVisita,IdReceta,IdItem,Dosis,DatoProrenata) values (
@IdCuentaAtencion,@IdVisita,@IdDiaVisita,@IdReceta,@IdItem,@Dosis,@DatoProrenata)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'Enfermeria_TratamientoDosis'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TratamientoDosisAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_TratamientoDosisEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_TratamientoDosisEliminar]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Enfermeria_TratamientoDosis
where IdCuentaAtencion = @IdCuentaAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'Enfermeria_TratamientoDosis'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TratamientoDosisEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_TratamientoDosisModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_TratamientoDosisModificar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdDiaVisita [int],
	@IdReceta [int],
	@IdItem [int],
	@Dosis [int],
	@DatoProrenata [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Enfermeria_TratamientoDosis
set
Dosis = @Dosis,
DatoProrenata = @DatoProrenata
where IdCuentaAtencion = @IdCuentaAtencion and
IdVisita = @IdVisita and
IdReceta = @IdReceta and
IdItem = @IdItem
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'Enfermeria_TratamientoDosis'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TratamientoDosisModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_TratamientoDosisSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_TratamientoDosisSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from Enfermeria_TratamientoDosis
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_TratamientoDosisSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ValoresComboAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ValoresComboAgregar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdVariable [int],
	@IdValorCombo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Enfermeria_ValoresCombo (
IdCuentaAtencion,IdVisita,IdVariable,IdValorCombo) values (
@IdCuentaAtencion,@IdVisita,@IdVariable,@IdValorCombo)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'Enfermeria_ValoresCombo'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ValoresComboAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ValoresComboEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_ValoresComboEliminar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Enfermeria_ValoresCombo
where IdCuentaAtencion = @IdCuentaAtencion and  IdVisita = @IdVisita
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'Enfermeria_ValoresCombo'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ValoresComboEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_ValoresComboSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_ValoresComboSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from Enfermeria_ValoresCombo
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_ValoresComboSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VariablesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VariablesAgregar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdVariable [int],
	@VariableDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Enfermeria_Variables (
IdCuentaAtencion,IdVisita,IdVariable,VariableDato) values (
@IdCuentaAtencion,@IdVisita,@IdVariable,@VariableDato)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'Enfermeria_Variables'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VariablesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VariablesComboSeleccionarValores]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VariablesComboSeleccionarValores]
	@IdVariable [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM Enfermeria_CatalogoValoresCombo
WHERE IdVariable=@IdVariable
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VariablesComboSeleccionarValores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VariablesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_VariablesEliminar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Enfermeria_ValoresCombo where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
delete from Enfermeria_Variables where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'Enfermeria_Variables'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VariablesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VariablesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_VariablesModificar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdVariable [int],
	@VariableDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
IF (EXISTS (SELECT *  FROM Enfermeria_Variables WHERE IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita and IdVariable = @IdVariable))
	BEGIN
		UPDATE Enfermeria_Variables SET VariableDato = @VariableDato
		WHERE IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita and IdVariable = @IdVariable
	END
ELSE
	BEGIN
		 INSERT INTO Enfermeria_Variables (IdCuentaAtencion,IdVisita,IdVariable,VariableDato) values (@IdCuentaAtencion,@IdVisita,@IdVariable,@VariableDato)
	END


--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'Enfermeria_Variables'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VariablesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VariablesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VariablesSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from Enfermeria_Variables
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VariablesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VisitasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VisitasAgregar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@FechaHoraVisita [datetime],
	@IdServicio [int],
	@Observaciones [varchar](1000),
	@IdCama [int],
	@IdEmpleadoEnfermera [int],
	@IdUsuarioAuditoria [int],
	@IngresoValorizacion [bit]
WITH EXECUTE AS CALLER
AS
insert into Enfermeria_Visitas (
IdCuentaAtencion,IdVisita,FechaHoraVisita,IdServicio,Observaciones,IdCama,IdEmpleadoEnfermera,IngresoValorizacion) values (
@IdCuentaAtencion,@IdVisita,@FechaHoraVisita,@IdServicio,@Observaciones,@IdCama,@IdEmpleadoEnfermera,@IngresoValorizacion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'Enfermeria_Visitas'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VisitasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VisitasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Enfermeria_VisitasEliminar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Enfermeria_ValoresCombo where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
delete from Enfermeria_TratamientoDosis where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
delete from Enfermeria_Variables where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
delete from Enfermeria_Visitas where IdCuentaAtencion = @IdCuentaAtencion and IdVisita=@IdVisita
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'Enfermeria_Visitas'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VisitasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VisitasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VisitasModificar]
	@IdCuentaAtencion [int],
	@IdVisita [int],
	@FechaHoraVisita [datetime],
	@IdServicio [int],
	@Observaciones [varchar](1000),
	@IdCama [int],
	@IdEmpleadoEnfermera [int],
	@IdUsuarioAuditoria [int],
	@IngresoValorizacion [bit]
WITH EXECUTE AS CALLER
AS
update Enfermeria_Visitas
set
FechaHoraVisita = @FechaHoraVisita,
IdServicio = @IdServicio,
Observaciones = @Observaciones,
IdCama = @IdCama,
IdEmpleadoEnfermera = @IdEmpleadoEnfermera,
IngresoValorizacion=@IngresoValorizacion
where IdCuentaAtencion = @IdCuentaAtencion and IdVisita = @IdVisita
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'Enfermeria_Visitas'
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VisitasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Enfermeria_VisitasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Enfermeria_VisitasSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from Enfermeria_Visitas
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Enfermeria_VisitasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EnfermeriaCargarDatosPacientePorVisita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EnfermeriaCargarDatosPacientePorVisita]
	@IdCuentaAtencion [int],
	@IdVisita [int]
WITH EXECUTE AS CALLER
AS
SELECT     v.FechaHoraVisita, a.IdPaciente, a.IdCuentaAtencion, p.IdDocIdentidad, td.Descripcion AS DocIdentidad, p.NroDocumento,
                      v.IdCuentaAtencion AS NroCuenta, p.ApellidoPaterno, p.ApellidoMaterno, p.PrimerNombre, p.SegundoNombre, p.TercerNombre,
                      LTRIM(p.NroHistoriaClinica)+'(' + tn.Descripcion + ')' AS Historia, v.IdServicio, s.Nombre AS ServicioIngreso, v.IdCama, c.Codigo AS Cama,
                      v.Observaciones, v.IdEmpleadoEnfermera, e.ApellidoPaterno + ' ' + e.ApellidoMaterno + ' ' + e.Nombres AS Empleado, v.IngresoValorizacion,
                      a.IdEstado,p.NroHistoriaClinica
FROM         dbo.Enfermeria_Visitas AS v INNER JOIN
                      dbo.FacturacionCuentasAtencion AS a ON a.IdCuentaAtencion = v.IdCuentaAtencion INNER JOIN
                      dbo.Pacientes AS p ON a.IdPaciente = p.IdPaciente INNER JOIN
                      dbo.Servicios AS s ON v.IdServicio = s.IdServicio INNER JOIN
                      dbo.Empleados AS e ON v.IdEmpleadoEnfermera = e.IdEmpleado LEFT OUTER JOIN
                      dbo.Camas AS c ON v.IdCama = c.IdCama LEFT OUTER JOIN
                      dbo.TiposDocIdentidad AS td ON p.IdDocIdentidad = td.IdDocIdentidad LEFT OUTER JOIN
                      dbo.TiposNumeracionHistoria AS tn ON p.IdTipoNumeracion = tn.IdTipoNumeracion
where v.IdCuentaAtencion=@IdCuentaAtencion and v.IdVisita=@IdVisita

GO
ALTER AUTHORIZATION ON [dbo].[EnfermeriaCargarDatosPacientePorVisita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EnfermeriaCargarDatosVariablePorVisita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EnfermeriaCargarDatosVariablePorVisita]
	@IdCuentaAtencion [int],
	@IdVisita [int]
WITH EXECUTE AS CALLER
AS
select v.idvariable,c.tipo,v.variabledato
from enfermeria_variables v
inner join enfermeria_catalogovariables c on v.idvariable=c.idvariable
where v.IdCuentaAtencion=@IdCuentaAtencion and v.IdVisita=@IdVisita
GO
ALTER AUTHORIZATION ON [dbo].[EnfermeriaCargarDatosVariablePorVisita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EnfermeriaDatosComboPorVisita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EnfermeriaDatosComboPorVisita]
	@IdCuentaAtencion [int],
	@IdVisita [int]
WITH EXECUTE AS CALLER
AS
select * from enfermeria_valorescombo v
where v.IdCuentaAtencion=@IdCuentaAtencion and v.IdVisita=@IdVisita
GO
ALTER AUTHORIZATION ON [dbo].[EnfermeriaDatosComboPorVisita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EnvioCenares]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EnvioCenares]
WITH EXECUTE AS CALLER
AS
SELECT
	codigo_pre as cod_pre
	,tipsum as tip_sum
	,convert(varchar,periodo,112) as periodo
	,'' as cod_siga
	,codigo_med as cod_sismed
	,'' as cod_med
	,saldo
	--,round(precio_adquisicion,4) as precio
	,cast(PRECIO_ADQUISICION as numeric(16,4)) as precio
	,ingre as ingresos
	,FechaIngreso=''
	,'' as fec_ing
	,venta as st_sal1
	,vencido + merma as st_sal2
	,transf + distri as st_sal3
	,devol + dev_ven + dev_merma as st_sal4
	,credhosp + otr_conv + otras_sal + exo as st_sal5
	,sis as st_sal6
	,intersan as st_sal7
	,soat as st_sal8
	--,reingre,
	--,fac_perd, --no se usa
	--,defnac, --no se usa
	--,ventainst,--SAL1 (no hay)
	,total as t_salidas
	,stock_fin as stock_final
	--,convert(varchar,fec_exp,112) as fec_exp
	,case
		when convert(varchar,fec_exp,112)='19000101'then ''
		when convert(varchar,fec_exp,112) IS NULL then ''
		else convert(varchar,fec_exp,112)
	end as fec_exp
	,'' as lote
	,'' as reg_sanit
	,'ALFREDO VASQUEZ RUA' as resp_farm
	,'999060288' as telf_resp
	,'ALFREDO.VASQUEZ@HRAYACUCHO.GOB.PE' as mail_resp

FROM ICI_DIGEMID I
WHERE
	PERIODO = CONVERT(VARCHAR,GETDATE()-1,112)
	AND STOCK_FIN >= 0
	AND LEN(CODIGO_MED) = 5




GO
ALTER AUTHORIZATION ON [dbo].[EnvioCenares] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EPS_CPTfijosSolesSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EPS_CPTfijosSolesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from EPS_CPTfijosSoles
GO
ALTER AUTHORIZATION ON [dbo].[EPS_CPTfijosSolesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EquivalenciaCPT_SMIseleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EquivalenciaCPT_SMIseleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from EquivalenciaCPT_SMI
GO
ALTER AUTHORIZATION ON [dbo].[EquivalenciaCPT_SMIseleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCEAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCEAgregar]
	@IdProductoInterconsulta [int],
	@IdProductoConsulta [int],
	@TiempoPromedioAtencion [int],
	@IdEspecialidad [int],
	@IdEspecialidadCE [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EspecialidadCE (
IdProductoInterconsulta,IdProductoConsulta,TiempoPromedioAtencion,IdEspecialidad) values (
@IdProductoInterconsulta,@IdProductoConsulta,@TiempoPromedioAtencion,@IdEspecialidad)
set @IdEspecialidadCE = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEspecialidadCE,'EspecialidadCE'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCEAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCEEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCEEliminar]
	@IdEspecialidadCE [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EspecialidadCE
where IdEspecialidadCE = @IdEspecialidadCE
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEspecialidadCE,'EspecialidadCE'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCEEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCEModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCEModificar]
	@IdProductoInterconsulta [int],
	@IdProductoConsulta [int],
	@TiempoPromedioAtencion [int],
	@IdEspecialidad [int],
	@IdEspecialidadCE [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EspecialidadCE
set
IdProductoInterconsulta = @IdProductoInterconsulta,
IdProductoConsulta = @IdProductoConsulta,
TiempoPromedioAtencion = @TiempoPromedioAtencion,
IdEspecialidad = @IdEspecialidad
where IdEspecialidadCE = @IdEspecialidadCE
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEspecialidadCE,'EspecialidadCE'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCEModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCEseleccionarIdServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadCEseleccionarIdServicio]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.EspecialidadCE.*, dbo.Servicios.IdServicio
            FROM         dbo.EspecialidadCE FULL OUTER JOIN
                                  dbo.Servicios ON dbo.EspecialidadCE.IdEspecialidad = dbo.Servicios.IdEspecialidad
             WHERE dbo.Servicios.IdServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCEseleccionarIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCESeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCESeleccionarPorId]
	@IdEspecialidadCE [int]
WITH EXECUTE AS CALLER
AS
select * from EspecialidadCE
where IdEspecialidadCE = @IdEspecialidadCE
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCESeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCESeleccionarPorIdEspecialidad]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadCESeleccionarPorIdEspecialidad]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select * from EspecialidadCE
where IdEspecialidad = @IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCESeleccionarPorIdEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCESeleccionarPorIdServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCESeleccionarPorIdServicio]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.EspecialidadCE.*, dbo.Servicios.IdServicio,
                      dbo.FactCatalogoServicios.Codigo
FROM         dbo.EspecialidadCE LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.EspecialidadCE.IdProductoConsulta = dbo.FactCatalogoServicios.IdProducto FULL OUTER JOIN
                      dbo.Servicios ON dbo.EspecialidadCE.IdEspecialidad = dbo.Servicios.IdEspecialidad
             WHERE dbo.Servicios.IdServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCESeleccionarPorIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadCESeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadCESeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from EspecialidadCE
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadCESeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadesAgregar]
	@IdEspecialidad [int] OUTPUT,
	@Nombre [varchar](50),
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Especialidades (
Nombre,IdDepartamento) values (
@Nombre,@IdDepartamento)
set @IdEspecialidad = @@Identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEspecialidad,'Especialidades'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadesEliminar]
	@IdEspecialidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Especialidades
where IdEspecialidad = @IdEspecialidad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEspecialidad,'Especialidades'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesEstablecimientosExternos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesEstablecimientosExternos]
WITH EXECUTE AS CALLER
AS
SELECT IdEspecialidad, Nombre FROM Especialidades
 WHERE IdEspecialidad IN(select DISTINCT IdEspecialidad from servicios
 where IdServicio IN (SELECT DISTINCT IdServicio
 From HIS_ServEstablecimiento))
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesEstablecimientosExternos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select Especialidades.IdEspecialidad,  convert(varchar(5), Especialidades.IdEspecialidad) + " = "+ Especialidades.Nombre as DescripcionLarga, Especialidades.IdDepartamento, EspecialidadCE.TiempoPromedioAtencion,
         a.nombre as ProductoConsulta, b.Nombre as ProductoInterconsulta
         from (((Especialidades left join EspecialidadCE on Especialidades.idEspecialidad = EspecialidadCE.IdEspecialidad )
         left join factCatalogoServicios a on a.idproducto = EspecialidadCE.idproductoConsulta)
         left join factCatalogoServicios b on b.idproducto = EspecialidadCE.idproductoInterConsulta)  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadesModificar]
	@IdEspecialidad [int],
	@Nombre [varchar](50),
	@IdDepartamento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Especialidades
set
Nombre = @Nombre,
IdDepartamento = @IdDepartamento
where IdEspecialidad = @IdEspecialidad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEspecialidad,'Especialidades'
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarAsistenciales]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarAsistenciales]
WITH EXECUTE AS CALLER
AS
select Especialidades.IdEspecialidad, Especialidades.IdDepartamento,
Especialidades.Nombre as Especialidad ,
DepartamentosHospital.Nombre as Departamento
from DepartamentosHospital left join Especialidades
on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento
where DepartamentosHospital.IdDepartamento in ( 1,2,3,4,5)
order by DepartamentosHospital.Nombre , Especialidades.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarAsistenciales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarPorDepartamento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarPorDepartamento]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select IdEspecialidad, convert(varchar(5), IdEspecialidad) + ' = ' + Nombre as DescripcionLarga
--select IdEspecialidad, Nombre as DescripcionLarga
from 	Especialidades
where 	IdDepartamento = @IdDepartamento
--order by IdEspecialidad
order by Nombre
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarPorDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarPorDepartamentoV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarPorDepartamentoV2]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select a.IdEspecialidad, convert(varchar(5), a.IdEspecialidad) + ' = ' + a.Nombre as DescripcionLarga ,
a.IdDepartamento,b.TiempoPromedioAtencion,
c.nombre as ProductoConsulta, d.Nombre as ProductoInterconsulta
from 	Especialidades a, EspecialidadCE b,
factCatalogoServicios c, factCatalogoServicios d
where 	a.IdEspecialidad = b.IdEspecialidad
and c.idproducto = b.idproductoConsulta
and d.idproducto = b.idproductoInterConsulta
and	IdDepartamento = @IdDepartamento
order by a.IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarPorDepartamentoV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarPorFiltro]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
IF @FILTRO = ' '
	SET  @SQL =  'select * from Especialidades  ORDER BY Nombre'
ELSE
	SET  @SQL = 'select * from Especialidades where '  + @Filtro +  ' order by Nombre'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarPorId]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select * from Especialidades
where Especialidades.IdEspecialidad = @IdEspecialidad


--select * from Especialidades, EspecialidadCE
--where Especialidades.IdEspecialidad = @IdEspecialidad
--and Especialidades.IdEspecialidad = EspecialidadCE.IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarPorMedico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarPorMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
select Especialidades.IdEspecialidad,  Especialidades.Nombre, convert(varchar(5), Especialidades.IdEspecialidad) + ' = ' + Especialidades.Nombre as DescripcionLarga
from 	Especialidades left join MedicosEspecialidad on Especialidades.IdEspecialidad = MedicosEspecialidad.IdEspecialidad
where 	MedicosEspecialidad.IdMedico = @IdMedico
order by Especialidades.IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarPorMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarTodos]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
If @IdDepartamento > 0
        select IdEspecialidad,  convert(varchar(5), IdEspecialidad) + ' = ' + Nombre as DescripcionLarga, IdDepartamento    from Especialidades  where idDepartamento = @IdDepartamento order by IdDepartamento, Nombre
  else
        select IdEspecialidad,  convert(varchar(5), IdEspecialidad) + ' = ' + Nombre as DescripcionLarga, IdDepartamento    from Especialidades  order by IdDepartamento, Nombre
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSeleccionarXcodigoHIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesSeleccionarXcodigoHIS]
	@CodigoServicioHIS [varchar](6)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Especialidades.Nombre, dbo.Servicios.codigoServicioHIS
FROM         dbo.Servicios INNER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad
where  dbo.Servicios.codigoServicioHIS=@CodigoServicioHIS
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesSeleccionarXcodigoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesXidTipoServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesXidTipoServicio]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select distinct Especialidades.IdEspecialidad, Especialidades.Nombre,
                 convert(varchar(5), Especialidades.IdEspecialidad) + ' = ' + Especialidades.Nombre as DescripcionLarga
             from Especialidades inner join Servicios
                on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
             where Servicios.IdTipoServicio = @IdTipoServicio
             order by Especialidades.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesXidTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesXidTipoServicioIdDepartamento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EspecialidadesXidTipoServicioIdDepartamento]
	@IdTipoServicio [int],
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select Distinct Especialidades.IdEspecialidad, Especialidades.Nombre
             From
                (DepartamentosHospital inner join Especialidades on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento)
                 inner join Servicios on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
             where IdTipoServicio = @IdTipoServicio
               and DepartamentosHospital.IdDepartamento = @IdDepartamento
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadesXidTipoServicioIdDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EspecialidadMedicoValidaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EspecialidadMedicoValidaEliminar]
	@IdMedico [int],
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
DECLARE @NumApariciones int;
    DECLARE @ErrorNumber int;

    SET @NumApariciones = 0;
    SET @ErrorNumber = 0;

    SET @NumApariciones = (SELECT COUNT(1) FROM ProgramacionMedica WHERE IdEspecialidad = @IdEspecialidad AND IdMedico = @IdMedico);

    IF @NumApariciones = 0
    BEGIN
        SET @NumApariciones = (SELECT COUNT(1) FROM Atenciones WHERE IdEspecialidadMedico = @IdEspecialidad AND IdMedicoIngreso = @IdMedico);
        IF @NumApariciones > 0
        BEGIN
            SET @ErrorNumber = 2;
        END
    END
    ELSE
    BEGIN
        SET @ErrorNumber = 1;
    END;

    SELECT @ErrorNumber as ErrorNumber;
GO
ALTER AUTHORIZATION ON [dbo].[EspecialidadMedicoValidaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosAgregar]
	@IdEstablecimiento [int],
	@Codigo [varchar](6),
	@Nombre [varchar](150),
	@IdDistrito [int],
	@IdTipo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO Establecimientos (
IdEstablecimiento,Codigo,Nombre,IdDistrito,IdTipo) VALUES (
@IdEstablecimiento,@Codigo,@Nombre,@IdDistrito,@IdTipo)
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosDevuelveCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosDevuelveCodigo]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
select codigo from Establecimientos where idEstablecimiento=@IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosDevuelveCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosDevuelveUltimoID]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosDevuelveUltimoID]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 IdEstablecimiento
FROM         dbo.Establecimientos
ORDER BY IdEstablecimiento DESC
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosDevuelveUltimoID] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosEliminar]
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Establecimientos
where IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro=''
   SET  @SQL =  'select Establecimientos.IdEstablecimiento, Establecimientos.codigo, Establecimientos.Nombre,
                Distritos.Nombre as Distrito,  Provincias.Nombre as Provincia, Departamentos.Nombre as Departamento
                From
                ((Establecimientos left join Distritos on Establecimientos.IdDistrito = Distritos.IdDistrito)
                left join Provincias on Distritos.IdProvincia = Provincias.IdProvincia)
                left join Departamentos on Provincias.IdDepartamento = Departamentos.IdDepartamento  '
else
   SET  @SQL =  'select Establecimientos.IdEstablecimiento, Establecimientos.codigo, Establecimientos.Nombre,
                Distritos.Nombre as Distrito,  Provincias.Nombre as Provincia, Departamentos.Nombre as Departamento
                From
                ((Establecimientos left join Distritos on Establecimientos.IdDistrito = Distritos.IdDistrito)
                left join Provincias on Distritos.IdProvincia = Provincias.IdProvincia)
                left join Departamentos on Provincias.IdDepartamento = Departamentos.IdDepartamento  ' +  @lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ESTABLECIMIENTOSListaEstablecimientosMR]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ESTABLECIMIENTOSListaEstablecimientosMR]
WITH EXECUTE AS CALLER
AS
SELECT IdEstablecimiento, codigo, nombre as NombreEstablecimiento, 0 idestado
 FROM ESTABLECIMIENTOS
 WHERE IDESTABLECIMIENTO IN (SELECT DISTINCT IDESTABLECIMIENTO FROM HIS_ServEstablecimiento)
GO
ALTER AUTHORIZATION ON [dbo].[ESTABLECIMIENTOSListaEstablecimientosMR] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosModificar]
	@IdEstablecimiento [int],
	@Codigo [varchar](6),
	@Nombre [varchar](150),
	@IdDistrito [int],
	@IdTipo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE Establecimientos
SET
Codigo = @Codigo,
Nombre = @Nombre,
IdDistrito = @IdDistrito,
IdTipo = @IdTipo
WHERE IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaAgregar]
	@IdEstablecimientoNoMinsa [int] OUTPUT,
	@Nombre [varchar](150),
	@IdTipoSubsector [int],
	@IdDistrito [int],
	@codigo [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstablecimientosNoMinsa (
Nombre,IdTipoSubsector,IdDistrito,codigo) values (
@Nombre,@IdTipoSubsector,@IdDistrito,@codigo)
set @IdEstablecimientoNoMinsa = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstablecimientoNoMinsa,'EstablecimientosNoMinsa'
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaEliminar]
	@IdEstablecimientoNoMinsa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstablecimientosNoMinsa
where IdEstablecimientoNoMinsa = @IdEstablecimientoNoMinsa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstablecimientoNoMinsa,'EstablecimientosNoMinsa'
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

IF @lcFiltro<>''
   SET  @SQL =  'select EstablecimientosNoMinsa.IdEstablecimientoNoMinsa,  EstablecimientosNoMinsa.Nombre, TiposSubSector.Descripcion as SubSector,
                Distritos.Nombre as Distrito,  Provincias.Nombre as Provincia, Departamentos.Nombre as Departamento
                From
                (((EstablecimientosNoMinsa left join Distritos on EstablecimientosNoMinsa.IdDistrito = Distritos.IdDistrito)
                left join Provincias on Distritos.IdProvincia = Provincias.IdProvincia)
                left join Departamentos on Provincias.IdDepartamento = Departamentos.IdDepartamento)
                left join TiposSubSector on EstablecimientosNoMinsa.IdTipoSubSector = TiposSubSector.IdTipoSubSector  ' +  @lcFiltro
ELSE
   SET  @SQL =  'select EstablecimientosNoMinsa.IdEstablecimientoNoMinsa,  EstablecimientosNoMinsa.Nombre, TiposSubSector.Descripcion as SubSector,
                Distritos.Nombre as Distrito,  Provincias.Nombre as Provincia, Departamentos.Nombre as Departamento
                From
                (((EstablecimientosNoMinsa left join Distritos on EstablecimientosNoMinsa.IdDistrito = Distritos.IdDistrito)
                left join Provincias on Distritos.IdProvincia = Provincias.IdProvincia)
                left join Departamentos on Provincias.IdDepartamento = Departamentos.IdDepartamento)
                left join TiposSubSector on EstablecimientosNoMinsa.IdTipoSubSector = TiposSubSector.IdTipoSubSector  '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaModificar]
	@IdEstablecimientoNoMinsa [int],
	@Nombre [varchar](150),
	@IdTipoSubsector [int],
	@IdDistrito [int],
	@codigo [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstablecimientosNoMinsa
set
Nombre = @Nombre,
IdTipoSubsector = @IdTipoSubsector,
IdDistrito = @IdDistrito,
codigo=@codigo
where IdEstablecimientoNoMinsa = @IdEstablecimientoNoMinsa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstablecimientoNoMinsa,'EstablecimientosNoMinsa'
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaSeleccionarPorCodigo]
	@Codigo [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @CodigoFormat Varchar (60)

	SET @CodigoFormat =  RIGHT('0000000000' + LTRIM(RTRIM(@Codigo)), 10)

	SELECT * from EstablecimientosNoMinsa where RIGHT('0000000000' + LTRIM(RTRIM(Codigo)), 10) = @CodigoFormat
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaSeleccionarPorId]
	@IdEstablecimientoNoMinsa [int]
WITH EXECUTE AS CALLER
AS
select * from EstablecimientosNoMinsa
where IdEstablecimientoNoMinsa = @IdEstablecimientoNoMinsa
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstablecimientoNoMinsa, Nombre,
(Convert(varchar(5), IdEstablecimientoNoMinsa) + ' = ' + Nombre) as DescripcionLarga
 from EstablecimientosNoMinsa
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosNoMinsaXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosNoMinsaXidentificador]
	@idEstablecimientoNoMinsa [int]
WITH EXECUTE AS CALLER
AS
select * from EstablecimientosNoMinsa where idEstablecimientoNoMinsa=@idEstablecimientoNoMinsa
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosNoMinsaXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosPorIdUsuario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosPorIdUsuario]
	@IdUsuario [int]
WITH EXECUTE AS CALLER
AS
Select D.IdDepartamento, D.Nombre as NombreDepartamento,
 P.IdProvincia, P.Nombre as NombreProvincia,
 DS.IdDistrito, DS.Nombre as NombreDistrito,
 E.IdEstablecimiento, E.Codigo, E.Nombre as NombreEstablecimiento
 from Departamentos D inner join Provincias P
 on D.IdDepartamento = P.IdDepartamento inner join Distritos DS
 on P.IdProvincia = DS.IdProvincia inner join Establecimientos E
 on DS.IdDistrito = E.IdDistrito
 Where E.IdEstablecimiento = (Select IdEstablecimientoExterno from Empleados where IdEmpleado = @IdUsuario)
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosPorIdUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosSeleccionarPorFiltro]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from establecimientos where '  + @Filtro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosSeleccionarPorId]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
select * from Establecimientos
where IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosSeleccionarTodoCamposXCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosSeleccionarTodoCamposXCodigo]
	@Codigo [varchar](6)
WITH EXECUTE AS CALLER
AS
select * from establecimientos where codigo=@Codigo
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosSeleccionarTodoCamposXCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from establecimientos order by idEstablecimiento desc
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosSinRENAESenSIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosSinRENAESenSIS]
WITH EXECUTE AS CALLER
AS
SELECT      sigh_sis.dbo.m_eess.pre_CodigoRENAES, sigh_sis.dbo.m_eess.pre_Nombre, dbo.Establecimientos.Codigo,
                      dbo.Establecimientos.Nombre, sigh_sis.dbo.m_eess.pre_IdCategoriaEESS, sigh_sis.dbo.m_eess.pre_IdUbigeo
FROM         dbo.Establecimientos RIGHT OUTER JOIN
                      sigh_sis.dbo.m_eess ON LEFT(dbo.Establecimientos.Codigo, 5) = RIGHT(sigh_sis.dbo.m_eess.pre_CodigoRENAES, 5) COLLATE SQL_Latin1_General_CP1_CI_AS
WHERE     (dbo.Establecimientos.Codigo IS NULL) AND (sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '01' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '02' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '03' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '04' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '05' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '06' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '07' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '08' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '11' OR
                      sigh_sis.dbo.m_eess.pre_IdCategoriaEESS = '12')
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosSinRENAESenSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosXcodigo]
	@codigo [varchar](6)
WITH EXECUTE AS CALLER
AS
select Establecimientos.IdEstablecimiento from Establecimientos where Establecimientos.Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosXid]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosXid]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
Select IdEstablecimiento, Codigo, nombre
 from Establecimientos E
 where E.IdEstablecimiento =@IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosXid] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstablecimientosXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstablecimientosXidentificador]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT * From Establecimientos WHERE  IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstablecimientosXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosAtencionAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosAtencionAgregar]
	@Descripcion [varchar](20),
	@IdEstadoAtencion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstadosAtencion (
Descripcion) values (
@Descripcion)
set @IdEstadoAtencion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstadoAtencion,'EstadosAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosAtencionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosAtencionEliminar]
	@IdEstadoAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstadosAtencion
where IdEstadoAtencion = @IdEstadoAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstadoAtencion,'EstadosAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosAtencionModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosAtencionModificar]
	@Descripcion [varchar](20),
	@IdEstadoAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstadosAtencion
set
Descripcion = @Descripcion
where IdEstadoAtencion = @IdEstadoAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstadoAtencion,'EstadosAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosAtencionSeleccionarPorId]
	@IdEstadoAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from EstadosAtencion
where IdEstadoAtencion = @IdEstadoAtencion
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosAtencionSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosAtencionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoAtencion, Descripcion from EstadosAtencion
GO
ALTER AUTHORIZATION ON [dbo].[EstadosAtencionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCamaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCamaAgregar]
	@Descripcion [varchar](50),
	@IdEstadoCama [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstadosCama (
Descripcion) values (
@Descripcion)
set @IdEstadoCama = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCamaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCamaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCamaEliminar]
	@IdEstadoCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstadosCama
where IdEstadoCama = @IdEstadoCama
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCamaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCamaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCamaModificar]
	@Descripcion [varchar](50),
	@IdEstadoCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstadosCama
set
Descripcion = @Descripcion
where IdEstadoCama = @IdEstadoCama
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCamaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCamaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCamaSeleccionarPorId]
	@IdEstadoCama [int]
WITH EXECUTE AS CALLER
AS
select * from EstadosCama
where IdEstadoCama = @IdEstadoCama
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCamaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCamaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosCamaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoCama, Descripcion,
(Convert(varchar(5), IdEstadoCama) + ' = ' + Descripcion) as DescripcionLarga
 from EstadosCama
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCamaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCuentaAgregar]
	@Descripcion [varchar](50),
	@IdEstado [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstadosCuenta (
Descripcion) values (
@Descripcion)
set @IdEstado = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstado,'EstadosCuenta'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosCuentaDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from EstadosCuenta order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCuentaEliminar]
	@IdEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstadosCuenta
where IdEstado = @IdEstado
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstado,'EstadosCuenta'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCuentaModificar]
	@Descripcion [varchar](50),
	@IdEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstadosCuenta
set
Descripcion = @Descripcion
where IdEstado = @IdEstado
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstado,'EstadosCuenta'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosCuentaSeleccionarPorId]
	@IdEstado [int]
WITH EXECUTE AS CALLER
AS
select * from EstadosCuenta
where IdEstado = @IdEstado
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosCuentaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosCuentaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstado, Descripcion,
(Convert(varchar(5), IdEstado) + ' = ' + Descripcion) as DescripcionLarga
 from EstadosCuenta
GO
ALTER AUTHORIZATION ON [dbo].[EstadosCuentaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosFacturacionObtenerDescripcionPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosFacturacionObtenerDescripcionPorId]
	@IdEstadoFacturacion [int]
WITH EXECUTE AS CALLER
AS
Select Descripcion From EstadosFacturacion where IdEstadoFacturacion = @IdEstadoFacturacion
GO
ALTER AUTHORIZATION ON [dbo].[EstadosFacturacionObtenerDescripcionPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosFacturacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosFacturacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoFacturacion, descripcion from EstadosFacturacion
GO
ALTER AUTHORIZATION ON [dbo].[EstadosFacturacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosFacturacionSeleccionarTodosExceptoPagado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosFacturacionSeleccionarTodosExceptoPagado]
WITH EXECUTE AS CALLER
AS
select IdEstadoFacturacion, descripcion from EstadosFacturacion where IdEstadoFacturacion <> 4
GO
ALTER AUTHORIZATION ON [dbo].[EstadosFacturacionSeleccionarTodosExceptoPagado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosHistoriaClinicaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosHistoriaClinicaAgregar]
	@Descripcion [varchar](50),
	@IdEstadoHistoria [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstadosHistoriaClinica (
Descripcion) values (
@Descripcion)
set @IdEstadoHistoria = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosHistoriaClinicaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosHistoriaClinicaEliminar]
	@IdEstadoHistoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstadosHistoriaClinica
where IdEstadoHistoria = @IdEstadoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosHistoriaClinicaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosHistoriaClinicaModificar]
	@Descripcion [varchar](50),
	@IdEstadoHistoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstadosHistoriaClinica
set
Descripcion = @Descripcion
where IdEstadoHistoria = @IdEstadoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosHistoriaClinicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosHistoriaClinicaSeleccionarPorId]
	@IdEstadoHistoria [int]
WITH EXECUTE AS CALLER
AS
select * from EstadosHistoriaClinica
where IdEstadoHistoria = @IdEstadoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosHistoriaClinicaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EstadosHistoriaClinicaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoHistoria, Descripcion,
(Convert(varchar(5), IdEstadoHistoria) + ' = ' + Descripcion) as DescripcionLarga
 from EstadosHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[EstadosHistoriaClinicaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosMovimientoHistoriaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosMovimientoHistoriaAgregar]
	@Descripcion [varchar](50),
	@IdEstadoMovimiento [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstadosMovimientoHistoria (
Descripcion) values (
@Descripcion)
set @IdEstadoMovimiento = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstadoMovimiento,'EstadosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosMovimientoHistoriaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosMovimientoHistoriaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosMovimientoHistoriaEliminar]
	@IdEstadoMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstadosMovimientoHistoria
where IdEstadoMovimiento = @IdEstadoMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstadoMovimiento,'EstadosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosMovimientoHistoriaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosMovimientoHistoriaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosMovimientoHistoriaModificar]
	@Descripcion [varchar](50),
	@IdEstadoMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstadosMovimientoHistoria
set
Descripcion = @Descripcion
where IdEstadoMovimiento = @IdEstadoMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstadoMovimiento,'EstadosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[EstadosMovimientoHistoriaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstadosMovimientoHistoriaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstadosMovimientoHistoriaSeleccionarPorId]
	@IdEstadoMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from EstadosMovimientoHistoria
where IdEstadoMovimiento = @IdEstadoMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[EstadosMovimientoHistoriaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstanciaHospitalariaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstanciaHospitalariaAgregar]
	@IdFacturacionServicio [int],
	@IdMedicoOrdena [int],
	@IdCuentaAtencion [int],
	@DiasEstancia [money],
	@IdCama [int],
	@IdServicio [int],
	@HoraDesocupacion [char](5),
	@FechaDesocupacion [datetime],
	@HoraOcupacion [char](5),
	@FechaOcupacion [datetime],
	@Secuencia [int],
	@IdEstanciaHospitalaria [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into EstanciaHospitalaria (
IdFacturacionServicio,IdMedicoOrdena,IdCuentaAtencion,DiasEstancia,IdCama,IdServicio,HoraDesocupacion,FechaDesocupacion,HoraOcupacion,FechaOcupacion,Secuencia) values (
@IdFacturacionServicio,@IdMedicoOrdena,@IdCuentaAtencion,@DiasEstancia,@IdCama,@IdServicio,@HoraDesocupacion,@FechaDesocupacion,@HoraOcupacion,@FechaOcupacion,@Secuencia)
set @IdEstanciaHospitalaria = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstanciaHospitalaria,'EstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[EstanciaHospitalariaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstanciaHospitalariaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstanciaHospitalariaEliminar]
	@IdEstanciaHospitalaria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from EstanciaHospitalaria
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstanciaHospitalaria,'EstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[EstanciaHospitalariaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstanciaHospitalariaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstanciaHospitalariaModificar]
	@IdFacturacionServicio [int],
	@IdMedicoOrdena [int],
	@IdCuentaAtencion [int],
	@DiasEstancia [money],
	@IdCama [int],
	@IdServicio [int],
	@HoraDesocupacion [char](5),
	@FechaDesocupacion [datetime],
	@HoraOcupacion [char](5),
	@FechaOcupacion [datetime],
	@Secuencia [int],
	@IdEstanciaHospitalaria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update EstanciaHospitalaria
set
IdFacturacionServicio = @IdFacturacionServicio,
IdMedicoOrdena = @IdMedicoOrdena,
IdCuentaAtencion = @IdCuentaAtencion,
DiasEstancia = @DiasEstancia,
IdCama = @IdCama,
IdServicio = @IdServicio,
HoraDesocupacion = @HoraDesocupacion,
FechaDesocupacion = @FechaDesocupacion,
HoraOcupacion = @HoraOcupacion,
FechaOcupacion = @FechaOcupacion,
Secuencia = @Secuencia
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstanciaHospitalaria,'EstanciaHospitalaria'
GO
ALTER AUTHORIZATION ON [dbo].[EstanciaHospitalariaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstanciaHospitalariaSeleccionarPorAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstanciaHospitalariaSeleccionarPorAtencion]
	@IdAtencion [int],
	@SecuenciaMayorA [int]
WITH EXECUTE AS CALLER
AS
SELECT
		AtencionesEstanciaHospitalaria.IdServicio,
		AtencionesEstanciaHospitalaria.FechaOcupacion,
		AtencionesEstanciaHospitalaria.HoraOcupacion,
		AtencionesEstanciaHospitalaria.IdCama,
		AtencionesEstanciaHospitalaria.LlegoAlServicio,
		AtencionesEstanciaHospitalaria.IdEstanciaHospitalaria,
		AtencionesEstanciaHospitalaria.Secuencia,
		Camas.Codigo as CodigoCama,
		Servicios.Codigo as CodigoServicio,
		Servicios.Nombre as NombreServicio,
		AtencionesEstanciaHospitalaria.IdMedicoOrdena as IdMedicoOrdena,
		Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres as NombreMedico,
		AtencionesEstanciaHospitalaria.IdMedicoOrdenaOrigen as IdMedicoOrdenaOrigen,
		(SELECT Empleados.ApellidoPaterno + ' ' + Empleados.ApellidoMaterno + ' ' + Empleados.Nombres
			FROM Medicos
				LEFT JOIN Empleados ON Medicos.IdEmpleado = Empleados.IdEmpleado
			WHERE Medicos.IdMedico = AtencionesEstanciaHospitalaria.IdMedicoOrdenaOrigen) as NombreMedicoOrigen,
                Servicios.codigoServicioSEM,Servicios.EsObservacionEmergencia
	from (((AtencionesEstanciaHospitalaria left join Servicios on AtencionesEstanciaHospitalaria.IdServicio = Servicios.IdServicio)
	left join Medicos on AtencionesEstanciaHospitalaria.IdMedicoOrdena = Medicos.IdMedico)
	left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
	left join Camas on AtencionesEstanciaHospitalaria.IdCama = Camas.IdCama
	where
	AtencionesEstanciaHospitalaria.IdAtencion = @IdAtencion
	and Secuencia > @SecuenciaMayorA
	order by secuencia
GO
ALTER AUTHORIZATION ON [dbo].[EstanciaHospitalariaSeleccionarPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EstanciaHospitalariaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[EstanciaHospitalariaSeleccionarPorId]
	@IdEstanciaHospitalaria [int]
WITH EXECUTE AS CALLER
AS
select * from EstanciaHospitalaria
where IdEstanciaHospitalaria = @IdEstanciaHospitalaria
GO
ALTER AUTHORIZATION ON [dbo].[EstanciaHospitalariaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[EtniaHISseleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[EtniaHISseleccionarTodos]
WITH EXECUTE AS CALLER
AS
select *,left(desetni,10) as dCorto  from HIS_tabEtnia
order by desetni
GO
ALTER AUTHORIZATION ON [dbo].[EtniaHISseleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ExportaPreciosSismed]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ExportaPreciosSismed]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoBienesInsumos.*, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario AS precioVenta
FROM          dbo.FactCatalogoBienesInsumos INNER JOIN
                    dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
WHERE     (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1)
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ExportaPreciosSismed] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ExportaPreciosSismedFecha]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ExportaPreciosSismedFecha]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 FechaHora
FROM         dbo.Auditoria
WHERE     (idListItem = 803) AND (IdRegistro = @idProducto)
ORDER BY FechaHora DESC
GO
ALTER AUTHORIZATION ON [dbo].[ExportaPreciosSismedFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ExportaPreciosSismedRegSant]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ExportaPreciosSismedRegSant]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 dbo.farmMovimientoDetalle.RegistroSanitario,dbo.farmMovimiento.fechaCreacion
FROM         dbo.farmMovimientoDetalle INNER JOIN
                    dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
                    dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)
          AND (dbo.farmMovimientoDetalle.idProducto = @idProducto)
          AND (dbo.farmMovimientoDetalle.MovTipo = 'E')
          AND (NOT (dbo.farmMovimientoDetalle.RegistroSanitario IS NULL))
ORDER BY dbo.farmMovimiento.fechaCreacion DESC
GO
ALTER AUTHORIZATION ON [dbo].[ExportaPreciosSismedRegSant] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacAtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacAtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta]
	@ldFechaIni [datetime],
	@ldFechaFin [datetime],
	@IdFuenteFinanciamiento [int],
	@idEstadoCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                                      dbo.FacturacionCuentasAtencion.IdEstado AS DestadoCta
                FROM         dbo.Atenciones INNER JOIN
                                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
              WHERE       dbo.Atenciones.idFuenteFinanciamiento=@IdFuenteFinanciamiento    and
                          dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaIngreso Between CONVERT(DATETIME,@ldFechaIni,103) and CONVERT(DATETIME,@ldFechaFin,103) and
                        dbo.Atenciones.idTipoServicio>1 and (dbo.Atenciones.fechaEgreso is null)
GO
ALTER AUTHORIZATION ON [dbo].[FacAtencionesSeleccionarPorFuenteFinanciamientoFingresoSinAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacConsultaReembolsosxIdCuentaAtencionFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacConsultaReembolsosxIdCuentaAtencionFarmacia]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FactReembolsos.*, dbo.FacturacionReembolsos.idCuentaAtencion
FROM    dbo.FactReembolsos LEFT OUTER JOIN
dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
WHERE dbo.FactReembolsos.idTipoConsumo=2 and dbo.FactReembolsos.idEstadoReembolso=1
and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacConsultaReembolsosxIdCuentaAtencionFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacConsultaReembolsosxIdCuentaAtencionServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacConsultaReembolsosxIdCuentaAtencionServicio]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FactReembolsos.*, dbo.FacturacionReembolsos.idCuentaAtencion
FROM    dbo.FactReembolsos LEFT OUTER JOIN
dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
WHERE dbo.FactReembolsos.idTipoConsumo=1 and dbo.FactReembolsos.idEstadoReembolso=1
and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacConsultaReembolsosxIdCuentaAtencionServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoFarmacia]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FactReembolsos.*, dbo.FacturacionReembolsos.idCuentaAtencion
FROM    dbo.FactReembolsos LEFT OUTER JOIN
 dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
WHERE dbo.FactReembolsos.idTipoConsumo=2 and dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoServicio]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FactReembolsos.*, dbo.FacturacionReembolsos.idCuentaAtencion
FROM    dbo.FactReembolsos LEFT OUTER JOIN
dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
WHERE dbo.FactReembolsos.idTipoConsumo=1 and dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacConsultarFacturacionReembolsosXidFactReembolsoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacDesagregaCuentasItemsXServHosp]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacDesagregaCuentasItemsXServHosp]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentasDetalle.MovNumero,
            dbo.farmMovimientoVentasDetalle.MovTipo, dbo.farmMovimientoVentasDetalle.idProducto, dbo.FactCatalogoBienesInsumos.Codigo,
            dbo.FactCatalogoBienesInsumos.Nombre, dbo.FactCatalogoBienesInsumos.IdPartida, dbo.farmMovimientoVentasDetalle.cantidad,
            dbo.farmMovimientoVentasDetalle.precio, dbo.farmMovimientoVentasDetalle.total, dbo.farmMovimiento.idEstadoMovimiento,
            dbo.farmMovimiento.fechaCreacion
FROM         dbo.farmMovimientoVentasDetalle LEFT OUTER JOIN
            dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
            dbo.farmMovimientoVentas ON dbo.farmMovimientoVentasDetalle.MovNumero = dbo.farmMovimientoVentas.movNumero AND
            dbo.farmMovimientoVentasDetalle.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
            dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
            dbo.farmMovimientoVentas.MovTipo = dbo.farmMovimiento.MovTipo
Where (dbo.farmMovimiento.idEstadoMovimiento = 1) And (dbo.farmMovimientoVentas.idCuentaAtencion =@IdCuentaAtencion)
GO
ALTER AUTHORIZATION ON [dbo].[FacDesagregaCuentasItemsXServHosp] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacFactReembolsosPoridFactReembolso]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacFactReembolsosPoridFactReembolso]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.FactReembolsos.*, dbo.FacturacionReembolsos.idCuentaAtencion
                                FROM     dbo.FactReembolsos LEFT OUTER JOIN
                                               dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
                                WHERE  dbo.FactReembolsos.idTipoConsumo=2 and dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FacturacionReembolsos.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacFactReembolsosPoridFactReembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosActualizaCentroCostoXcentroCosto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosActualizaCentroCostoXcentroCosto]
	@IdCentroCosto [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoBienesInsumos set IdCentroCosto=null where IdCentroCosto=@IdCentroCosto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosActualizaCentroCostoXcentroCosto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosActualizarESPAQUETE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosActualizarESPAQUETE]
	@IdProducto [int],
	@esPaquete [bit]
WITH EXECUTE AS CALLER
AS
update  factCatalogoBienesInsumos set esPaquete=@esPaquete  where IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosActualizarESPAQUETE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosActualizarIdTipoSalidaBienInsumo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosActualizarIdTipoSalidaBienInsumo]
	@IdProducto [int],
	@IdTipoSalidaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
update  factCatalogoBienesInsumos set idTipoSalidaBienInsumo=@IdTipoSalidaBienInsumo  where IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosActualizarIdTipoSalidaBienInsumo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosAgregar]
	@IdCentroCosto [int],
	@IdPartida [int],
	@IdSubGrupoFarmacologico [int],
	@IdGrupoFarmacologico [int],
	@NombreComercial [varchar](50),
	@Nombre [varchar](250),
	@Codigo [varchar](20),
	@IdProducto [int] OUTPUT,
	@IdUsuarioAuditoria [int],
	@PrecioCompra [money],
	@PrecioDistribucion [money],
	@PrecioDonacion [money],
	@PrecioUltCompra [money],
	@idTipoSalidaBienInsumo [int],
	@StockMinimo [int],
	@TipoProducto [int],
	@Denominacion [varchar](100),
	@Concentracion [varchar](100),
	@Presentacion [varchar](100),
	@FormaFarmaceutica [varchar](10),
	@MaterialEnvase [varchar](100),
	@PresentacionEnvase [varchar](100),
	@Fabricante [varchar](100),
	@IdPaisOrigen [int],
	@Petitorio [bit],
	@TipoProductoSismed [varchar](1),
	@codigoSUNAT [varchar](20)
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoBienesInsumos (
IdCentroCosto,IdPartida,IdSubGrupoFarmacologico,IdGrupoFarmacologico,NombreComercial,Nombre,Codigo,PrecioCompra,PrecioDistribucion,PrecioDonacion,idTipoSalidaBienInsumo,PrecioUltCompra,StockMinimo,TipoProducto,
Denominacion ,Concentracion ,Presentacion ,FormaFarmaceutica ,MaterialEnvase ,PresentacionEnvase ,Fabricante ,IdPaisOrigen,Petitorio ,TipoProductoSismed,codigoSUNAT
) values (
@IdCentroCosto,@IdPartida,@IdSubGrupoFarmacologico,@IdGrupoFarmacologico,@NombreComercial,@Nombre,@Codigo,@PrecioCompra,@PrecioDistribucion,@PrecioDonacion,@idTipoSalidaBienInsumo,@PrecioUltCompra,@StockMinimo,@TipoProducto,
@Denominacion ,@Concentracion ,@Presentacion ,@FormaFarmaceutica ,@MaterialEnvase ,@PresentacionEnvase ,@Fabricante ,@IdPaisOrigen ,@Petitorio,@TipoProductoSismed,@codigoSUNAT
)
set @IdProducto = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosEliminar]
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoBienesInsumosHosp where IdProducto = @IdProducto
delete from FactCatalogoBienesInsumos where IdProducto = @IdProducto

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdProducto,'FactCatalogoBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoBase]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoBase]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdSubGrupoFarmacologico, 0 as IdProducto, '' as Codigo, Descripcion from FactInsumosSubGrupoFarmacologico'


   SET  @SQL2 =  'select FactCatalogoBienesInsumos.IdSubGrupoFarmacologico,
		 FactCatalogoBienesInsumos.IdProducto,
		 FactCatalogoBienesInsumos.Codigo,
		 FactCatalogoBienesInsumos.Nombre,
		 FactCatalogoBienesInsumosHosp.PrecioUnitario,
		 FactCatalogoBienesInsumosHosp.Activo
		 From FactCatalogoBienesInsumosHosp, FactCatalogoBienesInsumos
		 Where " + _
		 FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = '+@lTipoCatalogo +'
		 and FactCatalogoBienesInsumosHosp.IdProducto = FactCatalogoBienesInsumos.IdProducto '+@lcFiltro



   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '}  AS title_chap RELATE IdSubGrupoFarmacologico TO IdSubGrupoFarmacologico)'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoBase] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoDEBB]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoDEBB]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
    SET  @SQL1 =  'select IdSubGrupoFarmacologico, 0 as IdProducto, '' as Codigo, Descripcion from FactInsumosSubGrupoFarmacologico'

     SET  @SQL2 =  'select FactCatalogoBienesInsumos.IdSubGrupoFarmacologico,
     FactCatalogoBienesInsumos.IdProducto,
     FactCatalogoBienesInsumos.Codigo,
     FactCatalogoBienesInsumos.Nombre,
     FactCatalogoBienesInsumosHosp.PrecioUnitario,
     FactCatalogoBienesInsumosHosp.Activo,
     FactCatalogoBienesInsumos.PrecioCompra, FactCatalogoBienesInsumos.PrecioUltCompra,
     FactCatalogoBienesInsumos.PrecioDistribucion, FactCatalogoBienesInsumos.PrecioDonacion,
     FactCatalogoBienesInsumosHosp.idPlanCatalogo
     From FactCatalogoBienesInsumosHosp, FactCatalogoBienesInsumos
     Where
     FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = '+@lTipoCatalogo+'
     and FactCatalogoBienesInsumosHosp.IdProducto = FactCatalogoBienesInsumos.IdProducto  '+@lcFiltro


   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '} AS title_chap RELATE IdSubGrupoFarmacologico TO IdSubGrupoFarmacologico)'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoDEBB] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoFiltrarCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoFiltrarCatalogo]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdSubGrupoFarmacologico, 0 as IdProducto, " " as Codigo, Descripcion from FactInsumosSubGrupoFarmacologico'

  /* SET  @SQL1 =  'select IdSubGrupoFarmacologico, 0 as IdProducto,  Descripcion from FactInsumosSubGrupoFarmacologico'*/

          SET  @SQL2 =  'select IdSubGrupoFarmacologico, IdProducto, Codigo, Nombre, 0 as PrecioUnitario, 1 as Activo from FactCatalogoBienesInsumos  '+@lcFiltro

   set  @sql='SHAPE { ' + @SQL1 + ' }    APPEND ({ ' + @SQL2 + ' }  AS title_chap RELATE IdSubGrupoFarmacologico TO IdSubGrupoFarmacologico) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosFiltrarCatalogoFiltrarCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospActualizaPrecio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospActualizaPrecio]
	@idProducto [int],
	@idTipoFinanciamiento [int],
	@precio [money]
WITH EXECUTE AS CALLER
AS
UPDATE FactCatalogoBienesInsumosHosp SET PrecioUnitario =@precio where idProducto=@idProducto and
                                                                  idTipoFinanciamiento=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospActualizaPrecio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospAgregar]
	@IdPlanCatalogo [int] OUTPUT,
	@PrecioUnitario [money],
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@Activo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoBienesInsumosHosp (
PrecioUnitario,IdProducto,IdTipoFinanciamiento,Activo) values (
@PrecioUnitario,@IdProducto,@IdTipoFinanciamiento,@Activo)
set @IdPlanCatalogo = @@identity
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPlanCatalogo,'FactCatalogoBienesInsumosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospEliminar]
	@IdPlanCatalogo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoBienesInsumosHosp
where IdPlanCatalogo = @IdPlanCatalogo
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPlanCatalogo,'FactCatalogoBienesInsumosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospModificar]
	@IdPlanCatalogo [int],
	@PrecioUnitario [money],
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@Activo [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoBienesInsumosHosp
set
PrecioUnitario = @PrecioUnitario,
IdProducto = @IdProducto,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
Activo = @Activo
where IdPlanCatalogo = @IdPlanCatalogo
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPlanCatalogo,'FactCatalogoBienesInsumosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorId]
	@IdPlanCatalogo [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumosHosp
where IdPlanCatalogo = @IdPlanCatalogo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorTipoCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorTipoCatalogo]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [varchar](20)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select IdProducto, Codigo, Nombre from FactCatalogoBienesInsumos where IdProducto not in (
    select IdProducto From FactCatalogoBienesInsumosHosp
    where IdTipoFinanciamiento = '+@lTipoCatalogo+') '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospSeleccionarPorTipoCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospXfiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospXfiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from FactCatalogoBienesInsumosHosp where ' + @Filtro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosHospXidTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosHospXidTipoFinanciamiento]
	@idProducto [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumosHosp
         where idProducto = @idProducto
        and idTipoFinanciamiento = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosHospXidTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosModificar]
	@IdCentroCosto [int],
	@IdPartida [int],
	@IdSubGrupoFarmacologico [int],
	@IdGrupoFarmacologico [int],
	@NombreComercial [varchar](50),
	@Nombre [varchar](250),
	@Codigo [varchar](20),
	@IdProducto [int],
	@IdUsuarioAuditoria [int],
	@PrecioCompra [money],
	@PrecioDistribucion [money],
	@PrecioDonacion [money],
	@PrecioUltCompra [money],
	@idTipoSalidaBienInsumo [int],
	@StockMinimo [int],
	@TipoProducto [int],
	@Denominacion [varchar](100),
	@Concentracion [varchar](100),
	@Presentacion [varchar](100),
	@FormaFarmaceutica [varchar](10),
	@MaterialEnvase [varchar](100),
	@PresentacionEnvase [varchar](100),
	@Fabricante [varchar](100),
	@IdPaisOrigen [int],
	@Petitorio [bit],
	@TipoProductoSismed [varchar](1),
	@codigoSUNAT [varchar](20)
WITH EXECUTE AS CALLER
AS
update FactCatalogoBienesInsumos
set
IdCentroCosto = @IdCentroCosto,
IdPartida = @IdPartida,
IdSubGrupoFarmacologico = @IdSubGrupoFarmacologico,
IdGrupoFarmacologico = @IdGrupoFarmacologico,
NombreComercial = @NombreComercial,
Nombre = @Nombre,
Codigo = @Codigo,
PrecioCompra=@PrecioCompra,
PrecioDistribucion=@PrecioDistribucion,
PrecioDonacion=@PrecioDonacion,
PrecioUltCompra=@PrecioUltCompra,
idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo,
StockMinimo=@StockMinimo,
TipoProducto=@TipoProducto,
Denominacion=@Denominacion,
Concentracion=@Concentracion ,
Presentacion=@Presentacion ,
FormaFarmaceutica=@FormaFarmaceutica ,
MaterialEnvase=@MaterialEnvase ,
PresentacionEnvase=@PresentacionEnvase ,
Fabricante=@Fabricante ,
IdPaisOrigen=@IdPaisOrigen,
Petitorio=@Petitorio,
TipoProductoSismed=@TipoProductoSismed,
codigoSUNAT=@codigoSUNAT
where IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarBienesLike]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarBienesLike]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select  DISTINCT FactCatalogoBienesInsumos.IdProducto,
            FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre,
            FactCatalogoBienesInsumosHosp.PrecioUnitario , FactCatalogoBienesInsumosHosp.Activo,
            FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,FactCatalogoBienesInsumos.esPaquete
             From
             (FactCatalogoBienesInsumos left join FactCatalogoBienesInsumosHosp
             on FactCatalogoBienesInsumos.IdProducto = FactCatalogoBienesInsumosHosp.IdProducto)
             left join FactPuntosCargaBienesInsumos
             on FactCatalogoBienesInsumos.IdSubGrupoFarmacologico = FactPuntosCargaBienesInsumos.IdSubGrupoFarmacologico
             where FactCatalogoBienesInsumosHosp.Activo = 1 '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarBienesLike] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarPorCodigo]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select FactCatalogoBienesInsumos.IdProducto,
            FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre as nombreProducto,
            FactCatalogoBienesInsumosHosp.PrecioUnitario , FactCatalogoBienesInsumosHosp.Activo,
            FactCatalogoBienesInsumos.idTipoSalidaBienInsumo ,FactCatalogoBienesInsumos.TipoProducto,
            FactCatalogoBienesInsumos.esPaquete
             From
             (FactCatalogoBienesInsumos left join FactCatalogoBienesInsumosHosp
             on FactCatalogoBienesInsumos.IdProducto = FactCatalogoBienesInsumosHosp.IdProducto)
             left join FactPuntosCargaBienesInsumos
             on FactCatalogoBienesInsumos.IdSubGrupoFarmacologico = FactPuntosCargaBienesInsumos.IdSubGrupoFarmacologico
             where FactCatalogoBienesInsumosHosp.Activo = 1      '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarPorCuentaAtencionNoPagados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarPorCuentaAtencionNoPagados]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select idFacturacionBienes as id, a.idProducto, b.codigo, b.nombreComercial as descripcion,
     a.cantidad, c.preciounitario, a.totalporpagar,idEstadoFacturacion,idAtencion from
     facturacionbienesinsumos a, factcatalogobienesinsumos b,factcatalogobienesinsumoshosp c
     where idatencion in (select idatencion
     from atenciones where idcuentaatencion = '+@IdCuentaAtencion+')'+'
     and a.idproducto = b.idproducto and c.idproducto = b.idproducto
     and c.idtipofinanciamiento = '+@lTipoCatalogo+'
     and a.IdEstadoFacturacion <> 4  '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarPorCuentaAtencionNoPagados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarPorId]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumos
where IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarPorIdYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarPorIdYtipoFinanciamiento]
	@IdTipoFinanciamiento [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumosHosp.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
            FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto
            WHERE    dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = @IdTipoFinanciamiento
                     and dbo.FactCatalogoBienesInsumos.idProducto = @idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarPorIdYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarTodo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarTodo]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoBienesInsumos
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarXcodigo]
	@lcCodigo [varchar](7)
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumos where codigo=@lcCodigo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosSeleccionarXDescripYcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosSeleccionarXDescripYcodigo]
	@lcCodigo [varchar](7),
	@lcDescripcion [varchar](100)
WITH EXECUTE AS CALLER
AS
if @lcDescripcion=''
   select idProducto,codigo,nombre as nombreProducto,0 as precioUnitario, 1 as activo  from FactCatalogoBienesInsumos where codigo=@lcCodigo
else
   select idProducto,codigo,nombre,0 as precioUnitario, 1 as activo from FactCatalogoBienesInsumos where nombre like '%' +@lcDescripcion+'%'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosSeleccionarXDescripYcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoBienesInsumosXcodigoYtipofinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoBienesInsumosXcodigoYtipofinanciamiento]
	@IdTipoFinanciamiento [int],
	@codigo [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumosHosp.IdProducto, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
						  dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
						  dbo.FactCatalogoBienesInsumos.FormaFarmaceutica, dbo.FactCatalogoBienesInsumos.TipoProducto
	FROM         dbo.FactCatalogoBienesInsumosHosp INNER JOIN
						  dbo.FactCatalogoBienesInsumos ON dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto

     Where
     FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = @IdTipoFinanciamiento
    and FactCatalogoBienesInsumos.Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoBienesInsumosXcodigoYtipofinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteAgregar]
	@idFactPaquete [int] OUTPUT,
	@Codigo [nvarchar](10),
	@Descripcion [nvarchar](100),
	@idTipoFinanciamiento [int],
	@FechaCreacion [datetime],
	@idUsuario [int],
	@idEstado [int],
	@TipoPaquete [int],
	@esItemFarmacia [int],
	@CPT [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoPaquete (
Codigo,Descripcion,idTipoFinanciamiento,FechaCreacion,idUsuario,idEstado,TipoPaquete,
esItemFarmacia,CPT) values (
@Codigo,@Descripcion,@idTipoFinanciamiento,@FechaCreacion,@idUsuario,@idEstado,@TipoPaquete,
@esItemFarmacia,@CPT)
set @idFactPaquete = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteEliminar]
	@idFactPaquete [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoPaquete
where idFactPaquete = @idFactPaquete
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactPaquete,'FactCatalogoPaquete'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteEliminarXidFactPaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteEliminarXidFactPaquete]
	@IdFactPaquete [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoPaquete where idFactPaquete=@IdFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteEliminarXidFactPaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteModificar]
	@idFactPaquete [int],
	@Codigo [nvarchar](10),
	@Descripcion [nvarchar](100),
	@idTipoFinanciamiento [int],
	@FechaCreacion [datetime],
	@idUsuario [int],
	@idEstado [int],
	@TipoPaquete [int],
	@esItemFarmacia [int],
	@CPT [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoPaquete
set
Codigo = @Codigo,
Descripcion = @Descripcion,
idTipoFinanciamiento = @idTipoFinanciamiento,
FechaCreacion = @FechaCreacion,
idUsuario = @idUsuario,
idEstado = @idEstado,
TipoPaquete = @TipoPaquete,
esItemFarmacia=@esItemFarmacia,
CPT=@CPT
where idFactPaquete = @idFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteSeleccionarPorFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
IF @FILTRO = ' '
	SET  @SQL =  'select * from FactCatalogoPaquete ORDER BY Descripcion'
ELSE
	SET  @SQL =  'select * from FactCatalogoPaquete where '  + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteSeleccionarPorId]
	@idFactPaquete [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoPaquete
where idFactPaquete = @idFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     idFactPaquete, Codigo, Descripcion
             From dbo.FactCatalogoPaquete
             ORDER BY Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoPaqueteXtipoPaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoPaqueteXtipoPaquete]
	@tipoPaquete [int]
WITH EXECUTE AS CALLER
AS
SELECT     idFactPaquete, Codigo, Descripcion
             From dbo.FactCatalogoPaquete
             Where idEstado<>0 and TipoPaquete=@tipoPaquete ORDER BY Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoPaqueteXtipoPaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServicioDevuelvePrecioUnitario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServicioDevuelvePrecioUnitario]
	@IdProducto [int],
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp
where idProducto=@IdProducto
and idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServicioDevuelvePrecioUnitario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualiIaridOpcsPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualiIaridOpcsPorCodigo]
	@IdOpcs [int],
	@Codigo [varchar](20)
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set idOpcs=@IdOpcs where codigo=@Codigo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualiIaridOpcsPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualizaCentroCostoXcentroCosto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualizaCentroCostoXcentroCosto]
	@IdCentroCosto [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set IdCentroCosto=null where IdCentroCosto=@IdCentroCosto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualizaCentroCostoXcentroCosto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualizaCentroCostoXproducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualizaCentroCostoXproducto]
	@IdCentroCosto [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set IdCentroCosto=@IdCentroCosto where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualizaCentroCostoXproducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualizaCentroCostoXproductoXcentroCosto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualizaCentroCostoXproductoXcentroCosto]
	@IdProducto [int],
	@IdCentroCosto [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set IdCentroCosto=null where idProducto=@IdProducto and IdCentroCosto=@IdCentroCosto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualizaCentroCostoXproductoXcentroCosto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualizarIdOpcsNull]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualizarIdOpcsNull]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set idOpcs=null
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualizarIdOpcsNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosActualizarInformacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosActualizarInformacion]
	@IdProducto [int],
	@Nombre [varchar](250)
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios set Nombre = @Nombre
where IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosActualizarInformacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosAgregar]
	@IdServicioSubGrupo [int],
	@IdPartida [int],
	@IdCentroCosto [int],
	@IdServicioSubSeccion [int],
	@IdServicioSeccion [int],
	@IdServicioGrupo [int],
	@Nombre [varchar](250),
	@Codigo [varchar](20),
	@IdProducto [int] OUTPUT,
	@EsCPT [int],
	@NombreMINSA [varchar](250),
	@idEstado [int],
	@codigoSIS [varchar](20),
	@LabResultadoAutomatico [int],
	@idProveedor [int],
	@equipoCodigo [varchar](2),
	@codigoSUNAT [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServicios (
IdServicioSubGrupo,IdPartida,IdCentroCosto,IdServicioSubSeccion,IdServicioSeccion,IdServicioGrupo,Nombre,Codigo,EsCPT,NombreMINSA,idEstado,codigoSIS,
       LabResultadoAutomatico,idProveedor,equipoCodigo,codigoSUNAT) values (
@IdServicioSubGrupo,@IdPartida,@IdCentroCosto,@IdServicioSubSeccion,@IdServicioSeccion,@IdServicioGrupo,@Nombre,@Codigo,@EsCPT,@NombreMINSA,@idEstado,@codigoSIS,
      @LabResultadoAutomatico,@idProveedor,@equipoCodigo,@codigoSUNAT)
set @IdProducto = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosAgregarCodigoNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosAgregarCodigoNombre]
	@Codigo [varchar](20),
	@Nombre [varchar](255),
	@IdEstado [int]
WITH EXECUTE AS CALLER
AS
IF NOT EXISTS(select * from FactCAtalogoServicios where codigo=@Codigo)
	BEGIN
		insert into FactCAtalogoServicios (Codigo,Nombre,IdServicioGrupo,IdServicioSubGrupo, IdServicioSeccion, EsCPT, IdPartida, IdCentroCosto, idEstado)
		values (@Codigo,@Nombre,5,24, 78, 1, 20, 999, @IdEstado)
	END
	ELSE
	BEGIN
		UPDATE FactCAtalogoServicios SET  IdEstado = @IdEstado
		WHERE codigo=@Codigo AND IdEstado = 1
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosAgregarCodigoNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosAgregarInformacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosAgregarInformacion]
	@IdProducto [int] OUTPUT,
	@Codigo [varchar](20),
	@Nombre [varchar](250),
	@IdServicioGrupo [int],
	@IdServicioSubGrupo [int],
	@IdServicioSeccion [int],
	@EsCPT [int],
	@NombreMINSA [varchar](250)
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServicios (Codigo,Nombre,IdServicioGrupo,IdServicioSubGrupo,IdServicioSeccion, EsCPT,NombreMINSA,idestado)
values (@Codigo,@Nombre,@IdServicioGrupo,@IdServicioSubGrupo,@IdServicioSeccion, @EsCPT,@NombreMINSA,1)
set @IdProducto = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosAgregarInformacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosConPrecioMayor]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosConPrecioMayor]
WITH EXECUTE AS CALLER
AS
select *,
(select top 1 PrecioUnitario from factCatalogoServiciosHosp where factcatalogoservicios.idproducto=factCatalogoServiciosHosp.idProducto order by preciounitario desc) as Precio
from factcatalogoservicios  order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosConPrecioMayor] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosEliminar]
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServicios
where IdProducto = @IdProducto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdProducto,'FactCatalogoServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosFiltrarCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosFiltrarCatalogo]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdServicioSubGrupo, 0 as IdProducto, '' as Codigo, Descripcion from FactCatalogoServiciosSubGrupo'


          SET  @SQL2 =  'select FactCatalogoServicios.IdServicioSubGrupo,
     FactCatalogoServicios.IdProducto,
     FactCatalogoServicios.Codigo,
     FactCatalogoServicios.Nombre,
     FactCatalogoServiciosHosp.PrecioUnitario,
     FactCatalogoServiciosHosp.Activo
     From FactCatalogoServiciosHosp, FactCatalogoServicios
     Where
     FactCatalogoServiciosHosp.IdTipoFinanciamiento = '+@lTipoCatalogo+'
     and FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto   '+@lcFiltro

   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '} AS title_chap RELATE IdServicioSubGrupo TO IdServicioSubGrupo) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosFiltrarCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosFiltrarCatalogoBase]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosFiltrarCatalogoBase]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
set @SQL='SHAPE {select IdServicioSubGrupo, 0 as IdProducto, '' as Codigo, Descripcion from FactCatalogoServiciosSubGrupo} APPEND ({select IdServicioSubGrupo, IdProducto, Codigo, Nombre, 0 as PrecioUnitario, 1 as Activo from FactCatalogoServicios  order by nombre}  AS title_chap RELATE IdServicioSubGrupo TO IdServicioSubGrupo) '
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosFiltrarCatalogoBase] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosFiltrarCatalogoDEBB]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosFiltrarCatalogoDEBB]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdServicioSubGrupo, 0 as IdProducto, '' as Codigo, Descripcion from FactCatalogoServiciosSubGrupo'


          SET  @SQL2 =  'select FactCatalogoServicios.IdServicioSubGrupo,
     FactCatalogoServicios.IdProducto,
     FactCatalogoServicios.Codigo,
     FactCatalogoServicios.Nombre,
     FactCatalogoServiciosHosp.PrecioUnitario,
     FactCatalogoServiciosHosp.Activo
     From FactCatalogoServiciosHosp, FactCatalogoServicios
     Where
     FactCatalogoServiciosHosp.IdTipoFinanciamiento = '+@lTipoCatalogo +'
     and FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto   '+@lcFiltro

   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '}  AS title_chap RELATE IdServicioSubGrupo TO IdServicioSubGrupo) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosFiltrarCatalogoDEBB] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosGrupoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosGrupoAgregar]
	@Descripcion [varchar](100),
	@IdServicioGrupo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosGrupo (
Descripcion) values (
@Descripcion)
set @IdServicioGrupo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdServicioGrupo,'FactCatalogoServiciosGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosGrupoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosGrupoEliminar]
	@IdServicioGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosGrupo
where IdServicioGrupo = @IdServicioGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdServicioGrupo,'FactCatalogoServiciosGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosGrupoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosGrupoModificar]
	@Descripcion [varchar](100),
	@IdServicioGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosGrupo
set
Descripcion = @Descripcion
where IdServicioGrupo = @IdServicioGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdServicioGrupo,'FactCatalogoServiciosGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosGrupoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosGrupoSeleccionarPorId]
	@IdServicioGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosGrupo
where IdServicioGrupo = @IdServicioGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosGrupoSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosGrupoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosGrupoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProducto]
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@PrecioUnitario [money]
WITH EXECUTE AS CALLER
AS
IF EXISTS(Select * from FactCatalogoServiciosHosp where idTipoFinanciamiento=@IdTipoFinanciamiento and idProducto=@IdProducto)
	BEGIN
		update FactCatalogoServiciosHosp set
		PrecioUnitario = @PrecioUnitario
		where idProducto=@IdProducto  and IdTipoFinanciamiento =@IdTipoFinanciamiento
	END
ELSE
	BEGIN
		insert into FactCatalogoServiciosHosp (idProducto,IdTipoFinanciamiento,Activo,SeUsaSinPrecio, PrecioUnitario)
		values (@IdProducto, @IdTipoFinanciamiento, 1, 0, @PrecioUnitario)
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProductoSIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProductoSIS]
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@PrecioUnitario [money]
WITH EXECUTE AS CALLER
AS
IF EXISTS(Select * from FactCatalogoServiciosHosp where idTipoFinanciamiento=@IdTipoFinanciamiento and idProducto=@IdProducto)
	BEGIN
		update FactCatalogoServiciosHosp set
		PrecioUnitario = @PrecioUnitario,
		SeUsaSinPrecio=0
		where idProducto=@IdProducto and IdTipoFinanciamiento =@IdTipoFinanciamiento
	END
ELSE
	BEGIN
		insert into FactCatalogoServiciosHosp (idProducto,IdTipoFinanciamiento,Activo,SeUsaSinPrecio, PrecioUnitario)
		values (@IdProducto, @IdTipoFinanciamiento, 1, 0, @PrecioUnitario)
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospActualizarInformacionPorIdTipoFinanciamientoIdProductoSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospActualizaSeUsaSinPrecio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospActualizaSeUsaSinPrecio]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosHosp set SeUsaSinPrecio=0 where seUsaSinPrecio is NULL
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospActualizaSeUsaSinPrecio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospAgregar]
	@IdFinanciamientoCatalogo [int] OUTPUT,
	@PrecioUnitario [money],
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@Activo [bit],
	@SeUsaSinPrecio [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosHosp (
PrecioUnitario,IdProducto,IdTipoFinanciamiento,Activo,SeUsaSinPrecio) values (
@PrecioUnitario,@IdProducto,@IdTipoFinanciamiento,@Activo,@SeUsaSinPrecio)
set @IdFinanciamientoCatalogo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospEliminar]
	@IdFinanciamientoCatalogo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosHosp
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospEliminarXtipoFinanciamientoIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospEliminarXtipoFinanciamientoIdProducto]
	@IdtipoFinanciamiento [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
Delete From FactCatalogoServiciosHosp Where idtipoFinanciamiento=@IdtipoFinanciamiento and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospEliminarXtipoFinanciamientoIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCarga]
	@idPuntoCarga [int],
	@idFiltroTipo [int],
	@Filtro [varchar](100),
	@TipoServicioOfrecido [int]
WITH EXECUTE AS CALLER
AS
declare @FiltroDes varchar(100)
select @FiltroDes='%' + @filtro+'%'
if @idFiltroTipo=1
    if @TipoServicioOfrecido    =2
	SELECT     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosPtos.idPuntoCarga
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga
                                and dbo.FactCatalogoServicios.Codigo=@Filtro  and dbo.FactCatalogoServicios.idEstado=1
           ORDER BY dbo.FactCatalogoServicios.Nombre
    else
	SELECT     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosPtos.idPuntoCarga
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga
                                and dbo.FactCatalogoServicios.Codigo=@Filtro and dbo.FactCatalogoServicios.EsCPT=@TipoServicioOfrecido
                                and dbo.FactCatalogoServicios.idEstado=1
           ORDER BY dbo.FactCatalogoServicios.Nombre
else
       if @TipoServicioOfrecido    =2
	SELECT     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosPtos.idPuntoCarga
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga
                                and dbo.FactCatalogoServicios.Nombre like @FiltroDes  and dbo.FactCatalogoServicios.idEstado=1
           ORDER BY dbo.FactCatalogoServicios.Nombre
       else
	SELECT     dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosPtos.idPuntoCarga
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga
                                and dbo.FactCatalogoServicios.Nombre like @FiltroDes and dbo.FactCatalogoServicios.EsCPT=@TipoServicioOfrecido
                                 and dbo.FactCatalogoServicios.idEstado=1
           ORDER BY dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCargaTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCargaTipoFinanciamiento]
	@idPuntoCarga [int],
	@idTipoFinanciamiento [int],
	@idFiltroTipo [int],
	@Filtro [varchar](100),
	@TipoServicioOfrecido [int]
WITH EXECUTE AS CALLER
AS
declare @FiltroDes varchar(100)
select @FiltroDes='%' + @filtro+'%'
if @idFiltroTipo=1
    if @TipoServicioOfrecido    =2
	SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga,
                                 dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.Nombre as NombreProducto,dbo.FactCatalogoServicios.LabResultadoAutomatico
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento=@idTipoFinanciamiento
                                and dbo.FactCatalogoServicios.Codigo=@Filtro and dbo.FactCatalogoServicios.idEstado=1
             ORDER BY dbo.FactCatalogoServicios.Nombre ASC
    else
	SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga,
		     dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.Nombre as NombreProducto,dbo.FactCatalogoServicios.LabResultadoAutomatico
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento=@idTipoFinanciamiento
                                and dbo.FactCatalogoServicios.Codigo=@Filtro and dbo.FactCatalogoServicios.EsCPT=@TipoServicioOfrecido  and dbo.FactCatalogoServicios.idEstado=1
             ORDER BY dbo.FactCatalogoServicios.Nombre ASC
else
       if @TipoServicioOfrecido    =2
	SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga,
		     dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.Nombre as NombreProducto,dbo.FactCatalogoServicios.LabResultadoAutomatico
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento=@idTipoFinanciamiento
                                and dbo.FactCatalogoServicios.Nombre like @FiltroDes  and dbo.FactCatalogoServicios.idEstado=1
             ORDER BY dbo.FactCatalogoServicios.Nombre ASC
       else
	SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga,
	                  dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.Nombre as NombreProducto,dbo.FactCatalogoServicios.LabResultadoAutomatico
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento=@idTipoFinanciamiento
                                and dbo.FactCatalogoServicios.Nombre like @FiltroDes and dbo.FactCatalogoServicios.EsCPT=@TipoServicioOfrecido  and dbo.FactCatalogoServicios.idEstado=1
             ORDER BY dbo.FactCatalogoServicios.Nombre ASC
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospFiltraPorPuntoCargaTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospModificar]
	@IdFinanciamientoCatalogo [int],
	@PrecioUnitario [money],
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@Activo [bit],
	@SeUsaSinPrecio [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosHosp
set
PrecioUnitario = @PrecioUnitario,
IdProducto = @IdProducto,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
Activo = @Activo,
SeUsaSinPrecio = @SeUsaSinPrecio
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospPorIdProducto]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.TiposFinanciamiento.Descripcion, dbo.FactCatalogoServiciosHosp.PrecioUnitario,
                                       dbo.FactCatalogoServiciosHosp.IdProducto
                             FROM      dbo.FactCatalogoServiciosHosp LEFT OUTER JOIN
                                       dbo.TiposFinanciamiento ON dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
                             WHERE     dbo.FactCatalogoServiciosHosp.IdProducto=@idProducto
                             ORDER BY dbo.TiposFinanciamiento.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospSeleccionarPorId]
	@IdFinanciamientoCatalogo [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospSeleccionarPorIdTipoFinanciamientoIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospSeleccionarPorIdTipoFinanciamientoIdProducto]
	@IdProducto [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosHosp where idTipoFinanciamiento=@IdTipoFinanciamiento and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospSeleccionarPorIdTipoFinanciamientoIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospSeleccionarPorIdYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospSeleccionarPorIdYtipoFinanciamiento]
	@idProducto [int],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServiciosHosp.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.LabResultadoAutomatico

FROM         dbo.FactCatalogoServiciosHosp LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FactCatalogoServiciosHosp.IdProducto = dbo.FactCatalogoServicios.IdProducto

WHERE dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento=@idTipoFinanciamiento and dbo.FactCatalogoServiciosHosp.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospSeleccionarPorIdYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospXfiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospXfiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from FactCatalogoServiciosHosp where ' + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospXidProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.TiposFinanciamiento.Descripcion, dbo.FactCatalogoServiciosHosp.PrecioUnitario,
          dbo.FactCatalogoServiciosHosp.IdProducto,  dbo.FactCatalogoServiciosHosp.idtipofinanciamiento
FROM      dbo.FactCatalogoServiciosHosp LEFT OUTER JOIN
          dbo.TiposFinanciamiento ON dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
WHERE     dbo.FactCatalogoServiciosHosp.IdProducto=@IdProducto
ORDER BY dbo.TiposFinanciamiento.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosHospXidProductoOrdenadoXtipofinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosHospXidProductoOrdenadoXtipofinanciamiento]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.TiposFinanciamiento.Descripcion, dbo.FactCatalogoServiciosHosp.PrecioUnitario,
          dbo.FactCatalogoServiciosHosp.IdProducto
FROM      dbo.FactCatalogoServiciosHosp LEFT OUTER JOIN
          dbo.TiposFinanciamiento ON dbo.FactCatalogoServiciosHosp.IdTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
WHERE     dbo.FactCatalogoServiciosHosp.IdProducto=@IdProducto
ORDER BY dbo.TiposFinanciamiento.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosHospXidProductoOrdenadoXtipofinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosModificar]
	@IdServicioSubGrupo [int],
	@IdPartida [int],
	@IdCentroCosto [int],
	@IdServicioSubSeccion [int],
	@IdServicioSeccion [int],
	@IdServicioGrupo [int],
	@Nombre [varchar](250),
	@Codigo [varchar](20),
	@IdProducto [int],
	@EsCPT [int],
	@NombreMINSA [varchar](250),
	@idEstado [int],
	@codigoSIS [varchar](20),
	@LabResultadoAutomatico [int],
	@idProveedor [int],
	@equipoCodigo [varchar](2),
	@codigoSUNAT [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServicios
set
IdServicioSubGrupo = @IdServicioSubGrupo,
IdPartida = @IdPartida,
IdCentroCosto = @IdCentroCosto,
IdServicioSubSeccion = @IdServicioSubSeccion,
IdServicioSeccion = @IdServicioSeccion,
IdServicioGrupo = @IdServicioGrupo,
Nombre = @Nombre,
Codigo = @Codigo,
EsCPT=@EsCPT,
NombreMINSA=@NombreMINSA,
idEstado=@idEstado,
codigoSIS=@codigoSIS,
LabResultadoAutomatico=@LabResultadoAutomatico ,
idProveedor=@idProveedor ,
equipoCodigo=@equipoCodigo,
codigoSUNAT=@codigoSUNAT
where IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosAgregar]
	@idPuntoCarga [int],
	@IdProducto [int],
	@EsPreventa [bit]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosPtos(
idPuntoCarga,IdProducto,EsPreventa) values (
@idPuntoCarga,@IdProducto,@EsPreventa)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosConsultar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosConsultar]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosPtos
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosConsultar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosEliminar]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
Delete from FactCatalogoServiciosPtos where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosEliminarPorIdPuntoCargaIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosEliminarPorIdPuntoCargaIdProducto]
	@IdPuntoCarga [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosPtos where idPuntoCarga=@IdPuntoCarga and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosEliminarPorIdPuntoCargaIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosEliminaXidPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosEliminaXidPuntoCarga]
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosPtos where idPuntoCarga=@idPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosEliminaXidPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosOrdenasXcpt]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosOrdenasXcpt]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactPuntosCarga.Descripcion, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                     dbo.FactCatalogoServicios.EsCPT, dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.FactCatalogoServicios.IdProducto,
                     dbo.FactPartidasPresupuestales.Descripcion AS dPartida, dbo.CentrosCosto.Descripcion AS dCentroCosto
FROM         dbo.CentrosCosto RIGHT OUTER JOIN
                     dbo.FactCatalogoServicios ON dbo.CentrosCosto.IdCentroCosto = dbo.FactCatalogoServicios.IdCentroCosto LEFT OUTER JOIN
                     dbo.FactPartidasPresupuestales ON dbo.FactCatalogoServicios.IdPartida = dbo.FactPartidasPresupuestales.IdPartidaPresupuestal RIGHT OUTER JOIN
                     dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto LEFT OUTER JOIN
                     dbo.FactPuntosCarga ON dbo.FactCatalogoServiciosPtos.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
ORDER BY dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosOrdenasXcpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosSeleccionar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosSeleccionar]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from FactCatalogoServiciosPtos ' +  @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosSeleccionar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosSeleccionarXidProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosSeleccionarXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.FactCatalogoServiciosPtos.idProducto, dbo.FactPuntosCarga.Descripcion,dbo.FactCatalogoServiciosPtos.EsPreVenta
                 FROM        dbo.FactCatalogoServiciosPtos LEFT OUTER JOIN
                                   dbo.FactPuntosCarga ON dbo.FactCatalogoServiciosPtos.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
                 WHERE    dbo.FactCatalogoServiciosPtos.idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosSeleccionarXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosPtosXidProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosPtosXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.FactCatalogoServiciosPtos.idProducto, dbo.FactPuntosCarga.idServicio,dbo.FactCatalogoServiciosPtos.EsPreVenta
             FROM         dbo.FactCatalogoServiciosPtos LEFT OUTER JOIN
                                dbo.FactPuntosCarga ON dbo.FactCatalogoServiciosPtos.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
             WHERE     dbo.FactCatalogoServiciosPtos.idProducto=@IdProducto
                               and dbo.FactCatalogoServiciosPtos.EsPreVenta=1
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosPtosXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeccionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeccionEliminar]
	@IdServicioSeccion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosSeccion
where IdServicioSeccion = @IdServicioSeccion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdServicioSeccion,'FactCatalogoServiciosSeccion'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeccionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeccionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeccionSeleccionarPorId]
	@IdServicioSeccion [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosSeccion
where IdServicioSeccion = @IdServicioSeccion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeccionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeccionXidSubGrupo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeccionXidSubGrupo]
	@lIdSubGrupo [int]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosSeccion where IdServicioSubGrupo = @lIdSubGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeccionXidSubGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarCatalogo]
	@lTipoCatalogo [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdServicioSubGrupo, 0 as IdProducto, '' as Codigo, Descripcion from FactCatalogoServiciosSubGrupo'


          SET  @SQL2 =  'select FactCatalogoServicios.IdServicioSubGrupo,
     FactCatalogoServicios.IdProducto,
     FactCatalogoServicios.Codigo,
     FactCatalogoServicios.Nombre,
     FactCatalogoServiciosHosp.PrecioUnitario,
     FactCatalogoServiciosHosp.Activo
     From FactCatalogoServiciosHosp, FactCatalogoServicios
     Where " + _
     FactCatalogoServiciosHosp.IdTipoFinanciamiento = '+@lTipoCatalogo +'
     and FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto '

   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '}  AS title_chap RELATE IdServicioSubGrupo TO IdServicioSubGrupo) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarCatalogoBase]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarCatalogoBase]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'select IdServicioSubGrupo, 0 as IdProducto, '' as Codigo, Descripcion from FactCatalogoServiciosSubGrupo'


          SET  @SQL2 =  'select IdServicioSubGrupo, IdProducto, Codigo, Nombre, 0 as PrecioUnitario, 1 as Activo from FactCatalogoServicios  '

   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '}  AS title_chap RELATE IdServicioSubGrupo TO IdServicioSubGrupo) '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarCatalogoBase] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombre]
	@codigo [varchar](20),
	@nombre [varchar](50)
WITH EXECUTE AS CALLER
AS
declare @filtro varchar(50)
select @filtro='%'+@nombre+'%'
if @codigo<>''
      SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios WHERE codigo=@codigo
else
     SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios   WHERE nombre like @filtro
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombreTipoCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombreTipoCatalogo]
	@codigo [varchar](20),
	@nombre [varchar](50),
	@EsCpt [int]
WITH EXECUTE AS CALLER
AS
declare @filtro varchar(50)
	select @filtro='%'+@nombre+'%'
	if @codigo<>''
	begin
		if @EsCpt = 2
	      SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios WHERE codigo=@codigo

		else if @EsCpt = 1
	      SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios WHERE codigo=@codigo AND EsCpt = 1
		else
			SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios WHERE codigo=@codigo AND EsCpt = 0
	end
	else
	begin
		if @EsCpt = 2
			SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios   WHERE nombre like @filtro
		else if @EsCpt = 1
			SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios   WHERE nombre like @filtro AND EsCpt = 1
		else
			SELECT     IdProducto, Codigo, Nombre FROM         dbo.FactCatalogoServicios   WHERE nombre like @filtro AND EsCpt = 0
	end
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorCodigoOnombreTipoCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorCuentaAtencionNoPagados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorCuentaAtencionNoPagados]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL =  'select distinct idFacturacionServicio as id, a.idProducto, b.codigo, b.nombre as descripcion,
     a.cantidad, c.preciounitario, a.totalporpagar,idEstadoFacturacion,idAtencion from
     facturacionservicios a, factcatalogoservicios b,factcatalogoservicioshosp c
     where idatencion in (select idatencion
     from atenciones where idcuentaatencion = '+ @IdCuentaAtencion+ ')
     and a.idproducto = b.idproducto and c.idproducto = b.idproducto
     and c.idtipofinanciamiento = '+@lTipoCatalogo+'
     and a.IdEstadoFacturacion <> 4 '+@lcFiltro



EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorCuentaAtencionNoPagados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorId]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServicios
where IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorIdYtipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorIdYtipoFinanciamiento]
	@idProducto [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select  FactCatalogoServicios.Codigo,
     FactCatalogoServicios.Nombre as NombreProducto, FactCatalogoServiciosHosp.PrecioUnitario,FactCatalogoServiciosHosp.SeUsaSinPrecio
     From FactCatalogoServiciosHosp
     left join FactCatalogoServicios
     on FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto
     Where
     FactCatalogoServiciosHosp.IdTipoFinanciamiento = @IdTipoFinanciamiento
     and FactCatalogoServicios.idProducto = @idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorIdYtipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarPorTipoCatalogo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarPorTipoCatalogo]
	@lcFiltro [varchar](1000),
	@lTipoCatalogo [varchar](20)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL =  'select IdProducto, Codigo, Nombre from FactCatalogoServicios where IdProducto not in (
    select IdProducto From FactCatalogoServiciosHosp
     where IdTipoFinanciamiento = '+ @lTipoCatalogo+ ')  '+@lcFiltro



EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarPorTipoCatalogo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarServiciosLike]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarServiciosLike]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL =  'select  DISTINCT FactCatalogoServicios.IdProducto,
            FactCatalogoServicios.Codigo, FactCatalogoServicios.Nombre,
            FactCatalogoServiciosHosp.PrecioUnitario , FactCatalogoServiciosHosp.Activo,FactCatalogoServiciosHosp.SeUsaSinPrecio
             From
             (FactCatalogoServicios left join FactCatalogoServiciosHosp
             on FactCatalogoServicios.IdProducto = FactCatalogoServiciosHosp.IdProducto)
             left join FactPuntosCargaServicio
             on FactCatalogoServicios.IdServicioSubGrupo = FactPuntosCargaServicio.IdServicioSubGrupo
             where  FactCatalogoServicios.idEstado=1 and  FactCatalogoServiciosHosp.Activo = 1 '+@lcFiltro



EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarServiciosLike] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarTipoConsulta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarTipoConsulta]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select IdProducto, Codigo + ' = ' + Nombre as Descripcion, nombre  from FactCatalogoServicios where IdProducto in
(select IdProductoConsulta from EspecialidadCE where IdEspecialidad = @IdEspecialidad
union
select IdProductoInterconsulta from EspecialidadCE where IdEspecialidad = @IdEspecialidad)
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarTipoConsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSeleccionarTodoPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSeleccionarTodoPorIdProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServicios where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSeleccionarTodoPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoAgregar]
	@Codigo [char](10),
	@IdServicioGrupo [int],
	@Descripcion [varchar](255),
	@IdServicioSubGrupo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosSubGrupo (
Codigo,IdServicioGrupo,Descripcion) values (
@Codigo,@IdServicioGrupo,@Descripcion)
set @IdServicioSubGrupo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdServicioSubGrupo,'FactCatalogoServiciosSubGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoEliminar]
	@IdServicioSubGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosSubGrupo
where IdServicioSubGrupo = @IdServicioSubGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdServicioSubGrupo,'FactCatalogoServiciosSubGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoModificar]
	@Codigo [char](10),
	@IdServicioGrupo [int],
	@Descripcion [varchar](255),
	@IdServicioSubGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosSubGrupo
set
Codigo = @Codigo,
IdServicioGrupo = @IdServicioGrupo,
Descripcion = @Descripcion
where IdServicioSubGrupo = @IdServicioSubGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdServicioSubGrupo,'FactCatalogoServiciosSubGrupo'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoSeleccionarPorId]
	@IdServicioSubGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosSubGrupo
where IdServicioSubGrupo = @IdServicioSubGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosSubGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubGrupoXidGrupo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubGrupoXidGrupo]
	@lIdGrupo [int]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosSubGrupo where IdServicioGrupo = @lIdGrupo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubGrupoXidGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubSeccionAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubSeccionAgregar]
	@Codigo [varchar](10),
	@IdServicioSeccion [int],
	@Descripcion [varchar](255),
	@IdServicioSubSeccion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosSubSeccion (
Codigo,IdServicioSeccion,Descripcion) values (
@Codigo,@IdServicioSeccion,@Descripcion)
set @IdServicioSubSeccion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdServicioSubSeccion,'FactCatalogoServiciosSubSeccion'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubSeccionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubSeccionEliminar]
	@IdServicioSubSeccion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosSubSeccion
where IdServicioSubSeccion = @IdServicioSubSeccion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdServicioSubSeccion,'FactCatalogoServiciosSubSeccion'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubSeccionModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubSeccionModificar]
	@Codigo [varchar](10),
	@IdServicioSeccion [int],
	@Descripcion [varchar](255),
	@IdServicioSubSeccion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosSubSeccion
set
Codigo = @Codigo,
IdServicioSeccion = @IdServicioSeccion,
Descripcion = @Descripcion
where IdServicioSubSeccion = @IdServicioSubSeccion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdServicioSubSeccion,'FactCatalogoServiciosSubSeccion'
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubSeccionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubSeccionSeleccionarPorId]
	@IdServicioSubSeccion [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosSubSeccion
where IdServicioSubSeccion = @IdServicioSubSeccion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosSubSeccionXidSeccion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosSubSeccionXidSeccion]
	@lIdSeccion [int]
WITH EXECUTE AS CALLER
AS
Select * from FactCatalogoServiciosSubSeccion where IdServicioSeccion = @lIdSeccion
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosSubSeccionXidSeccion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosXcodigo]
	@lcCodigo [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServicios where codigo=@lcCodigo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosXCodigoTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosXCodigoTipoFinanciamiento]
	@IdTipoFinanciamiento [int],
	@codigo [varchar](20)
WITH EXECUTE AS CALLER
AS
select FactCatalogoServiciosHosp.IdProducto,
     FactCatalogoServicios.Nombre as NombreProducto, FactCatalogoServiciosHosp.PrecioUnitario
     From FactCatalogoServiciosHosp
     left join FactCatalogoServicios
     on FactCatalogoServiciosHosp.IdProducto = FactCatalogoServicios.IdProducto
     Where
     FactCatalogoServiciosHosp.IdTipoFinanciamiento =  @IdTipoFinanciamiento
    and FactCatalogoServicios.Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosXCodigoTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosXIdCuentaAtencionIdFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosXIdCuentaAtencionIdFuenteFinanciamiento]
	@IdCuentaAtencion [int],
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
if  EXISTS (SELECT    1
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
              dbo.FacturacionServicioFinanciamientos ON
              dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto LEFT OUTER JOIN
              dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	WHERE dbo.FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion
	and dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento=@IdFuenteFinanciamiento
	and (dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=1 or
	dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=4))
begin
   SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.idOrden, dbo.FacturacionServicioFinanciamientos.idProducto,
              dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento, dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento,
              dbo.FacturacionServicioFinanciamientos.CantidadFinanciada, dbo.FacturacionServicioFinanciamientos.PrecioFinanciado, dbo.FacturacionServicioFinanciamientos.TotalFinanciado,
              dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion , dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.idPartida
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
              dbo.FacturacionServicioFinanciamientos ON
              dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto LEFT OUTER JOIN
              dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	WHERE dbo.FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion
	and dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento=@IdFuenteFinanciamiento
	and (dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=1 or dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=4)
end
else
begin
	SELECT        dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdOrden, dbo.FacturacionServicioDespacho.IdProducto,
                         dbo.FactOrdenServicio.idTipoFinanciamiento, dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.FacturacionServicioDespacho.Cantidad AS CantidadFinanciada,
                         dbo.FacturacionServicioDespacho.Precio AS PrecioFinanciado, dbo.FacturacionServicioDespacho.Total AS TotalFinanciado,
                         dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FactCatalogoServicios.IdPartida
	FROM            dbo.FacturacionServicioDespacho LEFT OUTER JOIN
                         dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
                         dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto
	WHERE        dbo.FactOrdenServicio.IdCuentaAtencion = @IdCuentaAtencion
		and (dbo.FactOrdenServicio.idEstadoFacturacion<>9)
end;
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosXIdCuentaAtencionIdFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosXIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosXIdProducto]
	@IdServiciosHospitalarios [int]
WITH EXECUTE AS CALLER
AS
SELECT     IdProducto, Codigo, Nombre, IdPartida
From dbo.FactCatalogoServicios
Where IdProducto=@IdServiciosHospitalarios
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosXIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactCatalogoServiciosXidTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactCatalogoServiciosXidTipoFinanciamiento]
	@idProducto [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp
 where idProducto = @idProducto
and idTipoFinanciamiento = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FactCatalogoServiciosXidTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionBienesInsumosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactClasificacionBienesInsumosAgregar]
	@Descripcion [varchar](50),
	@IdClasificacionBienInsumo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactClasificacionBienesInsumos (
Descripcion) values (
@Descripcion)
set @IdClasificacionBienInsumo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdClasificacionBienInsumo,'FactClasificacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionBienesInsumosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionBienesInsumosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactClasificacionBienesInsumosEliminar]
	@IdClasificacionBienInsumo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactClasificacionBienesInsumos
where IdClasificacionBienInsumo = @IdClasificacionBienInsumo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdClasificacionBienInsumo,'FactClasificacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionBienesInsumosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionBienesInsumosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactClasificacionBienesInsumosModificar]
	@Descripcion [varchar](50),
	@IdClasificacionBienInsumo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactClasificacionBienesInsumos
set
Descripcion = @Descripcion
where IdClasificacionBienInsumo = @IdClasificacionBienInsumo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdClasificacionBienInsumo,'FactClasificacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionBienesInsumosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionBienesInsumosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactClasificacionBienesInsumosSeleccionarPorId]
	@IdClasificacionBienInsumo [int]
WITH EXECUTE AS CALLER
AS
select * from FactClasificacionBienesInsumos
where IdClasificacionBienInsumo = @IdClasificacionBienInsumo
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionBienesInsumosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionServiciosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactClasificacionServiciosAgregar]
	@Descripcion [varchar](50),
	@IdClasificacionServicio [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactClasificacionServicios (
Descripcion) values (
@Descripcion)
set @IdClasificacionServicio = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdClasificacionServicio,'FactClasificacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionServiciosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactClasificacionServiciosEliminar]
	@IdClasificacionServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactClasificacionServicios
where IdClasificacionServicio = @IdClasificacionServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdClasificacionServicio,'FactClasificacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionServiciosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactClasificacionServiciosModificar]
	@Descripcion [varchar](50),
	@IdClasificacionServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactClasificacionServicios
set
Descripcion = @Descripcion
where IdClasificacionServicio = @IdClasificacionServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdClasificacionServicio,'FactClasificacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactClasificacionServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactClasificacionServiciosSeleccionarPorId]
	@IdClasificacionServicio [int]
WITH EXECUTE AS CALLER
AS
select * from FactClasificacionServicios
where IdClasificacionServicio = @IdClasificacionServicio
GO
ALTER AUTHORIZATION ON [dbo].[FactClasificacionServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosGrupoFarmacologicoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosGrupoFarmacologicoAgregar]
	@Descripcion [varchar](255),
	@IdGrupoFarmacologico [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactInsumosGrupoFarmacologico (
Descripcion) values (
@Descripcion)
set @IdGrupoFarmacologico = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGrupoFarmacologico,'FactInsumosGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologicoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosGrupoFarmacologicoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosGrupoFarmacologicoEliminar]
	@IdGrupoFarmacologico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactInsumosGrupoFarmacologico
where IdGrupoFarmacologico = @IdGrupoFarmacologico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdGrupoFarmacologico,'FactInsumosGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologicoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosGrupoFarmacologicoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosGrupoFarmacologicoModificar]
	@Descripcion [varchar](255),
	@IdGrupoFarmacologico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactInsumosGrupoFarmacologico
set
Descripcion = @Descripcion
where IdGrupoFarmacologico = @IdGrupoFarmacologico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdGrupoFarmacologico,'FactInsumosGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologicoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosGrupoFarmacologicoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosGrupoFarmacologicoSeleccionarPorId]
	@IdGrupoFarmacologico [int]
WITH EXECUTE AS CALLER
AS
select * from FactInsumosGrupoFarmacologico
where IdGrupoFarmacologico = @IdGrupoFarmacologico
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologicoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosGrupoFarmacologicoSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactInsumosGrupoFarmacologicoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from FactInsumosGrupoFarmacologico
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosGrupoFarmacologicoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosSubGrupoFarmacologicoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosSubGrupoFarmacologicoAgregar]
	@IdGrupoFarmacologico [int] OUTPUT,
	@Descripcion [varchar](255),
	@IdSubGrupoFarmacologico [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactInsumosSubGrupoFarmacologico (
Descripcion) values (
@Descripcion)
set @IdGrupoFarmacologico = @@Identity
set @IdSubGrupoFarmacologico = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdSubGrupoFarmacologico,'FactInsumosSubGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologicoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosSubGrupoFarmacologicoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosSubGrupoFarmacologicoEliminar]
	@IdGrupoFarmacologico [int],
	@IdSubGrupoFarmacologico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactInsumosSubGrupoFarmacologico
where IdGrupoFarmacologico = @IdGrupoFarmacologico and
IdSubGrupoFarmacologico = @IdSubGrupoFarmacologico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdSubGrupoFarmacologico,'FactInsumosSubGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologicoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosSubGrupoFarmacologicoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosSubGrupoFarmacologicoModificar]
	@IdGrupoFarmacologico [int],
	@Descripcion [varchar](255),
	@IdSubGrupoFarmacologico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactInsumosSubGrupoFarmacologico
set
Descripcion = @Descripcion
where IdGrupoFarmacologico = @IdGrupoFarmacologico and
IdSubGrupoFarmacologico = @IdSubGrupoFarmacologico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdSubGrupoFarmacologico,'FactInsumosSubGrupoFarmacologico'
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologicoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosSubGrupoFarmacologicoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactInsumosSubGrupoFarmacologicoSeleccionarPorId]
	@IdGrupoFarmacologico [int],
	@IdSubGrupoFarmacologico [int]
WITH EXECUTE AS CALLER
AS
select * from FactInsumosSubGrupoFarmacologico
where IdGrupoFarmacologico = @IdGrupoFarmacologico and
IdSubGrupoFarmacologico = @IdSubGrupoFarmacologico
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologicoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactInsumosSubGrupoFarmacologicoXIdGrupoFarmacologico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactInsumosSubGrupoFarmacologicoXIdGrupoFarmacologico]
	@lIdGrupoFarmacologico [int]
WITH EXECUTE AS CALLER
AS
Select * from FactInsumosSubGrupoFarmacologico where IdGrupoFarmacologico = @lIdGrupoFarmacologico
GO
ALTER AUTHORIZATION ON [dbo].[FactInsumosSubGrupoFarmacologicoXIdGrupoFarmacologico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenBienInsumoConsultar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenBienInsumoConsultar]
	@idTipoFinanciamiento [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumosHosp where idTipoFinanciamiento=@idTipoFinanciamiento and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenBienInsumoConsultar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesActualizaExoneracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesActualizaExoneracion]
	@idOrden [int],
	@importeExonerado [money],
	@idUsuarioExonera [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenesBienes set ImporteExonerado =@importeExonerado, idUsuarioExonera=@idUsuarioExonera
              where idOrden  =@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesActualizaExoneracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesAgregar]
	@idOrden [int] OUTPUT,
	@idPuntoCarga [int],
	@IdPaciente [int],
	@idCuentaAtencion [int],
	@idComprobantePago [int],
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idPreventa [int],
	@FechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoFacturacion [int],
	@ImporteExonerado [money],
	@idUsuarioExonera [int],
	@IdUsuarioAuditoria [int],
	@Descripcion [varchar](200),
	@Paquete [varchar](100),
	@Dni [varchar](12),
	@NombPaciente [varchar](100)
WITH EXECUTE AS CALLER
AS
insert into FactOrdenesBienes (
idPuntoCarga,IdPaciente,idCuentaAtencion,idComprobantePago,MovNumero,MovTipo,idPreventa,FechaCreacion,idUsuario,idEstadoFacturacion,ImporteExonerado,idUsuarioExonera,Descripcion,Paquete,DNI,NombPaciente) values (
@idPuntoCarga,@IdPaciente,@idCuentaAtencion,@idComprobantePago,@MovNumero,@MovTipo,@idPreventa,@FechaCreacion,@idUsuario,@idEstadoFacturacion,@ImporteExonerado,@idUsuarioExonera,@Descripcion,@Paquete,@Dni,@NombPaciente)
set @idOrden = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesEliminar]
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenesBienes
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoAgregar]
	@FechaModificacion [datetime],
	@FechaCreacion [datetime],
	@IdUsuarioModifica [int],
	@IdUsuarioCrea [int],
	@IdAtencion [int],
	@FechaOrden [datetime],
	@IdOrden [int] OUTPUT,
	@IdEstadoOrden [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int],
	@idPaciente [int],
	@idformaPago [int],
	@idFarmacia [int]
WITH EXECUTE AS CALLER
AS
insert into FactOrdenesBienesInsumo (
FechaModificacion,FechaCreacion,IdUsuarioModifica,IdUsuarioCrea,IdAtencion,FechaOrden,IdEstadoOrden,IdComprobantePago,IdPuntoCarga,idPaciente,idFormaPago,idFarmacia ) values (
@FechaModificacion,@FechaCreacion,@IdUsuarioModifica,@IdUsuarioCrea,@IdAtencion,@FechaOrden,@IdEstadoOrden,@IdComprobantePago,@IdPuntoCarga,@idPaciente,@idFormaPago,@idFarmacia)
set @IdOrden = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdOrden,'FactOrdenesBienesInsumo'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoEliminar]
	@IdOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenesBienesInsumo
where IdOrden = @IdOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdOrden,'FactOrdenesBienesInsumo'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoEliminarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoEliminarV2]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenesBienesInsumo
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoEliminarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoEliminarV3]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoEliminarV3]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesInsumos where IdOrden = @IdOrden
delete from FactOrdenesBienesInsumo where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoEliminarV3] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoFiltrado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoFiltrado]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select FactOrdenesBienesInsumo.IdOrden, FactOrdenesBienesInsumo.FechaOrden, FactOrdenesBienesInsumo.IdPuntoCarga,
         FactPuntosCarga.Descripcion as DescPuntoCarga, FactOrdenesBienesInsumo.IdAtencion,
         Pacientes.NroHistoriaClinica , Pacientes.ApellidoPaterno , Pacientes.ApellidoMaterno, Pacientes.PrimerNombre,
         EstadosOrden.IdEstadoOrden, EstadosOrden.Descripcion as EstadoOrden
         from (((FactOrdenesBienesInsumo
         left join Atenciones on FactOrdenesBienesInsumo.IdAtencion = Atenciones.idAtencion)
         left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
         left join FactPuntosCarga on FactOrdenesBienesInsumo.IdPuntoCarga = FactPuntosCarga.IdPuntoCarga)
         left join EstadosOrden on FactOrdenesBienesInsumo.IdEstadoOrden = EstadosOrden.IdEstadoOrden   '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoFiltrado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select FactOrdenesBienesInsumo.IdOrden, FactOrdenesBienesInsumo.FechaOrden, FactOrdenesBienesInsumo.IdPuntoCarga,
         FactPuntosCarga.Descripcion as DescPuntoCarga, FactOrdenesBienesInsumo.IdAtencion,
         Pacientes.NroHistoriaClinica , Pacientes.ApellidoPaterno , Pacientes.ApellidoMaterno, Pacientes.PrimerNombre,
         EstadosOrden.IdEstadoOrden, EstadosOrden.Descripcion as EstadoOrden
         from (((FactOrdenesBienesInsumo
         left join Atenciones on FactOrdenesBienesInsumo.IdAtencion = Atenciones.idAtencion)
         left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
         left join FactPuntosCarga on FactOrdenesBienesInsumo.IdPuntoCarga = FactPuntosCarga.IdPuntoCarga)
         left join EstadosOrden on FactOrdenesBienesInsumo.IdEstadoOrden = EstadosOrden.IdEstadoOrden   '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoModificar]
	@FechaModificacion [datetime],
	@FechaCreacion [datetime],
	@IdUsuarioModifica [int],
	@IdUsuarioCrea [int],
	@IdAtencion [int],
	@FechaOrden [datetime],
	@IdOrden [int],
	@IdEstadoOrden [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int],
	@idPaciente [int],
	@idformaPago [int],
	@idFarmacia [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenesBienesInsumo
set
FechaModificacion = getdate(),
FechaCreacion = @FechaCreacion,
IdUsuarioModifica = @IdUsuarioAuditoria,
IdUsuarioCrea = @IdUsuarioCrea,
IdAtencion = @IdAtencion,
FechaOrden = @FechaOrden,
IdEstadoOrden = @IdEstadoOrden,
IdComprobantePago = @IdComprobantePago,
IdPuntoCarga = @IdPuntoCarga,
idPaciente=@idPaciente,
idFormaPago=@idformaPago,
idFarmacia=@idFarmacia
 where IdOrden = @IdOrden
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdOrden,'FactOrdenesBienesInsumo'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoSeleccionarPorId]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesBienesInsumo
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoXidComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoXidComprobantePago]
	@lIdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select IdOrden from FactOrdenesBienesInsumo
    where IdComprobantePago = @lIdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoXidComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesInsumoXidCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesInsumoXidCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select FactOrdenesBienesInsumo.IdOrden, convert(varchar(30), FactOrdenesBienesInsumo.IdOrden) + ' ' + rtrim(FactPuntosCarga.Descripcion) as Descripcion
     from ((FactOrdenesBienesInsumo
     left join Atenciones on FactOrdenesBienesInsumo.IdAtencion = Atenciones.IdAtencion)
     left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
     left join FactPuntosCarga on FactOrdenesBienesInsumo.IdPuntoCarga = FactPuntosCarga.IdPuntoCarga
     Where FacturacionCuentasAtencion.IdCuentaAtencion = @IdCuentaAtencion
     and FactOrdenesBienesInsumo.IdEstadoOrden = 1
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesInsumoXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesModificar]
	@idOrden [int],
	@idPuntoCarga [int],
	@IdPaciente [int],
	@idCuentaAtencion [int],
	@idComprobantePago [int],
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idPreventa [int],
	@FechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoFacturacion [int],
	@ImporteExonerado [money],
	@idUsuarioExonera [int],
	@IdUsuarioAuditoria [int],
	@Descripcion [varchar](200),
	@Paquete [varchar](100),
	@Dni [varchar](12),
	@NombPaciente [varchar](100)
WITH EXECUTE AS CALLER
AS
Declare @Desc as Varchar(200)
select @Desc=Paquete from FactOrdenesBienes where idOrden = @idOrden
if @Paquete is not null
begin
update FactOrdenesBienes
set
idPuntoCarga = @idPuntoCarga,
IdPaciente = @IdPaciente,
idCuentaAtencion = @idCuentaAtencion,
idComprobantePago = @idComprobantePago,
MovNumero = @MovNumero,
MovTipo = @MovTipo,
idPreventa = @idPreventa,
FechaCreacion = @FechaCreacion,
idUsuario = @idUsuario,
idEstadoFacturacion = @idEstadoFacturacion,
ImporteExonerado=@ImporteExonerado,
idUsuarioExonera=@idUsuarioExonera,
Descripcion=@Descripcion,
Paquete=@Paquete,
DNI =@Dni,
NombPaciente=@NombPaciente
where idOrden = @idOrden

end
else if @Paquete is null
begin
update FactOrdenesBienes
set
idPuntoCarga = @idPuntoCarga,
IdPaciente = @IdPaciente,
idCuentaAtencion = @idCuentaAtencion,
idComprobantePago = @idComprobantePago,
MovNumero = @MovNumero,
MovTipo = @MovTipo,
idPreventa = @idPreventa,
FechaCreacion = @FechaCreacion,
idUsuario = @idUsuario,
idEstadoFacturacion = @idEstadoFacturacion,
ImporteExonerado=@ImporteExonerado,
idUsuarioExonera=@idUsuarioExonera,
Descripcion=@Descripcion,
DNI =@Dni,
NombPaciente=@NombPaciente
where idOrden = @idOrden
end
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesSeleccionarPorId]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesBienes
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesSeleccionarPorIdComprobantePago]
	@idComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idTipoFinanciamiento AS idfinanciamientoVenta, dbo.FactOrdenesBienes.*,
                      dbo.farmMovimiento.fechaCreacion AS fechaCreacionMovim, dbo.farmMovimiento.idUsuario AS idUsuarioMovim,
                      dbo.FacturacionBienesPagos.IdProducto, dbo.FacturacionBienesPagos.CantidadPagar,
                      dbo.FacturacionBienesPagos.PrecioVenta, dbo.FacturacionBienesPagos.TotalPagar
FROM         dbo.FacturacionBienesPagos LEFT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.FactOrdenesBienes.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FactOrdenesBienes.MovTipo = dbo.farmMovimientoVentas.movTipo
where dbo.FactOrdenesBienes.idComprobantePago = @idComprobantePago
order by  dbo.FactOrdenesBienes.idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesSeleccionarPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesSeleccionarPorIdCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                      dbo.FactOrdenesBienes.idEstadoFacturacion
FROM         dbo.FactOrdenesBienes INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.FactOrdenesBienes.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FactOrdenesBienes.MovTipo = dbo.farmMovimientoVentas.movTipo
where     dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesSeleccionarPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesSeleccionarPorIdPreVenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesSeleccionarPorIdPreVenta]
	@IdPreVenta [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesBienes
where IdPreVenta = @IdPreVenta
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesSeleccionarPorIdPreVenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesSeleccionarPorMovNumero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesSeleccionarPorMovNumero]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesBienes
where MovNumero= @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesSeleccionarPorMovNumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesBienesXimporteExoneradoMayorAcero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesBienesXimporteExoneradoMayorAcero]
	@IdEmpleado [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @IdEmpleado >0
	BEGIN
		SELECT     RTRIM(Empleados_1.ApellidoPaterno) + ' ' + RTRIM(Empleados_1.ApellidoMaterno) + ' ' + Empleados_1.Nombres AS EmpCajero,
		          RTRIM(Empleados_2.ApellidoPaterno) + ' ' + RTRIM(Empleados_2.ApellidoMaterno) + ' ' + Empleados_2.Nombres AS EmpExonera,
		          dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.ImporteExonerado, dbo.FactOrdenesBienes.FechaCreacion,
		          dbo.FactOrdenesBienes.idUsuarioExonera, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
		          dbo.CajaComprobantesPago.RazonSocial , dbo.CajaComprobantesPago.IdCuentaAtencion,dbo.CajaComprobantesPago.idEstadoComprobante
		FROM         dbo.FactOrdenesBienes INNER JOIN
		          dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
		          dbo.Empleados Empleados_1 ON dbo.CajaComprobantesPago.IdCajero = Empleados_1.IdEmpleado LEFT OUTER JOIN
		          dbo.Empleados Empleados_2 ON dbo.FactOrdenesBienes.idUsuarioExonera = Empleados_2.IdEmpleado
		Where (dbo.FactOrdenesBienes.ImporteExonerado > 0) and dbo.FactOrdenesBienes.idUsuarioExonera=@IdEmpleado
		       and dbo.FactOrdenesBienes.FechaCreacion Between @FechaInicio and @FechaFin
		       and dbo.CajaComprobantesPago.idEstadoComprobante=4
		ORDER BY dbo.FactOrdenesBienes.FechaCreacion
	END
ELSE
	BEGIN
		SELECT     RTRIM(Empleados_1.ApellidoPaterno) + ' ' + RTRIM(Empleados_1.ApellidoMaterno) + ' ' + Empleados_1.Nombres AS EmpCajero,
		          RTRIM(Empleados_2.ApellidoPaterno) + ' ' + RTRIM(Empleados_2.ApellidoMaterno) + ' ' + Empleados_2.Nombres AS EmpExonera,
		          dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.ImporteExonerado, dbo.FactOrdenesBienes.FechaCreacion,
		          dbo.FactOrdenesBienes.idUsuarioExonera, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
		          dbo.CajaComprobantesPago.RazonSocial , dbo.CajaComprobantesPago.IdCuentaAtencion,dbo.CajaComprobantesPago.idEstadoComprobante
		FROM         dbo.FactOrdenesBienes INNER JOIN
		          dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
		          dbo.Empleados Empleados_1 ON dbo.CajaComprobantesPago.IdCajero = Empleados_1.IdEmpleado LEFT OUTER JOIN
		          dbo.Empleados Empleados_2 ON dbo.FactOrdenesBienes.idUsuarioExonera = Empleados_2.IdEmpleado
		Where (dbo.FactOrdenesBienes.ImporteExonerado > 0)
		       and dbo.FactOrdenesBienes.FechaCreacion Between @FechaInicio and @FechaFin
		       and dbo.CajaComprobantesPago.idEstadoComprobante=4
		ORDER BY dbo.FactOrdenesBienes.FechaCreacion
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesBienesXimporteExoneradoMayorAcero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioAgregar]
	@FechaModificacion [datetime],
	@FechaCreacion [datetime],
	@IdUsuarioModifica [int],
	@IdUsuarioCrea [int],
	@IdAtencion [int],
	@FechaOrden [datetime],
	@IdPuntoCarga [int],
	@IdOrden [int] OUTPUT,
	@IdEstadoOrden [int],
	@IdComprobantePago [int],
	@IdUsuarioAuditoria [int],
	@IdFormaPago [int]
WITH EXECUTE AS CALLER
AS
insert into FactOrdenesServicio (
FechaModificacion,FechaCreacion,IdUsuarioModifica,IdUsuarioCrea,IdAtencion,FechaOrden,IdPuntoCarga,IdEstadoOrden,IdComprobantePago,IdFormaPago) values (
@FechaModificacion,@FechaCreacion,@IdUsuarioModifica,@IdUsuarioCrea,@IdAtencion,@FechaOrden,@IdPuntoCarga,@IdEstadoOrden,@IdComprobantePago,@IdFormaPago)
set @IdOrden = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdOrden,'FactOrdenesServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioEliminar]
	@IdOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenesServicio
where IdOrden = @IdOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdOrden,'FactOrdenesServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioEliminarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioEliminarV2]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenesServicio
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioEliminarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioEliminarV3]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioEliminarV3]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicios where IdOrden = @IdOrden
delete from FactOrdenesServicio where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioEliminarV3] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioModificar]
	@FechaModificacion [datetime],
	@FechaCreacion [datetime],
	@IdUsuarioModifica [int],
	@IdUsuarioCrea [int],
	@IdAtencion [int],
	@FechaOrden [datetime],
	@IdPuntoCarga [int],
	@IdOrden [int],
	@IdEstadoOrden [int],
	@IdComprobantePago [int],
	@IdUsuarioAuditoria [int],
	@IdFormaPago [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenesServicio
set
FechaModificacion = @FechaModificacion,
FechaCreacion = @FechaCreacion,
IdUsuarioModifica = @IdUsuarioModifica,
IdUsuarioCrea = @IdUsuarioCrea,
IdAtencion = @IdAtencion,
FechaOrden = @FechaOrden,
IdPuntoCarga = @IdPuntoCarga,
IdEstadoOrden = @IdEstadoOrden,
IdComprobantePago = @IdComprobantePago,
IdFormaPago=@IdFormaPago
where IdOrden = @IdOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdOrden,'FactOrdenesServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenesServicioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenesServicioSeleccionarPorId]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesServicio
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenesServicioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioActualizaIdFuenteFinanciamientoPagantes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioActualizaIdFuenteFinanciamientoPagantes]
WITH EXECUTE AS CALLER
AS
update factOrdenServicio set idFuenteFinanciamiento=1 where  (idfuenteFInanciamiento is null) and (idTipoFinanciamiento=1)
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioActualizaIdFuenteFinanciamientoPagantes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioAgregar]
	@IdOrden [int] OUTPUT,
	@IdPuntoCarga [int],
	@IdPaciente [int],
	@IdCuentaAtencion [int],
	@IdServicioPaciente [int],
	@idTipoFinanciamiento [int],
	@idFuenteFinanciamiento [int],
	@FechaCreacion [datetime],
	@IdUsuario [int],
	@FechaDespacho [datetime],
	@IdUsuarioDespacho [int],
	@IdEstadoFacturacion [int],
	@FechaHoraRealizaCpt [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactOrdenServicio (
IdPuntoCarga,IdPaciente,IdCuentaAtencion,idTipoFinanciamiento,FechaCreacion,IdUsuario,IdEstadoFacturacion,idFuenteFinanciamiento,FechaDespacho,IdUsuarioDespacho,IdServicioPaciente,FechaHoraRealizaCpt) values (
@IdPuntoCarga,@IdPaciente,@IdCuentaAtencion,@idTipoFinanciamiento,@FechaCreacion,@IdUsuario,@IdEstadoFacturacion,@idFuenteFinanciamiento,@FechaDespacho,@IdUsuarioDespacho,@IdServicioPaciente,@FechaHoraRealizaCpt)
set @IdOrden = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdOrden,'FactOrdenServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioEliminar]
	@IdOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenServicio
where IdOrden = @IdOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdOrden,'FactOrdenServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioFiltraPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioFiltraPorIdCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.*, dbo.FacturacionServicioDespacho.IdProducto, dbo.FacturacionServicioDespacho.cantidad,
	     dbo.FacturacionServicioDespacho.precio,  dbo.FacturacionServicioDespacho.total
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FacturacionServicioDespacho ON dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioDespacho.idOrden
WHERE dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion
order by  dbo.FactOrdenServicio.idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioFiltraPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioIdServicioPacienteNull]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioIdServicioPacienteNull]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdTipoServicio, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPuntoCarga,
                     dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdServicioPaciente, dbo.Atenciones.FechaIngreso,
                     dbo.Atenciones.HoraIngreso , dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.IdServicioIngreso,dbo.FactOrdenServicio.FechaDespacho
FROM         dbo.Atenciones RIGHT OUTER JOIN
                     dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion
Where   (dbo.FactOrdenServicio.IdServicioPaciente IS NULL) AND (dbo.Atenciones.IdTipoServicio > 1)
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioIdServicioPacienteNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioModificar]
	@IdOrden [int],
	@IdPuntoCarga [int],
	@IdPaciente [int],
	@IdCuentaAtencion [int],
	@IdServicioPaciente [int],
	@idTipoFinanciamiento [int],
	@idFuenteFinanciamiento [int],
	@FechaCreacion [datetime],
	@IdUsuario [int],
	@FechaDespacho [datetime],
	@IdUsuarioDespacho [int],
	@IdEstadoFacturacion [int],
	@FechaHoraRealizaCpt [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenServicio
set
IdPuntoCarga = @IdPuntoCarga,
IdPaciente = @IdPaciente,
IdCuentaAtencion = @IdCuentaAtencion,
idTipoFinanciamiento = @idTipoFinanciamiento,
FechaCreacion = @FechaCreacion,
IdUsuario = @IdUsuario,
IdEstadoFacturacion = @IdEstadoFacturacion,
idFuenteFinanciamiento=@idFuenteFinanciamiento,
FechaDespacho=@FechaDespacho,
IdUsuarioDespacho=@IdUsuarioDespacho,
IdServicioPaciente=@IdServicioPaciente,
FechaHoraRealizaCpt=@FechaHoraRealizaCpt
where IdOrden = @IdOrden
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdOrden,'FactOrdenServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosActualizaExoneracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosActualizaExoneracion]
	@idOrdenPago [int],
	@importeExonerado [money],
	@idUsuarioExonera [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenServicioPagos set ImporteExonerado =@importeExonerado, idUsuarioExonera=@idUsuarioExonera
              where idOrdenPago  =@idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosActualizaExoneracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosAgregar]
	@idOrdenPago [int] OUTPUT,
	@idComprobantePago [int],
	@idOrden [int],
	@FechaCreacion [datetime],
	@IdUsuario [int],
	@IdEstadoFacturacion [int],
	@ImporteExonerado [money],
	@idUsuarioExonera [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactOrdenServicioPagos (
idComprobantePago,idOrden,FechaCreacion,IdUsuario,IdEstadoFacturacion,ImporteExonerado,idUsuarioExonera) values (
@idComprobantePago,@idOrden,@FechaCreacion,@IdUsuario,@IdEstadoFacturacion,@ImporteExonerado,@idUsuarioExonera)
set @idOrdenPago = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idOrdenPago,'FactOrdenServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosEliminar]
	@idOrdenPago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactOrdenServicioPagos
where idOrdenPago = @idOrdenPago
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrdenPago,'FactOrdenServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosModificar]
	@idOrdenPago [int],
	@idComprobantePago [int],
	@idOrden [int],
	@FechaCreacion [datetime],
	@IdUsuario [int],
	@IdEstadoFacturacion [int],
	@ImporteExonerado [money],
	@idUsuarioExonera [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactOrdenServicioPagos
set
idComprobantePago = @idComprobantePago,
idOrden = @idOrden,
FechaCreacion = @FechaCreacion,
IdUsuario = @IdUsuario,
IdEstadoFacturacion = @IdEstadoFacturacion,
ImporteExonerado=@ImporteExonerado,
idUsuarioExonera=@idUsuarioExonera
where idOrdenPago = @idOrdenPago
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idOrdenPago,'FactOrdenServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosPendientesDePagoPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosPendientesDePagoPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdDocIdentidad
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden
WHERE     (dbo.FactOrdenServicioPagos.idComprobantePago IS NULL) AND (dbo.FactOrdenServicioPagos.IdEstadoFacturacion = 1 or dbo.FactOrdenServicioPagos.IdEstadoFacturacion = 16)
                  and  dbo.FactOrdenServicioPagos.FechaCreacion BETWEEN  @FechaInicio and  @FechaFin
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosPendientesDePagoPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosPendientesDePagoPorIdOrdenPago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosPendientesDePagoPorIdOrdenPago]
	@idOrdenPago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.IdEstadoFacturacion,
                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.Atenciones.IdAtencion, dbo.FactOrdenServicio.idPaciente,
	     dbo.FactOrdenServicio.idTipofinanciamiento, dbo.FactOrdenServicioPagos.ImporteExonerado,dbo.Pacientes.NroDocumento,
                      dbo.Atenciones.EpsPorcentaje ,dbo.Atenciones.FechaIngreso
FROM         dbo.Atenciones RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden
WHERE     (dbo.FactOrdenServicioPagos.idComprobantePago IS NULL) AND (dbo.FactOrdenServicioPagos.IdEstadoFacturacion = 1 or dbo.FactOrdenServicioPagos.IdEstadoFacturacion = 16)
                  and  dbo.FactOrdenServicioPagos.idOrdenPago=@idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosPendientesDePagoPorIdOrdenPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosPorIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.FechaCreacion,
                      dbo.Atenciones.IdAtencion, dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactOrdenServicioPagos.idOrden
FROM         dbo.FactOrdenServicio INNER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden
WHERE     (dbo.Atenciones.IdAtencion = @idAtencion) AND (dbo.FactOrdenServicio.IdEstadoFacturacion = 1)
ORDER BY dbo.FactOrdenServicio.FechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosPorIdAtencionIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosPorIdAtencionIdProducto]
	@idAtencion [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idOrdenPago as idOrden, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.FechaCreacion,
                      dbo.Atenciones.IdAtencion, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio, dbo.FacturacionServicioPagos.Total, dbo.FactOrdenServicioPagos.idEstadoFacturacion
FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE    dbo.Atenciones.IdAtencion=@idAtencion and  dbo.FacturacionServicioPagos.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosPorIdAtencionIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosPorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosPorIdCuentaAtencion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicioPagos.idOrdenPago,
                      dbo.FactOrdenServicio.FechaDespacho
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden
WHERE    dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosPorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosSeleccionarPorId]
	@idOrdenPago [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicioPagos
where idOrdenPago = @idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosSeleccionarPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.FechaCreacion,
		dbo.FacturacionServicioPagos.*
FROM         dbo.FactOrdenServicioPagos RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
where dbo.FactOrdenServicioPagos.idComprobantePago=@IdComprobantePago
ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosSeleccionarPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosSeleccionarPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicioPagos
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosSeleccionarPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosSeleccionarXidComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosSeleccionarXidComprobantePago]
	@IdComprobantePagoActual [int]
WITH EXECUTE AS CALLER
AS
select *
from FactOrdenServicioPagos
where idComprobantePago=@IdComprobantePagoActual
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosSeleccionarXidComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosXIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosXIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.FechaCreacion,
                      dbo.Atenciones.IdAtencion, dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicio.IdEstadoFacturacion ,dbo.FactOrdenServicioPagos.idComprobantePago
FROM         dbo.FactOrdenServicio INNER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden
WHERE     (dbo.Atenciones.IdAtencion = @idAtencion)
ORDER BY dbo.FactOrdenServicio.FechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosXIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPagosXImporteExoneradoMayorAcero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPagosXImporteExoneradoMayorAcero]
	@IdEmpleado [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @IdEmpleado >0
	BEGIN
		SELECT      dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.idComprobantePago,
		        dbo.FactOrdenServicioPagos.ImporteExonerado, dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.idUsuarioExonera,
		        Empleados_1.IdEmpleado, RTRIM(Empleados_2.ApellidoPaterno) + ' ' + RTRIM(Empleados_2.ApellidoMaterno)
		        + ' ' + Empleados_2.Nombres AS EmpExonera, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
		        dbo.CajaComprobantesPago.RazonSocial , dbo.CajaComprobantesPago.IdCuentaAtencion, RTrim(Empleados_1.ApellidoPaterno)
		        + ' ' + RTRIM(Empleados_1.ApellidoMaterno) + ' ' + Empleados_1.Nombres AS EmpCajero,dbo.CajaComprobantesPago.idEstadoComprobante
		FROM         dbo.Empleados Empleados_1 RIGHT OUTER JOIN
		        dbo.FactOrdenServicioPagos INNER JOIN
		        dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago ON
		        Empleados_1.IdEmpleado = dbo.CajaComprobantesPago.IdCajero LEFT OUTER JOIN
		        dbo.Empleados Empleados_2 ON dbo.FactOrdenServicioPagos.idUsuarioExonera = Empleados_2.IdEmpleado
		Where (dbo.FactOrdenServicioPagos.ImporteExonerado > 0)  and dbo.FactOrdenServicioPagos.idUsuarioExonera= @IdEmpleado
		       and dbo.FactOrdenServicioPagos.FechaCreacion Between @FechaInicio and @FechaFin
		       and dbo.CajaComprobantesPago.idEstadoComprobante=4
		ORDER BY dbo.FactOrdenServicioPagos.FechaCreacion
	END
ELSE
	BEGIN
		SELECT      dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.idComprobantePago,
		        dbo.FactOrdenServicioPagos.ImporteExonerado, dbo.FactOrdenServicioPagos.FechaCreacion, dbo.FactOrdenServicioPagos.idUsuarioExonera,
		        Empleados_1.IdEmpleado, RTRIM(Empleados_2.ApellidoPaterno) + ' ' + RTRIM(Empleados_2.ApellidoMaterno)
		        + ' ' + Empleados_2.Nombres AS EmpExonera, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
		        dbo.CajaComprobantesPago.RazonSocial , dbo.CajaComprobantesPago.IdCuentaAtencion, RTrim(Empleados_1.ApellidoPaterno)
		        + ' ' + RTRIM(Empleados_1.ApellidoMaterno) + ' ' + Empleados_1.Nombres AS EmpCajero,dbo.CajaComprobantesPago.idEstadoComprobante
		FROM         dbo.Empleados Empleados_1 RIGHT OUTER JOIN
		        dbo.FactOrdenServicioPagos INNER JOIN
		        dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago ON
		        Empleados_1.IdEmpleado = dbo.CajaComprobantesPago.IdCajero LEFT OUTER JOIN
		        dbo.Empleados Empleados_2 ON dbo.FactOrdenServicioPagos.idUsuarioExonera = Empleados_2.IdEmpleado
		Where (dbo.FactOrdenServicioPagos.ImporteExonerado > 0)
		       and dbo.FactOrdenServicioPagos.FechaCreacion Between @FechaInicio and  @FechaFin
		       and dbo.CajaComprobantesPago.idEstadoComprobante=4
		ORDER BY dbo.FactOrdenServicioPagos.FechaCreacion
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPagosXImporteExoneradoMayorAcero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@idServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
if @idServicioPaciente=0
	SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as NroHistoriaClinica,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
	                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,FechaDespacho,dbo.FactOrdenServicio.IdPaciente
	FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
	WHERE     (dbo.FactOrdenServicio.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin) and @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga
	ORDER BY dbo.FactOrdenServicio.fechaCreacion desc,dbo.FactOrdenServicio.IdOrden desc
else
	SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
	                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,FechaDespacho,dbo.FactOrdenServicio.IdPaciente
	FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
	WHERE     (dbo.FactOrdenServicio.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin) and @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga
		    and dbo.FactOrdenServicio.idServicioPaciente=@idServicioPaciente
	ORDER BY dbo.FactOrdenServicio.fechaCreacion desc,dbo.FactOrdenServicio.IdOrden desc
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPorFechasLab]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPorFechasLab]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,FechaDespacho, dbo.LabMovimientoLaboratorio.ordenaPrueba, dbo.LabMovimiento.IdLabEstado
FROM         dbo.LabMovimiento, dbo.LabMovimientoLaboratorio, dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
WHERE     (dbo.LabMovimiento.Fecha BETWEEN @FechaInicio and  @FechaFin) and @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga AND dbo.FactOrdenServicio.IdOrden= dbo.LabMovimientoLaboratorio.IdOrden AND dbo.LabMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento
ORDER BY dbo.LabMovimiento.Fecha desc,dbo.FactOrdenServicio.IdOrden desc
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPorFechasLab] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPorFechasLabPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPorFechasLabPaciente]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@Paciente [varchar](50),
	@lnUsandoFmovimiento [int]
WITH EXECUTE AS CALLER
AS
declare @pacientefiltro varchar(50)
 select @pacientefiltro='%'+@paciente+'%'
 if @lnUsandoFmovimiento=1
	 if @Paciente=''
		SELECT     dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
							  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.LabMovimientoLaboratorio.Paciente,dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
							  dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,convert(varchar,FechaDespacho,103) + ' ' +  convert(varchar,FechaDespacho,108) as FechaDespacho,
							  dbo.LabMovimientoLaboratorio.ordenaPrueba, dbo.LabMovimiento.IdLabEstado,dbo.FactOrdenServicio.FechaHoraRealizaCpt,
							 dbo.LabMovimientoLaboratorio.FechaNacimiento,dbo.LabMovimientoLaboratorio.idTipoSexo

		FROM         dbo.LabMovimiento, dbo.LabMovimientoLaboratorio, dbo.FactOrdenServicio LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
							  dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
		WHERE     (dbo.LabMovimiento.Fecha BETWEEN @FechaInicio and  @FechaFin) and
				  @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga AND
				  dbo.FactOrdenServicio.IdOrden= dbo.LabMovimientoLaboratorio.IdOrden AND
				  dbo.LabMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento
		ORDER BY dbo.LabMovimiento.Fecha desc,dbo.FactOrdenServicio.IdOrden desc
	else
		SELECT     dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
							  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.LabMovimientoLaboratorio.Paciente,dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
							  dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,convert(varchar,FechaDespacho,103) + ' ' +  convert(varchar,FechaDespacho,108) as FechaDespacho,
							  dbo.LabMovimientoLaboratorio.ordenaPrueba, dbo.LabMovimiento.IdLabEstado,dbo.FactOrdenServicio.FechaHoraRealizaCpt,
							 dbo.LabMovimientoLaboratorio.FechaNacimiento,dbo.LabMovimientoLaboratorio.idTipoSexo
		FROM         dbo.LabMovimiento, dbo.LabMovimientoLaboratorio, dbo.FactOrdenServicio LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
							  dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
		WHERE     (dbo.LabMovimiento.Fecha BETWEEN @FechaInicio and  @FechaFin) and
				   @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga AND
				   dbo.FactOrdenServicio.IdOrden= dbo.LabMovimientoLaboratorio.IdOrden AND
				   dbo.LabMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento and
				   dbo.LabMovimientoLaboratorio.Paciente like @pacientefiltro
		ORDER BY dbo.LabMovimiento.Fecha desc,dbo.FactOrdenServicio.IdOrden desc
else
	 if @Paciente=''
		SELECT     dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
							  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.LabMovimientoLaboratorio.Paciente,dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
							  dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,convert(varchar,FechaDespacho,103) + ' ' +  convert(varchar,FechaDespacho,108) as FechaDespacho,
							  dbo.LabMovimientoLaboratorio.ordenaPrueba, dbo.LabMovimiento.IdLabEstado,dbo.FactOrdenServicio.FechaHoraRealizaCpt,
							 dbo.LabMovimientoLaboratorio.FechaNacimiento,dbo.LabMovimientoLaboratorio.idTipoSexo
		FROM         dbo.LabMovimiento, dbo.LabMovimientoLaboratorio, dbo.FactOrdenServicio LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
							  dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
		WHERE     (dbo.FactOrdenServicio.FechaHoraRealizaCpt BETWEEN @FechaInicio and  @FechaFin) and
				  @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga AND
				  dbo.FactOrdenServicio.IdOrden= dbo.LabMovimientoLaboratorio.IdOrden AND
				  dbo.LabMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento
		ORDER BY dbo.FactOrdenServicio.FechaHoraRealizaCpt desc,dbo.FactOrdenServicio.IdOrden desc
	else
		SELECT     dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
							  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.LabMovimientoLaboratorio.Paciente,dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
							  dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion,convert(varchar,FechaDespacho,103) + ' ' +  convert(varchar,FechaDespacho,108) as FechaDespacho,
							  dbo.LabMovimientoLaboratorio.ordenaPrueba, dbo.LabMovimiento.IdLabEstado,dbo.FactOrdenServicio.FechaHoraRealizaCpt,
							 dbo.LabMovimientoLaboratorio.FechaNacimiento,dbo.LabMovimientoLaboratorio.idTipoSexo
		FROM         dbo.LabMovimiento, dbo.LabMovimientoLaboratorio, dbo.FactOrdenServicio LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
							  dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
		WHERE     (dbo.FactOrdenServicio.FechaHoraRealizaCpt BETWEEN @FechaInicio and  @FechaFin) and
				   @idPuntoCarga=dbo.FactOrdenServicio.idPuntoCarga AND
				   dbo.FactOrdenServicio.IdOrden= dbo.LabMovimientoLaboratorio.IdOrden AND
				   dbo.LabMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento and
				   dbo.LabMovimientoLaboratorio.Paciente like @pacientefiltro
		ORDER BY dbo.FactOrdenServicio.FechaHoraRealizaCpt desc,dbo.FactOrdenServicio.IdOrden desc

GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPorFechasLabPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPorFechasYTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPorFechasYTipoFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.FechaDespacho,
                      dbo.FactOrdenServicio.IdPaciente, dbo.Atenciones.IdFormaPago
FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
WHERE     (dbo.Atenciones.fechaEgreso BETWEEN  @FechaInicio and  @FechaFin) and @idTipoFinanciamiento=dbo.Atenciones.IdFormaPago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPorFechasYTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPoridOrdenConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPoridOrdenConexion]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.*, dbo.Servicios.Nombre AS dServicioPaciente
                FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                    dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio
                where dbo.FactOrdenServicio.idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPoridOrdenConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioPreventasServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioPreventasServicio]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idOrdenPago as  NroOrdenPago, dbo.FactPuntosCarga.Descripcion as Pto_Carga, dbo.FactOrdenServicio.FechaCreacion,
                      dbo.FactOrdenServicio.IdOrden, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,
                      dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden LEFT OUTER JOIN
                      dbo.FactPuntosCarga ON dbo.FactOrdenServicio.IdPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     (dbo.FactOrdenServicio.IdCuentaAtencion IS NULL) AND (dbo.FactOrdenServicio.IdServicioPaciente IS NULL) AND
                      (dbo.FactOrdenServicio.IdPuntoCarga = 1) AND (dbo.FactOrdenServicio.IdEstadoFacturacion IN (1, 4)) and
                   (dbo.FactOrdenServicio.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago desc
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioPreventasServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPorId]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicio
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPorIdComprobantePago]
	@idComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicio.IdServicioPaciente, dbo.Servicios.Nombre AS Dservicio,
                      dbo.Servicios.IdEspecialidad, dbo.Especialidades.Nombre AS DEspecialidad, dbo.Especialidades.IdDepartamento,
                      dbo.DepartamentosHospital.Nombre AS Ddpto, dbo.Servicios.IdTipoServicio, dbo.TiposServicio.Descripcion AS DTipoServicio,
	     dbo.FactOrdenServicioPagos.idOrdenPago,dbo.FactOrdenServicioPagos.importeExonerado
FROM         dbo.FactOrdenServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.TiposServicio RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento ON
                      dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
                      dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE        dbo.FactOrdenServicioPagos.idComprobantePago=@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPorIdCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicio
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.*, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Servicios.Nombre AS dservicio,dbo.Servicios.idTipoServicio
FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
WHERE  dbo.FactOrdenServicio.idOrden=@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPorIdOrdenPago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPorIdOrdenPago]
	@IdOrdenPago [int],
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicioPagos.idOrdenPago,dbo.FactOrdenServicio.FechaCreacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.EstadosFacturacion.Descripcion AS EstadoOrden,
                      dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.FechaDespacho
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion
where dbo.FactOrdenServicioPagos.idOrdenPago=@IdOrdenPago and dbo.FactOrdenServicio.IdPuntoCarga=@IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPorIdOrdenPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarPuntoCargaPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarPuntoCargaPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.*, dbo.FactPuntosCarga.Descripcion AS dPuntoCarga
FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.FactPuntosCarga ON dbo.FactOrdenServicio.IdPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
where    dbo.FactOrdenServicio.idOrden=@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarPuntoCargaPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarSoloAdmisionCE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarSoloAdmisionCE]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenesServicio
where idAtencion=@IdAtencion
and idPuntoCarga=6 and idEstadoOrden=1
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarSoloAdmisionCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select idFuenteFinanciamiento,idTipoFinanciamiento from FactOrdenServicio where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioSeleccionarXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioSeleccionarXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactOrdenServicio.*, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.CajaComprobantesPago.RazonSocial
                 FROM           dbo.FactOrdenServicio LEFT OUTER JOIN
                                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden LEFT OUTER JOIN
                                      dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
                 WHERE       dbo.FactOrdenServicio.idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioSeleccionarXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioXidCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioXidCuentaAtencion]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicio where idCuentaAtencion=@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FactOrdenServicio where idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactOrdenServicioXidOrdenConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactOrdenServicioXidOrdenConexion]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.FactOrdenServicio.IdOrden, dbo.FactPuntosCarga.idServicio, dbo.FactPuntosCarga.IdPuntoCarga
                FROM     dbo.FactOrdenServicio LEFT OUTER JOIN
                               dbo.FactPuntosCarga ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.FactPuntosCarga.idServicio
                WHERE dbo.FactOrdenServicio.IdOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FactOrdenServicioXidOrdenConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesAgregar]
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdPartidaPresupuestal [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
declare @IdPartida int
SELECT  top 1 @IdPartida=idPartidaPresupuestal FROM FactPartidasPresupuestales order by idPartidaPresupuestal desc
set @IdPartida=@IdPartida+1

insert into FactPartidasPresupuestales (idPartidaPresupuestal,Descripcion,Codigo) values
(@idPartida,@Descripcion,@Codigo)

--set @IdPartidaPresupuestal = @@Identity
set @IdPartidaPresupuestal =@idPartida

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPartidaPresupuestal,'FactPartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesEliminar]
	@IdPartidaPresupuestal [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactPartidasPresupuestales
where IdPartidaPresupuestal = @IdPartidaPresupuestal
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPartidaPresupuestal,'FactPartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesModificar]
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdPartidaPresupuestal [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactPartidasPresupuestales
set
Descripcion = @Descripcion,
Codigo = @Codigo
where IdPartidaPresupuestal = @IdPartidaPresupuestal
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPartidaPresupuestal,'FactPartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesSeleccionarPorId]
	@IdPartidaPresupuestal [int]
WITH EXECUTE AS CALLER
AS
select * from FactPartidasPresupuestales
where IdPartidaPresupuestal = @IdPartidaPresupuestal
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesSeleccionarTodas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesSeleccionarTodas]
WITH EXECUTE AS CALLER
AS
select * from FactPartidasPresupuestales
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesSeleccionarTodas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from FactPartidasPresupuestales
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesXidentificador]
	@IdPartidaPresupuestal [int]
WITH EXECUTE AS CALLER
AS
select * from FactPartidasPresupuestales where idPartidaPresupuestal=@IdPartidaPresupuestal
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesXMesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesXMesAgregar]
	@Fecha [datetime],
	@idPartida [int],
	@IdProducto [int],
	@ImpAnulado [money],
	@impExonerado [money],
	@ImpNormal [money],
	@ImpCancelado [money]
WITH EXECUTE AS CALLER
AS
insert   into FactPartidasPresupuestalesXMes (Fecha,idPartida,IdProducto,ImpAnulado,impExonerado,ImpNormal,ImpCancelado)
values                                                      (@Fecha,@idPartida,@IdProducto,@ImpAnulado,@impExonerado,@ImpNormal,@ImpCancelado)
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXMesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesXMesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesXMesEliminar]
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
delete  from factPartidasPresupuestalesXmes where fecha=convert(datetime,@fecha,103)
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXMesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesXMesResumen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesXMesResumen]
	@fechaInicio [datetime],
	@fechaFin [datetime],
	@idPartida [int],
	@esMedicamento [int]
WITH EXECUTE AS CALLER
AS
if @idPartida=0
           SELECT     idPartida, sum(ImpAnulado) as ImpAnulado, sum(impExonerado) as impExonerado, sum(ImpNormal) as impNormal,
                              sum(ImpCancelado) as ImpCancelado
           FROM         dbo.FactPartidasPresupuestalesXMes
           WHERE      Fecha Between @fechaInicio and @FechaFin
           group by idPartida
else
       if @esMedicamento=1
	SELECT     dbo.FactPartidasPresupuestalesXMes.IdProducto ,dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      sum(dbo.FactPartidasPresupuestalesXMes.ImpAnulado) as ImpAnulado,
	                      sum(dbo.FactPartidasPresupuestalesXMes.impExonerado) as ImpExonerado,
	                      sum( dbo.FactPartidasPresupuestalesXMes.ImpNormal) as ImpNormal,
	                      sum(dbo.FactPartidasPresupuestalesXMes.ImpCancelado) as ImpCancelado
	FROM         dbo.FactPartidasPresupuestalesXMes INNER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.FactPartidasPresupuestalesXMes.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE      dbo.FactPartidasPresupuestalesXMes.Fecha Between @fechaInicio and @FechaFin and dbo.FactPartidasPresupuestalesXMes.idPartida=@idPartida
             group by  dbo.FactPartidasPresupuestalesXMes.IdProducto ,dbo.FactCatalogoBienesInsumos.Codigo,dbo.FactCatalogoBienesInsumos.Nombre
      else
	SELECT     dbo.FactPartidasPresupuestalesXMes.IdProducto,dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      sum(dbo.FactPartidasPresupuestalesXMes.ImpAnulado) as ImpAnulado, sum(dbo.FactPartidasPresupuestalesXMes.impExonerado) as impExonerado,
	                      sum(dbo.FactPartidasPresupuestalesXMes.ImpNormal) as ImpNormal, sum(dbo.FactPartidasPresupuestalesXMes.ImpCancelado) as ImpCancelado
	FROM         dbo.FactPartidasPresupuestalesXMes INNER JOIN
	                      dbo.FactCatalogoServicios ON dbo.FactPartidasPresupuestalesXMes.IdProducto = dbo.FactCatalogoServicios.IdProducto
             WHERE      dbo.FactPartidasPresupuestalesXMes.Fecha Between @fechaInicio and @FechaFin and dbo.FactPartidasPresupuestalesXMes.idPartida=@idPartida
	group by   dbo.FactPartidasPresupuestalesXMes.IdProducto,dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXMesResumen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPartidasPresupuestalesXMesSelecionaUltimoProceso]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPartidasPresupuestalesXMesSelecionaUltimoProceso]
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
select  top 1 fecha  from factPartidasPresupuestalesXmes where fecha<=convert(datetime,@fecha,103) order by fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[FactPartidasPresupuestalesXMesSelecionaUltimoProceso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPreventaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPreventaAgregar]
	@idFactPreventa [int] OUTPUT,
	@idServicio [int],
	@idTipoFinanciamiento [int],
	@Total [money],
	@fechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoPreventa [int],
	@idAtencion [int],
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactPreventa (
idServicio,Total,fechaCreacion,idUsuario,idEstadoPreventa,idTipoFinanciamiento,idAtencion,idOrden) values (
@idServicio,@Total,@fechaCreacion,@idUsuario,@idEstadoPreventa,@idTipoFinanciamiento,@idAtencion,@idOrden)
set @idFactPreventa = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idFactPreventa,'FactPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FactPreventaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPreventaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPreventaEliminar]
	@idFactPreventa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactPreventa
where idFactPreventa = @idFactPreventa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactPreventa,'FactPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FactPreventaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPreventaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPreventaModificar]
	@idFactPreventa [int],
	@idServicio [int],
	@idTipoFinanciamiento [int],
	@Total [money],
	@fechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoPreventa [int],
	@idAtencion [int],
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactPreventa
set
idServicio = @idServicio,
Total = @Total,
fechaCreacion = @fechaCreacion,
idUsuario = @idUsuario,
idEstadoPreventa = @idEstadoPreventa,
idTipoFinanciamiento=@idTipoFinanciamiento,
idAtencion=@idAtencion,
idOrden=@idOrden
where idFactPreventa = @idFactPreventa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idFactPreventa,'FactPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FactPreventaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPreventaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPreventaSeleccionarPorId]
	@idFactPreventa [int]
WITH EXECUTE AS CALLER
AS
select * from FactPreventa
where idFactPreventa = @idFactPreventa
GO
ALTER AUTHORIZATION ON [dbo].[FactPreventaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaActualizaCupos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaActualizaCupos]
	@idPuntoCarga [int],
	@NroCupos [int],
	@NroCuposMinutos [int],
	@HoraInicioDiaCita [varchar](5)
WITH EXECUTE AS CALLER
AS
update FactPuntosCarga set NroCupos=@NroCupos,NroCuposMinutos=@NroCuposMinutos,HoraInicioDiaCita=@HoraInicioDiaCita where IdPuntoCarga =@idPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaActualizaCupos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaAgregar]
	@IdPuntoCarga [int],
	@TipoPunto [char](1),
	@Descripcion [char](50),
	@IdUPS [int],
	@IdServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactPuntosCarga (idPuntoCarga,
TipoPunto,Descripcion,IdUPS,IdServicio) values (@idPuntoCarga,
@TipoPunto,@Descripcion,@idUPS,@idServicio)
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaAgregarDesdeServiciosIdTipoServicio2y3]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaAgregarDesdeServiciosIdTipoServicio2y3]
	@IdPuntoCarga [int],
	@Descripcion [char](50),
	@IdUPS [int],
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
IF EXISTS(SELECT * from FactPuntosCarga WHERE IdServicio=@IdServicio)
	BEGIN
		update FactPuntosCarga set
		Descripcion = @Descripcion,
		IdUPS=@IdUPS
		where idServicio=@idServicio
	END
ELSE
	BEGIN
		insert into FactPuntosCarga (idPuntoCarga,Descripcion,IdUPS,IdServicio)
		values (@idPuntoCarga,@Descripcion,@idUPS,@idServicio)
	END
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaAgregarDesdeServiciosIdTipoServicio2y3] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaBienesInsumosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaBienesInsumosAgregar]
	@IdSubGrupoFarmacologico [int],
	@IdPuntoCarga [int],
	@IdPuntoCargaBienInsumo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactPuntosCargaBienesInsumos (
IdSubGrupoFarmacologico,IdPuntoCarga) values (
@IdSubGrupoFarmacologico,@IdPuntoCarga)
set @IdPuntoCargaBienInsumo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPuntoCargaBienInsumo,'FactPuntosCargaBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaBienesInsumosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaBienesInsumosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaBienesInsumosEliminar]
	@IdPuntoCargaBienInsumo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactPuntosCargaBienesInsumos
where IdPuntoCargaBienInsumo = @IdPuntoCargaBienInsumo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPuntoCargaBienInsumo,'FactPuntosCargaBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaBienesInsumosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaBienesInsumosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaBienesInsumosModificar]
	@IdSubGrupoFarmacologico [int],
	@IdPuntoCarga [int],
	@IdPuntoCargaBienInsumo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactPuntosCargaBienesInsumos
set
IdSubGrupoFarmacologico = @IdSubGrupoFarmacologico,
IdPuntoCarga = @IdPuntoCarga
where IdPuntoCargaBienInsumo = @IdPuntoCargaBienInsumo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPuntoCargaBienInsumo,'FactPuntosCargaBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaBienesInsumosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaBienesInsumosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaBienesInsumosSeleccionarPorId]
	@IdPuntoCargaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
select * from FactPuntosCargaBienesInsumos
where IdPuntoCargaBienInsumo = @IdPuntoCargaBienInsumo
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaBienesInsumosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from factPuntosCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaEliminar]
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactPuntosCarga
where IdPuntoCarga = @IdPuntoCarga
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPuntoCarga,'FactPuntosCarga'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)


   SET  @SQL =  'SELECT * FROM FactPuntosCarga WHERE '+@lcFiltro+'  ORDER BY descripcion  '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaModificar]
	@IdPuntoCarga [int],
	@TipoPunto [char](1),
	@Descripcion [char](50),
	@IdUPS [int],
	@idServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactPuntosCarga
set
TipoPunto = @TipoPunto,
Descripcion = @Descripcion,
IdUPS=@IdUPS,
idServicio=@idServicio
where IdPuntoCarga = @IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaSeleccionarIdServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaSeleccionarIdServicio]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from FactPuntosCarga where idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaSeleccionarIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaSeleccionarPorFiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1500)

SET  @SQL =  'select * from FactPuntosCarga where ' +  @Filtro + ' order by descripcion'



EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaSeleccionarPorId]
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
select * from FactPuntosCarga
where IdPuntoCarga = @IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaSeleccionarPorIdPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaSeleccionarPorIdPuntoCarga]
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.FactPuntosCarga.IdPuntoCarga, dbo.Servicios.IdServicio, dbo.Servicios.IdEspecialidad, dbo.Servicios.Nombre
                 FROM           dbo.FactPuntosCarga LEFT OUTER JOIN
                                      dbo.Servicios ON dbo.FactPuntosCarga.idServicio = dbo.Servicios.IdServicio
                 Where          (dbo.FactPuntosCarga.idPuntoCarga = @IdPuntoCarga)
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaSeleccionarPorIdPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select * from FactPuntosCarga order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaServicioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaServicioAgregar]
	@IdServicioSubGrupo [int],
	@IdPuntoCarga [int],
	@IdPuntoCargaServicio [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactPuntosCargaServicio (
IdServicioSubGrupo,IdPuntoCarga) values (
@IdServicioSubGrupo,@IdPuntoCarga)
set @IdPuntoCargaServicio = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPuntoCargaServicio,'FactPuntosCargaServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaServicioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaServicioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaServicioEliminar]
	@IdPuntoCargaServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactPuntosCargaServicio
where IdPuntoCargaServicio = @IdPuntoCargaServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPuntoCargaServicio,'FactPuntosCargaServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaServicioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaServicioModificar]
	@IdServicioSubGrupo [int],
	@IdPuntoCarga [int],
	@IdPuntoCargaServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactPuntosCargaServicio
set
IdServicioSubGrupo = @IdServicioSubGrupo,
IdPuntoCarga = @IdPuntoCarga
where IdPuntoCargaServicio = @IdPuntoCargaServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPuntoCargaServicio,'FactPuntosCargaServicio'
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaServicioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactPuntosCargaServicioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactPuntosCargaServicioSeleccionarPorId]
	@IdPuntoCargaServicio [int]
WITH EXECUTE AS CALLER
AS
select * from FactPuntosCargaServicio
where IdPuntoCargaServicio = @IdPuntoCargaServicio
GO
ALTER AUTHORIZATION ON [dbo].[FactPuntosCargaServicioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosAgregar]
	@idFactReembolso [int] OUTPUT,
	@Anio [int],
	@Mes [int],
	@idAreaTramitaSeguro [int],
	@idFuenteFinanciamiento [int],
	@Descripcion [varchar](300),
	@SaldoInicial [money],
	@ConsumoPorReembolsar [money],
	@ReembolsoPagado [money],
	@ReembolsoPorPagar [money],
	@SaldoFinal [money],
	@Documentos [varchar](100),
	@idEstadoReembolso [int],
	@idTipoConsumo [int],
	@idTipoComprobante [int],
	@GrabaDefinitivamente [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactReembolsos (
Anio,Mes,idAreaTramitaSeguro,idFuenteFinanciamiento,Descripcion,SaldoInicial,ConsumoPorReembolsar,ReembolsoPagado,ReembolsoPorPagar,SaldoFinal,Documentos,idEstadoReembolso,idTipoConsumo,idTipoComprobante,GrabaDefinitivamente ) values (
@Anio,@Mes,@idAreaTramitaSeguro,@idFuenteFinanciamiento,@Descripcion,@SaldoInicial,@ConsumoPorReembolsar,@ReembolsoPagado,@ReembolsoPorPagar,@SaldoFinal,@Documentos,@idEstadoReembolso,@idTipoConsumo,@idTipoComprobante,@GrabaDefinitivamente )
set @idFactReembolso = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosDocumentosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosDocumentosAgregar]
	@idFactReembolso [int],
	@idComprobantePago [int],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@MotivoAnulacion [varchar](150),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactReembolsosDocumentos (
idFactReembolso,idComprobantePago,NroSerie,NroDocumento,MotivoAnulacion) values (
@idFactReembolso,@idComprobantePago,@NroSerie,@NroDocumento,@MotivoAnulacion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idFactReembolso,'FactReembolsosDocumentos'
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosDocumentosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosDocumentosEliminar]
	@idFactReembolso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactReembolsosDocumentos
where idFactReembolso = @idFactReembolso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactReembolso,'FactReembolsosDocumentos'
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosDocumentosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosDocumentosModificar]
	@idFactReembolso [int],
	@idComprobantePago [int],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@MotivoAnulacion [varchar](150),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactReembolsosDocumentos
set
idComprobantePago = @idComprobantePago,
NroSerie = @NroSerie,
NroDocumento = @NroDocumento,
MotivoAnulacion=@MotivoAnulacion
where idFactReembolso = @idFactReembolso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idFactReembolso,'FactReembolsosDocumentos'
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosDocumentosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosDocumentosSeleccionarPorId]
	@idFactReembolso [int]
WITH EXECUTE AS CALLER
AS
select * from FactReembolsosDocumentos
where idFactReembolso = @idFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosDocumentosXIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosDocumentosXIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.FacturacionReembolsos.idCuentaAtencion, dbo.FacturacionReembolsos.ReembolsoPagadoServicio,
        dbo.FactReembolsosDocumentos.idFactReembolso, dbo.FactReembolsosDocumentos.idComprobantePago,
        dbo.FactReembolsos.idFuenteFinanciamiento
FROM         dbo.FactReembolsosDocumentos RIGHT OUTER JOIN
        dbo.FacturacionReembolsos ON
        dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso FULL OUTER JOIN
        dbo.FactReembolsos ON dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FactReembolsos.idFactReembolso
WHERE      dbo.FactReembolsosDocumentos.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosDocumentosXIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosEliminar]
	@idFactReembolso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactReembolsos
where idFactReembolso = @idFactReembolso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactReembolso,'FactReembolsos'
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosModificar]
	@idFactReembolso [int],
	@Anio [int],
	@Mes [int],
	@idAreaTramitaSeguro [int],
	@idFuenteFinanciamiento [int],
	@Descripcion [varchar](300),
	@SaldoInicial [money],
	@ConsumoPorReembolsar [money],
	@ReembolsoPagado [money],
	@ReembolsoPorPagar [money],
	@SaldoFinal [money],
	@Documentos [varchar](100),
	@idEstadoReembolso [int],
	@idTipoConsumo [int],
	@idTipoComprobante [int],
	@GrabaDefinitivamente [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactReembolsos
set
Anio = @Anio,
Mes = @Mes,
idAreaTramitaSeguro = @idAreaTramitaSeguro,
idFuenteFinanciamiento = @idFuenteFinanciamiento,
Descripcion = @Descripcion,
SaldoInicial = @SaldoInicial,
ConsumoPorReembolsar = @ConsumoPorReembolsar,
ReembolsoPagado = @ReembolsoPagado,
ReembolsoPorPagar = @ReembolsoPorPagar,
SaldoFinal = @SaldoFinal,
Documentos = @Documentos,
idEstadoReembolso = @idEstadoReembolso,
idTipoConsumo = @idTipoConsumo,
idTipoComprobante = @idTipoComprobante,
GrabaDefinitivamente=@GrabaDefinitivamente
where idFactReembolso = @idFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSeleccionarPorAnioMes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSeleccionarPorAnioMes]
	@Anio [int],
	@mes [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactReembolsos.*
FROM         dbo.FactReembolsos where factReembolsos.anio=@Anio and factReembolsos.mes=@mes
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSeleccionarPorAnioMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosSeleccionarPorId]
	@idFactReembolso [int]
WITH EXECUTE AS CALLER
AS
select * from FactReembolsos
where idFactReembolso = @idFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSeleccionarPorPlanAreats]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSeleccionarPorPlanAreats]
	@idFuenteFinanciamiento [int],
	@idAreaTramitaSeguro [int]
WITH EXECUTE AS CALLER
AS
select * from FactReembolsos
WHERE   idEstadoReembolso=1 and   idAreaTramitaSeguro=@idAreaTramitaSeguro and  idFuenteFinanciamiento=@idFuenteFinanciamiento
ORDER BY idFactReembolso desc
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSeleccionarPorPlanAreats] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSeleccionarXidentificador]
	@IdFactReembolso [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactReembolsos.*, dbo.AreaTramitaSeguros.Descripcion AS AreaTS, dbo.FuentesFinanciamiento.Descripcion AS [Plan]
             FROM         dbo.FactReembolsos LEFT OUTER JOIN
                                dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
			     dbo.AreaTramitaSeguros ON dbo.FactReembolsos.idAreaTramitaSeguro = dbo.AreaTramitaSeguros.idAreaTramitaSeguros
             WHERE     dbo.FactReembolsos.idFactReembolso=@IdFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSelecionarPorAnioYAreatsYPlan]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSelecionarPorAnioYAreatsYPlan]
	@Anio [int],
	@idFuenteFinanciamiento [int],
	@idAreaTramitaSeguro [int]
WITH EXECUTE AS CALLER
AS
if @idFuenteFinanciamiento=0 and @idAreaTramitaSeguro=0
	SELECT     dbo.FactReembolsos.*,  dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosReembolso.Estado
	FROM         dbo.FactReembolsos LEFT OUTER JOIN
	                      dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE  dbo.FactReembolsos.Anio=@Anio and dbo.FactReembolsos.idEstadoReembolso=1
	ORDER BY dbo.FactReembolsos.mes DESC
else
    if @idFuenteFinanciamiento=0 and @idAreaTramitaSeguro>0
	SELECT     dbo.FactReembolsos.*,  dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosReembolso.Estado
	FROM         dbo.FactReembolsos LEFT OUTER JOIN
	                      dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE  dbo.FactReembolsos.Anio=@Anio and dbo.FactReembolsos.idEstadoReembolso=1 and
                             dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro
	ORDER BY dbo.FactReembolsos.mes DESC
    else
	SELECT     dbo.FactReembolsos.*,  dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.EstadosReembolso.Estado
	FROM         dbo.FactReembolsos LEFT OUTER JOIN
	                      dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE  dbo.FactReembolsos.Anio=@Anio and dbo.FactReembolsos.idEstadoReembolso=1 and
                             dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro and  dbo.FactReembolsos.idFuenteFinanciamiento=@idFuenteFinanciamiento
	ORDER BY dbo.FactReembolsos.mes DESC
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSelecionarPorAnioYAreatsYPlan] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguro]
	@IdAreaTramitaSeguro [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactReembolsos.idFactReembolso, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
  --SCCQ 11/03/2020 Cambio17 Inicio
   case isnull(CCP.NroSerie,'')
   when  '' then CONVERT(varchar(4), FactReembolsosDocumentos.NroSerie) COLLATE modern_spanish_CI_AI
   else  CCP.NroSerie end as NroSerie,
   case isnull(CCP.NroDocumento,'')
   when  '' then CONVERT(varchar(8), FactReembolsosDocumentos.NroDocumento) COLLATE modern_spanish_CI_AI
   else rtrim(CCP.NroDocumento) end as NroDocumento,
  --SCCQ 11/03/2020 Cambio17 Fin
  dbo.FactReembolsos.Descripcion,
    dbo.FactReembolsos.ConsumoPorReembolsar, dbo.FactReembolsos.ReembolsoPagado, dbo.EstadosReembolso.Estado,
    dbo.FactReembolsos.idEstadoReembolso , dbo.FactReembolsos.GrabaDefinitivamente
FROM dbo.FactReembolsos INNER JOIN
 dbo.FactReembolsosDocumentos ON dbo.FactReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso
	--SCCQ 11/03/2020 Cambio17 Inicio

	LEFT join CajaComprobantesPago CCP on CCP.IdComprobantePago=FactReembolsosDocumentos.idComprobantePago
	--SCCQ 11/03/2020 Cambio17 Fin

	LEFT OUTER JOIN
    dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
    dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE  dbo.FactReembolsos.idAreaTramitaSeguro=@IdAreaTramitaSeguro
ORDER BY dbo.FactReembolsos.idFactReembolso DESC


--CAMBIO ID 2

/****** Object:  StoredProcedure [dbo].[DevuelveHIS_SITUACIOporDescripcion]    Script Date: 13/04/2020 16:52:29 ******/
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguros]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguros]
	@idAreaTramitaSeguro [int],
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
if @idCuentaAtencion>0
	SELECT
	                      dbo.FactReembolsos.idFactReembolso, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento, dbo.FactReembolsos.Descripcion,
	                      dbo.FactReembolsos.ConsumoPorReembolsar, dbo.FactReembolsos.ReembolsoPagado, dbo.EstadosReembolso.Estado,
	                      dbo.FactReembolsos.idEstadoReembolso, dbo.FacturacionReembolsos.idCuentaAtencion,dbo.FactReembolsos.GrabaDefinitivamente
	FROM         dbo.FactReembolsos INNER JOIN
	                      dbo.FactReembolsosDocumentos ON dbo.FactReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
	                      dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso LEFT OUTER JOIN
	                      dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE  dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro and dbo.FacturacionReembolsos.idCuentaAtencion=@idCuentaAtencion
	ORDER BY dbo.FactReembolsos.idFactReembolso DESC
else
	SELECT     dbo.FactReembolsos.idFactReembolso, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
	                      dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento, dbo.FactReembolsos.Descripcion,
	                      dbo.FactReembolsos.ConsumoPorReembolsar, dbo.FactReembolsos.ReembolsoPagado, dbo.EstadosReembolso.Estado,
	                      dbo.FactReembolsos.idEstadoReembolso, dbo.FactReembolsos.GrabaDefinitivamente
	FROM         dbo.FactReembolsos INNER JOIN
	                      dbo.FactReembolsosDocumentos ON dbo.FactReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
	                      dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE  dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro
	ORDER BY dbo.FactReembolsos.idFactReembolso DESC
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguros] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguroYCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguroYCuentaAtencion]
	@IdAreaTramitaSeguro [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT
dbo.FactReembolsos.idFactReembolso, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes, dbo.FuentesFinanciamiento.Descripcion AS [Plan],
dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento, dbo.FactReembolsos.Descripcion,
dbo.FactReembolsos.ConsumoPorReembolsar, dbo.FactReembolsos.ReembolsoPagado, dbo.EstadosReembolso.Estado,
dbo.FactReembolsos.idEstadoReembolso , dbo.FacturacionReembolsos.IdCuentaAtencion, dbo.FactReembolsos.GrabaDefinitivamente
FROM         dbo.FactReembolsos INNER JOIN
dbo.FactReembolsosDocumentos ON dbo.FactReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso LEFT OUTER JOIN
dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE  dbo.FactReembolsos.idAreaTramitaSeguro=@IdAreaTramitaSeguro and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
ORDER BY dbo.FactReembolsos.idFactReembolso DESC
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSelecionarPorAreaTramitaSeguroYCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FactReembolsosSelecionarPorIdAreaTramitaSeguro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FactReembolsosSelecionarPorIdAreaTramitaSeguro]
	@IdAreaTramitaSeguro [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactReembolsos.idFactReembolso, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes,
        dbo.FuentesFinanciamiento.Descripcion AS [Plan], dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento,
        dbo.FactReembolsos.Descripcion, dbo.FactReembolsos.ConsumoPorReembolsar, dbo.FactReembolsos.ReembolsoPagado,
        dbo.EstadosReembolso.Estado, dbo.FactReembolsos.idEstadoReembolso, dbo.FacturacionReembolsos.idCuentaAtencion,
        dbo.FactReembolsos.GrabaDefinitivamente, dbo.FacturacionReembolsos.ReembolsoPagadoFarmacia AS ReembPagadoFarm,
        dbo.FacturacionReembolsos.ReembolsoPagadoServicio AS ReembPagadoServ
FROM         dbo.FactReembolsos INNER JOIN
        dbo.FactReembolsosDocumentos ON dbo.FactReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
        dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso LEFT OUTER JOIN
        dbo.EstadosReembolso ON dbo.FactReembolsos.idEstadoReembolso = dbo.EstadosReembolso.idEstadoReembolso LEFT OUTER JOIN
        dbo.FuentesFinanciamiento ON dbo.FactReembolsos.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE  dbo.FactReembolsos.idEstadoReembolso=1 AND dbo.FactReembolsos.idAreaTramitaSeguro=@IdAreaTramitaSeguro
ORDER BY dbo.FactReembolsos.idFactReembolso DESC
GO
ALTER AUTHORIZATION ON [dbo].[FactReembolsosSelecionarPorIdAreaTramitaSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesAgregarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesAgregarV2]
	@IdFacturacionBienes [int] OUTPUT,
	@result [varchar](500) OUTPUT,
	@IdProducto [int],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdOrden [int],
	@IdUsuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
BEGIN TRANSACTION


--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdSubGrupoFarmacologico int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)
declare @TotalPorPagar money

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdSubGrupoFarmacologico =IdSubGrupoFarmacologico,
	@Nombre = Nombre from FactCatalogoBienesInsumos where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoBienesInsumosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin
                                                    set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    set @cantidadPagar=@cantidad
                                                    set @totalPagar =@cantidad * @PrecioUnitario
                                                    if @IdTipoFinanciamiento=2     --SIS
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSIS
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @IdTipoFinanciamiento=3     --SOAT
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSOAT
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @importeEXO>0     --EXONERACIONES
                                                    begin
                                                        set @TotalPorPagar =@TotalPorPagar-@importeEXO
                                                    end

				insert into FacturacionBienesInsumos  (
				IdProducto,PrecioUnitario,Cantidad,IdEstadoFacturacion,IdFuenteFinanciamiento,IdTipoFinanciamiento,IdComprobantePago, TotalPorPagar,IdUsuarioCrea,IdPuntoCarga,FechaCreacion,IdOrden,IdUsuarioAutorizaSeguro,IdUsuarioAutorizaPendiente,IdUsuarioAutorizaDevolucion,IdCajero,FechaAutorizaSeguro,FechaAutorizaPendiente,FechaAutorizaDevolucion,FechaCajero,IdAtencion,TotalPagar,cantidadPagar,ImporteSIS,ImporteEXO,IdUsuarioAutorizaEXO,FechaAutorizaEXO,ImporteSOAT,cantidadSIS,precioSIS,cantidadSOAT,precioSOAT,cantidadDev,FechaAutorizaConv,cantidadConv,precConv,ImporteConv) values (
				@IdProducto,@PrecioUnitario,@Cantidad,@IdEstadoFacturacion,@IdFuenteFinanciamiento,@IdTipoFinanciamiento,@IdComprobantePago, @totalPorPagar,@IdUsuarioAuditoria,@IdPuntoCarga,getdate(),@IdOrden,@IdUsuarioAutorizaSeguro,@IdUsuarioAutorizaPendiente,@IdUsuarioAutorizaDevolucion,@IdCajero,@FechaAutorizaSeguro,@FechaAutorizaPendiente,@FechaAutorizaDevolucion,@FechaCajero,@IdAtencion,@totalPagar,@CantidadPagar,@ImporteSIS,@ImporteEXO,@IdusuarioAutorizaEXO,@FechaAutorizaEXO,@ImporteSOAT,@cantidadSIS,@precioSIS,@cantidadSOAT,@precioSOAT,@cantidadDev,@FechaAutorizaConv,@cantidadConv,@precConv,@ImporteConv)
				set @IdFacturacionBienes = @@Identity
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionBienes,'FacturacionServicios'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end

COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesAgregarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@CantidadAdevolver [int],
	@IdComprobantePago [int],
	@IdEstadoDevolucion [int],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@MovNumeroE [varchar](9),
	@MovTipoE [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionBienesDevoluciones (
MovNumero,MovTipo,idProducto,CantidadAdevolver,IdComprobantePago,IdEstadoDevolucion,FechaAutoriza,IdUsuarioAutoriza,MovTipoE,MovNumeroE) values (
@MovNumero,@MovTipo,@idProducto,@CantidadAdevolver,@IdComprobantePago,@IdEstadoDevolucion,@FechaAutoriza,@IdUsuarioAutoriza,@MovTipoE,@MovNumeroE)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesEliminar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesDevoluciones
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesEliminarPorMovNumeroE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesEliminarPorMovNumeroE]
	@MovNumeroE [varchar](9),
	@MovTipoE [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesDevoluciones
where MovNumeroE = @MovNumeroE and MovTipoE=@MovTipoE
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesEliminarPorMovNumeroE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@CantidadAdevolver [int],
	@IdComprobantePago [int],
	@IdEstadoDevolucion [int],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@MovNumeroE [varchar](9),
	@MovTipoE [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesDevoluciones
set
MovTipo = @MovTipo,
idProducto = @idProducto,
CantidadAdevolver = @CantidadAdevolver,
IdComprobantePago = @IdComprobantePago,
IdEstadoDevolucion = @IdEstadoDevolucion,
FechaAutoriza = @FechaAutoriza,
IdUsuarioAutoriza = @IdUsuarioAutoriza,
MovNumeroE=@MovNumeroE,
MovTipoE=@MovTipoE
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesSeleccionarPorId]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesDevoluciones
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesSeleccionarPorIdProducto]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesDevoluciones
where MovNumero = @MovNumero and MovTipo=@MovTipo and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesSeleccionarPorMovNumeroE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesSeleccionarPorMovNumeroE]
	@MovNumeroE [varchar](9),
	@MovTipoE [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesDevoluciones
where MovNumeroE = @MovNumeroE and MovTipoE=@MovTipoE
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesSeleccionarPorMovNumeroE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesDevolucionesXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesDevolucionesXcuenta]
	@ml_idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionBienesDevoluciones.*
             FROM         dbo.FacturacionBienesDevoluciones LEFT OUTER JOIN
                                dbo.farmMovimientoNotaIngreso ON dbo.FacturacionBienesDevoluciones.MovNumeroE = dbo.farmMovimientoNotaIngreso.MovNumero
             WHERE dbo.farmMovimientoNotaIngreso.idCuentaAtencion = @ml_idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesDevolucionesXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamFiltrarXmovNumeroProductoTFinanc]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamFiltrarXmovNumeroProductoTFinanc]
	@MovNumero [varchar](50),
	@IdProducto [int],
	@IdtipoFinanciamiento [int],
	@MovTipo [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesFinanciamientos
	where           MovNumero=@MovNumero
			       and MOvTipo=@MovTipo and idProducto=@IdProducto
			       and idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamFiltrarXmovNumeroProductoTFinanc] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosActualizaCantidadPrecioTotal]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosActualizaCantidadPrecioTotal]
	@CantidadFinanciada [int],
	@PrecioFinanciado [money],
	@TotalFinanciado [money],
	@MovNumero [varchar](9),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesFinanciamientos set CantidadFinanciada=@CantidadFinanciada, PrecioFinanciado=@PrecioFinanciado
, TotalFinanciado=@TotalFinanciado where MovNumero=@MovNumero
and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosActualizaCantidadPrecioTotal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacion]
	@LcMovTipo [varchar](1),
	@LcMovNumero [varchar](9),
	@lnNuevoIdEstadoFacturacion [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesFinanciamientos set idEstadoFacturacion=@lnNuevoIdEstadoFacturacion  where MOvNumero=@LcMovNumero  and movTipo=@LcMovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacionPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacionPorCuenta]
	@lnNuevoIdEstadoFacturacion [int],
	@movTipo [varchar](1),
	@movNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
update FacturacionBienesFinanciamientos set idEstadoFacturacion=@lnNuevoIdEstadoFacturacion  where MOvNumero=@movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosActualizaIdEstadoFacturacionPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosActualizaPrecio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosActualizaPrecio]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@porcentaje [money]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesFinanciamientos set
       PrecioFinanciado=round(PrecioFinanciado*(@porcentaje/100),2) where movNumero=@movNumero and movTipo=@movTipo

update FacturacionBienesFinanciamientos set
       TotalFinanciado=round(PrecioFinanciado*CantidadFinanciada,2)  where movNumero=@movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosActualizaPrecio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@CantidadFinanciada [int],
	@PrecioFinanciado [money],
	@TotalFinanciado [money],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionBienesFinanciamientos (
MovNumero,MovTipo,IdProducto,IdTipoFinanciamiento,CantidadFinanciada,PrecioFinanciado,TotalFinanciado,FechaAutoriza,IdUsuarioAutoriza,IdFuenteFinanciamiento) values (
@MovNumero,@MovTipo,@IdProducto,@IdTipoFinanciamiento,@CantidadFinanciada,@PrecioFinanciado,@TotalFinanciado,@FechaAutoriza,@IdUsuarioAutoriza,@IdFuenteFinanciamiento)
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@MovNumero,'FacturacionBienesFinanciamientos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosEliminar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesFinanciamientos
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosEliminarPorIdTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosEliminarPorIdTipoFinanciamiento]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdTipoFinanciamiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesFinanciamientos
where MovNumero = @MovNumero and MovTipo=@MovTipo and  IdTipoFinanciamiento=@IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosEliminarPorIdTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoleta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoleta]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.idComprobantePago, dbo.FacturacionBienesFinanciamientos.MovNumero, dbo.FacturacionBienesFinanciamientos.MovTipo,
                                    dbo.FacturacionBienesFinanciamientos.IdProducto, dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento,
                                    dbo.FacturacionBienesFinanciamientos.CantidadFinanciada, dbo.FacturacionBienesFinanciamientos.PrecioFinanciado,
                                    dbo.FacturacionBienesFinanciamientos.TotalFinanciado
               FROM         dbo.FactOrdenesBienes RIGHT OUTER JOIN
                                    dbo.FacturacionBienesFinanciamientos ON dbo.FactOrdenesBienes.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
                                    dbo.FactOrdenesBienes.MovTipo = dbo.FacturacionBienesFinanciamientos.MovTipo
               Where (dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento = 9)
                      and dbo.FactOrdenesBienes.idComprobantePago= @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoletaTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoletaTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.idComprobantePago, dbo.FacturacionBienesFinanciamientos.MovNumero, dbo.FacturacionBienesFinanciamientos.MovTipo,
                                    dbo.FacturacionBienesFinanciamientos.IdProducto, dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento,
                                    dbo.FacturacionBienesFinanciamientos.CantidadFinanciada, dbo.FacturacionBienesFinanciamientos.PrecioFinanciado,
                                    dbo.FacturacionBienesFinanciamientos.TotalFinanciado
               FROM         dbo.FactOrdenesBienes RIGHT OUTER JOIN
                                    dbo.FacturacionBienesFinanciamientos ON dbo.FactOrdenesBienes.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
                                    dbo.FactOrdenesBienes.MovTipo = dbo.FacturacionBienesFinanciamientos.MovTipo
               Where (dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento = 9)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosExoneracionesEnBoletaTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosFiltraCuentaMovimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosFiltraCuentaMovimientos]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenOrigen [int],
	@ConSinNull [int]
WITH EXECUTE AS CALLER
AS
if @ConSinNull=0
	SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.fechaCreacion,
	                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion,
	                      dbo.farmMovimientoVentas.idPaciente, dbo.Atenciones.idFuenteFinanciamiento AS idFteAtenciones, dbo.FuentesFinanciamiento.Descripcion,
	                      dbo.FacturacionBienesFinanciamientos.CantidadFinanciada as cantidad, dbo.FacturacionBienesFinanciamientos.IdProducto,
	                    dbo.Atenciones.idFormaPago AS idTipoFinanAtenciones,dbo.FacturacionBienesFinanciamientos.TotalFinanciado,dbo.farmMovimientoVentas.idPreventa
	FROM         dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo LEFT OUTER JOIN
	                      dbo.Atenciones LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
	                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
	WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
	                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen and dbo.Atenciones.idEstadoAtencion<>0
	ORDER BY dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.MovNumero
else
      if @ConSinNull=1
	SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.fechaCreacion,
	                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion,
	                      dbo.farmMovimientoVentas.idPaciente, dbo.Atenciones.idFuenteFinanciamiento AS idFteAtenciones, dbo.FuentesFinanciamiento.Descripcion,
	                      dbo.FacturacionBienesFinanciamientos.CantidadFinanciada as cantidad, dbo.FacturacionBienesFinanciamientos.IdProducto,
	                    dbo.Atenciones.idFormaPago AS idTipoFinanAtenciones,dbo.FacturacionBienesFinanciamientos.TotalFinanciado,dbo.farmMovimientoVentas.idPreventa
	FROM         dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo LEFT OUTER JOIN
	                      dbo.Atenciones LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
	                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
	WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
	                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen and dbo.Atenciones.idEstadoAtencion<>0
                                 and dbo.FacturacionBienesFinanciamientos.IdProducto=null
	ORDER BY dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.MovNumero
else
	SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.fechaCreacion,
	                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion,
	                      dbo.farmMovimientoVentas.idPaciente, dbo.Atenciones.idFuenteFinanciamiento AS idFteAtenciones, dbo.FuentesFinanciamiento.Descripcion,
	                      dbo.FacturacionBienesFinanciamientos.CantidadFinanciada as cantidad, dbo.FacturacionBienesFinanciamientos.IdProducto,
	                    dbo.Atenciones.idFormaPago AS idTipoFinanAtenciones,dbo.FacturacionBienesFinanciamientos.TotalFinanciado,dbo.farmMovimientoVentas.idPreventa
	FROM         dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo LEFT OUTER JOIN
	                      dbo.Atenciones LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
	                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
	WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
	                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen and dbo.Atenciones.idEstadoAtencion<>0
                                 and dbo.FacturacionBienesFinanciamientos.IdProducto<>null
	ORDER BY dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosFiltraCuentaMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdProducto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@CantidadFinanciada [int],
	@PrecioFinanciado [money],
	@TotalFinanciado [money],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdEstadoFacturacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesFinanciamientos
set
MovTipo = @MovTipo,
IdProducto = @IdProducto,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
CantidadFinanciada = @CantidadFinanciada,
PrecioFinanciado = @PrecioFinanciado,
TotalFinanciado = @TotalFinanciado,
FechaAutoriza = @FechaAutoriza,
IdUsuarioAutoriza = @IdUsuarioAutoriza,
IdFuenteFinanciamiento=@IdFuenteFinanciamiento,
IdEstadoFacturacion=@IdEstadoFacturacion
where MovNumero = @MovNumero  and MovTipo=@MovTipo and IdProducto=@IdProducto and IdTipoFinanciamiento=@IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosPorIdCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*
FROM         dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.farmMovimientoVentas ON dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo AND
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero
where dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosSeleccionarPorId]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesFinanciamientos
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosSeleccionarPorIdProducto]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesFinanciamientos
where MovNumero = @MovNumero and MovTipo=@MovTipo and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosSeleccionaXProdFinanciam]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosSeleccionaXProdFinanciam]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesFinanciamientos
where MovNumero = @MovNumero and MovTipo=@MovTipo and idProducto=@idProducto and idTipoFinanciamiento=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosSeleccionaXProdFinanciam] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[facturacionBienesFinanciamientosSoloExonerados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[facturacionBienesFinanciamientosSoloExonerados]
	@MovNumero [varchar](50),
	@MovTipo [varchar](50),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select totalfinanciado,CantidadFinanciada from facturacionBienesFinanciamientos
	where MovNumero= @MovNumero and MovTipo=@MovTipo  and idProducto=@IdProducto
             and idTipoFinanciamiento=9
GO
ALTER AUTHORIZATION ON [dbo].[facturacionBienesFinanciamientosSoloExonerados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosXcuenta]
	@ml_idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.farmMovimientoVentas.idCuentaAtencion,dbo.FacturacionBienesFinanciamientos.*
             FROM         dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                                dbo.farmMovimientoVentas ON dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero
             Where dbo.farmMovimientoVentas.idCuentaAtencion = @ml_idCuentaAtencion   */
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*
FROM         dbo.FacturacionBienesFinanciamientos INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo AND
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero
Where dbo.farmMovimientoVentas.idCuentaAtencion = @ml_idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosXcuentaYconexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosXcuentaYconexion]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
/*	SELECT      dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento
              FROM         dbo.farmMovimiento INNER JOIN
                                 dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                                  dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo AND
                                  dbo.farmMovimientoVentas.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero
              where          dbo.farmMovimientoVentas.idCuentaAtencion=@idCuenta   */
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*,
                      dbo.farmMovimiento.idEstadoMovimiento
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
                      dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo AND
                      dbo.farmMovimientoVentas.movNumero = dbo.FacturacionBienesFinanciamientos.MovNumero
              where          dbo.farmMovimientoVentas.idCuentaAtencion=@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosXcuentaYconexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesFinanciamientosXfechasExoneracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesFinanciamientosXfechasExoneracion]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento, dbo.FacturacionBienesFinanciamientos.TotalFinanciado,
                      dbo.FacturacionBienesFinanciamientos.FechaAutoriza, dbo.FactCatalogoBienesInsumos.TipoProducto, dbo.farmMovimiento.fechaCreacion,
                      LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS paciente,
                      dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.NroSerie + ' -  ' + dbo.CajaComprobantesPago.NroDocumento AS comprobante,
                      dbo.FactOrdenesBienes.idComprobantePago, dbo.farmMovimiento.idEstadoMovimiento, dbo.CajaComprobantesPago.IdEstadoComprobante
FROM         dbo.CajaComprobantesPago INNER JOIN
                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo INNER JOIN
                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimiento.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero ON
                      dbo.FactOrdenesBienes.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero AND
                      dbo.FactOrdenesBienes.MovTipo = dbo.FacturacionBienesFinanciamientos.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesFinanciamientos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     (dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento = 9) AND (NOT (dbo.FactOrdenesBienes.idComprobantePago IS NULL)) AND
                      (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.CajaComprobantesPago.IdEstadoComprobante = 4) and
                   (dbo.FacturacionBienesFinanciamientos.FechaAutoriza BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesFinanciamientosXfechasExoneracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesInsumosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesInsumosAgregar]
	@IdUsuarioAutorizaPendiente [int],
	@IdProducto [int],
	@PrecioUnitario [money],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdPartidaPresupuestal [int],
	@IdCentroCosto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@TotalPorPagar [money],
	@IdReceta [int],
	@IdComprobantePago [int],
	@IdFacturacionBienes [int] OUTPUT,
	@IdUsuarioAutorizaSeguro [int],
	@IdOrden [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdComprobantePagoDevolucion [int],
	@IdPuntoCarga [int],
	@FechaCreacion [datetime],
	@FechaModificacion [datetime],
	@IdUsuarioCrea [int],
	@IdusuarioModifica [int],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
insert into FacturacionBienesInsumos (
IdUsuarioAutorizaPendiente,IdProducto,PrecioUnitario,Cantidad,IdEstadoFacturacion,IdPartidaPresupuestal,IdCentroCosto,IdTipoFinanciamiento,IdFuenteFinanciamiento,TotalPorPagar,IdReceta,IdComprobantePago,IdUsuarioAutorizaSeguro,IdOrden,IdUsuarioAutorizaDevolucion,IdCajero,FechaAutorizaSeguro,FechaAutorizaPendiente,FechaAutorizaDevolucion,FechaCajero,IdComprobantePagoDevolucion,IdPuntoCarga,FechaCreacion,FechaModificacion,IdUsuarioCrea,IdusuarioModifica,IdAtencion,ImporteSIS,ImporteEXO,IdUsuarioAutorizaEXO,FechaAutorizaEXO,ImporteSOAT,TotalPagar,cantidadSIS,precioSIS,cantidadSOAT,precioSOAT,cantidadPagar,cantidadDev,FechaAutorizaConv,cantidadConv,precConv,ImporteConv)
values (
@IdUsuarioAutorizaPendiente,@IdProducto,@PrecioUnitario,@Cantidad,@IdEstadoFacturacion,@IdPartidaPresupuestal,@IdCentroCosto,@IdTipoFinanciamiento,@IdFuenteFinanciamiento,@TotalPorPagar,@IdReceta,@IdComprobantePago,@IdUsuarioAutorizaSeguro,@IdOrden,@IdUsuarioAutorizaDevolucion,@IdCajero,@FechaAutorizaSeguro,@FechaAutorizaPendiente,@FechaAutorizaDevolucion,@FechaCajero,@IdComprobantePagoDevolucion,@IdPuntoCarga,@FechaCreacion,@FechaModificacion,@IdUsuarioCrea,@IdusuarioModifica,@IdAtencion,@ImporteSIS,@ImporteEXO,@IdUsuarioAutorizaEXO,@FechaAutorizaEXO,@ImporteSOAT,@TotalPagar,@cantidadSIS,@precioSIS,@cantidadSOAT,@precioSOAT,@cantidadPagar,@cantidadDev,@FechaAutorizaConv,@cantidadConv,@precConv,@ImporteConv)
set @IdFacturacionBienes = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionBienes,'FacturacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesInsumosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesInsumosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesInsumosEliminar]
	@IdFacturacionBienes [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionBienesInsumos
where IdFacturacionBienes = @IdFacturacionBienes
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFacturacionBienes,'FacturacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesInsumosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesInsumosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesInsumosModificar]
	@IdUsuarioAutorizaPendiente [int],
	@IdProducto [int],
	@PrecioUnitario [money],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdPartidaPresupuestal [int],
	@IdCentroCosto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@TotalPorPagar [money],
	@IdReceta [int],
	@IdComprobantePago [int],
	@IdFacturacionBienes [int],
	@IdUsuarioAutorizaSeguro [int],
	@IdOrden [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdComprobantePagoDevolucion [int],
	@IdPuntoCarga [int],
	@FechaCreacion [datetime],
	@FechaModificacion [datetime],
	@IdUsuarioCrea [int],
	@IdusuarioModifica [int],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesInsumos
set
IdUsuarioAutorizaPendiente = @IdUsuarioAutorizaPendiente,
IdProducto = @IdProducto,
PrecioUnitario = @PrecioUnitario,
Cantidad = @Cantidad,
IdEstadoFacturacion = @IdEstadoFacturacion,
IdPartidaPresupuestal = @IdPartidaPresupuestal,
IdCentroCosto = @IdCentroCosto,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
TotalPorPagar = @TotalPorPagar,
IdReceta = @IdReceta,
IdComprobantePago = @IdComprobantePago,
IdUsuarioAutorizaSeguro = @IdUsuarioAutorizaSeguro,
IdOrden = @IdOrden,
IdUsuarioAutorizaDevolucion = @IdUsuarioAutorizaDevolucion,
IdCajero = @IdCajero,
FechaAutorizaSeguro = @FechaAutorizaSeguro,
FechaAutorizaPendiente = @FechaAutorizaPendiente,
FechaAutorizaDevolucion = @FechaAutorizaDevolucion,
FechaCajero = @FechaCajero,
IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
IdPuntoCarga = @IdPuntoCarga,
FechaCreacion = @FechaCreacion,
FechaModificacion = @FechaModificacion,
IdUsuarioCrea = @IdUsuarioCrea,
IdusuarioModifica = @IdusuarioModifica,
IdAtencion = @IdAtencion,
ImporteSIS= @ImporteSIS,
ImporteEXO =@ImporteEXO,
IdUsuarioAutorizaEXO=@IdUsuarioAutorizaEXO,
FechaAutorizaEXO=@FechaAutorizaEXO,
ImporteSOAT=@ImporteSOAT,
TotalPagar=@TotalPagar,
cantidadSIS=@cantidadSIS,
precioSIS=@precioSIS,
cantidadSOAT=@cantidadSOAT,
precioSOAT=@precioSOAT,
cantidadPagar =@cantidadPagar ,
cantidadDev=@cantidadDev,
FechaAutorizaConv=@FechaAutorizaConv,
cantidadConv=@cantidadConv,
precConv=@precConv,
ImporteConv=@ImporteConv
where IdFacturacionBienes = @IdFacturacionBienes
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionBienes,'FacturacionBienesInsumos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesInsumosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesInsumosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesInsumosSeleccionarPorId]
	@IdFacturacionBienes [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesInsumos
where IdFacturacionBienes = @IdFacturacionBienes
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesInsumosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesInsumosSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesInsumosSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesInsumos
where IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesInsumosSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesModificarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesModificarV2]
	@IdFacturacionBienes [int],
	@result [varchar](500) OUTPUT,
	@IdProducto [int],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdOrden [int],
	@IdusuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdAtencion [int],
	@IdComprobantePagoDevolucion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
BEGIN TRANSACTION


--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdSubGrupoFarmacologico int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)
declare @TotalPorPagar money
declare @TotalPagar money
declare @cantidadPagar decimal

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdSubGrupoFarmacologico  = IdSubGrupoFarmacologico ,
	@Nombre = Nombre from FactCatalogoBienesInsumos where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoBienesInsumosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin
                                                    set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    set @cantidadPagar=@cantidad
                                                    set @totalPagar =@cantidad * @PrecioUnitario
                                                    if @IdTipoFinanciamiento=2     --SIS
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSIS
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @IdTipoFinanciamiento=3     --SOAT
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSOAT
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @importeEXO>0     --EXONERACIONES
                                                    begin
                                                        set @TotalPorPagar =@TotalPorPagar-@importeEXO
                                                    end

				update FacturacionBienesInsumos
				set
				IdProducto = @IdProducto,
				PrecioUnitario = @PrecioUnitario,
				Cantidad = @Cantidad,
				IdEstadoFacturacion = @IdEstadoFacturacion,
				IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
				IdTipoFinanciamiento = @IdTipoFinanciamiento,
				IdComprobantePago = @IdComprobantePago,
				IdPuntoCarga = @IdPuntoCarga,
				IdOrden = @IdOrden,
				IdUsuarioAutorizaSeguro = @IdusuarioAutorizaSeguro,
				IdUsuarioAutorizaPendiente = @IdusuarioAutorizaPendiente,
				IdUsuarioAutorizaDevolucion = @IdUsuarioAutorizaDevolucion,
				IdCajero = @IdCajero,
				FechaAutorizaSeguro = @FechaAutorizaSeguro,
				FechaAutorizaPendiente = @FechaAutorizaPendiente,
				FechaAutorizadevolucion = @FechaAutorizaDevolucion,
				FechaCajero = @FechaCajero,
				IdAtencion = @IdAtencion,
				IdPartidaPresupuestal = @IdPartidaPresupuestal,
				IdCentroCosto = @IdCentroCosto,
				TotalPorPagar = @TotalPorPagar,
				TotalPagar = @TotalPagar,
                                                      CantidadPagar=@CantidadPagar,
				IdusuarioModifica = @IdUsuarioAuditoria,
				IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
				FechaModificacion = getdate(),
				ImporteSIS=@ImporteSIS,
				ImporteEXO=@ImporteEXO,
				IdUsuarioAutorizaEXO=@IdUsuarioAutorizaEXO,
				FechaAutorizaEXO=@FechaAutorizaEXO,
				ImporteSOAT=@ImporteSOAT,
				cantidadSIS=@cantidadSIS,
				precioSIS=@precioSIS,
				cantidadSOAT=@cantidadSOAT,
				precioSOAT=@precioSOAT,
				cantidadDev=@cantidadDev,
				FechaAutorizaConv=@FechaAutorizaConv,
				cantidadConv=@cantidadConv,
				precConv=@precConv,
				ImporteConv=@ImporteConv
				where
				IdFacturacionBienes = @IdFacturacionBienes
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionBienes,'FacturacionBienes'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end

COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesModificarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosAgregar]
	@IdOrden [int],
	@IdProducto [int],
	@CantidadPagar [int],
	@PrecioVenta [money],
	@TotalPagar [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionBienesPagos (
IdOrden,IdProducto,CantidadPagar,PrecioVenta,TotalPagar) values (
@IdOrden,@IdProducto,@CantidadPagar,@PrecioVenta,@TotalPagar)
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdOrden,'FacturacionBienesPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosEliminar]
	@IdOrden [int],
	@idProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
if @idProducto =0
   delete from FacturacionBienesPagos where IdOrden = @IdOrden
else
   delete from FacturacionBienesPagos where IdOrden = @IdOrden and IdProducto =@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosModificar]
	@IdOrden [int],
	@IdProducto [int],
	@CantidadPagar [int],
	@PrecioVenta [money],
	@TotalPagar [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesPagos
set
IdProducto = @IdProducto,
CantidadPagar = @CantidadPagar,
PrecioVenta = @PrecioVenta,
TotalPagar = @TotalPagar
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosModificarXidOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosModificarXidOrdenIdProducto]
	@IdOrden [int],
	@IdProducto [int],
	@CantidadPagar [int],
	@PrecioVenta [money],
	@TotalPagar [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionBienesPagos
set
IdProducto = @IdProducto,
CantidadPagar = @CantidadPagar,
PrecioVenta = @PrecioVenta,
TotalPagar = @TotalPagar
where IdOrden = @IdOrden and IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosModificarXidOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar AS TotalPorPagar, dbo.FactOrdenesBienes.idOrden, dbo.FactOrdenesBienes.idComprobantePago,
                      dbo.FacturacionBienesPagos.IdProducto, dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto,
                      dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga, dbo.FactOrdenesBienes.MovNumero,
                      dbo.FactOrdenesBienes.MovTipo, dbo.FactOrdenesBienes.ImporteExonerado,dbo.FactOrdenesBienes.idOrden
FROM         dbo.FacturacionBienesPagos LEFT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where      dbo.FactOrdenesBienes.idCuentaAtencion=@idCuentaAtencion and dbo.FactOrdenesBienes.idEstadoFacturacion=1
order by   dbo.FactOrdenesBienes.idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodos]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar AS TotalFinanciado, dbo.FactOrdenesBienes.idOrden, dbo.FactOrdenesBienes.idComprobantePago,
                      dbo.FacturacionBienesPagos.IdProducto, dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto,
                      dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga, dbo.FactOrdenesBienes.MovNumero,
                      dbo.FactOrdenesBienes.MovTipo, dbo.FactOrdenesBienes.ImporteExonerado
FROM         dbo.FacturacionBienesPagos LEFT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where      dbo.FactOrdenesBienes.idCuentaAtencion=@idCuentaAtencion



--if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[AuditoriaAgregarV]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
--drop procedure [dbo].[AuditoriaAgregarV]
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodosOconexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodosOconexion]
	@Cuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                                  dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                                  dbo.FacturacionBienesPagos.TotalPagar AS TotalFinanciado, dbo.FactOrdenesBienes.idOrden, dbo.FactOrdenesBienes.idComprobantePago,
                                  dbo.FacturacionBienesPagos.IdProducto, dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto, dbo.FactOrdenesBienes.idEstadoFacturacion,
                                  dbo.FactOrdenesBienes.idPuntoCarga, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                                  dbo.FactOrdenesBienes.ImporteExonerado , dbo.farmMovimiento.idEstadoMovimiento
             FROM          dbo.farmMovimiento RIGHT OUTER JOIN
                                  dbo.FactOrdenesBienes ON dbo.farmMovimiento.MovNumero = dbo.FactOrdenesBienes.MovNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.FactOrdenesBienes.MovTipo RIGHT OUTER JOIN
                                  dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             where           dbo.FactOrdenesBienes.idCuentaAtencion=@Cuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorCuentaTodosOconexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorId]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionBienesPagos
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorMovnumero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorMovnumero]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FacturacionBienesPagos.IdProducto,
                    dbo.FacturacionBienesPagos.CantidadPagar, dbo.FacturacionBienesPagos.PrecioVenta, dbo.FacturacionBienesPagos.TotalPagar,
                   dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes. IdComprobantePago, dbo.FactOrdenesBienes. IdOrden
FROM         dbo.FacturacionBienesPagos LEFT OUTER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden
where dbo.FactOrdenesBienes.MovNumero = @MovNumero and dbo.FactOrdenesBienes.MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorMovnumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosSeleccionarPorMovnumeroIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosSeleccionarPorMovnumeroIdProducto]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FacturacionBienesPagos.*,
           dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.idOrden
FROM         dbo.FacturacionBienesPagos INNER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden
where dbo.FactOrdenesBienes.MovNumero = @MovNumero and dbo.FactOrdenesBienes.MovTipo=@MovTipo and dbo.FacturacionBienesPagos.idProducto=@idProducto


GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosSeleccionarPorMovnumeroIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosXCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosXCuenta]
	@ml_idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FacturacionBienesPagos.*, dbo.FactOrdenesBienes.idEstadoFacturacion,
                                  dbo.FactOrdenesBienes.IdComprobantePago , dbo.FactOrdenesBienes.IdOrden
             FROM          dbo.farmMovimientoVentas RIGHT OUTER JOIN
                                  dbo.FactOrdenesBienes ON dbo.farmMovimientoVentas.movNumero = dbo.FactOrdenesBienes.MovNumero AND
                                  dbo.farmMovimientoVentas.movTipo = dbo.FactOrdenesBienes.MovTipo RIGHT OUTER JOIN
                                  dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden
             Where          dbo.farmMovimientoVentas.idCuentaAtencion =  @ml_idCuentaAtencion  */
SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FacturacionBienesPagos.*,
                      dbo.FactOrdenesBienes.idEstadoFacturacion , dbo.FactOrdenesBienes.idComprobantePago,
                      dbo.FactOrdenesBienes.idOrden
FROM         dbo.FacturacionBienesPagos INNER JOIN
                      dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.FactOrdenesBienes.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FactOrdenesBienes.MovTipo = dbo.farmMovimientoVentas.movTipo
Where          dbo.farmMovimientoVentas.idCuentaAtencion =  @ml_idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosXCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionBienesPagosXidPreventa]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionBienesPagosXidPreventa]
	@idPreventa [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo, dbo.FactOrdenesBienes.idPreventa,
                      dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FacturacionBienesPagos.*
FROM         dbo.FactOrdenesBienes INNER JOIN
                      dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden
where   dbo.FactOrdenesBienes.idPreventa=@idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionBienesPagosXidPreventa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCajaComprobantesPagoConsultarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCajaComprobantesPagoConsultarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from CajaComprobantesPago where IdCuentaAtencion =@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCajaComprobantesPagoConsultarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaqueteFarmSeleccionarXid]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaqueteFarmSeleccionarXid]
	@lnIdPaquete [int],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionCatalogoPaquetes.idFactPaquete, dbo.FacturacionCatalogoPaquetes.idPuntoCarga,
                                    dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio, dbo.FacturacionCatalogoPaquetes.idProducto, dbo.FacturacionCatalogoPaquetes.Cantidad,
                                    dbo.FacturacionCatalogoPaquetes.Precio, dbo.FacturacionCatalogoPaquetes.Importe, dbo.FactCatalogoBienesInsumos.Codigo,
                                    dbo.FactCatalogoBienesInsumos.Nombre, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo
                 FROM         dbo.FacturacionCatalogoPaquetes LEFT OUTER JOIN
                                    dbo.FactCatalogoBienesInsumos ON dbo.FacturacionCatalogoPaquetes.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                 WHERE      dbo.FacturacionCatalogoPaquetes.idFactPaquete=@lnIdPaquete and dbo.FacturacionCatalogoPaquetes.idPuntoCarga=@idPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaqueteFarmSeleccionarXid] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesAgregar]
	@idFactPaquete [int],
	@idPuntoCarga [int],
	@idEspecialidadServicio [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionCatalogoPaquetes (
idFactPaquete,idPuntoCarga,idEspecialidadServicio,idProducto,Cantidad,Precio,Importe) values (
@idFactPaquete,@idPuntoCarga,@idEspecialidadServicio,@idProducto,@Cantidad,@Precio,@Importe)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idFactPaquete,'FacturacionCatalogoPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesEliminar]
	@idFactPaquete [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionCatalogoPaquetes
where idFactPaquete = @idFactPaquete
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactPaquete,'FacturacionCatalogoPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesEliminarXidFactPaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesEliminarXidFactPaquete]
	@IdFactPaquete [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionCatalogoPaquetes where idFactPaquete=@IdFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesEliminarXidFactPaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesModificar]
	@idFactPaquete [int],
	@idPuntoCarga [int],
	@idEspecialidadServicio [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionCatalogoPaquetes
set
idPuntoCarga = @idPuntoCarga,
idEspecialidadServicio = @idEspecialidadServicio,
idProducto = @idProducto,
Cantidad = @Cantidad,
Precio = @Precio,
Importe = @Importe
where idFactPaquete = @idFactPaquete
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idFactPaquete,'FacturacionCatalogoPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesParaCaja]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesParaCaja]
	@IdFactPaquete [int],
	@mi_DebeConsiderarPaquete [int]
WITH EXECUTE AS CALLER
AS
If @mi_DebeConsiderarPaquete = 2    --solo farmacia

            SELECT     dbo.Especialidades.Nombre AS Especialidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre as Descripcion,
                                          dbo.FacturacionCatalogoPaquetes.cantidad , dbo.FacturacionCatalogoPaquetes.Precio, dbo.FacturacionCatalogoPaquetes.Importe
                     FROM         dbo.FacturacionCatalogoPaquetes INNER JOIN
                                          dbo.FactCatalogoBienesInsumos ON dbo.FacturacionCatalogoPaquetes.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                                          dbo.Especialidades ON dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio = dbo.Especialidades.IdEspecialidad
                     Where dbo.FacturacionCatalogoPaquetes.IdFactPaquete = @IdFactPaquete
        Else
            SELECT      dbo.Especialidades.Nombre AS Especialidad, dbo.FactCatalogoServicios.Codigo,
                          dbo.FactCatalogoServicios.Nombre AS Descripcion, dbo.FacturacionCatalogoPaquetes.Cantidad, dbo.FacturacionCatalogoPaquetes.Precio,
                          dbo.FacturacionCatalogoPaquetes.Importe
                     FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                          dbo.FacturacionCatalogoPaquetes ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionCatalogoPaquetes.idProducto LEFT OUTER JOIN
                          dbo.Especialidades ON dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio = dbo.Especialidades.IdEspecialidad
                     WHERE dbo.FacturacionCatalogoPaquetes.idFactPaquete=@IdFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesParaCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesSeleccionarPorId]
	@idFactPaquete [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCatalogoPaquetes
where idFactPaquete = @idFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesSeleccionarPorIdFactPaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesSeleccionarPorIdFactPaquete]
	@IdFactPaquete [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionCatalogoPaquetes.*, dbo.FactCatalogoServicios.Nombre, dbo.FactCatalogoServicios.Codigo
             FROM         dbo.FacturacionCatalogoPaquetes LEFT OUTER JOIN
                                dbo.FactCatalogoServicios ON dbo.FacturacionCatalogoPaquetes.idProducto = dbo.FactCatalogoServicios.IdProducto
             where          dbo.FacturacionCatalogoPaquetes.idFactPaquete=@IdFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesSeleccionarPorIdFactPaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCatalogoPaquetes
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesXidPaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesXidPaquete]
	@IdPaquete [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.Especialidades.Nombre AS Especialidad, dbo.FactCatalogoServicios.Codigo,
                  dbo.FactCatalogoServicios.Nombre AS Procedimiento, dbo.FacturacionCatalogoPaquetes.Cantidad, dbo.FacturacionCatalogoPaquetes.Precio,
                  dbo.FacturacionCatalogoPaquetes.Importe, dbo.FacturacionCatalogoPaquetes.IdProducto,dbo.FacturacionCatalogoPaquetes.idPuntoCarga,dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio
             FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                  dbo.FacturacionCatalogoPaquetes ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionCatalogoPaquetes.idProducto LEFT OUTER JOIN
                  dbo.Especialidades ON dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio = dbo.Especialidades.IdEspecialidad
             WHERE dbo.FacturacionCatalogoPaquetes.idFactPaquete=@IdPaquete
             ORDER BY dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio,dbo.FacturacionCatalogoPaquetes.IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesXidPaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCatalogoPaquetesXpaquete]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCatalogoPaquetesXpaquete]
	@IdFactPaquete [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Especialidades.Nombre AS Especialidad,
                      case dbo.FacturacionCatalogoPaquetes.idPuntoCarga when 5 then
                           (select dbo.FactCatalogoBienesInsumos.Codigo from dbo.FactCatalogoBienesInsumos where
                            dbo.FactCatalogoBienesInsumos.idProducto=dbo.FacturacionCatalogoPaquetes.idProducto )
                      else
                           (select dbo.FactCatalogoServicios.Codigo from dbo.FactCatalogoServicios where
                            dbo.FactCatalogoServicios.idProducto=dbo.FacturacionCatalogoPaquetes.idProducto )
                      end as Codigo,
                      case dbo.FacturacionCatalogoPaquetes.idPuntoCarga when 5 then
                           (select dbo.FactCatalogoBienesInsumos.nombre from dbo.FactCatalogoBienesInsumos where
                            dbo.FactCatalogoBienesInsumos.idProducto=dbo.FacturacionCatalogoPaquetes.idProducto )
                      else
                           (select dbo.FactCatalogoServicios.nombre from dbo.FactCatalogoServicios where
                            dbo.FactCatalogoServicios.idProducto=dbo.FacturacionCatalogoPaquetes.idProducto )
                      end as Descripcion, dbo.FacturacionCatalogoPaquetes.Cantidad, dbo.FacturacionCatalogoPaquetes.Precio,
                      dbo.FacturacionCatalogoPaquetes.Importe,dbo.FacturacionCatalogoPaquetes.idPuntoCarga,dbo.FacturacionCatalogoPaquetes.idProducto
FROM         dbo.FacturacionCatalogoPaquetes LEFT OUTER JOIN
                      dbo.Especialidades ON dbo.FacturacionCatalogoPaquetes.idEspecialidadServicio = dbo.Especialidades.IdEspecialidad
 Where dbo.FacturacionCatalogoPaquetes.IdFactPaquete = @IdFactPaquete
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCatalogoPaquetesXpaquete] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionAbrir]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionAbrir]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 1,
HoraCierre = null,
FechaCierre = null,
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
FechaCreacion=getdate(),
totalPorPagar=0
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo =null
, HoraEgresoAdministrativo = null
,idEstadoAtencion=1
where IdCuentaAtencion = @IdCuentaAtencion

exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionAbrir] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionActualizaImportes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionActualizaImportes]
	@IdCuentaAtencion [int],
	@TotalExonerado [money],
	@TotalAsegurado [money],
	@TotalPagado [money],
	@totalPorPagar [money]
WITH EXECUTE AS CALLER
AS
update  FacturacionCuentasAtencion  set
TotalExonerado=@TotalExonerado,
TotalAsegurado=@TotalAsegurado,
TotalPagado=@TotalPagado,
totalPorPagar=@totalPorPagar
where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionActualizaImportes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionActualizarIdEstado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionActualizarIdEstado]
	@IdEstado [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion set idEstado=@IdEstado where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionActualizarIdEstado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionAgregar]
	@TotalPorPagar [money],
	@IdEstado [int],
	@TotalPagado [money],
	@TotalAsegurado [money],
	@TotalExonerado [money],
	@HoraCierre [char](5),
	@FechaCierre [datetime],
	@HoraApertura [char](5),
	@FechaApertura [datetime],
	@IdPaciente [int],
	@IdCuentaAtencion [int] OUTPUT,
	@FechaCreacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionCuentasAtencion (
TotalPorPagar,IdEstado,TotalPagado,TotalAsegurado,TotalExonerado,HoraCierre,FechaCierre,HoraApertura,FechaApertura,IdPaciente, IdUsuarioCrea, FechaCreacion) values (
@TotalPorPagar,@IdEstado,@TotalPagado,@TotalAsegurado,@TotalExonerado,@HoraCierre,@FechaCierre,@HoraApertura,@FechaApertura,@IdPaciente, @IdUsuarioAuditoria, @FechaCreacion )
set @IdCuentaAtencion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionAltaConDeudaYGarante]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionAltaConDeudaYGarante]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5),
	@lnDeudaPendiente [money]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 14,
HoraCierre =  @lcHoraCierre,
FechaCierre = getdate(),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
totalPorPagar=@lnDeudaPendiente
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo = getdate()
, HoraEgresoAdministrativo = @lcHoraCierre
,idEstadoAtencion=2
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionAltaConDeudaYGarante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionAnulada]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionAnulada]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5),
	@lnDeudaPendiente [money]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 9,
HoraCierre = @lcHoraCierre,
FechaCierre =getdate( ),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
totalPorPagar=0
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo = getdate()
, HoraEgresoAdministrativo = @lcHoraCierre
,idEstadoAtencion=0
where IdCuentaAtencion = @IdCuentaAtencion

delete from Citas where IdAtencion =(select IdAtencion from Atenciones where IdCuentaAtencion =@IdCuentaAtencion )

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'X',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionAnulada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionCerradoAutomatico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionCerradoAutomatico]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5)
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 13,
HoraCierre = @lcHoraCierre,
FechaCierre = getdate(),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate()
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones set
idEstadoAtencion=2
where IdCuentaAtencion = @IdCuentaAtencion

exec AuditoriaAgregar @IdUsuarioAuditoria ,'T',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionCerradoAutomatico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionCerrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionCerrar]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5),
	@lnDeudaPendiente [money]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 5,
HoraCierre =  @lcHoraCierre,
FechaCierre = getdate(),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
totalPorPagar=@lnDeudaPendiente
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo = getdate()
, HoraEgresoAdministrativo = @lcHoraCierre
,idEstadoAtencion=2
where IdCuentaAtencion = @IdCuentaAtencion

exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionCerrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionConsultarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionConsultarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCuentasAtencion where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionConsultarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionDatosPacientePorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionDatosPacientePorIdCuentaAtencion]
	@lIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select Atenciones.IdPaciente ,Atenciones.IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
        convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso,convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraIngreso
        , Servicios.Nombre as ServicioIngreso, Atenciones.Edad as Edad,
        Pacientes.IdTipoNumeracion
         From (((Atenciones left join Servicios on Atenciones.IdServicioIngreso = Servicios.IdServicio)
        left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
        left join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = Atenciones.IdCuentaAtencion)
        left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion
         where FacturacionCuentasAtencion.IdCuentaAtencion = @lIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionDatosPacientePorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionEliminar]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionCuentasAtencion
where IdCuentaAtencion = @IdCuentaAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionExonAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionExonAgregar]
	@idCuentaAtencion [int],
	@NumeroExoneracion [int],
	@motivo [varchar](500)
WITH EXECUTE AS CALLER
AS
insert into  FacturacionCuentasAtencionExon (idCuentaAtencion,NumeroExoneracion,motivo)
    values (@idCuentaAtencion,@NumeroExoneracion,@motivo)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionExonAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionExoneracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionExoneracion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCuentasAtencionExon
where idCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionExoneracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionExonModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionExonModificar]
	@idCuentaAtencion [int],
	@NumeroExoneracion [int],
	@motivo [varchar](500)
WITH EXECUTE AS CALLER
AS
update  FacturacionCuentasAtencionExon
set
NumeroExoneracion=@NumeroExoneracion,
motivo=@motivo
where idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionExonModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionExonUltima]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionExonUltima]
WITH EXECUTE AS CALLER
AS
select top 1 numeroExoneracion from FacturacionCuentasAtencionExon order by numeroExoneracion desc
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionExonUltima] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionFiltrarXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionFiltrarXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
Select ca.IdCuentaAtencion, ca.FechaApertura,ca.HoraApertura, ca.IdEstado,
               ca.FechaApertura + ' ' + ca.HoraApertura as DescripcionLarga
               from FacturacionCuentasAtencion ca, Pacientes pa
               where ca.IdPaciente = pa.IdPaciente
               and ca.IdEstado = 1
               and  ca.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionFiltrarXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionModificar]
	@TotalPorPagar [money],
	@IdEstado [int],
	@TotalPagado [money],
	@TotalAsegurado [money],
	@TotalExonerado [money],
	@HoraCierre [char](5),
	@FechaCierre [datetime],
	@HoraApertura [char](5),
	@FechaApertura [datetime],
	@IdPaciente [int],
	@IdCuentaAtencion [int],
	@FechaCreacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
TotalPorPagar = @TotalPorPagar,
IdEstado = @IdEstado,
TotalPagado = @TotalPagado,
TotalAsegurado = @TotalAsegurado,
TotalExonerado = @TotalExonerado,
HoraCierre = @HoraCierre,
FechaCierre = @FechaCierre,
HoraApertura = @HoraApertura,
FechaApertura = @FechaApertura,
IdPaciente = @IdPaciente,
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
FechaCreacion=@FechaCreacion
where IdCuentaAtencion = @IdCuentaAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinica]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
Select ca.IdCuentaAtencion, ca.FechaApertura,ca.HoraApertura ,pa.ApellidoPaterno,pa.ApellidoMaterno,
                 pa.PrimerNombre,pa.SegundoNombre,
                 ca.FechaApertura + ' ' + ca.HoraApertura as DescripcionLarga
                 from FacturacionCuentasAtencion ca, Pacientes pa
                 where ca.IdPaciente = pa.IdPaciente
                 and pa.NroHistoriaClinica = @NroHistoriaClinica
                 and ca.IdEstado = 1
                 order by ca.fechaapertura,ca.horaapertura
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinicaV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinicaV2]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(4000)
DECLARE @SQL1 AS VARCHAR(2000)
DECLARE @SQL2 AS VARCHAR(2000)
   SET  @SQL1 =  'Select FacturacionCuentasAtencion.IdCuentaAtencion as IdCuentaAtencion, FacturacionCuentasAtencion.FechaApertura, FacturacionCuentasAtencion.HoraApertura ,
                           Pacientes.ApellidoPaterno,Pacientes.ApellidoMaterno,
                 Pacientes.PrimerNombre,Pacientes.SegundoNombre
                 from FacturacionCuentasAtencion , Pacientes
                 where FacturacionCuentasAtencion.IdPaciente = Pacientes.IdPaciente
                 and Pacientes.NroHistoriaClinica = '+@NroHistoriaClinica +'
                and FacturacionCuentasAtencion.IdEstado = 1 '


          SET  @SQL2 =  'Select Atenciones.IdCuentaAtencion,Atenciones.IdAtencion as Atencion, Atenciones.FechaIngreso, Atenciones.HoraIngreso, Servicios.Nombre as Servicio,
     Empleados.ApellidoPaterno + " " + Empleados.ApellidoMaterno + ", " + Empleados.Nombres as Medico
     from Atenciones , Servicios , Empleados
     where Atenciones.idservicioingreso = Servicios.idservicio
     and Atenciones.idmedicoingreso = Empleados.idempleado   '

   set  @sql='SHAPE {' + @SQL1 + '}  + APPEND ({' + @SQL2 + '} AS title_chap RELATE IdCuentaAtencion TO IdCuentaAtencion)'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionObtenerCuentasAtencionPorHistoriaClinicaV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionObtenerUltimaCuentaAtencionPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionObtenerUltimaCuentaAtencionPorIdPaciente]
	@lIdPaciente [int]
WITH EXECUTE AS CALLER
AS
Select ca.IdCuentaAtencion, ca.FechaApertura,ca.HoraApertura, ca.IdEstado,
                 ca.FechaApertura + ' ' + ca.HoraApertura as DescripcionLarga
                 from FacturacionCuentasAtencion ca, Pacientes pa
                 where ca.IdPaciente = pa.IdPaciente
                 and pa.IdPaciente = @lIdPaciente
                 and ca.IdEstado = 1
                 and ca.fechaApertura + ca.horaapertura = (select max(fechaapertura + horaapertura) from FacturacionCuentasAtencion
                 where idpaciente = ca.idpaciente and IdEstado = 1)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionObtenerUltimaCuentaAtencionPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPagada]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPagada]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5)
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
BEGIN TRANSACTION

update FacturacionCuentasAtencion
set
IdEstado = 4,
HoraCierre = @lcHoraCierre,
FechaCierre = getdate(),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
totalPorPagar=0
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo = getdate()
, HoraEgresoAdministrativo = @lcHoraCierre
,idEstadoAtencion=2
where IdCuentaAtencion = @IdCuentaAtencion

COMMIT TRANSACTION

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'P',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPagada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPendientePagoSeguro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPendientePagoSeguro]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int],
	@lcHoraCierre [char](5),
	@lnDeudaPendiente [money]
WITH EXECUTE AS CALLER
AS
update FacturacionCuentasAtencion
set
IdEstado = 11,
HoraCierre = @lcHoraCierre,
FechaCierre = getdate(),
IdUsuarioModifica = @IdUsuarioAuditoria,
FechaModificacion = getdate(),
totalPorPagar=@lnDeudaPendiente
where IdCuentaAtencion = @IdCuentaAtencion

update Atenciones
set FechaEgresoAdministrativo = getdate()
, HoraEgresoAdministrativo = @lcHoraCierre
,idEstadoAtencion=2
where IdCuentaAtencion = @IdCuentaAtencion

exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'FacturacionCuentasAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPendientePagoSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPtosActualizar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPtosActualizar]
	@lbNueva [bit],
	@IdCuentaAtencion [int],
	@idPuntoCarga [int],
	@TotalConsumos [money],
	@TotalPagos [money],
	@TotalPagosReembolso [money]
WITH EXECUTE AS CALLER
AS
if @lbNueva=1
       insert into FacturacionCuentasAtencionPtos
       (IdCuentaAtencion,idPuntoCarga,TotalConsumos,TotalPagos,TotalPagosReembolso)
       values
        (@IdCuentaAtencion,@idPuntoCarga,@TotalConsumos,0,0)
else
       if @TotalConsumos>0
               update FacturacionCuentasAtencionPtos set    TotalConsumos =@TotalConsumos    where  IdCuentaAtencion=@IdCuentaAtencion and idPuntoCarga=@idPuntoCarga
       else
          if @TotalPagos>0
             update FacturacionCuentasAtencionPtos set    TotalPagos =@TotalPagos   where  IdCuentaAtencion=@IdCuentaAtencion and idPuntoCarga=@idPuntoCarga
       else
          if @TotalPagosReembolso>0
             update FacturacionCuentasAtencionPtos set    TotalPagosReembolso =@TotalPagosReembolso  where  IdCuentaAtencion=@IdCuentaAtencion and idPuntoCarga=@idPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtosActualizar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPtosEliminarXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPtosEliminarXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
update Parametros set ValorInt=@IdCuentaAtencion where idParametro=1
delete from FacturacionCuentasAtencionPtos where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtosEliminarXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPtosSeleccionarTodo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPtosSeleccionarTodo]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCuentasAtencionPtos order by idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtosSeleccionarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPtosXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPtosXcuenta]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionCuentasAtencionPtos.*, dbo.FactPuntosCarga.Descripcion, dbo.FacturacionCuentasAtencion.TotalExonerado,
                                  dbo.FacturacionCuentasAtencion.TotalAsegurado , dbo.FacturacionCuentasAtencion.TotalPagado, dbo.FacturacionCuentasAtencion.TotalPorPagar
             FROM         dbo.FacturacionCuentasAtencionPtos LEFT OUTER JOIN
                                  dbo.FacturacionCuentasAtencion ON
                                  dbo.FacturacionCuentasAtencionPtos.idCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                  dbo.FactPuntosCarga ON dbo.FacturacionCuentasAtencionPtos.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
             where dbo.FacturacionCuentasAtencionPtos.idCuentaAtencion=@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtosXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionPtosXIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionPtosXIdCuenta]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     *
             FROM         FacturacionCuentasAtencionPtos
             where FacturacionCuentasAtencionPtos.idCuentaAtencion=@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionPtosXIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionCuentasAtencion
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionSeleccionarPoridEstado9]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionSeleccionarPoridEstado9]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FacturacionCuentasAtencion.IdCuentaAtencion, dbo.FacturacionCuentasAtencion.IdEstado,
                     dbo.Atenciones.IdEstadoAtencion
FROM         dbo.FacturacionCuentasAtencion INNER JOIN
                     dbo.Atenciones ON dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
Where (dbo.FacturacionCuentasAtencion.idEstado = 9) And (dbo.Atenciones.IdEstadoAtencion <> 0)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionSeleccionarPoridEstado9] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionSeleccionarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionCuentasAtencion.*, dbo.Atenciones.FechaEgreso, dbo.Atenciones.FechaIngreso, dbo.TiposServicio.Descripcion AS dTipoServicio,
                      dbo.EstadosCuenta.Descripcion AS dEstadoCuenta, dbo.Atenciones.IdTipoServicio, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,
                      dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.FechaIngreso,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.EsPacienteExterno, dbo.Atenciones.IdAtencion, dbo.TiposFinanciamiento.GeneraPago,
                      dbo.AtencionesDatosAdicionales.NroReferenciaDestino
FROM         dbo.FacturacionCuentasAtencion INNER JOIN
                      dbo.Atenciones ON dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio
where dbo.FacturacionCuentasAtencion.IdPaciente = @IdPaciente
order by dbo.FacturacionCuentasAtencion.fechaApertura desc, dbo.FacturacionCuentasAtencion.horaApertura desc
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionSeleccionarPorRangoCuentas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionSeleccionarPorRangoCuentas]
	@IdCuentaAnterior [int],
	@IdCuentaAtencionSiguiente [int]
WITH EXECUTE AS CALLER
AS
select idCuentaAtencion
from FacturacionCuentasAtencion
where (idCuentaAtencion>=@IdCuentaAnterior and idCuentaAtencion<=@IdCuentaAtencionSiguiente) and idEstado<>5 and idEstado<>9
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionSeleccionarPorRangoCuentas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionXidCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionXidCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.FacturacionCuentasAtencion.IdCuentaAtencion, dbo.FacturacionCuentasAtencion.IdPaciente, dbo.Pacientes.ApellidoPaterno,
                 dbo.Pacientes.PrimerNombre , dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.IdTipoNumeracion,
                 dbo.Pacientes.NroDocumento
           FROM    dbo.FacturacionCuentasAtencion LEFT OUTER JOIN dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
           WHERE dbo.FacturacionCuentasAtencion.idEstado<>9 and dbo.FacturacionCuentasAtencion.IdCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionXidCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionxIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionxIdCuentaAtencion]
	@TodasLasCuentas [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
IF @TodasLasCuentas > 0
	BEGIN
		SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
			      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
	                                 dbo.TiposFinanciamiento.GeneraPago
	             FROM        dbo.Atenciones LEFT OUTER JOIN
	                                 dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                                 dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                                 dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	             WHERE  dbo.Atenciones.idEstadoAtencion<>0 and  dbo.Atenciones.idCuentaAtencion >= @IdCuentaAtencion
	             ORDER BY dbo.Atenciones.idCuentaAtencion asc
	END
ELSE
	BEGIN
		SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Atenciones.*,
			      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dtipoFinanciamiento,
	                                 dbo.TiposFinanciamiento.GeneraPago
	              FROM        dbo.Atenciones LEFT OUTER JOIN
	                                 dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
	                                 dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
	                                 dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	             WHERE  dbo.Atenciones.idEstadoAtencion<>0 and  dbo.Atenciones.idCuentaAtencion=@IdCuentaAtencion
	END
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionxIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionCuentasAtencionXnroCuentaConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionCuentasAtencionXnroCuentaConexion]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdFormaPago,
                                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                                      dbo.Atenciones.IdPaciente, dbo.TiposFinanciamiento.tipoVenta, dbo.Atenciones.FechaEgreso, dbo.FacturacionCuentasAtencion.IdEstado,
                                      dbo.EstadosCuenta.Descripcion AS estadoCta, dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.IdServicioIngreso,
                                      dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.Pacientes.IdTipoNumeracion, dbo.Atenciones.IdAtencion,
                                      dbo.Atenciones.IdCamaEgreso, dbo.TiposServicio.Descripcion AS dTipoServicio, dbo.Atenciones.idEstadoAtencion, dbo.Atenciones.EsPacienteExterno,
                                      dbo.TiposFinanciamiento.Descripcion AS dTipoFinanciamiento, dbo.AtencionesDatosAdicionales.IdTipoReferenciaOrigen,
                                      dbo.AtencionesDatosAdicionales.NroReferenciaDestino
                 FROM         dbo.Atenciones INNER JOIN
                                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion INNER JOIN
                                      dbo.AtencionesDatosAdicionales ON dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.idAtencion LEFT OUTER JOIN
                                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento LEFT OUTER JOIN
                                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado LEFT OUTER JOIN
                                      dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
                 where           dbo.Atenciones.idCuentaAtencion=@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionCuentasAtencionXnroCuentaConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionExoneracionesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionExoneracionesAgregar]
	@IdAtencion [int],
	@IdExoneracion [int] OUTPUT,
	@FechaExoneracion [datetime],
	@IdEmpleadoExonera [int],
	@TotalExonerado [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionExoneraciones (
IdAtencion,IdEmpleadoExonera,FechaExoneracion,TotalExonerado) values (
@IdAtencion,@IdEmpleadoExonera,@FechaExoneracion,@TotalExonerado)
set @IdExoneracion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdExoneracion,'FacturacionExoneraciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionExoneracionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionExoneracionesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionExoneracionesEliminar]
	@IdExoneracion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionExoneraciones
where IdExoneracion = @IdExoneracion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdExoneracion,'FacturacionExoneraciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionExoneracionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionExoneracionesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionExoneracionesModificar]
	@IdAtencion [int],
	@IdEmpleadoExonera [int],
	@FechaExoneracion [datetime],
	@IdExoneracion [int],
	@TotalExonerado [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionExoneraciones
set
IdAtencion = @IdAtencion,
IdEmpleadoExonera = @IdEmpleadoExonera,
FechaExoneracion = @FechaExoneracion,
TotalExonerado = @TotalExonerado
where IdExoneracion = @IdExoneracion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdExoneracion,'FacturacionExoneraciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionExoneracionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionExoneracionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionExoneracionesSeleccionarPorId]
	@IdExoneracion [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionExoneraciones
where IdExoneracion = @IdExoneracion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionExoneracionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionfarmMovimientoVentasConsultarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionfarmMovimientoVentasConsultarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento
FROM         dbo.farmMovimiento INNER JOIN
                   dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                   dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                  dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo AND
                 dbo.farmMovimientoVentas.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero
where dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion
*/
SELECT        dbo.farmMovimientoVentas.idCuentaAtencion,
                         dbo.FacturacionBienesFinanciamientos.MovNumero,
                         dbo.FacturacionBienesFinanciamientos.MovTipo,
                         dbo.FacturacionBienesFinanciamientos.IdProducto,
                         dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento,
                         dbo.FacturacionBienesFinanciamientos.idFuenteFinanciamiento,
                         dbo.FacturacionBienesFinanciamientos.CantidadFinanciada,
                         dbo.FacturacionBienesFinanciamientos.PrecioFinanciado,
                         dbo.FacturacionBienesFinanciamientos.TotalFinanciado,
                         dbo.FacturacionBienesFinanciamientos.FechaAutoriza,
                         dbo.FacturacionBienesFinanciamientos.IdUsuarioAutoriza,
                         dbo.FacturacionBienesFinanciamientos.idEstadoFacturacion,
                         dbo.farmMovimiento.idEstadoMovimiento
FROM            dbo.farmMovimiento INNER JOIN
                         dbo.farmMovimientoVentas ON
                         dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                         dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
                         dbo.FacturacionBienesFinanciamientos ON
                         dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo AND
                         dbo.farmMovimientoVentas.movNumero = dbo.FacturacionBienesFinanciamientos.MovNumero
where dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionfarmMovimientoVentasConsultarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPagosACuentaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPagosACuentaAgregar]
	@IdAtencion [int],
	@IdPagosACuenta [int] OUTPUT,
	@TotalPagado [money],
	@FechaPago [datetime],
	@IdComprobantePago [int],
	@IdEmpleadoCajero [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionPagosACuenta (
IdAtencion,TotalPagado,FechaPago,IdComprobantePago,IdEmpleadoCajero) values (
@IdAtencion,@TotalPagado,@FechaPago,@IdComprobantePago,@IdEmpleadoCajero)
set @IdPagosACuenta = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPagosACuenta,'FacturacionPagosACuenta'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPagosACuentaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPagosACuentaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPagosACuentaEliminar]
	@IdPagosACuenta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionPagosACuenta
where IdPagosACuenta = @IdPagosACuenta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPagosACuenta,'FacturacionPagosACuenta'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPagosACuentaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPagosACuentaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPagosACuentaModificar]
	@IdPagosACuenta [int],
	@IdAtencion [int],
	@TotalPagado [money],
	@FechaPago [datetime],
	@IdComprobantePago [int],
	@IdEmpleadoCajero [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPagosACuenta
set
IdAtencion = @IdAtencion,
TotalPagado = @TotalPagado,
FechaPago = @FechaPago,
IdComprobantePago = @IdComprobantePago,
IdEmpleadoCajero = @IdEmpleadoCajero
where IdPagosACuenta = @IdPagosACuenta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPagosACuenta,'FacturacionPagosACuenta'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPagosACuentaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPagosACuentaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPagosACuentaSeleccionarPorId]
	@IdPagosACuenta [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionPagosACuenta
where IdPagosACuenta = @IdPagosACuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPagosACuentaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesActualizaXidComprobIdOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesActualizaXidComprobIdOrdenIdProducto]
	@IdCuentaAtencion [int],
	@IdComprobantePago [int],
	@idOrdenPago [int],
	@idProducto [int],
	@lbEsNull [bit]
WITH EXECUTE AS CALLER
AS
if @lbEsNull=1
   update FacturacionPaquetes set AtencionId=@IdCuentaAtencion
               Where idComprobantePago=@IdComprobantePago
                     and idOrdenPago=@idOrdenPago
                     and idProducto=@idProducto
else
   update FacturacionPaquetes set AtencionId=null
               Where idComprobantePago=@IdComprobantePago
                     and idOrdenPago=@idOrdenPago
                     and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesActualizaXidComprobIdOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesAgregar]
	@idComprobantePago [int],
	@idOrdenPago [int],
	@idProducto [int],
	@idFactPaquete [int],
	@IdPuntoCarga [int],
	@idEspecialidadServicio [int],
	@AtencionId [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionPaquetes (
idComprobantePago,idOrdenPago,idProducto,idFactPaquete,IdPuntoCarga,idEspecialidadServicio,AtencionId) values (
@idComprobantePago,@idOrdenPago,@idProducto,@idFactPaquete,@IdPuntoCarga,@idEspecialidadServicio,@AtencionId)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idComprobantePago,'FacturacionPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesCEporIdPuntoCargaNrocuentaIdEspecialidad]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesCEporIdPuntoCargaNrocuentaIdEspecialidad]
	@idPuntoCarga [int],
	@IdCuentaAtencion [int],
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select idPuntoCarga from FacturacionPaquetes where idPuntoCarga=@idPuntoCarga
             and AtencionId=@IdCuentaAtencion and idEspecialidadServicio=@IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesCEporIdPuntoCargaNrocuentaIdEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesEliminar]
	@idComprobantePago [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionPaquetes
where idComprobantePago = @idComprobantePago
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idComprobantePago,'FacturacionPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesFarmaciaXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesFarmaciaXcodigo]
	@codigo [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionCatalogoPaquetes.*, dbo.FactCatalogoPaquete.Codigo AS PQcodigo,
                      dbo.FactCatalogoPaquete.Descripcion, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.FactCatalogoPaquete.TipoPaquete,dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
                      dbo.FactCatalogoBienesInsumos.IdProducto
FROM         dbo.FactCatalogoPaquete INNER JOIN
                      dbo.FacturacionCatalogoPaquetes ON dbo.FactCatalogoPaquete.idFactPaquete = dbo.FacturacionCatalogoPaquetes.idFactPaquete LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionCatalogoPaquetes.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     (dbo.FactCatalogoPaquete.TipoPaquete = 2) and dbo.FactCatalogoPaquete.Codigo=@codigo
order by dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesFarmaciaXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesModificaAtencionId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesModificaAtencionId]
	@AtencionId [int],
	@IdProducto [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPaquetes set AtencionId =@AtencionId
where idProducto=@IdProducto and idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesModificaAtencionId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesModificar]
	@idComprobantePago [int],
	@idOrdenPago [int],
	@idProducto [int],
	@idFactPaquete [int],
	@IdPuntoCarga [int],
	@idEspecialidadServicio [int],
	@AtencionId [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPaquetes
set
idOrdenPago = @idOrdenPago,
idProducto = @idProducto,
idFactPaquete = @idFactPaquete,
IdPuntoCarga = @IdPuntoCarga,
idEspecialidadServicio = @idEspecialidadServicio,
AtencionId = @AtencionId
where idComprobantePago = @idComprobantePago
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idComprobantePago,'FacturacionPaquetes'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesModificarAtencionIdNull]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesModificarAtencionIdNull]
	@IdProducto [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPaquetes set AtencionId =null where idProducto=@IdProducto and idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesModificarAtencionIdNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesSeleccionarPorFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)

IF @Filtro = ' '
	SET  @SQL =  'select * from FacturacionPaquetes'
ELSE
	SET  @SQL = 'select * from FacturacionPaquetes where '  + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesSeleccionarPorFiltro1]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesSeleccionarPorFiltro1]
	@lcFiltro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)


	SET  @SQL =  'SELECT     dbo.FacturacionPaquetes.*, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
 FROM         dbo.FacturacionPaquetes LEFT OUTER JOIN
     dbo.CajaComprobantesPago ON dbo.FacturacionPaquetes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
 WHERE '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesSeleccionarPorFiltro1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesSeleccionarPorId]
	@idComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionPaquetes
where idComprobantePago = @idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesSeleccionaXIdPuntoCArga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesSeleccionaXIdPuntoCArga]
	@IdPuntoCArga [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionPaquetes where AtencionId>0 and idPuntoCArga=@IdPuntoCArga
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesSeleccionaXIdPuntoCArga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPaquetesXidComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionPaquetesXidComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionPaquetes
where atencionId>0 and idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPaquetesXidComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPreventaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPreventaAgregar]
	@idFactPreventa [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionPreventa (
idFactPreventa,idProducto,Cantidad,Precio,Importe) values (
@idFactPreventa,@idProducto,@Cantidad,@Precio,@Importe)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idFactPreventa,'FacturacionPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPreventaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPreventaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPreventaEliminar]
	@idFactPreventa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionPreventa
where idFactPreventa = @idFactPreventa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactPreventa,'FacturacionPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPreventaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPreventaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPreventaModificar]
	@idFactPreventa [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionPreventa
set
idProducto = @idProducto,
Cantidad = @Cantidad,
Precio = @Precio,
Importe = @Importe
where idFactPreventa = @idFactPreventa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idFactPreventa,'FacturacionPreventa'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPreventaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionPreventaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionPreventaSeleccionarPorId]
	@idFactPreventa [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionPreventa
where idFactPreventa = @idFactPreventa
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionPreventaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosAgregar]
	@idFactReembolso [int],
	@idCuentaAtencion [int],
	@ConsumoPorReembolsar [money],
	@ReembolsoPorPagar [money],
	@ReembolsoPagadoFarmacia [money],
	@ReembolsoPagadoServicio [money],
	@IdReembolsosAnteriores [varchar](100),
	@idDiagnostico [int],
	@NroReferenciaDestino [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionReembolsos (
idFactReembolso,idCuentaAtencion,ConsumoPorReembolsar,ReembolsoPorPagar,ReembolsoPagadoFarmacia,ReembolsoPagadoServicio,IdReembolsosAnteriores,idDiagnostico,NroReferenciaDestino) values (
@idFactReembolso,@idCuentaAtencion,@ConsumoPorReembolsar,@ReembolsoPorPagar,@ReembolsoPagadoFarmacia,@ReembolsoPagadoServicio,@IdReembolsosAnteriores,@idDiagnostico,@NroReferenciaDestino)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idFactReembolso,'FacturacionReembolsos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosConsultarXIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosConsultarXIdCuenta]
	@IdCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.idFactReembolso, dbo.FacturacionReembolsos.idCuentaAtencion, dbo.FactReembolsosDocumentos.idComprobantePago,
                            dbo.CajaComprobantesPago.*
FROM         dbo.FacturacionReembolsos INNER JOIN
                           dbo.FactReembolsosDocumentos ON
                                   dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
                                      dbo.CajaComprobantesPago ON dbo.FactReembolsosDocumentos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
Where dbo.FacturacionReembolsos.idCuentaAtencion = @IdCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosConsultarXIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosEliminar]
	@idFactReembolso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionReembolsos
where idFactReembolso = @idFactReembolso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idFactReembolso,'FacturacionReembolsos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosModificar]
	@idFactReembolso [int],
	@idCuentaAtencion [int],
	@ConsumoPorReembolsar [money],
	@ReembolsoPorPagar [money],
	@ReembolsoPagadoFarmacia [money],
	@ReembolsoPagadoServicio [money],
	@IdReembolsosAnteriores [varchar](100),
	@idDiagnostico [int],
	@NroReferenciaDestino [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionReembolsos
set
idCuentaAtencion = @idCuentaAtencion,
ConsumoPorReembolsar = @ConsumoPorReembolsar,
ReembolsoPorPagar = @ReembolsoPorPagar,
ReembolsoPagadoFarmacia = @ReembolsoPagadoFarmacia,
ReembolsoPagadoServicio = @ReembolsoPagadoServicio,
IdReembolsosAnteriores = @IdReembolsosAnteriores,
idDiagnostico = @idDiagnostico,
NroReferenciaDestino = @NroReferenciaDestino
where idFactReembolso = @idFactReembolso
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idFactReembolso,'FacturacionReembolsos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarCEPorIdFactReembolso]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarCEPorIdFactReembolso]
	@idFactReembolso [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.*, dbo.EstadosCuenta.Descripcion AS DEstadoCuenta, LTRIM(dbo.Pacientes.ApellidoPaterno)
                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente, dbo.Servicios.Nombre AS dServicio,
                      dbo.Atenciones.FechaIngreso,  dbo.Atenciones.IdAtencion, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion as DDx,dbo.Atenciones.idTipoServicio
FROM         dbo.Diagnosticos RIGHT OUTER JOIN
                      dbo.FacturacionReembolsos ON dbo.Diagnosticos.IdDiagnostico = dbo.FacturacionReembolsos.idDiagnostico LEFT OUTER JOIN
                      dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso ON
                      dbo.FacturacionReembolsos.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.FacturacionCuentasAtencion ON
                      dbo.FacturacionReembolsos.idCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
where     dbo.FacturacionReembolsos.idFactReembolso=@idFactReembolso and dbo.Atenciones.idTipoServicio=1
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarCEPorIdFactReembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarHospEmergPorIdFactReembolso]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarHospEmergPorIdFactReembolso]
	@idFactReembolso [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.*, dbo.EstadosCuenta.Descripcion AS DEstadoCuenta, LTRIM(dbo.Pacientes.ApellidoPaterno)
                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + dbo.Pacientes.PrimerNombre AS Paciente, dbo.Servicios.Nombre AS dServicio,
                       dbo.Atenciones.IdAtencion, dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.FechaEgreso,
                      dbo.Diagnosticos.Descripcion as DDx, dbo.Diagnosticos.CodigoCIE2004,dbo.Atenciones.idTipoServicio
FROM         dbo.Diagnosticos RIGHT OUTER JOIN
                      dbo.FacturacionReembolsos ON dbo.Diagnosticos.IdDiagnostico = dbo.FacturacionReembolsos.idDiagnostico LEFT OUTER JOIN
                      dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso ON
                      dbo.FacturacionReembolsos.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.FacturacionCuentasAtencion ON
                      dbo.FacturacionReembolsos.idCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.EstadosCuenta ON dbo.FacturacionCuentasAtencion.IdEstado = dbo.EstadosCuenta.IdEstado
where     dbo.FacturacionReembolsos.idFactReembolso=@idFactReembolso and dbo.Atenciones.idTipoServicio>1
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarHospEmergPorIdFactReembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarPorAnioMes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarPorAnioMes]
	@Anio [int],
	@Mes [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.*, dbo.FactReembolsos.Anio, dbo.FactReembolsos.Mes, dbo.FactReembolsos.idEstadoReembolso, dbo.FactReembolsos.idFuenteFinanciamiento
FROM         dbo.FactReembolsos RIGHT OUTER JOIN
                      dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso
WHERE  dbo.FactReembolsos.Anio=@Anio AND  dbo.FactReembolsos.Mes=@Mes
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarPorAnioMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.idFactReembolso AS Ident, dbo.FactReembolsos.Anio AS Año, dbo.FactReembolsos.Mes,
                      dbo.FactReembolsosDocumentos.NroSerie, dbo.FactReembolsosDocumentos.NroDocumento, dbo.TiposConsumos.Descripcion AS TipoReembolso,
                      dbo.FacturacionReembolsos.ConsumoPorReembolsar AS Consumo, dbo.FacturacionReembolsos.ReembolsoPorPagar AS PorReembolsar,
                      dbo.FacturacionReembolsos.ReembolsoPagadoFarmacia AS Reemb_Farmacia,
                      dbo.FacturacionReembolsos.ReembolsoPagadoServicio AS Reemb_Servicio,
                      dbo.FactReembolsos.GrabaDefinitivamente
FROM         dbo.FactReembolsosDocumentos INNER JOIN
                      dbo.FactReembolsos ON dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FactReembolsos.idFactReembolso INNER JOIN
                      dbo.FacturacionReembolsos ON dbo.FactReembolsos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso LEFT OUTER JOIN
                      dbo.TiposConsumos ON dbo.FactReembolsos.idTipoConsumo = dbo.TiposConsumos.idTipoConsumo
WHERE  dbo.FacturacionReembolsos.idCuentaAtencion=@idCuentaAtencion AND dbo.FactReembolsos.idEstadoReembolso=1
ORDER BY dbo.FacturacionReembolsos.idFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarPorCuentaPlanAreats]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarPorCuentaPlanAreats]
	@idCuentaAtencion [int],
	@idFuenteFinanciamiento [int],
	@idAreaTramitaSeguro [int],
	@idTipoConsumo [int]
WITH EXECUTE AS CALLER
AS
if @idTipoConsumo>0
	SELECT     dbo.FacturacionReembolsos.*, dbo.FactReembolsos.idAreaTramitaSeguro, dbo.FactReembolsos.idFuenteFinanciamiento
	FROM         dbo.FacturacionReembolsos LEFT OUTER JOIN
	                      dbo.FactReembolsos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsos.idFactReembolso
	WHERE   dbo.FactReembolsos.idEstadoReembolso=1 and   dbo.FacturacionReembolsos.idCuentaAtencion=@idCuentaAtencion
	                and    dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro and  dbo.FactReembolsos.idFuenteFinanciamiento=@idFuenteFinanciamiento
		 and  dbo.FactReembolsos.idTipoConsumo=@idTipoConsumo
	ORDER BY dbo.FacturacionReembolsos.idFactReembolso desc
else
	SELECT     dbo.FacturacionReembolsos.*, dbo.FactReembolsos.idAreaTramitaSeguro, dbo.FactReembolsos.idFuenteFinanciamiento
	FROM         dbo.FacturacionReembolsos LEFT OUTER JOIN
	                      dbo.FactReembolsos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsos.idFactReembolso
	WHERE   dbo.FactReembolsos.idEstadoReembolso=1 and   dbo.FacturacionReembolsos.idCuentaAtencion=@idCuentaAtencion
	                and    dbo.FactReembolsos.idAreaTramitaSeguro=@idAreaTramitaSeguro and  dbo.FactReembolsos.idFuenteFinanciamiento=@idFuenteFinanciamiento
	ORDER BY dbo.FacturacionReembolsos.idFactReembolso desc
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarPorCuentaPlanAreats] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosSeleccionarPorId]
	@idFactReembolso [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionReembolsos
where idFactReembolso = @idFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosXboletaConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosXboletaConexion]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactReembolsosDocumentos.idFactReembolso, dbo.FactReembolsosDocumentos.idComprobantePago,
                 dbo.FacturacionReembolsos.ReembolsoPagadoFarmacia, dbo.FacturacionReembolsos.ReembolsoPagadoServicio,
                 dbo.FactReembolsos.idEstadoReembolso
                 FROM         dbo.FacturacionReembolsos LEFT OUTER JOIN
                 dbo.FactReembolsos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsos.idFactReembolso LEFT OUTER JOIN
                 dbo.FactReembolsosDocumentos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso
                 where  dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FactReembolsosDocumentos.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosXboletaConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosXcuenta]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FacturacionReembolsos.idFactReembolso, dbo.FacturacionReembolsos.idCuentaAtencion, dbo.FactReembolsosDocumentos.idComprobantePago,
                                   dbo.CajaComprobantesPago.*
              FROM          dbo.FacturacionReembolsos INNER JOIN
                                   dbo.FactReembolsosDocumentos ON
                                   dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
                                   dbo.CajaComprobantesPago ON dbo.FactReembolsosDocumentos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
              Where dbo.FacturacionReembolsos.idCuentaAtencion =@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionReembolsosXcuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionReembolsosXcuentaAtencion]
	@ml_idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.idFactReembolso, dbo.FacturacionReembolsos.idCuentaAtencion, dbo.FactReembolsosDocumentos.idComprobantePago,
                                                  dbo.CajaComprobantesPago.*
                             FROM         dbo.FacturacionReembolsos INNER JOIN
                                                  dbo.FactReembolsosDocumentos ON
                                                  dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso LEFT OUTER JOIN
                                                  dbo.CajaComprobantesPago ON dbo.FactReembolsosDocumentos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
                             Where dbo.FacturacionReembolsos.idCuentaAtencion =@ml_idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionReembolsosXcuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionSegurosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionSegurosAgregar]
	@NroPlaca [char](8),
	@CodigoAutorizacion [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@IdCuentaAtencion [int],
	@IdFacturacionSeguro [int] OUTPUT,
	@TotalAsegurado [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionSeguros (
NroPlaca,CodigoAutorizacion,IdTipoFinanciamiento,IdFuenteFinanciamiento,IdCuentaAtencion,TotalAsegurado) values (
@NroPlaca,@CodigoAutorizacion,@IdTipoFinanciamiento,@IdFuenteFinanciamiento,@IdCuentaAtencion,@TotalAsegurado)
set @IdFacturacionSeguro = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionSeguro,'FacturacionSeguros'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionSegurosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionSegurosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionSegurosEliminar]
	@IdFacturacionSeguro [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionSeguros
where IdFacturacionSeguro = @IdFacturacionSeguro
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFacturacionSeguro,'FacturacionSeguros'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionSegurosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionSegurosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionSegurosModificar]
	@NroPlaca [char](8),
	@CodigoAutorizacion [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@IdCuentaAtencion [int],
	@IdFacturacionSeguro [int],
	@TotalAsegurado [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionSeguros
set
NroPlaca = @NroPlaca,
CodigoAutorizacion = @CodigoAutorizacion,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
IdCuentaAtencion = @IdCuentaAtencion,
TotalAsegurado = @TotalAsegurado
where IdFacturacionSeguro = @IdFacturacionSeguro
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionSeguro,'FacturacionSeguros'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionSegurosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionSegurosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionSegurosSeleccionarPorId]
	@IdFacturacionSeguro [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionSeguros
where IdFacturacionSeguro = @IdFacturacionSeguro
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionSegurosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoActualizaLAB]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoActualizaLAB]
	@idOrden [int],
	@IdProducto [int],
	@labConfHIS [varchar](3)
WITH EXECUTE AS CALLER
AS
update FacturacionServicioDespacho set labConfHIS=@labConfHIS
where idOrden = @idOrden and IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoActualizaLAB] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoAgregar]
	@idOrden [int],
	@IdProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@labConfHIS [varchar](3),
	@grupoHIS [int],
	@subGrupoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionServicioDespacho (
idOrden,IdProducto,Cantidad,Precio,Total, labConfHIS,grupoHIS,subgrupoHIS) values (
@idOrden,@IdProducto,@Cantidad,@Precio,@Total, @labConfHIS,@grupoHIS,@subgrupoHIS)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idOrden,'FacturacionServicioDespacho'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoEliminar]
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicioDespacho
where idOrden = @idOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrden,'FacturacionServicioDespacho'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoFiltraPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoFiltraPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioDespacho.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicio.idTipoFinanciamiento, dbo.FactOrdenServicio.FechaCreacion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.FactOrdenServicio.IdPuntoCarga,
                      dbo.FactOrdenServicio.IdServicioPaciente
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto
WHERE dbo.FacturacionServicioDespacho.idOrden=@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoFiltraPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga]
	@IdOrden [int],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioDespacho.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FactCatalogoServiciosPtos.idpuntocarga
FROM dbo.FactCatalogoServiciosPtos, dbo.FacturacionServicioDespacho LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto
WHERE dbo.FacturacionServicioDespacho.idOrden=@IdOrden AND dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServiciosPtos.IdProducto=dbo.FactCatalogoServicios.IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoModificar]
	@idOrden [int],
	@IdProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@grupoHIS [int],
	@subGrupoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioDespacho
set
IdProducto = @IdProducto,
Cantidad = @Cantidad,
Precio = @Precio,
Total = @Total,
grupoHIS=@grupoHIS,
subGrupoHIS=@subGrupoHIS
where idOrden = @idOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idOrden,'FacturacionServicioDespacho'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoPorIdOrdenIProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoPorIdOrdenIProducto]
	@idOrden [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioDespacho
where idOrden = @idOrden and IdProducto =@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoPorIdOrdenIProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoSeleccionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.IdProducto, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga ,
	        dbo.FactOrdenServicio.IdServicioPaciente,  dbo.FactOrdenServicio.FechaDespacho, FacturacionServicioDespacho.labConfHIS,dbo.FactCatalogoServicios.codigoSIS
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @idCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion
ORDER BY  dbo.FactOrdenServicio.FechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoSeleccionarPorId]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioDespacho
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoSeleccionarPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoSeleccionarPorIdCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdPuntoCarga,
                                  dbo.FacturacionServicioDespacho.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                  dbo.FactCatalogoServicios.codigoSIS
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.FacturacionServicioDespacho ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
                                  dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden
             WHERE       dbo.FactOrdenServicio.IdEstadoFacturacion<>9 and dbo.FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoSeleccionarPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoSeleccionarPorIdProducto]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioDespacho
where idProducto = @idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoSeleccionarXidCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoSeleccionarXidCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                                  dbo.FacturacionServicioDespacho.IdProducto,
                                  dbo.FactCatalogoServicios.codigo , dbo.FactCatalogoServicios.Nombre, Cantidad=sum(dbo.FacturacionServicioDespacho.Cantidad),
								  Precio=sum( dbo.FacturacionServicioDespacho.Precio)
              FROM          dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.FacturacionServicioDespacho ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
                                  dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden

	where
	dbo.FactOrdenServicio.IdEstadoFacturacion<>9
                                 and dbo.FactOrdenServicio.IdCuentaAtencion=@idCuentaAtencion

Group By
   dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdEstadoFacturacion,
                                  dbo.FacturacionServicioDespacho.IdProducto,
                                  dbo.FactCatalogoServicios.codigo , dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoSeleccionarXidCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.IdProducto, dbo.FacturacionServicioDespacho.Cantidad,
                                  dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactCatalogoServicios.Codigo,
                                  dbo.FactCatalogoServicios.Nombre, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                                  dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                                  dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga ,
                                  dbo.FactOrdenServicio.IdServicioPaciente , dbo.FactOrdenServicio.FechaDespacho,
                                  dbo.FacturacionServicioDespacho.labConfHIS
             FROM           dbo.FacturacionServicioDespacho INNER JOIN
                                  dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                                  dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                                  dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                                  dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
             WHERE       dbo.FactOrdenServicio.IdCuentaAtencion=@idCuentaAtencion
             ORDER BY  dbo.FacturacionServicioDespacho.idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDespachoXfechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDespachoXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Servicios.Nombre AS dservicio, dbo.Servicios.codigoServicioSuSalud, dbo.FactCatalogoServicios.Codigo AS cpt,
                      dbo.FactCatalogoServicios.Nombre AS cptDescripcion, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FacturacionServicioDespacho.*,
		dbo.Servicios.IdTipoServicio
FROM         dbo.FactCatalogoServicios INNER JOIN
                      dbo.FacturacionServicioDespacho ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio
WHERE     (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9) and (dbo.FactOrdenServicio.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDespachoXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesAgregar]
	@idOrden [int],
	@idProducto [int],
	@CantidadAdevolver [int],
	@IdComprobantePago [int],
	@idEstadoDevolucion [int],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionServicioDevoluciones (
idOrden,idProducto,CantidadAdevolver,IdComprobantePago,idEstadoDevolucion,FechaAutoriza,IdUsuarioAutoriza) values (
@idOrden,@idProducto,@CantidadAdevolver,@IdComprobantePago,@idEstadoDevolucion,@FechaAutoriza,@IdUsuarioAutoriza)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idOrden,'FacturacionServicioDevoluciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesEliminar]
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicioDevoluciones
where idOrden = @idOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrden,'FacturacionServicioDevoluciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesModificar]
	@idOrden [int],
	@idProducto [int],
	@CantidadAdevolver [int],
	@IdComprobantePago [int],
	@idEstadoDevolucion [int],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioDevoluciones
set
idProducto = @idProducto,
CantidadAdevolver = @CantidadAdevolver,
IdComprobantePago = @IdComprobantePago,
idEstadoDevolucion = @idEstadoDevolucion,
FechaAutoriza = @FechaAutoriza,
IdUsuarioAutoriza = @IdUsuarioAutoriza
where idOrden = @idOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idOrden,'FacturacionServicioDevoluciones'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesSeleccionarPorId]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioDevoluciones
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesSeleccionarPorIdOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesSeleccionarPorIdOrdenIdProducto]
	@idOrden [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioDevoluciones
where idOrden = @idOrden and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesSeleccionarPorIdOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioDevolucionesXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioDevolucionesXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FacturacionServicioDevoluciones.*
             FROM          dbo.FacturacionServicioDevoluciones LEFT OUTER JOIN
                                 dbo.FactOrdenServicio ON dbo.FacturacionServicioDevoluciones.idOrden = dbo.FactOrdenServicio.IdOrden
             Where         dbo.FactOrdenServicio.idCuentaAtencion =@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioDevolucionesXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamFiltrarXIdOrdenProductoTFinanc]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamFiltrarXIdOrdenProductoTFinanc]
	@IdOrden [int],
	@IdProducto [int],
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioFinanciamientos where idOrden=@IdOrden
             and idProducto=@IdProducto and idtipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamFiltrarXIdOrdenProductoTFinanc] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFact]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFact]
	@idOrden [int],
	@idEstadoFacturacion [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioFinanciamientos set idEstadoFacturacion=@idEstadoFacturacion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFact] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFacturacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFacturacion]
	@lnNuevoIdEstadoFacturacion [int],
	@lnIdOrden [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioFinanciamientos set idEstadoFacturacion=@lnNuevoIdEstadoFacturacion where idOrden=@lnIdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosActualizaIdEstadoFacturacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosActualizaPrecio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosActualizaPrecio]
	@idOrden [int],
	@porcentaje [money],
	@importeCubreEps [money] OUTPUT
WITH EXECUTE AS CALLER
AS
update FacturacionServicioFinanciamientos set
       PrecioFinanciado=round(PrecioFinanciado*(@porcentaje/100),2) where idOrden =@idOrden

update FacturacionServicioFinanciamientos set
    PrecioFinanciado=round(
                     (select top 1 PrecioUnitario  from FactCatalogoServiciosHosp
                           where IdProducto=FacturacionServicioFinanciamientos.idProducto
                           and IdTipoFinanciamiento=FacturacionServicioFinanciamientos.IdTipoFinanciamiento   ) *
                     ((select top 1 porcentaje from eps_cptfijos where
                            idfuentefinanciamiento=FacturacionServicioFinanciamientos.idFuenteFinanciamiento ))/100
                            ,2)
from FacturacionServicioFinanciamientos  where idOrden =@idOrden and
                    idproducto in (select idproducto from eps_cptfijos where
                    idfuentefinanciamiento=FacturacionServicioFinanciamientos.idFuenteFinanciamiento)


update FacturacionServicioFinanciamientos set
       TotalFinanciado=round(PrecioFinanciado*CantidadFinanciada,2)  where idOrden =@idOrden

 set @importeCubreEps= (select sum(TotalFinanciado)  from FacturacionServicioFinanciamientos where idOrden =@idOrden)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosActualizaPrecio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosAgregar]
	@idOrden [int],
	@idProducto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@CantidadFinanciada [int],
	@PrecioFinanciado [money],
	@TotalFinanciado [money],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionServicioFinanciamientos (
idOrden,idProducto,IdTipoFinanciamiento,CantidadFinanciada,PrecioFinanciado,TotalFinanciado,FechaAutoriza,IdUsuarioAutoriza,IdFuenteFinanciamiento) values (
@idOrden,@idProducto,@IdTipoFinanciamiento,@CantidadFinanciada,@PrecioFinanciado,@TotalFinanciado,@FechaAutoriza,@IdUsuarioAutoriza,@IdFuenteFinanciamiento)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idOrden,'FacturacionServicioFinanciamientos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosConsultarX@IdOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosConsultarX@IdOrdenIdProducto]
	@IdOrden [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     idOrden, IdTipoFinanciamiento, TotalFinanciado, idProducto
From dbo.FacturacionServicioFinanciamientos
Where (IdTipoFinanciamiento = 9) and idOrden=@IdOrden and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosConsultarX@IdOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosConsultarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosConsultarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*
SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.*,
                   dbo.FactOrdenServicio.idEstadoFacturacion,dbo.FactOrdenServicio.idPuntoCarga,dbo.FacturacionServicioFinanciamientos.totalFinanciado as TotalPorPagar
FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
                   dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE    dbo.FactOrdenServicio.idCuentaAtencion=@IdCuentaAtencion
*/
SELECT        dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.idOrden,
                         dbo.FacturacionServicioFinanciamientos.idProducto,
                         dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento,
                         dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento,
                         dbo.FacturacionServicioFinanciamientos.CantidadFinanciada,
                         dbo.FacturacionServicioFinanciamientos.PrecioFinanciado,
                         dbo.FacturacionServicioFinanciamientos.TotalFinanciado,
                         dbo.FacturacionServicioFinanciamientos.FechaAutoriza,
                         dbo.FacturacionServicioFinanciamientos.IdUsuarioAutoriza,
                         dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion,
                         dbo.FactOrdenServicio.IdEstadoFacturacion AS Expr1, dbo.FactOrdenServicio.IdPuntoCarga,
                         dbo.FacturacionServicioFinanciamientos.TotalFinanciado AS TotalPorPagar
FROM            dbo.FacturacionServicioFinanciamientos INNER JOIN
                         dbo.FactOrdenServicio ON
                         dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE    dbo.FactOrdenServicio.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosConsultarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosDespachos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosDespachos]
	@FechaIni [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
if @idFuenteFinanciamiento=0
SELECT     dbo.FacturacionServicioFinanciamientos.idProducto, dbo.FacturacionServicioFinanciamientos.CantidadFinanciada,
                      dbo.FacturacionServicioFinanciamientos.PrecioFinanciado, dbo.FacturacionServicioFinanciamientos.TotalFinanciado,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre, dbo.FuentesFinanciamiento.Descripcion
FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento ON
                      dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden
WHERE     (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9) AND (dbo.Atenciones.IdFormaPago > 1) AND (dbo.Atenciones.idEstadoAtencion = 1) AND
                      (dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion <> 9) and
             dbo.FactOrdenServicio.FechaCreacion Between  @FechaIni and  @FechaFin
order by dbo.FacturacionServicioFinanciamientos.idProducto,dbo.Atenciones.idFuenteFinanciamiento
else
SELECT     dbo.FacturacionServicioFinanciamientos.idProducto, dbo.FacturacionServicioFinanciamientos.CantidadFinanciada,
                      dbo.FacturacionServicioFinanciamientos.PrecioFinanciado, dbo.FacturacionServicioFinanciamientos.TotalFinanciado,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre, dbo.FuentesFinanciamiento.Descripcion
FROM         dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento ON
                      dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden
WHERE     (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9) AND (dbo.Atenciones.IdFormaPago > 1) AND (dbo.Atenciones.idEstadoAtencion = 1) AND
                      (dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion <> 9) and
             (dbo.FactOrdenServicio.FechaCreacion Between  @FechaIni and  @FechaFin) and
               dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento
order by dbo.FacturacionServicioFinanciamientos.idProducto,dbo.Atenciones.idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosDespachos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosEliminar]
	@idOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicioFinanciamientos
where idOrden = @idOrden
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrden,'FacturacionServicioFinanciamientos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosEliminarPorIdTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosEliminarPorIdTipoFinanciamiento]
	@idOrden [int],
	@idTipoFinanciamiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicioFinanciamientos
where idOrden = @idOrden and idTipoFinanciamiento=@idTipoFinanciamiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrden,'FacturacionServicioFinanciamientos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosEliminarPorIdTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosExoneracionesEnBoleta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosExoneracionesEnBoleta]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicioPagos.idOrdenPago, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.idOrden,
                                     dbo.FacturacionServicioFinanciamientos.idProducto, dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento,
                                     dbo.FacturacionServicioFinanciamientos.IdFuenteFinanciamiento , dbo.FacturacionServicioFinanciamientos.TotalFinanciado,dbo.FacturacionServicioFinanciamientos.CantidadFinanciada
                FROM         dbo.FactOrdenServicioPagos LEFT OUTER JOIN
                                     dbo.FacturacionServicioFinanciamientos ON dbo.FactOrdenServicioPagos.idOrden = dbo.FacturacionServicioFinanciamientos.idOrden
                Where dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento = 9 and dbo.FactOrdenServicioPagos.IdComprobantePago =  @IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosExoneracionesEnBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosExonerados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosExonerados]
	@idComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioFinanciamientos.TotalFinanciado, dbo.FactOrdenServicioPagos.idOrden, dbo.FacturacionServicioFinanciamientos.idProducto,
                    dbo.FactOrdenServicioPagos.idOrden
FROM         dbo.FactOrdenServicioPagos INNER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactOrdenServicioPagos.idOrden = dbo.FacturacionServicioFinanciamientos.idOrden
WHERE     (dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento = 9) and  dbo.FactOrdenServicioPagos.idComprobantePago =@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosExonerados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioFinanciamientos.*,
                  dbo.FacturacionServicioFinanciamientos.cantidadFinanciada as cantidad,dbo.FacturacionServicioFinanciamientos.precioFinanciado as precio,
                  dbo.FacturacionServicioFinanciamientos.totalFinanciado as total
FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioFinanciamientos.idProducto = dbo.FactCatalogoServicios.IdProducto
WHERE    dbo.FacturacionServicioFinanciamientos.idOrden=@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrdenConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrdenConexion]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioFinanciamientos.idOrden,
                                  dbo.FacturacionServicioFinanciamientos.idProducto, dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento,
                                  dbo.FacturacionServicioFinanciamientos.CantidadFinanciada, dbo.FacturacionServicioFinanciamientos.PrecioFinanciado,
                                  dbo.FacturacionServicioFinanciamientos.TotalFinanciado , dbo.FacturacionServicioFinanciamientos.IdEstadoFacturacion
             FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto
             Where          (dbo.FacturacionServicioFinanciamientos.IdEstadoFacturacion <> 9)
                                  and dbo.FacturacionServicioFinanciamientos.idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosFiltraPorIdOrdenConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosModificar]
	@idOrden [int],
	@idProducto [int],
	@IdTipoFinanciamiento [int],
	@IdFuenteFinanciamiento [int],
	@CantidadFinanciada [int],
	@PrecioFinanciado [money],
	@TotalFinanciado [money],
	@FechaAutoriza [datetime],
	@IdUsuarioAutoriza [int],
	@IdEstadoFacturacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioFinanciamientos
set
CantidadFinanciada = @CantidadFinanciada,
PrecioFinanciado = @PrecioFinanciado,
TotalFinanciado = @TotalFinanciado,
FechaAutoriza = @FechaAutoriza,
IdUsuarioAutoriza = @IdUsuarioAutoriza,
IdFuenteFinanciamiento=@IdFuenteFinanciamiento,
IdEstadoFacturacion=@IdEstadoFacturacion
where idOrden = @idOrden and idProducto = @idProducto and IdTipoFinanciamiento = @IdTipoFinanciamiento
--SCCQ 26-04-2021 Cambio 64 Fin (Reversion Cambio 46)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosPorIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosPorIdCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.*,
                  dbo.FactOrdenServicio.idEstadoFacturacion,dbo.FactOrdenServicio.idPuntoCarga,dbo.FacturacionServicioFinanciamientos.totalFinanciado as TotalPorPagar
FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE    dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosSeleccionarPorId]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioFinanciamientos
where idOrden = @idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosSeleccionarPorIdOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosSeleccionarPorIdOrdenIdProducto]
	@idOrden [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioFinanciamientos
where idOrden = @idOrden and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosSeleccionarPorIdOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[facturacionServicioFinanciamientosSoloExonerados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[facturacionServicioFinanciamientosSoloExonerados]
	@IdOrden [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from facturacionServicioFinanciamientos
	where idOrden=@IdOrden and idProducto=@IdProducto
	and idTipoFinanciamiento=9
GO
ALTER AUTHORIZATION ON [dbo].[facturacionServicioFinanciamientosSoloExonerados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosXcuenta]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.*,
                                  dbo.FactOrdenServicio.idEstadoFacturacion,dbo.FactOrdenServicio.idPuntoCarga,dbo.FacturacionServicioFinanciamientos.totalFinanciado as TotalPorPagar
             FROM           dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
                                  dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
             WHERE        dbo.FactOrdenServicio.idCuentaAtencion=@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosXcuentaConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosXcuentaConexion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioFinanciamientos.*
             FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
                                dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
             Where        dbo.FactOrdenServicio.idCuentaAtencion =@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosXcuentaConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioFinanciamientosXidOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioFinanciamientosXidOrdenIdProducto]
	@IdOrden [int],
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     idOrden, IdTipoFinanciamiento, TotalFinanciado, idProducto
             From dbo.FacturacionServicioFinanciamientos
             Where (IdTipoFinanciamiento = 9) and idOrden= @IdOrden and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioFinanciamientosXidOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosAgregar]
	@idOrdenPago [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FacturacionServicioPagos (
idOrdenPago,idProducto,Cantidad,Precio,Total) values (
@idOrdenPago,@idProducto,@Cantidad,@Precio,@Total)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idOrdenPago,'FacturacionServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosEliminar]
	@idOrdenPago [int],
	@idProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
if @idProducto=0
   delete from FacturacionServicioPagos where idOrdenPago = @idOrdenPago
else
   delete from FacturacionServicioPagos where idOrdenPago = @idOrdenPago and idProducto =@idProducto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idOrdenPago,'FacturacionServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosFiltraPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosFiltraPorIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicioPagos.idComprobantePago
FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
WHERE    dbo.FactOrdenServicioPagos.idOrden=@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosFiltraPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosFiltraPorIdOrdenConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosFiltraPorIdOrdenConexion]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FactOrdenServicioPagos.idOrden,
                                  dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FactOrdenServicioPagos.ImporteExonerado, dbo.FactOrdenServicioPagos.IdEstadoFacturacion,
                                  dbo.FacturacionServicioPagos.cantidad , dbo.FacturacionServicioPagos.Precio, dbo.FacturacionServicioPagos.total
             FROM          dbo.FacturacionServicioPagos LEFT OUTER JOIN
                                  dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                  dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
             Where          (dbo.FactOrdenServicioPagos.IdEstadoFacturacion <> 9)
                                 and dbo.FactOrdenServicioPagos.idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosFiltraPorIdOrdenConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosFiltraPorIdOrdenPago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosFiltraPorIdOrdenPago]
	@idOrdenPago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idOrden,
                      dbo.FactOrdenServicioPagos.idComprobantePago,'' as observaciones
FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
WHERE    dbo.FactOrdenServicioPagos.idOrdenPago=@idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosFiltraPorIdOrdenPago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosModificar]
	@idOrdenPago [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FacturacionServicioPagos
set
idProducto = @idProducto,
Cantidad = @Cantidad,
Precio = @Precio,
Total = @Total
where idOrdenPago = @idOrdenPago
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idOrdenPago,'FacturacionServicioPagos'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS TotalPorPagar,
                      dbo.FactOrdenServicioPagos.idOrdenPago AS idFacturacionProducto, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FacturacionServicioPagos.idProducto, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactOrdenServicioPagos.idOrdenPago ,
		dbo.FactOrdenServicioPagos.ImporteExonerado,dbo.FactOrdenServicio.idEstadoFacturacion as EstadoFacOrdenServicio
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
WHERE dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion and dbo.FactOrdenServicioPagos.IdEstadoFacturacion=1
ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosPorCuentaTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosPorCuentaTodos]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS TotalPorPagar,
                      dbo.FactOrdenServicioPagos.idOrdenPago AS idFacturacionProducto, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FacturacionServicioPagos.idProducto, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactOrdenServicioPagos.idOrdenPago ,
		dbo.FactOrdenServicioPagos.ImporteExonerado
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
WHERE dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion
ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago    */



SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FacturacionServicioPagos.Cantidad,
                      dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS TotalPorPagar,
                      dbo.FactOrdenServicioPagos.idOrdenPago AS idFacturacionProducto, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FacturacionServicioPagos.idProducto, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicioPagos.idOrdenPago,
                      dbo.FactOrdenServicioPagos.ImporteExonerado
FROM         dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
WHERE dbo.FactOrdenServicio.idCuentaAtencion=@idCuentaAtencion
ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosPorCuentaTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosPorFechasComprobante]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosPorFechasComprobante]
	@ldFechaIni [datetime],
	@ldFechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.CajaComprobantesPago.IdComprobantePago,
                                       dbo.CajaComprobantesPago.NroSerie + '-' + dbo.CajaComprobantesPago.NroDocumento AS Boleta, dbo.CajaComprobantesPago.Total,
                                       dbo.CajaComprobantesPago.FechaCobranza , dbo.FacturacionServicioPagos.idProducto, dbo.FactCatalogoServiciosPtos.idPuntoCarga
                  FROM          dbo.FactCatalogoServiciosPtos INNER JOIN
                                       dbo.FacturacionServicioPagos ON dbo.FactCatalogoServiciosPtos.idProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                       dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                       dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                       dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                       dbo.FactOrdenServicio ON dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
                  Where         (dbo.CajaComprobantesPago.IdTipoOrden = 1) And (dbo.CajaComprobantesPago.IdEstadoComprobante = 4)
	                        and (dbo.CajaComprobantesPago.fechaCobranza Between @ldFechaIni and @ldFechaFin
	                        and dbo.FactOrdenServicio.idPuntoCarga=99)
                  Order by      dbo.CajaComprobantesPago.IdComprobantePago, dbo.FacturacionServicioPagos.idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosPorFechasComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosPorIdCuentaIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosPorIdCuentaIdProducto]
	@IdCuentaAtencion [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicioPagos.idOrdenPago,dbo.FacturacionServicioPagos.precio,
          dbo.FacturacionServicioPagos.idProducto, dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicioPagos.idComprobantePago,dbo.FacturacionServicioPagos.cantidad
 FROM         dbo.FactOrdenServicio INNER JOIN
          dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
          dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
 WHERE    dbo.FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion
          and dbo.FacturacionServicioPagos.idProducto=@idProducto
          and dbo.FactOrdenServicioPagos.IdEstadoFacturacion=4
          and dbo.FactOrdenServicioPagos.idComprobantePago>0
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosPorIdCuentaIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosSeleccionarPorId]
	@idOrdenPago [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioPagos
where idOrdenPago = @idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosSeleccionarPorIdOrdenIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosSeleccionarPorIdOrdenIdProducto]
	@idOrden [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.idComprobantePago,
	    dbo.FactOrdenServicioPagos.IdEstadoFacturacion
FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago
where     dbo.FactOrdenServicioPagos.idOrden = @idOrden and dbo.FacturacionServicioPagos.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosSeleccionarPorIdOrdenIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosSeleccionarXidProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosSeleccionarXidProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicioPagos where idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosSeleccionarXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosXcuentaYconexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosXcuentaYconexion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*SELECT      dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.idComprobantePago,
                                  dbo.FactOrdenServicioPagos.IdEstadoFacturacion
             FROM          dbo.FactOrdenServicio RIGHT OUTER JOIN
                                  dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
                                  dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
             Where 	       dbo.FactOrdenServicio.idCuentaAtencion = @idCuentaAtencion   */

SELECT     dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicioPagos.idComprobantePago,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion
FROM         dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
             Where 	       dbo.FactOrdenServicio.idCuentaAtencion = @idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosXcuentaYconexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioPagosXidComprobantePagoConexion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServicioPagosXidComprobantePagoConexion]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoServicios.IdServicioSubGrupo, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
                                       dbo.FacturacionServicioPagos.Precio , dbo.FacturacionServicioPagos.Total, dbo.FactOrdenServicioPagos.IdComprobantePago,
                                       dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
                  FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                       dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                       dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago
                  WHERE       dbo.FactOrdenServicioPagos.IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioPagosXidComprobantePagoConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServicioProcedimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServicioProcedimientos]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
--select FactCatalogoServicios.Codigo from FacturacionServicios
--left join FactCatalogoServicios on FacturacionServicios.IdProducto = FactCatalogoServicios.IdProducto
--left join FactCatalogoServiciosSubGrupo on FactCatalogoServiciosSubGrupo.IdServicioSubGrupo = FactCatalogoServicios.IdServicioSubGrupo
--where IdAtencion = @IdAtencion
--and FactCatalogoServicios.IdServicioSubGrupo between 2 and 23
SELECT     dbo.FactCatalogoServicios.Codigo
FROM         dbo.FactCatalogoServiciosSubGrupo RIGHT OUTER JOIN
                      dbo.FactOrdenServicio LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FacturacionServicioDespacho ON dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioDespacho.idOrden LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto ON
                      dbo.FactCatalogoServiciosSubGrupo.IdServicioSubGrupo = dbo.FactCatalogoServicios.IdServicioSubGrupo
WHERE    dbo.Atenciones.IdAtencion = @IdAtencion and  (dbo.FactCatalogoServicios.IdServicioSubGrupo BETWEEN 2 AND 23)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServicioProcedimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosAgregar]
	@FechaCreacion [datetime],
	@IdProducto [int],
	@PrecioUnitario [money],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdPartidaPresupuestal [int],
	@IdCentroCosto [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@TotalPorPagar [money],
	@IdAtencion [int],
	@IdFacturacionServicio [int] OUTPUT,
	@IdUsuarioModifica [int],
	@IdPuntoCarga [int],
	@FechaModificacion [datetime],
	@IdOrden [int],
	@IdUsuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdComprobantePagoDevolucion [int],
	@Cantidad [decimal](18, 0),
	@IdUsuarioCrea [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
insert into FacturacionServicios (
FechaCreacion,IdProducto,PrecioUnitario,IdEstadoFacturacion,IdFuenteFinanciamiento,IdTipoFinanciamiento,IdPartidaPresupuestal,IdCentroCosto,IdServicioInternamiento,IdComprobantePago,TotalPorPagar,IdAtencion,IdUsuarioModifica,IdPuntoCarga,FechaModificacion,IdOrden,IdUsuarioAutorizaSeguro,IdUsuarioAutorizaPendiente,IdUsuarioAutorizaDevolucion,IdCajero,FechaAutorizaSeguro,FechaAutorizaPendiente,FechaAutorizaDevolucion,FechaCajero,IdComprobantePagoDevolucion,Cantidad,IdUsuarioCrea,ImporteSIS,ImporteEXO,IdUsuarioAutorizaEXO,FechaAutorizaEXO,ImporteSOAT,TotalPagar,cantidadPagar,cantidadSIS,precioSIS,cantidadSOAT,precioSOAT,cantidadDev,FechaAutorizaConv,cantidadConv,precConv,ImporteConv) values (
@FechaCreacion,@IdProducto,@PrecioUnitario,@IdEstadoFacturacion,@IdFuenteFinanciamiento,@IdTipoFinanciamiento,@IdPartidaPresupuestal,@IdCentroCosto,@IdServicioInternamiento,@IdComprobantePago,@TotalPorPagar,@IdAtencion,@IdUsuarioModifica,@IdPuntoCarga,@FechaModificacion,@IdOrden,@IdUsuarioAutorizaSeguro,@IdUsuarioAutorizaPendiente,@IdUsuarioAutorizaDevolucion,@IdCajero,@FechaAutorizaSeguro,@FechaAutorizaPendiente,@FechaAutorizaDevolucion,@FechaCajero,@IdComprobantePagoDevolucion,@Cantidad,@IdUsuarioCrea,@ImporteSIS,@ImporteEXO,@IdusuarioAutorizaEXO,@FechaAutorizaEXO,@ImporteSOAT,@TotalPagar,@cantidad,@cantidadSIS,@precioSIS,@cantidadSOAT,@precioSOAT,@cantidadDev,@FechaAutorizaConv,@cantidadConv,@precConv,@ImporteConv)
set @IdFacturacionServicio = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionServicio,'FacturacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosAgregarServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosAgregarServicio]
	@IdFacturacionServicio [int] OUTPUT,
	@result [varchar](500) OUTPUT,
	@FechaAutorizaSeguro [datetime],
	@IdProducto [int],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@FechaAutorizaPendiente [datetime],
	@IdAtencion [int],
	@IdEmpAutorizaPendiente [int],
	@IdEmpAutorizaSeguro [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdServicioSubGrupo int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdServicioSubGrupo = IdServicioSubGrupo,
	@Nombre = Nombre from FactCatalogoServicios where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoServiciosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin
				insert into FacturacionServicios (
				FechaAutorizaSeguro,IdProducto,PrecioUnitario,Cantidad,IdEstadoFacturacion,IdFuenteFinanciamiento,IdTipoFinanciamiento,FechaAutorizaPendiente,IdAtencion,IdPartidaPresupuestal,IdCentroCosto,IdEmpAutorizaPendiente,IdEmpAutorizaSeguro,IdServicioInternamiento,IdComprobantePago,TotalPorPagar, IdPuntoCarga) values (
				@FechaAutorizaSeguro,@IdProducto,@PrecioUnitario,@Cantidad,@IdEstadoFacturacion,@IdFuenteFinanciamiento,@IdTipoFinanciamiento,@FechaAutorizaPendiente,@IdAtencion,@IdPartidaPresupuestal,@IdCentroCosto,@IdEmpAutorizaPendiente,@IdEmpAutorizaSeguro,@IdServicioInternamiento,@IdComprobantePago, @PrecioUnitario*@cantidad, @IdPuntoCarga)
				set @IdFacturacionServicio = @@Identity
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionServicio,'FacturacionServicios'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosAgregarServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosAgregarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosAgregarV2]
	@IdFacturacionServicio [int] OUTPUT,
	@result [varchar](500) OUTPUT,
	@IdProducto [int],
	@Cantidad [decimal](18, 0),
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdOrden [int],
	@IdUsuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdServicioSubGrupo int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)
declare @TotalPorPagar money

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdServicioSubGrupo = IdServicioSubGrupo,
	@Nombre = Nombre from FactCatalogoServicios where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoServiciosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin
                                                    set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    set @cantidadPagar=@cantidad
                                                    set @totalPagar =@cantidad * @PrecioUnitario
                                                    if @IdTipoFinanciamiento=2     --SIS
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSIS
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @IdTipoFinanciamiento=3     --SOAT
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSOAT
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @importeEXO>0     --EXONERACIONES
                                                    begin
                                                        set @TotalPorPagar =@TotalPorPagar-@importeEXO
                                                    end
				insert into FacturacionServicios (
				IdProducto,PrecioUnitario,Cantidad,IdEstadoFacturacion,IdFuenteFinanciamiento,IdTipoFinanciamiento,IdServicioInternamiento,IdComprobantePago, TotalPorPagar,IdUsuarioCrea,IdPuntoCarga,FechaCreacion,IdOrden,IdUsuarioAutorizaSeguro,IdUsuarioAutorizaPendiente,IdUsuarioAutorizaDevolucion,IdCajero,FechaAutorizaSeguro,FechaAutorizaPendiente,FechaAutorizaDevolucion,FechaCajero,IdAtencion,IdPartidaPresupuestal,IdCentroCosto,TotalPagar,cantidadPagar,ImporteSIS,ImporteEXO,IdUsuarioAutorizaEXO,FechaAutorizaEXO,ImporteSOAT,cantidadSIS,precioSIS,cantidadSOAT,precioSOAT,cantidadDev,FechaAutorizaConv,cantidadConv,precConv,ImporteConv) values (
				@IdProducto,@PrecioUnitario,@Cantidad,@IdEstadoFacturacion,@IdFuenteFinanciamiento,@IdTipoFinanciamiento,@IdServicioInternamiento,@IdComprobantePago, @TotalPorPagar ,@IdUsuarioAuditoria,@IdPuntoCarga,getdate(),@IdOrden,@IdUsuarioAutorizaSeguro,@IdUsuarioAutorizaPendiente,@IdUsuarioAutorizaDevolucion,@IdCajero,@FechaAutorizaSeguro,@FechaAutorizaPendiente,@FechaAutorizaDevolucion,@FechaCajero,@IdAtencion,@IdPartidaPresupuestal, @IdCentroCosto,@totalPagar,@CantidadPagar,@ImporteSIS,@ImporteEXO,@IdusuarioAutorizaEXO,@FechaAutorizaEXO,@ImporteSOAT,@cantidadSIS,@precioSIS,@cantidadSOAT,@precioSOAT,@cantidadDev,@FechaAutorizaConv,@cantidadConv,@precConv,@ImporteConv)

				set @IdFacturacionServicio = @@Identity
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFacturacionServicio,'FacturacionServicios'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosAgregarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosEliminar]
	@IdFacturacionServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicios
where IdFacturacionServicio = @IdFacturacionServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFacturacionServicio,'FacturacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosEliminarServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosEliminarServicio]
	@IdAtencion [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FacturacionServicios
where IdAtencion = @IdAtencion and IdProducto = @IdProducto

exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdAtencion,'FacturacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosEliminarServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
set @sql='select FactCatalogoServicios.IdProducto,
            FactCatalogoServicios.Codigo, FactCatalogoServicios.Nombre as NombreProducto,
            FactCatalogoServiciosHosp.PrecioUnitario , FactCatalogoServiciosHosp.Activo,FactCatalogoServiciosHosp.SeUsaSinPrecio
             From
             (FactCatalogoServicios left join FactCatalogoServiciosHosp
             on FactCatalogoServicios.IdProducto = FactCatalogoServiciosHosp.IdProducto)
             left join FactPuntosCargaServicio
             on FactCatalogoServicios.IdServicioSubGrupo = FactPuntosCargaServicio.IdServicioSubGrupo
             where FactCatalogoServiciosHosp.Activo = 1 '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosModificar]
	@FechaCreacion [datetime],
	@IdProducto [int],
	@PrecioUnitario [money],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdPartidaPresupuestal [int],
	@IdCentroCosto [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@TotalPorPagar [money],
	@IdAtencion [int],
	@IdFacturacionServicio [int],
	@IdUsuarioModifica [int],
	@IdPuntoCarga [int],
	@FechaModificacion [datetime],
	@IdOrden [int],
	@IdUsuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdComprobantePagoDevolucion [int],
	@Cantidad [decimal](18, 0),
	@IdUsuarioCrea [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
update FacturacionServicios
set
FechaCreacion = @FechaCreacion,
IdProducto = @IdProducto,
PrecioUnitario = @PrecioUnitario,
IdEstadoFacturacion = @IdEstadoFacturacion,
IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdPartidaPresupuestal = @IdPartidaPresupuestal,
IdCentroCosto = @IdCentroCosto,
IdServicioInternamiento = @IdServicioInternamiento,
IdComprobantePago = @IdComprobantePago,
TotalPorPagar = @TotalPorPagar,
IdAtencion = @IdAtencion,
IdUsuarioModifica = @IdUsuarioModifica,
IdPuntoCarga = @IdPuntoCarga,
FechaModificacion = @FechaModificacion,
IdOrden = @IdOrden,
IdUsuarioAutorizaSeguro = @IdUsuarioAutorizaSeguro,
IdUsuarioAutorizaPendiente = @IdUsuarioAutorizaPendiente,
IdUsuarioAutorizaDevolucion = @IdUsuarioAutorizaDevolucion,
IdCajero = @IdCajero,
FechaAutorizaSeguro = @FechaAutorizaSeguro,
FechaAutorizaPendiente = @FechaAutorizaPendiente,
FechaAutorizaDevolucion = @FechaAutorizaDevolucion,
FechaCajero = @FechaCajero,
IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
Cantidad = @Cantidad,
IdUsuarioCrea = @IdUsuarioCrea,
ImporteSIS=@ImporteSIS,
ImporteEXO=@ImporteEXO,
IdUsuarioAutorizaEXO=@IdUsuarioAutorizaEXO,
FechaAutorizaEXO=@FechaAutorizaEXO,
ImporteSOAT=@ImporteSOAT,
TotalPagar=@TotalPagar,
CantidadPagar = @Cantidad,
cantidadSIS=@cantidadSIS,
precioSIS=@precioSIS,
cantidadSOAT=@cantidadSOAT,
precioSOAT=@precioSOAT,
cantidadDev=@cantidadDev,
FechaAutorizaConv=@FechaAutorizaConv,
cantidadConv=@cantidadConv,
precConv=@precConv,
ImporteConv=@ImporteConv
where IdFacturacionServicio = @IdFacturacionServicio
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionServicio,'FacturacionServicios'
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosModificarServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosModificarServicio]
	@result [varchar](500) OUTPUT,
	@IdFacturacionServicio [int],
	@FechaAutorizaSeguro [datetime],
	@IdProducto [int],
	@Cantidad [int],
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@FechaAutorizaPendiente [datetime],
	@IdAtencion [int],
	@IdEmpAutorizaPendiente [int],
	@IdEmpAutorizaSeguro [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdServicioSubGrupo int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdServicioSubGrupo = IdServicioSubGrupo,
	@Nombre = Nombre from FactCatalogoServicios where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoServiciosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin
				update FacturacionServicios
				set FechaAutorizaSeguro = @FechaAutorizaSeguro,
				IdProducto = @IdProducto,
				PrecioUnitario = @PrecioUnitario,
				Cantidad = @Cantidad,
				IdEstadoFacturacion = @IdEstadoFacturacion,
				IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
				IdTipoFinanciamiento = @IdTipoFinanciamiento,
				FechaAutorizaPendiente = @FechaAutorizaPendiente,
				IdAtencion = @IdAtencion,
				IdPartidaPresupuestal = @IdPartidaPresupuestal,
				IdCentroCosto = @IdCentroCosto,
				IdEmpAutorizaPendiente = @IdEmpAutorizaPendiente,
				IdEmpAutorizaSeguro = @IdEmpAutorizaSeguro,
				IdServicioInternamiento = @IdServicioInternamiento,
				IdComprobantePago = @IdComprobantePago,
				TotalPorPagar = @Cantidad*@PrecioUnitario,
				IdPuntoCarga = @IdPuntoCarga
				where
				IdFacturacionServicio = @IdFacturacionServicio
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionServicio,'FacturacionServicios'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosModificarServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosModificarV2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosModificarV2]
	@IdFacturacionServicio [int],
	@result [varchar](500) OUTPUT,
	@IdProducto [int],
	@Cantidad [decimal](18, 0),
	@IdEstadoFacturacion [int],
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int],
	@IdServicioInternamiento [int],
	@IdComprobantePago [int],
	@IdPuntoCarga [int],
	@IdOrden [int],
	@IdusuarioAutorizaSeguro [int],
	@IdUsuarioAutorizaPendiente [int],
	@IdUsuarioAutorizaDevolucion [int],
	@IdCajero [int],
	@FechaAutorizaSeguro [datetime],
	@FechaAutorizaPendiente [datetime],
	@FechaAutorizaDevolucion [datetime],
	@FechaCajero [datetime],
	@IdAtencion [int],
	@IdComprobantePagoDevolucion [int],
	@IdUsuarioAuditoria [int],
	@ImporteSIS [money],
	@ImporteEXO [money],
	@IdUsuarioAutorizaEXO [int],
	@FechaAutorizaEXO [datetime],
	@ImporteSOAT [money],
	@TotalPagar [money],
	@cantidadSIS [decimal](18, 0),
	@precioSIS [money],
	@cantidadSOAT [decimal](18, 0),
	@precioSOAT [money],
	@cantidadPagar [decimal](18, 0),
	@cantidadDev [decimal](18, 0),
	@FechaAutorizaConv [datetime],
	@cantidadConv [decimal](18, 0),
	@precConv [money],
	@ImporteConv [money]
WITH EXECUTE AS CALLER
AS
--Seleccionar los datos del catalogo
declare @IdPartidaPresupuestal int
declare @IdCentroCosto int
declare @IdServicioSubGrupo int
declare @Activo int
declare @PrecioUnitario money
declare @Nombre varchar(200)
declare @TipoFinanciamientoDesc varchar(100)
declare @NroFilas int
declare @Codigo varchar(10)
declare @TotalPorPagar money

	select @Codigo = Codigo, @IdPartidaPresupuestal = IdPartida, @IdCentroCosto = IdCentroCosto, @IdServicioSubGrupo = IdServicioSubGrupo,
	@Nombre = Nombre from FactCatalogoServicios where IdProducto = @IdProducto
	set @NroFilas = @@rowcount

	if @NroFilas <> 0
	begin
		select 	@PrecioUnitario = PrecioUnitario, @Activo = Activo from FactCatalogoServiciosHosp where
		IdTipoFinanciamiento = @IdTipoFinanciamiento and IdProducto = @IdProducto
		set @NroFilas = @@rowcount

		if @NroFilas <> 0
		begin
			if @Activo = 0
			begin
				set @result = 'El producto <' +  @Codigo + ' - ' + @Nombre +'> se encuentra en el catalogo de servicios del hospital (tarifario) pero no esta activo'
			end
			else
			begin

                                                    set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    set @cantidadPagar=@cantidad
                                                    set @totalPagar =@cantidad * @PrecioUnitario
                                                    if @IdTipoFinanciamiento=2     --SIS
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSIS
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @IdTipoFinanciamiento=3     --SOAT
                                                    begin
                                                        set @cantidad =@cantidad-@cantidadSOAT
                                                        set @TotalPorPagar=@cantidad * @PrecioUnitario
                                                    end
                                                    if @importeEXO>0     --EXONERACIONES
                                                    begin
                                                        set @TotalPorPagar =@TotalPorPagar-@importeEXO
                                                    end

				update FacturacionServicios
				set
				IdProducto = @IdProducto,
				PrecioUnitario = @PrecioUnitario,
				Cantidad = @Cantidad,
				IdEstadoFacturacion = @IdEstadoFacturacion,
				IdFuenteFinanciamiento = @IdFuenteFinanciamiento,
				IdTipoFinanciamiento = @IdTipoFinanciamiento,
				IdServicioInternamiento = @IdServicioInternamiento,
				IdComprobantePago = @IdComprobantePago,
				IdPuntoCarga = @IdPuntoCarga,
				IdOrden = @IdOrden,
				IdUsuarioAutorizaSeguro = @IdusuarioAutorizaSeguro,
				IdUsuarioAutorizaPendiente = @IdusuarioAutorizaPendiente,
				IdUsuarioAutorizaDevolucion = @IdUsuarioAutorizaDevolucion,
				IdCajero = @IdCajero,
				FechaAutorizaSeguro = @FechaAutorizaSeguro,
				FechaAutorizaPendiente = @FechaAutorizaPendiente,
				FechaAutorizadevolucion = @FechaAutorizaDevolucion,
				FechaCajero = @FechaCajero,
				IdAtencion = @IdAtencion,
				IdPartidaPresupuestal = @IdPartidaPresupuestal,
				IdCentroCosto = @IdCentroCosto,
				TotalPorPagar = @TotalPorPagar ,
                                                     TotalPagar = @TotalPagar ,
                                                      CantidadPagar=@CantidadPagar,
				IdComprobantePagoDevolucion = @IdComprobantePagoDevolucion,
				IdUsuarioModifica = @IdusuarioAuditoria,
				FechaModificacion = getdate(),
				ImporteSIS=@ImporteSIS,
				ImporteEXO=@ImporteEXO,
				IdUsuarioAutorizaEXO=@IdUsuarioAutorizaEXO,
				FechaAutorizaEXO=@FechaAutorizaEXO,
				ImporteSOAT=@ImporteSOAT,
				cantidadSIS=@cantidadSIS,
				precioSIS=@precioSIS,
				cantidadSOAT=@cantidadSOAT,
				precioSOAT=@precioSOAT,
				cantidadDev=@cantidadDev,
				FechaAutorizaConv=@FechaAutorizaConv,
				cantidadConv=@cantidadConv,
				precConv=@precConv,
				ImporteConv=@ImporteConv
				where
				IdFacturacionServicio = @IdFacturacionServicio
				set @result = ''

				exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFacturacionServicio,'FacturacionServicios'
			end
		end
		else
		begin
			select @TipoFinanciamientoDesc = Descripcion from TiposFinanciamiento where IdTipoFinanciamiento = @IdTipoFinanciamiento
			set @result =  'El producto <' + @Codigo + ' - '  + @Nombre + '> no esta registrado en el catalogo de servicios (tarifario) para el tipo de financiamiento <' + @TipoFinanciamientoDesc + '>'
		end
	end
	else
	begin
		set @result = 'El producto < ' + convert(varchar(10), @IdProducto) +   ' > no se encuentra en el catalogo de servicios (tarifario) del hospital'
	end
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosModificarV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosPagosSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosPagosSeleccionarPorCuenta]
	@idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FactOrdenServicio.IdPuntoCarga,
                                dbo.FacturacionServicioPagos.Total AS TotalPorPagar, dbo.FacturacionServicioPagos.idProducto
             FROM         dbo.FacturacionServicioPagos LEFT OUTER JOIN
                                dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                dbo.FactOrdenServicio ON dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
             WHERE     dbo.FactOrdenServicio.IdCuentaAtencion=@idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosPagosSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosPagosSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosPagosSeleccionarPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
/*	   SELECT        dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Total, dbo.FactOrdenServicioPagos.idComprobantePago,
                                      dbo.FactOrdenServicioPagos.IdOrden , dbo.FactOrdenServicio.idPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion
                 FROM           dbo.FactOrdenServicio RIGHT OUTER JOIN
                                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
                                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
                 WHERE       dbo.FactOrdenServicioPagos.IdComprobantePago=@IdComprobantePago   */

SELECT     dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Total, dbo.FactOrdenServicioPagos.idComprobantePago,
                      dbo.FactOrdenServicioPagos.idOrden, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion
FROM         dbo.FacturacionServicioPagos INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.FactOrdenServicioPagos.idOrden = dbo.FactOrdenServicio.IdOrden
                 WHERE       dbo.FactOrdenServicioPagos.IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosPagosSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosSeleccionarCPT]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosSeleccionarCPT]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime],
	@Sexo [int]
WITH EXECUTE AS CALLER
AS
if @Sexo=0
begin
	SELECT     dbo.FacturacionServicioDespacho.*, dbo.FactCatalogoServicios.Nombre AS Dcpt, dbo.FactCatalogoServicios.Codigo AS CodigoCpt,
	                      dbo.FactCatalogoServicios.IdServicioGrupo AS idGrupoCpt, dbo.FactCatalogoServiciosGrupo.Descripcion AS grupoCpt,
	                      dbo.Atenciones.Edad AS EdadNum, dbo.Pacientes.IdTipoSexo AS idSexo, dbo.FactOrdenServicio.FechaCreacion AS FechaOrden,
	                      dbo.Atenciones.IdServicioEgreso AS idServicioEgreso, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServicio,
	                      dbo.Servicios.IdEspecialidad AS codEspecialidad, dbo.Especialidades.Nombre AS despecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
	                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
	                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica,dbo.FactOrdenServicio.idPuntoCarga as IdPuntoCarga,
	                      dbo.FactCatalogoServicios.NombreMINSA,FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdServicioIngreso
	FROM         dbo.Especialidades LEFT OUTER JOIN
	                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
	                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FacturacionServicioDespacho LEFT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden RIGHT OUTER JOIN
	                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio ON
	                      dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
	                      dbo.FactCatalogoServiciosGrupo ON dbo.FactCatalogoServicios.IdServicioGrupo = dbo.FactCatalogoServiciosGrupo.IdServicioGrupo ON
	                      dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad
	    WHERE       (dbo.FactOrdenServicio.FechaCreacion Between  @FechaEgrIni and  @FechaEgrFin) and dbo.Atenciones.idEstadoAtencion<>0
	    ORDER BY dbo.FacturacionServicioDespacho.idProducto

End
Else
begin
	SELECT     dbo.FacturacionServicioDespacho.*, dbo.FactCatalogoServicios.Nombre AS Dcpt, dbo.FactCatalogoServicios.Codigo AS CodigoCpt,
	                      dbo.FactCatalogoServicios.IdServicioGrupo AS idGrupoCpt, dbo.FactCatalogoServiciosGrupo.Descripcion AS grupoCpt,
	                      dbo.Atenciones.Edad AS EdadNum, dbo.Pacientes.IdTipoSexo AS idSexo, dbo.FactOrdenServicio.FechaCreacion AS FechaOrden,
	                      dbo.Atenciones.IdServicioEgreso AS idServicioEgreso, dbo.Servicios.Nombre AS dServicio, dbo.Servicios.Codigo AS CodServicio,
	                      dbo.Servicios.IdEspecialidad AS codEspecialidad, dbo.Especialidades.Nombre AS despecialidad, dbo.Especialidades.IdDepartamento AS CodDpto,
	                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Atenciones.IdTipoServicio AS idTipoServicio, dbo.Atenciones.IdTipoEdad AS idTipoEdad,
	                      dbo.Pacientes.NroHistoriaClinica AS nroHistoriaClinica,dbo.FactOrdenServicio.idPuntoCarga as IdPuntoCarga,
	                      dbo.FactCatalogoServicios.NombreMINSA,FactOrdenServicio.IdEstadoFacturacion,dbo.Atenciones.IdServicioIngreso
	FROM         dbo.Especialidades LEFT OUTER JOIN
	                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento RIGHT OUTER JOIN
	                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FacturacionServicioDespacho LEFT OUTER JOIN

	                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden RIGHT OUTER JOIN
	                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio ON
	                      dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto LEFT OUTER JOIN
	                      dbo.FactCatalogoServiciosGrupo ON dbo.FactCatalogoServicios.IdServicioGrupo = dbo.FactCatalogoServiciosGrupo.IdServicioGrupo ON
	                      dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad
	    WHERE       (dbo.FactOrdenServicio.FechaCreacion Between  @FechaEgrIni and  @FechaEgrFin)
	                                  and (dbo.Pacientes.IdTipoSexo=@Sexo) and dbo.Atenciones.idEstadoAtencion<>0
	    ORDER BY dbo.FacturacionServicioDespacho.idProducto
End
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosSeleccionarCPT] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosSeleccionarPorId]
	@IdFacturacionServicio [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionServicios
where IdFacturacionServicio = @IdFacturacionServicio
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FacturacionServiciosSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FacturacionServiciosSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicios.*, dbo.CajaComprobantesPago.NroSerie AS nroSerie, dbo.CajaComprobantesPago.NroDocumento AS nroDocumento,
                      dbo.CajaComprobantesPago.Dctos AS Dctos
FROM         dbo.FacturacionServicios LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.FacturacionServicios.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
where dbo.FacturacionServicios.IdAtencion = @IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FacturacionServiciosSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetAgregar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7),
	@SALDO [int],
	@PRECIO [money],
	@INGRE [int],
	@REINGRE [int],
	@VENTA [int],
	@SIS [int],
	@INTERSAN [int],
	@FAC_PERD [int],
	@DEFNAC [int],
	@EXO [int],
	@SOAT [int],
	@CREDHOSP [int],
	@OTR_CONV [int],
	@DEVOL [int],
	@VENCIDO [int],
	@MERMA [int],
	@DISTRI [int],
	@TRANSF [int],
	@VENTAINST [int],
	@DEV_VEN [int],
	@DEV_MERMA [int],
	@OTRAS_SAL [int],
	@STOCK_FIN [int],
	@STOCK_FIN1 [int],
	@REQ [int],
	@TOTAL [int],
	@FEC_EXP [datetime],
	@DO_SALDO [int],
	@DO_INGRE [int],
	@DO_CON [int],
	@DO_OTR [int],
	@DO_TOT [int],
	@DO_STK [int],
	@DO_FECEXP [datetime],
	@FECHA [datetime],
	@USUARIO [varchar](15),
	@INDIPROC [varchar](1),
	@SIT [varchar](1),
	@INDISIGA [varchar](1),
	@DSTKCERO [int],
	@MPTOREPO [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farm_formdet (
CODIGO_EJE,CODIGO_PRE,TIPSUM,ANNOMES,CODIGO_MED,SALDO,PRECIO,INGRE,REINGRE,VENTA,SIS,INTERSAN,
            FAC_PERD,DEFNAC,EXO,SOAT,CREDHOSP,OTR_CONV,DEVOL,VENCIDO,MERMA,DISTRI,TRANSF,VENTAINST,DEV_VEN,DEV_MERMA,OTRAS_SAL,
            STOCK_FIN,STOCK_FIN1,REQ,TOTAL,FEC_EXP,DO_SALDO,DO_INGRE,DO_CON,DO_OTR,DO_TOT,DO_STK,DO_FECEXP,FECHA,USUARIO,
            INDIPROC,SIT,INDISIGA,DSTKCERO,MPTOREPO)
values
            (
@CODIGO_EJE,@CODIGO_PRE,@TIPSUM,@ANNOMES,@CODIGO_MED,@SALDO,@PRECIO,@INGRE,@REINGRE,@VENTA,@SIS,@INTERSAN,
            @FAC_PERD,@DEFNAC,@EXO,@SOAT,@CREDHOSP,@OTR_CONV,@DEVOL,@VENCIDO,@MERMA,@DISTRI,@TRANSF,@VENTAINST,@DEV_VEN,@DEV_MERMA,@OTRAS_SAL,
            @STOCK_FIN,@STOCK_FIN1,@REQ,@TOTAL,@FEC_EXP,@DO_SALDO,@DO_INGRE,@DO_CON,@DO_OTR,@DO_TOT,@DO_STK,@DO_FECEXP,@FECHA,@USUARIO,
            @INDIPROC,@SIT,@INDISIGA,@DSTKCERO,@MPTOREPO)
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetEliminar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6)
WITH EXECUTE AS CALLER
AS
delete from farm_formdet
where CODIGO_EJE = @CODIGO_EJE and CODIGO_PRE=@CODIGO_PRE and @TIPSUM=TIPSUM and ANNOMES=@ANNOMES
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Farm_formDetEliminarXproducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Farm_formDetEliminarXproducto]
	@Producto [varchar](7),
	@Almacen [varchar](11),
	@FechaMov [varchar](6)
WITH EXECUTE AS CALLER
AS
delete from farm_formdet where ANNOMES=@fechaMov and CODIGO_MED= @Producto and CODIGO_PRE=@Almacen
GO
ALTER AUTHORIZATION ON [dbo].[Farm_formDetEliminarXproducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetlAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetlAgregar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7),
	@LOTE [varchar](15),
	@FECHVTO [datetime],
	@SALDO [int],
	@SIT [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farm_formdetl (
CODIGO_EJE,CODIGO_PRE,TIPSUM,ANNOMES,CODIGO_MED,LOTE,FECHVTO,SALDO,SIT) values (
@CODIGO_EJE,@CODIGO_PRE,@TIPSUM,@ANNOMES,@CODIGO_MED,@LOTE,@FECHVTO,@SALDO,@SIT)
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetlAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetlEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetlEliminar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6)
WITH EXECUTE AS CALLER
AS
delete from farm_formdetl
where CODIGO_EJE = @CODIGO_EJE and CODIGO_PRE=@CODIGO_PRE and @TIPSUM=TIPSUM and ANNOMES=@ANNOMES
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetlEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetlEliminarXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetlEliminarXcodigo]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7)
WITH EXECUTE AS CALLER
AS
delete from farm_formdetl
where CODIGO_EJE = @CODIGO_EJE and CODIGO_PRE=@CODIGO_PRE and @TIPSUM=TIPSUM and ANNOMES=@ANNOMES and CODIGO_MED= @CODIGO_MED
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetlEliminarXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetlModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetlModificar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7),
	@LOTE [varchar](15),
	@FECHVTO [datetime],
	@SALDO [int],
	@SIT [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farm_formdetl  set
CODIGO_EJE=@CODIGO_EJE,
CODIGO_PRE = @CODIGO_PRE,
TIPSUM = @TIPSUM,
ANNOMES = @ANNOMES,
CODIGO_MED = @CODIGO_MED,
LOTE=@LOTE ,
FECHVTO=@FECHVTO,
SALDO=@SALDO,
SIT=@SIT
where  CODIGO_EJE=@CODIGO_EJE and  CODIGO_PRE=@CODIGO_PRE and
TIPSUM = @TIPSUM and ANNOMES=@ANNOMES and CODIGO_MED= @CODIGO_MED
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetlModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetlSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetlSeleccionarPorId]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7)
WITH EXECUTE AS CALLER
AS
if @CODIGO_MED=''
	select * from farm_formdetl
	where CODIGO_EJE = @CODIGO_EJE and CODIGO_PRE=@CODIGO_PRE and @TIPSUM=TIPSUM and ANNOMES=@ANNOMES
else
	select * from farm_formdetl
	where CODIGO_EJE = @CODIGO_EJE and CODIGO_PRE=@CODIGO_PRE and @TIPSUM=TIPSUM and ANNOMES=@ANNOMES
	      and CODIGO_MED=@CODIGO_MED
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetlSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formdetModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formdetModificar]
	@CODIGO_EJE [varchar](3),
	@CODIGO_PRE [varchar](11),
	@TIPSUM [varchar](1),
	@ANNOMES [varchar](6),
	@CODIGO_MED [varchar](7),
	@SALDO [int],
	@PRECIO [money],
	@INGRE [int],
	@REINGRE [int],
	@VENTA [int],
	@SIS [int],
	@INTERSAN [int],
	@FAC_PERD [int],
	@DEFNAC [int],
	@EXO [int],
	@SOAT [int],
	@CREDHOSP [int],
	@OTR_CONV [int],
	@DEVOL [int],
	@VENCIDO [int],
	@MERMA [int],
	@DISTRI [int],
	@TRANSF [int],
	@VENTAINST [int],
	@DEV_VEN [int],
	@DEV_MERMA [int],
	@OTRAS_SAL [int],
	@STOCK_FIN [int],
	@STOCK_FIN1 [int],
	@REQ [int],
	@TOTAL [int],
	@FEC_EXP [datetime],
	@DO_SALDO [int],
	@DO_INGRE [int],
	@DO_CON [int],
	@DO_OTR [int],
	@DO_TOT [int],
	@DO_STK [int],
	@DO_FECEXP [datetime],
	@FECHA [datetime],
	@USUARIO [varchar](15),
	@INDIPROC [varchar](1),
	@SIT [varchar](1),
	@INDISIGA [varchar](1),
	@DSTKCERO [int],
	@MPTOREPO [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farm_formdet
set
CODIGO_PRE = @CODIGO_PRE,
TIPSUM = @TIPSUM,
ANNOMES = @ANNOMES,
CODIGO_MED = @CODIGO_MED,
SALDO = @SALDO,
PRECIO = @PRECIO,
INGRE = @INGRE,
REINGRE = @REINGRE,
VENTA = @VENTA,
SIS = @SIS,
INTERSAN = @INTERSAN,
FAC_PERD = @FAC_PERD,
DEFNAC = @DEFNAC,
EXO = @EXO,
SOAT = @SOAT,
CREDHOSP = @CREDHOSP,
OTR_CONV = @OTR_CONV,
DEVOL = @DEVOL,
VENCIDO = @VENCIDO,
MERMA = @MERMA,
DISTRI = @DISTRI,
TRANSF = @TRANSF,
VENTAINST = @VENTAINST,
DEV_VEN = @DEV_VEN,
DEV_MERMA = @DEV_MERMA,
OTRAS_SAL = @OTRAS_SAL,
STOCK_FIN = @STOCK_FIN,
STOCK_FIN1 = @STOCK_FIN1,
REQ = @REQ,
TOTAL = @TOTAL,
FEC_EXP = @FEC_EXP,
DO_SALDO = @DO_SALDO,
DO_INGRE = @DO_INGRE,
DO_CON = @DO_CON,
DO_OTR = @DO_OTR,
DO_TOT = @DO_TOT,
DO_STK = @DO_STK,
DO_FECEXP = @DO_FECEXP,
FECHA = @FECHA,
USUARIO = @USUARIO,
INDIPROC = @INDIPROC,
SIT = @SIT,
INDISIGA = @INDISIGA,
DSTKCERO = @DSTKCERO,
MPTOREPO = @MPTOREPO

where ANNOMES=@ANNOMES and CODIGO_MED= @CODIGO_MED and CODIGO_PRE=@CODIGO_PRE
GO
ALTER AUTHORIZATION ON [dbo].[farm_formdetModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Farm_formDetSeleccionarUltimoSaldoPorIdproductoXmes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Farm_formDetSeleccionarUltimoSaldoPorIdproductoXmes]
	@Producto [varchar](7),
	@Almacen [varchar](11),
	@FechaMov [varchar](6)
WITH EXECUTE AS CALLER
AS
if @Producto =''
   select  *  from farm_formdet where ANNOMES=@fechaMov and CODIGO_PRE=@Almacen
else
   select  *  from farm_formdet where ANNOMES=@fechaMov and CODIGO_MED= @Producto and CODIGO_PRE=@Almacen
GO
ALTER AUTHORIZATION ON [dbo].[Farm_formDetSeleccionarUltimoSaldoPorIdproductoXmes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formDetSeleccionaSoloGrabados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formDetSeleccionaSoloGrabados]
	@aniomes1 [varchar](6),
	@aniomes2 [varchar](6),
	@almacen [varchar](11)
WITH EXECUTE AS CALLER
AS
select distinct ANNOMES  from farm_formdet
where ANNOMES>=@aniomes1  and ANNOMES <=@aniomes2  and CODIGO_PRE = @almacen
order by ANNOMES
GO
ALTER AUTHORIZATION ON [dbo].[farm_formDetSeleccionaSoloGrabados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_formDetXrangoMeses]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_formDetXrangoMeses]
	@aniomes1 [varchar](6),
	@aniomes2 [varchar](6),
	@almacen [varchar](11)
WITH EXECUTE AS CALLER
AS
/*
begin
   set nocount on
   create table #myTempTable(codigo varchar(7),nombre varchar(350),precio money,saldoI int,
          ingresos int, devolucionesP int,
          totIngresos int,
          ventas int, sis int,
          soat int,convenio int,
          creditoh int, defensaN int,
          osDevol int, osVencim int,
          osMerma int, exonerac int,
          intervencionS int, otrasS int,
          totSalidas int, fechaVencimiento datetime,
          tipo varchar(15))

   create table #myTempTable1(codigo varchar(7),
          tipo varchar(15),saldoF int,precio money)

   insert into #myTempTable1 (codigo,tipo,
           saldoF,precio )
   SELECT  dbo.FactCatalogoBienesInsumos.Codigo, case dbo.FactCatalogoBienesInsumos.TipoProducto when 1 then 'I' else 'M' end,
           dbo.farm_formdet.STOCK_FIN, dbo.farm_formdet.PRECIO
   FROM    dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
           dbo.farm_formdet ON dbo.FactCatalogoBienesInsumos.Codigo = dbo.farm_formdet.CODIGO_MED COLLATE SQL_Latin1_General_CP1_CI_AS
   where   dbo.farm_formdet.ANNOMES=@aniomes2 and dbo.farm_formdet.CODIGO_PRE =@almacen

   insert into #myTempTable (codigo,nombre,precio,saldoI,
          ingresos, devolucionesP,
          totIngresos ,
          ventas , sis ,
          soat ,convenio,
          creditoh , defensaN ,
          osDevol, osVencim ,
          osMerma , exonerac,
          intervencionS , otrasS ,
          totSalidas,fechaVencimiento )
   SELECT  dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,0,isnull(sum(dbo.farm_formdet.SALDO ),0) as tsaldo,
           isnull(sum(dbo.farm_formdet.INGRE),0) as tIngresos,isnull(SUM(dbo.farm_formdet.REINGRE),0) as tdevolucionesP,
           isnull(sum(dbo.farm_formdet.INGRE+dbo.farm_formdet.REINGRE),0) as totIngresos,
           isnull(SUM(dbo.farm_formdet.VENTA),0) as tventas,isnull(SUM(dbo.farm_formdet.sis),0) as tsis,
           isnull(SUM(dbo.farm_formdet.soat),0) as tsoat,isnull(SUM(dbo.farm_formdet.OTR_CONV),0) as tconvenio,
           isnull(SUM(dbo.farm_formdet.CREDHOSP),0) as tcreditoH,isnull(SUM(dbo.farm_formdet.DEFNAC),0) as tdefensaN,
           isnull(SUM(dbo.farm_formdet.DEVOL ),0) as tosDevol,isnull(SUM(dbo.farm_formdet.DEV_VEN ),0) as tOsVencim ,
           isnull(SUM(dbo.farm_formdet.DEV_MERMA),0) as tOsMerma,isnull(SUM(dbo.farm_formdet.exo),0) as tExonerac,
           isnull(SUM(dbo.farm_formdet.INTERSAN),0) as tIntervencionS,isnull(SUM(dbo.farm_formdet.OTRAS_SAL ),0) as tOtrasS,
           isnull(sum(dbo.farm_formdet.TOTAL),0) as tTotSalidas,max(dbo.farm_formdet.FEC_EXP ) as FVencim
   FROM    dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
           dbo.farm_formdet ON dbo.FactCatalogoBienesInsumos.Codigo = dbo.farm_formdet.CODIGO_MED COLLATE SQL_Latin1_General_CP1_CI_AS
   where   dbo.farm_formdet.ANNOMES>=@aniomes1 and dbo.farm_formdet.ANNOMES<=@aniomes2 and
           dbo.farm_formdet.CODIGO_PRE =@almacen
   group by dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre

   update #myTempTable set totIngresos= ISNULL(ingresos,0)+ISNULL(devolucionesP,0)

--   update #myTempTable set saldoI= -totIngresos+  totSalidas+(select saldoF  from #myTempTable1
--                                                             where #myTempTable.codigo=#myTempTable1.codigo  )

   update #myTempTable set precio= (select top 1 precio   from #myTempTable1
                                   where #myTempTable.codigo=#myTempTable1.codigo  )

   update #myTempTable set tipo= (select top 1 tipo    from #myTempTable1
                                   where #myTempTable.codigo=#myTempTable1.codigo  )

   select * from #myTempTable order by nombre

   drop table #myTempTable
   drop table #myTempTable1
end
*/
SELECT  dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
        dbo.farm_formdet.PRECIO ,dbo.farm_formdet.SALDO as saldoI,
		isnull(dbo.farm_formdet.INGRE,0) as ingresos, isnull(dbo.farm_formdet.REINGRE,0) as devolucionesP,
		isnull(dbo.farm_formdet.INGRE,0) + isnull(dbo.farm_formdet.REINGRE,0) as totIngresos,
		isnull(dbo.farm_formdet.VENTA,0) as ventas,isnull(dbo.farm_formdet.sis,0) as sis,
		isnull(dbo.farm_formdet.soat,0) as soat,isnull(dbo.farm_formdet.OTR_CONV,0) as convenio,
		isnull(dbo.farm_formdet.CREDHOSP,0) as creditoH,isnull(dbo.farm_formdet.DEFNAC,0) as defensaN,
		isnull(dbo.farm_formdet.DEVOL ,0) as osDevol,isnull(dbo.farm_formdet.DEV_VEN ,0) as OsVencim ,
		isnull(dbo.farm_formdet.DEV_MERMA,0) as OsMerma,isnull(dbo.farm_formdet.exo,0) as Exonerac,
	    isnull(dbo.farm_formdet.INTERSAN,0) as IntervencionS,isnull(dbo.farm_formdet.OTRAS_SAL ,0) as OtrasS,
		isnull(dbo.farm_formdet.TOTAL,0) as TotSalidas,dbo.farm_formdet.FEC_EXP  as FechaVencimiento,
		case dbo.FactCatalogoBienesInsumos.TipoProducto when 1 then 'I' else 'M' end as tipo
   FROM    dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
           dbo.farm_formdet ON dbo.FactCatalogoBienesInsumos.Codigo = dbo.farm_formdet.CODIGO_MED COLLATE SQL_Latin1_General_CP1_CI_AS
   where   dbo.farm_formdet.ANNOMES=@aniomes2 and dbo.farm_formdet.CODIGO_PRE =@almacen
GO
ALTER AUTHORIZATION ON [dbo].[farm_formDetXrangoMeses] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_psicotropicosSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_psicotropicosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT *   FROM farm_psicotropicos order by posicion
GO
ALTER AUTHORIZATION ON [dbo].[farm_psicotropicosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farm_psicotropTipoSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farm_psicotropTipoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT *   FROM farm_psicotropTipo
GO
ALTER AUTHORIZATION ON [dbo].[farm_psicotropTipoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaActualizaFechaDeVencimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaActualizaFechaDeVencimiento]
	@fechaVencimientoNueva [datetime],
	@FechaVencimientoActual [datetime],
	@Lote [varchar](15),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION

update FarmInventarioDetalle set FechaVencimiento=@fechaVencimientoNueva
where idProducto=@IdProducto and Lote=@Lote
and fechaVencimiento=@FechaVencimientoActual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FarmMovimientoDetalle set FechaVencimiento=@fechaVencimientoNueva
where idProducto=@IdProducto and Lote=@Lote
and fechaVencimiento=@FechaVencimientoActual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FarmSaldoDetallado set FechaVencimiento=@fechaVencimientoNueva
where idProducto=@IdProducto and Lote=@Lote
and fechaVencimiento=@FechaVencimientoActual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

update FarmSaldoMensualDetallado set FechaVencimiento=@fechaVencimientoNueva
where idProducto=@IdProducto and Lote=@Lote
and fechaVencimiento=@FechaVencimientoActual
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaActualizaFechaDeVencimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaActualizaTipoSalida]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaActualizaTipoSalida]
	@idProducto [int],
	@nuevoTipoSalida [int]
WITH EXECUTE AS CALLER
AS
update farmInventarioDetalle set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update farmMovimientodetalle set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update farmSaldo set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update farmSaldoDetallado set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update farmSaldoMensual set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update farmSaldoMensualDetallado set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
update factCatalogoBienesInsumos set idTipoSalidaBienInsumo=@nuevoTipoSalida where idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaActualizaTipoSalida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaBoletasPorIdPacienteIdCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaBoletasPorIdPacienteIdCuenta]
	@idPaciente [int],
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionBienesPagos.IdProducto,
                      dbo.FacturacionBienesPagos.CantidadPagar AS Cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                      dbo.FacturacionBienesPagos.TotalPagar, dbo.FactOrdenesBienes.idComprobantePago
FROM         dbo.FactOrdenesBienes LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenesBienes.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago RIGHT OUTER JOIN
                      dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden
Where (dbo.FactOrdenesBienes.IdComprobantePago Is Not Null) and dbo.CajaComprobantesPago.IdPaciente=@idPaciente and
                       dbo.CajaComprobantesPago.IdEstadoComprobante=4 and  dbo.CajaComprobantesPago.idCuentaAtencion=@idCuentaAtencion
ORDER BY dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaBoletasPorIdPacienteIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaChequeaSiBoletaEsDeLaFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaChequeaSiBoletaEsDeLaFarmacia]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.farmMovimiento.idAlmacenOrigen, dbo.FactOrdenesBienes.idComprobantePago
             FROM           dbo.FactOrdenesBienes LEFT OUTER JOIN
                                  dbo.farmMovimiento ON dbo.FactOrdenesBienes.MovNumero = dbo.farmMovimiento.MovNumero AND
                                  dbo.FactOrdenesBienes.MovTipo = dbo.farmMovimiento.MovTipo
             WHERE       dbo.FactOrdenesBienes.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaChequeaSiBoletaEsDeLaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaConsolidado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaConsolidado]
	@idCaja [int],
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTurno [int],
	@idCajero [int]
WITH EXECUTE AS CALLER
AS
If @idCaja = 0 And @idTurno = 0 And @idCajero = 0

	SELECT        dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS Producto, dbo.CajaComprobantesPago.NroSerie AS nroSerie,
                                   dbo.CajaComprobantesPago.NroDocumento AS nroDocumento, dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.FactCatalogoBienesInsumos.idPartida,
                                   dbo.CajaComprobantesPago.RazonSocial AS RazonSocial, dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza,
                                   dbo.CajaComprobantesPago.IdEstadoComprobante AS IdEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
                                   dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                   dbo.CajaGestion.FechaCierre, dbo.CajaGestion.IdCajero, dbo.FacturacionCuentasAtencion.IdPaciente,
                                   dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                   dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                                   dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionBienesPagos.*,
                                   dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                                   dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,dbo.CajaComprobantesPago.Total as totalPagado,
                                   dbo.FactCatalogoBienesInsumos.IdCentroCosto , dbo.CajaComprobantesPago.adelantos, dbo.CajaComprobantesPago.idTipoComprobante,
                                  dbo.CajaComprobantesPago.IdTipoFinanciamiento,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
             FROM            dbo.CajaComprobantesPago INNER JOIN
                                   dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
                                   dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago RIGHT OUTER JOIN
                                   dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                   dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                   dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                                   dbo.FacturacionCuentasAtencion ON
                                   dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
	Where          (dbo.CajaComprobantesPago.IdTipoOrden in (2,3) )
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
             ORDER BY   dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento

Else If @idCaja > 0 And @idTurno > 0 And @idCajero = 0

	SELECT        dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS Producto, dbo.CajaComprobantesPago.NroSerie AS nroSerie,
                                   dbo.CajaComprobantesPago.NroDocumento AS nroDocumento, dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.FactCatalogoBienesInsumos.idPartida,
                                   dbo.CajaComprobantesPago.RazonSocial AS RazonSocial, dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza,
                                   dbo.CajaComprobantesPago.IdEstadoComprobante AS IdEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
                                   dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                   dbo.CajaGestion.FechaCierre, dbo.CajaGestion.IdCajero, dbo.FacturacionCuentasAtencion.IdPaciente,
                                   dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                   dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                                   dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionBienesPagos.*,
                                   dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                                   dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,dbo.CajaComprobantesPago.Total as totalPagado,
                                   dbo.FactCatalogoBienesInsumos.IdCentroCosto , dbo.CajaComprobantesPago.adelantos, dbo.CajaComprobantesPago.idTipoComprobante,
                                   dbo.CajaComprobantesPago.IdTipoFinanciamiento,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
             FROM            dbo.CajaComprobantesPago INNER JOIN
                                   dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
                                   dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago RIGHT OUTER JOIN
                                   dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                   dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                   dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                                   dbo.FacturacionCuentasAtencion ON
                                   dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
            Where            (dbo.CajaComprobantesPago.IdTipoOrden in (2,3) )
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio  and  @FechaFin
                                   and dbo.CajaComprobantesPago.idCaja=@idCaja
                                   and dbo.CajaComprobantesPago.idTurno=@idTurno
           ORDER BY     dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento

 Else

	SELECT        dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS Producto, dbo.CajaComprobantesPago.NroSerie AS nroSerie,
                                   dbo.CajaComprobantesPago.NroDocumento AS nroDocumento, dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.FactCatalogoBienesInsumos.idPartida,
                                   dbo.CajaComprobantesPago.RazonSocial AS RazonSocial, dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza,
                                   dbo.CajaComprobantesPago.IdEstadoComprobante AS IdEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
                                   dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                   dbo.CajaGestion.FechaCierre, dbo.CajaGestion.IdCajero, dbo.FacturacionCuentasAtencion.IdPaciente,
                                   dbo.Pacientes.ApellidoPaterno AS ApellidoPaterno, dbo.Pacientes.ApellidoMaterno AS ApellidoMaterno,
                                   dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
                                   dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionBienesPagos.*,
                                   dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,
                                   dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,dbo.CajaComprobantesPago.Total as totalPagado,
                                   dbo.FactCatalogoBienesInsumos.IdCentroCosto , dbo.CajaComprobantesPago.adelantos, dbo.CajaComprobantesPago.idTipoComprobante,
                                   dbo.CajaComprobantesPago.IdTipoFinanciamiento,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
             FROM            dbo.CajaComprobantesPago INNER JOIN
                                   dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
                                   dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago RIGHT OUTER JOIN
                                   dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                   dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                   dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden LEFT OUTER JOIN
                                   dbo.FacturacionCuentasAtencion ON
                                   dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
             Where           (dbo.CajaComprobantesPago.IdTipoOrden in (2,3) )
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
                                   and dbo.CajaComprobantesPago.idCaja=@idCaja
                                   and dbo.CajaComprobantesPago.idTurno=@idTurno
                                   and dbo.CajaComprobantesPago.idCajero=@idCajero
             ORDER BY   dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaConsolidado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Atenciones.IdCuentaAtencion AS IdCuentaAtencion,
                                  dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio, dbo.Atenciones.IdTipoServicio AS idTipoServicio,
                                  dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso, dbo.CajaComprobantesPago.Dctos, dbo.CajaComprobantesPago.NroSerie AS NroSerie,
                                  dbo.CajaComprobantesPago.NroDocumento AS NroDocumento, dbo.Atenciones.FechaEgresoAdministrativo, dbo.Atenciones.IdAtencion,
                                  dbo.FacturacionBienesPagos.*, dbo.FactOrdenesBienes.MovNumero, dbo.FactOrdenesBienes.MovTipo,dbo.FactOrdenesBienes.idEstadoFacturacion
              FROM          dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                  dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                  dbo.Servicios RIGHT OUTER JOIN
                                  dbo.FactOrdenesBienes LEFT OUTER JOIN
                                  dbo.Atenciones ON dbo.FactOrdenesBienes.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                                  dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden ON
                                  dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.IdComprobantePago
             WHERE       (dbo.Atenciones.IdTipoServicio = 3) AND
                                  dbo.Atenciones.FechaEgresoAdministrativo Between @FechaInicio and @FechaFin
             ORDER BY  dbo.CajaComprobantesPago.IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFiltraTodosMovimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaFiltraTodosMovimientos]
	@Where [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(5000)

SET  @SQL = 'SELECT    dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
             dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Item,
              dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmMovimiento.idAlmacenOrigen,
              dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.fechaCreacion,
              dbo.farmMovimiento.idEstadoMovimiento, dbo.farmAlmacen.descripcion AS almDestino, dbo.FactCatalogoBienesInsumos.Codigo,
              farmAlmacen_1.descripcion AS almOrigen, dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo,dbo.FactCatalogoBienesInsumos.esPaquete
          FROM         dbo.farmAlmacen RIGHT OUTER JOIN dbo.farmMovimiento LEFT OUTER JOIN
             dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen ON
              dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino RIGHT OUTER JOIN
              dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
              dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
              dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
              dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
          Where (dbo.farmMovimiento.idEstadoMovimiento = 1) ' + @Where +
          ' ORDER BY dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimiento.fechaCreacion'
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFiltraTodosMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFinanciamientosPorFuenteFinanciamientoFechaLiquidacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaFinanciamientosPorFuenteFinanciamientoFechaLiquidacion]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionBienesFinanciamientos.*
FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.FacturacionCuentasAtencion ON dbo.Atenciones.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Pacientes.IdPaciente = dbo.farmMovimientoVentas.idPaciente ON
                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FacturacionBienesFinanciamientos.IdProducto
Where           ( dbo.FacturacionBienesFinanciamientos.idFuenteFinanciamiento = @idFuenteFinanciamiento) and
	           dbo.FacturacionBienesFinanciamientos.FechaAutoriza Between @FechaInicio and @FechaFin
	      and dbo.Atenciones.idEstadoAtencion<>0
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFinanciamientosPorFuenteFinanciamientoFechaLiquidacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFinanciamientosPorNroCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaFinanciamientosPorNroCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Pacientes.IdPaciente = dbo.farmMovimientoVentas.idPaciente LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesFinanciamientos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
Where           dbo.Atenciones.idCuentaAtencion=@idCuentaAtencion and dbo.Atenciones.idEstadoAtencion<>0
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFinanciamientosPorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaEgresoMedico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaEgresoMedico]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento,
	        dbo.Atenciones.fechaEgreso,dbo.Atenciones.idTipoServicio
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Pacientes.IdPaciente = dbo.farmMovimientoVentas.idPaciente LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesFinanciamientos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
Where           ( dbo.Atenciones.idFormaPago = @idTipoFinanciamiento) and
	          dbo.Atenciones.fechaEgreso Between @FechaInicio and @FechaFin
	      and dbo.Atenciones.idEstadoAtencion<>0  and dbo.Atenciones.idTipoServicio>1
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaEgresoMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaIngreso]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaIngreso]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento,
	        dbo.Atenciones.fechaEgreso,dbo.Atenciones.idTipoServicio
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Pacientes.IdPaciente = dbo.farmMovimientoVentas.idPaciente LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesFinanciamientos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
Where           ( dbo.Atenciones.idFormaPago = @idTipoFinanciamiento) and
	          dbo.Atenciones.fechaIngreso Between @FechaInicio and @FechaFin
	      and dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaLiquidacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaLiquidacion]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Atenciones.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos LEFT OUTER JOIN
                      dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Pacientes.IdPaciente = dbo.farmMovimientoVentas.idPaciente LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesFinanciamientos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
Where           ( dbo.FacturacionBienesFinanciamientos.IdTipoFinanciamiento = @idTipoFinanciamiento) and
	           dbo.FacturacionBienesFinanciamientos.FechaAutoriza Between @FechaInicio and @FechaFin
	      and dbo.Atenciones.idEstadoAtencion<>0
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaFinanciamientosPorTipoFinanciamientoFechaLiquidacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaItemsPorDebajoStockMinimo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaItemsPorDebajoStockMinimo]
WITH EXECUTE AS CALLER
AS
SELECT         dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldo.idAlmacen, dbo.farmAlmacen.descripcion AS Farmacia,
                         dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldo.cantidad AS Stock, dbo.FactCatalogoBienesInsumos.StockMinimo
FROM            dbo.FactCatalogoBienesInsumos INNER JOIN
                         dbo.farmSaldo ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto INNER JOIN
                         dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen INNER JOIN
                         dbo.farmTipoSalidaBienInsumo ON dbo.farmSaldo.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
WHERE        (dbo.FactCatalogoBienesInsumos.StockMinimo > 0) and dbo.farmSaldo.cantidad<=dbo.FactCatalogoBienesInsumos.StockMinimo
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre, Farmacia
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaItemsPorDebajoStockMinimo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaMuestraSaldosPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaMuestraSaldosPorCodigo]
	@lcCodigo [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldoDetallado.*,
                                  dbo.farmAlmacen.descripcion AS Almacen
             FROM           dbo.farmSaldoDetallado LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmSaldoDetallado.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             where dbo.FactCatalogoBienesInsumos.Codigo=@lcCodigo
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaMuestraSaldosPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaParteDiario]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaParteDiario]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idCaja [int],
	@idTurno [int],
	@idCajero [int]
WITH EXECUTE AS CALLER
AS
if @idCaja>0 and @idTurno>0 and @idCajero>0
	SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS Producto, dbo.CajaComprobantesPago.NroSerie AS NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento AS NroDocumento, dbo.CajaComprobantesPago.Total AS TotalBoleta,
	                      dbo.CajaComprobantesPago.RazonSocial AS RazonSocial, dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza,
	                      dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
	                      dbo.CajaGestion.FechaCierre, dbo.CajaGestion.IdCajero, dbo.FacturacionCuentasAtencion.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.ApellidoMaterno AS apellidoMaterno,
	                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
	                      dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.FactPartidasPresupuestales.Codigo AS Partida,
	                      dbo.FactPartidasPresupuestales.Descripcion AS dPartida, dbo.FactPartidasPresupuestales.IdPartidaPresupuestal AS idPartidaPresupuestal,
	                      dbo.FacturacionBienesPagos.*, dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.MovNumero,
	                      dbo.FactOrdenesBienes.MovTipo
	FROM         dbo.FactPartidasPresupuestales RIGHT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
	                      dbo.FacturacionBienesPagos ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FacturacionBienesPagos.IdProducto LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago INNER JOIN
	                      dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
	                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago ON
	                      dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion ON
	                      dbo.Pacientes.IdPaciente = dbo.FacturacionCuentasAtencion.IdPaciente ON
	                      dbo.FactPartidasPresupuestales.IdPartidaPresupuestal = dbo.FactCatalogoBienesInsumos.IdPartida
	 Where  (dbo.CajaComprobantesPago.IdTipoOrden = 2 or dbo.CajaComprobantesPago.IdTipoOrden = 3)
	                    and CajaComprobantesPago.FechaCobranza Between @FechaInicio  and  @FechaFin
			 and CajaGestion.idCaja=@idCaja
			and CajaGestion.idTurno=@idTurno
			 and CajaGestion.idCajero=@idCajero
	 ORDER BY dbo.FactPartidasPresupuestales.idPartidaPresupuestal
else
	SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS Producto, dbo.CajaComprobantesPago.NroSerie AS NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento AS NroDocumento, dbo.CajaComprobantesPago.Total AS TotalBoleta,
	                      dbo.CajaComprobantesPago.RazonSocial AS RazonSocial, dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza,
	                      dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante, dbo.CajaComprobantesPago.IdTipoOrden,
	                      dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
	                      dbo.CajaGestion.FechaCierre, dbo.CajaGestion.IdCajero, dbo.FacturacionCuentasAtencion.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.ApellidoMaterno AS apellidoMaterno,
	                      dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.Pacientes.NroHistoriaClinica AS NroHistoriaClinica,
	                      dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.FactPartidasPresupuestales.Codigo AS Partida,
	                      dbo.FactPartidasPresupuestales.Descripcion AS dPartida, dbo.FactPartidasPresupuestales.IdPartidaPresupuestal AS idPartidaPresupuestal,
	                      dbo.FacturacionBienesPagos.*, dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.MovNumero,
	                      dbo.FactOrdenesBienes.MovTipo
	FROM         dbo.FactPartidasPresupuestales RIGHT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
	                      dbo.FacturacionBienesPagos ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FacturacionBienesPagos.IdProducto LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago INNER JOIN
	                      dbo.CajaGestion ON dbo.CajaComprobantesPago.IdGestionCaja = dbo.CajaGestion.IdGestionCaja RIGHT OUTER JOIN
	                      dbo.FactOrdenesBienes ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago ON
	                      dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
	                      dbo.FacturacionCuentasAtencion ON dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion ON
	                      dbo.Pacientes.IdPaciente = dbo.FacturacionCuentasAtencion.IdPaciente ON
	                      dbo.FactPartidasPresupuestales.IdPartidaPresupuestal = dbo.FactCatalogoBienesInsumos.IdPartida
	 Where  (dbo.CajaComprobantesPago.IdTipoOrden = 2 or dbo.CajaComprobantesPago.IdTipoOrden = 3)
	                    and CajaComprobantesPago.FechaCobranza Between @FechaInicio  and  @FechaFin
	 ORDER BY dbo.FactPartidasPresupuestales.idPartidaPresupuestal
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaParteDiario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasAgregar]
	@IdMedicoOrdena [int],
	@IdServicioOrdena [int],
	@FechaReceta [char](10),
	@NroReceta [char](10),
	@IdCuentaAtencion [int],
	@IdReceta [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FarmaciaRecetas (
IdMedicoOrdena,IdServicioOrdena,FechaReceta,NroReceta,IdCuentaAtencion) values (
@IdMedicoOrdena,@IdServicioOrdena,@FechaReceta,@NroReceta,@IdCuentaAtencion)
set @IdReceta = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdReceta,'FarmaciaRecetas'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasDetalleAgregar]
	@Cantidad [int],
	@IdFacturacionBienes [int],
	@IdRecetaDetalle [int] OUTPUT,
	@IdProducto [int],
	@IdReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FarmaciaRecetasDetalle (
Cantidad,IdFacturacionBienes,IdProducto,IdReceta) values (
@Cantidad,@IdFacturacionBienes,@IdProducto,@IdReceta)
set @IdRecetaDetalle = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdRecetaDetalle,'FarmaciaRecetasDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasDetalleEliminar]
	@IdRecetaDetalle [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FarmaciaRecetasDetalle
where IdRecetaDetalle = @IdRecetaDetalle
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdRecetaDetalle,'FarmaciaRecetasDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasDetalleModificar]
	@Cantidad [int],
	@IdFacturacionBienes [int],
	@IdRecetaDetalle [int],
	@IdProducto [int],
	@IdReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FarmaciaRecetasDetalle
set
Cantidad = @Cantidad,
IdFacturacionBienes = @IdFacturacionBienes,
IdProducto = @IdProducto,
IdReceta = @IdReceta
where IdRecetaDetalle = @IdRecetaDetalle
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdRecetaDetalle,'FarmaciaRecetasDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasDetalleSeleccionarPorId]
	@IdRecetaDetalle [int]
WITH EXECUTE AS CALLER
AS
select * from FarmaciaRecetasDetalle
where IdRecetaDetalle = @IdRecetaDetalle
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasEliminar]
	@IdReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FarmaciaRecetas
where IdReceta = @IdReceta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdReceta,'FarmaciaRecetas'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasModificar]
	@IdMedicoOrdena [int],
	@IdServicioOrdena [int],
	@FechaReceta [char](10),
	@NroReceta [char](10),
	@IdCuentaAtencion [int],
	@IdReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FarmaciaRecetas
set
IdMedicoOrdena = @IdMedicoOrdena,
IdServicioOrdena = @IdServicioOrdena,
FechaReceta = @FechaReceta,
NroReceta = @NroReceta,
IdCuentaAtencion = @IdCuentaAtencion
where IdReceta = @IdReceta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdReceta,'FarmaciaRecetas'
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaRecetasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaRecetasSeleccionarPorId]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
select * from FarmaciaRecetas
where IdReceta = @IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaRecetasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaUltimoTicket]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmaciaUltimoTicket]
WITH EXECUTE AS CALLER
AS
select *  from FarmMovimiento where MovTipo ='S' and DocumentoIdtipo='16' order by DocumentoNumero desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaUltimoTicket] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmaciaVendedorChequeaSiEsSuBoleta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmaciaVendedorChequeaSiEsSuBoleta]
	@IdComprobantePago [int],
	@IdVendedorFarmacia [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactOrdenesBienes.idComprobantePago, dbo.FactOrdenesBienes.idPreventa, dbo.farmPreVenta.idVendedor
                FROM          dbo.FactOrdenesBienes LEFT OUTER JOIN
                                    dbo.farmPreVenta ON dbo.FactOrdenesBienes.idPreventa = dbo.farmPreVenta.idPreventa
                WHERE      dbo.FactOrdenesBienes.idComprobantePago=@IdComprobantePago and dbo.farmPreVenta.idVendedor=@IdVendedorFarmacia
GO
ALTER AUTHORIZATION ON [dbo].[FarmaciaVendedorChequeaSiEsSuBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmActualizaPrecioPonderadoMenorAcero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmActualizaPrecioPonderadoMenorAcero]
WITH EXECUTE AS CALLER
AS
begin
declare @idalmacen int
declare @idproducto int
declare @idtiposalidabieninsumo int
declare @precio money

	DECLARE VarCursorDesarrollo CURSOR FOR
	         select idAlmacen,idProducto ,IdTipoSalidaBienInsumo    from farmsaldo where Precio <0
	OPEN VarCursorDesarrollo
	fetch VarCursorDesarrollo INTO @idAlmacen,@idProducto ,@IdTipoSalidaBienInsumo
	while(@@fetch_status=0)
	begin
		select @precio=(SELECT  top 1       dbo.farmMovimientoDetalle.precio
		  FROM            dbo.farmMovimiento INNER JOIN
								 dbo.farmMovimientoDetalle ON
								 dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
								 dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
		WHERE                                (dbo.farmMovimiento.idEstadoMovimiento = 1) AND(dbo.farmMovimiento.idAlmacenDestino = @idAlmacen) AND
								 (dbo.farmMovimientoDetalle.idProducto = @idProducto)                           AND (dbo.farmMovimiento.MovTipo = 'E')
		   ORDER BY dbo.farmMovimiento.fechaCreacion desc)

		update farmSaldo set Precio =@precio where idalmacen=@idAlmacen and idProducto =@idProducto and IdTipoSalidaBienInsumo= @IdTipoSalidaBienInsumo

		update farmSaldoDetallado  set Precio =@precio where idalmacen=@idAlmacen and idProducto =@idProducto and IdTipoSalidaBienInsumo=@IdTipoSalidaBienInsumo

		fetch VarCursorDesarrollo INTO @idAlmacen,@idProducto ,@IdTipoSalidaBienInsumo
	end
    CLOSE VarCursorDesarrollo
	DEALLOCATE VarCursorDesarrollo
end
DENY EXECUTE ON farmActualizaPrecioPonderadoMenorAcero TO [Galenhos Authentication] AS [dbo]
GO
ALTER AUTHORIZATION ON [dbo].[farmActualizaPrecioPonderadoMenorAcero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmActualizaSaldosMensual]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmActualizaSaldosMensual]
	@lcEntradaSalida [varchar](1),
	@IdAlmacen [int],
	@IdProducto [int],
	@Cantidad [int],
	@FechaMov [datetime],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@precio [money],
	@idTipoSalidaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
BEGIN TRANSACTION


declare @ActPrecio money
declare @ActCantidad int
declare @precioPond money
declare @CantidadFinal int


--Tabla farmSaldoMensual
select  @ActCantidad=saldo from farmSaldoMensual where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
    select top 1 @ActCantidad=saldo from farmSaldoMensual where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo order by SaldoFecha desc
   if @@rowcount = 0
   begin
            select @ActCantidad=0
    end
     if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
     else
            set @CantidadFinal=@ActCantidad-@Cantidad
     insert into farmSaldoMensual (idAlmacen,idProducto,SaldoFecha,Saldo,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@fechaMov,@CantidadFinal,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
     else
            set @CantidadFinal=@ActCantidad-@Cantidad
      update farmSaldoMensual   set   saldo=@CantidadFinal    where    idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end


--Tabla farmSaldoMensualDetallado
select @ActPrecio=precio,@ActCantidad=saldo from farmSaldoMensualDetallado where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov and Lote=@lote and fechaVencimiento=@fechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
    select top 1 @ActCantidad=saldo from farmSaldoMensualDetallado where idAlmacen=@IdAlmacen  and idProducto= @IdProducto   and Lote=@lote and fechaVencimiento=@fechaVencimiento   and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo order by SaldoFecha desc
     if @@rowcount = 0
     begin
            select @ActCantidad=0
      end
      set @precioPond=round(@precio,2)
      if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
      else
            set @CantidadFinal=@ActCantidad-@Cantidad
     insert into farmSaldoMensualDetallado (idAlmacen,idProducto,SaldoFecha,Saldo,Lote,FechaVencimiento,Precio,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@fechaMov,@CantidadFinal,@Lote,@FechaVencimiento,@precioPond,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
            begin
            if @cantidad+@actCantidad>0
                    set @precioPond=((@precio*@cantidad)+(@actPrecio*@actCantidad))/(@cantidad+@actCantidad)
            else
                    set @precioPond=1
           set @CantidadFinal=@ActCantidad+@Cantidad
           end
     else
           begin
           set @CantidadFinal=@ActCantidad-@Cantidad
           set @precioPond=@actPrecio
           end
      update farmSaldoMensualDetallado   set   saldo=@CantidadFinal, precio=@precioPond    where    idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov  and Lote=@lote and fechaVencimiento=@fechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end

COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[FarmActualizaSaldosMensual] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmActualizaSaldosMensualRS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmActualizaSaldosMensualRS]
	@lcEntradaSalida [varchar](1),
	@IdAlmacen [int],
	@IdProducto [int],
	@Cantidad [int],
	@FechaMov [datetime],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@precio [money],
	@idTipoSalidaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--GO
BEGIN TRANSACTION


declare @ActPrecio money
declare @ActCantidad int
declare @precioPond money
declare @CantidadFinal int


--Tabla farmSaldoMensual
select  @ActCantidad=saldo from farmSaldoMensual where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
    select @ActCantidad=0
     if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
     else
            set @CantidadFinal=@ActCantidad-@Cantidad
     insert into farmSaldoMensual (idAlmacen,idProducto,SaldoFecha,Saldo,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@fechaMov,@CantidadFinal,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
     else
            set @CantidadFinal=@ActCantidad-@Cantidad
      update farmSaldoMensual   set   saldo=@CantidadFinal    where    idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end




--Tabla farmSaldoMensualDetallado
select @ActPrecio=precio,@ActCantidad=saldo from farmSaldoMensualDetallado where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov and Lote=@lote and fechaVencimiento=@fechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
      select @ActCantidad=0
      set @precioPond=round(@precio,2)
      if @lcEntradaSalida='E'
            set @CantidadFinal=@ActCantidad+@Cantidad
      else
            set @CantidadFinal=@ActCantidad-@Cantidad
     insert into farmSaldoMensualDetallado (idAlmacen,idProducto,SaldoFecha,Saldo,Lote,FechaVencimiento,Precio,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@fechaMov,@CantidadFinal,@Lote,@FechaVencimiento,@precioPond,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
            begin
            if @cantidad+@actCantidad>0
                    set @precioPond=((@precio*@cantidad)+(@actPrecio*@actCantidad))/(@cantidad+@actCantidad)
            else
                    set @precioPond=1
           set @CantidadFinal=@ActCantidad+@Cantidad
           end
     else
           begin
           set @CantidadFinal=@ActCantidad-@Cantidad
           set @precioPond=@actPrecio
           end
      update farmSaldoMensualDetallado   set   saldo=@CantidadFinal, precio=@precioPond    where    idAlmacen=@IdAlmacen  and idProducto= @IdProducto and SaldoFecha=@fechaMov  and Lote=@lote and fechaVencimiento=@fechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end

COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[FarmActualizaSaldosMensualRS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmActualizaSaldosPorProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmActualizaSaldosPorProducto]
	@lcEntradaSalida [varchar](1),
	@IdAlmacen [int],
	@IdProducto [int],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@Cantidad [int],
	@precio [money],
	@idTipoSalidaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
SET TRANSACTION ISOLATION LEVEL   READ UNCOMMITTED
--GO
BEGIN TRANSACTION

declare @ActPrecio money
declare @ActCantidad int
declare @precioPond money
declare @CantidadFinal int


--Tabla farmSaldo
select @ActPrecio=precio,@ActCantidad=cantidad from farmSaldo where idAlmacen=@IdAlmacen  and idProducto= @IdProducto  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
     if @lcEntradaSalida='E'
     begin
        set @CantidadFinal=@Cantidad
     end
     else
     begin
        set @CantidadFinal=-@Cantidad
     end
     set @precioPond=round(@precio,2)
     insert into farmSaldo (idAlmacen,idProducto,cantidad,precio,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@CantidadFinal,@precioPond,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
     begin
         if @cantidad+@actCantidad>0
                  set @precioPond=((@precio*@cantidad)+(@actPrecio*@actCantidad))/(@cantidad+@actCantidad)
        else
                  set @precioPond=1
        set @CantidadFinal=@ActCantidad+@Cantidad
     end
     else
     begin
        set @precioPond=@actPrecio
        set @CantidadFinal=@ActCantidad-@Cantidad
     end
      set @precioPond=round(@precioPond,2)
      update farmSaldo
      set
      cantidad=@CantidadFinal,
      precio=@precioPond
      where
      idAlmacen=@IdAlmacen  and idProducto= @IdProducto and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end


--Tabla farmSaldoDetallado
select @ActCantidad=cantidad from farmSaldoDetallado where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and Lote=@Lote and FechaVencimiento=@FechaVencimiento  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
if @@rowcount = 0
  begin
     if @lcEntradaSalida='E'
     begin
        set @CantidadFinal=@Cantidad
     end
     else
     begin
        set @CantidadFinal=-@Cantidad
     end
     insert into farmSaldoDetallado (idAlmacen,idProducto,cantidad,precio,lote,fechaVencimiento,idTipoSalidaBienInsumo) values (@IdAlmacen,@IdProducto,@CantidadFinal,@precio,@lote,@FechaVencimiento,@idTipoSalidaBienInsumo)
  end
else
  begin
     if @lcEntradaSalida='E'
     begin
        set @CantidadFinal=@ActCantidad+@Cantidad
     end
     else
     begin
        set @CantidadFinal=@ActCantidad-@Cantidad
     end
     update farmSaldoDetallado
     set
     cantidad=@CantidadFinal,
     precio=@precioPond
     where idAlmacen=@IdAlmacen  and idProducto= @IdProducto and Lote=@Lote and FechaVencimiento=@FechaVencimiento  and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
  end


COMMIT TRANSACTION
GO
ALTER AUTHORIZATION ON [dbo].[FarmActualizaSaldosPorProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmAlmacenAgregar]
	@idAlmacen [int],
	@descripcion [varchar](50),
	@idTipoLocales [varchar](1),
	@idTipoSuministro [varchar](2),
	@idEstado [int],
	@codigoSISMED [varchar](11),
	@regenerarDias [varchar](7),
	@regenerarHora [varchar](5),
	@regenerarEstado [varchar](7),
	@esUnidosis [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmAlmacen (
idAlmacen,descripcion,idTipoLocales,idTipoSuministro,idEstado,codigoSISMED,regenerarDias,regenerarHora,
regenerarEstado,esUnidosis) values (
@idAlmacen,@descripcion,@idTipoLocales,@idTipoSuministro,@idEstado,@codigoSISMED,@regenerarDias,@regenerarHora,
@regenerarEstado,@esUnidosis)
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenConsultaXtipoFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmAlmacenConsultaXtipoFarmacia]
WITH EXECUTE AS CALLER
AS
SELECT                dbo.farmAlmacen.idAlmacen	, dbo.farmAlmacen.descripcion  as descripcion, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.idTipoLocales,dbo.farmAlmacen.idEstado
             FROM      dbo.farmAlmacen
	left  join dbo.farmtiposuministro on dbo.farmtiposuministro.idTipoSuministro=dbo.farmAlmacen.idTipoSuministro
	LEFT OUTER JOIN dbo.farmEstadosMovimientos ON dbo.farmAlmacen.idEstado = dbo.farmEstadosMovimientos.idEstadoMovimiento

             WHERE   dbo.farmAlmacen.idTipoLocales='F' and dbo.farmAlmacen.IdAlmacen>1 order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenConsultaXtipoFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmAlmacenEliminar]
	@idAlmacen [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmAlmacen
where idAlmacen = @idAlmacen
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idAlmacen,'farmAlmacen'
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenesDevuelveListaDependenciasExternas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmAlmacenesDevuelveListaDependenciasExternas]
WITH EXECUTE AS CALLER
AS
SELECT                dbo.farmAlmacen.idAlmacen, dbo.farmAlmacen.descripcion, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.idTipoLocales,dbo.farmAlmacen.idEstado
             FROM      dbo.farmAlmacen LEFT OUTER JOIN
                              dbo.farmEstadosMovimientos ON dbo.farmAlmacen.idEstado = dbo.farmEstadosMovimientos.idEstadoMovimiento
             WHERE   dbo.farmAlmacen.idTipoLocales='X' and dbo.farmAlmacen.IdAlmacen>1 order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenesDevuelveListaDependenciasExternas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenesTipoSuministroSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmAlmacenesTipoSuministroSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from farmTipoSuministro
order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenesTipoSuministroSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmAlmacenFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

IF @lcFiltro<>''
   SET  @SQL =  'SELECT  * from farmAlmacen where '+ @lcFiltro +' order by descripcion'
ELSE
   SET  @SQL =  'SELECT  * from farmAlmacen order by descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmAlmacenModificar]
	@idAlmacen [int],
	@descripcion [varchar](50),
	@idTipoLocales [varchar](1),
	@idTipoSuministro [varchar](2),
	@idEstado [int],
	@codigoSISMED [varchar](11),
	@regenerarDias [varchar](7),
	@regenerarHora [varchar](5),
	@regenerarEstado [varchar](7),
	@esUnidosis [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmAlmacen
set
descripcion = @descripcion,
idTipoLocales = @idTipoLocales,
idTipoSuministro = @idTipoSuministro,
idEstado = @idEstado,
codigoSISMED=@codigoSISMED,
regenerarDias=@regenerarDias,
regenerarHora=@regenerarHora,
regenerarEstado=@regenerarEstado,
esUnidosis=@esUnidosis
where idAlmacen = @idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenObtieneCodigoSismed]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmAlmacenObtieneCodigoSismed]
	@idTipoSuministro [varchar](2)
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 PERCENT SUBSTRING(codigoSISMED, 7, 2) AS correlativo
FROM         dbo.farmAlmacen
WHERE     (idTipoSuministro = @idTipoSuministro)
ORDER BY idAlmacen DESC
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenObtieneCodigoSismed] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmAlmacenSeleccionarPorId]
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
select * from farmAlmacen
where idAlmacen = @idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmAlmacenSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from farmAlmacen order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmAlmacenSeleccionarTodosMenosExternos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmAlmacenSeleccionarTodosMenosExternos]
WITH EXECUTE AS CALLER
AS
SELECT  * from farmAlmacen where idTipoLocales<>'X' and idEstado=1 order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[farmAlmacenSeleccionarTodosMenosExternos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmAlmacenUltimoAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmAlmacenUltimoAlmacen]
WITH EXECUTE AS CALLER
AS
select idAlmacen from FarmAlmacen order by idAlmacen Desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmAlmacenUltimoAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmComponenteDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmComponenteDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from farmComponente order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FarmComponenteDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmComponenteSubDevuelveTodosSegunComponente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmComponenteSubDevuelveTodosSegunComponente]
	@idComponente [int]
WITH EXECUTE AS CALLER
AS
select * from farmComponenteSub where idComponente=@idComponente order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FarmComponenteSubDevuelveTodosSegunComponente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmDevuelveMovimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmDevuelveMovimientos]
	@MovTipo [varchar](1),
	@IdAlmacen [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
if @MovTipo='S'
begin
	SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino,
	                      farmAlmacen_2.descripcion AS fOrigen, dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero,
	                      dbo.farmMovimiento.fechaCreacion, dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total,dbo.farmMovimiento.IdEstadoMovimiento,
		    dbo.farmMovimiento.IdTipoConcepto,dbo.farmMovimiento.idAlmacenOrigen,dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario
	FROM         dbo.farmMovimiento LEFT OUTER JOIN
	                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
	                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
	                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	WHERE     (dbo.farmMovimiento.MovTipo=@MovTipo) and  (dbo.farmMovimiento.idAlmacenOrigen=@IdAlmacen)   and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimiento.fechaCreacion DESC,  dbo.farmMovimiento.movNumero desc
end
else
begin
	SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino,
	                      farmAlmacen_2.descripcion AS fOrigen, dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero,
	                      dbo.farmMovimiento.fechaCreacion, dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total,dbo.farmMovimiento.IdEstadoMovimiento,
		    dbo.farmMovimiento.IdTipoConcepto,dbo.farmMovimiento.idAlmacenOrigen,dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario
	FROM         dbo.farmMovimiento LEFT OUTER JOIN
	                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
	                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
	                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	WHERE     (dbo.farmMovimiento.MovTipo=@MovTipo) and  (dbo.farmMovimiento.idAlmacenDestino=@IdAlmacen)   and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimiento.fechaCreacion DESC, dbo.farmMovimiento.movNumero desc
end
GO
ALTER AUTHORIZATION ON [dbo].[FarmDevuelveMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmDevuelveMovimientosDeProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmDevuelveMovimientosDeProducto]
	@IdProducto [int],
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo,
farmAlmacen_1.descripcion AS FDestino,farmAlmacen_2.descripcion AS fOrigen,
                      dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmTipoDocumentos.Abreviatura,
                      dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,
                      dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo,
  dbo.Pacientes.ApellidoPaterno+' '+dbo.Pacientes.ApellidoMaterno+' '+dbo.Pacientes.PrimerNombre+' ('+convert(varchar,dbo.Pacientes.NroHistoriaClinica)+')' AS DatPaciente,
  farmAlmacen_1.idTipoLocales as  idTipoLocalesDest,farmAlmacen_1.idEstado as idEstadoDest,
  farmAlmacen_2.idTipoLocales as  idTipoLocalesOrig,farmAlmacen_2.idEstado as idEstadoOrig
FROM         dbo.farmMovimiento LEFT OUTER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
                      dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
                      dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)   and (dbo.farmMovimientoDetalle.idProducto=@IdProducto)   and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmDevuelveMovimientosDeProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveMovimientosParaICI]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmDevuelveMovimientosParaICI]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int],
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
if @movTipo=''
begin
	SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
						  dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
						  dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idAlmacenOrigen,
						  dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario, dbo.farmMovimiento.DocumentoNumero,
						  dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo, dbo.farmMovimientoDetalle.Precio
	FROM         dbo.farmAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimiento ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino LEFT OUTER JOIN
						  dbo.farmAlmacen AS farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
						  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
						  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     not (farmAlmacen_1.idTipoLocales = 'A' or dbo.farmAlmacen.idTipoLocales = 'A') and
	      (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
                                dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
end
else
begin
    if @movTipo='S'
    begin
	SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
						  dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
						  dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idAlmacenOrigen,
						  dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario, dbo.farmMovimiento.DocumentoNumero,
						  dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo, dbo.farmMovimientoDetalle.Precio
	FROM         dbo.farmAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimiento ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino LEFT OUTER JOIN
						  dbo.farmAlmacen AS farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
						  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
						  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     not (farmAlmacen_1.idTipoLocales = 'A' or dbo.farmAlmacen.idTipoLocales = 'A') and
	         (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenOrigen=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
                                 dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
    else
    begin
	SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
						  dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
						  dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idAlmacenOrigen,
						  dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario, dbo.farmMovimiento.DocumentoNumero,
						  dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo, dbo.farmMovimientoDetalle.Precio
	FROM         dbo.farmAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimiento ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino LEFT OUTER JOIN
						  dbo.farmAlmacen AS farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen RIGHT OUTER JOIN
						  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
						  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
						  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     not (farmAlmacen_1.idTipoLocales = 'A' or dbo.farmAlmacen.idTipoLocales = 'A') and
	      (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenDestino=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
		      dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveMovimientosParaICI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveMovimientosParaICIeIDI]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmDevuelveMovimientosParaICIeIDI]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int],
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
if @movTipo=''
begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
                 dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.precio,dbo.FactCatalogoBienesInsumos.TipoProducto
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimientoDetalle.idProducto,   dbo.farmMovimiento.fechaCreacion,
                                dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
end
else
begin
    if @movTipo='S'
    begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
		       dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.precio,dbo.FactCatalogoBienesInsumos.TipoProducto
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenOrigen=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,   dbo.farmMovimiento.fechaCreacion,
                                 dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
    else
    begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
		       dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.precio,dbo.FactCatalogoBienesInsumos.TipoProducto
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenDestino=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimiento.fechaCreacion,
		      dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveMovimientosParaICIeIDI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveMovimientosParaICIeIDIPorTproducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmDevuelveMovimientosParaICIeIDIPorTproducto]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int],
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
if @movTipo=''
begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
                                  dbo.farmMovimiento.DocumentoNumero,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo,dbo.farmMovimientoDetalle.precio
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
                                dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
end
else
begin
    if @movTipo='S'
    begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
		       dbo.farmMovimiento.DocumentoNumero,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo	,dbo.farmMovimientoDetalle.precio
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenOrigen=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
                                 dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
    else
    begin
	SELECT      dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
	                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
	                     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino,dbo.farmMovimiento.idUsuario,
		       dbo.farmMovimiento.DocumentoNumero,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo	,dbo.farmMovimientoDetalle.precio
	FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1)     and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenDestino=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo, dbo.farmMovimiento.fechaCreacion,
		      dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveMovimientosParaICIeIDIPorTproducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveMovimientosParaIDI]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmDevuelveMovimientosParaIDI]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int],
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
if @movTipo=''
begin
   SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario,
                      dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.Precio, dbo.FactCatalogoBienesInsumos.TipoProducto
   FROM         dbo.farmAlmacen farmAlmacen_1 RIGHT OUTER JOIN
                      dbo.farmMovimiento ON farmAlmacen_1.idAlmacen = dbo.farmMovimiento.idAlmacenOrigen LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenDestino = dbo.farmAlmacen.idAlmacen RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
   WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (farmAlmacen_1.idTipoLocales = 'A' OR dbo.farmAlmacen.idTipoLocales = 'A')
	and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
	ORDER BY dbo.farmMovimientoDetalle.idProducto,   dbo.farmMovimiento.fechaCreacion,
                                dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
end
else
begin
    if @movTipo='S'
    begin
       SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario,
                      dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.Precio, dbo.FactCatalogoBienesInsumos.TipoProducto
       FROM         dbo.farmAlmacen farmAlmacen_1 RIGHT OUTER JOIN
                      dbo.farmMovimiento ON farmAlmacen_1.idAlmacen = dbo.farmMovimiento.idAlmacenOrigen LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenDestino = dbo.farmAlmacen.idAlmacen RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
        WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (farmAlmacen_1.idTipoLocales = 'A' OR dbo.farmAlmacen.idTipoLocales = 'A')
                  and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenOrigen=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,   dbo.farmMovimiento.fechaCreacion,
                                 dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
    else
    begin
       SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idUsuario,
                      dbo.farmMovimiento.DocumentoNumero, dbo.farmMovimientoDetalle.Precio, dbo.FactCatalogoBienesInsumos.TipoProducto
       FROM         dbo.farmAlmacen farmAlmacen_1 RIGHT OUTER JOIN
                      dbo.farmMovimiento ON farmAlmacen_1.idAlmacen = dbo.farmMovimiento.idAlmacenOrigen LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenDestino = dbo.farmAlmacen.idAlmacen RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
        WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (farmAlmacen_1.idTipoLocales = 'A' OR dbo.farmAlmacen.idTipoLocales = 'A')
                 and (dbo.farmMovimiento.fechaCreacion Between  @FechaInicio and  @FechaFin)
                               and (dbo.farmMovimiento.idAlmacenDestino=@idAlmacen) and dbo.farmMovimientoDetalle.MovTipo=@movTipo
	ORDER BY dbo.farmMovimientoDetalle.idProducto,  dbo.farmMovimiento.fechaCreacion,
		      dbo.farmMovimientoDetalle.MovNumero,dbo.farmMovimientoDetalle.MovTipo
    end
end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveMovimientosParaIDI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveSaldosConLotesSegunAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmDevuelveSaldosConLotesSegunAlmacen]
	@IdAlmacen [int],
	@Orden [int],
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
if @Orden=1          --Ordenado y buscado por Nombre del Producto
   begin
            if @Filtro=''
                begin
				SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
									   dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
									  dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio,
									  dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo
				FROM         dbo.farmSaldoDetallado INNER JOIN
									  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
									  dbo.farmTipoSalidaBienInsumo ON dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
                          where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	  end
           else
	 begin
		declare @Filtrado varchar(50)
		select @Filtrado=@Filtro+'%'
		SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
							   dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
							  dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio,
							  dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmSaldoDetallado INNER JOIN
							  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
							  dbo.farmTipoSalidaBienInsumo ON dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen and  dbo.farmSaldoDetallado.Cantidad>0  and dbo.FactCatalogoBienesInsumos.Nombre like @Filtrado
		order by  dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldoDetallado.FechaVencimiento
	end
   end
else       --Ordenado y buscado por Codigo del Producto
  begin
             if @Filtro=''
                begin
				SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
									   dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
									  dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio,
									  dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo
				FROM         dbo.farmSaldoDetallado INNER JOIN
									  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
									  dbo.farmTipoSalidaBienInsumo ON dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
				where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen
				order by  dbo.FactCatalogoBienesInsumos.Codigo
	 end
     else
	begin
		SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
							   dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
							  dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio,
							  dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmSaldoDetallado INNER JOIN
							  dbo.farmTipoSalidaBienInsumo ON
							  dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo INNER JOIN
							  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen and dbo.FactCatalogoBienesInsumos.Codigo=@Filtro and dbo.farmSaldoDetallado.Cantidad>0
		order by  dbo.farmSaldoDetallado.FechaVencimiento
	end
end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveSaldosConLotesSegunAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmDevuelveSaldosConSinLotesPorAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmDevuelveSaldosConSinLotesPorAlmacen]
	@IdAlmacen [int],
	@Orden [int],
	@Reporte [varchar](50),
	@Filtro [varchar](1)
WITH EXECUTE AS CALLER
AS
if @Reporte='1'
begin
       --saldos consolidados
       if @Orden=1
       begin
	 --ordenado por Nombre
               if @Filtro='1'
               begin
		--StockMinimo<=saldo
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo,
			     dbo.farmSaldo.IdTipoSalidaBienInsumo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen  and dbo.FactCatalogoBienesInsumos.StockMinimo>dbo.farmSaldo.cantidad
		order by  dbo.FactCatalogoBienesInsumos.Nombre
              end
              else
	 begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo,
			     dbo.farmSaldo.IdTipoSalidaBienInsumo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	 end
       end
       else
       begin
	 --ordenado por Codigo
               if @Filtro='1'
               begin
		--StockMinimo<=saldo
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo,
			     dbo.farmSaldo.IdTipoSalidaBienInsumo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen  and dbo.FactCatalogoBienesInsumos.StockMinimo>dbo.farmSaldo.cantidad
		order by  dbo.FactCatalogoBienesInsumos.codigo
              end
              else
	 begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo,
			     dbo.farmSaldo.IdTipoSalidaBienInsumo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.codigo
	 end

       end
end
else
begin
     --SALDOS DETALLADOS CON LOTES
       if @Orden=1
       begin
	 --ordenado por Nombre
               if @Filtro='1'
               begin
		--StockMinimo<=saldo
		SELECT    dbo.farmSaldoDetallado.idAlmacen, dbo.farmSaldoDetallado.idProducto,
		                          (SELECT     dbo.farmSaldo.precio
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Precio,
		                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                          (SELECT     dbo.farmSaldo.cantidad
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Cantidad,
		                      dbo.FactCatalogoBienesInsumos.StockMinimo, dbo.farmSaldoDetallado.Lote, dbo.farmSaldoDetallado.FechaVencimiento,
		                      dbo.farmSaldoDetallado.Cantidad AS CantidadLote, dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumo,
		                      dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumoSaldo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
		                      dbo.farmSaldoDetallado ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldoDetallado.idProducto
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen  and dbo.FactCatalogoBienesInsumos.StockMinimo>cantidad
		order by  dbo.FactCatalogoBienesInsumos.Nombre
              end
              else
	 begin
		SELECT    dbo.farmSaldoDetallado.idAlmacen, dbo.farmSaldoDetallado.idProducto,
		                          (SELECT     dbo.farmSaldo.precio
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Precio,
		                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                          (SELECT     dbo.farmSaldo.cantidad
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Cantidad,
		                      dbo.FactCatalogoBienesInsumos.StockMinimo, dbo.farmSaldoDetallado.Lote, dbo.farmSaldoDetallado.FechaVencimiento,
		                      dbo.farmSaldoDetallado.Cantidad AS CantidadLote, dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumo,
		                      dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumoSaldo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
		                      dbo.farmSaldoDetallado ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldoDetallado.idProducto
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	 end
       end
       else
       begin
	 --ordenado por Codigo
               if @Filtro='1'
               begin
		--StockMinimo<=saldo
		SELECT    dbo.farmSaldoDetallado.idAlmacen, dbo.farmSaldoDetallado.idProducto,
		                          (SELECT     dbo.farmSaldo.precio
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Precio,
		                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                          (SELECT     dbo.farmSaldo.cantidad
		                            FROM          dbo.farmSaldo
		                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
		                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Cantidad,
		                      dbo.FactCatalogoBienesInsumos.StockMinimo, dbo.farmSaldoDetallado.Lote, dbo.farmSaldoDetallado.FechaVencimiento,
		                      dbo.farmSaldoDetallado.Cantidad AS CantidadLote, dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumo,
		                      dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumoSaldo,dbo.FactCatalogoBienesInsumos.TipoProducto
		FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
		                      dbo.farmSaldoDetallado ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldoDetallado.idProducto
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen  and dbo.FactCatalogoBienesInsumos.StockMinimo>cantidad
		order by  dbo.FactCatalogoBienesInsumos.codigo
              end
              else
	 begin
		SELECT    dbo.farmSaldoDetallado.idAlmacen, dbo.farmSaldoDetallado.idProducto,
	                          (SELECT     dbo.farmSaldo.precio
	                            FROM          dbo.farmSaldo
	                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
	                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Precio,
	                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                          (SELECT     dbo.farmSaldo.cantidad
	                            FROM          dbo.farmSaldo
	                            WHERE      dbo.farmSaldo.idProducto = dbo.farmSaldoDetallado.idProducto AND dbo.farmSaldo.idAlmacen = dbo.farmSaldoDetallado.idAlmacen AND
	                                                   dbo.farmSaldo.idTipoSalidaBienInsumo = dbo.farmSaldoDetallado.idTipoSalidaBienInsumo) AS Cantidad,
	                      dbo.FactCatalogoBienesInsumos.StockMinimo, dbo.farmSaldoDetallado.Lote, dbo.farmSaldoDetallado.FechaVencimiento,
	                      dbo.farmSaldoDetallado.Cantidad AS CantidadLote, dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumo,
	                      dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo AS IdTipoSalidaBienInsumoSaldo,dbo.FactCatalogoBienesInsumos.TipoProducto
	                      FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
	                      dbo.farmSaldoDetallado ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldoDetallado.idProducto
		where dbo.farmSaldoDetallado.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.codigo
	 end

       end
end
GO
ALTER AUTHORIZATION ON [dbo].[FarmDevuelveSaldosConSinLotesPorAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmDevuelveSaldosSegunAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmDevuelveSaldosSegunAlmacen]
	@IdAlmacen [int],
	@Orden [int],
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
if @Orden=1         --Ordenado y buscado por Nombre del Producto
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	  end
           else
	 begin
		declare @Filtrado varchar(50)
		select @Filtrado='%'+@Filtro+'%'
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen and dbo.FactCatalogoBienesInsumos.Nombre like @Filtrado
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	end
   end
else	--Ordenado y buscado por codigo del Producto
  begin
             if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto,  dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Codigo
	 end
         else
	begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.Codigo,
		                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.StockMinimo
		FROM         dbo.farmSaldo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where dbo.farmSaldo.IdAlmacen = @IdAlmacen and dbo.FactCatalogoBienesInsumos.Codigo=@Filtro
		order by  dbo.FactCatalogoBienesInsumos.Codigo
	end
end
GO
ALTER AUTHORIZATION ON [dbo].[FarmDevuelveSaldosSegunAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveSaldosSegunAlmacenProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmDevuelveSaldosSegunAlmacenProducto]
	@idAlmacen [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
select * from farmSaldo where idAlmacen =@idAlmacen   and idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveSaldosSegunAlmacenProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveSaldosSegunAlmacenProductoLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmDevuelveSaldosSegunAlmacenProductoLote]
	@idAlmacen [int],
	@idProducto [int],
	@lote [varchar](15),
	@fechaVencimiento [datetime],
	@idTipoSalidaBienInsumo [int]
WITH EXECUTE AS CALLER
AS
select * from farmSaldoDetallado where idAlmacen =@idAlmacen   and idProducto=@idProducto  and lote=@lote  and fechaVencimiento=@fechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveSaldosSegunAlmacenProductoLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveSaldosSinLotesSegunAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmDevuelveSaldosSinLotesSegunAlmacen]
	@IdAlmacen [int],
	@Orden [int],
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
if @Orden=1
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento,
                                                 dbo.farmSaldo.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.idTipoSalidaBienInsumo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
		                      dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                          where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	   end
           else
               begin
		declare @Filtrado varchar(50)
		select @Filtrado=@Filtro+'%'
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento,
                                                 dbo.farmSaldo.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.idTipoSalidaBienInsumo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
		                      dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			dbo.farmSaldo.cantidad>0  and dbo.FactCatalogoBienesInsumos.Nombre like @Filtrado
		order by  dbo.FactCatalogoBienesInsumos.Nombre

	  end
   end
else
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento,
                                                 dbo.farmSaldo.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.idTipoSalidaBienInsumo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
		                      dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	   end
           else
               begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento,
                                                 dbo.farmSaldo.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
		FROM         dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.idTipoSalidaBienInsumo LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
		                      dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			  dbo.FactCatalogoBienesInsumos.Codigo=@Filtro  and    dbo.farmSaldo.cantidad>0
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	  end
   end


/* COMO ESTABA ANTES DE SALDOS ESTRATEGICOS Y VENTAS  */
/*
if @Orden=1
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
                          where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	   end
           else
               begin
		declare @Filtrado varchar(50)
		select @Filtrado=@Filtro+'%'
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			dbo.farmSaldo.cantidad>0  and dbo.FactCatalogoBienesInsumos.Nombre like @Filtrado
		order by  dbo.FactCatalogoBienesInsumos.Nombre

	  end
   end
else
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	   end
           else
               begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
		                      dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio, dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
		                      dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario, dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.FactCatalogoBienesInsumos ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			  dbo.FactCatalogoBienesInsumos.Codigo=@Filtro  and    dbo.farmSaldo.cantidad>0
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	  end
   end
*/
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveSaldosSinLotesSegunAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmDevuelveSaldosSinLotesSegunAlmacenSOPORTE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmDevuelveSaldosSinLotesSegunAlmacenSOPORTE]
	@IdAlmacen [int],
	@Orden [int],
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
if @Orden=1
   begin
            if @Filtro=''
                begin
		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                                             dbo.farmTipoProductosSismed.Descripcion AS TipoProductoSismed,  dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio,  dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,
		                      dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento, dbo.farmSaldo.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo,
		                    dbo.FactCatalogoBienesInsumos.TipoProductoSismed
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.farmTipoProductosSismed INNER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmTipoProductosSismed.TipoProductoSismed = dbo.FactCatalogoBienesInsumos.TipoProductoSismed ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.IdTipoSalidaBienInsumo ON
		                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
                          where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Nombre
	   end
           else
               begin
		declare @Filtrado varchar(50)
		select @Filtrado=@Filtro+'%'

		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                                             dbo.farmTipoProductosSismed.Descripcion AS TipoProductoSismed,  dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio,  dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,
		                      dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento, dbo.farmSaldo.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo,
		                    dbo.FactCatalogoBienesInsumos.TipoProductoSismed
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.farmTipoProductosSismed INNER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmTipoProductosSismed.TipoProductoSismed = dbo.FactCatalogoBienesInsumos.TipoProductoSismed ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.IdTipoSalidaBienInsumo ON
		                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			dbo.farmSaldo.cantidad>0  and dbo.FactCatalogoBienesInsumos.Nombre like @Filtrado
		order by  dbo.FactCatalogoBienesInsumos.Nombre

	  end
   end
else
   begin
            if @Filtro=''
                begin

		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                                             dbo.farmTipoProductosSismed.Descripcion AS TipoProductoSismed,  dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio,  dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,
		                      dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento, dbo.farmSaldo.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo,
		                    dbo.FactCatalogoBienesInsumos.TipoProductoSismed
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.farmTipoProductosSismed INNER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmTipoProductosSismed.TipoProductoSismed = dbo.FactCatalogoBienesInsumos.TipoProductoSismed ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.IdTipoSalidaBienInsumo ON
		                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	   end
           else
               begin

		SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                                             dbo.farmTipoProductosSismed.Descripcion AS TipoProductoSismed,  dbo.farmSaldo.cantidad AS saldo, dbo.farmSaldo.Precio,  dbo.farmTipoSalidaBienInsumo.tipo,
		                      dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,
		                      dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento, dbo.farmSaldo.IdTipoSalidaBienInsumo AS idTipoSalidaBienInsumoSaldo,
		                    dbo.FactCatalogoBienesInsumos.TipoProductoSismed
		FROM         dbo.FactCatalogoBienesInsumosHosp LEFT OUTER JOIN
		                      dbo.farmTipoProductosSismed INNER JOIN
		                      dbo.FactCatalogoBienesInsumos ON dbo.farmTipoProductosSismed.TipoProductoSismed = dbo.FactCatalogoBienesInsumos.TipoProductoSismed ON
		                      dbo.FactCatalogoBienesInsumosHosp.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto RIGHT OUTER JOIN
		                      dbo.farmTipoSalidaBienInsumo RIGHT OUTER JOIN
		                      dbo.farmSaldo ON dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo = dbo.farmSaldo.IdTipoSalidaBienInsumo ON
		                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmSaldo.idProducto
		where (dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) and dbo.farmSaldo.IdAlmacen = @IdAlmacen and
			  dbo.FactCatalogoBienesInsumos.Codigo=@Filtro  and    dbo.farmSaldo.cantidad>0
		order by  dbo.FactCatalogoBienesInsumos.Codigo

	  end
   end
GO
ALTER AUTHORIZATION ON [dbo].[farmDevuelveSaldosSinLotesSegunAlmacenSOPORTE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmDevuelveYactualizaCorrelativosDeDocumentosES]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmDevuelveYactualizaCorrelativosDeDocumentosES]
	@IdTipoDocumento [int],
	@NewCorrelativo [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @UltCorrelativo int
--Tabla farmtipodocumentos
select @UltCorrelativo=correlativo from  farmTipoDocumentos where idTipoDocumento=@IdTipoDocumento
if @@rowcount = 0
  begin
     set @NewCorrelativo=0
  end
else
  begin
        if @UltCorrelativo=null
            begin
		set @NewCorrelativo=1
	    end
        else
            begin
		set @NewCorrelativo=@UltCorrelativo+1
	end
        update farmTipoDocumentos set correlativo=@NewCorrelativo where idTipoDocumento=@IdTipoDocumento
  end
GO
ALTER AUTHORIZATION ON [dbo].[FarmDevuelveYactualizaCorrelativosDeDocumentosES] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmHistPrecioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmHistPrecioAgregar]
	@idHistPrecio [int] OUTPUT,
	@idProducto [int],
	@fecha [datetime],
	@PrecioCompra [money],
	@PrecioDistribucion [money],
	@PrecioVenta [money],
	@PrecioDonacion [money],
	@idUsuario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmHistPrecio (
idProducto,fecha,PrecioCompra,PrecioDistribucion,PrecioVenta,PrecioDonacion,idUsuario) values (
@idProducto,@fecha,@PrecioCompra,@PrecioDistribucion,@PrecioVenta,@PrecioDonacion,@idUsuario)
set @idHistPrecio = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idHistPrecio,'farmHistPrecio'
GO
ALTER AUTHORIZATION ON [dbo].[farmHistPrecioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmHistPrecioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmHistPrecioEliminar]
	@idHistPrecio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmHistPrecio
where idHistPrecio = @idHistPrecio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idHistPrecio,'farmHistPrecio'
GO
ALTER AUTHORIZATION ON [dbo].[farmHistPrecioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmHistPrecioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmHistPrecioModificar]
	@idHistPrecio [int],
	@idProducto [int],
	@fecha [datetime],
	@PrecioCompra [money],
	@PrecioDistribucion [money],
	@PrecioVenta [money],
	@PrecioDonacion [money],
	@idUsuario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmHistPrecio
set
idProducto = @idProducto,
fecha = @fecha,
PrecioCompra = @PrecioCompra,
PrecioDistribucion = @PrecioDistribucion,
PrecioVenta = @PrecioVenta,
PrecioDonacion = @PrecioDonacion,
idUsuario = @idUsuario
where idHistPrecio = @idHistPrecio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idHistPrecio,'farmHistPrecio'
GO
ALTER AUTHORIZATION ON [dbo].[farmHistPrecioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmHistPrecioPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmHistPrecioPorIdProducto]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 *
FROM         dbo.farmHistPrecio
where idProducto=@idProducto
ORDER BY fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[FarmHistPrecioPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmHistPrecioSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmHistPrecioSeleccionarPorCodigo]
	@codigo [varchar](7),
	@nombre [varchar](100)
WITH EXECUTE AS CALLER
AS
if @codigo<>''
	SELECT      dbo.farmHistPrecio.fecha, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmHistPrecio.PrecioCompra, dbo.farmHistPrecio.PrecioDistribucion, dbo.farmHistPrecio.PrecioVenta, dbo.farmHistPrecio.PrecioDonacion,dbo.farmHistPrecio.idHistPrecio
	FROM         dbo.FactCatalogoBienesInsumos INNER JOIN
	                      dbo.farmHistPrecio ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmHistPrecio.idProducto
             where          dbo.FactCatalogoBienesInsumos.Codigo=@codigo
	ORDER BY dbo.farmHistPrecio.fecha DESC
else
	SELECT      dbo.farmHistPrecio.fecha, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
	                      dbo.farmHistPrecio.PrecioCompra, dbo.farmHistPrecio.PrecioDistribucion, dbo.farmHistPrecio.PrecioVenta, dbo.farmHistPrecio.PrecioDonacion,dbo.farmHistPrecio.idHistPrecio
	FROM         dbo.FactCatalogoBienesInsumos INNER JOIN
	                      dbo.farmHistPrecio ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmHistPrecio.idProducto
             where          dbo.FactCatalogoBienesInsumos.Nombre like '%' + @nombre +'%'
	ORDER BY dbo.farmHistPrecio.fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[FarmHistPrecioSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmHistPrecioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmHistPrecioSeleccionarPorId]
	@idHistPrecio [int]
WITH EXECUTE AS CALLER
AS
select * from farmHistPrecio
where idHistPrecio = @idHistPrecio
GO
ALTER AUTHORIZATION ON [dbo].[farmHistPrecioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioAgregar]
	@idInventario [int] OUTPUT,
	@idAlmacen [int],
	@numeroInventario [varchar](4),
	@FechaCierre [datetime],
	@FechaCreacion [datetime],
	@FechaModificacion [datetime],
	@idEstadoInventario [int],
	@idUsuario [int],
	@idTipoInventario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmInventario (
idAlmacen,numeroInventario,FechaCierre,FechaCreacion,FechaModificacion,idEstadoInventario,idUsuario,idTipoInventario) values (
@idAlmacen,@numeroInventario,@FechaCierre,@FechaCreacion,@FechaModificacion,@idEstadoInventario,@idUsuario,@idTipoInventario)
set @idInventario = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idInventario,'farmInventario'
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioCabeceraAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioCabeceraAgregar]
	@idInventario [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@CantidadSaldo [int],
	@CantidadFaltante [int],
	@CantidadSobrante [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmInventarioCabecera (idInventario,idProducto,Cantidad,Precio,Total,CantidadSaldo,CantidadFaltante,CantidadSobrante) values
(@idInventario,@idProducto,@Cantidad,@Precio,@Total,@CantidadSaldo,@CantidadFaltante,@CantidadSobrante)
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioCabeceraDevuelveProductosPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioCabeceraDevuelveProductosPorId]
	@lnIdInventario [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmInventarioCabecera.*, dbo.FactCatalogoBienesInsumos.Codigo,
         dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
         dbo.FactCatalogoBienesInsumos.idTipoSalidaBienInsumo,
         dbo.FactCatalogoBienesInsumos.esPaquete
FROM      dbo.farmInventarioCabecera LEFT OUTER JOIN dbo.FactCatalogoBienesInsumos ON dbo.farmInventarioCabecera.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     dbo.farmInventarioCabecera.idInventario=@lnIdInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabeceraDevuelveProductosPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioCabeceraEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioCabeceraEliminar]
	@idInventario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmInventarioCabecera
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioCabeceraModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioCabeceraModificar]
	@idInventario [int],
	@idProducto [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@CantidadSaldo [int],
	@CantidadFaltante [int],
	@CantidadSobrante [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmInventarioCabecera
set
idProducto = @idProducto,
Cantidad = @Cantidad,
Precio = @Precio,
Total = @Total,
CantidadSaldo=@CantidadSaldo,
CantidadFaltante=@CantidadFaltante,
CantidadSobrante=@CantidadSobrante
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioCabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioCabeceraSeleccionarPorId]
	@idInventario [int]
WITH EXECUTE AS CALLER
AS
select * from farmInventarioCabecera
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioCabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioDetalleAgregar]
	@idInventario [int],
	@idProducto [int],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@Cantidad [int],
	@Precio [money],
	@RegistroSanitario [varchar](50),
	@idTipoSalidaBienInsumo [int],
	@CantidadSaldo [int],
	@CantidadFaltante [int],
	@CantidadSobrante [int],
	@EsHistoricoSaldo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmInventarioDetalle (idInventario,idProducto,Lote,FechaVencimiento,Cantidad,Precio,RegistroSanitario,idTipoSalidaBienInsumo,CantidadSaldo,CantidadFaltante,CantidadSobrante,EsHistoricoSaldo) values
(@idInventario,@idProducto,@Lote,@FechaVencimiento,@Cantidad,@Precio,@RegistroSanitario,@idTipoSalidaBienInsumo,@CantidadSaldo,@CantidadFaltante,@CantidadSobrante,@EsHistoricoSaldo)
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetalleDevuelveProductosLotesPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmInventarioDetalleDevuelveProductosLotesPorId]
	@lnIdInventario [int]
WITH EXECUTE AS CALLER
AS
SELECT     *
            FROM      farmInventarioDetalle
            WHERE     idInventario=@lnIdInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalleDevuelveProductosLotesPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioDetalleEliminar]
	@idInventario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmInventarioDetalle
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioDetalleModificar]
	@idInventario [int],
	@idProducto [int],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@Cantidad [int],
	@Precio [money],
	@RegistroSanitario [varchar](50),
	@idTipoSalidaBienInsumo [int],
	@CantidadSaldo [int],
	@CantidadFaltante [int],
	@CantidadSobrante [int],
	@EsHistoricoSaldo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmInventarioDetalle
set
idProducto = @idProducto,
Lote = @Lote,
FechaVencimiento = @FechaVencimiento,
Cantidad = @Cantidad,
Precio = @Precio,
RegistroSanitario = @RegistroSanitario,
idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo,
CantidadSaldo=@CantidadSaldo,
CantidadFaltante=@CantidadFaltante,
CantidadSobrante=@CantidadSobrante,
EsHistoricoSaldo=@EsHistoricoSaldo
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetallePorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioDetallePorFiltro]
	@Filtro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
set @sql='SELECT     dbo.farmInventarioDetalle.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
FROM         dbo.farmInventarioDetalle INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmInventarioDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE '+@Filtro+' order by dbo.FactCatalogoBienesInsumos.Codigo,dbo.farmInventarioDetalle.Lote, dbo.farmInventarioDetalle.fechaVencimiento'
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetallePorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioDetalleSeleccionarPorId]
	@idInventario [int]
WITH EXECUTE AS CALLER
AS
select * from farmInventarioDetalle
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioDevuelveListaInventarios]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmInventarioDevuelveListaInventarios]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.farmInventario.idInventario, dbo.farmInventario.numeroInventario, dbo.farmAlmacen.descripcion,
                     dbo.FarmInventario.FechaCreacion , dbo.farmEstadosInventario.Estado,dbo.farmInventario.IdEstadoInventario
            FROM     dbo.farmInventario LEFT OUTER JOIN dbo.farmEstadosInventario ON dbo.farmInventario.idEstadoInventario = dbo.farmEstadosInventario.idEstadoInventario LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmInventario.idAlmacen = dbo.farmAlmacen.idAlmacen
            order by dbo.farmInventario.idinventario desc
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioDevuelveListaInventarios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioEliminar]
	@idInventario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmInventario
where idInventario = @idInventario
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idInventario,'farmInventario'
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioModificar]
	@idInventario [int],
	@idAlmacen [int],
	@numeroInventario [varchar](4),
	@FechaCierre [datetime],
	@FechaCreacion [datetime],
	@FechaModificacion [datetime],
	@idEstadoInventario [int],
	@idUsuario [int],
	@idTipoInventario [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmInventario
set
idAlmacen = @idAlmacen,
numeroInventario = @numeroInventario,
FechaCierre = @FechaCierre,
FechaCreacion = @FechaCreacion,
FechaModificacion = @FechaModificacion,
idEstadoInventario = @idEstadoInventario,
idUsuario = @idUsuario,
idTipoInventario=@idTipoInventario
where idInventario = @idInventario
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idInventario,'farmInventario'
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioParaExportar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioParaExportar]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.farmInventario.*, dbo.farmAlmacen.codigoSISMED, dbo.farmAlmacen.descripcion AS almacen, dbo.farmAlmacen.idTipoSuministro
FROM         dbo.farmInventario INNER JOIN
                      dbo.farmAlmacen ON dbo.farmInventario.idAlmacen = dbo.farmAlmacen.idAlmacen
WHERE     (dbo.farmAlmacen.idEstado = 1) AND (dbo.farmAlmacen.idTipoLocales = 'F' OR
                      dbo.farmAlmacen.idTipoLocales = 'A') AND (NOT (dbo.farmInventario.FechaCierre IS NULL))
ORDER BY dbo.farmInventario.FechaCierre DESC
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioParaExportar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioSeleccionarPorId]
	@idInventario [int]
WITH EXECUTE AS CALLER
AS
select * from farmInventario
where idInventario = @idInventario
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmInventarioSeleccionarPorIdAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmInventarioSeleccionarPorIdAlmacen]
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
select * from farmInventario
where idAlmacen = @idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[farmInventarioSeleccionarPorIdAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmInventarioSeleccionarXdocumento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmInventarioSeleccionarXdocumento]
	@Documento [varchar](20),
	@lnIdAlmacenDestino [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmInventario.numeroInventario as movNumero,'' as movTipo, dbo.farmInventarioDetalle.idProducto, dbo.farmInventarioDetalle.Lote,
                   dbo.farmInventarioDetalle.FechaVencimiento,0 as item, dbo.farmInventarioDetalle.Cantidad, dbo.farmInventarioDetalle.Precio,
                   dbo.farmInventarioDetalle.Precio * dbo.farmInventarioDetalle.Cantidad AS total,dbo.farmInventarioDetalle.RegistroSanitario , dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
            FROM         dbo.farmInventarioDetalle LEFT OUTER JOIN
                   dbo.farmInventario ON dbo.farmInventarioDetalle.idInventario = dbo.farmInventario.idInventario LEFT OUTER JOIN
                   dbo.FactCatalogoBienesInsumos ON dbo.farmInventarioDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
            WHERE dbo.farmInventario.numeroInventario=@Documento and idAlmacen=@lnIdAlmacenDestino
            ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmInventarioSeleccionarXdocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmInventarioSeleccionarXdocumentoGeneral]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmInventarioSeleccionarXdocumentoGeneral]
	@Documento [varchar](20),
	@lnIdAlmacenDestino [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmInventario.numeroInventario AS movNumero, '' AS movTipo, dbo.farmInventarioDetalle.idProducto, dbo.farmInventarioDetalle.Lote,
                      dbo.farmInventarioDetalle.FechaVencimiento, 0 AS item, dbo.farmInventarioDetalle.Cantidad, dbo.farmInventarioDetalle.Precio,
                      dbo.farmInventarioDetalle.Precio * dbo.farmInventarioDetalle.Cantidad AS total, dbo.farmInventarioDetalle.RegistroSanitario,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.FactCatalogoBienesInsumos.Presentacion,
                      dbo.farmInventario.idAlmacen,(dbo.farmInventarioDetalle.Cantidad * dbo.farmInventarioDetalle.Precio) as Totalactual, dbo.farmInventarioDetalle.CantidadSaldo, dbo.farmInventarioDetalle.CantidadFaltante,
                      dbo.farmInventarioDetalle.CantidadSobrante,  dbo.FactCatalogoBienesInsumos.FormaFarmaceutica
FROM         dbo.farmInventarioDetalle LEFT OUTER JOIN
                      dbo.farmInventario ON dbo.farmInventarioDetalle.idInventario = dbo.farmInventario.idInventario LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmInventarioDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
            WHERE dbo.farmInventario.numeroInventario=@Documento and idAlmacen=@lnIdAlmacenDestino
            ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmInventarioSeleccionarXdocumentoGeneral] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoActualizarIdUsuarioPorMovTipoS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoActualizarIdUsuarioPorMovTipoS]
	@IdMovimiento [int],
	@MovNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
update farmMovimiento set idUsuario=@IdMovimiento
Where MovNumero=@MovNumero and movTipo='S'
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoActualizarIdUsuarioPorMovTipoS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idAlmacenOrigen [int],
	@idAlmacenDestino [int],
	@idTipoConcepto [int],
	@DocumentoIdtipo [int],
	@DocumentoNumero [varchar](20),
	@Observaciones [varchar](100),
	@Total [money],
	@idMotivoAnulacion [int],
	@fechaAnulacion [datetime],
	@idUsuarioAnulacion [int],
	@fechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoMovimiento [int],
	@IdUsuarioAuditoria [int],
	@DocExterno [varchar](20)
WITH EXECUTE AS CALLER
AS
insert into farmMovimiento (
MovNumero,MovTipo,idAlmacenOrigen,idAlmacenDestino,idTipoConcepto,DocumentoIdtipo,DocumentoNumero,Observaciones,Total,idMotivoAnulacion,fechaAnulacion,idUsuarioAnulacion,fechaCreacion,idUsuario,idEstadoMovimiento,DocExterno) values (
@MovNumero,@MovTipo,@idAlmacenOrigen,@idAlmacenDestino,@idTipoConcepto,@DocumentoIdtipo,@DocumentoNumero,@Observaciones,@Total,@idMotivoAnulacion,@fechaAnulacion,@idUsuarioAnulacion,@fechaCreacion,@idUsuario,@idEstadoMovimiento,@DocExterno)
declare @TablaMovimiento varchar(30)
--set @TablaMovimiento='farmMovimiento/'+@movTipo+'/'+@movNumero
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',0,@TablaMovimiento

---- RHA 12/01/2021 CAMBIO 50 FIN
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleActualizaEspaciosDeCadaLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleActualizaEspaciosDeCadaLote]
WITH EXECUTE AS CALLER
AS
update FarmMovimientoDetalle set lote=left(lote+space(15),15) where len(lote)<>15
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleActualizaEspaciosDeCadaLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@Item [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@RegistroSanitario [varchar](50),
	@idTipoSalidaBienInsumo [int],
	@DocumentoNumero [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmMovimientoDetalle (
MovNumero,MovTipo,idProducto,Lote,FechaVencimiento,Item,Cantidad,Precio,Total,RegistroSanitario,idTipoSalidaBienInsumo,DocumentoNumero)
values
(
@MovNumero,@MovTipo,@idProducto,@Lote,@FechaVencimiento,@Item,@Cantidad,@Precio,@Total,@RegistroSanitario,@idTipoSalidaBienInsumo,@DocumentoNumero)
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@MovNumero,'farmMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleDevuelveSaldosConLotesSegunAlmacenCliente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleDevuelveSaldosConLotesSegunAlmacenCliente]
	@lnIdAlmacen [int],
	@lnOrden [int],
	@lcFiltro [varchar](100)
WITH EXECUTE AS CALLER
AS
declare @lcFiltrado varchar(100)
    set @lcFiltrado = @lcFiltro + '%'

    If @lnOrden = 1         /*'--Ordenado y buscado por Nombre del Producto*/
       If @lcFiltro = ''
            SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
                                          dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
                                          dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio , dbo.farmSaldoDetallado.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
                     FROM         dbo.farmSaldoDetallado LEFT OUTER JOIN
                                          dbo.farmTipoSalidaBienInsumo ON
                                          dbo.farmSaldoDetallado.idTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo LEFT OUTER JOIN
                                          dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                     where dbo.farmSaldoDetallado.IdAlmacen = @lnIdAlmacen
                            and    (select top 1    dbo.FarmSaldo.cantidad from dbo.FarmSaldo where dbo.FarmSaldo.idAlmacen=dbo.farmSaldoDetallado.idAlmacen and
                                      dbo.farmSaldo.idProducto=dbo.farmSaldoDetallado.idProducto and dbo.FarmSaldo.idTipoSalidaBienInsumo=dbo.farmSaldoDetallado.idTipoSalidaBienInsumo ) >0
                     order by  dbo.FactCatalogoBienesInsumos.Nombre
        Else
            SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
                                          dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
                                          dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio, dbo.farmSaldoDetallado.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
                     FROM         dbo.farmSaldoDetallado LEFT OUTER JOIN
                                          dbo.farmTipoSalidaBienInsumo ON
                                          dbo.farmSaldoDetallado.idTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo LEFT OUTER JOIN
                                          dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                     where dbo.farmSaldoDetallado.IdAlmacen = @lnIdAlmacen  and  dbo.farmSaldoDetallado.Cantidad>0  and dbo.FactCatalogoBienesInsumos.Nombre like @lcFiltrado
                            and    (select top 1    dbo.FarmSaldo.cantidad from dbo.FarmSaldo where dbo.FarmSaldo.idAlmacen=dbo.farmSaldoDetallado.idAlmacen and
                                      dbo.farmSaldo.idProducto=dbo.farmSaldoDetallado.idProducto and dbo.FarmSaldo.idTipoSalidaBienInsumo=dbo.farmSaldoDetallado.idTipoSalidaBienInsumo ) >0
                     order by  dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmSaldoDetallado.FechaVencimiento

    Else       /*'--Ordenado y buscado por Codigo del Producto*/
        If @lcFiltro = ''
            SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
                                          dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
                                          dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio, dbo.farmSaldoDetallado.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
                     FROM         dbo.farmSaldoDetallado LEFT OUTER JOIN
                                          dbo.farmTipoSalidaBienInsumo ON
                                          dbo.farmSaldoDetallado.idTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo LEFT OUTER JOIN
                                          dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                     where dbo.farmSaldoDetallado.IdAlmacen = @lnIdAlmacen
                            and    (select top 1    dbo.FarmSaldo.cantidad from dbo.FarmSaldo where dbo.FarmSaldo.idAlmacen=dbo.farmSaldoDetallado.idAlmacen and
                           dbo.farmSaldo.idProducto=dbo.farmSaldoDetallado.idProducto and dbo.FarmSaldo.idTipoSalidaBienInsumo=dbo.farmSaldoDetallado.idTipoSalidaBienInsumo ) >0
                     order by  dbo.FactCatalogoBienesInsumos.Codigo
        Else
            SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmTipoSalidaBienInsumo.tipo, dbo.farmSaldoDetallado.Lote,
                                          dbo.farmSaldoDetallado.FechaVencimiento, dbo.farmSaldoDetallado.Cantidad AS Saldo, dbo.farmSaldoDetallado.idAlmacen,
                                          dbo.farmSaldoDetallado.idProducto, dbo.farmSaldoDetallado.Precio, dbo.farmSaldoDetallado.idTipoSalidaBienInsumo as idTipoSalidaBienInsumoSaldo
                     FROM         dbo.farmSaldoDetallado LEFT OUTER JOIN
                                          dbo.farmTipoSalidaBienInsumo ON
                                          dbo.farmSaldoDetallado.idTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo LEFT OUTER JOIN
                                          dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoDetallado.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                     where dbo.farmSaldoDetallado.IdAlmacen = @lnIdAlmacen  and dbo.FactCatalogoBienesInsumos.Codigo=@lcFiltro  and dbo.farmSaldoDetallado.Cantidad>0
                            and    (select top 1    dbo.FarmSaldo.cantidad from dbo.FarmSaldo where dbo.FarmSaldo.idAlmacen=dbo.farmSaldoDetallado.idAlmacen and
                            dbo.farmSaldo.idProducto=dbo.farmSaldoDetallado.idProducto and dbo.FarmSaldo.idTipoSalidaBienInsumo=dbo.farmSaldoDetallado.idTipoSalidaBienInsumo ) >0
                     order by  dbo.farmSaldoDetallado.FechaVencimiento
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleDevuelveSaldosConLotesSegunAlmacenCliente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleDevuelveSalidasSegunAlmacenProductoLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleDevuelveSalidasSegunAlmacenProductoLote]
	@idAlmacen [int],
	@idProducto [int],
	@lote [varchar](15),
	@fechaVencimiento [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimiento.movNumero,

                  dbo.farmMovimientoDetalle.*

FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN

                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND

                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo

where dbo.farmMovimiento.idAlmacenOrigen =@idAlmacen   and dbo.farmMovimientoDetalle.idProducto=@idProducto  and dbo.farmMovimientoDetalle.lote=@lote

          and dbo.farmMovimientoDetalle.fechaVencimiento=@fechaVencimiento and dbo.farmMovimiento.idEstadoMovimiento=1 and dbo.farmMovimiento.movTipo='S'
--SCCQ 29/10/2020 Cambio32 Inicio
 order by fechaCreacion desc
--SCCQ 29/10/2020 Cambio32 Fin
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleDevuelveSalidasSegunAlmacenProductoLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleEliminar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@lote [varchar](15),
	@FechaVencimiento [datetime],
	@idTipoSalidaBienInsumo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimientoDetalle
where MovNumero = @MovNumero and MovTipo=@MovTipo and idProducto=@idProducto and lote=@lote and FechaVencimiento=@FechaVencimiento and idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleFactCatalogoBienesInsumosSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleFactCatalogoBienesInsumosSeleccionarPorCodigo]
	@Codigo [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT   dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                     dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo,
                     dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.fechaCreacion,
                     dbo.farmMovimientoVentas.idCuentaAtencion , dbo.Atenciones.IdFormaPago, dbo.FactCatalogoBienesInsumos.Codigo,
                     dbo.farmMovimientoDetalle.Precio
FROM         dbo.farmMovimientoDetalle INNER JOIN
                     dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
                     dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo INNER JOIN
                     dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                     dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
                     dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                     dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     (dbo.Atenciones.IdFormaPago <> 1) AND (dbo.farmMovimientoVentas.idCuentaAtencion > 0) AND (dbo.farmMovimientoDetalle.MovTipo = 'S')
          and dbo.FactCatalogoBienesInsumos.Codigo=@Codigo
ORDER BY dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleFactCatalogoBienesInsumosSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleFarmMovimientoSeleccionarMovTipoS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleFarmMovimientoSeleccionarMovTipoS]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimiento.idTipoConcepto, dbo.FactCatalogoBienesInsumos.Codigo,
                     dbo.FactCatalogoBienesInsumos.Nombre
FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                     dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto LEFT OUTER JOIN
                     dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
                     dbo.farmMovimientoDetalle.movTipo = dbo.farmMovimiento.movTipo
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.farmMovimiento.MovTipo = 'S')
GROUP BY dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimientoDetalle.idProducto, dbo.FactCatalogoBienesInsumos.Codigo,
                     dbo.FactCatalogoBienesInsumos.Nombre
ORDER BY dbo.farmMovimientoDetalle.idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleFarmMovimientoSeleccionarMovTipoS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@Lote [varchar](15),
	@FechaVencimiento [datetime],
	@Item [int],
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@RegistroSanitario [varchar](50),
	@idTipoSalidaBienInsumo [int],
	@DocumentoNumero [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoDetalle
set
MovTipo = @MovTipo,
idProducto = @idProducto,
Lote = @Lote,
FechaVencimiento = @FechaVencimiento,
Item = @Item,
Cantidad = @Cantidad,
Precio = @Precio,
Total = @Total,
RegistroSanitario = @RegistroSanitario,
idTipoSalidaBienInsumo=@idTipoSalidaBienInsumo,
DocumentoNumero=@DocumentoNumero
where MovNumero = @MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmacen]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoConcepto [int],
	@idAlmacenDestino [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimientoDetalle.Total,
	      dbo.farmMovimientoDetalle.Cantidad,dbo.farmMovimientoDetalle.precio
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
                    and  dbo.farmMovimiento.idTipoConcepto= @idTipoConcepto and dbo.farmMovimiento.idAlmacenDestino=@idAlmacenDestino
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmOrigen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmOrigen]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenOrigen [int],
	@idTipoConcepto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimientoDetalle.Total,
	      dbo.farmMovimientoDetalle.Cantidad,dbo.farmMovimientoDetalle.precio
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
                    and  dbo.farmMovimiento.idTipoConcepto= @idTipoConcepto and dbo.farmMovimiento.idAlmacenOrigen=@idAlmacenOrigen
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleSeleccionaPorFechasTipoConceptoAlmOrigen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleSeleccionarDevolucionesPorTipoConceptoAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleSeleccionarDevolucionesPorTipoConceptoAlmacen]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenDestino [int],
	@idTipoConcepto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoNotaIngreso.idCuentaAtencion, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago,
                      dbo.farmMovimiento.idTipoConcepto, dbo.TiposFinanciamiento.Descripcion,dbo.farmMovimiento.movNumero
FROM         dbo.TiposFinanciamiento INNER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoNotaIngreso.idCuentaAtencion RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE      dbo.farmMovimiento.idEstadoMovimiento=1 and
                  (dbo.farmMovimiento.fechaCreacion Between @FechaInicio and @FechaFin)   and dbo.farmMovimiento.idAlmacenDestino=@idAlmacenDestino and
                 dbo.farmMovimiento.idTipoConcepto=@idTipoConcepto
ORDER BY dbo.Atenciones.IdFormaPago
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleSeleccionarDevolucionesPorTipoConceptoAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleSeleccionarPorId]
	@MovNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoDetalle
where MovNumero = @MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleSeleccionarPorMovNumeroTipo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleSeleccionarPorMovNumeroTipo]
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Nombre,dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.farmMovimientoDetalle.*
FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where dbo.farmMovimientoDetalle.movNumero=@movNumero and dbo.farmMovimientoDetalle.movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleSeleccionarPorMovNumeroTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleSeleccionarSalidasXitem]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleSeleccionarSalidasXitem]
	@MovNumeroS [varchar](50),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoDetalle where MovTipo='S' and MovNumero=@MovNumeroS and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleSeleccionarSalidasXitem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDetalleSeleccionarXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDetalleSeleccionarXcodigo]
	@codigo [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoDetalle.IdTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumos.IdProducto, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.idTipoConcepto,
                      dbo.farmMovimiento.idEstadoMovimiento,dbo.farmMovimiento.MovNumero
FROM         dbo.farmMovimientoDetalle INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoDetalle.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoDetalle.MovTipo = dbo.farmMovimiento.MovTipo
where dbo.FactCatalogoBienesInsumos.Codigo=@codigo
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDetalleSeleccionarXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoDetalleSumaTotales]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoDetalleSumaTotales]
	@ldFechaInicial [datetime],
	@ldFechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoDetalle.MovNumero, SUM(dbo.farmMovimientoDetalle.Total) AS totalDetalle, dbo.farmMovimiento.fechaCreacion,
                                  dbo.farmMovimiento.DocumentoIdtipo
             FROM         dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
             WHERE     (dbo.farmMovimientoDetalle.MovTipo = 'S') AND (dbo.farmMovimiento.DocumentoIdtipo = 26) and dbo.farmMovimiento.idEstadoMovimiento=1
                       and  dbo.farmMovimiento.fechaCreacion between @ldFechaInicial and @ldFechaFinal
             GROUP BY dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.DocumentoIdtipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoDetalleSumaTotales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDevolucionesSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDevolucionesSeleccionarPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.DocumentoNumero AS Guia, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.Total, dbo.farmEstadosMovimientos.Estado, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,  dbo.FarmMovimientoDonaciones.idCuentaAtencion,dbo.farmMovimiento.IdEstadoMovimiento
FROM         dbo.farmMovimiento LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento FULL OUTER JOIN
                      dbo.FacturacionCuentasAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente RIGHT OUTER JOIN
                      dbo.FarmMovimientoDonaciones ON dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.FarmMovimientoDonaciones.idCuentaAtencion ON
                      dbo.farmMovimiento.MovNumero = dbo.FarmMovimientoDonaciones.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.FarmMovimientoDonaciones.movTipo
where (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin) and  dbo.farmMovimiento.MovTipo='S' and
          dbo.farmMovimiento.idtipoconcepto=27   and dbo.farmMovimiento.idalmacenOrigen=@idAlmacen
order by  dbo.farmMovimiento.fechaCreacion desc,   dbo.farmMovimiento.movNumero desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDevolucionesSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDonacionesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDonacionesAgregar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@idCuentaAtencion [int],
	@idPrescriptorReceta [int],
	@idCoordinadorServicioSocial [int],
	@idDiagnostico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FarmMovimientoDonaciones (
movNumero,movTipo,idCuentaAtencion,idPrescriptorReceta,idCoordinadorServicioSocial,idDiagnostico) values (
@movNumero,@movTipo,@idCuentaAtencion,@idPrescriptorReceta,@idCoordinadorServicioSocial,@idDiagnostico)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@movNumero,'FarmMovimientoDonaciones'
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDonacionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDonacionesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDonacionesEliminar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FarmMovimientoDonaciones
where movNumero = @movNumero and movTipo=@movTipo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@movNumero,'FarmMovimientoDonaciones'
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDonacionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDonacionesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDonacionesModificar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@idCuentaAtencion [int],
	@idPrescriptorReceta [int],
	@idCoordinadorServicioSocial [int],
	@idDiagnostico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FarmMovimientoDonaciones
set
idCuentaAtencion = @idCuentaAtencion,
idPrescriptorReceta = @idPrescriptorReceta,
idCoordinadorServicioSocial = @idCoordinadorServicioSocial,
idDiagnostico = @idDiagnostico
where movNumero = @movNumero and movTipo=@movTipo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@movNumero,'FarmMovimientoDonaciones'
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDonacionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoDonacionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoDonacionesSeleccionarPorId]
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from FarmMovimientoDonaciones
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoDonacionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoEliminar]
	@MovNumero [varchar](9),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimiento
where MovNumero = @MovNumero
declare @TablaMovimiento varchar(30)
--set @TablaMovimiento='farmMovimiento/'+@movNumero
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',0,@TablaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoFiltraPorFechasYtipoConcepto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoFiltraPorFechasYtipoConcepto]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime],
	@idTipoConcepto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.*
FROM         dbo.farmMovimiento
where  idTipoConcepto=@idTipoConcepto and (fechaCreacion Between  @FechaEgrIni and  @FechaEgrFin)  and idEstadoMovimiento=1
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoFiltraPorFechasYtipoConcepto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoFiltraPorMovNumeroTipo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoFiltraPorMovNumeroTipo]
	@MovTipo [varchar](1),
	@MovNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, farmAlmacen_1.descripcion AS FDestino,
	                      farmAlmacen_2.descripcion AS fOrigen, dbo.farmTipoDocumentos.Abreviatura, dbo.farmMovimiento.DocumentoNumero,
	                      dbo.farmMovimiento.fechaCreacion, dbo.farmEstadosMovimientos.Estado, dbo.farmTipoConceptos.Concepto, dbo.farmMovimiento.Total,dbo.farmMovimiento.IdEstadoMovimiento,
		    dbo.farmMovimiento.IdTipoConcepto,dbo.farmMovimiento.idAlmacenOrigen,dbo.farmMovimiento.idAlmacenDestino
	FROM         dbo.farmMovimiento LEFT OUTER JOIN
	                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
	                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto LEFT OUTER JOIN
	                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenDestino = farmAlmacen_1.idAlmacen LEFT OUTER JOIN
	                      dbo.farmAlmacen farmAlmacen_2 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_2.idAlmacen
	WHERE     (dbo.farmMovimiento.MovTipo=@MovTipo) and  (dbo.farmMovimiento.MovNumero=@MovNumero)
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoFiltraPorMovNumeroTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoFiltrarIntervSanitaria]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoFiltrarIntervSanitaria]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT       DocumentoNumero,idAlmacenOrigen
           From farmMovimiento
            WHERE  (MovTipo = 'S') AND (idTipoConcepto = 16) and
                            (idEstadoMovimiento=1) and (fechaCreacion Between (CONVERT(DATETIME,@FechaInicio,103))
                            and (CONVERT(DATETIME,@FechaFin,103)))

GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoFiltrarIntervSanitaria] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoFiltrarXfechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoFiltrarXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT                       dbo.farmMovimiento.fechaCreacion, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                           dbo.farmMovimientoVentas.IdServicioPaciente ,dbo.farmMovimiento.MovTipo ,dbo.farmMovimiento.idAlmacenOrigen,dbo.farmMovimiento.DocumentoNumero
               FROM            dbo.farmMovimiento INNER JOIN
                                     dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                     dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.MovTipo
               Where dbo.farmMovimiento.idEstadoMovimiento=1 and
                          (dbo.farmMovimiento.fechaCreacion Between (CONVERT(DATETIME,@FechaInicio,103))
                          and (CONVERT(DATETIME,@FechaFin,103)))

GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoFiltrarXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idAlmacenOrigen [int],
	@idAlmacenDestino [int],
	@idTipoConcepto [int],
	@DocumentoIdtipo [int],
	@DocumentoNumero [varchar](20),
	@Observaciones [varchar](100),
	@Total [money],
	@idMotivoAnulacion [int],
	@fechaAnulacion [datetime],
	@idUsuarioAnulacion [int],
	@fechaCreacion [datetime],
	@idUsuario [int],
	@idEstadoMovimiento [int],
	@IdUsuarioAuditoria [int],
	@DocExterno [varchar](20)
WITH EXECUTE AS CALLER
AS
update farmMovimiento
set
MovTipo = @MovTipo,
idAlmacenOrigen = @idAlmacenOrigen,
idAlmacenDestino = @idAlmacenDestino,
idTipoConcepto = @idTipoConcepto,
DocumentoIdtipo = @DocumentoIdtipo,
DocumentoNumero = @DocumentoNumero,
Observaciones = @Observaciones,
Total = @Total,
idMotivoAnulacion = @idMotivoAnulacion,
fechaAnulacion = @fechaAnulacion,
idUsuarioAnulacion = @idUsuarioAnulacion,
fechaCreacion = @fechaCreacion,
idUsuario = @idUsuario,
idEstadoMovimiento = @idEstadoMovimiento,
DocExterno =@DocExterno
where MovNumero = @MovNumero and MovTipo=@MovTipo
--declare @TablaMovimiento varchar(30)
--set @TablaMovimiento='farmMovimiento/'+@movTipo+'/'+@movNumero
--if @idEstadoMovimiento=1
--   begin
 --  exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
 --  end
--else
--   begin
--   exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',0,@TablaMovimiento
--   end
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoModificarTotal]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoModificarTotal]
	@Total [money],
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
update FarmMovimiento set total=@Total where movNumero=@MovNumero and movTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoModificarTotal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoNotaIngresoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoNotaIngresoAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@DocumentoFechaRecepcion [datetime],
	@OrigenIdTipo [int],
	@OrigenNumero [varchar](20),
	@OrigenFecha [datetime],
	@idProveedor [int],
	@idTipoCompra [int],
	@idTipoProceso [int],
	@NumeroProceso [varchar](50),
	@idPaciente [int],
	@idCuentaAtencion [int],
	@idFuenteFinanciamiento [int],
	@idComprobantePago [int],
	@FechaModificacion [datetime],
	@idUsuarioModifica [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmMovimientoNotaIngreso (
MovNumero,MovTipo,DocumentoFechaRecepcion,OrigenIdTipo,OrigenNumero,OrigenFecha,idProveedor,idTipoCompra,idTipoProceso,NumeroProceso,idPaciente,idCuentaAtencion,idComprobantePago,FechaModificacion,idUsuarioModifica,idFuenteFinanciamiento) values (
@MovNumero,@MovTipo,@DocumentoFechaRecepcion,@OrigenIdTipo,@OrigenNumero,@OrigenFecha,@idProveedor,@idTipoCompra,@idTipoProceso,@NumeroProceso,@idPaciente,@idCuentaAtencion,@idComprobantePago,@FechaModificacion,@idUsuarioModifica,@idFuenteFinanciamiento)
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngresoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoNotaIngresoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoNotaIngresoEliminar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimientoNotaIngreso
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngresoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoNotaIngresoFiltraFuentesFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoNotaIngresoFiltraFuentesFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoConcepto [int],
	@idAlmacenDestino [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.Total, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoNotaIngreso.idCuentaAtencion, dbo.farmMovimientoNotaIngreso.idPaciente,
                      dbo.FuentesFinanciamiento.Descripcion, dbo.farmMovimiento.idTipoConcepto, dbo.Atenciones.idFuenteFinanciamiento AS IdFteAtenciones,
                      dbo.farmMovimientoNotaIngreso.idFuenteFinanciamiento
FROM         dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento RIGHT OUTER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoNotaIngreso.idCuentaAtencion
WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
                    and  dbo.farmMovimiento.idTipoConcepto= @idTipoConcepto and dbo.farmMovimiento.idAlmacenDestino=@idAlmacenDestino
ORDER BY dbo.farmMovimientoNotaIngreso.idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoNotaIngresoFiltraFuentesFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoNotaIngresoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoNotaIngresoModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@DocumentoFechaRecepcion [datetime],
	@OrigenIdTipo [int],
	@OrigenNumero [varchar](20),
	@OrigenFecha [datetime],
	@idProveedor [int],
	@idTipoCompra [int],
	@idTipoProceso [int],
	@NumeroProceso [varchar](50),
	@idPaciente [int],
	@idCuentaAtencion [int],
	@idComprobantePago [int],
	@idFuenteFinanciamiento [int],
	@FechaModificacion [datetime],
	@idUsuarioModifica [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoNotaIngreso
set
MovTipo = @MovTipo,
DocumentoFechaRecepcion = @DocumentoFechaRecepcion,
OrigenIdTipo = @OrigenIdTipo,
OrigenNumero = @OrigenNumero,
OrigenFecha = @OrigenFecha,
idProveedor = @idProveedor,
idTipoCompra = @idTipoCompra,
idTipoProceso = @idTipoProceso,
NumeroProceso = @NumeroProceso,
idPaciente = @idPaciente,
idCuentaAtencion=@idCuentaAtencion,
idComprobantePago=@idComprobantePago,
idFuenteFinanciamiento=@idFuenteFinanciamiento,
FechaModificacion = @FechaModificacion,
idUsuarioModifica = @idUsuarioModifica
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngresoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoNotaIngresoSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoNotaIngresoSeleccionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimientoNotaIngreso.MovNumero,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.descripcion as dAlmacen,
                      dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFinanciamiento, dbo.Empleados.Usuario,dbo.farmMovimiento.idTipoConcepto,
                       dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.documentoNumero
FROM         dbo.Empleados RIGHT OUTER JOIN
                      dbo.farmAlmacen INNER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino ON
                       dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario LEFT OUTER JOIN
                      dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago ON
                      dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE       dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoNotaIngresoSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoNotaIngresoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoNotaIngresoSeleccionarPorId]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoNotaIngreso
where MovNumero = @MovNumero and MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngresoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoNotaIngresoSeleccionarXmovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoNotaIngresoSeleccionarXmovimiento]
	@movnumero [varchar](9),
	@movtipo [varchar](1)
WITH EXECUTE AS CALLER
AS
BEGIN
SELECT     dbo.farmMovimientoNotaIngreso.MovNumero, dbo.farmMovimientoNotaIngreso.MovTipo, dbo.farmTipoDocumentos.Abreviatura,
                      dbo.farmMovimientoNotaIngreso.OrigenNumero
FROM         dbo.farmMovimientoNotaIngreso LEFT OUTER JOIN
                      dbo.farmTipoDocumentos ON dbo.farmMovimientoNotaIngreso.OrigenIdTipo = dbo.farmTipoDocumentos.idTipoDocumento
where dbo.farmMovimientoNotaIngreso.MovNumero=@movnumero and  dbo.farmMovimientoNotaIngreso.MovTipo=@movtipo
END
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoNotaIngresoSeleccionarXmovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoProgramasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoProgramasAgregar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@idCoordinador [int],
	@idPrescriptor [char](10),
	@idDiagnostico [int],
	@idPaciente [int],
	@idComponente [int],
	@idSubComponente [int],
	@FechaHoraPrescribe [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmMovimientoProgramas (
movNumero,movTipo,idCoordinador,idPrescriptor,idDiagnostico,idPaciente,idComponente,idSubComponente,FechaHoraPrescribe) values (
@movNumero,@movTipo,@idCoordinador,@idPrescriptor,@idDiagnostico,@idPaciente,@idComponente,@idSubComponente,@FechaHoraPrescribe)
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoProgramasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoProgramasEliminar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimientoProgramas
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoProgramasFarmAlmacenSeleccionarMovNumeroNULL]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoProgramasFarmAlmacenSeleccionarMovNumeroNULL]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoProgramas.movNumero, dbo.farmMovimientoProgramas.movTipo, dbo.farmMovimiento.fechaCreacion,
                     dbo.farmMovimientoDetalle.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                     dbo.farmMovimiento.idAlmacenOrigen , dbo.FarmAlmacen.Descripcion
FROM         dbo.farmAlmacen RIGHT OUTER JOIN
                     dbo.farmMovimientoProgramas INNER JOIN
                     dbo.farmMovimiento ON dbo.farmMovimientoProgramas.movNumero = dbo.farmMovimiento.MovNumero AND
                     dbo.farmMovimientoProgramas.movTipo = dbo.farmMovimiento.MovTipo ON
                     dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenOrigen RIGHT OUTER JOIN
                     dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                     dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                     dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                     dbo.farmMovimiento.movTipo = dbo.farmMovimientoDetalle.movTipo
Where (dbo.farmMovimientoProgramas.movNumero Is Not Null)
ORDER BY dbo.farmAlmacen.descripcion, dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoProgramasFarmAlmacenSeleccionarMovNumeroNULL] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoProgramasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoProgramasModificar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@idCoordinador [int],
	@idPrescriptor [char](10),
	@idDiagnostico [int],
	@idPaciente [int],
	@idComponente [int],
	@idSubComponente [int],
	@FechaHoraPrescribe [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoProgramas
set
movTipo = @movTipo,
idCoordinador = @idCoordinador,
idPrescriptor = @idPrescriptor,
idDiagnostico = @idDiagnostico,
idPaciente = @idPaciente,
idComponente = @idComponente,
idSubComponente = @idSubComponente,
FechaHoraPrescribe=@FechaHoraPrescribe
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoProgramasSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoProgramasSeleccionarPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.DocumentoNumero as Guia, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.Total,
                      dbo.farmEstadosMovimientos.Estado, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,
                      dbo.Pacientes.PrimerNombre,dbo.farmMovimiento.IdEstadoMovimiento
FROM         dbo.farmMovimientoProgramas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoProgramas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoProgramas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.farmMovimientoProgramas.idPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento
where (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin) and  dbo.farmMovimiento.MovTipo='S' and
          dbo.farmMovimiento.idtipoconcepto=16   and dbo.farmMovimiento.idalmacenOrigen=@idAlmacen
order by  dbo.farmMovimiento.fechaCreacion desc,   dbo.farmMovimiento.movNumero desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoProgramasSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoProgramasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoProgramasSeleccionarPorId]
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoProgramas
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoProgramasXpaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoProgramasXpaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, LTRIM(dbo.FactCatalogoBienesInsumos.Codigo) + ' ' + dbo.FactCatalogoBienesInsumos.Nombre AS item,
                                  LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS especialista,
                                  dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoProgramas.idPaciente,
                                  dbo.farmComponenteSub.Descripcion
             FROM         dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo INNER JOIN
                                  dbo.farmMovimientoProgramas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoProgramas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoProgramas.movTipo LEFT OUTER JOIN
                                 dbo.Empleados ON dbo.farmMovimientoProgramas.idCoordinador = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                                  dbo.farmComponenteSub ON dbo.farmMovimientoProgramas.idSubComponente = dbo.farmComponenteSub.idSubComponente LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             Where (dbo.farmMovimiento.idEstadoMovimiento = 1) And (dbo.farmComponenteSub.Descripcion Is Not Null) and dbo.farmMovimientoProgramas.idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoProgramasXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientosDetalleDevuelveTodosItems]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientosDetalleDevuelveTodosItems]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                      dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Item,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total,
                      dbo.farmMovimientoDetalle.RegistroSanitario, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo,
                      dbo.FactCatalogoBienesInsumos.formaFarmaceutica,dbo.FactCatalogoBienesInsumos.esPaquete,
                      dbo.farmMovimientoDetalle.DocumentoNumero
FROM         dbo.farmMovimientoDetalle LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where    dbo.farmMovimientoDetalle.MovNumero=@MovNumero and  dbo.farmMovimientoDetalle.MovTipo=@MovTipo
ORDER BY dbo.farmMovimientoDetalle.Item
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientosDetalleDevuelveTodosItems] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientosDetalleDevuelveTodosItemsSOPORTE]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientosDetalleDevuelveTodosItemsSOPORTE]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT       left(dbo.farmTipoProductosSismed.Descripcion,7) AS movNumero,'',dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimientoDetalle.Lote,
                      dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Item, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmMovimientoDetalle.RegistroSanitario,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, '',dbo.FactCatalogoBienesInsumos.formaFarmaceutica
FROM         dbo.farmTipoProductosSismed INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON
                      dbo.farmTipoProductosSismed.TipoProductoSismed = dbo.FactCatalogoBienesInsumos.TipoProductoSismed RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto
where    dbo.farmMovimientoDetalle.MovNumero=@MovNumero and  dbo.farmMovimientoDetalle.MovTipo=@MovTipo
ORDER BY dbo.farmMovimientoDetalle.Item
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientosDetalleDevuelveTodosItemsSOPORTE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoSeleccionarPorFechasCabecera]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoSeleccionarPorFechasCabecera]
	@FechaInicial [varchar](50),
	@HoraInicial [varchar](50),
	@FechaFinal [varchar](50),
	@HoraFinal [varchar](50),
	@TodasFarmacias [int],
	@IdAlmacen [int]
WITH EXECUTE AS CALLER
AS
If @TodasFarmacias = 0

SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.DocumentoIdtipo, dbo.farmMovimiento.DocumentoNumero,
                                  dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmTipoDocumentos.Nombre, dbo.farmTipoDocumentos.Abreviatura,
                                  dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idAlmacenDestino, dbo.farmAlmacen.descripcion, dbo.farmAlmacen.idTipoLocales,
                                  dbo.farmAlmacen.idTipoSuministro , dbo.farmAlmacen.idEstado
             FROM          dbo.farmMovimiento LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenDestino = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento
             WHERE      (dbo.farmAlmacen.idTipoLocales='F' or dbo.farmAlmacen.idTipoLocales='A') and (dbo.farmMovimiento.MovTipo = 'E') AND (dbo.farmMovimiento.DocumentoIdtipo = 3) AND (dbo.farmMovimiento.idEstadoMovimiento = 1)
                     and (dbo.farmMovimiento.FechaCreacion Between CONVERT(DATETIME,@FechaInicial +  ' ' + @HoraInicial  + ':00',103) and CONVERT(DATETIME,@FechaFinal + ' ' +  @HoraFinal +':59',103))
	        and dbo.farmMovimiento.idAlmacenDestino=@IdAlmacen
	ORDER BY dbo.farmMovimiento.fechaCreacion




Else

	  SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.DocumentoIdtipo, dbo.farmMovimiento.DocumentoNumero,
                                  dbo.farmMovimiento.Total, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmTipoDocumentos.Nombre, dbo.farmTipoDocumentos.Abreviatura,
                                  dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idAlmacenDestino, dbo.farmAlmacen.descripcion, dbo.farmAlmacen.idTipoLocales,
                                  dbo.farmAlmacen.idTipoSuministro , dbo.farmAlmacen.idEstado
             FROM          dbo.farmMovimiento LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenDestino = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento
             WHERE      (dbo.farmAlmacen.idTipoLocales='F' or dbo.farmAlmacen.idTipoLocales='A') and (dbo.farmMovimiento.MovTipo = 'E') AND (dbo.farmMovimiento.DocumentoIdtipo = 3) AND (dbo.farmMovimiento.idEstadoMovimiento = 1)
                                  and (dbo.farmMovimiento.FechaCreacion Between CONVERT(DATETIME,@FechaInicial +  ' '+ @HoraInicial +':00',103) and CONVERT(DATETIME,@FechaFinal + ' ' +  @HoraFinal +':59',103))
	ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoSeleccionarPorFechasCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoSeleccionarPorId]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from farmMovimiento
where MovNumero = @MovNumero and MovTipo = @MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoSeleccionarPorIdAlmacenDestino]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoSeleccionarPorIdAlmacenDestino]
	@idAlmacenDestino [int]
WITH EXECUTE AS CALLER
AS
select * from dbo.FarmMovimiento where dbo.farmMovimiento.idAlmacenDestino=@idAlmacenDestino
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoSeleccionarPorIdAlmacenDestino] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoSeleccionarPorTipoYnumeroDocumento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoSeleccionarPorTipoYnumeroDocumento]
	@documentoNumero [varchar](20),
	@documentoIdTipo [int]
WITH EXECUTE AS CALLER
AS
select * from farmMovimiento
where documentoNumero = @documentoNumero and documentoIdTipo = @documentoIdTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoSeleccionarPorTipoYnumeroDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoSeleccionPorAlmacenProductosIngresados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoSeleccionPorAlmacenProductosIngresados]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenDestino [int],
	@idAlmacenOrigen [int]
WITH EXECUTE AS CALLER
AS
SELECT    CONVERT(VARCHAR,dbo.farmMovimiento.fechaCreacion,103) AS fechaCreacion, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,dbo.farmMovimientoDetalle.Cantidad,
		dbo.farmMovimientoDetalle.Cantidad * dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario as monto,dbo.farmMovimientoDetalle.Lote,dbo.farmTipoConceptos.Concepto,dbo.farmMovimientoDetalle.FechaVencimiento,
		dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idAlmacenOrigen,
                dbo.farmMovimientoNotaIngreso.idProveedor,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'COMPRA'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS COMPRA,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DONACION'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DONACION,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DISTRIBUCION'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DISTRIBUCION,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'TRANSFERENCIA OTRAS UE'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DISTRIBUCION_UE,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'AJUSTE INVENTARIO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS AJUST_INVT,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'INVENTARIO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS INVENTARIO,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'TRANSFERENCIAS ESTRATEGICOS'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS TRANSF_ESTRA,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION  del PACIENTE'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_del_PACIENTE,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X DETERIORO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_DETERIORO,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X SOBRESTOCK'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_SOBRESTOCK,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X VENCIMIENTO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_VENC


FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                      dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto INNER JOIN
                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto INNER JOIN
                      dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo
WHERE  CONVERT(VARCHAR,dbo.farmMovimiento.fechaCreacion,103) BETWEEN  @FechaInicio AND  @FechaFin AND
(dbo.farmMovimiento.idAlmacenDestino = @idAlmacenDestino) AND (dbo.farmMovimiento.idAlmacenOrigen = @idAlmacenOrigen) AND
(dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) AND (dbo.farmMovimiento.idEstadoMovimiento = 1)
ORDER BY dbo.farmMovimiento.fechaCreacion ASC
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoSeleccionPorAlmacenProductosIngresados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoSeleccionPorProveedorProductosIngresados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoSeleccionPorProveedorProductosIngresados]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenDestino [int],
	@idAlmacenOrigen [int],
	@idProveedor [int]
WITH EXECUTE AS CALLER
AS
SELECT    CONVERT(VARCHAR,dbo.farmMovimiento.fechaCreacion,103) AS fechaCreacion, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario,dbo.farmMovimientoDetalle.Cantidad,
		dbo.farmMovimientoDetalle.Cantidad * dbo.FactCatalogoBienesInsumosHosp.PrecioUnitario as monto,dbo.farmMovimientoDetalle.Lote,dbo.farmTipoConceptos.Concepto,dbo.farmMovimientoDetalle.FechaVencimiento,
		dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.idAlmacenOrigen,
                dbo.farmMovimientoNotaIngreso.idProveedor,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'COMPRA'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS COMPRA,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DONACION'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DONACION,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DISTRIBUCION'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DISTRIBUCION,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'TRANSFERENCIA OTRAS UE'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DISTRIBUCION_UE,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'AJUSTE INVENTARIO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS AJUST_INVT,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'INVENTARIO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS INVENTARIO,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'TRANSFERENCIAS ESTRATEGICOS'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS TRANSF_ESTRA,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION  del PACIENTE'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_del_PACIENTE,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X DETERIORO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_DETERIORO,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X SOBRESTOCK'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_SOBRESTOCK,
		CASE dbo.farmTipoConceptos.Concepto
		WHEN 'DEVOLUCION X VENCIMIENTO'	THEN dbo.farmMovimientoDetalle.Cantidad
		END AS DEV_X_VENC
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoDetalle ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto INNER JOIN
                      dbo.FactCatalogoBienesInsumosHosp ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FactCatalogoBienesInsumosHosp.IdProducto INNER JOIN
                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto INNER JOIN
                      dbo.farmMovimientoNotaIngreso ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoNotaIngreso.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoNotaIngreso.MovTipo
WHERE  CONVERT(VARCHAR,dbo.farmMovimiento.fechaCreacion,103) BETWEEN  @FechaInicio AND  @FechaFin AND
(dbo.farmMovimiento.idAlmacenDestino = @idAlmacenDestino) AND (dbo.farmMovimiento.idAlmacenOrigen = @idAlmacenOrigen) AND dbo.farmMovimientoNotaIngreso.idProveedor=@idProveedor AND
(dbo.FactCatalogoBienesInsumosHosp.IdTipoFinanciamiento = 1) AND (dbo.farmMovimiento.idEstadoMovimiento = 1)
ORDER BY dbo.farmMovimiento.fechaCreacion ASC
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoSeleccionPorProveedorProductosIngresados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientosVentasDetalleDevuelveTodosItems]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientosVentasDetalleDevuelveTodosItems]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo, dbo.FactCatalogoBienesInsumos.IdProducto, '' AS lote,
                      '' AS fechaVencimiento, 0 AS item, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.total, '' AS registroSanitario, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      0 AS idTipoSalidaBienInsumo, dbo.FactCatalogoBienesInsumos.FormaFarmaceutica
FROM         dbo.farmMovimientoVentasDetalle INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where    dbo.farmMovimientoVentasDetalle.MovNumero=@MovNumero and  dbo.farmMovimientoVentasDetalle.MovTipo=@MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientosVentasDetalleDevuelveTodosItems] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasAgregar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@tipoVenta [varchar](1),
	@idPreVenta [int],
	@idTipoFinanciamiento [int],
	@idPrescriptor [int],
	@idTipoReceta [int],
	@idDiagnostico [int],
	@idCuentaAtencion [int],
	@IdServicioPaciente [int],
	@idFuenteFinanciamiento [int],
	@idPaciente [int],
	@FechaHoraPrescribe [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmMovimientoVentas (
movNumero,movTipo,tipoVenta,idPreVenta,idTipoFinanciamiento,idPrescriptor,idTipoReceta,idDiagnostico,idCuentaAtencion,idPaciente,idFuenteFinanciamiento,IdServicioPaciente,FechaHoraPrescribe) values (
@movNumero,@movTipo,@tipoVenta,@idPreVenta,@idTipoFinanciamiento,@idPrescriptor,@idTipoReceta,@idDiagnostico,@idCuentaAtencion,@idPaciente,@idFuenteFinanciamiento,@IdServicioPaciente,@FechaHoraPrescribe)
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleActualizaCantidadPrecioTotal]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleActualizaCantidadPrecioTotal]
	@Cantidad [int],
	@Precio [money],
	@Total [money],
	@MovNumero [varchar](9),
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoVentasDetalle set cantidad=@Cantidad, precio=@Precio
, total=@Total where MovNumero=@MovNumero and idProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleActualizaCantidadPrecioTotal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleAgregar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@cantidad [int],
	@precio [money],
	@total [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmMovimientoVentasDetalle (
MovNumero,MovTipo,idProducto,cantidad,precio,total) values (
@MovNumero,@MovTipo,@idProducto,@cantidad,@precio,@total)
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@MovNumero,'farmMovimientoVentasDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleEliminar]
	@MovNumero [varchar](9),
	@movTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimientoVentasDetalle
where MovNumero = @MovNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleModificar]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int],
	@cantidad [int],
	@precio [money],
	@total [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoVentasDetalle
set
MovTipo = @MovTipo,
idProducto = @idProducto,
cantidad = @cantidad,
precio = @precio,
total = @total
where MovNumero = @MovNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorAlmacenFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorAlmacenFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenOrigen [int],
	@IdPagan [int]
WITH EXECUTE AS CALLER
AS
if @IdPagan=0
	SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimientoVentas.idFuenteFinanciamiento,
	                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentasDetalle.cantidad,
	                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimientoVentasDetalle.total,
	                      dbo.farmMovimientoVentas.idPreVenta, dbo.FuentesFinanciamiento.Descripcion
	FROM         dbo.farmMovimientoVentasDetalle INNER JOIN
	                      dbo.farmMovimiento INNER JOIN
	                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
	                      dbo.farmMovimientoVentasDetalle.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimientoVentasDetalle.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.farmMovimientoVentas.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
	                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen and dbo.farmMovimientoVentas.idPreVenta=null
		      and dbo.farmMovimientoVentas.idCuentaAtencion>0
	ORDER BY dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.MovNumero
else
	SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimientoVentas.idFuenteFinanciamiento,
	                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentasDetalle.cantidad,
	                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimientoVentasDetalle.total,
	                      dbo.farmMovimientoVentas.idPreVenta, dbo.FuentesFinanciamiento.Descripcion
	FROM         dbo.farmMovimientoVentasDetalle INNER JOIN
	                      dbo.farmMovimiento INNER JOIN
	                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
	                      dbo.farmMovimientoVentasDetalle.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimientoVentasDetalle.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento ON dbo.farmMovimientoVentas.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
	WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
	                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen and dbo.farmMovimientoVentas.idPreVenta>0
		     and dbo.farmMovimientoVentas.idCuentaAtencion>0
	ORDER BY dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorAlmacenFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.total, dbo.farmAlmacen.descripcion AS dalmacen, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.DocumentoNumero,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmEstadosMovimientos.Estado, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Empleados.Usuario, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimientoVentas.idServicioPaciente,dbo.FactCatalogoBienesInsumos.esPaquete ,
                     dbo.farmMovimiento.Observaciones
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuentaXMes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuentaXMes]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.total, dbo.farmAlmacen.descripcion AS dalmacen, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.DocumentoNumero,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmEstadosMovimientos.Estado, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Empleados.Usuario, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimientoVentas.idServicioPaciente,
			month(farmMovimiento.fechaCreacion) as mes,
			day(farmMovimiento.fechaCreacion) as dia
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion
		and dbo.farmMovimiento.idEstadoMovimiento=1
ORDER BY dbo.farmMovimiento.fechaCreacion, dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorCuentaXMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimientoVentasDetalle.idProducto
FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.farmMovimientoVentasDetalle.idProducto
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleSeleccionarPorId]
	@MovNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoVentasDetalle
where MovNumero = @MovNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorMovNumero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorMovNumero]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.total, dbo.farmAlmacen.descripcion AS dalmacen, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.DocumentoNumero,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmEstadosMovimientos.Estado, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Empleados.Usuario, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimientoVentas.idServicioPaciente,dbo.farmMovimientoVentas.idPaciente
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.MovNumero=@MovNumero and dbo.farmMovimiento.idEstadoMovimiento=1 and
		dbo.farmMovimientoVentas.MovTipo=@MovTipo
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorMovNumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasDetalleSeleccionarPorNBoleta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasDetalleSeleccionarPorNBoleta]
	@DocumentoNumero [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.total, dbo.farmAlmacen.descripcion AS dalmacen, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.DocumentoNumero,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmEstadosMovimientos.Estado, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Empleados.Usuario, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimiento.idAlmacenOrigen, dbo.farmMovimientoVentas.idServicioPaciente
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE    dbo.farmMovimiento.idEstadoMovimiento=1
and dbo.farmMovimiento.DocumentoNumero=@DocumentoNumero
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasDetalleSeleccionarPorNBoleta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleSeleccionarXidCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleSeleccionarXidCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.idEstadoMovimiento,
                     dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                     dbo.FactCatalogoBienesInsumos.codigo , dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmMovimiento.DocumentoNumero,
                     dbo.farmMovimiento.fechaCreacion,dbo.FactCatalogoBienesInsumos.FormaFarmaceutica,
                     dbo.FactCatalogoBienesInsumos.tipoProducto,dbo.FactCatalogoBienesInsumos.esPaquete
             FROM         dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             WHERE dbo.farmMovimiento.idEstadoMovimiento=1 AND dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleSeleccionarXidCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.MovNumero, dbo.FactCatalogoBienesInsumos.Codigo,
                                  dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                                  dbo.farmMovimientoVentasDetalle.total, dbo.farmAlmacen.descripcion AS dalmacen, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                                  dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.farmMovimiento.idEstadoMovimiento,
                                  dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento, dbo.farmMovimiento.DocumentoNumero,
                                  dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmEstadosMovimientos.Estado, dbo.farmMovimiento.idEstadoMovimiento,
                                  dbo.Empleados.Usuario, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                                  dbo.farmMovimiento.idAlmacenOrigen , dbo.farmMovimientoVentas.idServicioPaciente,dbo.FactCatalogoBienesInsumos.esPaquete
              FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                                  dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                                  dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                                  dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                                  dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                                  dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                                  dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             WHERE       dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion  and dbo.farmMovimiento.idEstadoMovimiento=1
             ORDER BY  dbo.farmMovimiento.MovNumero,dbo.farmMovimiento.MovTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasDetalleXidProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasDetalleXidProducto]
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentasDetalle.*
FROM         dbo.farmMovimientoVentasDetalle INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentasDetalle.MovNumero = dbo.farmMovimiento.MovNumero
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) and dbo.farmMovimientoVentasDetalle.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasDetalleXidProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasEliminar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmMovimientoVentas
where movNumero = @movNumero and movTipo =@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasExoneracionesEnFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasExoneracionesEnFarmacia]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.DocumentoNumero AS NroDocumento, dbo.farmTipoDocumentos.Nombre AS [Tipo Dcto],
                      dbo.farmMovimiento.fechaCreacion, dbo.farmAlmacen.descripcion AS Farmacia, dbo.farmMovimientoVentas.movNumero AS NroMovimiento
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.farmMovimientoVentas.idTipoFinanciamiento = 9)
	    and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
ORDER BY dbo.farmMovimiento.fechaCreacion DESC
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasExoneracionesEnFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltraFuentesFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltraFuentesFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenOrigen [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.Total, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idPaciente
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.farmMovimientoVentas.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen
order by     dbo.farmMovimientoVentas.idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltraFuentesFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltraPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltraPorFechas]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.*, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.fechaCreacion
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo
WHERE  (fechaCreacion Between  @FechaEgrIni and  @FechaEgrFin)
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltraPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltraPorFechasAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltraPorFechasAlmacen]
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime],
	@idAlmacenOrigen [int],
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
if @movNumero=''
	SELECT     dbo.farmMovimientoVentas.*, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idTipoConcepto,
	                      dbo.farmMovimiento.Total, dbo.farmTipoConceptos.Concepto, dbo.FuentesFinanciamiento.Descripcion, dbo.farmMovimiento.idAlmacenOrigen,
		    dbo.farmMovimiento.DocumentoNumero
	FROM         dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo ON
	                      dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.farmMovimientoVentas.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto
	WHERE  (fechaCreacion Between  @FechaEgrIni and  @FechaEgrFin) and dbo.farmMovimiento.idAlmacenOrigen=@idAlmacenOrigen
		  and dbo.farmMovimiento.idEstadoMovimiento = 1
	ORDER BY  dbo.farmMovimiento.idTipoConcepto, dbo.farmMovimientoVentas.idFuenteFinanciamiento
else
	SELECT     dbo.farmMovimientoVentas.*, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.fechaCreacion, dbo.farmMovimiento.idTipoConcepto,
	                      dbo.farmMovimiento.Total, dbo.farmTipoConceptos.Concepto, dbo.FuentesFinanciamiento.Descripcion, dbo.farmMovimiento.idAlmacenOrigen
	FROM         dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.farmMovimientoVentas INNER JOIN
	                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo ON
	                      dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.farmMovimientoVentas.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.farmTipoConceptos ON dbo.farmMovimiento.idTipoConcepto = dbo.farmTipoConceptos.idTipoConcepto
	WHERE  dbo.farmMovimiento.movNumero=@movNumero and dbo.farmMovimiento.movTipo=@movTipo
		  and dbo.farmMovimiento.idEstadoMovimiento = 1
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltraPorFechasAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltrarFechasAlmacIdTipoServ]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltrarFechasAlmacIdTipoServ]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@TipoServicioHosp [int],
	@IdAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.farmMovimientoVentasDetalle.cantidad as nroHistoria,left(dbo.FactCatalogoBienesInsumos.nombre,85)+' ('+rtrim(dbo.FactCatalogoBienesInsumos.codigo) +') '  AS Paciente,
                       dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.IdServicioPaciente as idPuntoCarga, dbo.Servicios.Nombre AS dPuntoCarga,
                                  dbo.farmMovimientoVentasDetalle.Total as consumo
             FROM         dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
                                  dbo.Servicios ON dbo.farmMovimientoVentas.IdServicioPaciente = dbo.Servicios.IdServicio RIGHT OUTER JOIN
                                  dbo.farmMovimientoVentasDetalle LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                  dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                                  dbo.farmMovimientoVentas.MovTipo = dbo.farmMovimientoVentasDetalle.MovTipo
             Where (dbo.farmMovimiento.idEstadoMovimiento = 1) And (dbo.farmMovimientoVentas.IdServicioPaciente Is Not Null)
                     and dbo.Servicios.IdTipoServicio=@TipoServicioHosp
                      and dbo.farmMovimiento.fechaCreacion Between CONVERT(DATETIME,  @FechaInicio  ,103)
                    and CONVERT(DATETIME,   @FechaFin,103)
                    and dbo.farmMovimiento.idAlmacenOrigen= @IdAlmacen
             order by dbo.FactCatalogoBienesInsumos.nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltrarFechasAlmacIdTipoServ] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasFiltrarMovnumero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasFiltrarMovnumero]
	@MovNumero [varchar](9)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.movNumero, dbo.farmMovimientoVentas.movTipo, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,
                                     dbo.Pacientes.PrimerNombre , dbo.Pacientes.SegundoNombre
                FROM           dbo.farmMovimientoVentas LEFT OUTER JOIN
                                     dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente
                WHERE dbo.farmMovimientoVentas.movNumero=@MovNumero
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasFiltrarMovnumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltrarMovnumeroIdTipoFinanc]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltrarMovnumeroIdTipoFinanc]
	@MovNumero [varchar](9),
	@LcMovTipo [varchar](1),
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FarmMovimientoVentas where MovNumero=@MovNumero
          and MovTipo=@LcMovTipo and idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltrarMovnumeroIdTipoFinanc] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasFiltraTipoServicioHosp]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasFiltraTipoServicioHosp]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idAlmacenOrigen [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.farmMovimiento.Total, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idCuentaAtencion,
                      dbo.farmMovimientoVentas.idPaciente, dbo.farmMovimientoVentas.idTipoReceta, dbo.Atenciones.IdTipoServicio,
                      dbo.farmMovimiento.DocumentoNumero
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE      (dbo.farmMovimiento.idEstadoMovimiento = 1) and (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaInicio and  @FechaFin)
                    and @idAlmacenOrigen=dbo.farmMovimiento.idAlmacenOrigen
ORDER BY dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasFiltraTipoServicioHosp] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasModificar]
	@movNumero [varchar](9),
	@movTipo [varchar](1),
	@tipoVenta [varchar](1),
	@idPreVenta [int],
	@idTipoFinanciamiento [int],
	@idPrescriptor [int],
	@idTipoReceta [int],
	@idDiagnostico [int],
	@idCuentaAtencion [int],
	@IdServicioPaciente [int],
	@idFuenteFinanciamiento [int],
	@idPaciente [int],
	@FechaHoraPrescribe [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmMovimientoVentas
set
movTipo = @movTipo,
tipoVenta = @tipoVenta,
idPreVenta = @idPreVenta,
idTipoFinanciamiento = @idTipoFinanciamiento,
idPrescriptor = @idPrescriptor,
idTipoReceta = @idTipoReceta,
idDiagnostico = @idDiagnostico,
idCuentaAtencion = @idCuentaAtencion,
idFuenteFinanciamiento=@idFuenteFinanciamiento,
idPaciente = @idPaciente,
IdServicioPaciente=@IdServicioPaciente,
FechaHoraPrescribe=@FechaHoraPrescribe
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasPacientesPagantesConCredito]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasPacientesPagantesConCredito]
	@FechaMovInicio [datetime],
	@FechaMovFin [datetime],
	@FechaCancInicio [datetime],
	@FechaCancFin [datetime]
WITH EXECUTE AS CALLER
AS
if @FechaCancInicio is null
	SELECT      dbo.Pacientes.NroHistoriaClinica, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                      + ' ' + dbo.Pacientes.PrimerNombre AS paciente, dbo.FactCatalogoBienesInsumos.TipoProducto, dbo.FacturacionBienesPagos.TotalPagar,
                      dbo.farmMovimiento.fechaCreacion, dbo.FuentesFinanciamiento.Descripcion AS dfuente, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.farmMovimientoVentas.idPreVenta, dbo.farmMovimientoVentas.idCuentaAtencion,
                      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionBienesPagos.idProducto,
                      dbo.CajaComprobantesPago.NroSerie + ' ' + dbo.CajaComprobantesPago.NroDocumento AS comprobante,dbo.CajaComprobantesPago.exoneraciones
	FROM         dbo.CajaComprobantesPago RIGHT OUTER JOIN
	                      dbo.farmMovimiento INNER JOIN
	                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
	                      dbo.FactOrdenesBienes ON dbo.farmMovimientoVentas.movNumero = dbo.FactOrdenesBienes.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.FactOrdenesBienes.MovTipo RIGHT OUTER JOIN
	                      dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden ON
	                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento ON
	                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.Atenciones.idFuenteFinanciamiento <> 3) AND
	                      (dbo.farmMovimientoVentas.idPreVenta IS NULL)  and
                                (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaMovInicio and  @FechaMovFin)
	ORDER BY  dbo.farmMovimiento.fechaCreacion,dbo.Pacientes.NroHistoriaClinica,dbo.FactCatalogoBienesInsumos.TipoProducto
else
	SELECT     dbo.Pacientes.NroHistoriaClinica, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                      + ' ' + dbo.Pacientes.PrimerNombre AS paciente, dbo.FactCatalogoBienesInsumos.TipoProducto, dbo.FacturacionBienesPagos.TotalPagar,
                      dbo.farmMovimiento.fechaCreacion, dbo.FuentesFinanciamiento.Descripcion AS dfuente, dbo.farmMovimiento.idEstadoMovimiento,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.farmMovimientoVentas.idPreVenta, dbo.farmMovimientoVentas.idCuentaAtencion,
                      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo, dbo.CajaComprobantesPago.FechaCobranza,
                      dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionBienesPagos.idProducto,
                      dbo.CajaComprobantesPago.NroSerie + ' ' + dbo.CajaComprobantesPago.NroDocumento AS comprobante,dbo.CajaComprobantesPago.exoneraciones
	FROM         dbo.CajaComprobantesPago RIGHT OUTER JOIN
	                      dbo.farmMovimiento INNER JOIN
	                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
	                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo INNER JOIN
	                      dbo.FactOrdenesBienes ON dbo.farmMovimientoVentas.movNumero = dbo.FactOrdenesBienes.MovNumero AND
	                      dbo.farmMovimientoVentas.movTipo = dbo.FactOrdenesBienes.MovTipo RIGHT OUTER JOIN
	                      dbo.FacturacionBienesPagos ON dbo.FactOrdenesBienes.idOrden = dbo.FacturacionBienesPagos.IdOrden ON
	                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenesBienes.idComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento ON
	                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
	WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.Atenciones.idFuenteFinanciamiento <> 3) AND
	                      (dbo.farmMovimientoVentas.idPreVenta IS NULL) and
                                ( dbo.CajaComprobantesPago.FechaCobranza BETWEEN  @FechaCancInicio and  @FechaCancFin)
	ORDER BY  dbo.farmMovimiento.fechaCreacion,dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasPacientesPagantesConCredito] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasPacientesSegurosConCredito]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasPacientesSegurosConCredito]
	@FechaMovInicio [datetime],
	@FechaMovFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, LTRIM(dbo.Pacientes.ApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno)
                      + ' ' + dbo.Pacientes.PrimerNombre AS paciente, dbo.FactCatalogoBienesInsumos.TipoProducto,
                      dbo.FacturacionBienesFinanciamientos.TotalFinanciado, dbo.farmMovimiento.fechaCreacion, dbo.FuentesFinanciamiento.Descripcion AS dfuente,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idPreVenta, dbo.farmMovimientoVentas.idCuentaAtencion,
                      dbo.farmMovimiento.MovNumero, dbo.farmMovimiento.MovTipo
FROM         dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.FacturacionBienesFinanciamientos ON
                      dbo.FactCatalogoBienesInsumos.IdProducto = dbo.FacturacionBienesFinanciamientos.IdProducto LEFT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente ON
                      dbo.FacturacionBienesFinanciamientos.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.FacturacionBienesFinanciamientos.MovTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.Atenciones.idFuenteFinanciamiento ON
                      dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.Atenciones.idFuenteFinanciamiento <> 3) AND
                      (dbo.farmMovimientoVentas.idPreVenta IS NULL) AND (dbo.FacturacionBienesFinanciamientos.idFuenteFinanciamiento <> 9) and
                      (dbo.farmMovimiento.fechaCreacion BETWEEN  @FechaMovInicio and  @FechaMovFin)
ORDER BY  dbo.farmMovimiento.fechaCreacion,dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasPacientesSegurosConCredito] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasPorCuenta]
	@lnIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.*, dbo.farmMovimiento.idEstadoMovimiento
             FROM         dbo.farmMovimientoVentas INNER JOIN
                       dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                       dbo.FarmMovimientoVentas.MovTipo = dbo.farmMovimiento.MovTipo
             WHERE dbo.farmMovimiento.idEstadoMovimiento=1 and dbo.farmMovimientoVentas.idCuentaAtencion=@lnIdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasSeleccionarPorCuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasSeleccionarPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.farmMovimientoVentas.*, dbo.farmMovimiento.idEstadoMovimiento
                 FROM  dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.MovTipo = dbo.farmMovimiento.MovTipo
                 WHERE dbo.farmMovimiento.idEstadoMovimiento<>0 and dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasSeleccionarPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorFechasYTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorFechasYTipoFinanciamiento]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimientoVentas.movNumero, dbo.farmMovimientoVentas.movTipo,
                      dbo.Atenciones.IdFormaPago, dbo.farmMovimiento.idEstadoMovimiento,dbo.farmMovimientoVentas.idCuentaAtencion
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.farmMovimientoVentas.idPaciente = dbo.Pacientes.IdPaciente
WHERE     ( dbo.Atenciones.fechaEgreso BETWEEN  @FechaInicio and  @FechaFin) and dbo.Atenciones.IdFormaPago=@idTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorFechasYTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorId]
	@movNumero [varchar](9),
	@movTipo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from farmMovimientoVentas
where movNumero = @movNumero and movTipo=@movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorIdComprobantePago]
	@idComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.idComprobantePago, dbo.farmMovimientoVentas.IdServicioPaciente, dbo.Servicios.Nombre AS Dservicio,
                      dbo.Servicios.IdEspecialidad, dbo.Especialidades.Nombre AS Despecialidad, dbo.Especialidades.IdDepartamento,
                      dbo.DepartamentosHospital.Nombre AS dDpto, dbo.Servicios.IdTipoServicio, dbo.TiposServicio.Descripcion AS DTipoServicio,
	     dbo.FactOrdenesBienes.idOrden, dbo.FactOrdenesBienes.ImporteExonerado
FROM         dbo.FactOrdenesBienes LEFT OUTER JOIN
                      dbo.TiposServicio RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio LEFT OUTER JOIN
                      dbo.Especialidades LEFT OUTER JOIN
                      dbo.DepartamentosHospital ON dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento ON
                      dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad RIGHT OUTER JOIN
                      dbo.farmMovimientoVentas ON dbo.Servicios.IdServicio = dbo.farmMovimientoVentas.IdServicioPaciente ON
                      dbo.FactOrdenesBienes.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.FactOrdenesBienes.MovTipo = dbo.farmMovimientoVentas.movTipo
WHERE       dbo.FactOrdenesBienes.idComprobantePago=@idComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorIdCuentaAtencion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentasDetalle.*, dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.farmMovimientoVentas.idPaciente, dbo.farmMovimiento.idEstadoMovimiento,
	     dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimiento.fechaCreacion
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo
where dbo.farmMovimientoVentas.idCuentaAtencion=@idCuentaAtencion
order by dbo.farmMovimientoVentas.movNumero, dbo.farmMovimientoVentas.movTipo
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorIdPreventa]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorIdPreventa]
	@idPreVenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.*, dbo.farmMovimiento.*
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo
where dbo.farmMovimientoVentas.idPreVenta = @idPreVenta
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorIdPreventa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasSeleccionarPorNroDocumentoTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasSeleccionarPorNroDocumentoTipoFinanciamiento]
	@DocumentoNumero [varchar](20),
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimiento.DocumentoNumero AS [N° Documento], dbo.farmTipoDocumentos.Nombre AS [Tipo Dcto],
                      dbo.farmMovimiento.fechaCreacion, dbo.farmAlmacen.descripcion AS Farmacia, dbo.farmMovimientoVentas.movNumero AS NroMovimiento
FROM         dbo.farmMovimientoVentas INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.farmTipoDocumentos ON dbo.farmMovimiento.DocumentoIdtipo = dbo.farmTipoDocumentos.idTipoDocumento
WHERE     (dbo.farmMovimiento.idEstadoMovimiento = 1) AND (dbo.farmMovimientoVentas.idTipoFinanciamiento = @idTipoFinanciamiento)
	    and 	dbo.farmMovimiento.DocumentoNumero=@DocumentoNumero
ORDER BY dbo.farmMovimiento.fechaCreacion DESC
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasSeleccionarPorNroDocumentoTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmMovimientoVentasSeleccionarXIdServicioPacienteNull]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmMovimientoVentasSeleccionarXIdServicioPacienteNull]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.movNumero, dbo.farmMovimientoVentas.movTipo, dbo.farmMovimientoVentas.idCuentaAtencion,
                     dbo.farmMovimientoVentas.IdServicioPaciente, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso, dbo.farmMovimientoVentas.tipoVenta,
                     dbo.farmMovimiento.fechaCreacion, dbo.Atenciones.IdServicioIngreso
FROM         dbo.farmMovimientoVentas INNER JOIN
                     dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                     dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo LEFT OUTER JOIN
                     dbo.Atenciones ON dbo.farmMovimientoVentas.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE     (dbo.Atenciones.IdTipoServicio > 1) AND (dbo.farmMovimientoVentas.IdServicioPaciente IS NULL) AND
                     (dbo.farmMovimientoVentas.idCuentaAtencion > 0)
GO
ALTER AUTHORIZATION ON [dbo].[FarmMovimientoVentasSeleccionarXIdServicioPacienteNull] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmMovimientoVentasXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmMovimientoVentasXcuenta]
	@ml_idCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.FacturacionBienesFinanciamientos.*, dbo.farmMovimiento.idEstadoMovimiento
             FROM           dbo.farmMovimiento INNER JOIN
                                  dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                                  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo RIGHT OUTER JOIN
                                  dbo.FacturacionBienesFinanciamientos ON dbo.farmMovimientoVentas.movTipo = dbo.FacturacionBienesFinanciamientos.MovTipo AND
                                  dbo.farmMovimientoVentas.MovNumero = dbo.FacturacionBienesFinanciamientos.MovNumero
             where dbo.farmMovimientoVentas.idCuentaAtencion=@ml_idCuenta
GO
ALTER AUTHORIZATION ON [dbo].[farmMovimientoVentasXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmNiNsConCabeceraSinDetalle]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmNiNsConCabeceraSinDetalle]
WITH EXECUTE AS CALLER
AS
--        begin
--           create table #myTempTable
--                        (
  --                                      movNumero varchar(9),
--                                        movTipo varchar(1),
--                                        fechaCreacion datetime,
--                                        cantidad int
--                         )
--
--             insert into #myTempTable (movNumero,movTipo,fechaCreacion,cantidad)
--                             select dbo.farmMovimiento.movNumero,
--                             dbo.farmMovimiento.movTipo,
--                             dbo.farmMovimiento.fechaCreacion,
--                              (select ISNULL (sum(dbo.farmMovimientoDetalle.cantidad),0) from dbo.farmMovimientoDetalle where dbo.farmMovimiento.movNumero=dbo.farmMovimientoDetalle.movNumero and dbo.farmMovimiento.movTipo=dbo.farmMovimientoDetalle.movTipo) from dbo.farmMovimiento
--             select * from #myTempTable  where cantidad=0
--       end

                             select dbo.farmMovimiento.movNumero,
                             dbo.farmMovimiento.movTipo,
                             dbo.farmMovimiento.fechaCreacion,
                              (select ISNULL (sum(dbo.farmMovimientoDetalle.cantidad),0) from dbo.farmMovimientoDetalle where dbo.farmMovimiento.movNumero=dbo.farmMovimientoDetalle.movNumero and dbo.farmMovimiento.movTipo=dbo.farmMovimientoDetalle.movTipo) as Cantidad from dbo.farmMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[FarmNiNsConCabeceraSinDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaAgregar]
	@idPreventa [int] OUTPUT,
	@idAlmacen [int],
	@idVendedor [int],
	@idPaciente [int],
	@idTipoFinanciamiento [int],
	@Total [money],
	@idDiagnostico [int],
	@idTipoReceta [int],
	@idCuentaAtencion [int],
	@idPrescriptor [int],
	@FechaCreacion [datetime],
	@HoraCreacion [varchar](5),
	@idUsuario [int],
	@FechaModificacion [datetime],
	@idUsuarioModifica [int],
	@idEstadoPreventa [int],
	@FechaHoraPrescribe [datetime],
	@dni [varchar](8),
	@Paciente [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmPreVenta (
idAlmacen,idVendedor,idPaciente,idTipoFinanciamiento,Total,idDiagnostico,idTipoReceta,idCuentaAtencion,idPrescriptor,FechaCreacion,HoraCreacion,idUsuario,FechaModificacion,
idUsuarioModifica,idEstadoPreventa,FechaHoraPrescribe,dni,Paciente ) values (
@idAlmacen,@idVendedor,@idPaciente,@idTipoFinanciamiento,@Total,@idDiagnostico,@idTipoReceta,@idCuentaAtencion,@idPrescriptor,@FechaCreacion,@HoraCreacion,@idUsuario,
@FechaModificacion,@idUsuarioModifica,@idEstadoPreventa,@FechaHoraPrescribe,@dni,@Paciente )
set @idPreventa = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaDetalleAgregar]
	@idPreventa [int],
	@idProducto [int],
	@item [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into farmPreVentaDetalle (
idPreventa,idProducto,item,Cantidad,Precio,Importe) values (
@idPreventa,@idProducto,@item,@Cantidad,@Precio,@Importe)
--exec SeguridadAuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPreventa,'farmPreVentaDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmPreVentaDetalleDevuelveTodosItems]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmPreVentaDetalleDevuelveTodosItems]
	@idPreventa [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmPreVentaDetalle.idPreventa, dbo.farmPreVentaDetalle.idProducto, dbo.farmPreVentaDetalle.item, dbo.farmPreVentaDetalle.Cantidad,
                      dbo.farmPreVentaDetalle.Precio, dbo.farmPreVentaDetalle.Importe, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre
FROM         dbo.farmPreVentaDetalle LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmPreVentaDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
where     dbo.farmPreVentaDetalle.idPreventa=@idPreventa
ORDER BY dbo.farmPreVentaDetalle.item
GO
ALTER AUTHORIZATION ON [dbo].[FarmPreVentaDetalleDevuelveTodosItems] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaDetalleEliminar]
	@idPreventa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmPreVentaDetalle
where idPreventa = @idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaDetalleModificar]
	@idPreventa [int],
	@idProducto [int],
	@item [int],
	@Cantidad [int],
	@Precio [money],
	@Importe [money],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmPreVentaDetalle
set
idProducto = @idProducto,
item = @item,
Cantidad = @Cantidad,
Precio = @Precio,
Importe = @Importe
where idPreventa = @idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaDetalleSeleccionarPorId]
	@idPreventa [int]
WITH EXECUTE AS CALLER
AS
select * from farmPreVentaDetalle
where idPreventa = @idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaEliminar]
	@idPreventa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from farmPreVenta
where idPreventa = @idPreventa
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPreventa,'farmPreVenta'
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmPreVentaFarmMovimientoVentasSeleccionarPorIdEstadoPreventa2]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmPreVentaFarmMovimientoVentasSeleccionarPorIdEstadoPreventa2]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmPreVenta.idEstadoPreventa, dbo.farmPreVenta.idVendedor, dbo.farmMovimientoVentas.movNumero,
                     dbo.FarmMovimientoVentas.movTipo
FROM         dbo.farmPreVenta INNER JOIN
                     dbo.farmMovimientoVentas ON dbo.farmPreVenta.idPreventa = dbo.farmMovimientoVentas.idPreVenta
WHERE dbo.farmPreVenta.idEstadoPreventa=2 and not (dbo.farmMovimientoVentas.movNumero is null)
GO
ALTER AUTHORIZATION ON [dbo].[FarmPreVentaFarmMovimientoVentasSeleccionarPorIdEstadoPreventa2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmPreVentaFiltraPorIdPreVenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmPreVentaFiltraPorIdPreVenta]
	@idPreventa [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmPreVenta.idPreventa, dbo.farmEstadosPreventa.Estado, dbo.farmPreVenta.Total,  dbo.farmPreVenta.idAlmacen
FROM         dbo.farmPreVenta INNER JOIN
                      dbo.farmEstadosPreventa ON dbo.farmPreVenta.idEstadoPreventa = dbo.farmEstadosPreventa.idEstadoPreventa
WHERE dbo.farmPreVenta.idPreventa=@idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[FarmPreVentaFiltraPorIdPreVenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmPreventaFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmPreventaFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
SET  @SQL =  'SELECT  * from FarmPreventa where '+ @lcFiltro +' order by idPreventa Desc'
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmPreventaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaModificar]
	@idPreventa [int],
	@idAlmacen [int],
	@idVendedor [int],
	@idPaciente [int],
	@idTipoFinanciamiento [int],
	@Total [money],
	@idDiagnostico [int],
	@idTipoReceta [int],
	@idCuentaAtencion [int],
	@idPrescriptor [int],
	@FechaCreacion [datetime],
	@HoraCreacion [varchar](5),
	@idUsuario [int],
	@FechaModificacion [datetime],
	@idUsuarioModifica [int],
	@idEstadoPreventa [int],
	@FechaHoraPrescribe [datetime],
	@dni [varchar](8),
	@Paciente [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update farmPreVenta
set
idAlmacen = @idAlmacen,
idVendedor = @idVendedor,
idPaciente = @idPaciente,
idTipoFinanciamiento = @idTipoFinanciamiento,
Total = @Total,
idDiagnostico = @idDiagnostico,
idTipoReceta = @idTipoReceta,
idCuentaAtencion = @idCuentaAtencion,
idPrescriptor = @idPrescriptor,
FechaCreacion = @FechaCreacion,
HoraCreacion=@HoraCreacion,
idUsuario = @idUsuario,
FechaModificacion = @FechaModificacion,
idUsuarioModifica = @idUsuarioModifica,
idEstadoPreventa = @idEstadoPreventa,
FechaHoraPrescribe=@FechaHoraPrescribe,
dni=@dni,
paciente=@Paciente
where idPreventa = @idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmPreVentaSeleccionarPorId]
	@idPreventa [int]
WITH EXECUTE AS CALLER
AS
select * from farmPreVenta
where idPreventa = @idPreventa
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmPreVentaXidComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmPreVentaXidComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenesBienes.idComprobantePago, dbo.farmPreVenta.idVendedor
             FROM     dbo.FactOrdenesBienes INNER JOIN
                            dbo.farmPreVenta ON dbo.FactOrdenesBienes.idPreventa = dbo.farmPreVenta.idPreventa
                            where  dbo.FactOrdenesBienes.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[farmPreVentaXidComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmProveedorFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmProveedorFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

IF @lcFiltro<>''
   SET  @SQL =  'SELECT  * from proveedores where '+ @lcFiltro +' order by RazonSocial'
ELSE
   SET  @SQL =  'SELECT  * from proveedores order by RazonSocial'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmProveedorFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmRegeneraSaldos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmRegeneraSaldos]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                     dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Item,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmMovimiento.idAlmacenOrigen,
                      dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmAlmacen.descripcion AS almDestino, dbo.FactCatalogoBienesInsumos.Codigo,
                      farmAlmacen_1.descripcion AS almOrigen,dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo
                 FROM         dbo.farmAlmacen RIGHT OUTER JOIN dbo.farmMovimiento LEFT OUTER JOIN
                     dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen ON
                      dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino RIGHT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
                 Where   (dbo.farmMovimiento.idEstadoMovimiento = 1)
                 ORDER BY dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmRegeneraSaldos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmRegeneraSaldosMayorAFecha]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmRegeneraSaldosMayorAFecha]
	@fechaCreacion [datetime]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.farmMovimientoDetalle.MovNumero, dbo.farmMovimientoDetalle.MovTipo, dbo.farmMovimientoDetalle.idProducto,
                     dbo.farmMovimientoDetalle.Lote, dbo.farmMovimientoDetalle.FechaVencimiento, dbo.farmMovimientoDetalle.Item,
                      dbo.farmMovimientoDetalle.Cantidad, dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmMovimiento.idAlmacenOrigen,
                      dbo.farmMovimiento.idAlmacenDestino, dbo.farmMovimiento.fechaCreacion,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmAlmacen.descripcion AS almDestino, dbo.FactCatalogoBienesInsumos.Codigo,
                      farmAlmacen_1.descripcion AS almOrigen,dbo.farmMovimientoDetalle.idTipoSalidaBienInsumo
                 FROM         dbo.farmAlmacen RIGHT OUTER JOIN dbo.farmMovimiento LEFT OUTER JOIN
                     dbo.farmAlmacen farmAlmacen_1 ON dbo.farmMovimiento.idAlmacenOrigen = farmAlmacen_1.idAlmacen ON
                      dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino RIGHT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
                 Where   (dbo.farmMovimiento.idEstadoMovimiento = 1) and dbo.farmMovimiento.fechaCreacion>@fechaCreacion
                 ORDER BY dbo.farmMovimientoDetalle.idProducto, dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[FarmRegeneraSaldosMayorAFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmRelModActualizaSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmRelModActualizaSegunFiltro]
	@filtro [varchar](500),
	@lcDocumento [varchar](20)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1500)
SET @SQL = 'update farmRelMod set DocumentoUltimoNumero='+@lcDocumento+' where ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmRelModActualizaSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmRelModDevuelveSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmRelModDevuelveSegunFiltro]
	@Filtro [varchar](300)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'select * from FarmRelMod where ' +  @Filtro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmRelModDevuelveSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmRelModYParametrosModificados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmRelModYParametrosModificados]
	@DocumentoUltimoNumero [varchar](20),
	@Anio [varchar](355)
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION

update FarmRelMod set DocumentoUltimoNumero=@DocumentoUltimoNumero
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
update Parametros set ValorTexto=@Anio where idParametro=228
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[FarmRelModYParametrosModificados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoDetalladoPorIdProductoIdAlmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmSaldoDetalladoPorIdProductoIdAlmacen]
	@idAlmacen [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldoDetallado.*, dbo.farmTipoSalidaBienInsumo.tipo
FROM         dbo.farmSaldoDetallado INNER JOIN
                      dbo.farmTipoSalidaBienInsumo ON dbo.farmSaldoDetallado.IdTipoSalidaBienInsumo = dbo.farmTipoSalidaBienInsumo.idTipoSalidaBienInsumo
where dbo.farmSaldoDetallado.idAlmacen=@idAlmacen and dbo.farmSaldoDetallado.idProducto=@idProducto
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoDetalladoPorIdProductoIdAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmSaldoFarmAlmacenSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmSaldoFarmAlmacenSeleccionarPorIdProducto]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldo.IdTipoSalidaBienInsumo, dbo.farmAlmacen.descripcion
FROM         dbo.farmSaldo LEFT OUTER JOIN
dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen
WHERE  IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoFarmAlmacenSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmSaldoMensualDetalladoSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmSaldoMensualDetalladoSeleccionarPorFiltro]
	@Where [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL =  'select * from FarmSaldoMensualDetallado ' + @Where +
                         ' order by idAlmacen,Idproducto,lote,fechaVencimiento,idTipoSalidaBienInsumo,SaldoFecha'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoMensualDetalladoSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmSaldoMensualDetalladoSeleccionarPorSAldoFecha]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmSaldoMensualDetalladoSeleccionarPorSAldoFecha]
	@SaldoFecha [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from FarmSaldoMensualDetallado    where saldoFecha=CONVERT(DATETIME, @SaldoFecha ,103)


/*(
@SaldoFecha Varchar (50),
@Where Varchar (500)
)
 AS

DECLARE @SQL AS VARCHAR(1500)

SET  @SQL = 'select * from FarmSaldoMensualDetallado
                        where saldoFecha=CONVERT(DATETIME," + @SaldoFecha +",103)'

-- where saldoFecha= ' + @SaldoFecha + @Where

EXECUTE (@SQL)
GO*/
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoMensualDetalladoSeleccionarPorSAldoFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoMensualFiltrarFecha]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmSaldoMensualFiltrarFecha]
	@Where [varchar](2500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(3500)

IF @Where =  ''

BEGIN
SET  @SQL =  'SELECT     dbo.farmSaldoMensual.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
                         FROM         dbo.farmSaldoMensual LEFT OUTER JOIN
                                            dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoMensual.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		            where         dbo.farmSaldoMensual.saldo<>0
                          order by      dbo.farmSaldoMensual.idProducto'
END

ELSE

BEGIN
SET  @SQL =  'SELECT     dbo.farmSaldoMensual.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
                         FROM         dbo.farmSaldoMensual LEFT OUTER JOIN
                                            dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoMensual.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
		            where         dbo.farmSaldoMensual.saldo<>0  ' + @Where +'
                          order by      dbo.farmSaldoMensual.idProducto'

END
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoMensualFiltrarFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoMensualFiltrarFechaYalmacen]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmSaldoMensualFiltrarFechaYalmacen]
	@FechaHistoricoXmes [datetime],
	@IdAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldoMensual.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
                FROM           dbo.farmSaldoMensual LEFT OUTER JOIN
                                     dbo.FactCatalogoBienesInsumos ON dbo.farmSaldoMensual.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                where dbo.farmSaldoMensual.saldo<>0 and dbo.farmSaldoMensual.idAlmacen=@IdAlmacen
                          and dbo.farmSaldoMensual.saldofecha=CONVERT(DATETIME,@FechaHistoricoXmes,103)
                order by dbo.farmSaldoMensual.idProducto
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoMensualFiltrarFechaYalmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproducto]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproducto]
	@IdProducto [int],
	@IdAlmacen [int],
	@FechaMov [datetime]
WITH EXECUTE AS CALLER
AS
select  top 1  *  from farmSaldoMensual where idProducto= @IdProducto and IdAlmacen=@IdAlmacen and SaldoFecha<=@fechaMov order by saldoFecha desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproductoXmes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproductoXmes]
	@IdProducto [int],
	@IdAlmacen [int],
	@FechaMov [datetime]
WITH EXECUTE AS CALLER
AS
select    *  from farmSaldoMensual where idProducto= @IdProducto and IdAlmacen=@IdAlmacen and SaldoFecha=@fechaMov order by saldoFecha desc
GO
ALTER AUTHORIZATION ON [dbo].[FarmSaldoMensualSeleccionarUltimoSaldoPorIdproductoXmes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoSoloAlmacenSismed]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmSaldoSoloAlmacenSismed]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmAlmacen.idAlmacen, dbo.farmAlmacen.descripcion, dbo.farmAlmacen.idTipoLocales, dbo.farmAlmacen.idTipoSuministro,
                                dbo.farmAlmacen.idEstado , dbo.farmSaldo.idProducto, dbo.farmSaldo.cantidad, dbo.farmSaldo.Precio,
                                dbo.farmsaldo.IdTipoSalidaBienInsumo
              FROM        dbo.farmAlmacen RIGHT OUTER JOIN
                                dbo.farmSaldo ON dbo.farmAlmacen.idAlmacen = dbo.farmSaldo.idAlmacen
              WHERE     (dbo.farmAlmacen.idTipoSuministro = '01') AND (dbo.farmAlmacen.idEstado = 1) AND (dbo.farmAlmacen.idTipoLocales = 'A')
                                and dbo.farmSaldo.idProducto=@IdProducto
              order by      dbo.farmAlmacen.idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoSoloAlmacenSismed] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoSoloFarmaciasSismed]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmSaldoSoloFarmaciasSismed]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmAlmacen.idAlmacen, dbo.farmAlmacen.descripcion, dbo.farmAlmacen.idTipoLocales, dbo.farmAlmacen.idTipoSuministro,
                                dbo.farmAlmacen.idEstado , dbo.farmSaldo.idProducto, dbo.farmSaldo.cantidad, dbo.farmSaldo.Precio,
                                dbo.farmsaldo.IdTipoSalidaBienInsumo
              FROM        dbo.farmAlmacen RIGHT OUTER JOIN
                                dbo.farmSaldo ON dbo.farmAlmacen.idAlmacen = dbo.farmSaldo.idAlmacen
              WHERE     (dbo.farmAlmacen.idTipoSuministro = '01') AND (dbo.farmAlmacen.idEstado = 1) AND (dbo.farmAlmacen.idTipoLocales = 'F')
                                and dbo.farmSaldo.idProducto=@IdProducto
              order by      dbo.farmAlmacen.idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoSoloFarmaciasSismed] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmSaldoTotalesSoloMayoresAcero]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmSaldoTotalesSoloMayoresAcero]
	@Filtro [varchar](500),
	@Order [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
SET  @SQL = 'SELECT DISTINCT dbo.FactCatalogoBienesInsumos.IdProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,dbo.farmAlmacen.idTipoLocales
                                       FROM         dbo.farmSaldo LEFT OUTER JOIN
                                      dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                                       WHERE     (dbo.farmSaldo.cantidad > 0)   '  + @Filtro +  ' ' + @Order
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[farmSaldoTotalesSoloMayoresAcero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoCompraDevuelveSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoCompraDevuelveSegunFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
IF @FILTRO = ' '
	SET  @SQL =  'select * from farmTipoCompra order by Descripcion'
ELSE
	SET  @SQL = 'select * from farmTipoCompra where '  + @Filtro +  ' order by Descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoCompraDevuelveSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoConceptosDevuelveParaRegistroDeNiNs]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoConceptosDevuelveParaRegistroDeNiNs]
	@TipoAlmacen [varchar](50),
	@TipoMov [varchar](50),
	@TipoSuministro [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT   dbo.farmRelMod.TipoAlmacen, dbo.farmRelMod.TipoMov, dbo.farmRelMod.ConceptoCodigo, dbo.farmRelMod.DocumentoCodigo,
                      dbo.farmRelMod.DocumentoEsAutomatico, dbo.farmRelMod.DocumentoUltimoNumero, dbo.farmRelMod.NiDocumentoOrigenCodigo,
                      dbo.farmRelMod.NiDocumentoOrigenEsAutomatico, dbo.farmRelMod.NiDocumentoOrigenUltimoNumero, dbo.farmTipoConceptos.idTipoConcepto,
                      dbo.farmTipoConceptos.Concepto, dbo.farmRelMod.NiDocumentoOrigenId, dbo.farmRelMod.DocumentoId,dbo.farmRelMod.NsFiltroAlmacenDestino,
                      dbo.farmRelMod.NiFiltroAlmacenOrigen,dbo.farmRelMod.NiEsCompra,dbo.farmRelMod.NiEsDevolucionPaciente,dbo.farmRelMod.TipoPrecioParaNiNs,
                      dbo.farmTipoConceptos.codigoMINSA,dbo.farmRelMod.MuestraLoteParaDespachoNS,dbo.farmRelMod.NiFiltroAlmacenOrigenCS, dbo.farmRelMod.NsFiltroAlmacenDestinoCS
             FROM     dbo.farmRelMod LEFT OUTER JOIN dbo.farmTipoConceptos ON dbo.farmRelMod.ConceptoCodigo = dbo.farmTipoConceptos.codigoMINSA
             WHERE   dbo.farmRelMod.TipoAlmacen=@TipoAlmacen and dbo.farmRelMod.TipoMov=@TipoMov and dbo.farmRelMod.tipoSuministro=@TipoSuministro
             ORDER BY dbo.farmTipoConceptos.Concepto
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoConceptosDevuelveParaRegistroDeNiNs] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoConceptosDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoConceptosDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from farmTipoConceptos order by concepto
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoConceptosDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoDocumentosDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoDocumentosDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from farmTipoDocumentos order by Nombre
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoDocumentosDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoDocumentosModificaCorrelativo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoDocumentosModificaCorrelativo]
WITH EXECUTE AS CALLER
AS
update FarmTipoDocumentos set correlativo=0
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoDocumentosModificaCorrelativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmTipoInventarioSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmTipoInventarioSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from farmTipoInventario order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoInventarioSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoProcesoDevuelveSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoProcesoDevuelveSegunFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
IF @FILTRO = ' '
	SET  @SQL =  'select * from farmTipoProceso order by descripcion'
ELSE
	SET  @SQL = 'select * from farmTipoProceso where '  + @Filtro +  ' order by Descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoProcesoDevuelveSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmTipoProductosSismedDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmTipoProductosSismedDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select TipoProductoSismed,Descripcion,ascii(TipoProductoSismed) as identificador from farmTipoProductosSismed  order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoProductosSismedDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmTipoRecetaDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FarmTipoRecetaDevuelveTodos]
WITH EXECUTE AS CALLER
AS
select * from farmTipoReceta order by TipoReceta
GO
ALTER AUTHORIZATION ON [dbo].[FarmTipoRecetaDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmTipoSalidaBienInsumoDevuelveTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[farmTipoSalidaBienInsumoDevuelveTodos]
WITH EXECUTE AS CALLER
AS
Select * from farmTipoSalidaBienInsumo order by tipo
GO
ALTER AUTHORIZATION ON [dbo].[farmTipoSalidaBienInsumoDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[farmUnidosisSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[farmUnidosisSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from farmUnidosis
GO
ALTER AUTHORIZATION ON [dbo].[farmUnidosisSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FarmVentasXpaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FarmVentasXpaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmMovimientoVentas.idCuentaAtencion, dbo.farmMovimiento.fechaCreacion, LTRIM(dbo.FactCatalogoBienesInsumos.Codigo)
                                  + ' ' + dbo.FactCatalogoBienesInsumos.Nombre AS item, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno)
                                  + ' ' + dbo.Empleados.Nombres AS especialista, dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimientoVentas.idPaciente,
                                  dbo.farmMovimientoVentasDetalle.cantidad,dbo.farmMovimientoVentas.movNumero,dbo.farmMovimientoVentasDetalle.idProducto,
                                dbo.farmMovimiento.documentoNumero
             FROM         dbo.farmMovimientoVentas INNER JOIN
                                  dbo.farmMovimiento ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                                  dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo INNER JOIN
                                  dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                                  dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                                  dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado
             Where (dbo.farmMovimiento.idEstadoMovimiento = 1) and  dbo.farmMovimientoVentas.idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[FarmVentasXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FiltrarHistoriaSolicitadas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FiltrarHistoriaSolicitadas]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[FiltrarHistoriaSolicitadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FiltrarMedicosPorDepartamento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FiltrarMedicosPorDepartamento]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select distinct MedicosEspecialidad.IdMedico, Empleados.CodigoPlanilla, Empleados.ApellidoPaterno, Empleados.ApellidoMaterno,
Empleados.Nombres From
((MedicosEspecialidad
left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
left join Medicos on MedicosEspecialidad.IdMedico = Medicos.IdMedico)
left join Empleados on Empleados.IdEmpleado = Medicos.IdEmpleado
Where
Especialidades.IdDepartamento = @IdDepartamento
order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[FiltrarMedicosPorDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FiltrarMedicosPorDepartamentoyEspecialidad]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FiltrarMedicosPorDepartamentoyEspecialidad]
	@IdDepartamento [int],
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
if @IdEspecialidad > 0
begin
	select distinct MedicosEspecialidad.IdMedico, Empleados.CodigoPlanilla, Empleados.ApellidoPaterno, Empleados.ApellidoMaterno,
	Empleados.Nombres From
	(((MedicosEspecialidad
	left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
	left join Medicos on MedicosEspecialidad.IdMedico = Medicos.IdMedico)
	left join Empleados on Empleados.IdEmpleado = Medicos.IdEmpleado)
	left join ProgramacionMedica on Medicos.Idmedico = ProgramacionMedica.Idmedico
	Where
	Especialidades.IdDepartamento = @IdDepartamento and  ProgramacionMedica.IdEspecialidad = @IdEspecialidad and  Empleados.EsActivo =1
	order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
end

else
	select distinct MedicosEspecialidad.IdMedico, Empleados.CodigoPlanilla, Empleados.ApellidoPaterno, Empleados.ApellidoMaterno,
	Empleados.Nombres From
	(((MedicosEspecialidad
	left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
	left join Medicos on MedicosEspecialidad.IdMedico = Medicos.IdMedico)
	left join Empleados on Empleados.IdEmpleado = Medicos.IdEmpleado)
	left join ProgramacionMedica on Medicos.Idmedico = ProgramacionMedica.Idmedico
	Where
	Especialidades.IdDepartamento = @IdDepartamento  and  Empleados.EsActivo =1
	order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[FiltrarMedicosPorDepartamentoyEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FiltraSaldoParaElAjuste]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FiltraSaldoParaElAjuste]
	@DctoAjuste [varchar](50),
	@IdAlmacenA [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.farmInventarioCabecera.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                      dbo.farmInventario.numeroInventario , dbo.farmInventario.FechaCreacion
             FROM         dbo.farmInventarioCabecera LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmInventarioCabecera.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                      dbo.farmInventario ON dbo.farmInventarioCabecera.idInventario = dbo.farmInventario.idInventario
             WHERE    dbo.farmInventario.numeroInventario=@DctoAjuste
                      and  dbo.farmInventario.idAlmacen=@IdAlmacenA
GO
ALTER AUTHORIZATION ON [dbo].[FiltraSaldoParaElAjuste] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FinanciamientoCatalogoServiciosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FinanciamientoCatalogoServiciosAgregar]
	@Activo [bit],
	@IdTipoFinanciamiento [int],
	@IdProducto [int],
	@PrecioUnitario [money],
	@IdFinanciamientoCatalogo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into FactCatalogoServiciosHosp (
Activo,IdTipoFinanciamiento,IdProducto,PrecioUnitario) values (
@Activo,@IdTipoFinanciamiento,@IdProducto,@PrecioUnitario)
set @IdFinanciamientoCatalogo = @@identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FinanciamientoCatalogoServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FinanciamientoCatalogoServiciosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FinanciamientoCatalogoServiciosEliminar]
	@IdFinanciamientoCatalogo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosHosp
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FinanciamientoCatalogoServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FinanciamientoCatalogoServiciosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FinanciamientoCatalogoServiciosModificar]
	@Activo [bit],
	@IdTipoFinanciamiento [int],
	@IdProducto [int],
	@PrecioUnitario [money],
	@IdFinanciamientoCatalogo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update FactCatalogoServiciosHosp
set
Activo = @Activo,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdProducto = @IdProducto,
PrecioUnitario = @PrecioUnitario
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdFinanciamientoCatalogo,'FactCatalogoServiciosHosp'
GO
ALTER AUTHORIZATION ON [dbo].[FinanciamientoCatalogoServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FinanciamientoCatalogoServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FinanciamientoCatalogoServiciosSeleccionarPorId]
	@IdFinanciamientoCatalogo [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosHosp
where IdFinanciamientoCatalogo = @IdFinanciamientoCatalogo
GO
ALTER AUTHORIZATION ON [dbo].[FinanciamientoCatalogoServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuaConsumoDeItemsXCuentaSigh]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuaConsumoDeItemsXCuentaSigh]
	@cuenta [int],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
begin
	set nocount on
    create table #myTempTable1(puntoCarga varchar(20),codigo varchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS,descripcion varchar(255) null,
                               cantidad int,precio money null,idProducto int null)

    insert into #myTempTable1(puntoCarga,codigo,descripcion,
	                          cantidad,precio,
							  idProducto )
	SELECT       'FARMACIA',  dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
                         dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                         dbo.farmMovimientoVentasDetalle.idProducto
	FROM            dbo.farmMovimientoVentas INNER JOIN
                         dbo.farmMovimientoVentasDetalle ON
                         dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                         dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo INNER JOIN
                         dbo.farmMovimiento ON
                         dbo.farmMovimientoVentas.movNumero = dbo.farmMovimiento.MovNumero AND
                         dbo.farmMovimientoVentas.movTipo = dbo.farmMovimiento.MovTipo INNER JOIN
                         dbo.FactCatalogoBienesInsumos ON
                         dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
	WHERE        (dbo.farmMovimientoVentas.idTipoFinanciamiento = @idTipoFinanciamiento) AND
                         (dbo.farmMovimiento.idEstadoMovimiento = 1) and
						 dbo.farmMovimientoVentas.idCuentaAtencion =@cuenta


    insert into #myTempTable1(puntoCarga,codigo,descripcion,
	                          cantidad,precio,
							  idProducto )
	SELECT        'PROCEDIMIENTOS',dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
							 dbo.FacturacionServicioFinanciamientos.CantidadFinanciada,dbo.FacturacionServicioFinanciamientos.PrecioFinanciado,
							 dbo.FacturacionServicioFinanciamientos.idProducto
	FROM            dbo.FactCatalogoServicios INNER JOIN
							 dbo.FacturacionServicioFinanciamientos ON
							 dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto INNER
							  JOIN
							 dbo.FactOrdenServicio ON
							 dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	WHERE        (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9) AND
							 (dbo.FactOrdenServicio.idTipoFinanciamiento = @idTipoFinanciamiento) and
						 dbo.FactOrdenServicio.idCuentaAtencion =@cuenta

    select * from #myTempTable1	order by puntoCarga,descripcion
    drop table  #myTempTable1
end



GO
ALTER AUTHORIZATION ON [dbo].[FuaConsumoDeItemsXCuentaSigh] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuenteFinanciamientoSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuenteFinanciamientoSeleccionarPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.IdAtencion, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.IdTipoServicio,
                      dbo.Atenciones.idFuenteFinanciamiento, dbo.FuentesFinanciamiento.Descripcion
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
where       dbo.Atenciones.IdAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[FuenteFinanciamientoSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoAgregar]
	@Descripcion [varchar](50),
	@IdFuenteFinanciamiento [int],
	@idTipoConceptoFarmacia [int],
	@UtilizadoEn [int],
	@CodigoFuenteFinanciamientoSEM [varchar](2),
	@idAreaTramitaSeguros [int],
	@EsUsadoEnCaja [bit],
	@CodigoHIS [varchar](2),
	@IdUsuarioAuditoria [int],
	@IdTipoFinanciador [int],
	@Codigo [char](11),
	@TieneEPS [int],
	@CuentaParaUnidosis [int],
	@usadoEnFUnidosis [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO FuentesFinanciamiento (
		IdFuenteFinanciamiento,
		Descripcion,
		idTipoConceptoFarmacia,
		UtilizadoEn,
		CodigoFuenteFinanciamientoSEM,
		idAreaTramitaSeguros,
		EsUsadoEnCaja,
		CodigoHIS,
		idTipoFinanciador,
		codigo,TieneEPS,usadoEnFUnidosis,CuentaParaUnidosis)
	VALUES (
		@IdFuenteFinanciamiento,
		@Descripcion,
		@idTipoConceptoFarmacia,
		@UtilizadoEn,
		@CodigoFuenteFinanciamientoSEM,
		@idAreaTramitaSeguros,
		@EsUsadoEnCaja,
		@CodigoHIS,
		@IdTipoFinanciador,
		@Codigo,@TieneEPS,@usadoEnFUnidosis,@CuentaParaUnidosis)
	SET @IdFuenteFinanciamiento = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoDevuelveTodosSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoDevuelveTodosSegunFiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
If @Filtro <> ' '
	SET  @SQL =  'select * from FuentesFinanciamiento Where ' + @Filtro + ' order by descripcion'
ELSE
	SET  @SQL =  'select * from FuentesFinanciamiento order by descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoDevuelveTodosSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoEliminar]
	@IdFuenteFinanciamiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from FuentesFinanciamiento
where IdFuenteFinanciamiento = @IdFuenteFinanciamiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdFuenteFinanciamiento,'FuentesFinanciamiento'
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoFiltrarTodos]
WITH EXECUTE AS CALLER
AS
select idfuentefinanciamiento, descripcion,(Convert(varchar(5), idfuentefinanciamiento) + ' - ' + Descripcion) as DescripcionLarga  From FuentesFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoModificar]
	@Descripcion [varchar](50),
	@IdFuenteFinanciamiento [int],
	@idTipoConceptoFarmacia [int],
	@UtilizadoEn [int],
	@CodigoFuenteFinanciamientoSEM [varchar](2),
	@idAreaTramitaSeguros [int],
	@EsUsadoEnCaja [bit],
	@CodigoHIS [varchar](2),
	@IdUsuarioAuditoria [int],
	@IdTipoFinanciador [int],
	@Codigo [char](11),
	@TieneEPS [int],
	@usadoEnFUnidosis [int],
	@CuentaParaUnidosis [int]
WITH EXECUTE AS CALLER
AS
UPDATE FuentesFinanciamiento
		SET Descripcion = @Descripcion,
			idTipoConceptoFarmacia=@idTipoConceptoFarmacia,
			UtilizadoEn=@UtilizadoEn,
			CodigoFuenteFinanciamientoSEM=@CodigoFuenteFinanciamientoSEM,
			idAreaTramitaSeguros=@idAreaTramitaSeguros,
			EsUsadoEnCaja=@EsUsadoEnCaja,
			CodigoHIS=@CodigoHIS,
			idTipoFinanciador = @IdTipoFinanciador,
			codigo = @Codigo,TieneEPS=@TieneEPS,
			usadoEnFUnidosis=@usadoEnFUnidosis,
			CuentaParaUnidosis=@CuentaParaUnidosis
	WHERE IdFuenteFinanciamiento = @IdFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientosDevuelveIdTipoConceptoFarmacia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientosDevuelveIdTipoConceptoFarmacia]
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FuentesFinanciamiento where idFuenteFinanciamiento=@idFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientosDevuelveIdTipoConceptoFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSegunFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

if @lcFiltro<>''
   SET  @SQL =  'select * from FuentesFinanciamiento where '+@lcFiltro+'   order by descripcion '
else
  SET  @SQL =  'select * from FuentesFinanciamiento   order by descripcion '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSeleccionarPorCodigo]
	@Codigo [char](11)
WITH EXECUTE AS CALLER
AS
SELECT IdFuenteFinanciamiento,
		Descripcion,
		idTipoConceptoFarmacia,
		UtilizadoEn,
		CodigoFuenteFinanciamientoSEM,
		idAreaTramitaSeguros,
		EsUsadoEnCaja,
		CodigoHIS,
		idTipoFinanciador,
		codigo
	FROM FuentesFinanciamiento
	WHERE codigo = @Codigo
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSeleccionarPorId]
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FuentesFinanciamiento
where IdFuenteFinanciamiento = @IdFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSeleccionarPorTipoFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSeleccionarPorTipoFinanciamiento]
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select IdFuenteFinanciamiento, Descripcion,
convert(varchar(5), IdFuenteFinanciamiento)  + ' = ' + Descripcion  as DescripcionLarga
from FuentesFinanciamiento
where IdTipoFinanciamiento  = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSeleccionarPorTipoFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSeleccionarSoloConSeguros]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSeleccionarSoloConSeguros]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT
                                  dbo.FuentesFinanciamiento.Descripcion, dbo.FuentesFinanciamiento.IdFuenteFinanciamiento,
                                  dbo.TiposFinanciamiento.GeneraPago
             FROM          dbo.FuentesFinanciamiento RIGHT OUTER JOIN
                                  dbo.FuentesFinanciamientoTarifas ON
                                  dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FuentesFinanciamientoTarifas.idFuenteFinanciamiento LEFT OUTER JOIN
                                  dbo.TiposFinanciamiento ON dbo.FuentesFinanciamientoTarifas.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
             WHERE dbo.TiposFinanciamiento.generaPago>1 and dbo.FuentesFinanciamiento.UtilizadoEn in (1,2,3)
             ORDER BY dbo.FuentesFinanciamiento.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSeleccionarSoloConSeguros] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT FuentesFinanciamiento.IdFuenteFinanciamiento,
		FuentesFinanciamiento.Descripcion,  FuentesFinanciamiento.codigo
	from FuentesFinanciamiento order by FuentesFinanciamiento.idFuenteFinanciamiento
--select FuentesFinanciamiento.IdFuenteFinanciamiento,
--FuentesFinanciamiento.Descripcion,
--convert(varchar(5), TiposFInanciamiento.IdTipoFinanciamiento) + ' = ' + TiposFInanciamiento.Descripcion as TipoFinanciamiento
--from FuentesFinanciamiento
--left join TiposFinanciamiento on FuentesFinanciamiento.IdTipoFinanciamiento = TiposFInanciamiento.IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoSoloParticular]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoSoloParticular]
WITH EXECUTE AS CALLER
AS
select * from FuentesFinanciamiento where UtilizadoEn=2 or UtilizadoEn=3 or idFuenteFinanciamiento=1  order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoSoloParticular] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoTarifasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoTarifasAgregar]
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
insert into FuentesFinanciamientoTarifas (idFuenteFinanciamiento,idTipoFinanciamiento)
values (@IdFuenteFinanciamiento , @IdTipoFinanciamiento )
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoTarifasAgregarPorIdFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoTarifasAgregarPorIdFuenteFinanciamiento]
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
insert into FuentesFinanciamientoTarifas (idFuenteFinanciamiento,idTipoFinanciamiento)
values (@IdFuenteFinanciamiento,@IdTipoFinanciamiento )
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifasAgregarPorIdFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoTarifasEliminaPorIdFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoTarifasEliminaPorIdFuenteFinanciamiento]
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
delete from FuentesFinanciamientoTarifas where idFuenteFinanciamiento=@IdFuenteFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifasEliminaPorIdFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoTarifasSeleccionarPorIdFuenteFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoTarifasSeleccionarPorIdFuenteFinanciamiento]
	@IdFuenteFinanciamiento [int],
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from FuentesFinanciamientoTarifas where idFuenteFinanciamiento=@IdFuenteFinanciamiento
 and  idTipoFinanciamiento=@IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifasSeleccionarPorIdFuenteFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[FuentesFinanciamientoTarifasSoloTarifa]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[FuentesFinanciamientoTarifasSoloTarifa]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT
                         dbo.FuentesFinanciamientoTarifas.idTipoFinanciamiento
FROM            dbo.TiposFinanciamiento RIGHT OUTER JOIN
                         dbo.FuentesFinanciamientoTarifas ON
                         dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.FuentesFinanciamientoTarifas.idTipoFinanciamiento
                          LEFT OUTER JOIN
                         dbo.FuentesFinanciamiento ON
                         dbo.FuentesFinanciamientoTarifas.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE     (dbo.FuentesFinanciamiento.UtilizadoEn = 1 OR dbo.FuentesFinanciamiento.UtilizadoEn = 3)
          and dbo.TiposFinanciamiento.SeIngresPrecios = 1
GO
ALTER AUTHORIZATION ON [dbo].[FuentesFinanciamientoTarifasSoloTarifa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[generadorNroHistoriaClinicaActualizaNroAutomaticoDeHistoriaClinica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[generadorNroHistoriaClinicaActualizaNroAutomaticoDeHistoriaClinica]
WITH EXECUTE AS CALLER
AS
DECLARE @NroHistoriaClinica as integer
SET  @NroHistoriaClinica = (select top 1 nroHistoriaClinica from Pacientes where IdTipoNumeracion =1 order by nroHistoriaClinica desc)
UPDATE generadorNroHistoriaClinica set nroHistoriaClinica=@NroHistoriaClinica where idNumerador=17
GO
ALTER AUTHORIZATION ON [dbo].[generadorNroHistoriaClinicaActualizaNroAutomaticoDeHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[generadorNroHistoriaClinicaActualizaNroHistoria]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[generadorNroHistoriaClinicaActualizaNroHistoria]
	@lnNroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
update generadorNroHistoriaClinica set nroHistoriaClinica=@lnNroHistoriaClinica  where idNumerador=17
GO
ALTER AUTHORIZATION ON [dbo].[generadorNroHistoriaClinicaActualizaNroHistoria] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaActualizarNroHistoriaClinica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaActualizarNroHistoriaClinica]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
update generadorNroHistoriaClinica set nroHistoriaClinica=@NroHistoriaClinica where idNumerador=17
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaActualizarNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaAgregar]
	@IdTipoNumeracion [int],
	@IdNumerador [int] OUTPUT,
	@NroHistoriaClinica [decimal](18, 0),
	@Estado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into GeneradorNroHistoriaClinica (
IdTipoNumeracion,NroHistoriaClinica,Estado) values (
@IdTipoNumeracion,@NroHistoriaClinica,@Estado)
set @IdNumerador = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdNumerador,'GeneradorNroHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaEliminar]
	@IdNumerador [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from GeneradorNroHistoriaClinica
where IdNumerador = @IdNumerador
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdNumerador,'GeneradorNroHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaModificar]
	@IdTipoNumeracion [int],
	@IdNumerador [int],
	@NroHistoriaClinica [decimal](18, 0),
	@Estado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update GeneradorNroHistoriaClinica
set
IdTipoNumeracion = @IdTipoNumeracion,
NroHistoriaClinica = @NroHistoriaClinica,
Estado = @Estado
where IdNumerador = @IdNumerador
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdNumerador,'GeneradorNroHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaSeleccionarPorId]
	@IdNumerador [int]
WITH EXECUTE AS CALLER
AS
select * from GeneradorNroHistoriaClinica
where IdNumerador = @IdNumerador
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[GeneradorNroHistoriaClinicaXidTipoNumeracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[GeneradorNroHistoriaClinicaXidTipoNumeracion]
	@IdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
select * from GeneradorNroHistoriaClinica where idTipoNumeracion=@IdTipoNumeracion
GO
ALTER AUTHORIZATION ON [dbo].[GeneradorNroHistoriaClinicaXidTipoNumeracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ActualizarNroRegistroHisDetalle]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ActualizarNroRegistroHisDetalle]
	@HisDetalle [int],
	@NumReg [int]
WITH EXECUTE AS CALLER
AS
update HIS_DETALLE
set
NroRegistroLote = @NumReg
where IDHISDETALLE=@HisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@codetni,'HIS_tabetnia'
GO
ALTER AUTHORIZATION ON [dbo].[His_ActualizarNroRegistroHisDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_BuscaResponsableFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_BuscaResponsableFiltro]
	@IdEstablecimiento [int],
	@idservicio [int],
	@Anio [varchar](4),
	@Mes [varchar](2),
	@Nombre [varchar](100)
WITH EXECUTE AS CALLER
AS
if (@idservicio=0)
	begin
		select distinct p.idestablecimiento,est.nombre Establecimiento,p.idservicio,
		s.nombre as Servicio,p.idmedico,m.colegiatura,m.idempleado,
		ltrim(e.nombres) + ' ' + ltrim(e.apellidopaterno) + ' ' + ltrim(e.apellidomaterno) as responsable,
		p.idturno,t.descripcion as Turno,year(p.fechaprogramada) as anio, hm.descripcion as mes
		from his_progmedestmr p
		inner join medicos m on p.idmedico=m.idmedico
		inner join empleados e on e.idempleado=m.idempleado
		inner join his_turnos t on p.idturno=t.idhisturno
		inner join establecimientos est on est.idestablecimiento=p.idestablecimiento
		inner join servicios s on p.idservicio=s.idservicio
		inner join his_meses hm on hm.idmes=month(p.fechaprogramada)
		where p.idestablecimiento=@IdEstablecimiento
		and year(p.fechaprogramada)=@Anio and month(p.fechaprogramada)=@Mes
		and ltrim(e.nombres) + ' ' + ltrim(e.apellidopaterno) + ' ' + ltrim(e.apellidomaterno) like '%' + @Nombre + '%'
	end
else
	begin
		select distinct p.idestablecimiento,est.nombre Establecimiento,p.idservicio,
		s.nombre as Servicio,p.idmedico,m.colegiatura,m.idempleado,
		ltrim(e.nombres) + ' ' + ltrim(e.apellidopaterno) + ' ' + ltrim(e.apellidomaterno) as responsable,
		p.idturno,t.descripcion as Turno,year(p.fechaprogramada) as anio, hm.descripcion as mes
		from his_progmedestmr p
		inner join medicos m on p.idmedico=m.idmedico
		inner join empleados e on e.idempleado=m.idempleado
		inner join his_turnos t on p.idturno=t.idhisturno
		inner join establecimientos est on est.idestablecimiento=p.idestablecimiento
		inner join servicios s on p.idservicio=s.idservicio
		inner join his_meses hm on hm.idmes=month(p.fechaprogramada)
		where p.idestablecimiento=@IdEstablecimiento and p.idservicio=@idservicio
		and year(p.fechaprogramada)=@Anio and month(p.fechaprogramada)=@Mes
		and ltrim(e.nombres) + ' ' + ltrim(e.apellidopaterno) + ' ' + ltrim(e.apellidomaterno) like '%' + @Nombre + '%'
	end
GO
ALTER AUTHORIZATION ON [dbo].[HIS_BuscaResponsableFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraAgregar]
	@IdHisCabecera [int] OUTPUT,
	@IdHisLote [int],
	@NroHojaHis [int],
	@NroFormato [int],
	@IdTurno [int],
	@IdUsuario [int],
	@IdEstadoHis [int],
	@IdMedico [int],
	@IdEstablecimiento [int],
	@IdServicio [int],
	@FechaCreacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Cabecera (
IdHisLote,NroHojaHis,NroFormato,IdTurno,IdUsuario,IdEstadoHis,IdMedico,IdEstablecimiento, IdServicio,FechaCreacion) values (
@IdHisLote,@NroHojaHis,@NroFormato,@IdTurno,@IdUsuario,@IdEstadoHis,@IdMedico,@IdEstablecimiento, @IdServicio,@FechaCreacion)
set @IdHisCabecera = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisCabecera,'HIS_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraEliminar]
	@IdHisCabecera [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Cabecera
where IdHisCabecera = @IdHisCabecera
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisCabecera,'HIS_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraModificar]
	@IdHisCabecera [int],
	@IdHisLote [int],
	@NroHojaHis [int],
	@NroFormato [int],
	@IdTurno [int],
	@IdUsuario [int],
	@IdEstadoHis [int],
	@IdMedico [int],
	@IdEstablecimiento [int],
	@IdServicio [int],
	@FechaCreacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE HIS_Cabecera
set
IdHisLote = @IdHisLote,
NroHojaHis = @NroHojaHis,
NroFormato = @NroFormato,
IdTurno = @IdTurno,
IdUsuario = @IdUsuario,
IdEstadoHis = @IdEstadoHis,
IdMedico = @IdMedico,
IdEstablecimiento = @IdEstablecimiento,
IdServicio = @IdServicio,
FechaCreacion = @FechaCreacion
where IdHisCabecera = @IdHisCabecera

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisCabecera,'HIS_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraNumeroHojasUtilizadas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraNumeroHojasUtilizadas]
	@IdHisLote [int]
WITH EXECUTE AS CALLER
AS
select count(IdHisCabecera) as CantidadUtilizada from HIS_Cabecera where IdHisLote = @IdHisLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraNumeroHojasUtilizadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraObtenerDatosLoteNroHojaLibre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraObtenerDatosLoteNroHojaLibre]
	@ml_IdLote [int]
WITH EXECUTE AS CALLER
AS
SELECT ISNULL(max(NroHojaHis),0) + 1 AS NroHojaHis FROM HIS_Cabecera
WHERE IdHisLote = @ml_IdLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraObtenerDatosLoteNroHojaLibre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_cabeceraObtenerDatosNroFormatoLibre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_cabeceraObtenerDatosNroFormatoLibre]
	@mi_anio [int],
	@ml_IdEstablecimientoActual [int]
WITH EXECUTE AS CALLER
AS
SELECT ISNULL(MAX(NroFormato),1) AS NroFormato FROM his_cabecera
 WHERE IdHisLote IN
(SELECT IdHisLote
 FROM HIS_Lotes
 WHERE Anio = @mi_anio
AND IdEstablecimiento = @ml_IdEstablecimientoActual )
GO
ALTER AUTHORIZATION ON [dbo].[his_cabeceraObtenerDatosNroFormatoLibre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CabeceraSeleccionarPorId]
	@IdHisCabecera [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Cabecera
where IdHisCabecera = @IdHisCabecera
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_cabeceraSeleccionarXnroHojaHIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_cabeceraSeleccionarXnroHojaHIS]
	@IdHisLote [int],
	@NroHojaHis [int]
WITH EXECUTE AS CALLER
AS
SELECT IdHisCabecera FROM his_cabecera
 WHERE IdHisLote = @IdHisLote
AND NroHojaHIS = @NroHojaHis
GO
ALTER AUTHORIZATION ON [dbo].[his_cabeceraSeleccionarXnroHojaHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_cabeceraXlote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_cabeceraXlote]
	@IdLote [int]
WITH EXECUTE AS CALLER
AS
SELECT TOP 1 NroHojaHis FROM His_cabecera WHERE [IdHislote] = @IdLote  order by NroHojaHis DESC
GO
ALTER AUTHORIZATION ON [dbo].[His_cabeceraXlote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesAgregar]
	@IdHisCodActvidad [int] OUTPUT,
	@IdTipoAtencion [int],
	@CodigoActividad [char](6),
	@Descripcion [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_CodigosActividades (
IdTipoAtencion,CodigoActividad,Descripcion) values (
@IdTipoAtencion,@CodigoActividad,@Descripcion)
set @IdHisCodActvidad = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisCodActvidad,'HIS_CodigosActividades'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesEliminar]
	@IdHisCodActvidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_CodigosActividades
where IdHisCodActvidad = @IdHisCodActvidad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisCodActvidad,'HIS_CodigosActividades'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesModificar]
	@IdHisCodActvidad [int],
	@IdTipoAtencion [int],
	@CodigoActividad [char](6),
	@Descripcion [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_CodigosActividades
set
IdTipoAtencion = @IdTipoAtencion,
CodigoActividad = @CodigoActividad,
Descripcion = @Descripcion
where IdHisCodActvidad = @IdHisCodActvidad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisCodActvidad,'HIS_CodigosActividades'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesObtenerListaCodigosActividades]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesObtenerListaCodigosActividades]
	@ml_CodigoTipoActividad [int]
WITH EXECUTE AS CALLER
AS
SELECT [IdHisCodActvidad], [IdTipoAtencion], [CodigoActividad], [Descripcion]
 From [sigh].[dbo].[HIS_CodigosActividades]
If @ml_CodigoTipoActividad <> 0
    SELECT [IdHisCodActvidad], [IdTipoAtencion], [CodigoActividad], [Descripcion]
    From [sigh].[dbo].[HIS_CodigosActividades]
    WHERE IdTipoAtencion = @ml_CodigoTipoActividad
else
    SELECT [IdHisCodActvidad], [IdTipoAtencion], [CodigoActividad], [Descripcion]
    From [sigh].[dbo].[HIS_CodigosActividades]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesObtenerListaCodigosActividades] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesSeleccionarPorCodigoDescripcion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesSeleccionarPorCodigoDescripcion]
	@CodigoActividad [varchar](6),
	@Descripcion [varchar](100)
WITH EXECUTE AS CALLER
AS
select * from HIS_CodigosActividades
where CodigoActividad  like '%' + @CodigoActividad + '%' and Descripcion like '%' + @Descripcion + '%'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesSeleccionarPorCodigoDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CodigosActividadesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_CodigosActividadesSeleccionarPorId]
	@IdHisCodActvidad [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_CodigosActividades
where IdHisCodActvidad = @IdHisCodActvidad
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CodigosActividadesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_colegiosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_colegiosAgregar]
	@cod_col [char](2) OUTPUT,
	@des_col [char](41),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_colegios (
des_col) values (
@des_col)
set @cod_col = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@cod_col,'HIS_colegios'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_colegiosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_colegiosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_colegiosEliminar]
	@cod_col [char](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_colegios
where cod_col = @cod_col
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@cod_col,'HIS_colegios'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_colegiosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_colegiosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_colegiosModificar]
	@cod_col [char](2),
	@des_col [char](41),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_colegios
set
des_col = @des_col
where cod_col = @cod_col
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@cod_col,'HIS_colegios'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_colegiosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_colegiosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_colegiosSeleccionarPorId]
	@cod_col [char](2)
WITH EXECUTE AS CALLER
AS
select * from HIS_colegios
where cod_col = @cod_col
GO
ALTER AUTHORIZATION ON [dbo].[HIS_colegiosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ConsultaDxHisDetalleVerif]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ConsultaDxHisDetalleVerif]
	@ml_IdDetalleHIS [int]
WITH EXECUTE AS CALLER
AS
SELECT
 HD.IdHisDetalle,
 HD.IdCIE,
 ('(' + D.CodigoDiagCpt + ') - ' + D.DescripcionDiagCpt) AS DESCRIPCION_CIE,
 HD.IdSubClasificacionDX,
 HD.CodLAB,
'' AS MSG_ALERTA,
 0 [IdEstado]
 From HIS_DetalleDx_Verifica HD
 inner join HIS_FACTCATALOGOSERVICIOS D on HD.IdCIE = D.IdDiagCpt
WHERE  HD.IdHisDetalle =@ml_IdDetalleHIS
GO
ALTER AUTHORIZATION ON [dbo].[His_ConsultaDxHisDetalleVerif] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ConsultarDiagnosticosOmitidosHIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ConsultarDiagnosticosOmitidosHIS]
	@Anio [int],
	@Mes [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 100 PERCENT dbo.HIS_VALIDACIONES.CODVALIDACION, dbo.HIS_VALIDACIONES.TXTDESCRIPCION, dbo.HIS_VALIDACIONES.TXTVALIDACION,
						  COUNT(*) AS CANTIDAD, COUNT(*) /
							  (SELECT     COUNT(*) AS Expr1
								FROM          dbo.HIS_DxOmitidos AS A INNER JOIN
													   dbo.HIS_Lotes AS B ON A.IdLote = B.IdHisLote
								WHERE      (B.Mes = @Mes) AND (B.Anio = @Anio)) AS PORCENTAJE
	FROM         dbo.HIS_Lotes INNER JOIN
						  dbo.Establecimientos ON dbo.HIS_Lotes.IdEstablecimiento = dbo.Establecimientos.IdEstablecimiento INNER JOIN
						  dbo.HIS_DxOmitidos ON dbo.HIS_Lotes.IdHisLote = dbo.HIS_DxOmitidos.IdLote INNER JOIN
						  dbo.HIS_VALIDACIONES ON dbo.HIS_DxOmitidos.CODVALIDACION = dbo.HIS_VALIDACIONES.CODVALIDACION
	WHERE     (dbo.HIS_Lotes.Mes = @Mes) AND (dbo.HIS_Lotes.Anio = @Anio) AND (dbo.HIS_Lotes.IdEstablecimiento IN
							  (SELECT     IdEstablecimiento
								FROM          dbo.His_Establecimientos))
	GROUP BY dbo.HIS_VALIDACIONES.CODVALIDACION, dbo.HIS_VALIDACIONES.TXTDESCRIPCION, dbo.HIS_VALIDACIONES.TXTVALIDACION
	ORDER BY CANTIDAD DESC
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ConsultarDiagnosticosOmitidosHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ConsultarDxPorAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ConsultarDxPorAtencion]
	@IdHisDetalle [int]
WITH EXECUTE AS CALLER
AS
select a.idcie as codigo1,a.IdSubClasificacionDX as diagnost1,a.codlab as labconf1
from HIS_detallediagnostico a
where a.IdHisDetalle = @IdHisDetalle
GO
ALTER AUTHORIZATION ON [dbo].[His_ConsultarDxPorAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ConsultarEstadosLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ConsultarEstadosLote]
WITH EXECUTE AS CALLER
AS
select idestado,descripcion from his_estadoslote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ConsultarEstadosLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ConsultarHojasRegistradas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ConsultarHojasRegistradas]
	@IdLote [int],
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM HIS_Cabecera
WHERE IdHisLote = @IdLote AND IdEstablecimiento=@IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[His_ConsultarHojasRegistradas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ConsultarRegistroDetalleHis]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ConsultarRegistroDetalleHis]
	@IdHisDetalle [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HIS_Detalle.NroRegistroLote, dbo.HIS_Lotes.IdHisLote, dbo.HIS_Lotes.Lote, dbo.HIS_Cabecera.IdHisCabecera,
                      dbo.HIS_Lotes.IdEstablecimiento, dbo.HIS_Cabecera.NroHojaHis, dbo.HIS_Detalle.IdHisDetalle, dbo.HIS_Detalle.NroRegistroHoja,
                      dbo.HIS_Detalle.DiaAtencion,dbo.HIS_Detalle.IdTipoAtencion,
		      'HC_FF_COD' = CASE
		           WHEN dbo.HIS_Detalle.IdTipoAtencion = 1    /*'CODIGO DE ATENCION*/
		           THEN dbo.HIS_EstablecPacienteHIS.NroHC_FF
		           ELSE
		           dbo.HIS_Detalle.CodigoActividad
		      END
	, dbo.Paises.IdPais, dbo.Paises.Codigo AS Codigo,
                      dbo.HIS_Paciente.IdTipoDocumento, CONVERT(varchar(10), dbo.TiposDocIdentidad.IdDocIdentidad)
                      + ' - ' + dbo.TiposDocIdentidad.Descripcion AS Documento, dbo.HIS_Paciente.NroDocIdentidad, dbo.HIS_Paciente.NroHijo,
                      dbo.HIS_Detalle.IdTipoFinanciamiento, CONVERT(varchar(10), dbo.HIS_Detalle.IdTipoFinanciamiento)
                      + ' - ' + dbo.HIS_Financiador.DescripcionFinancHis AS Financiamiento, dbo.HIS_Paciente.IdEtnia, CONVERT(varchar(10), dbo.HIS_Paciente.IdEtnia)
                      + ' - ' + dbo.HIS_tabetnia.desetni AS Etnia, dbo.HIS_Detalle.IdDistrito, CONVERT(varchar(10), dbo.HIS_Detalle.IdDistrito)
                      + ' - ' + dbo.Distritos.Nombre AS Distrito, dbo.HIS_Detalle.Edad, dbo.HIS_Detalle.IdTipoEdad, CONVERT(varchar(10), dbo.HIS_TipoEdad.CodigoEdad)
                      + ' - ' + dbo.HIS_TipoEdad.Descripcion AS TipoEdad, dbo.HIS_Paciente.Sexo, dbo.HIS_Detalle.Peso, dbo.HIS_Detalle.Talla,
                      dbo.HIS_Detalle.IdEstadoaEstablec, dbo.HIS_Detalle.IdEstadoaServicio
FROM         dbo.HIS_Lotes INNER JOIN
                      dbo.HIS_Cabecera ON dbo.HIS_Lotes.IdHisLote = dbo.HIS_Cabecera.IdHisLote INNER JOIN
                      dbo.HIS_Detalle ON dbo.HIS_Cabecera.IdHisCabecera = dbo.HIS_Detalle.IdHisCabecera INNER JOIN
                      dbo.His_Establecimientos ON dbo.HIS_Lotes.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.HIS_Paciente ON dbo.HIS_Detalle.IdHisPaciente = dbo.HIS_Paciente.IdHisPaciente LEFT JOIN
                      dbo.HIS_EstablecPacienteHIS ON  dbo.HIS_Paciente.IdHisPaciente = dbo.HIS_EstablecPacienteHIS.IdHisPaciente AND
	        dbo.HIS_EstablecPacienteHIS.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.TiposDocIdentidad ON dbo.TiposDocIdentidad.IdDocIdentidad = dbo.HIS_Paciente.IdTipoDocumento LEFT JOIN
                      dbo.Paises ON dbo.HIS_Paciente.IdNacionalidad = dbo.Paises.IdPais LEFT JOIN
                      dbo.HIS_Financiador ON dbo.HIS_Detalle.IdTipoFinanciamiento = dbo.HIS_Financiador.IdCodigoFinancHis LEFT JOIN
                      dbo.HIS_tabetnia ON dbo.HIS_Paciente.IdEtnia = dbo.HIS_tabetnia.codetni LEFT JOIN
                      dbo.Distritos ON dbo.HIS_Detalle.IdDistrito = dbo.Distritos.IdDistrito LEFT JOIN
                      dbo.HIS_TipoEdad ON dbo.HIS_Detalle.IdTipoEdad = dbo.HIS_TipoEdad.IdHisTipoEdad
WHERE dbo.HIS_Detalle.IdHisDetalle=@IdHisDetalle
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ConsultarRegistroDetalleHis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ConsultarRegistrosTotalesLotes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ConsultarRegistrosTotalesLotes]
	@IdHisLote [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HIS_Detalle.NroRegistroLote, dbo.HIS_Lotes.IdHisLote, dbo.HIS_Lotes.Lote, dbo.HIS_Cabecera.IdHisCabecera,
                      dbo.HIS_Lotes.IdEstablecimiento, dbo.HIS_Cabecera.NroHojaHis, dbo.HIS_Detalle.IdHisDetalle, dbo.HIS_Detalle.NroRegistroHoja,
                      dbo.HIS_Detalle.DiaAtencion,dbo.HIS_Detalle.IdTipoAtencion,
		      'HC_FF_COD' = CASE
		           WHEN dbo.HIS_Detalle.IdTipoAtencion = 1    /*'CODIGO DE ATENCION*/
		           THEN dbo.HIS_EstablecPacienteHIS.NroHC_FF
		           ELSE
		           dbo.HIS_Detalle.CodigoActividad
		      END
	, dbo.Paises.IdPais, dbo.Paises.Codigo AS Codigo,
                      dbo.HIS_Paciente.IdTipoDocumento, CONVERT(varchar(10), dbo.TiposDocIdentidad.IdDocIdentidad)
                      + ' - ' + dbo.TiposDocIdentidad.Descripcion AS Documento, dbo.HIS_Paciente.NroDocIdentidad, dbo.HIS_Paciente.NroHijo,
                      dbo.HIS_Detalle.IdTipoFinanciamiento, CONVERT(varchar(10), dbo.HIS_Detalle.IdTipoFinanciamiento)
                      + ' - ' + dbo.HIS_Financiador.DescripcionFinancHis AS Financiamiento, dbo.HIS_Paciente.IdEtnia, CONVERT(varchar(10), dbo.HIS_Paciente.IdEtnia)
                      + ' - ' + dbo.HIS_tabetnia.desetni AS Etnia, dbo.HIS_Detalle.IdDistrito, CONVERT(varchar(10), dbo.HIS_Detalle.IdDistrito)
                      + ' - ' + dbo.Distritos.Nombre AS Distrito, dbo.HIS_Detalle.Edad, dbo.HIS_Detalle.IdTipoEdad, CONVERT(varchar(10), dbo.HIS_TipoEdad.CodigoEdad)
                      + ' - ' + dbo.HIS_TipoEdad.Descripcion AS TipoEdad, dbo.HIS_Paciente.Sexo, dbo.HIS_Detalle.Peso, dbo.HIS_Detalle.Talla,
                      dbo.HIS_Detalle.IdEstadoaEstablec, dbo.HIS_Detalle.IdEstadoaServicio
FROM         dbo.HIS_Lotes INNER JOIN
                      dbo.HIS_Cabecera ON dbo.HIS_Lotes.IdHisLote = dbo.HIS_Cabecera.IdHisLote INNER JOIN
                      dbo.HIS_Detalle ON dbo.HIS_Cabecera.IdHisCabecera = dbo.HIS_Detalle.IdHisCabecera INNER JOIN
                      dbo.His_Establecimientos ON dbo.HIS_Lotes.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.HIS_Paciente ON dbo.HIS_Detalle.IdHisPaciente = dbo.HIS_Paciente.IdHisPaciente LEFT JOIN
                      dbo.HIS_EstablecPacienteHIS ON  dbo.HIS_Paciente.IdHisPaciente = dbo.HIS_EstablecPacienteHIS.IdHisPaciente AND
	        dbo.HIS_EstablecPacienteHIS.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.TiposDocIdentidad ON dbo.TiposDocIdentidad.IdDocIdentidad = dbo.HIS_Paciente.IdTipoDocumento LEFT JOIN
                      dbo.Paises ON dbo.HIS_Paciente.IdNacionalidad = dbo.Paises.IdPais LEFT JOIN
                      dbo.HIS_Financiador ON dbo.HIS_Detalle.IdTipoFinanciamiento = dbo.HIS_Financiador.IdCodigoFinancHis LEFT JOIN
                      dbo.HIS_tabetnia ON dbo.HIS_Paciente.IdEtnia = dbo.HIS_tabetnia.codetni LEFT JOIN
                      dbo.Distritos ON dbo.HIS_Detalle.IdDistrito = dbo.Distritos.IdDistrito LEFT JOIN
                      dbo.HIS_TipoEdad ON dbo.HIS_Detalle.IdTipoEdad = dbo.HIS_TipoEdad.IdHisTipoEdad
WHERE dbo.HIS_Lotes.IdHisLote=@IdHisLote
ORDER BY dbo.HIS_Detalle.NroRegistroLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ConsultarRegistrosTotalesLotes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ConsultarRegMuestraLotes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ConsultarRegMuestraLotes]
	@IdHisLote [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HIS_Detalle_Verifica.NroRegistroLote, dbo.HIS_Lotes.IdHisLote, dbo.HIS_Lotes.Lote, dbo.HIS_Cabecera.IdHisCabecera,
                      dbo.HIS_Lotes.IdEstablecimiento, dbo.HIS_Cabecera.NroHojaHis, dbo.HIS_Detalle_Verifica.IdHisDetalle, dbo.HIS_Detalle_Verifica.NroRegistroHoja,
                      dbo.HIS_Detalle_Verifica.DiaAtencion,dbo.HIS_Detalle_Verifica.IdTipoAtencion,
		      'HC_FF_COD' = CASE
		           WHEN dbo.HIS_Detalle_Verifica.IdTipoAtencion = 1    /*'CODIGO DE ATENCION*/
		           THEN dbo.HIS_Detalle_Verifica.NroHC_FF
		           ELSE
		           dbo.HIS_Detalle_Verifica.CodigoActividad
		      END
	, dbo.Paises.IdPais, dbo.Paises.Codigo AS Codigo,
                      dbo.HIS_Detalle_Verifica.IdTipoDocumento, CONVERT(varchar(10), dbo.TiposDocIdentidad.IdDocIdentidad)
                      + ' - ' + dbo.TiposDocIdentidad.Descripcion AS Documento, dbo.HIS_Detalle_Verifica.NroDocIdentidad, dbo.HIS_Detalle_Verifica.NroHijo,
                      dbo.HIS_Detalle_Verifica.IdTipoFinanciamiento, CONVERT(varchar(10), dbo.HIS_Detalle_Verifica.IdTipoFinanciamiento)
                      + ' - ' + dbo.HIS_Financiador.DescripcionFinancHis AS Financiamiento, dbo.HIS_Detalle_Verifica.IdEtnia, CONVERT(varchar(10), dbo.HIS_Detalle_Verifica.IdEtnia)
                      + ' - ' + dbo.HIS_tabetnia.desetni AS Etnia, dbo.HIS_Detalle_Verifica.IdDistrito, CONVERT(varchar(10), dbo.HIS_Detalle_Verifica.IdDistrito)
                      + ' - ' + dbo.Distritos.Nombre AS Distrito, dbo.HIS_Detalle_Verifica.Edad, dbo.HIS_Detalle_Verifica.IdTipoEdad, CONVERT(varchar(10), dbo.HIS_TipoEdad.CodigoEdad)
                      + ' - ' + dbo.HIS_TipoEdad.Descripcion AS TipoEdad, dbo.HIS_Detalle_Verifica.Sexo, dbo.HIS_Detalle_Verifica.Peso, dbo.HIS_Detalle_Verifica.Talla,
                      dbo.HIS_Detalle_Verifica.IdEstadoaEstablec, dbo.HIS_Detalle_Verifica.IdEstadoaServicio, dbo.HIS_Detalle_Verifica.Registrado,dbo.HIS_Detalle_Verifica.Coincide,
		      'EsRegistrado' = CASE
		           WHEN dbo.HIS_Detalle_Verifica.Registrado = 0    /*'REGISTRADO*/
		           THEN ''
		           ELSE
		           'Digitado'
		      END
FROM         dbo.HIS_Lotes INNER JOIN
                      dbo.HIS_Cabecera ON dbo.HIS_Lotes.IdHisLote = dbo.HIS_Cabecera.IdHisLote INNER JOIN
                      dbo.HIS_Detalle_Verifica ON dbo.HIS_Cabecera.IdHisCabecera = dbo.HIS_Detalle_Verifica.IdHisCabecera LEFT JOIN
                      dbo.His_Establecimientos ON dbo.HIS_Lotes.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.TiposDocIdentidad ON dbo.TiposDocIdentidad.IdDocIdentidad = dbo.HIS_Detalle_Verifica.IdTipoDocumento LEFT JOIN
                      dbo.Paises ON dbo.HIS_Detalle_Verifica.IdNacionalidad = dbo.Paises.IdPais LEFT JOIN
                      dbo.HIS_Financiador ON dbo.HIS_Detalle_Verifica.IdTipoFinanciamiento = dbo.HIS_Financiador.IdCodigoFinancHis LEFT JOIN
                      dbo.HIS_tabetnia ON dbo.HIS_Detalle_Verifica.IdEtnia = dbo.HIS_tabetnia.codetni LEFT JOIN
                      dbo.Distritos ON dbo.HIS_Detalle_Verifica.IdDistrito = dbo.Distritos.IdDistrito LEFT JOIN
                      dbo.HIS_TipoEdad ON dbo.HIS_Detalle_Verifica.IdTipoEdad = dbo.HIS_TipoEdad.IdHisTipoEdad
WHERE dbo.HIS_Lotes.IdHisLote=@IdHisLote
ORDER BY dbo.HIS_Detalle_Verifica.NroRegistroLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ConsultarRegMuestraLotes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ConsultarTotalRegistrosLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_ConsultarTotalRegistrosLote]
	@IdLote [int],
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM HIS_Cabecera C INNER JOIN HIS_DETALLE D ON C.IDHISCABECERA=D.IDHISCABECERA
WHERE C.IdHisLote = @IdLote AND C.IdEstablecimiento=@IdEstablecimiento
ORDER BY C.NROHOJAHIS ASC,D.NROREGISTROHOJA ASC
GO
ALTER AUTHORIZATION ON [dbo].[His_ConsultarTotalRegistrosLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_CONSULTATOTALREGISTROS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_CONSULTATOTALREGISTROS]
	@idestablecimiento [int],
	@idhislote [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM HIS_CABECERA C
INNER JOIN HIS_DETALLE D ON C.IDHISCABECERA=D.IDHISCABECERA
INNER JOIN HIS_LOTES L ON L.IDHISLOTE=C.IDHISLOTE
WHERE L.IDHISLOTE=@idhislote and L.IDESTABLECIMIENTO=@idestablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_CONSULTATOTALREGISTROS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DatosEstablecimientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DatosEstablecimientoAgregar]
	@IdDatoEstablec [int] OUTPUT,
	@IdEstablecimiento [int],
	@Color [varchar](30),
	@Turnos [int],
	@UltimoNroFormatoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_DatosEstablecimiento (
IdEstablecimiento,Color,Turnos,UltimoNroFormatoHIS) values (
@IdEstablecimiento,@Color,@Turnos,@UltimoNroFormatoHIS)
set @IdDatoEstablec = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdDatoEstablec,'HIS_DatosEstablecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DatosEstablecimientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DatosEstablecimientoEliminar]
	@IdDatoEstablec [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_DatosEstablecimiento
where IdDatoEstablec = @IdDatoEstablec
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDatoEstablec,'HIS_DatosEstablecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DatosEstablecimientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DatosEstablecimientoModificar]
	@IdDatoEstablec [int],
	@IdEstablecimiento [int],
	@Color [varchar](30),
	@Turnos [int],
	@UltimoNroFormatoHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_DatosEstablecimiento
set
IdEstablecimiento = @IdEstablecimiento,
Color = @Color,
Turnos = @Turnos,
UltimoNroFormatoHIS = @UltimoNroFormatoHIS
where IdDatoEstablec = @IdDatoEstablec
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDatoEstablec,'HIS_DatosEstablecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DatosEstablecimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DatosEstablecimientoSeleccionarPorId]
	@IdDatoEstablec [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_DatosEstablecimiento
where IdDatoEstablec = @IdDatoEstablec
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DatosEstablecimientoXidEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_DatosEstablecimientoXidEstablecimiento]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
Select D.IdDepartamento, D.Nombre as NombreDepartamento,
 P.IdProvincia, P.Nombre as NombreProvincia,
 DS.IdDistrito, DS.Nombre as NombreDistrito,
 E.IdEstablecimiento, E.Codigo, E.Nombre as NombreEstablecimiento
 from Departamentos D inner join Provincias P
 on D.IdDepartamento = P.IdDepartamento inner join Distritos DS
 on P.IdProvincia = DS.IdProvincia inner join Establecimientos E
 on DS.IdDistrito = E.IdDistrito
 Where E.IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DatosEstablecimientoXidEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_Detalle_VerificaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_Detalle_VerificaAgregar]
	@IdHisDetalle [int],
	@IdHisCabecera [int],
	@IdTipoAtencion [int],
	@DiaAtencion [int],
	@Sexo [int],
	@IdNacionalidad [int],
	@NroDocIdentidad [varchar](12),
	@NroHijo [char](2),
	@IdEtnia [char](2),
	@IdTipoDocumento [int],
	@NroHC_FF [varchar](20),
	@CodigoActividad [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdDistrito [int],
	@IdTipoEdad [int],
	@Edad [int],
	@Talla [int],
	@Peso [char](50),
	@IdEstadoaEstablec [int],
	@IdEstadoaServicio [int],
	@NroRegistroLote [int],
	@NroRegistroHoja [int],
	@Registrado [int],
	@Coincide [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Detalle_Verifica (
IdHisDetalle,IdHisCabecera,IdTipoAtencion,DiaAtencion,Sexo,IdNacionalidad,NroDocIdentidad,NroHijo,IdEtnia,IdTipoDocumento,NroHC_FF,CodigoActividad,IdTipoFinanciamiento,IdDistrito,IdTipoEdad,Edad,Talla,Peso,IdEstadoaEstablec,IdEstadoaServicio,NroRegistroLote,NroRegistroHoja,Registrado,Coincide) values (
@IdHisDetalle,@IdHisCabecera,@IdTipoAtencion,@DiaAtencion,@Sexo,@IdNacionalidad,@NroDocIdentidad,@NroHijo,@IdEtnia,@IdTipoDocumento,@NroHC_FF,@CodigoActividad,@IdTipoFinanciamiento,@IdDistrito,@IdTipoEdad,@Edad,@Talla,@Peso,@IdEstadoaEstablec,@IdEstadoaServicio,@NroRegistroLote,@NroRegistroHoja,@Registrado,@Coincide)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisDetalle,'HIS_Detalle_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle_VerificaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_Detalle_VerificaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_Detalle_VerificaEliminar]
	@IdHisLote [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Detalledx_Verifica where IdHisDetalle in (select IdHisDetalle from his_cabecera where idhislote=@IdHisLote )
delete from HIS_Detalle_Verifica where IdHisDetalle in (select IdHisDetalle from his_cabecera where idhislote=@IdHisLote )
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisDetalle,'HIS_Detalle_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle_VerificaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_Detalle_VerificaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_Detalle_VerificaModificar]
	@IdHisDetalle [int],
	@IdHisCabecera [int],
	@IdTipoAtencion [int],
	@DiaAtencion [int],
	@Sexo [int],
	@IdNacionalidad [int],
	@NroDocIdentidad [varchar](12),
	@NroHijo [char](2),
	@IdEtnia [char](2),
	@IdTipoDocumento [int],
	@NroHC_FF [varchar](20),
	@CodigoActividad [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdDistrito [int],
	@IdTipoEdad [int],
	@Edad [int],
	@Talla [int],
	@Peso [char](50),
	@IdEstadoaEstablec [int],
	@IdEstadoaServicio [int],
	@NroRegistroLote [int],
	@NroRegistroHoja [int],
	@Registrado [int],
	@Coincide [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_Detalle_Verifica
set
IdHisCabecera = @IdHisCabecera,
IdTipoAtencion = @IdTipoAtencion,
DiaAtencion = @DiaAtencion,
Sexo = @Sexo,
IdNacionalidad = @IdNacionalidad,
NroDocIdentidad = @NroDocIdentidad,
NroHijo = @NroHijo,
IdEtnia = @IdEtnia,
IdTipoDocumento = @IdTipoDocumento,
NroHC_FF = @NroHC_FF,
CodigoActividad = @CodigoActividad,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdDistrito = @IdDistrito,
IdTipoEdad = @IdTipoEdad,
Edad = @Edad,
Talla = @Talla,
Peso = @Peso,
IdEstadoaEstablec = @IdEstadoaEstablec,
IdEstadoaServicio = @IdEstadoaServicio,
NroRegistroLote = @NroRegistroLote,
NroRegistroHoja = @NroRegistroHoja,
Registrado = @Registrado,
Coincide = @Coincide
where IdHisDetalle = @IdHisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisDetalle,'HIS_Detalle_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle_VerificaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_Detalle_VerificaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_Detalle_VerificaSeleccionarPorId]
	@IdHisDetalle [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Detalle_Verifica
where IdHisDetalle = @IdHisDetalle
GO
ALTER AUTHORIZATION ON [dbo].[HIS_Detalle_VerificaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleAgregar]
	@IdHisDetalle [int] OUTPUT,
	@IdHisCabecera [int],
	@IdTipoAtencion [int],
	@DiaAtencion [int],
	@IdHisPaciente [int],
	@CodigoActividad [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdDistrito [int],
	@IdTipoEdad [int],
	@Edad [int],
	@Talla [int],
	@Peso [varchar](50),
	@IdEstadoaEstablec [int],
	@IdEstadoaServicio [int],
	@NroRegistroLote [int],
	@NroRegistroHoja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Detalle (
IdHisCabecera,IdTipoAtencion,DiaAtencion,IdHisPaciente,CodigoActividad,IdTipoFinanciamiento,IdDistrito,IdTipoEdad,Edad,Talla,Peso,IdEstadoaEstablec,IdEstadoaServicio,NroRegistroLote,NroRegistroHoja) values (
@IdHisCabecera,@IdTipoAtencion,@DiaAtencion,@IdHisPaciente,@CodigoActividad,@IdTipoFinanciamiento,@IdDistrito,@IdTipoEdad,@Edad,@Talla,@Peso,@IdEstadoaEstablec,@IdEstadoaServicio,@NroRegistroLote,@NroRegistroHoja)
set @IdHisDetalle = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisDetalle,'HIS_Detalle'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoAgregar]
	@IdHisDetalleDiagnostico [int] OUTPUT,
	@IdHisDetalle [int],
	@IdCIE [int],
	@IdSubClasificacionDX [int],
	@CodLAB [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_DetalleDiagnostico (IdHisDetalle,IdCIE,IdSubClasificacionDX,CodLAB) values (
@IdHisDetalle,@IdCIE,@IdSubClasificacionDX,@CodLAB)
set @IdHisDetalleDiagnostico = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisDetalleDiagnostico,'HIS_DetalleDiagnostico'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoEliminar]
	@IdHisDetalleDiagnostico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_DetalleDiagnostico
where IdHisDetalle = @IdHisDetalleDiagnostico
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisDetalleDiagnostico,'HIS_DetalleDiagnostico'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoModificar]
	@IdHisDetalleDiagnostico [int],
	@IdHisDetalle [int],
	@IdCIE [int],
	@IdSubClasificacionDX [int],
	@CodLAB [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_DetalleDiagnostico
set
IdHisDetalle = @IdHisDetalle,
IdCIE = @IdCIE,
IdSubClasificacionDX = @IdSubClasificacionDX,
CodLAB = @CodLAB
where IdHisDetalleDiagnostico = @IdHisDetalleDiagnostico
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisDetalleDiagnostico,'HIS_DetalleDiagnostico'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnostico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnostico]
	@ml_IdCabeceraHIS [int]
WITH EXECUTE AS CALLER
AS
SELECT
 HD.IdHisDetalleDiagnostico,
 HD.IdHisDetalle,
 HD.IdCIE,
 ('(' + D.CodigoCIE10 + ') -  ' + D.Descripcion) AS DESCRIPCION_CIE,
 HD.IdSubClasificacionDX,
 HD.CodLAB,
 '' AS MSG_ALERTA,
 0 [IdEstado]
 From HIS_DetalleDiagnostico HD
inner join Diagnosticos D on HD.IdCIE = D.IdDiagnostico
 WHERE  HD.IdHisDetalle IN (SELECT [IdHISDetalle]
                 From [HIS_Detalle]
                WHERE  [IdHisCabecera] = @ml_IdCabeceraHIS)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnostico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnosticoPorIdDetalle]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnosticoPorIdDetalle]
	@ml_IdDetalleHIS [int]
WITH EXECUTE AS CALLER
AS
SELECT
 HD.IdHisDetalleDiagnostico,
 HD.IdHisDetalle,
 HD.IdCIE,
 ('(' + D.CodigoDiagCpt + ') - ' + D.DescripcionDiagCpt) AS DESCRIPCION_CIE,
 HD.IdSubClasificacionDX,
 HD.CodLAB,
'' AS MSG_ALERTA,
 0 [IdEstado]
 From HIS_DetalleDiagnostico HD
 inner join HIS_FACTCATALOGOSERVICIOS D on HD.IdCIE = D.IdDiagCpt
WHERE  HD.IdHisDetalle =@ml_IdDetalleHIS
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoObtenerDatosDetalleDiagnosticoPorIdDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDiagnosticoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDiagnosticoSeleccionarPorId]
	@IdHisDetalleDiagnostico [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_DetalleDiagnostico
where IdHisDetalleDiagnostico = @IdHisDetalleDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDiagnosticoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDx_VerificaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDx_VerificaAgregar]
	@IdHisDetalle [int],
	@IdCIE [int],
	@IdSubClasificacionDX [int],
	@CodLAB [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_DetalleDx_Verifica (
IdHisDetalle,IdCIE,IdSubClasificacionDX,CodLAB) values (
@IdHisDetalle,@IdCIE,@IdSubClasificacionDX,@CodLAB)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisDetalle,'HIS_DetalleDx_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDx_VerificaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDx_VerificaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDx_VerificaEliminar]
	@IdHisDetalle [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_DetalleDx_Verifica
where IdHisDetalle = @IdHisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisDetalle,'HIS_DetalleDx_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDx_VerificaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDx_VerificaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDx_VerificaModificar]
	@IdHisDetalle [int],
	@IdCIE [int],
	@IdSubClasificacionDX [int],
	@CodLAB [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_DetalleDx_Verifica
set
IdCIE = @IdCIE,
IdSubClasificacionDX = @IdSubClasificacionDX,
CodLAB = @CodLAB
where IdHisDetalle = @IdHisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisDetalle,'HIS_DetalleDx_Verifica'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDx_VerificaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleDx_VerificaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleDx_VerificaSeleccionarPorId]
	@IdHisDetalle [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_DetalleDx_Verifica
where IdHisDetalle = @IdHisDetalle
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleDx_VerificaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleEliminar]
	@IdHisDetalle [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Detalle
where IdHisDetalle = @IdHisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisDetalle,'HIS_Detalle'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleModificar]
	@IdHisDetalle [int],
	@IdHisCabecera [int],
	@IdTipoAtencion [int],
	@DiaAtencion [int],
	@IdHisPaciente [int],
	@CodigoActividad [varchar](10),
	@IdTipoFinanciamiento [int],
	@IdDistrito [int],
	@IdTipoEdad [int],
	@Edad [int],
	@Talla [int],
	@Peso [varchar](7),
	@IdEstadoaEstablec [int],
	@IdEstadoaServicio [int],
	@NroRegistroLote [int],
	@NroRegistroHoja [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_Detalle
set
IdHisCabecera = @IdHisCabecera,
IdTipoAtencion = @IdTipoAtencion,
DiaAtencion = @DiaAtencion,
IdHisPaciente = @IdHisPaciente,
CodigoActividad = @CodigoActividad,
IdTipoFinanciamiento = @IdTipoFinanciamiento,
IdDistrito = @IdDistrito,
IdTipoEdad = @IdTipoEdad,
Edad = @Edad,
Talla = @Talla,
Peso = @Peso,
IdEstadoaEstablec = @IdEstadoaEstablec,
IdEstadoaServicio = @IdEstadoaServicio,
NroRegistroLote=@NroRegistroLote,
NroRegistroHoja=@NroRegistroHoja
where IdHisDetalle = @IdHisDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisDetalle,'HIS_Detalle'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_detalleObtenerDatosDetalleAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_detalleObtenerDatosDetalleAtencion]
	@ml_IdCabeceraHIS [int]
WITH EXECUTE AS CALLER
AS
SELECT D.IdHisDetalle,
 D.IdHisCabecera,
 D.IdTipoAtencion,
 D.DiaAtencion,
 P.IdHisPaciente,
 ISNULL(P.IdPacienteGalenHos, 0) AS IdPacienteGalenHos,
 P.IdNacionalidad,
 P.NroHijo,
P.IdEtnia,
P.Sexo,
P.IdTipoDocumento AS IdTipoDocIdentidad,
 P.NroDocIdentidad,
'HC_FF_COD' = CASE
           WHEN d.IdTipoAtencion = 1    /*'CODIGO DE ATENCION*/
           THEN EP.NroHC_FF
           ELSE
           D.CodigoActividad
 END,
 D.IdTipoFinanciamiento AS IdFinanciador,
 D.IdTipoEdad as TipoEdad,
 D.IdDistrito,
 DI.Nombre AS DescripcionDistrito,
 D.IdTipoEdad,
 D.Edad,
 D.Talla,
 D.Peso,
 D.IdEstadoaEstablec,
 D.IdEstadoaServicio,
 D.NroRegistroLote,
 D.NroRegistroHoja,
0 IdEstado
 FROM His_Detalle D
INNER JOIN His_Cabecera C ON  C.IdHisCabecera= D.IdHisCabecera
INNER JOIN His_lotes L ON L.IdHisLote=C.IdHislote
 LEFT JOIN His_Paciente P ON D.IdHisPaciente = P.IdHisPaciente
 LEFT JOIN Distritos DI ON DI.IdDistrito = D.IdDistrito
 LEFT JOIN HIS_EstablecPacienteHIS EP ON EP.IdHISPaciente = P.IdHISPaciente and L.IdEstablecimiento=EP.IdEstablecimiento
 WHERE D.IdHisCabecera = @ml_IdCabeceraHIS
 ORDER BY IdHisDetalle ASC
GO
ALTER AUTHORIZATION ON [dbo].[HIS_detalleObtenerDatosDetalleAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_detallePorIdCabecera]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_detallePorIdCabecera]
	@IdHisCabecera [int]
WITH EXECUTE AS CALLER
AS
select IdHisDetalle from his_detalle Where IdHisCabecera = @IdHisCabecera
GO
ALTER AUTHORIZATION ON [dbo].[his_detallePorIdCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DetalleSeleccionarPorId]
	@IdHisDetalle [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Detalle
where IdHisDetalle = @IdHisDetalle
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_DxOmitidosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_DxOmitidosAgregar]
	@CODVALIDACION [int],
	@IdLote [int],
	@DiaAtencion [int],
	@NroPagina [int],
	@Codigo1 [varchar](6),
	@LabConf1 [varchar](3),
	@Diagnost1 [varchar](1),
	@Codigo2 [varchar](6),
	@LabConf2 [varchar](3),
	@Diagnost2 [varchar](1),
	@Codigo3 [varchar](6),
	@LabConf3 [varchar](3),
	@Diagnost3 [varchar](1),
	@Codigo4 [varchar](6),
	@LabConf4 [varchar](3),
	@Diagnost4 [varchar](1),
	@Codigo5 [varchar](6),
	@LabConf5 [varchar](3),
	@Diagnost5 [varchar](1),
	@Codigo6 [varchar](6),
	@LabConf6 [varchar](3),
	@Diagnost6 [varchar](1),
	@Edad [int],
	@TipoEdad [varchar](1),
	@Sexo [varchar](1),
	@Peso [money],
	@FichaFam [varchar](10),
	@Establecimiento [varchar](1),
	@Servicio [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_DxOmitidos (
CODVALIDACION,IdLote, DiaAtencion, NroPagina,Codigo1,Codigo2,Codigo3,Codigo4,Codigo5,Codigo6,LabConf1,LabConf2,LabConf3,LabConf4,LabConf5,LabConf6,Diagnost1,Diagnost2,Diagnost3,Diagnost4,Diagnost5,Diagnost6,Edad,Tip_Edad,Sexo,Peso,FichaFam,Establecimiento,Servicio) values (
@CODVALIDACION,@IdLote, @DiaAtencion, @NroPagina, @Codigo1,@Codigo2,@Codigo3,@Codigo4,@Codigo5,@Codigo6,@LabConf1,@LabConf2,@LabConf3,@LabConf4,@LabConf5,@LabConf6,@Diagnost1,@Diagnost2,@Diagnost3,@Diagnost4,@Diagnost5,@Diagnost6,@Edad,@TipoEdad,@Sexo,@Peso,@FichaFam,@Establecimiento,@Servicio)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@Codigo1,'HIS_TEMPORAL'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_DxOmitidosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstablecimientosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstablecimientosAgregar]
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into His_Establecimientos (
IdEstablecimiento) values (
@IdEstablecimiento)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstablecimiento,'His_Establecimientos'
GO
ALTER AUTHORIZATION ON [dbo].[His_EstablecimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstablecimientosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_EstablecimientosEliminar]
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from His_servEstablecimiento where IdEstablecimiento = @IdEstablecimiento
delete from His_Establecimientos where IdEstablecimiento = @IdEstablecimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstablecimiento,'His_Establecimientos'
GO
ALTER AUTHORIZATION ON [dbo].[His_EstablecimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstablecimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstablecimientosSeleccionarPorId]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
select * from His_Establecimientos
where IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[His_EstablecimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_EstablecPacienteHISAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_EstablecPacienteHISAgregar]
	@IdEstablecPacienteHIS [int] OUTPUT,
	@IdEstablecimiento [int],
	@IdHisPaciente [int],
	@NroHC_FF [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_EstablecPacienteHIS (
IdEstablecimiento,IdHisPaciente,NroHC_FF) values (
@IdEstablecimiento,@IdHisPaciente,@NroHC_FF)
set @IdEstablecPacienteHIS = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstablecPacienteHIS,'HIS_EstablecPacienteHIS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstablecPacienteHISAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_EstablecPacienteHISEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_EstablecPacienteHISEliminar]
	@IdEstablecPacienteHIS [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_EstablecPacienteHIS
where IdEstablecPacienteHIS = @IdEstablecPacienteHIS
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstablecPacienteHIS,'HIS_EstablecPacienteHIS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstablecPacienteHISEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_EstablecPacienteHISModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_EstablecPacienteHISModificar]
	@IdEstablecPacienteHIS [int],
	@IdEstablecimiento [int],
	@IdHisPaciente [int],
	@NroHC_FF [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
if exists(select * from HIS_EstablecPacienteHIS where  IdEstablecimiento = @IdEstablecimiento and  IdHisPaciente=@IdHisPaciente)
	begin
		update HIS_EstablecPacienteHIS
		set NroHC_FF = @NroHC_FF
		where  IdEstablecimiento = @IdEstablecimiento and  IdHisPaciente=@IdHisPaciente
	end
else
	begin
		insert into HIS_EstablecPacienteHIS (
		IdEstablecimiento,IdHisPaciente,NroHC_FF) values (
		@IdEstablecimiento,@IdHisPaciente,@NroHC_FF)
	end

--where IdEstablecPacienteHIS = @IdEstablecPacienteHIS
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstablecPacienteHIS,'HIS_EstablecPacienteHIS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstablecPacienteHISModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_EstablecPacienteHISSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_EstablecPacienteHISSeleccionarPorId]
	@IdEstablecPacienteHIS [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_EstablecPacienteHIS
where IdEstablecPacienteHIS = @IdEstablecPacienteHIS
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstablecPacienteHISSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ESTABseleccionarXcodigo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ESTABseleccionarXcodigo]
	@CodigoEstablecimiento [varchar](200)
WITH EXECUTE AS CALLER
AS
SELECT cod_Estab From HIS_ESTAB Where COD_2000 = @CodigoEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ESTABseleccionarXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstadosCalidadAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstadosCalidadAgregar]
	@IdEstado [int],
	@Descripcion [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into His_EstadosCalidad (
IdEstado,Descripcion) values (
@IdEstado,@Descripcion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstado,'His_EstadosCalidad'
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosCalidadAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstadosCalidadEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstadosCalidadEliminar]
	@IdEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from His_EstadosCalidad
where IdEstado = @IdEstado
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdEstado,'His_EstadosCalidad'
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosCalidadEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstadosCalidadModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstadosCalidadModificar]
	@IdEstado [int],
	@Descripcion [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update His_EstadosCalidad
set
Descripcion = @Descripcion
where IdEstado = @IdEstado
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdEstado,'His_EstadosCalidad'
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosCalidadModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_EstadosCalidadSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_EstadosCalidadSeleccionarPorId]
	@IdEstado [int]
WITH EXECUTE AS CALLER
AS
select * from His_EstadosCalidad
where IdEstado = @IdEstado
GO
ALTER AUTHORIZATION ON [dbo].[His_EstadosCalidadSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_EstadosLoteSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_EstadosLoteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT IdEstado,Descripcion
 FROM HIS_EstadosLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_EstadosLoteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ExportaDAtosAlHIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ExportaDAtosAlHIS]
	@IdMesElegido [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT          dbo.HIS_Lotes.Anio as Ano,dbo.HIS_Lotes.Mes as Mes, Case dbo.HIS_Cabecera.IdTurno WHEN 1 THEN 'M' WHEN 2 THEN 'T' END AS [mt],
	         dbo.HIS_Detalle.NroRegistroLote, dbo.HIS_Lotes.IdHisLote, dbo.HIS_Lotes.Lote as Nom_lote, dbo.HIS_Cabecera.IdHisCabecera,
                      dbo.HIS_Lotes.IdEstablecimiento, dbo.HIS_Cabecera.NroHojaHis, dbo.HIS_Detalle.IdHisDetalle, dbo.HIS_Detalle.NroRegistroHoja,
                      dbo.HIS_Detalle.DiaAtencion,dbo.HIS_Detalle.IdTipoAtencion,dbo.establecimientos.codigo as codigo_estabec,
		      'NroHC_FF' = CASE
		           WHEN dbo.HIS_Detalle.IdTipoAtencion = 1    /*'CODIGO DE ATENCION*/
		           THEN dbo.HIS_EstablecPacienteHIS.NroHC_FF
		           ELSE
		           dbo.HIS_Detalle.CodigoActividad
		      END
	,       dbo.Paises.IdPais, dbo.Paises.Codigo AS Codigo,
                      dbo.HIS_Paciente.IdTipoDocumento,dbo.HIS_Paciente.IdNacionalidad, dbo.HIS_Paciente.NroDocIdentidad as DNI, dbo.HIS_Paciente.NroHijo,
                      dbo.HIS_Detalle.IdTipoFinanciamiento FI,dbo.HIS_Paciente.IdEtnia as et, dbo.HIS_Detalle.IdDistrito, CONVERT(varchar(10), dbo.HIS_Detalle.IdDistrito)
                      + ' - ' + dbo.Distritos.Nombre AS Distrito, dbo.HIS_Detalle.Edad, dbo.HIS_Detalle.IdTipoEdad, dbo.HIS_TipoEdad.CodigoEdad as tip_edad,
                     dbo.HIS_Paciente.Sexo, dbo.HIS_Detalle.Peso, dbo.HIS_Detalle.Talla,
                      dbo.HIS_Detalle.IdEstadoaEstablec as IdTipoCondicionALEstab, dbo.HIS_Detalle.IdEstadoaServicio as IdTipoCondicionAlServicio
FROM         dbo.HIS_Lotes INNER JOIN
                      dbo.HIS_Cabecera ON dbo.HIS_Lotes.IdHisLote = dbo.HIS_Cabecera.IdHisLote INNER JOIN
                      dbo.HIS_Detalle ON dbo.HIS_Cabecera.IdHisCabecera = dbo.HIS_Detalle.IdHisCabecera INNER JOIN
		      dbo.His_Establecimientos ON dbo.HIS_Lotes.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento INNER JOIN
		      dbo.establecimientos on dbo.establecimientos.idestablecimiento=dbo.His_Establecimientos.idestablecimiento LEFT JOIN
                      dbo.HIS_Paciente ON dbo.HIS_Detalle.IdHisPaciente = dbo.HIS_Paciente.IdHisPaciente LEFT JOIN
                      dbo.HIS_EstablecPacienteHIS ON  dbo.HIS_Paciente.IdHisPaciente = dbo.HIS_EstablecPacienteHIS.IdHisPaciente AND
	        dbo.HIS_EstablecPacienteHIS.IdEstablecimiento = dbo.His_Establecimientos.IdEstablecimiento LEFT JOIN
                      dbo.TiposDocIdentidad ON dbo.TiposDocIdentidad.IdDocIdentidad = dbo.HIS_Paciente.IdTipoDocumento LEFT JOIN
                      dbo.Paises ON dbo.HIS_Paciente.IdNacionalidad = dbo.Paises.IdPais LEFT JOIN
                      dbo.HIS_Financiador ON dbo.HIS_Detalle.IdTipoFinanciamiento = dbo.HIS_Financiador.IdCodigoFinancHis LEFT JOIN
                      dbo.HIS_tabetnia ON dbo.HIS_Paciente.IdEtnia = dbo.HIS_tabetnia.codetni LEFT JOIN
                      dbo.Distritos ON dbo.HIS_Detalle.IdDistrito = dbo.Distritos.IdDistrito LEFT JOIN
                      dbo.HIS_TipoEdad ON dbo.HIS_Detalle.IdTipoEdad = dbo.HIS_TipoEdad.IdHisTipoEdad
WHERE dbo.HIS_Lotes.mes=@IdMesElegido and dbo.HIS_Lotes.anio=@Anio and  dbo.HIS_Lotes.IdEstadoLote in (1,4)
ORDER BY dbo.HIS_Lotes.IdHisLote,dbo.HIS_Detalle.NroRegistroLote
GO
ALTER AUTHORIZATION ON [dbo].[His_ExportaDAtosAlHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ExportaDAtosAlHISCabecera]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ExportaDAtosAlHISCabecera]
	@IdMesElegido [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
select e.codigo,l.anio as ano, l.mes as mes, l.lote as nom_lote,h.nroHojahis as num_pag,h.nroformato as tot_reg , s.codigoserviciohis,
h.IdMedico,m.IdColegioHis,em.IdTipoDocumento,em.DNI
from his_cabecera h
inner join his_lotes l on h.idhislote=l.idhislote
inner join establecimientos e on l.idestablecimiento=e.idestablecimiento
inner join HIS_ServEstablecimiento SE
on h.idestablecimiento=se.idestablecimiento and SE.IdServicio =H.IdServicio
inner join Servicios S  on SE.IdServicio = S.IdServicio
inner join medicos M on h.IdMedico=M.IdMedico
inner join empleados em on em.IdEmpleado=M.IdEmpleado
where l.anio=@Anio and l.mes=@IdMesElegido and  l.IdEstadoLote in (1,4)
GO
ALTER AUTHORIZATION ON [dbo].[His_ExportaDAtosAlHISCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ExportaDAtosAlHISLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ExportaDAtosAlHISLote]
	@IdMesElegido [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
select e.codigo,h.anio as ano, h.mes as mes, h.lote as Nom_lote,h.nroHojas as tot_pag
from his_lotes h inner join establecimientos e on h.idestablecimiento=e.idestablecimiento
where mes=@IdMesElegido and anio=@Anio and h.IdEstadoLote in (1,4)
GO
ALTER AUTHORIZATION ON [dbo].[His_ExportaDAtosAlHISLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_FACTCATALOGOSERVICIOSAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_FACTCATALOGOSERVICIOSAgregar]
	@IdDiagCpt [int],
	@CodigoDiagCpt [varchar](20),
	@DescripcionDiagCpt [varchar](1000),
	@EsCpt [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_FACTCATALOGOSERVICIOS (
IdDiagCpt,CodigoDiagCpt,DescripcionDiagCpt,EsCpt) values (
@IdDiagCpt,@CodigoDiagCpt,@DescripcionDiagCpt,@EsCpt)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdDiagCpt,'HIS_FACTCATALOGOSERVICIOS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_FACTCATALOGOSERVICIOSAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_FACTCATALOGOSERVICIOSEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_FACTCATALOGOSERVICIOSEliminar]
	@IdDiagCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_FACTCATALOGOSERVICIOS
where IdDiagCpt = @IdDiagCpt
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDiagCpt,'HIS_FACTCATALOGOSERVICIOS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_FACTCATALOGOSERVICIOSEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_FACTCATALOGOSERVICIOSModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_FACTCATALOGOSERVICIOSModificar]
	@IdDiagCpt [int],
	@CodigoDiagCpt [varchar](20),
	@DescripcionDiagCpt [varchar](1000),
	@EsCpt [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_FACTCATALOGOSERVICIOS
set
CodigoDiagCpt = @CodigoDiagCpt,
DescripcionDiagCpt = @DescripcionDiagCpt,
EsCpt = @EsCpt
where IdDiagCpt = @IdDiagCpt
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDiagCpt,'HIS_FACTCATALOGOSERVICIOS'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_FACTCATALOGOSERVICIOSModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_FACTCATALOGOSERVICIOSSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_FACTCATALOGOSERVICIOSSeleccionarPorId]
	@IdDiagCpt [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_FACTCATALOGOSERVICIOS
where IdDiagCpt = @IdDiagCpt
GO
ALTER AUTHORIZATION ON [dbo].[HIS_FACTCATALOGOSERVICIOSSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_FuentesFinanciamiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_FuentesFinanciamiento]
WITH EXECUTE AS CALLER
AS
select idcodigofinanchis,descripcionfinanchis as Descripcion,
(Convert(varchar(5), idcodigofinanchis) + ' - ' + descripcionfinanchis) as DescripcionLarga
from his_financiador
GO
ALTER AUTHORIZATION ON [dbo].[His_FuentesFinanciamiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_historicoAtencionesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[his_historicoAtencionesAgregar]
	@idPaciente [int],
	@fecha [datetime],
	@diagnost [varchar](6),
	@cpt [varchar](6),
	@ups [varchar](6),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into his_historicoAtenciones (
idPaciente,fecha,diagnost,cpt,ups) values (
@idPaciente,@fecha,@diagnost,@cpt,@ups)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@NroHistoriaClinica,'his_historicoAtenciones'
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtencionesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_historicoAtencionesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[his_historicoAtencionesEliminar]
	@idPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from his_historicoAtenciones
where idPaciente = @idPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@NroHistoriaClinica,'his_historicoAtenciones'
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtencionesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_historicoAtencionesEliminarTodas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[his_historicoAtencionesEliminarTodas]
WITH EXECUTE AS CALLER
AS
delete from his_historicoAtenciones
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtencionesEliminarTodas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_historicoAtencionesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[his_historicoAtencionesModificar]
	@idPaciente [int],
	@fecha [datetime],
	@diagnost [varchar](6),
	@cpt [varchar](6),
	@ups [varchar](6),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update his_historicoAtenciones
set
fecha = @fecha,
diagnost = @diagnost,
cpt = @cpt,
ups = @ups
where idPaciente = @idPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@NroHistoriaClinica,'his_historicoAtenciones'
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtencionesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_historicoAtencionesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[his_historicoAtencionesSeleccionarPorId]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from his_historicoAtenciones
where idPaciente= @idPaciente order by fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[his_historicoAtencionesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesActualizarXidLoteYnroHoja]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesActualizarXidLoteYnroHoja]
	@NumHoja [int],
	@ml_IdLote [int]
WITH EXECUTE AS CALLER
AS
UPDATE HIS_Lotes SET NroHojas = @NumHoja  WHERE IdHIsLote =@ml_IdLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesActualizarXidLoteYnroHoja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_LotesAgregar]
	@IdHisLote [int] OUTPUT,
	@IdEstablecimiento [int],
	@Lote [char](4),
	@NroHojas [int],
	@Mes [int],
	@Anio [int],
	@IdEstadoLote [int],
	@Cerrado [int],
	@DobleDigitacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Lotes (
IdEstablecimiento,Lote,NroHojas,Mes,Anio,IdEstadoLote,Cerrado,DobleDigitacion) values (
@IdEstablecimiento,@Lote,@NroHojas,@Mes,@Anio,@IdEstadoLote,@Cerrado,@DobleDigitacion)
set @IdHisLote = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisLote,'HIS_Lotes'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_LotesConsultarFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_LotesConsultarFiltro]
	@IdEstablecimiento [int],
	@IdEstado [int]
WITH EXECUTE AS CALLER
AS
SELECT LT.IdHisLote, LT.IdEstablecimiento, ES.Nombre ,LT.Lote, LT.NroHojas, '' as HojasRegistradas, '' as TotalRegistros,m.descripcion as Mes, LT.Anio,he.descripcion as Estado,Lt.DobleDigitacion
	 FROM [HIS_Lotes] LT
	inner join Establecimientos ES ON LT.IdEstablecimiento = ES.IdEstablecimiento
	inner join his_estadoslote he on LT.idestadolote=he.idestado
	inner join his_meses m on LT.Mes=m.IdMes
	WHERE LT.IdEstablecimiento = @IdEstablecimiento and Lt.IdEstadoLote=@IdEstado
GO
ALTER AUTHORIZATION ON [dbo].[His_LotesConsultarFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesConsultarRegistroFiltroAtenciones]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesConsultarRegistroFiltroAtenciones]
	@Anio [int],
	@IdMes [int],
	@IdEstablecimiento [int],
	@NombreLote [varchar](3)
WITH EXECUTE AS CALLER
AS
IF @Anio<>''
   SELECT
   C.IdHISCabecera,
   LT.Lote ,
   C.NroHojaHIS,
   LT.IdHisLote ,
   C.NroFormato,
   Case C.IdTurno
   WHEN 1 THEN 'MAÑANA'
   WHEN 2 THEN 'TARDE'
   END AS [Turno],
    LT.Anio,
   hm.descripcion as Mes,
   E.Nombre AS NombreEstablecimiento,
   S.Nombre  AS NombreServicio,
   EM.ApellidoPaterno + ' ' + EM.ApellidoMaterno + ' ' + EM.Nombres AS NombreEmpleado,
    C.idUsuario
   From HIS_Lotes LT inner join HIS_Cabecera C
   on LT.IdHisLote = C.IdHisLote inner join Medicos M
   on C.IdMedico = M.IdMedico inner join Empleados EM
   on M.IdEmpleado = EM.IdEmpleado inner join Establecimientos E
   on LT.IdEstablecimiento = E.IdEstablecimiento inner join Servicios S
   on C.IdServicio = S.IdServicio inner join his_meses hm
   on hm.idmes=lt.mes
   Where C.IdEstadoHis = 1
   and LT.IDEstablecimiento = @IdEstablecimiento
   and LT.Anio = @Anio
   and LT.Mes = @IdMes
   AND LT.IdEstadoLote=0
   and LT.Lote like '%' + @NombreLote + '%'  AND C.IdEstablecimiento =@IdEstablecimiento
   ORDER BY  E.Nombre,LT.Lote,  C.NroHojaHIS
else
   SELECT
   C.IdHISCabecera,
   LT.Lote ,
   C.NroHojaHIS,
   LT.IdHisLote ,
   C.NroFormato,
   Case C.IdTurno
   WHEN 1 THEN 'MAÑANA'
   WHEN 2 THEN 'TARDE'
   END AS [Turno],
    LT.Anio,
   hm.descripcion as Mes,
   E.Nombre AS NombreEstablecimiento,
   S.Nombre  AS NombreServicio,
   EM.ApellidoPaterno + ' ' + EM.ApellidoMaterno + ' ' + EM.Nombres AS NombreEmpleado,
    C.idUsuario
   From HIS_Lotes LT inner join HIS_Cabecera C
   on LT.IdHisLote = C.IdHisLote inner join Medicos M
   on C.IdMedico = M.IdMedico inner join Empleados EM
   on M.IdEmpleado = EM.IdEmpleado inner join Establecimientos E
   on LT.IdEstablecimiento = E.IdEstablecimiento inner join Servicios S
   on C.IdServicio = S.IdServicio  inner join his_meses hm
   on hm.idmes=lt.mes
   Where C.IdEstadoHis = 1
   and LT.IDEstablecimiento = @IdEstablecimiento
   and LT.Mes = @IdMes
   AND LT.IdEstadoLote=0
   and LT.Lote like '%' + @NombreLote + '%'  AND C.IdEstablecimiento =@IdEstablecimiento
   ORDER BY  E.Nombre,LT.Lote,  C.NroHojaHIS
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesConsultarRegistroFiltroAtenciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesConsultarRegistrosLotesPorIdEstablec]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesConsultarRegistrosLotesPorIdEstablec]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT [IdHisLote], [IdEstablecimiento], [Lote], [NroHojas], [Mes], [Anio], [Cerrado] FROM [HIS_Lotes]
WHERE IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesConsultarRegistrosLotesPorIdEstablec] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesDisminuirNroHojaHIS]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesDisminuirNroHojaHIS]
	@ml_IdLote [int]
WITH EXECUTE AS CALLER
AS
UPDATE HIS_LOTES SET NroHojas = NroHojas - 1 WHERE IdHisLote = @ml_IdLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesDisminuirNroHojaHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_LotesEliminar]
	@IdHisLote [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Lotes
where IdHisLote = @IdHisLote
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisLote,'HIS_Lotes'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_LotesModificar]
	@IdHisLote [int],
	@IdEstablecimiento [int],
	@Lote [char](4),
	@NroHojas [int],
	@Mes [int],
	@Anio [int],
	@IdEstadoLote [int],
	@Cerrado [int],
	@DobleDigitacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_Lotes
set
IdEstablecimiento = @IdEstablecimiento,
Lote = @Lote,
NroHojas = @NroHojas,
Mes = @Mes,
Anio = @Anio,
IdEstadoLote = @IdEstadoLote,
Cerrado = @Cerrado,
DobleDigitacion=@DobleDigitacion
where IdHisLote = @IdHisLote
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisLote,'HIS_Lotes'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesPasoMaximoPaginasPermitido]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesPasoMaximoPaginasPermitido]
	@ml_IdEstablecimientoActual [int]
WITH EXECUTE AS CALLER
AS
SELECT [IdHisLote], [NroHojas] From [HIS_Lotes]
 WHERE [cerrado] <> 1 AND [IdEstablecimiento] = @ml_IdEstablecimientoActual
 ORDER BY [Anio] DESC ,[Mes] DESC
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesPasoMaximoPaginasPermitido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesSegunFiltro]
	@lcFiltro [varchar](1000),
	@IdEstablecimiento [varchar](10)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

if @lcFiltro<>''
   SET  @SQL =  'SELECT LT.IdHisLote, LT.IdEstablecimiento, ES.Nombre ,LT.Lote, LT.NroHojas, m.idmes,m.descripcion as Mes, LT.Anio,he.descripcion as Estado
	 FROM [HIS_Lotes] LT inner join Establecimientos ES
	ON LT.IdEstablecimiento = ES.IdEstablecimiento
	inner join his_estadoslote he on LT.idestadolote=he.idestado
	inner join his_meses m on lt.Mes=m.idmes
	WHERE LT.IdEstablecimiento = '+@IdEstablecimiento  +'  '+@lcFiltro
else
   SET  @SQL =  'SELECT LT.IdHisLote, LT.IdEstablecimiento, ES.Nombre ,LT.Lote, LT.NroHojas, m.idmes,m.descripcion as Mes, LT.Anio,he.descripcion as Estado
	 FROM [HIS_Lotes] LT inner join Establecimientos ES
	ON LT.IdEstablecimiento = ES.IdEstablecimiento
	inner join his_estadoslote he on LT.idestadolote=he.idestado
	inner join his_meses m on lt.Mes=m.idmes
	WHERE LT.IdEstablecimiento = '+@IdEstablecimiento


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_LotesSeleccionarPorId]
	@IdHisLote [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Lotes
where IdHisLote = @IdHisLote
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesValidarLoteHIS_LoteExiste]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_LotesValidarLoteHIS_LoteExiste]
	@IdEstablecimiento [int],
	@Lote [varchar](4),
	@NroHojas [int],
	@Mes [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
SELECT COUNT([IdHisLote]) AS COINCIDENCIAS
 FROM [HIS_Lotes]
 WHERE ltrim([Lote]) = ltrim(@Lote)
 AND [Mes] = @Mes
 AND [Anio] = @Anio
AND IdEstablecimiento=@IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesValidarLoteHIS_LoteExiste] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteCerrado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteCerrado]
	@ml_IdEstablecimientoActual [int]
WITH EXECUTE AS CALLER
AS
SELECT TOP 1 [Cerrado]
 From [HIS_Lotes]
 Where [IdEstablecimiento] = @ml_IdEstablecimientoActual
 ORDER BY [Anio] DESC ,[Mes] DESC
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteCerrado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteNoCerrado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteNoCerrado]
	@IdEstablecimiento [int],
	@Anio [int],
	@Mes [int]
WITH EXECUTE AS CALLER
AS
If @Mes = 1
    SELECT cerrado
    FROM [HIS_Lotes]
    WHERE [IdEstablecimiento] = @IdEstablecimiento
     AND [Mes] = 12
     AND [Anio] = @Anio - 1
Else
    SELECT cerrado
    FROM [HIS_Lotes]
    WHERE [IdEstablecimiento] = @IdEstablecimiento
    AND [Mes] = @Mes - 1
    AND [Anio] = @Anio
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesValidarLoteHIS_UltimoLoteNoCerrado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_LotesXIdEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_LotesXIdEstablecimiento]
	@ml_IdEstablecimientoActual [int]
WITH EXECUTE AS CALLER
AS
SELECT *
 FROM [HIS_Lotes]
WHERE [IdEstablecimiento] = @ml_IdEstablecimientoActual
GO
ALTER AUTHORIZATION ON [dbo].[HIS_LotesXIdEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ModificarEstadoLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ModificarEstadoLote]
	@IdHisLote [int],
	@IdEstadoLote [int]
WITH EXECUTE AS CALLER
AS
update HIS_Lotes
set
IdEstadoLote = @IdEstadoLote
where IdHisLote = @IdHisLote
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisLote,'HIS_Lotes'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ModificarEstadoLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ObtenerIdPaisPorCodNac]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_ObtenerIdPaisPorCodNac]
	@Codigo [varchar](3)
WITH EXECUTE AS CALLER
AS
select * from Paises
where Codigo = @Codigo
GO
ALTER AUTHORIZATION ON [dbo].[His_ObtenerIdPaisPorCodNac] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ObtenerProductosHisPorCodigoyNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ObtenerProductosHisPorCodigoyNombre]
	@codigodiagcpt [varchar](20),
	@descripciondiagcpt [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT iddiagcpt, codigoDiagCptSinPunto, descripciondiagcpt, EsCpt,DxSexo,MasDeUnDiagnosticos FROM HIS_FACTCATALOGOSERVICIOS
where codigoDiagCptSinPunto  like @codigodiagcpt + '%' and  descripciondiagcpt like @descripciondiagcpt + '%'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ObtenerProductosHisPorCodigoyNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PACIENTEactualizaIdPacienteGalenHos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_PACIENTEactualizaIdPacienteGalenHos]
	@IdPacienteGalenHos [int],
	@NroDocumentoIdentidad [varchar](12)
WITH EXECUTE AS CALLER
AS
UPDATE HIS_PACIENTE SET IdPacienteGalenHos = @IdPacienteGalenHos
 WHERE NroDocIdentidad = @NroDocumentoIdentidad
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PACIENTEactualizaIdPacienteGalenHos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PacienteAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_PacienteAgregar]
	@IdHisPaciente [int] OUTPUT,
	@Sexo [int],
	@IdNacionalidad [int],
	@NroDocIdentidad [varchar](12),
	@NroHijo [char](2),
	@IdEtnia [char](2),
	@IdPacienteGalenHos [int],
	@IdTipoDocumento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Paciente (Sexo,IdNacionalidad,NroDocIdentidad,NroHijo,IdEtnia,IdPacienteGalenHos,IdTipoDocumento) values (
@Sexo,@IdNacionalidad,@NroDocIdentidad,@NroHijo,@IdEtnia,@IdPacienteGalenHos,@IdTipoDocumento)
set @IdHisPaciente = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisPaciente,'HIS_Paciente'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PacienteEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_PacienteEliminar]
	@IdHisPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Paciente
where IdHisPaciente = @IdHisPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisPaciente,'HIS_Paciente'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PacienteModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_PacienteModificar]
	@IdHisPaciente [int],
	@Sexo [int],
	@IdNacionalidad [int],
	@NroDocIdentidad [varchar](12),
	@NroHijo [char](2),
	@IdEtnia [char](2),
	@IdPacienteGalenHos [int],
	@IdTipoDocumento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_Paciente
set
Sexo = @Sexo,
IdNacionalidad = @IdNacionalidad,
NroDocIdentidad = @NroDocIdentidad,
NroHijo = @NroHijo,
IdEtnia = @IdEtnia,
IdPacienteGalenHos = @IdPacienteGalenHos,
IdTipoDocumento = @IdTipoDocumento
where IdHisPaciente = @IdHisPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisPaciente,'HIS_Paciente'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_PacienteSeleccionarPorId]
	@IdHisPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Paciente
where IdHisPaciente = @IdHisPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_PacientesFiltraPorNroDocumentoYtipo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_PacientesFiltraPorNroDocumentoYtipo]
	@nroDocumento [varchar](12),
	@idDocIdentidad [int]
WITH EXECUTE AS CALLER
AS
select ph.idestablecimiento,ph.nrohc_ff, p.idhispaciente,p.sexo,p.idnacionalidad,p.nrohijo,p.idetnia,p.idpacientegalenhos
from his_paciente p inner join his_establecpacientehis ph on p.idhispaciente=ph.idhispaciente
where p.idtipodocumento=@idDocIdentidad and p.nrodocidentidad=@nroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_PacientesFiltraPorNroDocumentoYtipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_pacienteXdocumento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_pacienteXdocumento]
	@NroDocumentoIdentidad [varchar](12),
	@idDocIdentidad [int]
WITH EXECUTE AS CALLER
AS
select * from his_paciente where nrodocidentidad = @NroDocumentoIdentidad and idtipodocumento=@idDocIdentidad
GO
ALTER AUTHORIZATION ON [dbo].[his_pacienteXdocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_pacienteXdocumentoNroHijo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_pacienteXdocumentoNroHijo]
	@NroDocumentoIdentidad [varchar](12),
	@idDocIdentidad [int],
	@NroHijo [int]
WITH EXECUTE AS CALLER
AS
select * from his_paciente where nrodocidentidad = @NroDocumentoIdentidad and idtipodocumento=@idDocIdentidad and ltrim(nrohijo)=@NroHijo
GO
ALTER AUTHORIZATION ON [dbo].[his_pacienteXdocumentoNroHijo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRAgregar]
	@IdHisProgMedEstMR [int] OUTPUT,
	@IdMedico [int],
	@IdServicio [int],
	@IdEstablecimiento [int],
	@FechaProgramada [datetime],
	@IdTurno [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_ProgMedEstMR (
IdMedico,IdServicio,IdEstablecimiento,FechaProgramada,IdTurno) values (
@IdMedico,@IdServicio,@IdEstablecimiento,@FechaProgramada,@IdTurno)
set @IdHisProgMedEstMR = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisProgMedEstMR,'HIS_ProgMedEstMR'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMREliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMREliminar]
	@IdHisProgMedEstMR [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_ProgMedEstMR
where IdHisProgMedEstMR = @IdHisProgMedEstMR
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisProgMedEstMR,'HIS_ProgMedEstMR'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMREliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRModificar]
	@IdHisProgMedEstMR [int],
	@IdMedico [int],
	@IdServicio [int],
	@IdEstablecimiento [int],
	@FechaProgramada [datetime],
	@IdTurno [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_ProgMedEstMR
set
IdMedico = @IdMedico,
IdServicio = @IdServicio,
IdEstablecimiento = @IdEstablecimiento,
FechaProgramada = @FechaProgramada,
IdTurno = @IdTurno
where IdHisProgMedEstMR = @IdHisProgMedEstMR
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisProgMedEstMR,'HIS_ProgMedEstMR'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRporMedicoAnioMes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRporMedicoAnioMes]
	@IdMedico [int],
	@ms_Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT
 [IdHisProgMedEstMR],
 [FechaProgramada]
 From [HIS_ProgMedEstMR]
 WHERE [IdMedico] = @IdMedico
AND year(FechaProgramada) = Year(@ms_Fecha)AND month(FechaProgramada) =  Month(@ms_Fecha)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRporMedicoAnioMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRporMedicoEstablecFecha]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRporMedicoEstablecFecha]
	@IdMedico [int],
	@IdEstablecimiento [int],
	@Anio [int],
	@Mes [int]
WITH EXECUTE AS CALLER
AS
SELECT
 [IdHisProgMedEstMR],
 [FechaProgramada]
 From [HIS_ProgMedEstMR]
 WHERE [IdMedico] = @IdMedico
 AND [IdEstablecimiento] = @IdEstablecimiento
 AND year(FechaProgramada) = @Anio AND month(FechaProgramada) = @Mes
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRporMedicoEstablecFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRSeleccionarPorId]
	@IdHisProgMedEstMR [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_ProgMedEstMR
where IdHisProgMedEstMR = @IdHisProgMedEstMR
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ProgMedEstMRxMedicoMesYanio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ProgMedEstMRxMedicoMesYanio]
	@IdEstablecimiento [int],
	@IdServicio [int],
	@IdMedico [int],
	@IdMes [int],
	@Anio [int],
	@IdTurno [int]
WITH EXECUTE AS CALLER
AS
if @IdEstablecimiento=0
	begin
		SELECT
		 PM.IdHisProgMedEstMR,
		 PM.IdMedico,
		 PM.IdServicio,
		 PM.IdEstablecimiento,
		 ES.Nombre,
		 S.Nombre as Servicio,
		 PM.FechaProgramada,
		 PM.IdTurno
		 FROM HIS_ProgMedEstMR PM INNER JOIN Establecimientos ES
		 ON PM.IdEstablecimiento = ES.IdEstablecimiento INNER JOIN Servicios S
		 ON PM.IdServicio=S.IdServicio
		 WHERE IdMedico = @IdMedico
		AND year(FechaProgramada) = @Anio  AND month(FechaProgramada) = @IdMes
		ORDER BY DAY(PM.FechaProgramada)  ASC
	end
else
	begin
		SELECT
		 PM.IdHisProgMedEstMR,
		 PM.IdMedico,
		 PM.IdServicio,
		 PM.IdEstablecimiento,
		 ES.Nombre,
		 S.Nombre as Servicio,
		 PM.FechaProgramada,
		 PM.IdTurno
		 FROM HIS_ProgMedEstMR PM INNER JOIN Establecimientos ES
		 ON PM.IdEstablecimiento = ES.IdEstablecimiento INNER JOIN Servicios S
		 ON PM.IdServicio=S.IdServicio
		 WHERE PM.IdEstablecimiento=@IdEstablecimiento
		AND  PM.IdServicio=@IdServicio
		AND  PM.IdTurno=@IdTurno
		AND IdMedico = @IdMedico
		AND year(FechaProgramada) = @Anio  AND month(FechaProgramada) = @IdMes
		ORDER BY DAY(PM.FechaProgramada)  ASC
	end
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ProgMedEstMRxMedicoMesYanio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_SeleccionarEstablecimientosMR]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_SeleccionarEstablecimientosMR]
WITH EXECUTE AS CALLER
AS
SELECT IdEstablecimiento, codigo, nombre as NombreEstablecimiento
 FROM ESTABLECIMIENTOS
 WHERE IDESTABLECIMIENTO IN (SELECT IDESTABLECIMIENTO FROM HIS_Establecimientos)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_SeleccionarEstablecimientosMR] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoAgregar]
	@IdEstablecimiento [int],
	@IdServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_ServEstablecimiento (
IdEstablecimiento,IdServicio) values (
@IdEstablecimiento,@IdServicio)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoEliminar]
	@IdEstablecimiento [int],
	@IdServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_ServEstablecimiento
where IdEstablecimiento = @IdEstablecimiento and IdServicio=@IdServicio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisServEstablecimiento,'HIS_ServEstablecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoIdEstablecimientoIdServicio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoIdEstablecimientoIdServicio]
	@IdEstablecimiento [int],
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_ServEstablecimiento
 where IdEstablecimiento=@IdEstablecimiento
 and IdServicio =@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoIdEstablecimientoIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoModificar]
	@IdEstablecimiento [int],
	@IdServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_ServEstablecimiento
set
IdEstablecimiento = @IdEstablecimiento,
IdServicio = @IdServicio
where IdEstablecimiento = @IdEstablecimiento and IdServicio = @IdServicio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisServEstablecimiento,'HIS_ServEstablecimiento'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoPorEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoPorEstablecimiento]
	@ml_IdEstablecimientoActual [int]
WITH EXECUTE AS CALLER
AS
SELECT SE.IdEstablecimiento,
SE.IdServicio,
 S.nombre,
 0 IdEstado
 from HIS_ServEstablecimiento SE inner join Servicios S
 on SE.IdServicio = S.IdServicio
 Where SE.IdEstablecimiento = @ml_IdEstablecimientoActual
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoPorEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoXespecialidadEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoXespecialidadEstablecimiento]
	@IdEspecialidad [int],
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
select S.IdServicio, S.Nombre, S.idEstado
 from Servicios S inner join HIS_ServEstablecimiento HS
 ON S.IdServicio = HS.IdServicio
 Where S.IdTipoServicio = 1
 and S.IdEspecialidad = @IdEspecialidad
 and HS.IdEstablecimiento = @IdEstablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoXespecialidadEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_ServEstablecimientoXidEstablecimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_ServEstablecimientoXidEstablecimiento]
	@IdEstablecimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT IdEspecialidad, Nombre FROM Especialidades
 WHERE IdEspecialidad IN(select DISTINCT IdEspecialidad from servicios
 where IdServicio IN (SELECT DISTINCT IdServicio
 From HIS_ServEstablecimiento
 WHERE IdEstablecimiento =@IdEstablecimiento ))
GO
ALTER AUTHORIZATION ON [dbo].[HIS_ServEstablecimientoXidEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_situacioAgregar]
	@IdHisSituacio [int] OUTPUT,
	@valores [char](3),
	@descripcio [char](40),
	@codigo [numeric](18, 0),
	@est [char](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_situacio (
valores,descripcio,codigo,est) values (
@valores,@descripcio,@codigo,@est)
set @IdHisSituacio = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisSituacio,'HIS_situacio'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_situacioEliminar]
	@IdHisSituacio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_situacio
where IdHisSituacio = @IdHisSituacio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisSituacio,'HIS_situacio'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_situacioModificar]
	@IdHisSituacio [int],
	@valores [char](3),
	@descripcio [char](40),
	@codigo [numeric](18, 0),
	@est [char](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_situacio
set
valores = @valores,
descripcio = @descripcio,
codigo = @codigo,
est = @est
where IdHisSituacio = @IdHisSituacio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisSituacio,'HIS_situacio'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioSeleccionarPorCodigoDescripcion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_situacioSeleccionarPorCodigoDescripcion]
	@valores [varchar](5),
	@descripcio [varchar](40)
WITH EXECUTE AS CALLER
AS
SELECT [IdHisSituacio], [valores], [descripcio], [codigo], [est] FROM [HIS_situacio]
where valores  like @valores + '%' and  descripcio like @descripcio + '%'
ORDER BY 3
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioSeleccionarPorCodigoDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_situacioSeleccionarPorId]
	@IdHisSituacio [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_situacio
where IdHisSituacio = @IdHisSituacio
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_situacioSeleccionarPorValores]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[His_situacioSeleccionarPorValores]
	@Valores [varchar](3)
WITH EXECUTE AS CALLER
AS
select * from  his_situacio  where valores=@Valores
GO
ALTER AUTHORIZATION ON [dbo].[His_situacioSeleccionarPorValores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_situacioSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_situacioSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT [IdHisSituacio], [valores], [descripcio], [codigo], [est] FROM [HIS_situacio] ORDER BY 3
GO
ALTER AUTHORIZATION ON [dbo].[HIS_situacioSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_tabetniaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_tabetniaAgregar]
	@codetni [char](2) OUTPUT,
	@desetni [char](48),
	@codgen [char](2),
	@etnias [char](24),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_tabetnia (
desetni,codgen,etnias) values (
@desetni,@codgen,@etnias)
set @codetni = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@codetni,'HIS_tabetnia'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetniaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_tabetniaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_tabetniaEliminar]
	@codetni [char](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_tabetnia
where codetni = @codetni
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@codetni,'HIS_tabetnia'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetniaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_tabetniaFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_tabetniaFiltrarTodos]
WITH EXECUTE AS CALLER
AS
SELECT [codetni], [desetni], [codgen], [etnias] FROM [HIS_tabetnia]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetniaFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_tabetniaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_tabetniaModificar]
	@codetni [char](2),
	@desetni [char](48),
	@codgen [char](2),
	@etnias [char](24),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_tabetnia
set
desetni = @desetni,
codgen = @codgen,
etnias = @etnias
where codetni = @codetni
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@codetni,'HIS_tabetnia'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetniaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_tabetniaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_tabetniaSeleccionarPorId]
	@codetni [char](2)
WITH EXECUTE AS CALLER
AS
select * from HIS_tabetnia
where codetni = @codetni
GO
ALTER AUTHORIZATION ON [dbo].[HIS_tabetniaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[his_tabetniaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[his_tabetniaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select codetni, RTRIM(LTRIM(desetni)) as descripcion, (Convert(varchar(5), codetni) + ' - ' + RTRIM(LTRIM(desetni))) as DescripcionLarga from his_tabetnia
GO
ALTER AUTHORIZATION ON [dbo].[his_tabetniaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TEMPORALAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TEMPORALAgregar]
	@Codigo1 [varchar](6),
	@LabConf1 [varchar](3),
	@Diagnost1 [varchar](1),
	@Codigo2 [varchar](6),
	@LabConf2 [varchar](3),
	@Diagnost2 [varchar](1),
	@Codigo3 [varchar](6),
	@LabConf3 [varchar](3),
	@Diagnost3 [varchar](1),
	@Codigo4 [varchar](6),
	@LabConf4 [varchar](3),
	@Diagnost4 [varchar](1),
	@Codigo5 [varchar](6),
	@LabConf5 [varchar](3),
	@Diagnost5 [varchar](1),
	@Codigo6 [varchar](6),
	@LabConf6 [varchar](3),
	@Diagnost6 [varchar](1),
	@Edad [int],
	@TipoEdad [varchar](1),
	@Sexo [varchar](1),
	@Peso [money],
	@FichaFam [varchar](10),
	@Establecimiento [varchar](1),
	@Servicio [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_TEMPORAL (
Codigo1,Codigo2,Codigo3,Codigo4,Codigo5,Codigo6,LabConf1,LabConf2,LabConf3,LabConf4,LabConf5,LabConf6,Diagnost1,Diagnost2,Diagnost3,Diagnost4,Diagnost5,Diagnost6,Edad,Tip_Edad,Sexo,Peso,FichaFam,Establecimiento,Servicio) values (
@Codigo1,@Codigo2,@Codigo3,@Codigo4,@Codigo5,@Codigo6,@LabConf1,@LabConf2,@LabConf3,@LabConf4,@LabConf5,@LabConf6,@Diagnost1,@Diagnost2,@Diagnost3,@Diagnost4,@Diagnost5,@Diagnost6,@Edad,@TipoEdad,@Sexo,@Peso,@FichaFam,@Establecimiento,@Servicio)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@Codigo1,'HIS_TEMPORAL'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORALAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TEMPORALBuscarInconsistencia]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TEMPORALBuscarInconsistencia]
	@TxtValidacion [varchar](1000)
WITH EXECUTE AS CALLER
AS
Declare @sql  varchar(1500)
set @sql= 'select * from HIS_TEMPORAL where ' + @TxtValidacion
exec(@sql)
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORALBuscarInconsistencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TEMPORALEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TEMPORALEliminar]
WITH EXECUTE AS CALLER
AS
delete from HIS_TEMPORAL
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORALEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TEMPORALModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TEMPORALModificar]
	@Codigo1 [varchar](6),
	@Codigo2 [varchar](6),
	@Codigo3 [varchar](6),
	@Codigo4 [varchar](6),
	@Codigo5 [varchar](6),
	@Codigo6 [varchar](6),
	@LabConf1 [varchar](1),
	@LabConf2 [varchar](1),
	@LabConf3 [varchar](1),
	@LabConf4 [varchar](1),
	@LabConf5 [varchar](1),
	@LabConf6 [varchar](1),
	@Diagnost1 [int],
	@Diagnost2 [int],
	@Diagnost3 [int],
	@Diagnost4 [int],
	@Diagnost5 [int],
	@Diagnost6 [int],
	@Edad [int],
	@TipoEdad [int],
	@Establecimiento [varchar](1),
	@Servicio [varchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_TEMPORAL
set
Codigo2 = @Codigo2,
Codigo3 = @Codigo3,
Codigo4 = @Codigo4,
Codigo5 = @Codigo5,
Codigo6 = @Codigo6,
LabConf1 = @LabConf1,
LabConf2 = @LabConf2,
LabConf3 = @LabConf3,
LabConf4 = @LabConf4,
LabConf5 = @LabConf5,
LabConf6 = @LabConf6,
Diagnost1 = @Diagnost1,
Diagnost2 = @Diagnost2,
Diagnost3 = @Diagnost3,
Diagnost4 = @Diagnost4,
Diagnost5 = @Diagnost5,
Diagnost6 = @Diagnost6,
Edad = @Edad,
Tip_Edad = @TipoEdad,
Establecimiento = @Establecimiento,
Servicio = @Servicio
where Codigo1 = @Codigo1
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@Codigo1,'HIS_TEMPORAL'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORALModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TEMPORALSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TEMPORALSeleccionarPorId]
	@Codigo1 [varchar](6)
WITH EXECUTE AS CALLER
AS
select * from HIS_TEMPORAL
where Codigo1 = @Codigo1
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TEMPORALSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoAtencionAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoAtencionAgregar]
	@IdHisTipoAtencion [int] OUTPUT,
	@Codigo [char](3),
	@Descripcion [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_TipoAtencion (
Codigo,Descripcion) values (
@Codigo,@Descripcion)
set @IdHisTipoAtencion = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisTipoAtencion,'HIS_TipoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoAtencionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoAtencionEliminar]
	@IdHisTipoAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_TipoAtencion
where IdHisTipoAtencion = @IdHisTipoAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisTipoAtencion,'HIS_TipoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoAtencionModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoAtencionModificar]
	@IdHisTipoAtencion [int],
	@Codigo [char](3),
	@Descripcion [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_TipoAtencion
set
Codigo = @Codigo,
Descripcion = @Descripcion
where IdHisTipoAtencion = @IdHisTipoAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisTipoAtencion,'HIS_TipoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoAtencionSeleccionarPorId]
	@IdHisTipoAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_TipoAtencion
where IdHisTipoAtencion = @IdHisTipoAtencion
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoEdadAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoEdadAgregar]
	@IdHisTipoEdad [int] OUTPUT,
	@CodigoEdad [char](1),
	@Descripcion [varchar](5),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_TipoEdad (
CodigoEdad,Descripcion) values (
@CodigoEdad,@Descripcion)
set @IdHisTipoEdad = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisTipoEdad,'HIS_TipoEdad'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdadAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoEdadEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoEdadEliminar]
	@IdHisTipoEdad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_TipoEdad
where IdHisTipoEdad = @IdHisTipoEdad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisTipoEdad,'HIS_TipoEdad'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdadEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoEdadModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoEdadModificar]
	@IdHisTipoEdad [int],
	@CodigoEdad [char](1),
	@Descripcion [varchar](5),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_TipoEdad
set
CodigoEdad = @CodigoEdad,
Descripcion = @Descripcion
where IdHisTipoEdad = @IdHisTipoEdad
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisTipoEdad,'HIS_TipoEdad'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdadModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoEdadSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TipoEdadSeleccionarPorId]
	@IdHisTipoEdad [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_TipoEdad
where IdHisTipoEdad = @IdHisTipoEdad
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdadSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TipoEdadSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_TipoEdadSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT [IdHisTipoEdad], [CodigoEdad], [Descripcion], [CodigoEdad] + ' - ' + [Descripcion] as [Descripcionlarga] FROM [HIS_TipoEdad]
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TipoEdadSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TiposCondicionPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TiposCondicionPaciente]
WITH EXECUTE AS CALLER
AS
select IdTipoCondicionPaciente,Descripcion,SUBSTRING (Descripcion,1,1) + ' = ' + Descripcion as DescripcionLarga
From TiposCondicionPaciente
order by OrdenRegHis asc
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TiposCondicionPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TiposSexo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TiposSexo]
WITH EXECUTE AS CALLER
AS
select IdTipoSexo, Descripcion,SUBSTRING (Descripcion,1,1) + ' = ' + Descripcion as DescripcionLarga
From TiposSexo
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TiposSexo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TurnosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TurnosAgregar]
	@IdHisTurno [int] OUTPUT,
	@Descripcion [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HIS_Turnos (
Descripcion) values (
@Descripcion)
set @IdHisTurno = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHisTurno,'HIS_Turnos'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TurnosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TurnosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TurnosEliminar]
	@IdHisTurno [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HIS_Turnos
where IdHisTurno = @IdHisTurno
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdHisTurno,'HIS_Turnos'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TurnosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TurnosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TurnosModificar]
	@IdHisTurno [int],
	@Descripcion [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HIS_Turnos
set
Descripcion = @Descripcion
where IdHisTurno = @IdHisTurno
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHisTurno,'HIS_Turnos'
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TurnosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TurnosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HIS_TurnosSeleccionarPorId]
	@IdHisTurno [int]
WITH EXECUTE AS CALLER
AS
select * from HIS_Turnos
where IdHisTurno = @IdHisTurno
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TurnosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HIS_TurnosSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HIS_TurnosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT IdHisTurno, Descripcion, (Convert(varchar(5), IdHisTurno) + ' - ' + Descripcion) as DescripcionLarga  from HIS_Turnos
GO
ALTER AUTHORIZATION ON [dbo].[HIS_TurnosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[His_ValidacionesConsultarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[His_ValidacionesConsultarTodos]
WITH EXECUTE AS CALLER
AS
Select * from His_Validaciones
where codcondicion='V'
ORDER BY CODVALIDACION
GO
ALTER AUTHORIZATION ON [dbo].[His_ValidacionesConsultarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HisDetalleDiagnosticoListaIdsDiagnosticosPorIdCabecera]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HisDetalleDiagnosticoListaIdsDiagnosticosPorIdCabecera]
	@IdHisCabecera [int]
WITH EXECUTE AS CALLER
AS
select IdHisDetalle, IdHisDetalleDiagnostico from his_detallediagnostico
 where IdHIsDetalle IN(select IdHisDetalle from his_detalle where IdHisCabecera = @IdHisCabecera)
GO
ALTER AUTHORIZATION ON [dbo].[HisDetalleDiagnosticoListaIdsDiagnosticosPorIdCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HisLotesXEstablecimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HisLotesXEstablecimientos]
	@idestablecimiento [int]
WITH EXECUTE AS CALLER
AS
select * from his_lotes hl
where hl.idestablecimiento=@idestablecimiento
GO
ALTER AUTHORIZATION ON [dbo].[HisLotesXEstablecimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HisLotesXEstablecimientoyLote]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HisLotesXEstablecimientoyLote]
	@idestablecimiento [int],
	@idhislote [int]
WITH EXECUTE AS CALLER
AS
select top 1 hl.idHisLote,hl.Lote,hl.IdEstablecimiento,e.nombre,hl.NroHojas,
hc.nroHojaHis NroHojaActual,hl.idestadolote,he.descripcion as HisEstadoLote
from his_lotes hl inner join his_cabecera hc on hl.idhislote=hc.idhislote
inner join establecimientos e on e.idestablecimiento=hl.IdEstablecimiento
inner join his_estadoscalidad he on hl.idestadolote=he.idestado
where hl.idHisLote=@idhislote and hl.idestablecimiento=@idestablecimiento
order by hc.nroHojaHis desc
GO
ALTER AUTHORIZATION ON [dbo].[HisLotesXEstablecimientoyLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HisLoteXfiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HisLoteXfiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET  @SQL = 'select * from hisLote where ' +  @Filtro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HisLoteXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HisObtenerListaEstablecimientosMRPorEspecialidad]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HisObtenerListaEstablecimientosMRPorEspecialidad]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
SELECT IdEstablecimiento, codigo, nombre as NombreEstablecimiento, 0 idestado
FROM ESTABLECIMIENTOS
WHERE IDESTABLECIMIENTO IN (
select distinct h.idEstablecimiento from  HIS_ServEstablecimiento h
where h.idservicio in (select s.IdServicio from servicios s where s.idespecialidad=@IdEspecialidad)
)
GO
ALTER AUTHORIZATION ON [dbo].[HisObtenerListaEstablecimientosMRPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaClinicaEsNueva]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaClinicaEsNueva]
	@esNueva [varchar](3) OUTPUT,
	@nroHistoriaClinica [int],
	@idTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
set @esNueva=''
declare @fechaCreacion datetime

DECLARE PacientesCursor CURSOR FOR select fechaCreacion from HistoriasClinicas where nroHistoriaClinica=@nroHistoriaClinica and idTipoNumeracion=@idTipoNumeracion
OPEN PacientesCursor
FETCH NEXT FROM PacientesCursor INTO @fechaCreacion
if @@FETCH_STATUS <> -1
begin
      declare @fechaActual as datetime
      select  @fechaActual=getdate()
      if  year(@fechaActual)=year(@fechaCreacion) and month(@fechaActual)=month(@fechaCreacion) and day(@fechaActual)=day(@fechaCreacion)
          set @esNueva='(n)'
      else
          set @esNueva=''
end
CLOSE PacientesCursor
DEALLOCATE PacientesCursor
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaClinicaEsNueva] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaClinicaSeleccionarXhistoriaYtipoNumeracion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaClinicaSeleccionarXhistoriaYtipoNumeracion]
	@NroHistoriaClinica [int],
	@IdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where NroHistoriaClinica=@NroHistoriaClinica and idTipoNumeracion=@IdTipoNumeracion
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaClinicaSeleccionarXhistoriaYtipoNumeracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaClinicasSeleccionarXnrohistoria]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaClinicasSeleccionarXnrohistoria]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	     dbo.Pacientes.SegundoNombre,dbo.HistoriasClinicas.NroHistoriaClinicaAnterior,dbo.HistoriasClinicas.idTipoNumeracionAnterior
FROM        dbo.HistoriasClinicas INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
WHERE dbo.HistoriasClinicas.NroHistoriaClinica=@NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaClinicasSeleccionarXnrohistoria] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaClinicasXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaClinicasXidentificador]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select idPaciente from HistoriasClinicas where NroHistoriaClinica=@NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaClinicasXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaPagoCita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaPagoCita]
	@IdAtencion [int],
	@Motivo [char](1)
WITH EXECUTE AS CALLER
AS
IF @Motivo='1'
	BEGIN
		SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
		dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
		dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion
		FROM         dbo.Atenciones RIGHT OUTER JOIN
		dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
		dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
		Where  dbo.Atenciones.idAtencion=@IdAtencion  and (dbo.Atenciones.IdTipoServicio = 1)
	END

IF @Motivo='2'
	BEGIN
		SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
		dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
		dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion
		FROM         dbo.Atenciones RIGHT OUTER JOIN
		dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
		dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
		Where  dbo.Atenciones.idAtencion=@IdAtencion  and (dbo.Atenciones.IdTipoServicio = 3)
	END

IF @Motivo='3'
	BEGIN
		SELECT     dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
		dbo.Atenciones.IdServicioIngreso, dbo.TiposFinanciamiento.Descripcion, dbo.FactOrdenServicio.IdEstadoFacturacion,
		dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdEstadoFacturacion
		FROM         dbo.Atenciones RIGHT OUTER JOIN
		dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion LEFT OUTER JOIN
		dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
		Where  dbo.Atenciones.idAtencion=@IdAtencion  and (dbo.Atenciones.IdTipoServicio in (2,4))
	END
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaPagoCita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasActualizaFmovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasActualizaFmovimiento]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
if @idPaciente=0
      update HistoriasClinicas set FultimoMovimiento =
      (select top 1
             case Atenciones.IdTipoServicio   when 1 then Atenciones.FechaIngreso
                                                    else Atenciones.FechaEgreso  end
        from Atenciones
       where Atenciones.IdPaciente =HistoriasClinicas.IdPaciente  and
             Atenciones.IdTipoServicio <4 and Atenciones.idEstadoAtencion<>0
       order by Atenciones.FechaIngreso desc)
else
      update HistoriasClinicas set FultimoMovimiento =
        (select top 1
             case Atenciones.IdTipoServicio   when 1 then Atenciones.FechaIngreso
                                                    else Atenciones.FechaEgreso  end
          from Atenciones
            where Atenciones.IdPaciente =HistoriasClinicas.IdPaciente  and
             Atenciones.IdTipoServicio <4 and Atenciones.idEstadoAtencion<>0
           order by Atenciones.FechaIngreso desc)
       where IdPaciente =@idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasActualizaFmovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasActualizarNroHistoriaClinica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasActualizarNroHistoriaClinica]
	@NroHistoriaNew [int],
	@NroHistoriaActual [int]
WITH EXECUTE AS CALLER
AS
update historiasClinicas set NroHistoriaClinicaAnterior=@NroHistoriaActual,
        HistoriaSistemaAnterior=convert(varchar(50),@nrohistoriaActual),
        fechaUltimoCambioHistoria=getdate()
        where nroHistoriaClinica=@NroHistoriaActual;
update historiasClinicas set NroHistoriaClinica=@NroHistoriaNew  where nroHistoriaClinica=@NroHistoriaActual
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasActualizarNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasAgregar]
	@IdTipoNumeracionAnterior [int],
	@NroHistoriaClinicaAnterior [int],
	@IdTipoNumeracion [int],
	@NroHistoriaClinica [int],
	@FechaCreacion [datetime],
	@FechaPasoAPasivo [datetime],
	@IdTipoHistoria [int],
	@IdEstadoHistoria [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into HistoriasClinicas (
IdTipoNumeracionAnterior,NroHistoriaClinicaAnterior,IdTipoNumeracion,FechaCreacion,FechaPasoAPasivo,IdTipoHistoria,IdEstadoHistoria,IdPaciente,NroHistoriaClinica) values (
@IdTipoNumeracionAnterior,@NroHistoriaClinicaAnterior,@IdTipoNumeracion,@FechaCreacion,@FechaPasoAPasivo,@IdTipoHistoria,@IdEstadoHistoria,@IdPaciente,@NroHistoriaClinica)
--set @NroHistoriaClinica = @@Identity
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@NroHistoriaClinica,'HistoriasClinicas'
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasAgregarPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasAgregarPorIdPaciente]
	@IdPaciente [int],
	@NroHistoriaClinica [int],
	@FechaCreacion [datetime],
	@IdTipoNumeracion [int],
	@IdEstadoHistoria [int],
	@IdTipoHistoria [int],
	@HistoriaSistemaAnterior [varchar](50)
WITH EXECUTE AS CALLER
AS
INSERT INTO HistoriasClinicas (IdPaciente,NroHistoriaClinica,FechaCreacion,IdTipoNumeracion,IdEstadoHistoria,IdTipoHistoria,HistoriaSistemaAnterior)
VALUES (@IdPaciente,@NroHistoriaClinica,@FechaCreacion,@IdTipoNumeracion,@IdEstadoHistoria,@IdTipoHistoria,@HistoriaSistemaAnterior)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasAgregarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasEliminar]
	@NroHistoriaClinica [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HistoriasClinicas
where NroHistoriaClinica = @NroHistoriaClinica
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@NroHistoriaClinica,'HistoriasClinicas'
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasGenerarNroHistoria]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasGenerarNroHistoria]
	@IdTipoNumeracion [int],
	@NroHistoriaClinica [int] OUTPUT
WITH EXECUTE AS CALLER
AS
--1ro procesa los de tipo reciclado
	if @IdTipoNumeracion = 3
	begin
		--Busca un numero reciclado
		select  Top 1 @NroHistoriaClinica = NroHistoriaClinica
		from GeneradorNroHistoriaClinica
		where IdTipoNumeracion = 3 and estado = 1
		order by IdNumerador

		if @NroHistoriaClinica <> 0
		begin
			--pone el estado a cero para que ya no pueda usarse el numero otra vez
			update  GeneradorNroHistoriaClinica  set estado  = 0
			where NroHistoriaClinica = @NroHistoriaClinica  and IdTipoNumeracion = 3
		end
	end

	if @IdTipoNumeracion <> 3
	begin
		select @NroHistoriaClinica = isnull( NroHistoriaClinica +1 ,1)
		from GeneradorNroHistoriaClinica
		where IdTipoNumeracion = @IdTipoNumeracion
		and Estado = 1

		update  GeneradorNroHistoriaClinica
		set NroHistoriaClinica =@NroHistoriaClinica
		where IdTipoNumeracion = @IdTipoNumeracion
		and Estado = 1
	end
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasGenerarNroHistoria] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasModificar]
	@IdTipoNumeracionAnterior [int],
	@NroHistoriaClinicaAnterior [int],
	@IdTipoNumeracion [int],
	@NroHistoriaClinica [int],
	@FechaCreacion [datetime],
	@FechaPasoAPasivo [datetime],
	@IdTipoHistoria [int],
	@IdEstadoHistoria [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update HistoriasClinicas
set
IdTipoNumeracionAnterior = @IdTipoNumeracionAnterior,
NroHistoriaClinicaAnterior = @NroHistoriaClinicaAnterior,
IdTipoNumeracion = @IdTipoNumeracion,
FechaCreacion = @FechaCreacion,
FechaPasoAPasivo = @FechaPasoAPasivo,
IdTipoHistoria = @IdTipoHistoria,
IdEstadoHistoria = @IdEstadoHistoria,
IdPaciente = @IdPaciente
where NroHistoriaClinica = @NroHistoriaClinica
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@NroHistoriaClinica,'HistoriasClinicas'
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSegunFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
   SET  @SQL =  'select dbo.DNI_HISTORIAdevuelveSIN9(Pacientes.NroHistoriaClinica) as nroHistoriaClinica, Pacientes.ApellidoPAterno, Pacientes.ApellidoMaterno,
         Pacientes.PrimerNombre , Pacientes.SegundoNombre, convert(Char(10), HistoriasClinicas.FechaCreacion, 103) as FechaCreacion, Pacientes.IdPaciente,
         historiasclinicas.HistoriaSistemaAnterior as HistoriaAnterior,historiasclinicas.fechaUltimoCambioHistoria,Pacientes.NroHistoriaClinica as Hc
        from HistoriasClinicas inner join Pacientes on HistoriasClinicas.IdPaciente = Pacientes.IdPaciente   '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSeleccionarPorFechaCreacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSeleccionarPorFechaCreacion]
	@FechaInicio [varchar](20),
	@FechaFin [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from HistoriasClinicas where fechaCreacion Between (CONVERT(DATETIME, @FechaInicio + ' 00:00:00',103)) and (CONVERT(DATETIME,@FechaFin + ' 23:59:59',103))
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSeleccionarPorFechaCreacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSeleccionarPorId]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select * from HistoriasClinicas
where NroHistoriaClinica = @NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSeleccionarPorTipo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSeleccionarPorTipo]
	@IdtipoHistoria [int],
	@OrdenFiltro [varchar](20),
	@TipoFechaNacimiento [int]
WITH EXECUTE AS CALLER
AS
IF @TipoFechaNacimiento = 0
 BEGIN
	if @OrdenFiltro='HC'
	   begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
	             where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria
		order by     dbo.HistoriasClinicas.NroHistoriaClinica
	   End
	Else
	  if @OrdenFiltro='AUTOGENERADO'
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria
		 order by     dbo.Pacientes.Autogenerado
	  end
	  else
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria
		 order by     dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
	  End
	END
	IF @TipoFechaNacimiento = 1
	BEGIN
	if @OrdenFiltro='HC'
	   begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
	             where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada IS NULL OR PacientesDatosAdicionales.FNacimientoCalculada = 0)
		order by     dbo.HistoriasClinicas.NroHistoriaClinica
	   End
	Else
	  if @OrdenFiltro='AUTOGENERADO'
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada IS NULL OR PacientesDatosAdicionales.FNacimientoCalculada = 0)
		 order by     dbo.Pacientes.Autogenerado
	  end
	  else
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada IS NULL OR PacientesDatosAdicionales.FNacimientoCalculada = 0)
		 order by     dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
	  End
	END

	IF @TipoFechaNacimiento = 2
	BEGIN
	if @OrdenFiltro='HC'
	   begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
	             where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada = 1)
		order by     dbo.HistoriasClinicas.NroHistoriaClinica
	   End
	Else
	  if @OrdenFiltro='AUTOGENERADO'
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada = 1)
		 order by     dbo.Pacientes.Autogenerado
	  end
	  else
	  begin
		SELECT     dbo.HistoriasClinicas.NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
		                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
		                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
		                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
	                                  dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
		FROM         dbo.HistoriasClinicas
							INNER JOIN dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
							LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
		                    LEFT OUTER JOIN dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
		where         dbo.HistoriasClinicas.IdTipoHistoria=@IdtipoHistoria AND
							(PacientesDatosAdicionales.FNacimientoCalculada = 1)
		 order by     dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
	  End
	END
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSeleccionarPorTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from HistoriasClinicas
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasSeleccionarTodosFcreacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasSeleccionarTodosFcreacion]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
    select * from HistoriasClinicas order by fechaCreacion
else
    select * from HistoriasClinicas
               where  year(fechaCreacion)=@anioCreacion
               order by fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasSeleccionarTodosFcreacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasUltimoGenerado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasUltimoGenerado]
WITH EXECUTE AS CALLER
AS
select top 1 nroHistoriaClinica from HistoriasClinicas order by nroHistoriaClinica desc
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasUltimoGenerado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasXIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasXIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from HistoriasClinicas where idPaciente=@IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasXIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasClinicasYPacientesEliminarPorNroHistoriaClinica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasClinicasYPacientesEliminarPorNroHistoriaClinica]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
Delete from HistoriasClinicas where NroHistoriaClinica=  @NroHistoriaClinica
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

Delete from pacientes where NroHistoriaClinica=  @NroHistoriaClinica
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasClinicasYPacientesEliminarPorNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasMovimientos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasMovimientos]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosHistoriaClinica.*, dbo.Servicios.Nombre AS dOrigen, Servicios_1.Nombre AS dDestino
FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
 dbo.Servicios Servicios_1 ON dbo.MovimientosHistoriaClinica.IdServicioDestino = Servicios_1.IdServicio LEFT OUTER JOIN
 dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioOrigen = dbo.Servicios.IdServicio
 WHERE dbo.MovimientosHistoriaClinica.idPaciente=@IdPaciente
 ORDER  BY dbo.MovimientosHistoriaClinica.idMovimiento desc
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasNormasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasNormasModificar]
	@NoResolucion [varchar](100),
	@NoDirectiva [varchar](150),
	@Institucion [int],
	@FechaNorma [datetime],
	@AnioPasivo_N1 [int],
	@AnioElimin_N2 [int],
	@FechaVigencia [datetime],
	@Estado [int]
WITH EXECUTE AS CALLER
AS
update HistoriasNormas set
	NoResolucion=@NoResolucion,
	NoDirectiva=@NoDirectiva,
	FechaNorma=@FechaNorma,
	AnioPasivo_N1=@AnioPasivo_N1,
	AnioElimin_N2=@AnioElimin_N2,
	FechaVigencia=@FechaVigencia,
	Estado=@Estado
	where Institucion=@Institucion
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasNormasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[historiasnormasSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[historiasnormasSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from historiasnormas
GO
ALTER AUTHORIZATION ON [dbo].[historiasnormasSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasPagoCitaDescripcionTarifa]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasPagoCitaDescripcionTarifa]
	@IdAtencion [int],
	@Motivo [char](1)
WITH EXECUTE AS CALLER
AS
IF @Motivo='1'
	BEGIN
		SELECT    dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                                            dbo.Atenciones.IdServicioIngreso , dbo.TiposFinanciamiento.Descripcion,dbo.Atenciones.IdFormaPago
		FROM       dbo.Atenciones LEFT OUTER JOIN
                                           dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
			Where  dbo.Atenciones.idAtencion=@IdAtencion and (dbo.Atenciones.IdTipoServicio = 1)
	END

IF @Motivo='2'
	BEGIN
		SELECT    dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                                            dbo.Atenciones.IdServicioIngreso , dbo.TiposFinanciamiento.Descripcion,dbo.Atenciones.IdFormaPago
		FROM       dbo.Atenciones LEFT OUTER JOIN
                                           dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
			Where  dbo.Atenciones.idAtencion=@IdAtencion and (dbo.Atenciones.IdTipoServicio = 3)
	END

IF @Motivo='3'
	BEGIN
		SELECT    dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.IdPaciente,
                                            dbo.Atenciones.IdServicioIngreso , dbo.TiposFinanciamiento.Descripcion,dbo.Atenciones.IdFormaPago
		FROM       dbo.Atenciones LEFT OUTER JOIN
                                           dbo.TiposFinanciamiento ON dbo.Atenciones.IdFormaPago = dbo.TiposFinanciamiento.IdTipoFinanciamiento
			Where  dbo.Atenciones.idAtencion=@IdAtencion and (dbo.Atenciones.IdTipoServicio in (2,4))
	END
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasPagoCitaDescripcionTarifa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasActualizarIdMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasActualizarIdMovimiento]
	@IdHistoriaSolicitada [int],
	@IdEstadoRegistro [varchar](1),
	@Seleccionar [bit],
	@IdMovimientoHistoria [int]
WITH EXECUTE AS CALLER
AS
if @IdEstadoRegistro='A' and @Seleccionar=1
                          Update HistoriasSolicitadas  set IdMovimiento = @IdMovimientoHistoria  where IdHistoriaSolicitada = @IdHistoriaSolicitada
                    else
                           if @IdEstadoRegistro='M' and @Seleccionar=1
                                 Update HistoriasSolicitadas  set IdMovimiento = @IdMovimientoHistoria where IdHistoriaSolicitada = @IdHistoriaSolicitada
                           else
                                 Update HistoriasSolicitadas set IdMovimiento = null  where IdHistoriaSolicitada = @IdHistoriaSolicitada
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasActualizarIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasAgregar]
	@IdMotivo [int],
	@HoraRequerida [char](5),
	@FechaRequerida [datetime],
	@HoraSolicitud [char](5),
	@FechaSolicitud [datetime],
	@IdPaciente [int],
	@IdHistoriaSolicitada [int] OUTPUT,
	@IdEmpleadoSolicita [int],
	@IdMovimiento [int],
	@Observacion [varchar](150),
	@IdServicio [int],
	@IdUsuarioAuditoria [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
insert into HistoriasSolicitadas (
IdMotivo,HoraRequerida,FechaRequerida,HoraSolicitud,FechaSolicitud,IdPaciente,IdEmpleadoSolicita,IdMovimiento,Observacion,IdServicio,idAtencion) values (
@IdMotivo,@HoraRequerida,@FechaRequerida,@HoraSolicitud,@FechaSolicitud,@IdPaciente,@IdEmpleadoSolicita,@IdMovimiento,@Observacion,@IdServicio,@idAtencion)
set @IdHistoriaSolicitada = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdHistoriaSolicitada,'HistoriasSolicitadas'
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasEliminar]
	@IdHistoriaSolicitada [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HistoriasSolicitadas
where IdHistoriaSolicitada = @IdHistoriaSolicitada
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasEliminarIdMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasEliminarIdMovimiento]
	@IdHistoriaSolicitada [int]
WITH EXECUTE AS CALLER
AS
Update HistoriasSolicitadas
         set IdMovimiento = null
        where IdHistoriaSolicitada = @IdHistoriaSolicitada
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasEliminarIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasEliminarIdMovimientoIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasEliminarIdMovimientoIdPaciente]
	@IdHistoriaSolicitada [int],
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
Update HistoriasSolicitadas
         set IdMovimiento = null
        where IdHistoriaSolicitada = @IdHistoriaSolicitada and idPaciente=@idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasEliminarIdMovimientoIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasEliminarPorCita]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasEliminarPorCita]
	@IdPaciente [int],
	@Fecha [datetime],
	@HoraInicio [varchar](5)
WITH EXECUTE AS CALLER
AS
delete from HistoriasSolicitadas
     where IdPaciente = @IdPaciente
     and FechaRequerida = @Fecha
    and HoraRequerida = @HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasEliminarPorCita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasFiltrar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasFiltrar]
	@lcFiltro [varchar](3000),
	@lIdResponsable [varchar](10),
	@lIdTipoServicio [varchar](10),
	@lcBuscaParametro231 [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(4000)
if @lcBuscaParametro231='S'
   SET  @SQL =  'select
                    HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
                    HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
                    Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
                    convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
                    convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
                    TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
                    HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg,HistoriasClinicas.fechaCreacion
                     from (((HistoriasSolicitadas
                    left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
                    left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
                    left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
                    left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
                     where Servicios.IdTipoServicio = '+@lIdTipoServicio +' and HistoriasSolicitadas.IdServicio in
                    (select IdServicio from ArchiveroServicio where IdEmpleado = '+@lIdResponsable+')  '
                       +@lcFiltro
else
    set @SQL='select
                    HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
                    HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
                    Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
                    convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
                    convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
                    TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
                    HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg,HistoriasClinicas.fechacreacion
                     from (((HistoriasSolicitadas
                    left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
                    left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
                    left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
                    left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
                     where Servicios.IdTipoServicio = '+@lIdTipoServicio+ '    '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasFiltrarXmedico]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasFiltrarXmedico]
	@lcFiltro [varchar](3000),
	@lIdResponsable [varchar](10),
	@lIdTipoServicio [varchar](10),
	@lcBuscaParametro231 [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(4000)
if @lcBuscaParametro231='S'
   SET  @SQL =  'select
                    Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno, Empleados.Nombres MedicoNombres ,
                    ltrim(Empleados.ApellidoPaterno)+SPACE(1)+ltrim(Empleados.ApellidoMaterno)+SPACE(1)+ltrim(Empleados.Nombres) as nMedico,
                    HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
                    HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
                    Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
                    convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
                    convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
                     HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
                    TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+SPACE(1)+ltrim(Pacientes.ApellidoMaterno)+SPACE(1)+ltrim(Pacientes.PrimerNombre) as nPaciente,
                    HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg,HistoriasClinicas.fechacreacion,
                    Citas.idCita, Citas.idatencion
                     from ((((((Citas
                    left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
                    and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
                    and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
                    left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
                    left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
                    left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
                    left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
                    left join Medicos on Medicos.IdMedico = Citas.IdMedico)
                    left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
                    where Servicios.IdTipoServicio = '+@lIdTipoServicio+ '    '+
                       +@lcFiltro
else
    set @SQL='select
                    Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno, Empleados.Nombres MedicoNombres ,
                    HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
                    HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
                    Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
                    convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
                    convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
                     HistoriasSolicitadas.HoraRequerida ,
                    TiposHistoriaClinica.Descripcion as TipoHistoria,
                    HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg,HistoriasClinicas.fechacreacion,
                    Citas.idCita,Citas.idatencion
                     from ((((((Citas
                    left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
                    and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
                    and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
                    left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
                    left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
                    left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
                    left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
                    left join Medicos on Medicos.IdMedico = Citas.IdMedico)
                    left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
                    where Servicios.IdTipoServicio = '+@lIdTipoServicio +' and HistoriasSolicitadas.IdServicio in
                    (select IdServicio from ArchiveroServicio where IdEmpleado = '+@lIdResponsable + ')  '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasFiltrarXmedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasModificar]
	@IdMotivo [int],
	@HoraRequerida [char](5),
	@FechaRequerida [datetime],
	@HoraSolicitud [char](5),
	@FechaSolicitud [datetime],
	@IdPaciente [int],
	@IdHistoriaSolicitada [int],
	@IdEmpleadoSolicita [int],
	@IdMovimiento [int],
	@Observacion [varchar](150),
	@IdServicio [int],
	@IdUsuarioAuditoria [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
update HistoriasSolicitadas
set
IdMotivo = @IdMotivo,
HoraRequerida = @HoraRequerida,
FechaRequerida = @FechaRequerida,
HoraSolicitud = @HoraSolicitud,
FechaSolicitud = @FechaSolicitud,
IdPaciente = @IdPaciente,
IdEmpleadoSolicita = @IdEmpleadoSolicita,
IdMovimiento = @IdMovimiento,
Observacion = @Observacion,
IdServicio = @IdServicio,
idAtencion=@idAtencion
where IdHistoriaSolicitada = @IdHistoriaSolicitada
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdHistoriaSolicitada,'HistoriasSolicitadas'
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasNOexistentes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasNOexistentes]
WITH EXECUTE AS CALLER
AS
SELECT *
  FROM [sigh].[dbo].[Citas] where (select top 1 sigh.dbo.HistoriasSolicitadas.IdPaciente from sigh.dbo.HistoriasSolicitadas  where
								    sigh.dbo.HistoriasSolicitadas.FechaRequerida=sigh.dbo.Citas.Fecha  and
								    sigh.dbo.HistoriasSolicitadas.HoraRequerida=sigh.dbo.Citas.HoraInicio  and
								    sigh.dbo.HistoriasSolicitadas.IdServicio=sigh.dbo.Citas.IdServicio) is null
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasNOexistentes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasPorFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasPorFiltro]
	@lcFiltro [varchar](1500),
	@lIdEmpleado [varchar](10),
	@lnIdArchivoClinico [varchar](10),
	@lcParametro231 [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcParametro231='S'                 /*version HRA*/
   SET  @SQL =  'SELECT     NULL AS IdMovimientoHistoria, dbo.HistoriasSolicitadas.IdHistoriaSolicitada, dbo.Pacientes.IdPaciente, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.IdTipoNumeracion AS IdTipoHistoria,
                      dbo.Pacientes.ApellidoPaterno + " " + dbo.Pacientes.ApellidoMaterno + " " + dbo.Pacientes.PrimerNombre AS Nombres, CONVERT(char(10),
                      dbo.HistoriasSolicitadas.FechaSolicitud, 103) + " " + dbo.HistoriasSolicitadas.HoraSolicitud AS FechaSolicitud, CONVERT(char(10),
                      dbo.HistoriasSolicitadas.FechaRequerida, 103) +" " + dbo.HistoriasSolicitadas.HoraRequerida AS FechaRequerida, 0 AS NroFolios,'+
                     @lnIdArchivoClinico +' AS idServicioOrigen, "Archivo Clínico" AS NombreServicioOrigen, ServicioDestino.IdServicio AS IdServicioDestino,
                      ServicioDestino.Nombre AS NombreServicioDestino, dbo.HistoriasSolicitadas.IdAtencion
                FROM         dbo.HistoriasSolicitadas LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Pacientes.IdPaciente = dbo.HistoriasSolicitadas.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ServicioDestino ON ServicioDestino.IdServicio = dbo.HistoriasSolicitadas.IdServicio
                 Where HistoriasSolicitadas.IdMovimiento is null   '+@lcFiltro
else                                               /*version HBT*/
   SET  @SQL =  'select null as IdMovimientoHistoria, HistoriasSolicitadas.IdHistoriaSolicitada,
         Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
         Pacientes.ApellidoPaterno + " " + Pacientes.ApellidoMaterno + "  "+ Pacientes.PrimerNombre as Nombres,
         convert(char(10), HistoriasSolicitadas.FechaSolicitud, 103) + " " + HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,
         convert(char(10), HistoriasSolicitadas.FechaRequerida, 103) + " " + HistoriasSolicitadas.HoraRequerida as FechaRequerida,
         0 as NroFolios,'+ @lnIdArchivoClinico+' as  idServicioOrigen,"Archivo Clínico" as NombreServicioOrigen,
         ServicioDestino.IdServicio as IdServicioDestino, ServicioDestino.Nombre as NombreServicioDestino,HistoriasSolicitadas.idAtencion
         from (HistoriasSolicitadas
         left join Pacientes on Pacientes.IdPaciente = HistoriasSolicitadas.IdPaciente)
         left join Servicios as ServicioDestino on ServicioDestino.IdServicio = HistoriasSolicitadas.IdServicio
         left join ArchiveroServicio on ServicioDestino.IdServicio = ArchiveroServicio.IdServicio
         Where ArchiveroServicio.IdEmpleado = '+@lIdEmpleado+'
        and HistoriasSolicitadas.IdMovimiento is null   '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasQnoSalenAun]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasQnoSalenAun]
	@fechaCita [datetime],
	@ConsultoriosQnoEntran [varchar](500)
WITH EXECUTE AS CALLER
AS
if @ConsultoriosQnoEntran=''
SELECT     dbo.Servicios.Nombre AS Consultorio, dbo.HistoriasSolicitadas.HoraRequerida, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.TELEFONO,
                      dbo.HistoriasSolicitadas.Observacion
FROM         dbo.HistoriasSolicitadas LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.HistoriasSolicitadas.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ON dbo.HistoriasSolicitadas.IdServicio = dbo.Servicios.IdServicio
WHERE     (dbo.HistoriasSolicitadas.IdMotivo = 1) AND (dbo.HistoriasSolicitadas.IdMovimiento IS NULL) and
           dbo.HistoriasSolicitadas.FechaRequerida =CONVERT(datetime,@fechaCita,103) and dbo.Servicios.IdTipoServicio =1
ORDER BY Consultorio, dbo.HistoriasSolicitadas.HoraRequerida
else
SELECT     dbo.Servicios.Nombre AS Consultorio, dbo.HistoriasSolicitadas.HoraRequerida, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.TELEFONO,
                      dbo.HistoriasSolicitadas.Observacion
FROM         dbo.HistoriasSolicitadas LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.HistoriasSolicitadas.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ON dbo.HistoriasSolicitadas.IdServicio = dbo.Servicios.IdServicio
WHERE     (dbo.HistoriasSolicitadas.IdMotivo = 1) AND (dbo.HistoriasSolicitadas.IdMovimiento IS NULL) and
          not dbo.HistoriasSolicitadas.IdServicio in (264,271,23,270)  and
           dbo.HistoriasSolicitadas.FechaRequerida =CONVERT(datetime,@fechaCita,103) and dbo.Servicios.IdTipoServicio =1
ORDER BY Consultorio, dbo.HistoriasSolicitadas.HoraRequerida
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasQnoSalenAun] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSegunFiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSegunFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
   SET  @SQL =  'select
         convert(char(10), HistoriasSolicitadas.FechaSolicitud,103) + SPACE(1)+ HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,
         convert(char(10), HistoriasSolicitadas.FechaRequerida,103) + SPACE(1) + HistoriasSolicitadas.HoraRequerida as FechaRequerida,
         dbo.DNI_HISTORIAdevuelveSIN9(Pacientes.NroHistoriaClinica) as HistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion, Servicios.Nombre,
         HistoriasSolicitadas.IdHistoriaSolicitada, Pacientes.ApellidoPaterno , Pacientes.ApellidoMaterno , Pacientes.PrimerNombre ,
         HistoriasSolicitadas.Observacion
         from (((HistoriasSolicitadas left join  Pacientes
         on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
         left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
         left join HistoriasClinicas on HistoriasClinicas.IdPaciente = Pacientes.IdPaciente)
         left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion
         where HistoriasSolicitadas.IdMovimiento is null  and    '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarDetalleIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarDetalleIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select null as IdMovimientoHistoria, HistoriasSolicitadas.IdHistoriaSolicitada,
Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
Pacientes.ApellidoPaterno + ' ' + Pacientes.ApellidoMaterno + ' ' + Pacientes.PrimerNombre as Nombres,
convert(char(10), HistoriasSolicitadas.FechaSolicitud, 103) + ' ' + HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,
convert(char(10), HistoriasSolicitadas.FechaRequerida, 103) + ' ' + HistoriasSolicitadas.HoraRequerida as FechaRequerida,
0 as NroFolios,
--ServicioOrigen.IdServicio as IdServicioOrigen, ServicioOrigen.Nombre as NombreServicioOrigen,
(select IdServicioDestino from MovimientosHistoriaClinica
                where IdPaciente = HistoriasSolicitadas.IdPaciente and FechaMovimiento in (
                select top 1 FechaMovimiento from MovimientosHistoriaClinica
                where IdPaciente = HistoriasSolicitadas.IdPaciente
                order by FechaMovimiento desc) ) as IdServicioOrigen ,
(select Servicios.Nombre from MovimientosHistoriaClinica
left join Servicios on Servicios.IdServicio = MovimientosHistoriaClinica.IdServicioDestino
                where IdPaciente = HistoriasSolicitadas.IdPaciente and FechaMovimiento in (
                select top 1 FechaMovimiento from MovimientosHistoriaClinica
                where IdPaciente = HistoriasSolicitadas.IdPaciente
                order by FechaMovimiento desc) ) as NombreServicioOrigen ,
ServicioDestino.IdServicio as IdServicioDestino, ServicioDestino.Nombre as NombreServicioDestino
from (HistoriasSolicitadas
left join Pacientes on Pacientes.IdPaciente = HistoriasSolicitadas.IdPaciente)
left join Servicios as ServicioDestino on ServicioDestino.IdServicio = HistoriasSolicitadas.IdServicio
where
HistoriasSolicitadas.IdHistoriaSolicitada = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarDetalleIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarPorFechaRequerimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarPorFechaRequerimiento]
	@FechaReqIni [datetime],
	@FechaReqFin [datetime],
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
if @idEmpleado=0
	SELECT     dbo.HistoriasSolicitadas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServ, dbo.HistoriasClinicas.IdTipoHistoria AS Expr1
	FROM         dbo.Servicios RIGHT OUTER JOIN
	                      dbo.HistoriasSolicitadas LEFT OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.HistoriasSolicitadas.IdPaciente = dbo.HistoriasClinicas.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.HistoriasSolicitadas.IdServicio
	WHERE     (dbo.HistoriasSolicitadas.IdMovimiento IS NULL)  AND
	                      (fechaRequerida is not null)    and  (fechaRequerida Between  @FechaReqIni and  @FechaReqFin)
	ORDER BY dbo.HistoriasSolicitadas.idPaciente
else
	SELECT     dbo.HistoriasSolicitadas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServ, dbo.HistoriasClinicas.IdTipoHistoria AS Expr1
	FROM         dbo.Servicios RIGHT OUTER JOIN
	                      dbo.HistoriasSolicitadas LEFT OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.HistoriasSolicitadas.IdPaciente = dbo.HistoriasClinicas.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.HistoriasSolicitadas.IdServicio
	WHERE     (dbo.HistoriasSolicitadas.IdMovimiento IS NULL)  AND
	                      (fechaRequerida is not null)    and  (fechaRequerida Between  @FechaReqIni and  @FechaReqFin)
	                        AND (dbo.HistoriasSolicitadas.IdServicio IN
	                          (SELECT     dbo.ArchiveroServicio.IdServicio
	                            From dbo.ArchiveroServicio
	                            WHERE      dbo.ArchiveroServicio.IdEmpleado = @idEmpleado))
	ORDER BY dbo.HistoriasSolicitadas.idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarPorFechaRequerimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarPorId]
	@IdHistoriaSolicitada [int]
WITH EXECUTE AS CALLER
AS
select * from HistoriasSolicitadas
where IdHistoriaSolicitada = @IdHistoriaSolicitada
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from HistoriasSolicitadas
where IdAtencion =@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarPorIdPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HistoriasSolicitadas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServ
FROM         dbo.Servicios RIGHT OUTER JOIN
                      dbo.HistoriasSolicitadas ON dbo.Servicios.IdServicio = dbo.HistoriasSolicitadas.IdServicio
where dbo.HistoriasSolicitadas.idPaciente=@idPaciente
order by dbo.HistoriasSolicitadas.fechaRequerida desc
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarPorTipoFechaRequerimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarPorTipoFechaRequerimiento]
	@FechaReqIni [datetime],
	@FechaReqFin [datetime],
	@TipoHistoria [int],
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
if @idEmpleado=0
	SELECT     dbo.HistoriasSolicitadas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServ, dbo.HistoriasClinicas.IdTipoHistoria AS Expr1
	FROM         dbo.Servicios RIGHT OUTER JOIN
	                      dbo.HistoriasSolicitadas LEFT OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.HistoriasSolicitadas.IdPaciente = dbo.HistoriasClinicas.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.HistoriasSolicitadas.IdServicio
	WHERE     (dbo.HistoriasSolicitadas.IdMovimiento IS NULL)  AND
	                     dbo.HistoriasClinicas.IdTipoHistoria = @TipoHistoria and (fechaRequerida is not null)    and  (fechaRequerida Between  @FechaReqIni and  @FechaReqFin)
	ORDER BY dbo.HistoriasSolicitadas.idPaciente
else
	SELECT     dbo.HistoriasSolicitadas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServ, dbo.HistoriasClinicas.IdTipoHistoria AS Expr1
	FROM         dbo.Servicios RIGHT OUTER JOIN
	                      dbo.HistoriasSolicitadas LEFT OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.HistoriasSolicitadas.IdPaciente = dbo.HistoriasClinicas.IdPaciente ON
	                      dbo.Servicios.IdServicio = dbo.HistoriasSolicitadas.IdServicio
	WHERE     (dbo.HistoriasSolicitadas.IdMovimiento IS NULL)  AND
	                     dbo.HistoriasClinicas.IdTipoHistoria = @TipoHistoria and (fechaRequerida is not null)    and  (fechaRequerida Between  @FechaReqIni and  @FechaReqFin)
	                        AND (dbo.HistoriasSolicitadas.IdServicio IN
	                          (SELECT     dbo.ArchiveroServicio.IdServicio
	                            From dbo.ArchiveroServicio
	                            WHERE      dbo.ArchiveroServicio.IdEmpleado = @idEmpleado))
	ORDER BY dbo.HistoriasSolicitadas.idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarPorTipoFechaRequerimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasSeleccionarXmotivosYfechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasSeleccionarXmotivosYfechas]
	@WhereIdTipoServicio [varchar](150),
	@WhereFechaIngreso [varchar](150),
	@WhereNroHistoriaClinica [varchar](150),
	@WhereIdServicioIngreso [varchar](150)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL  AS VARCHAR(2000)

SET @SQL = 'SELECT     dbo.Atenciones.IdPaciente, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,dbo.Atenciones.fechaEgreso,
			 dbo.Pacientes.PrimerNombre , dbo.Pacientes.SegundoNombre, dbo.Atenciones.IdServicioIngreso, dbo.Servicios.Nombre,dbo.Atenciones.fechaIngreso,dbo.Atenciones.horaIngreso
	           FROM      dbo.Atenciones LEFT OUTER JOIN
			dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
			dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
	           WHERE ' + @WhereIdTipoServicio

IF @WhereFechaIngreso<>''
	BEGIN
		SET @SQL= @SQL + ' ' + @WhereFechaIngreso
	END

IF @WhereNroHistoriaClinica<>''
	BEGIN
		SET @SQL= @SQL + ' ' + @WhereNroHistoriaClinica
	END

IF @WhereIdServicioIngreso<>''
	BEGIN
		SET @SQL= @SQL + ' ' + @WhereIdServicioIngreso
	END

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasSeleccionarXmotivosYfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasXidentificador]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from HistoriasSolicitadas where idMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasXidMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasXidMovimiento]
	@lIdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select HistoriasSolicitadas.IdHistoriaSolicitada,
         convert(char(10), HistoriasSolicitadas.FechaSolicitud,103) + ' ' + HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,HistoriasSolicitadas.FechaRequerida
         from HistoriasSolicitadas
         where IdMovimiento = @lIdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasXidMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriasSolicitadasXidPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriasSolicitadasXidPaciente]
	@lIdPaciente [int]
WITH EXECUTE AS CALLER
AS
select HistoriasSolicitadas.IdHistoriaSolicitada,
         convert(char(10), HistoriasSolicitadas.FechaSolicitud,103) + ' ' + HistoriasSolicitadas.HoraSolicitud as FechaSolicitud,
         convert(char(10), HistoriasSolicitadas.FechaRequerida,103) + ' ' + HistoriasSolicitadas.HoraRequerida as FechaRequerida
         ,HistoriasSolicitadas.IdServicio, Servicios.Codigo, Servicios.Nombre
         from HistoriasSolicitadas left join Servicios
         on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
         where IdPaciente = @lIdPaciente
         and IdMovimiento is null
GO
ALTER AUTHORIZATION ON [dbo].[HistoriasSolicitadasXidPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaUltimoMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaUltimoMovimiento]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 * From dbo.MovimientosHistoriaClinica
                  Where (idPaciente =@IdPaciente)
ORDER BY FechaMovimiento DESC
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaUltimoMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[HistoriaUltimoServicioDondeEstubo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[HistoriaUltimoServicioDondeEstubo]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 * From dbo.Atenciones
Where (idPaciente = @IdPaciente)
ORDER BY FechaIngreso DESC
GO
ALTER AUTHORIZATION ON [dbo].[HistoriaUltimoServicioDondeEstubo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagCatalgoServicioDuracionAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagCatalgoServicioDuracionAgregar]
	@IdProducto [int],
	@DuracionEnMin [money],
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
IF NOT EXISTS(SELECT 1 FROM ImagCatalgoServicioDuracion WHERE IdProducto = @IdProducto)
	BEGIN
		INSERT INTO ImagCatalgoServicioDuracion (IdProducto,
		DuracionEnMin, EsActivo, FechaCrea, FechaEdita) values (
		@IdProducto, @DuracionEnMin, 1, GETDATE(), NULL);
	END
	ELSE
	BEGIN
		EXEC ImagCatalgoServicioDuracionModificar @IdProducto, @DuracionEnMin,
							@EsActivo, @FechaCrea, @FechaEdita, @IdUsuarioAuditoria;
	END;
	-- SET @IdProducto = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProducto,'ImagCatalgoServicioDuracion'
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagCatalgoServicioDuracionEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagCatalgoServicioDuracionEliminar]
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE  ImagCatalgoServicioDuracion SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdProducto = @IdProducto
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdProducto,'ImagCatalgoServicioDuracion'
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagCatalgoServicioDuracionFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagCatalgoServicioDuracionFiltrarTodos]
	@Codigo [varchar](20),
	@Nombre [varchar](255)
WITH EXECUTE AS CALLER
AS
IF @Nombre IS NULL
	BEGIN
		SET @Nombre = '';
	END;
	IF @Codigo IS NULL
	BEGIN
		SET @Codigo = '';
	END;


	IF @Codigo != ''
	BEGIN
		-- SET @Codigo = @Codigo + '%';

		SELECT FCS.IdProducto, FCS.Codigo, FCS.Nombre, FCS.CodMINSA, FCS.EsCpt, FCS.NombreMinsa, FCS.idEstado, CSD.DuracionEnMin
		FROM FactCatalogoServicios AS FCS
		LEFT JOIN ImagCatalgoServicioDuracion AS CSD ON CSD.IdProducto = FCS.IdProducto
		WHERE FCS.EsCpt = 1 AND FCS.idEstado = 1 AND  FCS.Codigo = @Codigo
			AND  EXISTS(SELECT 1 FROM FactCatalogoServiciosPtos AS FCSP
					WHERE FCSP.IdProducto = FCS.IdProducto
							AND FCSP.IdPuntoCarga IN
								(SELECT SP.IdPuntoCarga FROM ImagSalaPuntoCarga AS SP
									INNER JOIN FactPuntosCarga AS P ON SP.IdPuntoCarga = P.IdPuntoCarga
								WHERE SP.EsActivo = 1 AND P.TipoPunto = 'I'));
	END
	ELSE
	BEGIN
		SET @Nombre = '%' + @Nombre + '%';

		SELECT FCS.IdProducto, FCS.Codigo, FCS.Nombre, FCS.CodMINSA, FCS.EsCpt, FCS.NombreMinsa, FCS.idEstado, CSD.DuracionEnMin
		FROM FactCatalogoServicios AS FCS
		LEFT JOIN ImagCatalgoServicioDuracion AS CSD ON CSD.IdProducto = FCS.IdProducto
		WHERE FCS.EsCpt = 1 AND FCS.idEstado = 1 AND  FCS.Nombre LIKE @Nombre
			AND  EXISTS(SELECT 1 FROM FactCatalogoServiciosPtos AS FCSP
					WHERE FCSP.IdProducto = FCS.IdProducto
							AND FCSP.IdPuntoCarga IN
								(SELECT SP.IdPuntoCarga FROM ImagSalaPuntoCarga AS SP
									INNER JOIN FactPuntosCarga AS P ON SP.IdPuntoCarga = P.IdPuntoCarga
								WHERE SP.EsActivo = 1 AND P.TipoPunto = 'I'));
	END;
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracionFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagCatalgoServicioDuracionModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagCatalgoServicioDuracionModificar]
	@IdProducto [int],
	@DuracionEnMin [money],
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagCatalgoServicioDuracion
	SET
	DuracionEnMin = @DuracionEnMin,
	EsActivo = 1,
	FechaEdita = GETDATE()
	WHERE IdProducto = @IdProducto
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdProducto,'ImagCatalgoServicioDuracion'
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagCatalgoServicioDuracionSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagCatalgoServicioDuracionSeleccionarPorId]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagCatalgoServicioDuracion
	WHERE IdProducto = @IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[ImagCatalgoServicioDuracionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagenesDevuelveAlertaDeCantidades]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagenesDevuelveAlertaDeCantidades]
WITH EXECUTE AS CALLER
AS
SELECT   top 30   dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha,
                dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimientoCPT.cantidad
FROM      dbo.ImagMovimiento RIGHT OUTER JOIN
                dbo.ImagMovimientoCPT ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento LEFT OUTER JOIN
                dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto
 ORDER BY dbo.ImagMovimientoCPT.cantidad DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagenesDevuelveAlertaDeCantidades] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagenesXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagenesXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.IdOrden, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.ResultadoFinal,
                                              LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS especialista,
                                             dbo.ImagMovimientoImagenes.idMovimiento
                         FROM         dbo.ImagMovimientoImagenes INNER JOIN
                                              dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
                                              dbo.Empleados ON dbo.ImagMovimientoImagenes.idPersonaTomaImagen = dbo.Empleados.IdEmpleado
                         WHERE dbo.ImagMovimientoImagenes.IdOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[ImagenesXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMotivoSalidasSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMotivoSalidasSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from ImagMotivoSalidas order by motivo
GO
ALTER AUTHORIZATION ON [dbo].[ImagMotivoSalidasSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoAgregar]
	@IdMovimiento [int] OUTPUT,
	@MovTipo [varchar](1),
	@IdTipoConcepto [int],
	@IdPuntoCarga [int],
	@Fecha [datetime],
	@IdUsuario [int],
	@IdImagEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimiento (
MovTipo,IdTipoConcepto,IdPuntoCarga,Fecha,IdUsuario,IdImagEstado) values (
@MovTipo,@IdTipoConcepto,@IdPuntoCarga,@Fecha,@IdUsuario,@IdImagEstado)
set @IdMovimiento = @@identity

declare @TablaMovimiento varchar(30)
set @TablaMovimiento='ImagMovimiento/'+@movTipo+'/'+ltrim(str(@idMovimiento))
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',0,@TablaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoCPTAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoCPTAgregar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@cantidad [int],
	@precio [money],
	@importe [money],
	@ResultadoAutomatico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoCPT (
idMovimiento,idProductoCPT,cantidad,precio,importe,ResultadoAutomatico) values (
@idMovimiento,@idProductoCPT,@cantidad,@precio,@importe,@ResultadoAutomatico)
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPTAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoCPTEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoCPTEliminar]
	@idMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimientoCPT
where idMovimiento = @idMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idMovimiento,'ImagMovimientoCPT'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPTEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoCPTModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoCPTModificar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@cantidad [int],
	@precio [money],
	@importe [money],
	@ResultadoAutomatico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoCPT
set
idProductoCPT = @idProductoCPT,
cantidad = @cantidad,
precio = @precio,
importe = @importe,
ResultadoAutomatico=@ResultadoAutomatico
where idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPTModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoCPTSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoCPTSeleccionarPorId]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoCPT.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
           dbo.FactCatalogoServicios.LabResultadoAutomatico
FROM         dbo.ImagMovimientoCPT LEFT OUTER JOIN
                   dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto
where       dbo.ImagMovimientoCPT.idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPTSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoCPTXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoCPTXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.IdCuentaAtencion, dbo.ImagMovimiento.IdImagEstado, dbo.ImagMovimientoCPT.*
FROM         dbo.ImagMovimientoCPT INNER JOIN
                      dbo.ImagMovimiento ON dbo.ImagMovimientoCPT.idMovimiento = dbo.ImagMovimiento.IdMovimiento INNER JOIN
                      dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento
WHERE     (dbo.ImagMovimiento.IdImagEstado<>0)  and dbo.ImagMovimientoImagenes.IdCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoCPTXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoDetalleAgregar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@idProducto [int],
	@CantidadFallada [int],
	@Cantidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoDetalle (
idMovimiento,idProducto,Cantidad,CantidadFallada,idProductoCPT) values (
@idMovimiento,@idProducto,@Cantidad,@CantidadFallada,@idProductoCPT)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idMovimiento,'ImagMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoDetalleEliminar]
	@idMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimientoDetalle
where idMovimiento = @idMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idMovimiento,'ImagMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoDetalleModificar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@idProducto [int],
	@CantidadFallada [int],
	@Cantidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoDetalle
set
idProducto = @idProducto,
Cantidad = @Cantidad,
CantidadFallada=@CantidadFallada,
idProductoCPT=@idProductoCPT
where idMovimiento = @idMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idMovimiento,'ImagMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoDetalleSeleccionarPorFechasYpuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoDetalleSeleccionarPorFechasYpuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
if @idProducto  =0
	SELECT     dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimientoDetalle.Cantidad,
		      dbo.ImagMovimientoDetalle.CantidadFallada,
	                      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.MovTipo,
	                      dbo.ImagMovimiento.IdTipoConcepto, dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha
	FROM         dbo.ImagTipoConceptos RIGHT OUTER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagTipoConceptos.idTipoConcepto = dbo.ImagMovimiento.IdTipoConcepto RIGHT OUTER JOIN
	                      dbo.ImagMovimientoDetalle LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoDetalle.idProducto = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoDetalle.idMovimiento
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1
	ORDER BY   dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimiento.Fecha
else
	SELECT     dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimientoDetalle.Cantidad,
		      dbo.ImagMovimientoDetalle.CantidadFallada,
	                      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.MovTipo,
	                      dbo.ImagMovimiento.IdTipoConcepto, dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha
	FROM         dbo.ImagTipoConceptos RIGHT OUTER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagTipoConceptos.idTipoConcepto = dbo.ImagMovimiento.IdTipoConcepto RIGHT OUTER JOIN
	                      dbo.ImagMovimientoDetalle LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoDetalle.idProducto = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoDetalle.idMovimiento
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and dbo.ImagMovimientoDetalle.idProducto=@idProducto
	ORDER BY    dbo.ImagMovimiento.Fecha
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalleSeleccionarPorFechasYpuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoDetalleSeleccionarPorId]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoDetalle.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
FROM         dbo.ImagMovimientoDetalle LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoDetalle.idProducto = dbo.FactCatalogoServicios.IdProducto
where dbo.ImagMovimientoDetalle.idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimiento
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'ImagMovimiento'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesActualizaHcRX]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesActualizaHcRX]
	@paciente [varchar](100),
	@hcRx [varchar](10)
WITH EXECUTE AS CALLER
AS
update  ImagMovimientoImagenes set hcrx=@hcRx where Paciente =@paciente
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesActualizaHcRX] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesAgregar]
	@IdMovimiento [int],
	@IdOrden [int],
	@CorrelativoAnual [int],
	@IdCuentaAtencion [int],
	@IdComprobantePago [int],
	@idPersonaTomaImagen [int],
	@idPersonaRecoge [int],
	@zonaRayosX [varchar](50),
	@PorcInformeRadiolog [money],
	@ResultadoFinal [varchar](3000),
	@EsContraste [int],
	@EsContrasteIonico [int],
	@idDiagnostico [int],
	@EsDiagnosticoDefinitivo [int],
	@Eo_FUM [datetime],
	@Eo_Gestantes [varchar](2),
	@Eo_Partos [varchar](20),
	@Eo_EG [int],
	@Paciente [varchar](100),
	@IdTipoSexo [int],
	@FechaNacimiento [datetime],
	@HCrx [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoImagenes (
IdMovimiento,IdOrden,CorrelativoAnual,IdCuentaAtencion,IdComprobantePago,idPersonaTomaImagen,idPersonaRecoge,zonaRayosX,PorcInformeRadiolog,ResultadoFinal,EsContraste,EsContrasteIonico,
idDiagnostico,EsDiagnosticoDefinitivo,Eo_FUM,Eo_Gestantes,Eo_Partos,Eo_EG,Paciente,IdTipoSexo,FechaNacimiento,HCrx) values (
@IdMovimiento,@IdOrden,@CorrelativoAnual,@IdCuentaAtencion,@IdComprobantePago,@idPersonaTomaImagen,@idPersonaRecoge,@zonaRayosX,@PorcInformeRadiolog,@ResultadoFinal,@EsContraste,@EsContrasteIonico,
@idDiagnostico,@EsDiagnosticoDefinitivo,@Eo_FUM,@Eo_Gestantes,@Eo_Partos,@Eo_EG,@Paciente,@IdTipoSexo,@FechaNacimiento,@HCrx)
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimientoImagenes
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'ImagMovimientoImagenes'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesModificar]
	@IdMovimiento [int],
	@IdOrden [int],
	@CorrelativoAnual [int],
	@IdCuentaAtencion [int],
	@IdComprobantePago [int],
	@idPersonaTomaImagen [int],
	@idPersonaRecoge [int],
	@zonaRayosX [varchar](50),
	@PorcInformeRadiolog [money],
	@ResultadoFinal [varchar](3000),
	@EsContraste [int],
	@EsContrasteIonico [int],
	@idDiagnostico [int],
	@EsDiagnosticoDefinitivo [int],
	@Eo_FUM [datetime],
	@Eo_Gestantes [varchar](2),
	@Eo_Partos [varchar](20),
	@Eo_EG [int],
	@Paciente [varchar](100),
	@IdTipoSexo [int],
	@FechaNacimiento [datetime],
	@HCrx [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoImagenes
set
IdOrden = @IdOrden,
CorrelativoAnual = @CorrelativoAnual,
IdCuentaAtencion = @IdCuentaAtencion,
IdComprobantePago = @IdComprobantePago,
idPersonaTomaImagen = @idPersonaTomaImagen,
idPersonaRecoge = @idPersonaRecoge,
zonaRayosX = @zonaRayosX,
PorcInformeRadiolog = @PorcInformeRadiolog,
ResultadoFinal = @ResultadoFinal,
EsContraste =@EsContraste,
EsContrasteIonico=@EsContrasteIonico,
idDiagnostico=@idDiagnostico,
EsDiagnosticoDefinitivo=@EsDiagnosticoDefinitivo,
Eo_FUM=@Eo_FUM,
Eo_Gestantes=@Eo_Gestantes,
Eo_Partos=@Eo_Partos,
Eo_EG=@Eo_EG,
Paciente=@Paciente,
IdTipoSexo=@IdTipoSexo,
FechaNacimiento=@FechaNacimiento,
HCrx=@HCrx
where IdMovimiento = @IdMovimiento
declare @TablaMovimiento varchar(30)
set @TablaMovimiento='ImagMovimiento/S/'+ltrim(str(@idMovimiento))
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPtoInsumos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPtoInsumos]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
if @idOrden=3
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimientoDetalle.CantidadFallada,
	                      dbo.ImagMovimientoDetalle.Cantidad,dbo.Servicios.idTipoServicio
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.ImagMovimientoDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.ImagMovimientoDetalle.idProducto LEFT OUTER JOIN
	                      dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento ON
	                      dbo.ImagMovimientoDetalle.idMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimiento.Fecha
else
        if @idOrden=4
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimientoDetalle.CantidadFallada,
	                      dbo.ImagMovimientoDetalle.Cantidad,dbo.Servicios.idTipoServicio
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.ImagMovimientoDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.ImagMovimientoDetalle.idProducto LEFT OUTER JOIN
	                      dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento ON
	                      dbo.ImagMovimientoDetalle.idMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.ImagMovimiento.Fecha
        else
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.ImagMovimientoDetalle.idProducto, dbo.ImagMovimientoDetalle.CantidadFallada,
	                      dbo.ImagMovimientoDetalle.Cantidad,dbo.Servicios.idTipoServicio
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.ImagMovimientoDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.ImagMovimientoDetalle.idProducto LEFT OUTER JOIN
	                      dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento ON
	                      dbo.ImagMovimientoDetalle.idMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.ImagMovimientoDetalle.idProducto, dbo.FactOrdenServicio.IdServicioPaciente
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPtoInsumos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
if @idOrden=3
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      isnull(dbo.FuentesFinanciamiento.Descripcion,'') AS nombrePlan, dbo.ImagMovimientoCPT.cantidad, dbo.ImagMovimientoCPT.precio,
	                      dbo.ImagMovimientoCPT.importe AS total,dbo.ImagMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio, dbo.FactCatalogoServicios.NombreMINSA,
                                   dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo as idTipoSexoMov,dbo.ImagMovimientoImagenes.FechaNacimiento as FechaNacimientoMov
	FROM         dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.ImagMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.ImagMovimientoCpt.idProductoCPT, dbo.ImagMovimiento.Fecha,dbo.FuentesFinanciamiento.Descripcion
else
        if @idOrden=4
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.ImagMovimientoCPT.cantidad, dbo.ImagMovimientoCPT.precio,
	                      dbo.ImagMovimientoCPT.importe AS total,dbo.ImagMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio, dbo.FactCatalogoServicios.NombreMINSA,
                                   dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo as idTipoSexoMov,dbo.ImagMovimientoImagenes.FechaNacimiento as FechaNacimientoMov
	FROM         dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.ImagMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.ImagMovimiento.Fecha
     else
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto,
	                      dbo.ImagTipoConceptos.Concepto, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.ImagMovimientoCPT.cantidad, dbo.ImagMovimientoCPT.precio,
	                      dbo.ImagMovimientoCPT.importe AS total,dbo.ImagMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio, dbo.FactCatalogoServicios.NombreMINSA,
                                   dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo as idTipoSexoMov,dbo.ImagMovimientoImagenes.FechaNacimiento as FechaNacimientoMov
	FROM         dbo.ImagMovimientoImagenes INNER JOIN
	                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.ImagMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.ImagMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.ImagMovimientoImagenes.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.ImagTipoConceptos ON dbo.ImagMovimiento.IdTipoConcepto = dbo.ImagTipoConceptos.idTipoConcepto
	WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.ImagMovimiento.IdImagEstado=1 and  dbo.ImagMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.Servicios.idTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorFechasPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimientoImagenes
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.*, dbo.ImagMovimiento.Fecha
FROM         dbo.ImagMovimientoImagenes INNER JOIN
                      dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento
where       dbo.ImagMovimientoImagenes.IdComprobantePago = @IdComprobantePago and dbo.ImagMovimiento.IdImagEstado<>0
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorIdMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorIdMovimiento]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.*, dbo.ImagMovimiento.MovTipo, dbo.ImagMovimiento.IdTipoConcepto, dbo.ImagMovimiento.IdPuntoCarga,
                      dbo.ImagMovimiento.Fecha, dbo.ImagMovimiento.IdUsuario, dbo.ImagMovimiento.IdImagEstado, dbo.ImagEstados.Estado AS dEstado,
                      dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.NroHistoriaClinica
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente RIGHT OUTER JOIN
                      dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento ON
                      dbo.FactOrdenServicio.IdOrden = dbo.ImagMovimientoImagenes.IdOrden LEFT OUTER JOIN
                      dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado
WHERE     dbo.ImagMovimiento.idMovimiento=@idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorIdOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimientoImagenes
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesSeleccionarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.*,  dbo.ImagMovimiento.Fecha
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento ON
                      dbo.FactOrdenServicio.IdOrden = dbo.ImagMovimientoImagenes.IdOrden
WHERE     (dbo.ImagMovimiento.IdImagEstado <> 0) AND dbo.FactOrdenServicio.IdPaciente =@IdPaciente
ORDER BY dbo.ImagMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoImagenesXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMovimientoImagenesXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoImagenes.*, dbo.ImagMovimiento.IdImagEstado
FROM        dbo.ImagMovimientoImagenes INNER JOIN
                   dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento
where dbo.ImagMovimiento.IdImagEstado=1 and dbo.ImagMovimientoImagenes.IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoImagenesXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoIngresosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoIngresosAgregar]
	@IdMovimiento [int],
	@NroDocumento [varchar](20),
	@IdPersonaRecepciona [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoIngresos (
IdMovimiento,NroDocumento,IdPersonaRecepciona) values (
@IdMovimiento,@NroDocumento,@IdPersonaRecepciona)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'ImagMovimientoIngresos'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoIngresosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoIngresosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoIngresosEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimientoIngresos
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'ImagMovimientoIngresos'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoIngresosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoIngresosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoIngresosModificar]
	@IdMovimiento [int],
	@NroDocumento [varchar](20),
	@IdPersonaRecepciona [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoIngresos
set
NroDocumento = @NroDocumento,
IdPersonaRecepciona = @IdPersonaRecepciona
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'ImagMovimientoIngresos'

declare @TablaMovimiento varchar(30)
set @TablaMovimiento='ImagMovimiento/E/'+ltrim(str(@idMovimiento))
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoIngresosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoIngresosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoIngresosSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimientoIngresos
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoIngresosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoModificar]
	@IdMovimiento [int],
	@MovTipo [varchar](1),
	@IdTipoConcepto [int],
	@IdPuntoCarga [int],
	@Fecha [datetime],
	@IdUsuario [int],
	@IdImagEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimiento
set
MovTipo = @MovTipo,
IdTipoConcepto = @IdTipoConcepto,
IdPuntoCarga = @IdPuntoCarga,
Fecha = @Fecha,
IdUsuario = @IdUsuario,
IdImagEstado = @IdImagEstado
where IdMovimiento = @IdMovimiento

declare @TablaMovimiento varchar(30)
set @TablaMovimiento='ImagMovimiento/'+@movTipo+'/'+ltrim(str(@IdMovimiento))
--if @IdImagEstado=1
--   begin
--   exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
--   end
--else
--   begin
 --  exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',0,@TablaMovimiento
--   end
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoParaSip2000]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagMovimientoParaSip2000]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimiento.Fecha, dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimientoImagenes.Eo_FUM,
                   dbo.ImagMovimientoImagenes.idCuentaAtencion,dbo.ImagMovimiento.IdImagEstado
FROM         dbo.ImagMovimientoImagenes INNER JOIN
                   dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento
 WHERE not (dbo.ImagMovimientoImagenes.Eo_FUM is null) and dbo.ImagMovimiento.IdImagEstado<>0 AND dbo.ImagMovimientoImagenes.idCuentaAtencion = @IdCuentaAtencion
                 ORDER BY dbo.ImagMovimientoImagenes.Eo_FUM DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoParaSip2000] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoResultadosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoResultadosAgregar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@Resultado [varchar](3000),
	@ResultadoFecha [datetime],
	@ResultadoDNI [varchar](8),
	@EquipoRuta [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoResultados (
idMovimiento,idProductoCPT,Resultado,ResultadoFecha,ResultadoDNI,EquipoRuta) values (
@idMovimiento,@idProductoCPT,@Resultado,@ResultadoFecha,@ResultadoDNI,@EquipoRuta)
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoResultadosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoResultadosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoResultadosModificar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@Resultado [varchar](3000),
	@ResultadoFecha [datetime],
	@ResultadoDNI [varchar](8),
	@EquipoRuta [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoResultados
set
Resultado = @Resultado,
ResultadoFecha = @ResultadoFecha,
ResultadoDNI = @ResultadoDNI,
EquipoRuta = @EquipoRuta
where idMovimiento = @idMovimiento and idProductoCPT=@idProductoCPT
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoResultadosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoResultadosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoResultadosSeleccionarPorId]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
select  *  from ImagMovimientoResultados where  idMovimiento=@idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoResultadosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoResultadosSeleccionarPorIdPorCpt]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoResultadosSeleccionarPorIdPorCpt]
	@idMovimiento [int],
	@idProductoCpt [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimientoResultados
where idMovimiento = @idMovimiento and idproductoCpt=@idProductoCpt
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoResultadosSeleccionarPorIdPorCpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasAgregar]
	@IdMovimiento [int],
	@IdResponsable [int],
	@idMotivoSalida [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ImagMovimientoSalidas (
IdMovimiento,IdResponsable,idMotivoSalida) values (
@IdMovimiento,@IdResponsable,@idMotivoSalida)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'ImagMovimientoSalidas'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ImagMovimientoSalidas
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'ImagMovimientoSalidas'
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasModificar]
	@IdMovimiento [int],
	@IdResponsable [int],
	@idMotivoSalida [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagMovimientoSalidas
set
IdResponsable = @IdResponsable,
idMotivoSalida = @idMotivoSalida
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'ImagMovimientoSalidas'
declare @TablaMovimiento varchar(30)
set @TablaMovimiento='ImagMovimiento/S/'+ltrim(str(@idMovimiento))
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimientoSalidas
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasSeleccionarPorIdMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasSeleccionarPorIdMovimiento]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoSalidas.*, dbo.ImagMotivoSalidas.motivo
FROM         dbo.ImagMovimientoSalidas LEFT OUTER JOIN
                      dbo.ImagMotivoSalidas ON dbo.ImagMovimientoSalidas.IdMotivoSalida = dbo.ImagMotivoSalidas.idMotivoSalida
WHERE    dbo.ImagMovimientoSalidas.IdMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasSeleccionarPorIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSalidasSeleccionarProductosPorFechasYpuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSalidasSeleccionarProductosPorFechasYpuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimientoDetalle.*, dbo.ImagMovimientoSalidas.IdResponsable, dbo.ImagMovimientoSalidas.IdMotivoSalida,
                      dbo.ImagMovimiento.IdPuntoCarga, dbo.ImagMovimiento.Fecha, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.ImagMovimientoDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.ImagMovimientoDetalle.idProducto LEFT OUTER JOIN
                      dbo.ImagMovimientoSalidas INNER JOIN
                      dbo.ImagMovimiento ON dbo.ImagMovimientoSalidas.IdMovimiento = dbo.ImagMovimiento.IdMovimiento ON
                      dbo.ImagMovimientoDetalle.idMovimiento = dbo.ImagMovimiento.IdMovimiento
WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
                   and dbo.ImagMovimiento.movTipo='S' and dbo.ImagMovimiento.idImagEstado=1
ORDER BY  dbo.ImagMovimientoDetalle.idProducto ,dbo.ImagMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSalidasSeleccionarProductosPorFechasYpuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSeleccionarIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSeleccionarIdOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimiento.*, dbo.ImagMovimientoImagenes.IdOrden
FROM         dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoImagenes ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoImagenes.IdMovimiento
where   dbo.ImagMovimientoImagenes.IdOrden =@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSeleccionarIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@Paciente [varchar](50),
	@lnUsandoFmovimiento [int]
WITH EXECUTE AS CALLER
AS
declare @pacientefiltro varchar(50)
 select @pacientefiltro='%'+@paciente+'%'
 if @lnUsandoFmovimiento=1
	 if @Paciente=''
		SELECT     dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.IdOrden, dbo.ImagEstados.Estado,
							  dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
							  dbo.Pacientes.SegundoNombre,dbo.ImagMovimiento.IdImagEstado,dbo.ImagMovimientoImagenes.idCuentaAtencion,
							  dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo,dbo.ImagMovimientoImagenes.FechaNacimiento,
							  dbo.FactOrdenServicio.FechaHoraRealizaCpt,dbo.ImagMovimientoImagenes.idPersonaTomaImagen
		FROM         dbo.ImagMovimientoImagenes INNER JOIN
							  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
							  dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado LEFT OUTER JOIN
							  dbo.FactOrdenServicio ON dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
						   and dbo.ImagMovimiento.movTipo='S'
		ORDER BY  dbo.ImagMovimiento.Fecha DESC
	else
		SELECT     dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.IdOrden, dbo.ImagEstados.Estado,
							  dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
							  dbo.Pacientes.SegundoNombre,dbo.ImagMovimiento.IdImagEstado,dbo.ImagMovimientoImagenes.idCuentaAtencion,
							  dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo,dbo.ImagMovimientoImagenes.FechaNacimiento,
							  dbo.FactOrdenServicio.FechaHoraRealizaCpt,dbo.ImagMovimientoImagenes.idPersonaTomaImagen
		FROM         dbo.ImagMovimientoImagenes INNER JOIN
							  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
							  dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado LEFT OUTER JOIN
							  dbo.FactOrdenServicio ON dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
						   and dbo.ImagMovimiento.movTipo='S' and dbo.ImagMovimientoImagenes.Paciente  like @pacientefiltro
		ORDER BY  dbo.ImagMovimiento.Fecha DESC
else
    if @Paciente=''
		SELECT     dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.IdOrden, dbo.ImagEstados.Estado,
							  dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
							  dbo.Pacientes.SegundoNombre,dbo.ImagMovimiento.IdImagEstado,dbo.ImagMovimientoImagenes.idCuentaAtencion,
							  dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo,dbo.ImagMovimientoImagenes.FechaNacimiento,
							  dbo.FactOrdenServicio.FechaHoraRealizaCpt,dbo.ImagMovimientoImagenes.idPersonaTomaImagen
		FROM         dbo.ImagMovimientoImagenes INNER JOIN
							  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
							  dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado LEFT OUTER JOIN
							  dbo.FactOrdenServicio ON dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE      dbo.FactOrdenServicio.FechaHoraRealizaCpt  Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
						   and dbo.ImagMovimiento.movTipo='S'
		ORDER BY  dbo.FactOrdenServicio.FechaHoraRealizaCpt DESC
	else
		SELECT     dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoImagenes.IdOrden, dbo.ImagEstados.Estado,
							  dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
							  dbo.Pacientes.SegundoNombre,dbo.ImagMovimiento.IdImagEstado,dbo.ImagMovimientoImagenes.idCuentaAtencion,
							  dbo.ImagMovimientoImagenes.Paciente,dbo.ImagMovimientoImagenes.idTipoSexo,dbo.ImagMovimientoImagenes.FechaNacimiento,
							  dbo.FactOrdenServicio.FechaHoraRealizaCpt,dbo.ImagMovimientoImagenes.idPersonaTomaImagen
		FROM         dbo.ImagMovimientoImagenes INNER JOIN
							  dbo.ImagMovimiento ON dbo.ImagMovimientoImagenes.IdMovimiento = dbo.ImagMovimiento.IdMovimiento LEFT OUTER JOIN
							  dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado LEFT OUTER JOIN
							  dbo.FactOrdenServicio ON dbo.ImagMovimientoImagenes.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE      dbo.FactOrdenServicio.FechaHoraRealizaCpt Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
						   and dbo.ImagMovimiento.movTipo='S' and dbo.ImagMovimientoImagenes.Paciente  like @pacientefiltro
		ORDER BY  dbo.FactOrdenServicio.FechaHoraRealizaCpt DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaIngresos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaIngresos]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMovimientoIngresos.NroDocumento, dbo.ImagEstados.Estado,
                      dbo.ImagMovimiento.IdImagEstado
FROM         dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoIngresos ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoIngresos.IdMovimiento LEFT OUTER JOIN
                      dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado
WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
                   and dbo.ImagMovimiento.movTipo='E'
ORDER BY  dbo.ImagMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaIngresos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaSalidas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaSalidas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ImagMovimiento.IdImagEstado, dbo.ImagMovimiento.IdMovimiento, dbo.ImagMovimiento.Fecha, dbo.ImagMotivoSalidas.motivo,
                      dbo.ImagEstados.Estado
FROM         dbo.ImagMovimiento INNER JOIN
                      dbo.ImagMovimientoSalidas ON dbo.ImagMovimiento.IdMovimiento = dbo.ImagMovimientoSalidas.IdMovimiento LEFT OUTER JOIN
                      dbo.ImagMotivoSalidas ON dbo.ImagMovimientoSalidas.IdMotivoSalida = dbo.ImagMotivoSalidas.idMotivoSalida LEFT OUTER JOIN
                      dbo.ImagEstados ON dbo.ImagMovimiento.IdImagEstado = dbo.ImagEstados.IdImagEstado
WHERE      dbo.ImagMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.ImagMovimiento.idPuntoCarga=@idPuntoCarga
                   and dbo.ImagMovimiento.movTipo='S'
ORDER BY  dbo.ImagMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSeleccionarPorFechasPuntoCargaSalidas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagMovimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagMovimientoSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from ImagMovimiento
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ImagMovimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagRecojeExamenSeleccionaPorID]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagRecojeExamenSeleccionaPorID]
	@idRecojeExamen [int]
WITH EXECUTE AS CALLER
AS
select * from ImagRecojeExamen where idRecojeExamen = @idRecojeExamen
GO
ALTER AUTHORIZATION ON [dbo].[ImagRecojeExamenSeleccionaPorID] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagRecojeExamenSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ImagRecojeExamenSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from ImagRecojeExamen order by RecojeExamen
GO
ALTER AUTHORIZATION ON [dbo].[ImagRecojeExamenSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaAgregar]
	@IdSala [int] OUTPUT,
	@IdTipoModalidadSala [int],
	@Sala [varchar](50),
	@Codigo [varchar](15),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO ImagSala (
	IdTipoModalidadSala,Sala,Codigo,EsActivo,FechaCrea,FechaEdita) VALUES (
	@IdTipoModalidadSala,@Sala,@Codigo,1,GETDATE(),NULL)
	set @IdSala = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdSala,'ImagSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaEliminar]
	@IdSala [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagSalaPuntoCarga SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdSala = @IdSala;

	UPDATE ImagSala SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdSala = @IdSala
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdSala,'ImagSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaFiltrarTodos]
	@Sala [varchar](50),
	@Codigo [varchar](15)
WITH EXECUTE AS CALLER
AS
IF @Sala IS NULL
	BEGIN
		SET @Sala = '';
	END;
	IF @Codigo IS NULL
	BEGIN
		SET @Codigo = '';
	END;


	IF @Codigo != ''
	BEGIN
		SET @Codigo = @Codigo + '%';

		SELECT S.IdSala, S.Codigo, S.IdTipoModalidadSala,
			TS.TipoModalidadSala, S.Sala, S.EsActivo, S.FechaCrea, S.FechaEdita
		FROM ImagSala AS S
			INNER JOIN ImagTipoModalidadSala  AS TS ON S.IdTipoModalidadSala = TS.IdTipoModalidadSala
		WHERE S.EsActivo = 1 AND S.Codigo LIKE @Codigo
		ORDER BY S.Sala;
	END
	ELSE
	BEGIN
		SET @Sala = '%' + @Sala + '%';

		SELECT S.IdSala, S.Codigo, S.IdTipoModalidadSala,
			TS.TipoModalidadSala, S.Sala, S.EsActivo, S.FechaCrea, S.FechaEdita
		FROM ImagSala AS S
			INNER JOIN ImagTipoModalidadSala  AS TS ON S.IdTipoModalidadSala = TS.IdTipoModalidadSala
		WHERE S.EsActivo = 1 AND S.Sala LIKE @Sala
		ORDER BY S.Sala;
	END;
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaModificar]
	@IdSala [int],
	@IdTipoModalidadSala [int],
	@Sala [varchar](50),
	@Codigo [varchar](15),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ImagSala
		SET
		IdTipoModalidadSala = @IdTipoModalidadSala,
		Sala = @Sala,
		Codigo = @Codigo,
		EsActivo = 1,
		FechaEdita = GETDATE()
	WHERE IdSala = @IdSala
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdSala,'ImagSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaAgregar]
	@IdSala [int],
	@IdPuntoCarga [int],
	@EsActivo [bit],
	@FechsCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
IF NOT EXISTS(SELECT 1 FROM ImagSalaPuntoCarga WHERE IdSala = @IdSala AND IdPuntoCarga = @IdPuntoCarga)
	BEGIN
		INSERT INTO ImagSalaPuntoCarga (IdSala,
		IdPuntoCarga,EsActivo,FechsCrea,FechaEdita) values (@IdSala,
		@IdPuntoCarga, 1, GETDATE(), NULL)
	END
	ELSE
	BEGIN
		EXEC ImagSalaPuntoCargaModificar @IdSala, @IdPuntoCarga, @EsActivo,
									@FechsCrea, @FechaEdita, @IdUsuarioAuditoria;
	END;
	-- set @IdSala = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdSala,'ImagSalaPuntoCarga'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaEliminar]
	@IdSala [int],
	@IdPuntoCarga [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagSalaPuntoCarga SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdSala = @IdSala AND IdPuntoCarga = @IdPuntoCarga;
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdSala,'ImagSalaPuntoCarga'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaEliminarPorIdSala]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaEliminarPorIdSala]
	@IdSala [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagSalaPuntoCarga SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdSala = @IdSala;
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdSala,'ImagSalaPuntoCarga'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaEliminarPorIdSala] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaModificar]
	@IdSala [int],
	@IdPuntoCarga [int],
	@EsActivo [bit],
	@FechsCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagSalaPuntoCarga SET
		EsActivo = 1,
		FechaEdita = GETDATE()
	WHERE IdSala = @IdSala AND IdPuntoCarga = @IdPuntoCarga;
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdSala,'ImagSalaPuntoCarga'
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaSeleccionarPorId]
	@IdSala [int],
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagSalaPuntoCarga
	WHERE IdSala = @IdSala AND IdPuntoCarga = @IdPuntoCarga;
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaPuntoCargaSeleccionarPorIdSala]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaPuntoCargaSeleccionarPorIdSala]
	@IdSala [int]
WITH EXECUTE AS CALLER
AS
SELECT SPC.IdSala, SPC.IdPuntoCarga, RTRIM(PC.Descripcion) + ' (' + ISNULL(PC.TipoPunto, '')  + ') ' AS Descripcion, SPC.EsActivo,
		SPC.FechsCrea, SPC.FechaEdita
	FROM ImagSalaPuntoCarga AS SPC
		INNER JOIN FactPuntosCarga AS PC ON PC.IdPuntoCarga = SPC.IdPuntoCarga
	WHERE SPC.IdSala = @IdSala AND SPC.EsActivo = 1;
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaPuntoCargaSeleccionarPorIdSala] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaSeleccionarPorId]
	@IdSala [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagSala
	WHERE IdSala = @IdSala
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaSeleccionarPorTipoModalidad]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaSeleccionarPorTipoModalidad]
	@IdTipoModalidadSala [int]
WITH EXECUTE AS CALLER
AS
SELECT S.IdSala, S.Codigo, S.IdTipoModalidadSala,
		TS.TipoModalidadSala, S.Sala, S.EsActivo, S.FechaCrea, S.FechaEdita
	FROM ImagSala AS S
		INNER JOIN ImagTipoModalidadSala  AS TS ON S.IdTipoModalidadSala = TS.IdTipoModalidadSala
	WHERE S.EsActivo = 1 AND TS.TipoModalidadSala = @IdTipoModalidadSala
	ORDER BY S.Sala;
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaSeleccionarPorTipoModalidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT S.IdSala, S.Codigo, S.IdTipoModalidadSala,
		TS.TipoModalidadSala, S.Sala, S.EsActivo, S.FechaCrea, S.FechaEdita
	FROM ImagSala AS S
		INNER JOIN ImagTipoModalidadSala  AS TS ON S.IdTipoModalidadSala = TS.IdTipoModalidadSala
	WHERE S.EsActivo = 1
	ORDER BY S.Sala;
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagSalaVerificaNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagSalaVerificaNombre]
	@IdSala [int],
	@Sala [varchar](50),
	@Codigo [varchar](15)
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagSala
	WHERE IdSala != @IdSala
		AND (Sala = @Sala OR Codigo = @Codigo);
GO
ALTER AUTHORIZATION ON [dbo].[ImagSalaVerificaNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaAgregar]
	@IdTipoModalidadSala [int] OUTPUT,
	@TipoModalidadSala [varchar](50),
	@Codigo [varchar](5),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO ImagTipoModalidadSala (
	TipoModalidadSala,Codigo,EsActivo,FechaCrea,FechaEdita) values (
	@TipoModalidadSala,@Codigo,1,GETDATE(),NULL)
	set @IdTipoModalidadSala = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoModalidadSala,'ImagTipoModalidadSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaEliminar]
	@IdTipoModalidadSala [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagTipoModalidadSala SET EsActivo = 0, FechaEdita = GETDATE()
	where IdTipoModalidadSala = @IdTipoModalidadSala
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoModalidadSala,'ImagTipoModalidadSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaFiltrarTodos]
	@TipoModalidadSala [varchar](50),
	@Codigo [varchar](5)
WITH EXECUTE AS CALLER
AS
IF @TipoModalidadSala IS NULL
	BEGIN
		SET @TipoModalidadSala = '';
	END;
	IF @Codigo IS NULL
	BEGIN
		SET @Codigo = '';
	END;


	IF @Codigo != ''
	BEGIN
		SET @Codigo = @Codigo + '%';

		SELECT IdTipoModalidadSala, Codigo, TipoModalidadSala, EsActivo, FechaCrea, FechaEdita
		FROM ImagTipoModalidadSala
		WHERE EsActivo = 1 AND Codigo LIKE @Codigo
		ORDER BY TipoModalidadSala;
	END
	ELSE
	BEGIN
		SET @TipoModalidadSala = '%' + @TipoModalidadSala + '%';

		SELECT IdTipoModalidadSala, Codigo, TipoModalidadSala, EsActivo, FechaCrea, FechaEdita
		FROM ImagTipoModalidadSala
		WHERE EsActivo = 1 AND TipoModalidadSala LIKE @TipoModalidadSala
		ORDER BY TipoModalidadSala;
	END;
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaModificar]
	@IdTipoModalidadSala [int],
	@TipoModalidadSala [varchar](50),
	@Codigo [varchar](5),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ImagTipoModalidadSala
	SET
	TipoModalidadSala = @TipoModalidadSala,
	Codigo = @Codigo,
	EsActivo = 1,
	FechaEdita = GETDATE()
	WHERE IdTipoModalidadSala = @IdTipoModalidadSala
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoModalidadSala,'ImagTipoModalidadSala'
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaSeleccionarPorId]
	@IdTipoModalidadSala [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagTipoModalidadSala
	WHERE IdTipoModalidadSala = @IdTipoModalidadSala
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT IdTipoModalidadSala, Codigo, TipoModalidadSala, EsActivo, FechaCrea, FechaEdita
	FROM ImagTipoModalidadSala
	WHERE EsActivo = 1
	ORDER BY TipoModalidadSala;
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ImagTipoModalidadSalaVerificaNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ImagTipoModalidadSalaVerificaNombre]
	@IdTipoModalidadSala [int],
	@TipoModalidadSala [varchar](50),
	@Codigo [varchar](5)
WITH EXECUTE AS CALLER
AS
SELECT * FROM ImagTipoModalidadSala
	WHERE IdTipoModalidadSala != @IdTipoModalidadSala
		AND (TipoModalidadSala = @TipoModalidadSala OR Codigo = @Codigo);
GO
ALTER AUTHORIZATION ON [dbo].[ImagTipoModalidadSalaVerificaNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaAgregar]
	@IdIntegracionSistema [int] OUTPUT,
	@IdTipoSistema [int],
	@IdProveedorSistema [int],
	@NombreUsuario [varchar](35),
	@ClaveUsuario [varchar](50),
	@EsProveedorActual [bit],
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
IF  @EsProveedorActual = 1
	BEGIN
		UPDATE InteoIntegracionSistema SET EsProveedorActual = 0
		WHERE IdTipoSistema = @IdTipoSistema;
	END;

	INSERT INTO InteoIntegracionSistema (
		IdTipoSistema, IdProveedorSistema, NombreUsuario, ClaveUsuario,
			EsProveedorActual, EsActivo, FechaCrea, FechaEdita)
	VALUES (
		@IdTipoSistema, @IdProveedorSistema, @NombreUsuario, @ClaveUsuario,
		@EsProveedorActual, 1, GETDATE(), NULL )

	SET @IdIntegracionSistema = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdIntegracionSistema,'InteoIntegracionSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaEliminar]
	@IdIntegracionSistema [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE InteoIntegracionSistema SET EsActivo = 0, FechaEdita = GETDATE()
	where IdIntegracionSistema = @IdIntegracionSistema
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdIntegracionSistema,'InteoIntegracionSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaFiltrarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaFiltrarTodos]
	@IdTipoSistema [int]
WITH EXECUTE AS CALLER
AS
IF @IdTipoSistema IS NULL
	BEGIN

		SELECT INS.IdIntegracionSistema, INS.IdTipoSistema, TS.TipoSistema,
			INS.IdProveedorSistema, PS.ProveedorSistema,
			INS.NombreUsuario, INS.EsProveedorActual, INS.EsActivo, INS.FechaCrea, INS.FechaEdita
		FROM InteoIntegracionSistema AS INS
		INNER JOIN InteoProveedorSistema AS PS ON PS.IdProveedorSistema = INS.IdProveedorSistema
		INNER JOIN InteoTipoSistema AS TS ON TS.IdTipoSistema = INS.IdTipoSistema
		WHERE INS.EsActivo = 1
		ORDER BY TS.TipoSistema, PS.ProveedorSistema;
	END
	ELSE
	BEGIN
		SELECT INS.IdIntegracionSistema, INS.IdTipoSistema, TS.TipoSistema,
			INS.IdProveedorSistema, PS.ProveedorSistema,
			INS.NombreUsuario, INS.EsProveedorActual, INS.EsActivo, INS.FechaCrea, INS.FechaEdita
		FROM InteoIntegracionSistema AS INS
		INNER JOIN InteoProveedorSistema AS PS ON PS.IdProveedorSistema = INS.IdProveedorSistema
		INNER JOIN InteoTipoSistema AS TS ON TS.IdTipoSistema = INS.IdTipoSistema
		WHERE INS.EsActivo = 1 AND INS.IdTipoSistema = @IdTipoSistema
		ORDER BY TS.TipoSistema, PS.ProveedorSistema;
	END;
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaModificar]
	@IdIntegracionSistema [int],
	@IdTipoSistema [int],
	@IdProveedorSistema [int],
	@NombreUsuario [varchar](35),
	@ClaveUsuario [varchar](50),
	@EsProveedorActual [bit],
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
IF  @EsProveedorActual = 1
	BEGIN
		UPDATE InteoIntegracionSistema SET EsProveedorActual = 0
		WHERE IdTipoSistema = @IdTipoSistema;
	END;

	UPDATE InteoIntegracionSistema
		SET
		IdTipoSistema = @IdTipoSistema,
		IdProveedorSistema = @IdProveedorSistema,
		NombreUsuario = @NombreUsuario,
		ClaveUsuario = @ClaveUsuario,
		EsProveedorActual = @EsProveedorActual,
		EsActivo = 1,
		FechaEdita = GETDATE()
	WHERE IdIntegracionSistema = @IdIntegracionSistema
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdIntegracionSistema,'InteoIntegracionSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaProveedorActualPorTipo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaProveedorActualPorTipo]
	@IdTipoSistema [int]
WITH EXECUTE AS CALLER
AS
SELECT INS.IdIntegracionSistema, INS.IdTipoSistema, TS.TipoSistema,
		INS.IdProveedorSistema, PS.ProveedorSistema,
		INS.NombreUsuario, INS.EsProveedorActual, INS.EsActivo, INS.FechaCrea, INS.FechaEdita
	FROM InteoIntegracionSistema AS INS
	INNER JOIN InteoProveedorSistema AS PS ON PS.IdProveedorSistema = INS.IdProveedorSistema
	INNER JOIN InteoTipoSistema AS TS ON TS.IdTipoSistema = INS.IdTipoSistema
	WHERE INS.EsActivo = 1 AND INS.IdTipoSistema = @IdTipoSistema AND INS.EsProveedorActual = 1
	ORDER BY TS.TipoSistema, PS.ProveedorSistema;
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaProveedorActualPorTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaSeleccionarPorId]
	@IdIntegracionSistema [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoIntegracionSistema
	where IdIntegracionSistema = @IdIntegracionSistema
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoIntegracionSistemaVerifica]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoIntegracionSistemaVerifica]
	@IdIntegracionSistema [int],
	@IdTipoSistema [int],
	@IdProveedorSistema [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoIntegracionSistema
	WHERE IdIntegracionSistema != @IdIntegracionSistema
		AND IdTipoSistema = @IdTipoSistema AND IdProveedorSistema = @IdProveedorSistema;
GO
ALTER AUTHORIZATION ON [dbo].[InteoIntegracionSistemaVerifica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaAgregar]
	@IdProveedorSistema [int] OUTPUT,
	@ProveedorSistema [varchar](100),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO InteoProveedorSistema (
	ProveedorSistema,EsActivo,FechaCrea,FechaEdita) VALUES (
	@ProveedorSistema,1,GETDATE(),NULL)
	SET @IdProveedorSistema = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProveedorSistema,'InteoProveedorSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaEliminar]
	@IdProveedorSistema [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE InteoProveedorSistema SET EsActivo = 0,
		FechaEdita = GETDATE()
	WHERE IdProveedorSistema = @IdProveedorSistema
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdProveedorSistema,'InteoProveedorSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaModificar]
	@IdProveedorSistema [int],
	@ProveedorSistema [varchar](100),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE InteoProveedorSistema
	SET
	ProveedorSistema = @ProveedorSistema,
	EsActivo = 1,
	FechaEdita = GETDATE()
	WHERE IdProveedorSistema = @IdProveedorSistema
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdProveedorSistema,'InteoProveedorSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaSeleccionarPorId]
	@IdProveedorSistema [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoProveedorSistema
	WHERE IdProveedorSistema = @IdProveedorSistema
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT IdProveedorSistema, ProveedorSistema,
		EsActivo, FechaCrea, FechaEdita
	FROM InteoProveedorSistema
	WHERE EsActivo = 1
	ORDER BY ProveedorSistema;
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoProveedorSistemaVerificaNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoProveedorSistemaVerificaNombre]
	@IdProveedorSistema [int],
	@ProveedorSistema [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoProveedorSistema
	WHERE IdProveedorSistema != @IdProveedorSistema AND ProveedorSistema = @ProveedorSistema
GO
ALTER AUTHORIZATION ON [dbo].[InteoProveedorSistemaVerificaNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemaAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemaAgregar]
	@IdTipoSistema [int] OUTPUT,
	@TipoSistema [varchar](50),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO InteoTipoSistema (
	TipoSistema,EsActivo,FechaCrea,FechaEdita) values (
	@TipoSistema,1,GETDATE(),NULL)
	SET @IdTipoSistema = @@identity
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoSistema,'InteoTipoSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemaEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemaEliminar]
	@IdTipoSistema [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE InteoTipoSistema SET EsActivo = 0, FechaEdita = GETDATE()
	WHERE IdTipoSistema = @IdTipoSistema
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoSistema,'InteoTipoSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemaModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemaModificar]
	@IdTipoSistema [int],
	@TipoSistema [varchar](50),
	@EsActivo [bit],
	@FechaCrea [datetime],
	@FechaEdita [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE InteoTipoSistema
	SET TipoSistema = @TipoSistema,
	EsActivo = 1,
	FechaEdita = GETDATE()
	WHERE IdTipoSistema = @IdTipoSistema
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoSistema,'InteoTipoSistema'
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemASeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemASeleccionarPorId]
	@IdTipoSistema [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoTipoSistema
	WHERE IdTipoSistema = @IdTipoSistema
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemASeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemaSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT IdTipoSistema, TipoSistema, EsActivo, FechaCrea, FechaEdita
	FROM InteoTipoSistema
	WHERE EsActivo = 1
	ORDER BY TipoSistema;
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[InteoTipoSistemaVerificaNombre]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[InteoTipoSistemaVerificaNombre]
	@IdTipoSistema [int],
	@TipoSistema [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT * FROM InteoTipoSistema
	WHERE IdTipoSistema != @IdTipoSistema AND TipoSistema = @TipoSistema;
GO
ALTER AUTHORIZATION ON [dbo].[InteoTipoSistemaVerificaNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabActualizaEstadoFacturacion]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabActualizaEstadoFacturacion]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
UPDATE factOrdenServicio
SET idEstadoFacturacion="1"
WHERE idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabActualizaEstadoFacturacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabActualizaEstadoLaboratorio]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabActualizaEstadoLaboratorio]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
UPDATE LabMovimiento
SET idLabEstado="1"
WHERE idMovimiento=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabActualizaEstadoLaboratorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabActualizaResultados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabActualizaResultados]
	@FechaResultado [datetime],
	@IdOrden [int],
	@ResultadoAnalisis [varchar](5000),
	@ObservacionResultado [varchar](500),
	@IdUsuario [int],
	@RealizaAnalisis [int],
	@IdAnalisis [varchar](10)
WITH EXECUTE AS CALLER
AS
UPDATE labresultado
SET fecha=@FechaResultado,
idOrden=@IdOrden,
ResultadoAnalisis=@ResultadoAnalisis,
ObservacionResultado=@ObservacionResultado,
idUsuario=@IdUsuario, realizaAnalisis=@RealizaAnalisis
WHERE idAnalisis=@IdAnalisis AND idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabActualizaResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabAveriguaCodigoPrueba]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabAveriguaCodigoPrueba]
	@codigoCPT [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labPruebas
WHERE codigoCPT=@codigoCPT
GO
ALTER AUTHORIZATION ON [dbo].[LabAveriguaCodigoPrueba] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabAveriguaSiSeHanRegistradoTodosLosResultados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabAveriguaSiSeHanRegistradoTodosLosResultados]
	@IdAnalisis [varchar](20),
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labmovimientolaboratorio, labresultado
WHERE labmovimientolaboratorio.idorden=labresultado.idorden
AND labresultado.idAnalisis=@IdAnalisis
AND labmovimientolaboratorio.idmovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabAveriguaSiSeHanRegistradoTodosLosResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabConsultaIngresaResultados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabConsultaIngresaResultados]
	@IdAnalisis [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labresultado
WHERE idAnalisis=@IdAnalisis
AND idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabConsultaIngresaResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabEmpleado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabEmpleado]
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM empleados WHERE idEmpleado=@idEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[LabEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabFactCatalogoServiciosHospFiltraPorPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabFactCatalogoServiciosHospFiltraPorPuntoCarga]
	@idPuntoCarga [int],
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga
FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga=@idPuntoCarga and dbo.FactCatalogoServicios.idproducto=@Filtro
GO
ALTER AUTHORIZATION ON [dbo].[LabFactCatalogoServiciosHospFiltraPorPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabFacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabFacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga]
	@IdOrden [int],
	@idPuntoCarga [int],
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionServicioDespacho.idOrden, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                      dbo.FacturacionServicioDespacho.IdProducto, dbo.FacturacionServicioDespacho.Cantidad, dbo.FacturacionServicioDespacho.Precio,
                      dbo.FacturacionServicioDespacho.Total, dbo.LabMovimientoCPT.ResultadoAutomatico,@idPuntoCarga as idPuntoCarga
FROM         dbo.FacturacionServicioDespacho LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.LabMovimientoCPT ON dbo.FacturacionServicioDespacho.IdProducto = dbo.LabMovimientoCPT.idProductoCPT
WHERE     (dbo.LabMovimientoCPT.idMovimiento = @idMovimiento) AND (dbo.FacturacionServicioDespacho.idOrden = @IdOrden)
GO
ALTER AUTHORIZATION ON [dbo].[LabFacturacionServicioDespachoFiltraPorIdOrdenIdPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labGruposAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labGruposAgregar]
	@idGrupo [int] OUTPUT,
	@NombreGrupo [char](20),
	@SiglasGrupo [char](3),
	@idCargo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into labGrupos (
NombreGrupo,SiglasGrupo,idCargo) values (
@NombreGrupo,@SiglasGrupo,@idCargo)
set @idGrupo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idGrupo,'labGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[labGruposAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labGruposEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labGruposEliminar]
	@idGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from labGrupos
where idGrupo = @idGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idGrupo,'labGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[labGruposEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labGruposModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labGruposModificar]
	@idGrupo [int],
	@NombreGrupo [char](20),
	@SiglasGrupo [char](3),
	@idCargo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update labGrupos
set
NombreGrupo = @NombreGrupo,
SiglasGrupo = @SiglasGrupo,
idCargo = @idCargo
where idGrupo = @idGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idGrupo,'labGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[labGruposModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labGruposSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labGruposSeleccionarPorId]
	@idGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from labGrupos
where idGrupo = @idGrupo
GO
ALTER AUTHORIZATION ON [dbo].[labGruposSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabGruposSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabGruposSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from LabGrupos
GO
ALTER AUTHORIZATION ON [dbo].[LabGruposSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabImprimeResultados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabImprimeResultados]
	@IdAnalisis [int],
	@IdOrden [int],
	@ResultadoAnalisis [varchar](50),
	@ObservacionResultado [varchar](50),
	@IdUsuario [int]
WITH EXECUTE AS CALLER
AS
IF EXISTS (SELECT * FROM labresultado WHERE idAnalisis= @IdAnalisis)
	UPDATE labresultado
	SET idOrden=@IdOrden, ResultadoAnalisis=@ResultadoAnalisis, ObservacionResultado=@ObservacionResultado, idUsuario=@IdUsuario
	WHERE idAnalisis= @IdAnalisis
ELSE
	INSERT INTO labresultado (idAnalisis, idOrden, ResultadoAnalisis, ObservacionResultado, idusuario)
	VALUES (@IdAnalisis, @IdOrden,@ResultadoAnalisis,@ObservacionResultado,@IdUsuario)
GO
ALTER AUTHORIZATION ON [dbo].[LabImprimeResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabIngresaResultados]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabIngresaResultados]
	@FechaResultado [datetime],
	@IdOrden [int],
	@ResultadoAnalisis [varchar](5000),
	@ObservacionResultado [varchar](500),
	@IdUsuario [int],
	@RealizaAnalisis [int],
	@IdAnalisis [varchar](10)
WITH EXECUTE AS CALLER
AS
INSERT INTO labresultado (idAnalisis, idOrden, ResultadoAnalisis, ObservacionResultado, idusuario, realizaAnalisis,fecha)
VALUES (@IdAnalisis,@IdOrden, @ResultadoAnalisis,@ObservacionResultado,@IdUsuario,@RealizaAnalisis,@FechaResultado)
GO
ALTER AUTHORIZATION ON [dbo].[LabIngresaResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsAgregar]
	@idItem [int],
	@Item [varchar](100),
	@idProductoCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabItems (
idItem,Item,idProductoCpt) values (
@idItem,@Item,@idProductoCpt)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idItem,'LabItems'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsCptAgregar]
	@idProductoCpt [int],
	@ordenXresultado [int],
	@idGrupo [int],
	@idItemGrupo [int],
	@idItem [int],
	@ValorSiEsCombo [varchar](100),
	@ValorReferencial [varchar](100),
	@Metodo [varchar](50),
	@SoloNumero [bit],
	@SoloTexto [bit],
	@SoloCombo [bit],
	@SoloCheck [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabItemsCpt (
idProductoCpt,ordenXresultado,idGrupo,idItemGrupo,idItem,ValorSiEsCombo,ValorReferencial,Metodo,SoloNumero,SoloTexto,SoloCombo,SoloCheck) values (
@idProductoCpt,@ordenXresultado,@idGrupo,@idItemGrupo,@idItem,@ValorSiEsCombo,@ValorReferencial,@Metodo,@SoloNumero,@SoloTexto,@SoloCombo,@SoloCheck)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idProductoCpt,'LabItemsCpt'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsCptEliminar]
	@idProductoCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabItemsCpt
where idProductoCpt = @idProductoCpt
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idProductoCpt,'LabItemsCpt'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabItemsCptModificar]
	@idProductoCpt [int],
	@ordenXresultado [int],
	@idGrupo [int],
	@idItemGrupo [int],
	@idItem [int],
	@ValorSiEsCombo [varchar](100),
	@ValorReferencial [varchar](100),
	@Metodo [varchar](50),
	@SoloNumero [bit],
	@SoloTexto [bit],
	@SoloCombo [bit],
	@SoloCheck [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabItemsCpt
set
ordenXresultado = @ordenXresultado,
idGrupo = @idGrupo,
idItemGrupo = @idItemGrupo,
idItem = @idItem,
ValorSiEsCombo = @ValorSiEsCombo,
ValorReferencial = @ValorReferencial,
Metodo = @Metodo,
SoloNumero = @SoloNumero,
SoloTexto = @SoloTexto,
SoloCombo = @SoloCombo,
SoloCheck = @SoloCheck
where idProductoCpt = @idProductoCpt and ordenXresultado = @ordenXresultado
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idProductoCpt,'LabItemsCpt'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptModificarUno]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabItemsCptModificarUno]
	@idProductoCpt [int],
	@ordenXresultado [int],
	@idGrupo [int],
	@idItemGrupo [int],
	@idItem [int],
	@ValorSiEsCombo [varchar](100),
	@ValorReferencial [varchar](100),
	@Metodo [varchar](50),
	@SoloNumero [bit],
	@SoloTexto [bit],
	@SoloCombo [bit],
	@SoloCheck [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabItemsCpt
set
idGrupo = @idGrupo,
idItemGrupo = @idItemGrupo,
idItem = @idItem,
ValorSiEsCombo = @ValorSiEsCombo,
ValorReferencial = @ValorReferencial,
Metodo = @Metodo,
SoloNumero = @SoloNumero,
SoloTexto = @SoloTexto,
SoloCombo = @SoloCombo,
SoloCheck = @SoloCheck
where idProductoCpt = @idProductoCpt and ordenXresultado = @ordenXresultado
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idProductoCpt,'LabItemsCpt'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptModificarUno] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsCptSeleccionarPorId]
	@idProductoCpt [int]
WITH EXECUTE AS CALLER
AS
select * from LabItemsCpt
where idProductoCpt = @idProductoCpt
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsCptSeleccionarXfiltro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabItemsCptSeleccionarXfiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(2000);

SET @sql = 'SELECT  dbo.LabItemsCpt.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabItems.Item, dbo.LabItemsGrupos.Grupo
		 FROM         dbo.LabItemsCpt LEFT OUTER JOIN
		                    dbo.LabItemsGrupos ON dbo.LabItemsCpt.idItemGrupo = dbo.LabItemsGrupos.idItemGrupo LEFT OUTER JOIN
		                    dbo.LabItems ON dbo.LabItemsCpt.idItem = dbo.LabItems.idItem LEFT OUTER JOIN
		                    dbo.FactCatalogoServicios ON dbo.LabItemsCpt.idProductoCpt = dbo.FactCatalogoServicios.IdProducto
		 WHERE  ' +  @Filtro + 'ORDER BY dbo.LabItemsCpt.ordenXresultado'

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsCptSeleccionarXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsEliminar]
	@idItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabItems
where idItem = @idItem
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idItem,'LabItems'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsGruposAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsGruposAgregar]
	@idItemGrupo [int],
	@Grupo [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabItemsGrupos (
idItemGrupo,Grupo) values (
@idItemGrupo,@Grupo)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idItemGrupo,'LabItemsGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGruposAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsGruposEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsGruposEliminar]
	@idItemGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabItemsGrupos
where idItemGrupo = @idItemGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idItemGrupo,'LabItemsGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGruposEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsGruposModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsGruposModificar]
	@idItemGrupo [int],
	@Grupo [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabItemsGrupos
set
Grupo = @Grupo
where idItemGrupo = @idItemGrupo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idItemGrupo,'LabItemsGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGruposModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsGruposSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsGruposSeleccionarPorId]
	@idItemGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from LabItemsGrupos
where idItemGrupo = @idItemGrupo
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGruposSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsGruposSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsGruposSeleccionarTodos]
	@Filtro [varchar](200)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(2000);

SET @sql = 'SELECT  * from LabItemsGrupos ' + @Filtro+'  order by grupo'

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsGruposSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsModificar]
	@idItem [int],
	@Item [varchar](100),
	@idProductoCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabItems
set
Item = @Item,
idProductoCpt = @idProductoCpt
where idItem = @idItem
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idItem,'LabItems'
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsSeleccionarPorId]
	@idItem [int]
WITH EXECUTE AS CALLER
AS
select * from LabItems
where idItem = @idItem
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabItemsSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabItemsSeleccionarTodos]
	@Filtro [varchar](200)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(2000);

SET @sql = 'SELECT  * from LabItems' + @Filtro + '  order by item'

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabItemsSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMayor]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMayor]
	@Tabla1 [varchar](100),
	@Campo [varchar](100)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(2000);

SET @sql ='select MAX('+@Campo+') as Mayor from '+ @Tabla1

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabMayor] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMotivoSalidasSeleccionarTodos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMotivoSalidasSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from LabMotivoSalidas
order by motivo
GO
ALTER AUTHORIZATION ON [dbo].[LabMotivoSalidasSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoAgregar]
	@IdMovimiento [int] OUTPUT,
	@MovTipo [varchar](1),
	@IdTipoConcepto [int],
	@IdPuntoCarga [int],
	@Fecha [datetime],
	@IdUsuario [int],
	@IdLabEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimiento (
MovTipo,IdTipoConcepto,IdPuntoCarga,Fecha,IdUsuario,IdLabEstado) values (
@MovTipo,@IdTipoConcepto,@IdPuntoCarga,@Fecha,@IdUsuario,@IdLabEstado)
set @IdMovimiento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'LabMovimiento'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTAgregar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@cantidad [int],
	@precio [money],
	@importe [money],
	@ResultadoAutomatico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimientoCPT (
idMovimiento,idProductoCPT,cantidad,precio,importe,ResultadoAutomatico) values (
@idMovimiento,@idProductoCPT,@cantidad,@precio,@importe,@ResultadoAutomatico)
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTEliminar]
	@idMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimientoCPT
where idMovimiento = @idMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idMovimiento,'LabMovimientoCPT'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTModificar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@cantidad [int],
	@precio [money],
	@importe [money],
	@ResultadoAutomatico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimientoCPT
set
idProductoCPT = @idProductoCPT,
cantidad = @cantidad,
precio = @precio,
importe = @importe,
ResultadoAutomatico=@ResultadoAutomatico
where idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTSeleccionarPorFechas]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT labMovimientoCPT.idProductoCPT, count(labMovimientoCPT.idProductoCPT)  as cantidad
FROM labMovimiento, labMovimientoCPT
WHERE labMovimientoCPT.idMovimiento=labMovimiento.idMovimiento AND labMovimiento.fecha>=@FechaIni AND labMovimiento.fecha<=@FechaFin
GROUP BY idProductoCPT
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTSeleccionarPorId]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoCPT.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
FROM         dbo.LabMovimientoCPT LEFT OUTER JOIN
                   dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto
where       dbo.LabMovimientoCPT.idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoCPTXcuenta]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoCPTXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.IdCuentaAtencion, dbo.LabMovimiento.IdLabEstado, dbo.LabMovimientoCPT.*
FROM         dbo.LabMovimientoLaboratorio INNER JOIN
                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento INNER JOIN
                      dbo.LabMovimientoCPT ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento
WHERE     (dbo.LabMovimiento.IdLabEstado<>0)  and dbo.LabMovimientoLaboratorio.IdCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoCPTXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoDetalleAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoDetalleAgregar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@idProducto [int],
	@CantidadFallada [int],
	@Cantidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimientoDetalle (
idMovimiento,idProductoCPT,idProducto,CantidadFallada,Cantidad) values (
@idMovimiento,@idProductoCPT,@idProducto,@CantidadFallada,@Cantidad)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idMovimiento,'LabMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoDetalleEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoDetalleEliminar]
	@idMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimientoDetalle
where idMovimiento = @idMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idMovimiento,'LabMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoDetalleModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoDetalleModificar]
	@idMovimiento [int],
	@idProductoCPT [int],
	@idProducto [int],
	@CantidadFallada [int],
	@Cantidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimientoDetalle
set
idProductoCPT = @idProductoCPT,
idProducto = @idProducto,
CantidadFallada = @CantidadFallada,
Cantidad = @Cantidad
where idMovimiento = @idMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idMovimiento,'LabMovimientoDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoDetalleSeleccionarPorFechasYpuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoDetalleSeleccionarPorFechasYpuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idUsuario [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
/*
	SELECT     dbo.LabMovimientoDetalle.idProducto, dbo.LabMovimientoDetalle.Cantidad,
-- 	 	      dbo.LabMovimientoDetalle.CantidadFallada,
	                      dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.MovTipo,
	                      dbo.LabMovimiento.IdTipoConcepto, dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha
	FROM         dbo.LabTipoConceptos RIGHT OUTER JOIN
	                      dbo.LabMovimiento ON dbo.LabTipoConceptos.idTipoConcepto = dbo.LabMovimiento.IdTipoConcepto RIGHT OUTER JOIN
	                      dbo.LabMovimientoDetalle LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.LabMovimientoDetalle.idProducto = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoDetalle.idMovimiento
	WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idusuario=@idUsuario
	                   and dbo.LabMovimiento.IdLabEstado=1 AND dbo.FactCatalogoServicios.esCPT=0
	ORDER BY    dbo.LabMovimiento.Fecha
*/

SELECT     TOP 100 PERCENT dbo.LabMovimientoCPT.idProductoCPT AS idProducto, dbo.LabMovimientoCPT.cantidad, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
                      dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha
FROM         dbo.LabMovimientoCPT INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.LabMovimiento ON dbo.LabMovimientoCPT.idMovimiento = dbo.LabMovimiento.IdMovimiento LEFT OUTER JOIN
                      dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idusuario=@idUsuario
                   and dbo.LabMovimiento.IdLabEstado<>0
	ORDER BY    dbo.LabMovimiento.Fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalleSeleccionarPorFechasYpuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoDetalleSeleccionarPorId]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoDetalle.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre
FROM         dbo.LabMovimientoDetalle LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.LabMovimientoDetalle.idProducto = dbo.FactCatalogoServicios.IdProducto
where dbo.LabMovimientoDetalle.idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimiento
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'LabMovimiento'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoIngresosAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoIngresosAgregar]
	@IdMovimiento [int],
	@NroDocumento [varchar](20),
	@IdPersonaRecepciona [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimientoIngresos (
IdMovimiento,NroDocumento,IdPersonaRecepciona) values (
@IdMovimiento,@NroDocumento,@IdPersonaRecepciona)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'LabMovimientoIngresos'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoIngresosEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoIngresosEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimientoIngresos
where IdMovimiento = @IdMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'LabMovimientoIngresos'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoIngresosModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoIngresosModificar]
	@IdMovimiento [int],
	@NroDocumento [varchar](20),
	@IdPersonaRecepciona [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimientoIngresos
set
NroDocumento = @NroDocumento,
IdPersonaRecepciona = @IdPersonaRecepciona
where IdMovimiento = @IdMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'LabMovimientoIngresos'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoIngresosSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoIngresosSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimientoIngresos
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoIngresosXidMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoIngresosXidMovimiento]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdMovimiento, dbo.LabMovimientoIngresos.NroDocumento
FROM    dbo.LabMovimiento INNER JOIN
	dbo.LabMovimientoIngresos ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoIngresos.IdMovimiento
WHERE   dbo.LabMovimiento.IdMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoIngresosXidMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioAgregar]
	@IdMovimiento [int],
	@IdOrden [int],
	@CorrelativoAnual [int],
	@IdCuentaAtencion [int],
	@IdComprobantePago [int],
	@idPersonaTomaLab [int],
	@idPersonaRecoge [int],
	@idDiagnostico [int],
	@EsDiagnosticoDefinitivo [int],
	@OrdenaPrueba [varchar](50),
	@Paciente [varchar](100),
	@IdTipoSexo [int],
	@FechaNacimiento [datetime],
	@eo_fum [datetime],
	@Eo_EG [int],
	@colegiatura [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimientoLaboratorio (
IdMovimiento,IdOrden,CorrelativoAnual,IdCuentaAtencion,IdComprobantePago,idPersonaTomaLab,
idPersonaRecoge,idDiagnostico,EsDiagnosticoDefinitivo,OrdenaPrueba,Paciente,IdTipoSexo,FechaNacimiento,
eo_fum,Eo_EG,colegiatura) values (
@IdMovimiento,@IdOrden,@CorrelativoAnual,@IdCuentaAtencion,@IdComprobantePago,@idPersonaTomaLab,
@idPersonaRecoge,@idDiagnostico,@EsDiagnosticoDefinitivo,@OrdenaPrueba,@Paciente,@IdTipoSexo,@FechaNacimiento,
@eo_fum,@Eo_EG,@colegiatura)
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimientoLaboratorio
where IdMovimiento = @IdMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'LabMovimientoLaboratorio'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioModificar]
	@IdMovimiento [int],
	@IdOrden [int],
	@CorrelativoAnual [int],
	@IdCuentaAtencion [int],
	@IdComprobantePago [int],
	@idPersonaTomaLab [int],
	@idPersonaRecoge [int],
	@idDiagnostico [int],
	@EsDiagnosticoDefinitivo [int],
	@OrdenaPrueba [varchar](50),
	@Paciente [varchar](100),
	@IdTipoSexo [int],
	@FechaNacimiento [datetime],
	@eo_fum [datetime],
	@Eo_EG [int],
	@colegiatura [varchar](10),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimientoLaboratorio
set
IdOrden = @IdOrden,
CorrelativoAnual = @CorrelativoAnual,
IdCuentaAtencion = @IdCuentaAtencion,
IdComprobantePago = @IdComprobantePago,
idPersonaTomaLab = @idPersonaTomaLab,
idPersonaRecoge = @idPersonaRecoge,
idDiagnostico = @idDiagnostico,
EsDiagnosticoDefinitivo = @EsDiagnosticoDefinitivo,
OrdenaPrueba = @OrdenaPrueba,
Paciente=@Paciente,
IdTipoSexo=@IdTipoSexo,
FechaNacimiento=@FechaNacimiento,
eo_fum=@eo_fum,
Eo_EG=@Eo_EG,
colegiatura =@colegiatura
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioPORidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioPORidOrden]
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Servicios.Nombre, dbo.LabMovimiento.IdPuntoCarga, dbo.LabMovimientoLaboratorio.IdOrden, dbo.Pacientes.NroHistoriaClinica,
                      dbo.LabMovimiento.Fecha, dbo.Pacientes.FechaNacimiento, dbo.LabMovimientoLaboratorio.IdMovimiento
FROM         dbo.LabMovimientoLaboratorio INNER JOIN
                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento INNER JOIN
                      dbo.FactOrdenServicio ON dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenServicio.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio
WHERE     (dbo.LabMovimientoLaboratorio.IdOrden = @idOrden )
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioPORidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
	dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
	dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
	dbo.LabMovimientoCPT.importe AS total,dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio,
	dbo.LabMovimientoLaboratorio.Eo_EG
FROM dbo.LabMovimientoLaboratorio INNER JOIN
	dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
	dbo.LabMovimientoCPT LEFT OUTER JOIN
	dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
	dbo.CajaComprobantesPago ON
	dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	dbo.Pacientes RIGHT OUTER JOIN
	dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
WHERE dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin
	and dbo.LabMovimiento.IdLabEstado=1 and  dbo.LabMovimiento.IdTipoConcepto=3--dbo.LabMovimiento.IdTipoConcepto=3
ORDER BY dbo.LabMovimientoCpt.idProductoCPT, dbo.LabMovimiento.Fecha
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasDinamicoOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasDinamicoOrden]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime],
	@TipoOrden [int]
WITH EXECUTE AS CALLER
AS
IF (@TipoOrden > 0)
           SELECT dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
           dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
           dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
           dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
           dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
           dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
           dbo.LabMovimientoCPT.importe AS total,dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio,
           dbo.Pacientes.NroDocumento as DNI,dbo.LabMovimientoLaboratorio.Paciente
            FROM dbo.LabMovimientoLaboratorio INNER JOIN
           dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
           dbo.LabMovimientoCPT LEFT OUTER JOIN
           dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
           dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
           dbo.CajaComprobantesPago ON
           dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
           dbo.Pacientes RIGHT OUTER JOIN
           dbo.FuentesFinanciamiento RIGHT OUTER JOIN
           dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
           dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
           dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
           dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
           dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
            WHERE dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin
           and dbo.LabMovimiento.IdLabEstado<>0 and   dbo.LabMovimiento.IdTipoConcepto=3
           ORDER BY dbo.LabMovimientoCpt.idProductoCPT,dbo.LabMovimiento.Fecha
ELSE
           SELECT dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
           dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
           dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
           dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
           dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
           dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
           dbo.LabMovimientoCPT.importe AS total,dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio,
           dbo.Pacientes.NroDocumento as DNI,dbo.LabMovimientoLaboratorio.Paciente
            FROM dbo.LabMovimientoLaboratorio INNER JOIN
           dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
           dbo.LabMovimientoCPT LEFT OUTER JOIN
           dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
           dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
           dbo.CajaComprobantesPago ON
           dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
           dbo.Pacientes RIGHT OUTER JOIN
           dbo.FuentesFinanciamiento RIGHT OUTER JOIN
           dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
           dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
           dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
           dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
           dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
            WHERE dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin
           and dbo.LabMovimiento.IdLabEstado<>0 and   dbo.LabMovimiento.IdTipoConcepto=3
           ORDER BY dbo.LabMovimiento.Fecha,dbo.LabMovimientoLaboratorio.Paciente
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasDinamicoOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasPuntoCarga]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasPuntoCarga]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int],
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
if @idOrden=3
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
	                      dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
	                      dbo.LabMovimientoCPT.importe AS total,dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio
	FROM         dbo.LabMovimientoLaboratorio INNER JOIN
	                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.LabMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
	WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.LabMovimiento.IdLabEstado=1 and  dbo.LabMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.LabMovimientoCpt.idProductoCPT, dbo.LabMovimiento.Fecha
else
        if @idOrden=4
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
	                      dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
	                      dbo.LabMovimientoCPT.importe AS total, dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio
	FROM         dbo.LabMovimientoLaboratorio INNER JOIN
	                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.LabMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
	WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.LabMovimiento.IdLabEstado=1 and  dbo.LabMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.LabMovimiento.Fecha
     else
	SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
	                      dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
	                      dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
	                      dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
	                      dbo.LabMovimientoCPT.importe AS total, dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio
	FROM         dbo.LabMovimientoLaboratorio INNER JOIN
	                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
	                      dbo.LabMovimientoCPT LEFT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
	                      dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
	                      dbo.CajaComprobantesPago ON
	                      dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FuentesFinanciamiento RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
	                      dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
	                      dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
	WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idPuntoCarga=@idPuntoCarga
	                   and dbo.LabMovimiento.IdLabEstado=1 and  dbo.LabMovimiento.IdTipoConcepto=3
	ORDER BY   dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.Servicios.idTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasRecalculo]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasRecalculo]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto,
            dbo.LabTipoConceptos.Concepto, dbo.LabMovimiento.Fecha, dbo.LabMovimientoLaboratorio.*, dbo.FactOrdenServicio.IdPaciente,
            dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
            dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Servicios.Nombre AS dServicio, dbo.CajaComprobantesPago.NroSerie,
            dbo.CajaComprobantesPago.NroDocumento, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idFuenteFinanciamiento,
            dbo.FuentesFinanciamiento.Descripcion AS nombrePlan, dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio,
            dbo.LabMovimientoCPT.importe AS total,dbo.LabMovimientoCPT.idProductoCPT, dbo.Servicios.idTipoServicio
 FROM dbo.LabMovimientoLaboratorio INNER JOIN
            dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
            dbo.LabMovimientoCPT LEFT OUTER JOIN
            dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto ON
            dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento LEFT OUTER JOIN
            dbo.CajaComprobantesPago ON
            dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
            dbo.Pacientes RIGHT OUTER JOIN
            dbo.FuentesFinanciamiento RIGHT OUTER JOIN
            dbo.FactOrdenServicio ON dbo.FuentesFinanciamiento.IdFuenteFinanciamiento = dbo.FactOrdenServicio.idFuenteFinanciamiento LEFT OUTER JOIN
            dbo.Servicios ON dbo.FactOrdenServicio.IdServicioPaciente = dbo.Servicios.IdServicio ON
            dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
            dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden LEFT OUTER JOIN
            dbo.LabTipoConceptos ON dbo.LabMovimiento.IdTipoConcepto = dbo.LabTipoConceptos.idTipoConcepto
 WHERE dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin
            and dbo.LabMovimiento.IdLabEstado<>0 and   dbo.LabMovimiento.IdTipoConcepto=3
 ORDER BY dbo.LabMovimientoCpt.idProductoCPT, dbo.LabMovimiento.Fecha
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasRecalculo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConCuentasPagantes]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConCuentasPagantes]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.LabMovimiento.IdLabEstado, dbo.LabMovimiento.Fecha, dbo.LabMovimiento.IdTipoConcepto, dbo.FactCatalogoServicios.Codigo,
       dbo.FactCatalogoServicios.Nombre, dbo.LabMovimientoLaboratorio.IdOrden, dbo.LabMovimientoLaboratorio.IdCuentaAtencion,
       dbo.LabMovimientoLaboratorio.IdComprobantePago, dbo.Atenciones.IdFormaPago, dbo.Atenciones.idFuenteFinanciamiento,
       dbo.TiposFinanciamiento.Descripcion AS dTipoFinanciamiento, dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento,
       dbo.Atenciones.idEstadoAtencion, dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad,
       dbo.FacturacionServicioPagos.Precio, dbo.FacturacionServicioPagos.Total, dbo.FactOrdenServicioPagos.IdEstadoFacturacion,
       dbo.FactOrdenServicioPagos.ImporteExonerado,dbo.LabMovimientoLaboratorio.Eo_EG
FROM   dbo.TiposFinanciamiento RIGHT OUTER JOIN
       dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago LEFT OUTER JOIN
       dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento RIGHT OUTER JOIN
       dbo.FactCatalogoServicios INNER JOIN
       dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
       dbo.LabMovimiento INNER JOIN
       dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento INNER JOIN
       dbo.FactOrdenServicioPagos ON dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicioPagos.idOrden ON
       dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
       dbo.Atenciones.IdCuentaAtencion = dbo.LabMovimientoLaboratorio.IdCuentaAtencion
Where (dbo.LabMovimientoLaboratorio.IdComprobantePago Is Null) And (dbo.LabMovimiento.IdLabEstado <> 0) And (dbo.Atenciones.idEstadoAtencion <> 0)
AND (dbo.Atenciones.IdFormaPago = 1) AND (dbo.FactOrdenServicioPagos.IdEstadoFacturacion <> 9)
and (dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin)
Order by  dbo.LabMovimientoLaboratorio.IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConCuentasPagantes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConSeguro]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConSeguro]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.LabMovimiento.IdLabEstado, dbo.LabMovimiento.Fecha, dbo.LabMovimiento.IdTipoConcepto, dbo.LabMovimientoLaboratorio.IdOrden,
       dbo.LabMovimientoLaboratorio.IdCuentaAtencion, dbo.LabMovimientoLaboratorio.IdComprobantePago, dbo.Atenciones.IdFormaPago,
       dbo.Atenciones.idFuenteFinanciamiento, dbo.TiposFinanciamiento.Descripcion AS dTipoFinanciamiento,
       dbo.FuentesFinanciamiento.Descripcion AS dFuenteFinanciamiento, dbo.Atenciones.idEstadoAtencion,
       dbo.LabMovimientoLaboratorio.Eo_EG
FROM   dbo.LabMovimiento INNER JOIN
       dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento LEFT OUTER JOIN
       dbo.TiposFinanciamiento RIGHT OUTER JOIN
       dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago LEFT OUTER JOIN
       dbo.FuentesFinanciamiento ON dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento ON
       dbo.LabMovimientoLaboratorio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
Where (dbo.LabMovimientoLaboratorio.IdComprobantePago Is Null) And (dbo.LabMovimiento.IdLabEstado <> 0) And (dbo.Atenciones.idEstadoAtencion <> 0)
       AND (dbo.Atenciones.IdFormaPago <> 1)
       and    (dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin)
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloConSeguro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloExternosConBoletas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloExternosConBoletas]
	@FechaEgresoIni [datetime],
	@FechaEgresoFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdLabEstado, dbo.LabMovimiento.Fecha, dbo.LabMovimiento.IdTipoConcepto,
                                  dbo.LabMovimientoCPT.idProductoCPT, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                  dbo.LabMovimientoLaboratorio.IdOrden , dbo.LabMovimientoLaboratorio.IdCuentaAtencion, dbo.LabMovimientoLaboratorio.IdComprobantePago,
            dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoCPT.precio, dbo.LabMovimientoCPT.importe,dbo.LabMovimientoLaboratorio.Eo_EG
FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                  dbo.LabMovimientoCPT ON dbo.FactCatalogoServicios.IdProducto = dbo.LabMovimientoCPT.idProductoCPT LEFT OUTER JOIN
                                  dbo.LabMovimiento INNER JOIN
                                  dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento ON
                                  dbo.LabMovimientoCPT.IdMovimiento = dbo.LabMovimiento.IdMovimiento
WHERE  (NOT (dbo.LabMovimientoLaboratorio.IdComprobantePago IS NULL)) And (dbo.LabMovimiento.IdLabEstado <> 0)
                and    (dbo.LabMovimiento.Fecha Between @FechaEgresoIni and @FechaEgresoFin)
ORDER BY dbo.LabMovimientoCPT.idProductoCPT
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorFechasSoloExternosConBoletas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimientoLaboratorio
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.*, dbo.LabMovimiento.Fecha
FROM         dbo.LabMovimientoLaboratorio INNER JOIN
                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento
where       dbo.LabMovimientoLaboratorio.IdComprobantePago = @IdComprobantePago and dbo.LabMovimiento.IdLabEstado<>0
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorIdMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorIdMovimiento]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.*, dbo.LabMovimiento.MovTipo, dbo.LabMovimiento.IdTipoConcepto, dbo.LabMovimiento.IdPuntoCarga,
                      dbo.LabMovimiento.Fecha, dbo.LabMovimiento.IdUsuario, dbo.LabMovimiento.IdLabEstado, dbo.LabEstados.Estado AS dEstado,
                      dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.idFuenteFinanciamiento, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.NroHistoriaClinica
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente RIGHT OUTER JOIN
                      dbo.LabMovimiento INNER JOIN
                      dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento ON
                      dbo.FactOrdenServicio.IdOrden = dbo.LabMovimientoLaboratorio.IdOrden LEFT OUTER JOIN
                      dbo.LabEstados ON dbo.LabMovimiento.IdLabEstado = dbo.LabEstados.IdLabEstado
WHERE     dbo.LabMovimiento.idMovimiento=@idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorIdOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorIdOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimientoLaboratorio
where IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.*,  dbo.LabMovimiento.Fecha
FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                      dbo.LabMovimiento INNER JOIN
                      dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento ON
                      dbo.FactOrdenServicio.IdOrden = dbo.LabMovimientoLaboratorio.IdOrden
where dbo.FactOrdenServicio.IdPaciente  = @IdPaciente  and  dbo.LabMovimiento.IdLabEstado <>0
ORDER BY dbo.LabMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioSeleccionarXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioSeleccionarXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimientoLaboratorio where idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioSeleccionarXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioXfechas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioXfechas]
	@IdProducto [int],
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoCPT.cantidad, dbo.LabMovimientoLaboratorio.IdOrden
FROM         dbo.LabMovimientoLaboratorio INNER JOIN
                      dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento RIGHT OUTER JOIN
                      dbo.LabMovimientoCPT ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoCPT.idMovimiento
WHERE     (dbo.LabMovimiento.IdLabEstado <> '0') AND (dbo.LabMovimientoCPT.idProductoCPT = @IdProducto )
          AND LabMovimiento.fecha>=@FechaInicial AND LabMovimiento.fecha<=@FechaFinal
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoLaboratorioXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoLaboratorioXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.LabMovimientoLaboratorio.*, dbo.LabMovimiento.IdLabEstado
FROM      dbo.LabMovimientoLaboratorio INNER JOIN
                dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento
WHERE  dbo.LabMovimiento.IdLabEstado>0 and dbo.LabMovimientoLaboratorio.IdOrden = @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoLaboratorioXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoModificar]
	@IdMovimiento [int],
	@MovTipo [varchar](1),
	@IdTipoConcepto [int],
	@IdPuntoCarga [int],
	@Fecha [datetime],
	@IdUsuario [int],
	@IdLabEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimiento
set
MovTipo = @MovTipo,
IdTipoConcepto = @IdTipoConcepto,
IdPuntoCarga = @IdPuntoCarga,
Fecha = @Fecha,
IdUsuario = @IdUsuario,
IdLabEstado = @IdLabEstado
where IdMovimiento = @IdMovimiento

declare @TablaMovimiento varchar(30)
set @TablaMovimiento='LabMovimiento/'+@movTipo+'/'+ltrim(str(@IdMovimiento))
--if @IdLabEstado=1
--   begin
--   exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',0,@TablaMovimiento
--   end
--else
--   begin
--   exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',0,@TablaMovimiento
--   end
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSalidasAgregar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSalidasAgregar]
	@IdMovimiento [int],
	@IdResponsable [int],
	@IdMotivoSalida [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabMovimientoSalidas (
IdMovimiento,IdResponsable,IdMotivoSalida) values (
@IdMovimiento,@IdResponsable,@IdMotivoSalida)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'LabMovimientoSalidas'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSalidasEliminar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSalidasEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabMovimientoSalidas
where IdMovimiento = @IdMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'LabMovimientoSalidas'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSalidasModificar]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSalidasModificar]
	@IdMovimiento [int],
	@IdResponsable [int],
	@IdMotivoSalida [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabMovimientoSalidas
set
IdResponsable = @IdResponsable,
IdMotivoSalida = @IdMotivoSalida
where IdMovimiento = @IdMovimiento
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'LabMovimientoSalidas'
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSalidasSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSalidasSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimientoSalidas
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSalidasXidMovimiento]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoSalidasXidMovimiento]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdMovimiento, dbo.LabMovimientoSalidas.IdMotivoSalida, dbo.LabMotivoSalidas.motivo
FROM         dbo.LabMovimiento INNER JOIN
dbo.LabMovimientoSalidas ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoSalidas.IdMovimiento LEFT OUTER JOIN
dbo.LabMotivoSalidas ON dbo.LabMovimientoSalidas.IdMotivoSalida = dbo.LabMotivoSalidas.idMotivoSalida
WHERE   dbo.LabMovimiento.IdMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSalidasXidMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaIngresos]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaIngresos]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.Fecha, dbo.LabMovimientoIngresos.NroDocumento, dbo.LabEstados.Estado,
                      dbo.LabMovimiento.IdLabEstado
FROM         dbo.LabMovimiento INNER JOIN
                      dbo.LabMovimientoIngresos ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoIngresos.IdMovimiento LEFT OUTER JOIN
                      dbo.LabEstados ON dbo.LabMovimiento.IdLabEstado = dbo.LabEstados.IdLabEstado
WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idPuntoCarga=@idPuntoCarga
                   and dbo.LabMovimiento.movTipo='E'
ORDER BY  dbo.LabMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaIngresos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaSalidas]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaSalidas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdLabEstado, dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.Fecha, dbo.LabMotivoSalidas.motivo,
                      dbo.LabEstados.Estado
FROM         dbo.LabMovimiento INNER JOIN
                      dbo.LabMovimientoSalidas ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoSalidas.IdMovimiento LEFT OUTER JOIN
                      dbo.LabMotivoSalidas ON dbo.LabMovimientoSalidas.IdMotivoSalida = dbo.LabMotivoSalidas.idMotivoSalida LEFT OUTER JOIN
                      dbo.LabEstados ON dbo.LabMovimiento.IdLabEstado = dbo.LabEstados.IdLabEstado
WHERE      dbo.LabMovimiento.Fecha Between @FechaInicio and @FechaFin AND dbo.LabMovimiento.idPuntoCarga=@idPuntoCarga
                   and dbo.LabMovimiento.movTipo='S'
ORDER BY  dbo.LabMovimiento.Fecha DESC
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSeleccionarPorFechasPuntoCargaSalidas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabMovimientoSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from LabMovimiento
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabMovimientoSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabMovimientoSeleccionarXidentificador]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimiento.IdMovimiento, dbo.LabMovimientoLaboratorio.IdCuentaAtencion, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno,
                                   dbo.Pacientes.PrimerNombre , dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.SegundoNombre
                      FROM         dbo.Atenciones RIGHT OUTER JOIN
                                    dbo.LabMovimiento INNER JOIN
                                   dbo.LabMovimientoLaboratorio ON dbo.LabMovimiento.IdMovimiento = dbo.LabMovimientoLaboratorio.IdMovimiento ON
                                   dbo.Atenciones.IdCuentaAtencion = dbo.LabMovimientoLaboratorio.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
                                   where   dbo.LabMovimiento.IdMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabMovimientoSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LaboratorioDevuelveAlertaDeCantidades]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LaboratorioDevuelveAlertaDeCantidades]
WITH EXECUTE AS CALLER
AS
SELECT TOP 40 dbo.LabMovimiento.IdMovimiento, dbo.LabMovimiento.Fecha,
              dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.LabMovimientoCPT.cantidad
FROM          dbo.LabMovimientoCPT INNER JOIN
              dbo.LabMovimiento ON dbo.LabMovimientoCPT.idMovimiento = dbo.LabMovimiento.IdMovimiento LEFT OUTER JOIN
              dbo.FactCatalogoServicios ON dbo.LabMovimientoCPT.idProductoCPT = dbo.FactCatalogoServicios.IdProducto
ORDER BY dbo.LabMovimientoCPT.cantidad DESC
GO
ALTER AUTHORIZATION ON [dbo].[LaboratorioDevuelveAlertaDeCantidades] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LaboratorioPruebasPorEmpleado]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LaboratorioPruebasPorEmpleado]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactCatalogoServicios.idproducto,dbo.FactCatalogoServicios.codigo, dbo.FactCatalogoServicios.nombre, count(dbo.FactCatalogoServicios.codigo) as Cantidad
FROM dbo.labMovimiento, dbo.LabResultado, dbo.LabMovimientoLaboratorio, dbo.FactCatalogoServicios
WHERE dbo.labMovimiento.idLabEstado<>0
AND dbo.FactCatalogoServicios.codigo=dbo.LabResultado.idAnalisis
AND dbo.labMovimiento.idMovimiento=dbo.LabMovimientoLaboratorio.idMovimiento
AND dbo.LabMovimientoLaboratorio.idOrden=dbo.LabResultado.idOrden
AND dbo.LabResultado.RealizaAnalisis=@idEmpleado
AND dbo.labMovimiento.fecha>=@FechaInicio AND dbo.labMovimiento.fecha<=@FechaFin
GROUP BY dbo.FactCatalogoServicios.idproducto,dbo.FactCatalogoServicios.codigo, dbo.FactCatalogoServicios.nombre
ORDER BY dbo.FactCatalogoServicios.nombre
GO
ALTER AUTHORIZATION ON [dbo].[LaboratorioPruebasPorEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LaboratorioSeleccionarRol]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LaboratorioSeleccionarRol]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM dbo.Roles, dbo.UsuariosRoles
WHERE (dbo.Roles.idRol=69 OR dbo.Roles.idRol=70) AND dbo.UsuariosRoles.idRol=dbo.Roles.idRol AND dbo.UsuariosRoles.idEmpleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[LaboratorioSeleccionarRol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LaboratorioXidOrden]    Script Date: 12/01/2026 02:48:08 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LaboratorioXidOrden]
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabMovimientoLaboratorio.IdOrden, dbo.LabMovimiento.Fecha, LTRIM(dbo.Empleados.ApellidoPaterno)
                                              + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS especialista,
                                             dbo.LabMovimientoLaboratorio.idMovimiento
                         FROM         dbo.LabMovimientoLaboratorio INNER JOIN
                                              dbo.LabMovimiento ON dbo.LabMovimientoLaboratorio.IdMovimiento = dbo.LabMovimiento.IdMovimiento LEFT OUTER JOIN
                                              dbo.Empleados ON dbo.LabMovimientoLaboratorio.idPersonaTomaLab = dbo.Empleados.IdEmpleado
                         WHERE dbo.LabMovimientoLaboratorio.IdOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LaboratorioXidOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LaboratorioYaRegistroPrueba]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LaboratorioYaRegistroPrueba]
	@idCuentaAtencion [int],
	@fechaDespacho [datetime],
	@idProductoCPT [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactCatalogoServicios.nombre, dbo.factOrdenServicio.fechaDespacho
FROM dbo.labMovimientoLaboratorio, dbo.LabMovimientoCPT, dbo.FactCatalogoServicios, dbo.factOrdenServicio
WHERE dbo.FactCatalogoServicios.idProducto=dbo.LabMovimientoCPT.idProductoCPT AND dbo.LabMovimientoCPT.idMovimiento=dbo.labMovimientoLaboratorio.idMovimiento AND dbo.LabMovimientoLaboratorio.idOrden=dbo.factOrdenServicio.idOrden AND dbo.factOrdenServicio.idEstadoFacturacion<>9 AND dbo.labMovimientoLaboratorio.idCuentaAtencion=@idCuentaAtencion AND dbo.LabMovimientoCPT.idProductoCPT=@idProductoCPT AND dbo.factOrdenServicio.fechaDespacho>=@fechaDespacho
GO
ALTER AUTHORIZATION ON [dbo].[LaboratorioYaRegistroPrueba] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabOrdenConResultados]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabOrdenConResultados]
	@IdAnalisis [varchar](20),
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labmovimientolaboratorio, labresultado
WHERE labmovimientolaboratorio.idorden=labresultado.idorden
AND labresultado.idAnalisis=@IdAnalisis
AND labmovimientolaboratorio.idmovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[LabOrdenConResultados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labPruebasAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labPruebasAgregar]
	@idPrueba [int] OUTPUT,
	@CodigoPrueba [char](6),
	@CodigoCPT [char](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into labPruebas (
CodigoPrueba,CodigoCPT) values (
@CodigoPrueba,@CodigoCPT)
set @idPrueba = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPrueba,'labPruebas'
GO
ALTER AUTHORIZATION ON [dbo].[labPruebasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labPruebasEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labPruebasEliminar]
	@idPrueba [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from labPruebas
where idPrueba = @idPrueba
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPrueba,'labPruebas'
GO
ALTER AUTHORIZATION ON [dbo].[labPruebasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labPruebasModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labPruebasModificar]
	@idPrueba [int],
	@CodigoPrueba [char](6),
	@CodigoCPT [char](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update labPruebas
set
CodigoPrueba = @CodigoPrueba,
CodigoCPT = @CodigoCPT
where idPrueba = @idPrueba
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPrueba,'labPruebas'
GO
ALTER AUTHORIZATION ON [dbo].[labPruebasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabPruebasSeleccionarPorCpt]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabPruebasSeleccionarPorCpt]
	@cpt [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.labPruebas.*, dbo.labGrupos.NombreGrupo AS dGrupoNombre, dbo.labGrupos.SiglasGrupo AS dgrupoSigla
FROM         dbo.labPruebas INNER JOIN
                      dbo.labGrupos ON LEFT(dbo.labPruebas.CodigoPrueba, 3) = dbo.labGrupos.SiglasGrupo
WHERE dbo.labPruebas.codigoCpt=@cpt
GO
ALTER AUTHORIZATION ON [dbo].[LabPruebasSeleccionarPorCpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labPruebasSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labPruebasSeleccionarPorId]
	@idPrueba [int]
WITH EXECUTE AS CALLER
AS
select * from labPruebas
where idPrueba = @idPrueba
GO
ALTER AUTHORIZATION ON [dbo].[labPruebasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenAgregar]
	@idRecojeExamen [int],
	@RecojeExamen [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabRecojeExamen (
idRecojeExamen,RecojeExamen) values (
@idRecojeExamen,@RecojeExamen)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idRecojeExamen,'LabRecojeExamen'
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenEliminar]
	@idRecojeExamen [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabRecojeExamen
where idRecojeExamen = @idRecojeExamen
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idRecojeExamen,'LabRecojeExamen'
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenModificar]
	@idRecojeExamen [int],
	@RecojeExamen [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabRecojeExamen
set
RecojeExamen = @RecojeExamen
where idRecojeExamen = @idRecojeExamen
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idRecojeExamen,'LabRecojeExamen'
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenSeleccionaPorID]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenSeleccionaPorID]
	@IdRecojeExamen [int]
WITH EXECUTE AS CALLER
AS
select * from LabRecojeExamen
where idRecojeExamen= @IdRecojeExamen
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenSeleccionaPorID] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenSeleccionarPorId]
	@idRecojeExamen [int]
WITH EXECUTE AS CALLER
AS
select * from LabRecojeExamen
where idRecojeExamen = @idRecojeExamen
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecojeExamenSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabRecojeExamenSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from LabRecojeExamen
order by RecojeExamen
GO
ALTER AUTHORIZATION ON [dbo].[LabRecojeExamenSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecuperaResultados_Obs]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabRecuperaResultados_Obs]
	@IdAnalisis [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM labresultado WHERE idAnalisis= @IdAnalisis AND idorden= @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabRecuperaResultados_Obs] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecuperaResultados_ReaP]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabRecuperaResultados_ReaP]
	@IdAnalisis [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM labresultado WHERE idAnalisis= @IdAnalisis AND idorden= @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabRecuperaResultados_ReaP] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabRecuperaResultados_Res]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabRecuperaResultados_Res]
	@IdAnalisis [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM labresultado WHERE idAnalisis= @IdAnalisis AND idorden= @IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabRecuperaResultados_Res] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadoAgregar]
	@idAnalisis [int],
	@idOrden [int],
	@resultadoAnalisis [text],
	@observacionResultado [text],
	@idUsuario [int],
	@fecha [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into LabResultado (
idAnalisis,idOrden,resultadoAnalisis,observacionResultado,idUsuario,fecha) values (
@idAnalisis,@idOrden,@resultadoAnalisis,@observacionResultado,@idUsuario,@fecha)
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idAnalisis,'LabResultado'
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadoEliminar]
	@idAnalisis [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from LabResultado
where idAnalisis = @idAnalisis
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idAnalisis,'LabResultado'
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labResultadoItemsXfechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labResultadoItemsXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT
                      dbo.LabResultadoPorItems.idOrden + dbo.LabResultadoPorItems.idProductoCpt AS llave, dbo.LabResultadoPorItems.idOrden,
                      dbo.FactCatalogoServicios.Codigo AS cpt, dbo.LabResultadoPorItems.Fecha, dbo.LabMovimientoLaboratorio.Paciente,
                      dbo.Servicios.Nombre AS servicio, dbo.TiposServicio.Descripcion AS tservicio, dbo.LabMovimientoLaboratorio.IdComprobantePago,
                      dbo.FactCatalogoServicios.Nombre AS cptDescripcion, dbo.FactCatalogoServicios.IdProducto, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.LabMovimientoLaboratorio.Eo_EG,
                      dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS Responsable
FROM         dbo.Servicios LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicio INNER JOIN
                      dbo.LabMovimientoLaboratorio ON dbo.FactOrdenServicio.IdOrden = dbo.LabMovimientoLaboratorio.IdOrden INNER JOIN
                      dbo.LabResultadoPorItems ON dbo.LabMovimientoLaboratorio.IdOrden = dbo.LabResultadoPorItems.idOrden ON
                      dbo.Servicios.IdServicio = dbo.FactOrdenServicio.IdServicioPaciente LEFT OUTER JOIN
                      dbo.Empleados ON dbo.LabResultadoPorItems.realizaAnalisis = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON
                      dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.LabResultadoPorItems.idProductoCpt = dbo.FactCatalogoServicios.IdProducto
WHERE  dbo.LabResultadoPorItems.fecha  Between @FechaInicio and @FechaFin
GO
ALTER AUTHORIZATION ON [dbo].[labResultadoItemsXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadoModificar]
	@idAnalisis [int],
	@idOrden [int],
	@resultadoAnalisis [text],
	@observacionResultado [text],
	@idUsuario [int],
	@fecha [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update LabResultado
set
idOrden = @idOrden,
resultadoAnalisis = @resultadoAnalisis,
observacionResultado = @observacionResultado,
idUsuario = @idUsuario,
fecha=@fecha
where idAnalisis = @idAnalisis
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idAnalisis,'LabResultado'
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoParaSip200]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadoParaSip200]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     LabResultado.*, FactOrdenServicio.IdCuentaAtencion, LabMovimiento.IdLabEstado, LabMovimientoLaboratorio.IdOrden
FROM        LabMovimiento INNER JOIN
                   LabMovimientoLaboratorio ON LabMovimiento.IdMovimiento = LabMovimientoLaboratorio.IdMovimiento LEFT OUTER JOIN
                   LabResultado INNER JOIN
                   FactOrdenServicio ON LabResultado.idOrden = FactOrdenServicio.IdOrden ON LabMovimientoLaboratorio.IdOrden = FactOrdenServicio.IdOrden
WHERE LabMovimiento.idLabEstado<>0 and FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoParaSip200] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoPorItemsSeleccionarPorPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadoPorItemsSeleccionarPorPaciente]
	@idPaciente [int],
	@idItem [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabResultadoPorItems.idProductoCpt, dbo.LabResultadoPorItems.ordenXresultado, dbo.LabResultadoPorItems.ValorNumero,
                      dbo.LabResultadoPorItems.ValorTexto, dbo.LabResultadoPorItems.ValorCombo, dbo.LabResultadoPorItems.ValorCheck, dbo.LabItemsCpt.idItem,
                      dbo.LabResultadoPorItems.Fecha, dbo.LabResultadoPorItems.idOrden, dbo.LabMovimientoLaboratorio.IdCuentaAtencion,
                      dbo.Atenciones.IdPaciente
FROM         dbo.LabResultadoPorItems INNER JOIN
                      dbo.LabItemsCpt ON dbo.LabResultadoPorItems.idProductoCpt = dbo.LabItemsCpt.idProductoCpt AND
                      dbo.LabResultadoPorItems.ordenXresultado = dbo.LabItemsCpt.ordenXresultado INNER JOIN
                      dbo.LabMovimientoLaboratorio ON dbo.LabResultadoPorItems.idOrden = dbo.LabMovimientoLaboratorio.IdOrden LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.LabMovimientoLaboratorio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE     dbo.LabItemsCpt.idItem = @idItem and dbo.Atenciones.IdPaciente=@idPaciente
ORDER BY dbo.LabResultadoPorItems.Fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoPorItemsSeleccionarPorPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoPorItemsXidOrdenXitem]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadoPorItemsXidOrdenXitem]
	@idOrden [int],
	@idItem [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.LabResultadoPorItems.idProductoCpt, dbo.LabResultadoPorItems.ordenXresultado, dbo.LabResultadoPorItems.ValorNumero,
                      dbo.LabResultadoPorItems.ValorTexto, dbo.LabResultadoPorItems.ValorCombo, dbo.LabResultadoPorItems.ValorCheck, dbo.LabItemsCpt.idItem,
                      dbo.LabResultadoPorItems.Fecha, dbo.LabResultadoPorItems.idOrden
FROM         dbo.LabResultadoPorItems INNER JOIN
                      dbo.LabItemsCpt ON dbo.LabResultadoPorItems.idProductoCpt = dbo.LabItemsCpt.idProductoCpt AND
                      dbo.LabResultadoPorItems.ordenXresultado = dbo.LabItemsCpt.ordenXresultado
WHERE     dbo.LabItemsCpt.idItem = @idItem and dbo.LabResultadoPorItems.idOrden=@idOrden
ORDER BY dbo.LabResultadoPorItems.Fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoPorItemsXidOrdenXitem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadoSeleccionarPorId]
	@idAnalisis [int]
WITH EXECUTE AS CALLER
AS
select * from LabResultado
where idAnalisis = @idAnalisis
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadoSeleccionarPorIdporCpt]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadoSeleccionarPorIdporCpt]
	@CodigoCpt [varchar](20),
	@idOrden [int]
WITH EXECUTE AS CALLER
AS
select * from LabResultado
where idAnalisis = @CodigoCpt and idOrden =@idOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadoSeleccionarPorIdporCpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadosEliminarXidProductoIdOrden]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadosEliminarXidProductoIdOrden]
	@IdProductoCpt [int],
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
delete from LabResultadoPorItems
where idProductoCpt=@IdProductoCpt and idOrden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadosEliminarXidProductoIdOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadosItemsSINlabPruebas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadosItemsSINlabPruebas]
WITH EXECUTE AS CALLER
AS
/*SELECT DISTINCT dbo.FactCatalogoServicios.Codigo AS cpt, dbo.LabResultadoPorItems.idProductoCpt, dbo.labPruebas.idPrueba
FROM         dbo.LabResultadoPorItems INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.LabResultadoPorItems.idProductoCpt = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.labPruebas ON dbo.FactCatalogoServicios.Codigo = dbo.labPruebas.CodigoCPT
WHERE     (dbo.labPruebas.idPrueba IS NULL)*/

SELECT DISTINCT
                       dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo as cpt, dbo.FactCatalogoServicios.Nombre,
                      dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.labPruebas.CodigoCPT
FROM         dbo.FactCatalogoServicios INNER JOIN
                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto LEFT OUTER JOIN
                      dbo.labPruebas ON dbo.FactCatalogoServicios.Codigo = dbo.labPruebas.CodigoCPT
WHERE     (dbo.FactCatalogoServiciosPtos.idPuntoCarga = 2 OR
                      dbo.FactCatalogoServiciosPtos.idPuntoCarga = 3 OR
                      dbo.FactCatalogoServiciosPtos.idPuntoCarga = 11 OR
                      dbo.FactCatalogoServiciosPtos.idPuntoCarga = 32 OR
                      dbo.FactCatalogoServiciosPtos.idPuntoCarga = 38) AND (dbo.labPruebas.CodigoCPT IS NULL)
ORDER BY dbo.FactCatalogoServicios.Codigo
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadosItemsSINlabPruebas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadosPorItemsActualizar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadosPorItemsActualizar]
	@IdProductoCpt [int],
	@IdOrden [int],
	@ordenXresultado [int],
	@ValorNumero [money],
	@ValorTexto [varchar](500),
	@ValorCombo [varchar](100),
	@ValorCheck [varchar](1),
	@lnIdRealizaAnalisis [int],
	@lnIdUsuario [int],
	@lcFecha [datetime],
	@idGrupo [int],
	@idItem [int],
	@valorReferencial [varchar](100),
	@metodo [varchar](50)
WITH EXECUTE AS CALLER
AS
insert into LabResultadoPorItems (
ordenXresultado,
ValorNumero,
ValorTexto,
ValorCombo,
ValorCheck,
RealizaAnalisis,
IdUsuario,
Fecha,
IdProductoCpt,
IdOrden,
idGrupo,
idItem,
valorReferencial,
metodo
)
 values (
@ordenXresultado,
@ValorNumero,
@ValorTexto,
@ValorCombo,
@ValorCheck,
@lnIdRealizaAnalisis,
@lnIdUsuario,
@lcFecha,
@IdProductoCpt,
@IdOrden,
@idGrupo,
@idItem,
@valorReferencial,
@metodo
)
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadosPorItemsActualizar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadosPorItemsSeleccionarPORfiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LabResultadosPorItemsSeleccionarPORfiltro]
	@Filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;
DECLARE @sql nvarchar(2000);
SET @sql = 'SELECT     dbo.LabResultadoPorItems.*, dbo.LabItems.Item, dbo.LabItemsGrupos.Grupo as NombreGrupo
FROM         dbo.LabResultadoPorItems LEFT OUTER JOIN
                      dbo.LabItemsGrupos ON dbo.LabResultadoPorItems.idGrupo = dbo.LabItemsGrupos.idItemGrupo LEFT OUTER JOIN
                      dbo.LabItems ON dbo.LabResultadoPorItems.idItem = dbo.LabItems.idItem
 WHERE ' +  @Filtro + ' ORDER BY  ordenXresultado'
EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadosPorItemsSeleccionarPORfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabResultadosPorItemsSeleccionarXfiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabResultadosPorItemsSeleccionarXfiltro]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(2000);

SET @sql = 'SELECT * FROM LabResultadoPorItems WHERE ' +  @Filtro + ' ORDER BY  ordenXresultado'

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[LabResultadosPorItemsSeleccionarXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[labResultadoXfechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[labResultadoXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     0 AS llave, dbo.LabResultado.idOrden, dbo.LabResultado.idAnalisis AS cpt, dbo.LabResultado.fecha, dbo.LabMovimientoLaboratorio.Paciente,
                      dbo.Servicios.Nombre AS Servicio, dbo.TiposServicio.Descripcion AS Tservicio, dbo.LabMovimientoLaboratorio.IdComprobantePago,
                      dbo.FactCatalogoServicios.Nombre AS cptDescripcion, dbo.FactCatalogoServicios.IdProducto, dbo.CajaComprobantesPago.NroSerie,
                      dbo.CajaComprobantesPago.NroDocumento, dbo.LabMovimientoLaboratorio.IdMovimiento, dbo.LabMovimientoLaboratorio.Eo_EG,
                      dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS Responsable
FROM         dbo.LabResultado INNER JOIN
                      dbo.LabMovimientoLaboratorio ON dbo.LabResultado.idOrden = dbo.LabMovimientoLaboratorio.IdOrden LEFT OUTER JOIN
                      dbo.Empleados ON dbo.LabResultado.realizaAnalisis = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON
                      dbo.LabMovimientoLaboratorio.IdComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.LabResultado.idAnalisis = dbo.FactCatalogoServicios.Codigo LEFT OUTER JOIN
                      dbo.Servicios INNER JOIN
                      dbo.FactOrdenServicio ON dbo.Servicios.IdServicio = dbo.FactOrdenServicio.IdServicioPaciente INNER JOIN
                      dbo.TiposServicio ON dbo.Servicios.IdTipoServicio = dbo.TiposServicio.IdTipoServicio ON
                      dbo.LabMovimientoLaboratorio.IdOrden = dbo.FactOrdenServicio.IdOrden
 WHERE  dbo.LabResultado.fecha  Between @FechaInicio and @FechaFin
GO
ALTER AUTHORIZATION ON [dbo].[labResultadoXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LabSeleccionaMedicos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LabSeleccionaMedicos]
WITH EXECUTE AS CALLER
AS
SELECT empleados.idEmpleado, UPPER(LTRIM(empleados.ApellidoPaterno)) + ' ' + UPPER(LTRIM(empleados.ApellidoMaterno)) + ' ' + empleados.nombres AS ApNom
FROM (medicos LEFT JOIN empleados ON medicos.idEmpleado = empleados.idEmpleado)
ORDER BY apnom
GO
ALTER AUTHORIZATION ON [dbo].[LabSeleccionaMedicos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListaHistoriasParaPasivo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListaHistoriasParaPasivo]
	@IdEstadoArchivo [int]
WITH EXECUTE AS CALLER
AS
declare @AniosPasaApasivo int
declare @AniosPasaApasivoXeliminar int

select @AniosPasaApasivo =(SELECT TOP 1 AnioPasivo_N1  from HistoriasNormas )
select @AniosPasaApasivoXeliminar=(SELECT TOP 1 AnioElimin_N2  from HistoriasNormas )


if @IdEstadoArchivo=1     --activas
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and dbo.HistoriasClinicas.IdEstadoHistoria =1 and
	        DATEDIFF(year,dbo.HistoriasClinicas.FultimoMovimiento ,getdate() ) <@AniosPasaApasivo
	order by  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
else
if @IdEstadoArchivo=2      --pasiva
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and  dbo.HistoriasClinicas.IdEstadoHistoria =2
	order by    dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
else
if @IdEstadoArchivo=3      --pasiva x eliminar
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and  dbo.HistoriasClinicas.IdEstadoHistoria =3
	order by    dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
else
if @IdEstadoArchivo=4      --pasiva - considerando Historias ACTIVAS
begin
    set nocount on
    create table #myTempTable1(ApellidoPaterno varchar(40),ApellidoMaterno varchar(40),PrimerNombre varchar(40),
                               segundoNombre varchar(40),nroHistoriaClinica int,
                               fnacimiento char(10),fultimoMovimiento char(10),fechaPasoApasivo datetime)

    insert into #myTempTable1(ApellidoPaterno,ApellidoMaterno,PrimerNombre,
                               segundoNombre,nroHistoriaClinica,
                               fnacimiento,fultimoMovimiento,fechaPasoApasivo)
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and dbo.HistoriasClinicas.IdEstadoHistoria =2

    insert into #myTempTable1(ApellidoPaterno,ApellidoMaterno,PrimerNombre,
                               segundoNombre,nroHistoriaClinica,
                               fnacimiento,fultimoMovimiento,fechaPasoApasivo)
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and dbo.HistoriasClinicas.IdEstadoHistoria =1 and
	        DATEDIFF(year,dbo.HistoriasClinicas.FultimoMovimiento ,getdate() ) >=@AniosPasaApasivo  and
	        DATEDIFF(year,dbo.HistoriasClinicas.FultimoMovimiento ,getdate() ) <@AniosPasaApasivoXeliminar

    select * from #myTempTable1	order by    ApellidoPaterno, ApellidoMaterno, PrimerNombre

    drop table  #myTempTable1

end
else
if @IdEstadoArchivo=5      --pasiva x eliminar - considerando Hitorias ACTIVAS
begin
    set nocount on
    create table #myTempTable2(ApellidoPaterno varchar(40),ApellidoMaterno varchar(40),PrimerNombre varchar(40),
                               segundoNombre varchar(40),nroHistoriaClinica int,
                               fnacimiento char(10),fultimoMovimiento char(10),fechaPasoApasivo datetime)

    insert into #myTempTable2(ApellidoPaterno,ApellidoMaterno,PrimerNombre,
                               segundoNombre,nroHistoriaClinica,
                               fnacimiento,fultimoMovimiento,fechaPasoApasivo)
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and dbo.HistoriasClinicas.IdEstadoHistoria =3

    insert into #myTempTable2(ApellidoPaterno,ApellidoMaterno,PrimerNombre,
                               segundoNombre,nroHistoriaClinica,
                               fnacimiento,fultimoMovimiento,fechaPasoApasivo)
	SELECT  dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
			dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica,
			CONVERT(char(10), dbo.Pacientes.FechaNacimiento,103) as Fnacimiento,
			CONVERT(char(10), dbo.HistoriasClinicas.FultimoMovimiento,103) as fultimoMovimiento,
			dbo.HistoriasClinicas.FechaPasoAPasivo
	FROM         dbo.Pacientes INNER JOIN
						  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	WHERE   dbo.Pacientes.IdTipoNumeracion<3 and dbo.HistoriasClinicas.IdEstadoHistoria =1 and
	        DATEDIFF(year,dbo.HistoriasClinicas.FultimoMovimiento ,getdate() ) >@AniosPasaApasivoXeliminar

    select * from #myTempTable2	order by    ApellidoPaterno, ApellidoMaterno, PrimerNombre

    drop table  #myTempTable2

end
GO
ALTER AUTHORIZATION ON [dbo].[ListaHistoriasParaPasivo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListaPaisesPorCodigoNombre]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ListaPaisesPorCodigoNombre]
	@codigo [varchar](3),
	@nombre [varchar](40)
WITH EXECUTE AS CALLER
AS
BEGIN
select * from paises
Where codigo Like @codigo + '%' And nombre Like @nombre  + '%'
END
GO
ALTER AUTHORIZATION ON [dbo].[ListaPaisesPorCodigoNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarGruposAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarGruposAgregar]
	@Indice [int],
	@Clave [varchar](20),
	@Texto [varchar](20),
	@IdListGrupo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ListbarGrupos (
Indice,Clave,Texto) values (
@Indice,@Clave,@Texto)
set @IdListGrupo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdListGrupo,'ListbarGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[ListbarGruposAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarGruposEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarGruposEliminar]
	@IdListGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ListbarGrupos
where IdListGrupo = @IdListGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdListGrupo,'ListbarGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[ListbarGruposEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarGruposModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarGruposModificar]
	@Indice [int],
	@Clave [varchar](20),
	@Texto [varchar](20),
	@IdListGrupo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ListbarGrupos
set
Indice = @Indice,
Clave = @Clave,
Texto = @Texto
where IdListGrupo = @IdListGrupo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdListGrupo,'ListbarGrupos'
GO
ALTER AUTHORIZATION ON [dbo].[ListbarGruposModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarGruposSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarGruposSeleccionarPorId]
	@IdListGrupo [int]
WITH EXECUTE AS CALLER
AS
select * from ListbarGrupos
where IdListGrupo = @IdListGrupo
GO
ALTER AUTHORIZATION ON [dbo].[ListbarGruposSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarItemsAgregar]
	@KeyIcon [char](50),
	@Indice [int],
	@Clave [varchar](20),
	@Texto [varchar](20),
	@IdListGrupo [int],
	@IdListItem [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ListbarItems (
KeyIcon,Indice,Clave,Texto,IdListGrupo) values (
@KeyIcon,@Indice,@Clave,@Texto,@IdListGrupo)
set @IdListItem = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarItemsEliminar]
	@IdListItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ListbarItems
where IdListItem = @IdListItem
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarItemsModificar]
	@KeyIcon [char](50),
	@Indice [int],
	@Clave [varchar](20),
	@Texto [varchar](20),
	@IdListGrupo [int],
	@IdListItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ListbarItems
set
KeyIcon = @KeyIcon,
Indice = @Indice,
Clave = @Clave,
Texto = @Texto,
IdListGrupo = @IdListGrupo
where IdListItem = @IdListItem
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsSeleccionarPorClave]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarItemsSeleccionarPorClave]
	@clave [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from ListbarItems
where Clave =@clave
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsSeleccionarPorClave] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ListbarItemsSeleccionarPorId]
	@IdListItem [int]
WITH EXECUTE AS CALLER
AS
select * from ListbarItems
where IdListItem = @IdListItem
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListbarItemsSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ListbarItemsSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select ListbarItems.IdListItem, ListbarItems.Texto as SubModulo, ListbarGrupos.Texto as Modulo
from ListbarItems
left join ListbarGrupos on ListbarItems.IdListGrupo = ListbarGrupos.IdListGrupo
order by ListbarGrupos.Texto,ListbarItems.Texto
GO
ALTER AUTHORIZATION ON [dbo].[ListbarItemsSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ListBarReporteSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ListBarReporteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select idReporte,Reporte,Modulo,id_menuReporte from ListBarReporte order by Modulo,Reporte
GO
ALTER AUTHORIZATION ON [dbo].[ListBarReporteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LlenaDataComboTipoSalidaBienSegunAlmacen]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LlenaDataComboTipoSalidaBienSegunAlmacen]
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
select * from farmAlmacen
where idAlmacen=@idAlmacen
GO
ALTER AUTHORIZATION ON [dbo].[LlenaDataComboTipoSalidaBienSegunAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LlenaListBoxConTablaMensajesEnVentana]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[LlenaListBoxConTablaMensajesEnVentana]
	@Ventana [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from MensajesEnVentana
where Ventana=@Ventana
order by orden
GO
ALTER AUTHORIZATION ON [dbo].[LlenaListBoxConTablaMensajesEnVentana] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[LogueaUsuario]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[LogueaUsuario]
	@loginEstado [int],
	@loginPC [varchar](50),
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
UPDATE empleados SET loginEstado=@loginEstado, loginPC=@loginPC WHERE idEmpleado=@IdEmpleado
--SCCQ 11/03/2021 Cambio 56  Inicio
if(@loginEstado=1)
begin
       UPDATE empleados SET UltimoLogin=SYSDATETIME() WHERE idEmpleado=@IdEmpleado

end
--SCCQ 11/03/2021 Cambio 56  Fin
GO
ALTER AUTHORIZATION ON [dbo].[LogueaUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[lolcliProblemasHCAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[lolcliProblemasHCAgregar]
	@pacHis [varchar](50),
	@pacPat [varchar](30),
	@pacMat [varchar](30),
	@pacNam [varchar](50),
	@pacFin [datetime],
	@nroHistoriaGalenHos [varchar](50),
	@autogeneradoGalenHos [varchar](50)
WITH EXECUTE AS CALLER
AS
INSERT INTO lolcliProblemasHC (pacHis, pacPat, pacMat, pacNam, pacFin, nroHistoriaGalenHos, autogeneradoGalenHos)
VALUES (@pacHis, @pacPat, @pacMat, @pacNam, @pacFin, @nroHistoriaGalenHos, @autogeneradoGalenHos)
GO
ALTER AUTHORIZATION ON [dbo].[lolcliProblemasHCAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[lolcliProblemasHCAgregarSinNroHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[lolcliProblemasHCAgregarSinNroHistoriaClinica]
	@pacHis [varchar](50),
	@pacPat [varchar](30),
	@pacMat [varchar](30),
	@pacNam [varchar](50),
	@autogeneradoGalenHos [varchar](50)
WITH EXECUTE AS CALLER
AS
INSERT INTO lolcliProblemasHC (pacHis, pacPat, pacMat, pacNam, autogeneradoGalenHos)
VALUES (@pacHis, @pacPat, @pacMat, @pacNam, @autogeneradoGalenHos)
GO
ALTER AUTHORIZATION ON [dbo].[lolcliProblemasHCAgregarSinNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[lolcliProblemasHCSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[lolcliProblemasHCSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select pachis as Historia,pacpat as ApellidoPaterno, pacmat as ApellidoMaterno, pacNam as Nombres,
        dni,fechaNacimiento,
        case idTipoSexo  when 1 then 'M' else 'F' end as Sexo,
        autogeneradoGalenHos as problema  from lolcliProblemasHC order by idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[lolcliProblemasHCSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicamentosInsumosSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicamentosInsumosSeleccionarPorCodigo]
	@CodigoDigemid [varchar](50)
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoBienesInsumos
where Codigo=@CodigoDigemid
GO
ALTER AUTHORIZATION ON [dbo].[MedicamentosInsumosSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicamentosInsumosSeleccionarPorCodigoDevuelveNombre]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicamentosInsumosSeleccionarPorCodigoDevuelveNombre]
	@Codigo [varchar](100)
WITH EXECUTE AS CALLER
AS
select nombre from FactCatalogoBienesInsumos
where Codigo=@Codigo
GO
ALTER AUTHORIZATION ON [dbo].[MedicamentosInsumosSeleccionarPorCodigoDevuelveNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosAgregar]
	@IdEmpleado [int],
	@Colegiatura [char](6),
	@IdMedico [int] OUTPUT,
	@loteHis [varchar](2),
	@idColegioHIS [varchar](2),
	@rne [varchar](50),
	@egresado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Medicos (
IdEmpleado,Colegiatura,loteHis,idColegioHIS,rne,egresado) values (
@IdEmpleado,@Colegiatura,@loteHis,@idColegioHIS,@rne,@egresado)
set @IdMedico = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[MedicosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEliminar]
	@IdMedico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Medicos
where IdMedico = @IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadAgregar]
	@IdMedicoEspecialidad [int] OUTPUT,
	@IdMedico [int],
	@IdEspecialidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into MedicosEspecialidad (
IdMedico,IdEspecialidad) values (
@IdMedico,@IdEspecialidad)
set @IdMedicoEspecialidad = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMedicoEspecialidad,'MedicosEspecialidad'
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadEliminar]
	@IdMedicoEspecialidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from MedicosEspecialidad
where IdMedicoEspecialidad = @IdMedicoEspecialidad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMedicoEspecialidad,'MedicosEspecialidad'
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadEliminarPorIdMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadEliminarPorIdMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
delete from medicosEspecialidad where idMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadEliminarPorIdMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadEliminarPorMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadEliminarPorMedico]
	@IdMedico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from MedicosEspecialidad
where IdMedico = @IdMedico
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMedico,'MedicosEspecialidad'
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadEliminarPorMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadModificar]
	@IdMedicoEspecialidad [int],
	@IdMedico [int],
	@IdEspecialidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update MedicosEspecialidad
set
IdMedico = @IdMedico,
IdEspecialidad = @IdEspecialidad
where IdMedicoEspecialidad = @IdMedicoEspecialidad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMedicoEspecialidad,'MedicosEspecialidad'
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadSeleccionarPorId]
	@IdMedicoEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select * from MedicosEspecialidad
where IdMedicoEspecialidad = @IdMedicoEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosEspecialidadSeleccionarPorMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosEspecialidadSeleccionarPorMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MedicosEspecialidad.*, dbo.Especialidades.IdDepartamento
FROM         dbo.MedicosEspecialidad INNER JOIN
                      dbo.Especialidades ON dbo.MedicosEspecialidad.IdEspecialidad = dbo.Especialidades.IdEspecialidad
where dbo.MedicosEspecialidad.IdMedico = @IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosEspecialidadSeleccionarPorMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosFiltrar]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select Medicos.IdMedico, Empleados.CodigoPlanilla, Empleados.ApellidoPaterno,
         Empleados.ApellidoMaterno, Empleados.Nombres,
         Especialidades.Nombre as Especialidad , Medicos.Colegiatura,Empleados.esActivo
         from ((Medicos left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
         left join MedicosEspecialidad on Medicos.IdMedico = MedicosEspecialidad.IdMedico)
         left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad    '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MedicosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosFiltrarPorProgramacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosFiltrarPorProgramacion]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL =  'SELECT DISTINCT
                           dbo.Medicos.IdMedico,
                           dbo.Empleados.ApellidoPaterno + space(1) + dbo.Empleados.ApellidoMaterno + space(1) + left(dbo.Empleados.Nombres,7) + space(1) + dbo.ProgramacionMedica.HoraInicio + space(1) +
                            dbo.ProgramacionMedica.HoraFin + space(1) + dbo.Servicios.Nombre + space(1) AS Nombre, dbo.ProgramacionMedica.HoraInicio,
                           dbo.ProgramacionMedica.HoraFin, dbo.Servicios.Nombre AS Dservicio,dbo.ProgramacionMedica.IdServicio,
                           dbo.ProgramacionMedica.IdTipoServicio,dbo.ProgramacionMedica.idProgramacion,dbo.ProgramacionMedica.idturno,
                           dbo.Servicios.MaxCuposCitasAdelantadas,dbo.Servicios.MaxCuposAdicionales,
                           dbo.Servicios.MaxCuposCitasHoySIS,MaxCuposCitasAdelandatasSIS,dbo.Empleados.esActivo
               FROM         dbo.Medicos LEFT OUTER JOIN
                           dbo.MedicosEspecialidad ON dbo.Medicos.IdMedico = dbo.MedicosEspecialidad.IdMedico LEFT OUTER JOIN
                           dbo.Especialidades ON dbo.MedicosEspecialidad.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
                           dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado INNER JOIN
                           dbo.ProgramacionMedica ON dbo.Medicos.IdMedico = dbo.ProgramacionMedica.IdMedico LEFT OUTER JOIN
                           dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio   '+@lcFiltro
else
   SET  @SQL =  'SELECT DISTINCT
                           dbo.Medicos.IdMedico,
                           dbo.Empleados.ApellidoPaterno + space(1) + dbo.Empleados.ApellidoMaterno + space(1) + left(dbo.Empleados.Nombres,7) + space(1) + dbo.ProgramacionMedica.HoraInicio + space(1) +
                            dbo.ProgramacionMedica.HoraFin + space(1) + dbo.Servicios.Nombre + space(1) AS Nombre, dbo.ProgramacionMedica.HoraInicio,
                           dbo.ProgramacionMedica.HoraFin, dbo.Servicios.Nombre AS Dservicio,dbo.ProgramacionMedica.IdServicio,
                           dbo.ProgramacionMedica.IdTipoServicio,dbo.ProgramacionMedica.idProgramacion,dbo.ProgramacionMedica.idturno,
                           dbo.Servicios.MaxCuposCitasAdelantadas,dbo.Servicios.MaxCuposAdicionales,
                           dbo.Servicios.MaxCuposCitasHoySIS,MaxCuposCitasAdelandatasSIS,dbo.Empleados.esActivo
               FROM         dbo.Medicos LEFT OUTER JOIN
                           dbo.MedicosEspecialidad ON dbo.Medicos.IdMedico = dbo.MedicosEspecialidad.IdMedico LEFT OUTER JOIN
                           dbo.Especialidades ON dbo.MedicosEspecialidad.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
                           dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado INNER JOIN
                           dbo.ProgramacionMedica ON dbo.Medicos.IdMedico = dbo.ProgramacionMedica.IdMedico LEFT OUTER JOIN
                           dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio '

EXECUTE (@SQL)


GO
ALTER AUTHORIZATION ON [dbo].[MedicosFiltrarPorProgramacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosModificar]
	@IdEmpleado [int],
	@Colegiatura [char](6),
	@IdMedico [int],
	@loteHis [varchar](2),
	@idColegioHIS [varchar](2),
	@rne [varchar](50),
	@egresado [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Medicos
set
IdEmpleado = @IdEmpleado,
Colegiatura = @Colegiatura,
loteHis=@loteHis,
idColegioHIS=@idColegioHIS,
rne=@rne,
egresado=@egresado
where IdMedico = @IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosObtenerDepartamento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosObtenerDepartamento]
	@IdMedico [int],
	@IdDepartamento [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @Cantidad int

select @Cantidad = count(distinct Especialidades.IdDepartamento) from
(Medicos left join MedicosEspecialidad on Medicos.IdMedico = MedicosEspecialidad.IdMedico)
left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad
where Medicos.IdMedico = @IdMedico

if @Cantidad = 1
begin
	select @IdDepartamento = max(Especialidades.IdDepartamento) from
	(Medicos left join MedicosEspecialidad on Medicos.IdMedico = MedicosEspecialidad.IdMedico)
	left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad
	where Medicos.IdMedico = @IdMedico
end
else
begin
	set @IdDepartamento = -1
end
GO
ALTER AUTHORIZATION ON [dbo].[MedicosObtenerDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosPorFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosPorFiltro]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL =  'select distinct Medicos.Idmedico, Empleados.ApellidoPaterno + " " + Empleados.ApellidoMaterno + " " + Empleados.Nombres as Nombre
             from ((Medicos left join MedicosEspecialidad
                on Medicos.IdMedico = MedicosEspecialidad.IdMedico) left join Especialidades
                on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
                left join Empleados on Medicos.Idempleado = Empleados.IdEmpleado   '+@lcFiltro
else
   SET  @SQL =  'select distinct Medicos.Idmedico, Empleados.ApellidoPaterno + " " + Empleados.ApellidoMaterno + " " + Empleados.Nombres as Nombre
             from ((Medicos left join MedicosEspecialidad
                on Medicos.IdMedico = MedicosEspecialidad.IdMedico) left join Especialidades
                on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
                left join Empleados on Medicos.Idempleado = Empleados.IdEmpleado   '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MedicosPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosPorFiltroConEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosPorFiltroConEspecialidad]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL = 'select distinct Medicos.Idmedico, Empleados.ApellidoPaterno + space(1) + Empleados.ApellidoMaterno + space(1) + Empleados.Nombres as Nombre
             from ((Medicos inner join MedicosEspecialidad
                on Medicos.IdMedico = MedicosEspecialidad.IdMedico) left join Especialidades
                on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
                left join Empleados on Medicos.Idempleado = Empleados.IdEmpleado   '+@lcFiltro
else
   SET  @SQL =  'select distinct Medicos.Idmedico, Empleados.ApellidoPaterno + space(1) + Empleados.ApellidoMaterno + space(1) + Empleados.Nombres as Nombre
             from ((Medicos inner join MedicosEspecialidad
                on Medicos.IdMedico = MedicosEspecialidad.IdMedico) left join Especialidades
                on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad)
                left join Empleados on Medicos.Idempleado = Empleados.IdEmpleado   '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MedicosPorFiltroConEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosProgramadosFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosProgramadosFiltrar]
	@IdTipoServicio [int],
	@Fecha [datetime],
	@Hora [char](5),
	@ApellidoPaterno [varchar](50),
	@ApellidoMaterno [varchar](50),
	@Nombres [varchar](50),
	@CodigoPlanilla [varchar](8),
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
IF @CodigoPlanilla <> ''
	BEGIN
		IF @IdEspecialidad<>0
			BEGIN
				SELECT     dbo.Medicos.IdMedico, dbo.Empleados.CodigoPlanilla, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
				                     dbo.Especialidades.Nombre AS Especialidad, dbo.Medicos.Colegiatura, dbo.ProgramacionMedica.IdTipoServicio, dbo.ProgramacionMedica.Fecha,
				                     dbo.ProgramacionMedica.HoraInicio , dbo.ProgramacionMedica.HoraFin,dbo.Empleados.esActivo
				FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
				                     dbo.Especialidades ON dbo.ProgramacionMedica.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
				WHERE dbo.ProgramacionMedica.IdTipoServicio = @IdTipoServicio
				      and dbo.ProgramacionMedica.Fecha=@Fecha
				      and dbo.ProgramacionMedica.HoraInicio<= @Hora and dbo.ProgramacionMedica.HoraFin>=@Hora
				      and Empleados.ApellidoPaterno like @ApellidoPaterno + '%'
				      and Empleados.ApellidoMaterno like @ApellidoMaterno + '%'
				      and Empleados.Nombres like '%' + @Nombres + '%'
				      and Empleados.CodigoPlanilla = @CodigoPlanilla
			                   and dbo.ProgramacionMedica.IdEspecialidad =@IdEspecialidad
				     order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
			END
		ELSE
			BEGIN
				SELECT     dbo.Medicos.IdMedico, dbo.Empleados.CodigoPlanilla, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
				                     dbo.Especialidades.Nombre AS Especialidad, dbo.Medicos.Colegiatura, dbo.ProgramacionMedica.IdTipoServicio, dbo.ProgramacionMedica.Fecha,
				                     dbo.ProgramacionMedica.HoraInicio , dbo.ProgramacionMedica.HoraFin,dbo.Empleados.esActivo
				FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
				                     dbo.Especialidades ON dbo.ProgramacionMedica.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
				WHERE dbo.ProgramacionMedica.IdTipoServicio = @IdTipoServicio
				      and dbo.ProgramacionMedica.Fecha=@Fecha
				      and dbo.ProgramacionMedica.HoraInicio<= @Hora and dbo.ProgramacionMedica.HoraFin>=@Hora
				      and Empleados.ApellidoPaterno like @ApellidoPaterno + '%'
				      and Empleados.ApellidoMaterno like @ApellidoMaterno + '%'
				      and Empleados.Nombres like '%' + @Nombres + '%'
				      and Empleados.CodigoPlanilla = @CodigoPlanilla
				      order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
			END
	END
ELSE
	BEGIN
		IF @IdEspecialidad<>0
			BEGIN
				SELECT     dbo.Medicos.IdMedico, dbo.Empleados.CodigoPlanilla, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
				                     dbo.Especialidades.Nombre AS Especialidad, dbo.Medicos.Colegiatura, dbo.ProgramacionMedica.IdTipoServicio, dbo.ProgramacionMedica.Fecha,
				                     dbo.ProgramacionMedica.HoraInicio , dbo.ProgramacionMedica.HoraFin,dbo.Empleados.esActivo
				FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
				                     dbo.Especialidades ON dbo.ProgramacionMedica.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN

				                     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
				WHERE dbo.ProgramacionMedica.IdTipoServicio = @IdTipoServicio
				      and dbo.ProgramacionMedica.Fecha=@Fecha
				      and dbo.ProgramacionMedica.HoraInicio<= @Hora and dbo.ProgramacionMedica.HoraFin>=@Hora
				      and Empleados.ApellidoPaterno like @ApellidoPaterno + '%'
				      and Empleados.ApellidoMaterno like @ApellidoMaterno + '%'
				      and Empleados.Nombres like '%' + @Nombres + '%'
			                   and dbo.ProgramacionMedica.IdEspecialidad =@IdEspecialidad
				      order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
			END
		ELSE
			BEGIN
				SELECT     dbo.Medicos.IdMedico, dbo.Empleados.CodigoPlanilla, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
				                     dbo.Especialidades.Nombre AS Especialidad, dbo.Medicos.Colegiatura, dbo.ProgramacionMedica.IdTipoServicio, dbo.ProgramacionMedica.Fecha,
				                     dbo.ProgramacionMedica.HoraInicio , dbo.ProgramacionMedica.HoraFin,dbo.Empleados.esactivo
				FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
				                     dbo.Especialidades ON dbo.ProgramacionMedica.IdEspecialidad = dbo.Especialidades.IdEspecialidad LEFT OUTER JOIN
				                     dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico LEFT OUTER JOIN
				                     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
				WHERE dbo.ProgramacionMedica.IdTipoServicio = @IdTipoServicio
				      and dbo.ProgramacionMedica.Fecha=@Fecha
				      and dbo.ProgramacionMedica.HoraInicio<= @Hora and dbo.ProgramacionMedica.HoraFin>=@Hora
				      and Empleados.ApellidoPaterno like @ApellidoPaterno + '%'
				      and Empleados.ApellidoMaterno like @ApellidoMaterno + '%'
				      and Empleados.Nombres like '%' + @Nombres + '%'
				      order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
			END
	END
GO
ALTER AUTHORIZATION ON [dbo].[MedicosProgramadosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarPorColegiatura]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarPorColegiatura]
	@Colegiatura [char](6)
WITH EXECUTE AS CALLER
AS
SELECT Medicos.* from Medicos, Empleados
where medicos.colegiatura = @Colegiatura  AND empleados.idEmpleado=medicos.idEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarPorColegiatura] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarPorDNI]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarPorDNI]
	@Dni [char](20)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.Empleados.CodigoPlanilla,
                     dbo.Medicos.Colegiatura , dbo.Empleados.DNI, dbo.TiposEmpleado.TipoEmpleadoSIS,dbo.Medicos.rne,dbo.Medicos.egresado
FROM         dbo.TiposEmpleado RIGHT OUTER JOIN
                     dbo.Empleados ON dbo.TiposEmpleado.IdTipoEmpleado = dbo.Empleados.IdTipoEmpleado RIGHT OUTER JOIN
                     dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado
WHERE dbo.Empleados.DNI=@Dni
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarPorDNI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarPorEspecialidad]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno)
       + ' ' + dbo.Empleados.Nombres AS Dmedico, dbo.MedicosEspecialidad.IdEspecialidad,dbo.Empleados.esActivo
FROM         dbo.Medicos RIGHT OUTER JOIN
       dbo.MedicosEspecialidad ON dbo.Medicos.IdMedico = dbo.MedicosEspecialidad.IdMedico LEFT OUTER JOIN
       dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE dbo.MedicosEspecialidad.IdEspecialidad=@IdEspecialidad
ORDER BY Dmedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarPorId]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
select * from Medicos
where IdMedico = @IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarPorIdMedicoPlanilla]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarPorIdMedicoPlanilla]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
                  dbo.Empleados.CodigoPlanilla
FROM        dbo.Medicos LEFT OUTER JOIN
                  dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
WHERE dbo.Medicos.IdMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarPorIdMedicoPlanilla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select Medicos.IdMedico, Empleados.CodigoPlanilla, Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres,
Especialidades.Nombre as Especialidad, Medicos.Colegiatura, Empleados.DNI,medicos.LoteHIS
from ((Medicos left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado)
left join MedicosEspecialidad on Medicos.IdMedico = MedicosEspecialidad.IdMedico)
left join Especialidades on MedicosEspecialidad.IdEspecialidad = Especialidades.IdEspecialidad
order by Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarTodosOrdenadoAlfabeticamente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarTodosOrdenadoAlfabeticamente]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
dbo.Empleados.Nombres,dbo.Medicos.IdMedico,
rtrim(Empleados.ApellidoPaterno)+' '+rtrim(Empleados.ApellidoMaterno)+' '+ Empleados.Nombres as Dmedico,
dbo.Empleados.esActivo , dbo.Medicos.idColegioHIS
FROM dbo.Medicos LEFT OUTER JOIN dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
ORDER BY dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarTodosOrdenadoAlfabeticamente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarTodosParaWeb]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarTodosParaWeb]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Empleados.IdEmpleado, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
                     dbo.Empleados.DNI , dbo.Medicos.Colegiatura
FROM         dbo.Medicos INNER JOIN
                     dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarTodosParaWeb] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarXidentificador]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres
FROM         dbo.Medicos LEFT OUTER JOIN
       dbo.Empleados ON dbo.Medicos.IdEmpleado = dbo.Empleados.IdEmpleado
where idMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosSeleccionarXIdMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosSeleccionarXIdMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.IdMedico, dbo.Medicos.Colegiatura, dbo.Empleados.DNI, dbo.TiposEmpleado.TipoEmpleadoSIS, dbo.Empleados.ApellidoPaterno,
                     dbo.Empleados.ApellidoMaterno , dbo.Empleados.Nombres,dbo.Medicos.rne,dbo.Medicos.egresado,dbo.Empleados.idTipoDocumento,
               dbo.TiposEmpleado.Descripcion ,dbo.Empleados.esActivo
FROM         dbo.TiposEmpleado RIGHT OUTER JOIN
                     dbo.Empleados ON dbo.TiposEmpleado.IdTipoEmpleado = dbo.Empleados.IdTipoEmpleado RIGHT OUTER JOIN
                     dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado
WHERE dbo.Medicos.IdMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[MedicosSeleccionarXIdMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosXcodigoPlanilla]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MedicosXcodigoPlanilla]
	@CodigoPlanilla [varchar](8)
WITH EXECUTE AS CALLER
AS
select Medicos.IdMedico  from Medicos left join empleados on Medicos.IdEmpleado = Empleados.IdEmpleado where Empleados.CodigoPlanilla = @CodigoPlanilla
GO
ALTER AUTHORIZATION ON [dbo].[MedicosXcodigoPlanilla] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MedicosXidEmpleado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MedicosXidEmpleado]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Empleados.IdEmpleado, dbo.Medicos.Colegiatura,dbo.Medicos.idMedico, dbo.Medicos.IdColegioHIS
FROM         dbo.Empleados RIGHT OUTER JOIN
                   dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado
WHERE     dbo.Empleados.IdEmpleado=@IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[MedicosXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MotivosMovimientoHistoriaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MotivosMovimientoHistoriaAgregar]
	@Descripcion [varchar](50),
	@IdMotivo [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into MotivosMovimientoHistoria (
Descripcion) values (
@Descripcion)
set @IdMotivo = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMotivo,'MotivosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoriaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MotivosMovimientoHistoriaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MotivosMovimientoHistoriaEliminar]
	@IdMotivo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from MotivosMovimientoHistoria
where IdMotivo = @IdMotivo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMotivo,'MotivosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoriaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MotivosMovimientoHistoriaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MotivosMovimientoHistoriaModificar]
	@Descripcion [varchar](50),
	@IdMotivo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update MotivosMovimientoHistoria
set
Descripcion = @Descripcion
where IdMotivo = @IdMotivo
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMotivo,'MotivosMovimientoHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoriaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MotivosMovimientoHistoriaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MotivosMovimientoHistoriaSeleccionarPorId]
	@IdMotivo [int]
WITH EXECUTE AS CALLER
AS
select * from MotivosMovimientoHistoria
where IdMotivo = @IdMotivo
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoriaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MotivosMovimientoHistoriaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MotivosMovimientoHistoriaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdMotivo, Descripcion,
(Convert(varchar(5), IdMotivo) + ' = ' + Descripcion) as DescripcionLarga
 from MotivosMovimientoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[MotivosMovimientoHistoriaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatoHCMovimientosPorDia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatoHCMovimientosPorDia]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     Servicios_1.Nombre AS ServicioDestino, Servicios_1.IdTipoServicio AS idTipoServicioDestino,
	                      dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento, dbo.MovimientosFormatosHistoriaClinica.IdMotivo,
	                      Servicios_2.Nombre AS ServicioOrigen, dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen,
	                      Servicios_2.IdTipoServicio AS idTipoServicioOrigen
	FROM         dbo.MovimientosFormatosHistoriaClinica LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.MovimientosFormatosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.Servicios Servicios_1 ON dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino = Servicios_1.IdServicio LEFT OUTER JOIN
	                      dbo.Servicios Servicios_2 ON dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen = Servicios_2.IdServicio
	WHERE         dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento Between @FechaInicio and @FechaFin
             ORDER BY  dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatoHCMovimientosPorDia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatoHCMovimientosRetornoHCPorFechasYtipoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatoHCMovimientosRetornoHCPorFechasYtipoServicio]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino, dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento,
	                      dbo.MovimientosFormatosHistoriaClinica.IdMotivo, Servicios_2.Nombre AS ServicioOrigen, dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen,
	                       Servicios_2.IdTipoServicio AS idTipoServicioOrigen, dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso
	FROM         dbo.MovimientosFormatosHistoriaClinica LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.MovimientosFormatosHistoriaClinica.IdAtencion = dbo.Atenciones.IdAtencion LEFT OUTER JOIN
	                      dbo.Servicios Servicios_2 ON dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen = Servicios_2.IdServicio
	WHERE         dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento Between @FechaInicio and @FechaFin
		       and Servicios_2.IdTipoServicio=@idTipoServicio  and  dbo.MovimientosFormatosHistoriaClinica.idMotivo=9
             ORDER BY  dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatoHCMovimientosRetornoHCPorFechasYtipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHCPorIdGrupo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHCPorIdGrupo]
	@IdGrupo [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosFormatosHistoriaClinica.IdMovimiento AS IdMovimientoHistoria, 0 as IdHistoriaSolicitada, dbo.Pacientes.IdPaciente,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.IdTipoNumeracion AS IdTipoHistoria,
                      dbo.Pacientes.ApellidoPaterno + ' ' + dbo.Pacientes.ApellidoMaterno + ' ' + dbo.Pacientes.PrimerNombre AS Nombres, CONVERT(char(10),
                      dbo.MovimientosFormatosHistoriaClinica.fechaMovimiento, 103)  AS FechaSolicitud, CONVERT(char(10),
                      dbo.MovimientosFormatosHistoriaClinica.fechaMovimiento, 103)  as  FechaRequerida,
                      dbo.MovimientosFormatosHistoriaClinica.NroFolios, ServicioOrigen.IdServicio AS IdServicioOrigen, ServicioOrigen.Nombre AS NombreServicioOrigen,
                      ServicioDestino.IdServicio AS IdServicioDestino, ServicioDestino.Nombre AS NombreServicioDestino,
                      dbo.MovimientosFormatosHistoriaClinica.IdPaciente AS Expr1,dbo.MovimientosFormatosHistoriaClinica.IdAtencion
FROM         dbo.MovimientosFormatosHistoriaClinica LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.MovimientosFormatosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.Servicios ServicioDestino ON ServicioDestino.IdServicio = dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino LEFT OUTER JOIN
                      dbo.Servicios ServicioOrigen ON ServicioOrigen.IdServicio = dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen
where
MovimientosFormatosHistoriaClinica.IdGrupoMovimiento = @IdGrupo
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHCPorIdGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHistoriaClinicaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHistoriaClinicaAgregar]
	@IdMovimiento [int] OUTPUT,
	@IdPaciente [int],
	@FechaMovimiento [datetime],
	@IdMotivo [int],
	@Observacion [varchar](100),
	@IdServicioOrigen [int],
	@IdServicioDestino [int],
	@NroFolios [int],
	@IdEmpleadoArchivo [int],
	@IdEmpleadoTransporte [int],
	@IdEmpleadoRecepcion [int],
	@IdGrupoMovimiento [int],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into MovimientosFormatosHistoriaClinica (
IdPaciente,FechaMovimiento,IdMotivo,Observacion,IdServicioOrigen,IdServicioDestino,NroFolios,IdEmpleadoArchivo,IdEmpleadoTransporte,IdEmpleadoRecepcion,IdGrupoMovimiento,IdAtencion) values (
@IdPaciente,@FechaMovimiento,@IdMotivo,@Observacion,@IdServicioOrigen,@IdServicioDestino,@NroFolios,@IdEmpleadoArchivo,@IdEmpleadoTransporte,@IdEmpleadoRecepcion,@IdGrupoMovimiento,@IdAtencion)
set @IdMovimiento = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'MovimientosFormatosHistoriaClinica'
--daniel barrantes--
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHistoriaClinicaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHistoriaClinicaEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from MovimientosFormatosHistoriaClinica
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'MovimientosFormatosHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHistoriaClinicaFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHistoriaClinicaFiltrar]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'SELECT     dbo.MovimientosFormatosHistoriaClinica.IdMovimiento, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                       dbo.HistoriasClinicas.NroHistoriaClinica AS HistoriaClinica, CONVERT(char(20), dbo.MovimientosFormatosHistoriaClinica.FechaMovimiento, 100)
                       AS FechaMovimiento, ServicioOrigen.Codigo + " - " + ServicioOrigen.Nombre AS Origen,
                       ServicioDestino.Codigo + " - " + ServicioDestino.Nombre AS Destino, dbo.MotivosMovimientoHistoria.Descripcion AS dMotivo,
                       dbo.MovimientosFormatosHistoriaClinica.NroFolios , dbo.MovimientosFormatosHistoriaClinica.Observacion
                 FROM         dbo.MovimientosFormatosHistoriaClinica LEFT OUTER JOIN
                       dbo.MotivosMovimientoHistoria ON dbo.MovimientosFormatosHistoriaClinica.IdMotivo = dbo.MotivosMovimientoHistoria.IdMotivo LEFT OUTER JOIN
                       dbo.Pacientes ON dbo.MovimientosFormatosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                       dbo.Servicios ServicioOrigen ON dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen = ServicioOrigen.IdServicio LEFT OUTER JOIN
                       dbo.Servicios ServicioDestino ON dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino = ServicioDestino.IdServicio LEFT OUTER JOIN
                       dbo.HistoriasClinicas ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente    '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinicaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHistoriaClinicaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHistoriaClinicaModificar]
	@IdMovimiento [int],
	@IdPaciente [int],
	@FechaMovimiento [datetime],
	@IdMotivo [int],
	@Observacion [varchar](100),
	@IdServicioOrigen [int],
	@IdServicioDestino [int],
	@NroFolios [int],
	@IdEmpleadoArchivo [int],
	@IdEmpleadoTransporte [int],
	@IdEmpleadoRecepcion [int],
	@IdGrupoMovimiento [int],
	@IdAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update MovimientosFormatosHistoriaClinica
set
IdPaciente = @IdPaciente,
FechaMovimiento = @FechaMovimiento,
IdMotivo = @IdMotivo,
Observacion = @Observacion,
IdServicioOrigen = @IdServicioOrigen,
IdServicioDestino = @IdServicioDestino,
NroFolios = @NroFolios,
IdEmpleadoArchivo = @IdEmpleadoArchivo,
IdEmpleadoTransporte = @IdEmpleadoTransporte,
IdEmpleadoRecepcion = @IdEmpleadoRecepcion,
IdGrupoMovimiento = @IdGrupoMovimiento,
IdAtencion = @IdAtencion
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'MovimientosFormatosHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosHistoriaClinicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosHistoriaClinicaSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from MovimientosFormatosHistoriaClinica
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosHistoriaClinicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosFormatosSeleccionarPorIdentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosFormatosSeleccionarPorIdentificador]
	@IdMovimientoF [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosFormatosHistoriaClinica.IdMotivo, dbo.MovimientosFormatosHistoriaClinica.Observacion, dbo.Pacientes.ApellidoPaterno,
                   dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Servicios.Nombre AS sOrigen,
         Servicios_1.Nombre AS sDestino
FROM         dbo.Pacientes RIGHT OUTER JOIN
             dbo.MovimientosFormatosHistoriaClinica LEFT OUTER JOIN
             dbo.Servicios ON dbo.MovimientosFormatosHistoriaClinica.IdServicioOrigen = dbo.Servicios.IdServicio LEFT OUTER JOIN
             dbo.Servicios Servicios_1 ON dbo.MovimientosFormatosHistoriaClinica.IdServicioDestino = Servicios_1.IdServicio ON
             dbo.Pacientes.IdPaciente = dbo.MovimientosFormatosHistoriaClinica.IdPaciente
WHERE dbo.MovimientosFormatosHistoriaClinica.idMovimiento=@IdMovimientoF
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosFormatosSeleccionarPorIdentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaAgregar]
	@NroFolios [int],
	@IdServicioDestino [int],
	@IdServicioOrigen [int],
	@Observacion [varchar](100),
	@IdMotivo [int],
	@FechaMovimiento [datetime],
	@IdPaciente [int],
	@IdMovimiento [int] OUTPUT,
	@IdEmpleadoRecepcion [int],
	@IdEmpleadoTransporte [int],
	@IdEmpleadoArchivo [int],
	@IdGrupoMovimiento [int],
	@IdUsuarioAuditoria [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
insert into MovimientosHistoriaClinica (
NroFolios,IdServicioDestino,IdServicioOrigen,Observacion,IdMotivo,FechaMovimiento,IdPaciente,IdEmpleadoRecepcion,IdEmpleadoTransporte,IdEmpleadoArchivo,IdGrupoMovimiento,idAtencion) values (
@NroFolios,@IdServicioDestino,@IdServicioOrigen,@Observacion,@IdMotivo,@FechaMovimiento,@IdPaciente,@IdEmpleadoRecepcion,@IdEmpleadoTransporte,@IdEmpleadoArchivo,@IdGrupoMovimiento,@idAtencion)
set @IdMovimiento = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdMovimiento,'MovimientosHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaEliminar]
	@IdMovimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from MovimientosHistoriaClinica
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdMovimiento,'MovimientosHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaEliminarMovIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaEliminarMovIdPaciente]
	@IdMovimiento [int],
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
delete from MovimientosHistoriaClinica
where IdMovimiento = @IdMovimiento  and idPaciente=@idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaEliminarMovIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaEsUltimoMovimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaEsUltimoMovimiento]
	@IdPaciente [int],
	@IdMovimiento [int],
	@EsUltimo [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @IdUltimoMovimiento int



select @IdUltimoMovimiento = IdMovimiento from MovimientosHistoriaClinica

                where IdPaciente = @IdPaciente and FechaMovimiento in (

                select top 1 FechaMovimiento from MovimientosHistoriaClinica

                where IdPaciente = @IdPaciente

                order by FechaMovimiento desc)



if @IdMovimiento = @IdUltimoMovimiento

                set @EsUltimo = 1

else

                set @EsUltimo = 0
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaEsUltimoMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaFiltrar]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'SELECT     dbo.MovimientosHistoriaClinica.IdMovimiento, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                       dbo.DNI_HISTORIAdevuelveSIN9(dbo.HistoriasClinicas.NroHistoriaClinica) AS HistoriaClinica,dbo.Pacientes.FichaFamiliar, CONVERT(char(20), dbo.MovimientosHistoriaClinica.FechaMovimiento, 100)
                       AS FechaMovimiento, ServicioOrigen.Codigo + space(1) + ServicioOrigen.Nombre AS Origen,
                       ServicioDestino.Codigo + space(1) + ServicioDestino.Nombre AS Destino, dbo.MotivosMovimientoHistoria.Descripcion AS dMotivo,
                       dbo.MovimientosHistoriaClinica.NroFolios , dbo.MovimientosHistoriaClinica.Observacion, dbo.MovimientosHistoriaClinica.idPaciente
                 FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
                       dbo.MotivosMovimientoHistoria ON dbo.MovimientosHistoriaClinica.IdMotivo = dbo.MotivosMovimientoHistoria.IdMotivo LEFT OUTER JOIN
                       dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                       dbo.Servicios ServicioOrigen ON dbo.MovimientosHistoriaClinica.IdServicioOrigen = ServicioOrigen.IdServicio LEFT OUTER JOIN
                       dbo.Servicios ServicioDestino ON dbo.MovimientosHistoriaClinica.IdServicioDestino = ServicioDestino.IdServicio LEFT OUTER JOIN
                       dbo.HistoriasClinicas ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente    '+@lcFiltro
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaModificar]
	@NroFolios [int],
	@IdServicioDestino [int],
	@IdServicioOrigen [int],
	@Observacion [varchar](100),
	@IdMotivo [int],
	@FechaMovimiento [datetime],
	@IdPaciente [int],
	@IdMovimiento [int],
	@IdEmpleadoRecepcion [int],
	@IdEmpleadoTransporte [int],
	@IdEmpleadoArchivo [int],
	@IdGrupoMovimiento [int],
	@IdUsuarioAuditoria [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
update MovimientosHistoriaClinica
set
NroFolios = @NroFolios,
IdServicioDestino = @IdServicioDestino,
IdServicioOrigen = @IdServicioOrigen,
Observacion = @Observacion,
IdMotivo = @IdMotivo,
FechaMovimiento = @FechaMovimiento,
IdPaciente = @IdPaciente,
IdEmpleadoRecepcion = @IdEmpleadoRecepcion,
IdEmpleadoTransporte = @IdEmpleadoTransporte,
IdEmpleadoArchivo = @IdEmpleadoArchivo,
IdGrupoMovimiento = @IdGrupoMovimiento,
idAtencion=@idAtencion
where IdMovimiento = @IdMovimiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdMovimiento,'MovimientosHistoriaClinica'
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaMovimientosPorDia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaMovimientosPorDia]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     Servicios_1.Nombre AS ServicioDestino, Servicios_1.IdTipoServicio AS idTipoServicioDestino,dbo.MovimientosHistoriaClinica.IdServicioDestino,
		      dbo.Pacientes.NroHistoriaClinica,  dbo.MovimientosHistoriaClinica.FechaMovimiento, dbo.MovimientosHistoriaClinica.IdMotivo,
                                 Servicios_2.Nombre AS ServicioOrigen, dbo.MovimientosHistoriaClinica.IdServicioOrigen, Servicios_2.IdTipoServicio AS idTipoServicioOrigen
	FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
	                      dbo.Servicios Servicios_1 ON dbo.MovimientosHistoriaClinica.IdServicioDestino = Servicios_1.IdServicio LEFT OUTER JOIN
	                      dbo.Servicios Servicios_2 ON dbo.MovimientosHistoriaClinica.IdServicioOrigen = Servicios_2.IdServicio
	WHERE         dbo.MovimientosHistoriaClinica.FechaMovimiento Between @FechaInicio and @FechaFin
             ORDER BY  dbo.MovimientosHistoriaClinica.FechaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaMovimientosPorDia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaNoLlegaAlArchivoClinico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaNoLlegaAlArchivoClinico]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                     ISNULL(dbo.Pacientes.SegundoNombre,'') as SegundoNombre, ISNULL(dbo.Servicios.Nombre,'') AS ServicioSalida, dbo.MovimientosHistoriaClinica.FechaMovimiento,
                     dbo.MovimientosHistoriaClinica.IdMovimiento , dbo.MovimientosHistoriaClinica.IdServicioDestino,  dbo.MovimientosHistoriaClinica.Idatencion
FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
                     dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                     dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioDestino = dbo.Servicios.IdServicio
WHERE     dbo.MovimientosHistoriaClinica.FechaMovimiento Between @FechaInicio and  @FechaFin
ORDER BY dbo.Pacientes.NroHistoriaClinica, dbo.MovimientosHistoriaClinica.FechaMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaNoLlegaAlArchivoClinico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaParaDevolver2]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaParaDevolver2]
	@lcFiltro [varchar](1000),
	@lnIdArchivoClinico [varchar](20),
	@lcParametro231 [varchar](1),
	@lIdUsuario [varchar](20)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcParametro231='S'
   SET  @SQL =  'SELECT     dbo.Pacientes.NroHistoriaClinica,dbo.MovimientosHistoriaClinica.IdMovimiento AS IdMovimientoHistoria, 0 AS IdHistoriaSolicitada, dbo.Pacientes.IdPaciente,
                           dbo.Pacientes.IdTipoNumeracion AS IdTipoHistoria,
                           dbo.Pacientes.ApellidoPaterno + " " + dbo.Pacientes.ApellidoMaterno + " " + dbo.Pacientes.PrimerNombre AS Nombres, NULL AS FechaRequerida,
                           convert(char(10), dbo.MovimientosHistoriaClinica.fechaMovimiento, 103) AS FechaSolicitud, dbo.MovimientosHistoriaClinica.IdAtencion, dbo.MovimientosHistoriaClinica.NroFolios,
                           dbo.Servicios.IdServicio AS IdServicioOrigen, dbo.Servicios.Nombre AS NombreServicioOrigen, '+@lnIdArchivoClinico+' AS IdServicioDestino,
                           "Archivo Clinico" AS NombreServicioDestino
                 FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
                           dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                           dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioDestino = dbo.Servicios.IdServicio
                           where MovimientosHistoriaClinica.IdServicioDestino  <> '+@lnIdArchivoClinico+ '  '+@lcFiltro
else
   SET  @SQL =  'select MovimientosHistoriaClinica.IdMovimiento as IdMovimientoHistoria, 0 as IdHistoriaSolicitada,
         Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
         Pacientes.ApellidoPaterno + " " + Pacientes.ApellidoMaterno + " " + Pacientes.PrimerNombre as Nombres,
         Null as FechaSolicitud,
         Null as FechaRequerida,MovimientosHistoriaClinica.idAtencion,
         MovimientosHistoriaClinica.NroFolios,
         ServicioDestino.IdServicio as IdServicioOrigen, ServicioDestino.Nombre as NombreServicioOrigen,
         '+@lnIdArchivoClinico+' as IdServicioDestino, "Archivo Clinico" as NombreServicioDestino
         from ((tempMovimientos
         left join MovimientosHistoriaClinica on tempMovimientos.IdMovimiento = MovimientosHistoriaClinica.IdMovimiento)
         left join Pacientes on Pacientes.IdPaciente = MovimientosHistoriaClinica.IdPaciente)
         left join Servicios as ServicioDestino on ServicioDestino.IdServicio = MovimientosHistoriaClinica.IdServicioDestino
         where MovimientosHistoriaClinica.IdServicioDestino  <> 340 and tempMovimientos.Idusuario = '+@lIdUsuario+'          '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaParaDevolver2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaParaDevolver3]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaParaDevolver3]
	@lcFiltro [varchar](1000),
	@lnIdArchivoClinico [varchar](20),
	@lcParametro231 [varchar](1),
	@lIdUsuario [varchar](20)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcParametro231='S'
   SET  @SQL =  'SELECT     dbo.Pacientes.NroHistoriaClinica,dbo.MovimientosHistoriaClinica.IdMovimiento AS IdMovimientoHistoria, 0 AS IdHistoriaSolicitada, dbo.Pacientes.IdPaciente,
                           dbo.Pacientes.IdTipoNumeracion AS IdTipoHistoria,
                           dbo.Pacientes.ApellidoPaterno + '' '' + dbo.Pacientes.ApellidoMaterno + '' '' + dbo.Pacientes.PrimerNombre AS Nombres, NULL AS FechaRequerida,
                           convert(char(10), dbo.MovimientosHistoriaClinica.fechaMovimiento, 103) AS FechaSolicitud, dbo.MovimientosHistoriaClinica.IdAtencion, dbo.MovimientosHistoriaClinica.NroFolios,
                           dbo.Servicios.IdServicio AS IdServicioOrigen, dbo.Servicios.Nombre AS NombreServicioOrigen, '+@lnIdArchivoClinico+' AS IdServicioDestino,
                           ''Archivo Clinico'' AS NombreServicioDestino
                 FROM         dbo.MovimientosHistoriaClinica
			LEFT OUTER JOIN dbo.HistoriasSolicitadas ON dbo.MovimientosHistoriaClinica.idMovimiento = dbo.HistoriasSolicitadas.idMovimiento
			LEFT OUTER JOIN
                           dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                           dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioDestino = dbo.Servicios.IdServicio
                           where MovimientosHistoriaClinica.IdServicioDestino  <> '+@lnIdArchivoClinico+ '  '+@lcFiltro
else
   SET  @SQL =  'select MovimientosHistoriaClinica.IdMovimiento as IdMovimientoHistoria, 0 as IdHistoriaSolicitada,
         Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
         Pacientes.ApellidoPaterno + '' '' + Pacientes.ApellidoMaterno + '' '' + Pacientes.PrimerNombre as Nombres,
         Null as FechaSolicitud,
         Null as FechaRequerida,MovimientosHistoriaClinica.idAtencion,
         MovimientosHistoriaClinica.NroFolios,
         ServicioDestino.IdServicio as IdServicioOrigen, ServicioDestino.Nombre as NombreServicioOrigen,
         '+@lnIdArchivoClinico+' as IdServicioDestino, ''Archivo Clinico'' as NombreServicioDestino
         from ((tempMovimientos
         left join MovimientosHistoriaClinica on tempMovimientos.IdMovimiento = MovimientosHistoriaClinica.IdMovimiento)
	LEFT OUTER JOIN dbo.HistoriasSolicitadas ON dbo.MovimientosHistoriaClinica.idMovimiento = dbo.HistoriasSolicitadas.idMovimiento
         left join Pacientes on Pacientes.IdPaciente = MovimientosHistoriaClinica.IdPaciente)
         left join Servicios as ServicioDestino on ServicioDestino.IdServicio = MovimientosHistoriaClinica.IdServicioDestino
         where MovimientosHistoriaClinica.IdServicioDestino  <> 340 and tempMovimientos.Idusuario = '+@lIdUsuario+'          '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaParaDevolver3] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaPorFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaPorFiltro]
	@sfechaMovimiento [datetime],
	@lIdServiciodestino [int],
	@lnIdPacienteSolo [int]
WITH EXECUTE AS CALLER
AS
if @lIdServiciodestino=0 and @lnIdPacienteSolo=0
    select IdPaciente from MovimientosHistoriaClinica where DATEADD(dd, 0, DATEDIFF(dd, 0, fechamovimiento)) <= convert(datetime,@sfechaMovimiento,103)
else
    if @lIdServiciodestino>0 and @lnIdPacienteSolo=0
       select IdPaciente from MovimientosHistoriaClinica where DATEADD(dd, 0, DATEDIFF(dd, 0, fechamovimiento)) <= convert(datetime,@sfechaMovimiento,103)  and IdServicioDestino = @lIdServiciodestino
   else
    if @lIdServiciodestino=0 and @lnIdPacienteSolo>0
       select IdPaciente from MovimientosHistoriaClinica where DATEADD(dd, 0, DATEDIFF(dd, 0, fechamovimiento)) <= convert(datetime,@sfechaMovimiento,103)  and IdPaciente = @lnIdPacienteSolo
   else
       select IdPaciente from MovimientosHistoriaClinica where DATEADD(dd, 0, DATEDIFF(dd, 0, fechamovimiento)) <= convert(datetime,@sfechaMovimiento,103)  and IdPaciente = @lnIdPacienteSolo and IdServicioDestino = @lIdServiciodestino

--(
--@lcFiltro varchar(1000),
--@sFechaMovimiento varchar(20)
--)
--AS
--DECLARE @SQL AS VARCHAR(2000)

--   SET  @SQL =  'select IdPaciente from MovimientosHistoriaClinica where
--                              FechaMovimiento <= convert(datetime,'+@sFechaMovimiento+',102)   '+@lcfiltro


--EXECUTE (@SQL)
--GO
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaSeleccionarPorId]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
select * from MovimientosHistoriaClinica
where IdMovimiento = @IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaSeleccionarPorIdentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaSeleccionarPorIdentificador]
	@IdMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosHistoriaClinica.IdMotivo, dbo.MovimientosHistoriaClinica.Observacion, dbo.Pacientes.ApellidoPaterno,
                    dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Servicios.Nombre AS sOrigen,
         Servicios_1.Nombre AS sDestino
FROM         dbo.Pacientes RIGHT OUTER JOIN
             dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
             dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioOrigen = dbo.Servicios.IdServicio LEFT OUTER JOIN
             dbo.Servicios Servicios_1 ON dbo.MovimientosHistoriaClinica.IdServicioDestino = Servicios_1.IdServicio ON
             dbo.Pacientes.IdPaciente = dbo.MovimientosHistoriaClinica.IdPaciente
WHERE dbo.MovimientosHistoriaClinica.idMovimiento=@IdMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaSeleccionarPorIdentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaSeleccionaUltimoMovimientoPorPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaSeleccionaUltimoMovimientoPorPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 *, dbo.Servicios.Nombre AS nombreServicioDestino, Servicios_1.Nombre AS nombreServicioOrigen
FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
                      dbo.Servicios Servicios_1 ON dbo.MovimientosHistoriaClinica.IdServicioOrigen = Servicios_1.IdServicio LEFT OUTER JOIN
                      dbo.Servicios ON dbo.MovimientosHistoriaClinica.IdServicioDestino = dbo.Servicios.IdServicio
WHERE     (dbo.MovimientosHistoriaClinica.IdPaciente = @IdPaciente)
ORDER BY dbo.MovimientosHistoriaClinica.IdMovimiento DESC
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaSeleccionaUltimoMovimientoPorPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaUltimaUbicacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaUltimaUbicacion]
	@IdPaciente [int],
	@IdServicio [int] OUTPUT
WITH EXECUTE AS CALLER
AS
set @IdServicio = 0



select @IdServicio = IdServicioDestino from MovimientosHistoriaClinica

                where IdPaciente = @IdPaciente and FechaMovimiento in (

                select top 1 FechaMovimiento from MovimientosHistoriaClinica

                where IdPaciente = @IdPaciente

                order by FechaMovimiento desc)
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaUltimaUbicacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriaClinicaXidPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriaClinicaXidPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT top 1 IdMovimiento from MovimientosHistoriaClinica
            where IdPaciente = @IdPaciente  order by FechaMovimiento desc
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriaClinicaXidPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriasClinicasDetallePorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriasClinicasDetallePorIdPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select null as IdMovimientoHistoria, null as IdHistoriaSolicitada,
Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
Pacientes.ApellidoPaterno + ' ' + Pacientes.ApellidoMaterno + ' ' + Pacientes.PrimerNombre as Nombres,
null as FechaSolicitud,
null as FechaRequerida,
0 as NroFolios,
(select IdServicioDestino from MovimientosHistoriaClinica
                where IdPaciente = Pacientes.IdPaciente and FechaMovimiento in (
                select top 1 FechaMovimiento from MovimientosHistoriaClinica
                where IdPaciente = Pacientes.IdPaciente
                order by FechaMovimiento desc) ) as IdServicioOrigen ,
(select Servicios.Nombre from MovimientosHistoriaClinica
left join Servicios on Servicios.IdServicio = MovimientosHistoriaClinica.IdServicioDestino
                where IdPaciente = Pacientes.IdPaciente and FechaMovimiento in (
                select top 1 FechaMovimiento from MovimientosHistoriaClinica
                where IdPaciente = Pacientes.IdPaciente
                order by FechaMovimiento desc) ) as NombreServicioOrigen ,
null as IdServicioDestino, null as NombreServicioDestino
from Pacientes
where
Pacientes.IdPaciente = @idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriasClinicasDetallePorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriasClinicasParaDevolver]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriasClinicasParaDevolver]
	@idServicioDestino [int],
	@FechaMovimiento [char](10),
	@IdUsuario [int]
WITH EXECUTE AS CALLER
AS
DECLARE PacientesCursor CURSOR
FOR SELECT IdPaciente from MovimientosHistoriaClinica where
convert(varchar(10), FechaMovimiento, 103) = @FechaMovimiento and IdServicioDestino = @IdServicioDestino

OPEN PacientesCursor
declare @IdPaciente int
declare @IdMovimiento int

delete from tempMovimientos where IdUsuario = @IdUsuario

FETCH NEXT FROM PacientesCursor INTO @IdPaciente
WHILE (@@FETCH_STATUS <> -1)
BEGIN
   IF (@@FETCH_STATUS <> -2)
   BEGIN
	SELECT top 1 @IdMovimiento = IdMovimiento from MovimientosHistoriaClinica where IdPaciente = @IdPaciente order by FechaMovimiento desc
	insert into tempMovimientos values (@IdMovimiento, @IdUsuario)
END
   FETCH NEXT FROM PacientesCursor INTO @IdPaciente
END


CLOSE PacientesCursor
DEALLOCATE PacientesCursor

select MovimientosHistoriaClinica.IdMovimiento as IdMovimientoHistoria, 0 as IdHistoriaSolicitada,
Pacientes.IdPaciente, Pacientes.NroHistoriaClinica, Pacientes.IdTipoNumeracion as IdTipoHistoria,
Pacientes.ApellidoPaterno + ' ' + Pacientes.ApellidoMaterno + ' ' + Pacientes.PrimerNombre as Nombres,
Null as FechaSolicitud,
Null as FechaRequerida,
MovimientosHistoriaClinica.NroFolios,
ServicioDestino.IdServicio as IdServicioOrigen, ServicioDestino.Nombre as NombreServicioOrigen,
340 as IdServicioDestino, 'Archivo Clinico' as NombreServicioDestino
from ((tempMovimientos
left join MovimientosHistoriaClinica on tempMovimientos.IdMovimiento = MovimientosHistoriaClinica.IdMovimiento)
left join Pacientes on Pacientes.IdPaciente = MovimientosHistoriaClinica.IdPaciente)
left join Servicios as ServicioDestino on ServicioDestino.IdServicio = MovimientosHistoriaClinica.IdServicioDestino
where MovimientosHistoriaClinica.IdServicioDestino  <> 340 and tempMovimientos.Idusuario = @IdUsuario
order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno ,Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriasClinicasParaDevolver] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriasClinicasParaDevolverPacienteHospitalizado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriasClinicasParaDevolverPacienteHospitalizado]
	@idPaciente [int],
	@fechaHoy [datetime],
	@idEmpleadoArchivo [int]
WITH EXECUTE AS CALLER
AS
if @idEmpleadoArchivo=0
        select *  from MovimientosHistoriaClinica
        where IdPaciente = @IdPaciente and FechaMovimiento<=@fechaHoy
        order by FechaMovimiento desc
else
        select *  from MovimientosHistoriaClinica
        where IdPaciente = @IdPaciente and FechaMovimiento<=@fechaHoy and idEmpleadoArchivo=@idEmpleadoArchivo
        order by FechaMovimiento desc
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriasClinicasParaDevolverPacienteHospitalizado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MovimientosHistoriasClinicasPorIdGrupo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[MovimientosHistoriasClinicasPorIdGrupo]
	@IdGrupo [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.MovimientosHistoriaClinica.IdMovimiento AS IdMovimientoHistoria, dbo.HistoriasSolicitadas.IdHistoriaSolicitada, dbo.Pacientes.IdPaciente,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.IdTipoNumeracion AS IdTipoHistoria,
                      dbo.Pacientes.ApellidoPaterno + ' ' + dbo.Pacientes.ApellidoMaterno + ' ' + dbo.Pacientes.PrimerNombre AS Nombres, CONVERT(char(10),
                      dbo.HistoriasSolicitadas.FechaSolicitud, 103) + ' ' + dbo.HistoriasSolicitadas.HoraSolicitud AS FechaSolicitud, CONVERT(char(10),
                      dbo.HistoriasSolicitadas.FechaRequerida, 103) + ' ' + dbo.HistoriasSolicitadas.HoraRequerida AS FechaRequerida,
                      dbo.MovimientosHistoriaClinica.NroFolios, ServicioOrigen.IdServicio AS IdServicioOrigen, ServicioOrigen.Nombre AS NombreServicioOrigen,
                      ServicioDestino.IdServicio AS IdServicioDestino, ServicioDestino.Nombre AS NombreServicioDestino,
                      dbo.MovimientosHistoriaClinica.IdPaciente AS Expr1,dbo.MovimientosHistoriaClinica.IdAtencion
FROM         dbo.MovimientosHistoriaClinica LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.MovimientosHistoriaClinica.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.HistoriasSolicitadas ON dbo.MovimientosHistoriaClinica.IdMovimiento = dbo.HistoriasSolicitadas.IdMovimiento LEFT OUTER JOIN
                      dbo.Servicios ServicioDestino ON ServicioDestino.IdServicio = dbo.MovimientosHistoriaClinica.IdServicioDestino LEFT OUTER JOIN
                      dbo.Servicios ServicioOrigen ON ServicioOrigen.IdServicio = dbo.MovimientosHistoriaClinica.IdServicioOrigen
where
MovimientosHistoriaClinica.IdGrupoMovimiento = @IdGrupo
GO
ALTER AUTHORIZATION ON [dbo].[MovimientosHistoriasClinicasPorIdGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MuerteFetalSeleccionarPorAnioYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MuerteFetalSeleccionarPorAnioYMes]
	@Anio [int],
	@Mes [char](2),
	@Departamento [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.AtencionesNacimientos.idnacimiento FROM Pacientes, Atenciones, AtencionesNacimientos, Especialidades, DepartamentosHospital, Servicios
WHERE dbo.atenciones.idAtencion IN (SELECT dbo.AtencionesDiagnosticos.idAtencion FROM AtencionesDiagnosticos
WHERE (dbo.AtencionesDiagnosticos.IdSubclasificacionDx='306' OR dbo.AtencionesDiagnosticos.IdSubclasificacionDx='307')
GROUP BY dbo.AtencionesDiagnosticos.idAtencion) AND dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
AND dbo.Atenciones.IdAtencion = dbo.AtencionesNacimientos.IdAtencion AND dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento
AND dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad AND dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
AND Atenciones.IdTipoServicio = 3 AND dbo.Atenciones.FechaEgreso IS NOT NULL AND YEAR(dbo.Atenciones.FechaEgreso)=@Anio AND MONTH(dbo.Atenciones.FechaEgreso)=@Mes
AND Atenciones.idEstadoAtencion<>0 AND dbo.AtencionesNacimientos.idCondicionRN='2' AND dbo.DepartamentosHospital.IdDepartamento=@Departamento
GO
ALTER AUTHORIZATION ON [dbo].[MuerteFetalSeleccionarPorAnioYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[MuerteNeoNatalSeleccionarPorAnioYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[MuerteNeoNatalSeleccionarPorAnioYMes]
	@Anio [int],
	@Mes [char](2),
	@Departamento [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.FechaEgreso, dbo.pacientes.FechaNacimiento, DATEDIFF(day, dbo.pacientes.FechaNacimiento, dbo.Atenciones.FechaEgreso) AS Diferencia
FROM Pacientes, Atenciones, Especialidades, DepartamentosHospital, Servicios
WHERE dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento
AND dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad AND dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio AND Atenciones.IdTipoServicio = 3
AND atenciones.idCondicionAlta='4' AND dbo.Atenciones.FechaEgreso IS NOT NULL AND YEAR(dbo.Atenciones.FechaEgreso)=@Anio AND MONTH(dbo.Atenciones.FechaEgreso)=@Mes
AND Atenciones.idEstadoAtencion<>0 AND dbo.DepartamentosHospital.IdDepartamento=@Departamento --AND Diferencia<=7
GO
ALTER AUTHORIZATION ON [dbo].[MuerteNeoNatalSeleccionarPorAnioYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NacidosVivosSeleccionarPorAnioYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[NacidosVivosSeleccionarPorAnioYMes]
	@Anio [int],
	@Mes [char](2),
	@Departamento [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.AtencionesNacimientos.idnacimiento
FROM Pacientes, Atenciones, AtencionesNacimientos, Especialidades, DepartamentosHospital, Servicios
WHERE dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion = dbo.AtencionesNacimientos.IdAtencion
AND dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento AND dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad
AND dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio AND Atenciones.IdTipoServicio = 3 AND dbo.Atenciones.FechaEgreso IS NOT NULL
AND YEAR(dbo.Atenciones.FechaEgreso)=@Anio AND MONTH(dbo.Atenciones.FechaEgreso)=@Mes
AND Atenciones.idEstadoAtencion<>0 AND dbo.AtencionesNacimientos.idCondicionRN='1' AND dbo.DepartamentosHospital.IdDepartamento=@Departamento --GROUP BY dbo.AtencionesNacimientos.idnacimiento
GO
ALTER AUTHORIZATION ON [dbo].[NacidosVivosSeleccionarPorAnioYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NombreServicioPorCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[NombreServicioPorCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio
FROM dbo.Atenciones LEFT OUTER JOIN  dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
WHERE dbo.Atenciones.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[NombreServicioPorCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NombreServicioPorCuentaAtencionConexion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[NombreServicioPorCuentaAtencionConexion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio
FROM dbo.Atenciones LEFT OUTER JOIN  dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
WHERE dbo.Atenciones.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[NombreServicioPorCuentaAtencionConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NombreServicioPorCuentaAtencionConexionExiste]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[NombreServicioPorCuentaAtencionConexionExiste]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.Atenciones.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio
FROM dbo.Atenciones LEFT OUTER JOIN dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
WHERE dbo.Atenciones.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[NombreServicioPorCuentaAtencionConexionExiste] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NombreServicioPorCuentaAtencionExiste]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[NombreServicioPorCuentaAtencionExiste]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.Atenciones.*, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio
FROM dbo.Atenciones LEFT OUTER JOIN dbo.Servicios ON dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio
WHERE dbo.Atenciones.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[NombreServicioPorCuentaAtencionExiste] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoBuscaPorIdComprobante]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoBuscaPorIdComprobante]
	@IdComprobante [int]
WITH EXECUTE AS CALLER
AS
select * from NotaCreditoDebito
where IdComprobantePago=@IdComprobante
and IdEstadoNota<>2
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoBuscaPorIdComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoConsultarCitaPorNCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoConsultarCitaPorNCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select c.IdCita,c.Fecha,c.HoraInicio,c.HoraFin,c.IdAtencion,c.FechaSolicitud,c.IdServicio,s.Nombre as Servicio,c.IdMedico,
e.Nombres,e.ApellidoPaterno,e.ApellidoMaterno
from citas c inner join Atenciones A on c.IdAtencion=a.IdAtencion
inner join Servicios s on c.IdServicio=s.IdServicio
inner join Medicos M on c.IdMedico=m.IdMedico
inner join Empleados E on m.IdEmpleado=E.IdEmpleado
where a.IdCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoConsultarCitaPorNCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoConsultarOrdenServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoConsultarOrdenServicio]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select cp.NroSerie, cp.NroDocumento, * from FactOrdenServicio fs inner join FactOrdenServicioPagos fp on fs.IdOrden=fp.idOrden
inner join CajaComprobantesPago cp on fp.idComprobantePago=cp.IdComprobantePago
where cp.IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoConsultarOrdenServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoAgregar]
	@IdNota [int] OUTPUT,
	@IdComprobantePago [int],
	@IdTipoNota [int],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](12),
	@RazonSocial [varchar](50),
	@RUC [char](11),
	@SubTotal [money],
	@IGV [money],
	@Total [money],
	@IdUsuarioAutoriza [int],
	@FechaAprueba [datetime],
	@TipoCambio [money],
	@Observaciones [varchar](500),
	@IdEstadoNota [int],
	@FechaPagado [datetime],
	@IdGestionCaja [int],
	@IdPaciente [int],
	@IdCajero [int],
	@idTurno [int],
	@idCaja [int],
	@idFarmacia [int],
	@idMotivo [int],
	@Direccion [varchar](50),
	@TipoAnulacion [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into NotaCreditoDebito (
IdComprobantePago,IdTipoNota,NroSerie,NroDocumento,RazonSocial,RUC,SubTotal,IGV,Total,IdUsuarioAutoriza,FechaAprueba,TipoCambio,Observaciones,IdEstadoNota,
FechaPagado,IdGestionCaja,IdPaciente,IdCajero,idTurno,idCaja,idFarmacia,idMotivo,Direccion,TipoAnulacion) values
(
@IdComprobantePago,@IdTipoNota,@NroSerie,@NroDocumento,@RazonSocial,@RUC,@SubTotal,@IGV,@Total,@IdUsuarioAutoriza,@FechaAprueba,@TipoCambio,@Observaciones,@IdEstadoNota,
@FechaPagado,@IdGestionCaja,@IdPaciente,@IdCajero,@idTurno,@idCaja,@idFarmacia,@idMotivo,@Direccion,@TipoAnulacion)
set @IdNota = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdNota,'NotaCreditoDebito'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoCargarEstadoNotaCredito]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoCargarEstadoNotaCredito]
WITH EXECUTE AS CALLER
AS
select * from NotaCreditoDebitoEstadoNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoCargarEstadoNotaCredito] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoCargarMotivo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoCargarMotivo]
WITH EXECUTE AS CALLER
AS
select IdMotivo,Motivo from NotaCreditoDebitoMotivo
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoCargarMotivo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoEliminar]
	@IdNota [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from NotaCreditoDebito
where IdNota = @IdNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoModificar]
	@IdNota [int],
	@IdComprobantePago [int],
	@IdTipoNota [int],
	@NroSerie [varchar](4),
	@NroDocumento [varchar](12),
	@RazonSocial [varchar](50),
	@RUC [char](11),
	@SubTotal [money],
	@IGV [money],
	@Total [money],
	@IdUsuarioAutoriza [int],
	@FechaAprueba [datetime],
	@TipoCambio [money],
	@Observaciones [varchar](500),
	@IdEstadoNota [int],
	@FechaPagado [datetime],
	@IdGestionCaja [int],
	@IdPaciente [int],
	@IdCajero [int],
	@idTurno [int],
	@idCaja [int],
	@idFarmacia [int],
	@idMotivo [int],
	@Direccion [varchar](50),
	@TipoAnulacion [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update NotaCreditoDebito
set
IdComprobantePago = @IdComprobantePago,
IdTipoNota = @IdTipoNota,
NroSerie = @NroSerie,
NroDocumento = @NroDocumento,
RazonSocial = @RazonSocial,
RUC = @RUC,

SubTotal = @SubTotal,
IGV = @IGV,
Total = @Total,
IdUsuarioAutoriza = @IdUsuarioAutoriza,
FechaAprueba = @FechaAprueba,
TipoCambio = @TipoCambio,
Observaciones = @Observaciones,
IdEstadoNota = @IdEstadoNota,

FechaPagado = @FechaPagado,
IdGestionCaja = @IdGestionCaja,
IdPaciente = @IdPaciente,
IdCajero = @IdCajero,
idTurno = @idTurno,
idCaja = @idCaja,
idFarmacia = @idFarmacia,
idMotivo = @idMotivo,

Direccion = @Direccion,
TipoAnulacion = @TipoAnulacion
 where IdNota = @IdNota

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdNota,'NotaCreditoDebito'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoSeleccionarNumeroNota]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoSeleccionarNumeroNota]
	@IdTipoNota [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM NotaCreditoDebitoNroDocumento
WHERE IDTIPONOTA=@IdTipoNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoSeleccionarNumeroNota] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoSeleccionarPorId]
	@IdNota [int]
WITH EXECUTE AS CALLER
AS
select * from NotaCreditoDebito
where IdNota = @IdNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoSeleccionarPorIdComprobante]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoSeleccionarPorIdComprobante]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
select * from NotaCreditoDebito where IdComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoSeleccionarPorIdComprobante] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoSeleccionarPorNroSerie]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoSeleccionarPorNroSerie]
	@NroSerie [varchar](4),
	@IdTipoComprobante [int]
WITH EXECUTE AS CALLER
AS
select N.*,T.NroSerie as NroSerieTipo, T.NroDocumentoInicial as NroDocInicioTipo,
T.NroDocumentoFinal as NroDocFinalTipo, T.NroDocumento as NroDocUltimoTipo,c.IdTipoComprobante
from NotaCreditoDebito N
inner join NotaCreditoDebitoTipoNota T on N.IdTipoNota=T.IdTipoNota
inner join CajaComprobantesPago c on n.IdComprobantePago=c.IdComprobantePago
where N.IdTipoNota=2
and N.NroSerie=@NroSerie and c.IdTipoComprobante=@IdTipoComprobante
order by IdNota desc
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoSeleccionarPorNroSerie] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoTipoNotaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoTipoNotaAgregar]
	@IdTipoNota [int],
	@TipoNota [varchar](50),
	@NroSerie [char](4),
	@NroDocumento [char](12),
	@NroDocumentoInicial [char](12),
	@NroDocumentoFinal [char](12),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into NotaCreditoDebitoTipoNota (
IdTipoNota,TipoNota,NroSerie,NroDocumento,NroDocumentoInicial,NroDocumentoFinal) values
 (
@IdTipoNota,@TipoNota,@NroSerie,@NroDocumento,@NroDocumentoInicial,@NroDocumentoFinal)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoNota,'NotaCreditoDebitoNroDocumento'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoTipoNotaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoTipoNotaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoTipoNotaEliminar]
	@IdTipoNota [nchar](1),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from NotaCreditoDebitoTipoNota
where IdTipoNota = @IdTipoNota

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoNota,'NotaCreditoDebitoNroDocumento'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoTipoNotaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoTipoNotaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoTipoNotaModificar]
	@IdTipoNota [int],
	@TipoNota [varchar](50),
	@NroSerie [char](4),
	@NroDocumento [char](12),
	@NroDocumentoInicial [char](12),
	@NroDocumentoFinal [char](12),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update NotaCreditoDebitoTipoNota
set
TipoNota = @TipoNota,
NroSerie = @NroSerie,
NroDocumento = @NroDocumento,
NroDocumentoInicial = @NroDocumentoInicial,
NroDocumentoFinal = @NroDocumentoFinal
where IdTipoNota = @IdTipoNota
and TipoNota=@TipoNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoTipoNotaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoTipoNotaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoTipoNotaSeleccionarPorId]
	@IdTipoNota [nchar](1),
	@TipoCompNota [nchar](1)
WITH EXECUTE AS CALLER
AS
select * from NotaCreditoDebitoTipoNota
where IdTipoNota = @IdTipoNota
and TipoNota=@TipoCompNota
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoTipoNotaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDebitoUltimoDcto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDebitoUltimoDcto]
	@nroSerie [varchar](4)
WITH EXECUTE AS CALLER
AS
select NroDocumento  from NotaCreditoDebito
where  NroSerie =@nroSerie order by NroDocumento desc
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDebitoUltimoDcto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoDevueltosPorNumYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoDevueltosPorNumYFecha]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@FDesde [datetime],
	@FHasta [datetime]
WITH EXECUTE AS CALLER
AS
select c.Descripcion as Caja, t.Descripcion as Turno,N.FechaPagado as Fecha, N.NroSerie,N.NroDocumento,
P.NroHistoriaClinica,N.RazonSocial,N.Total,'' as IdCuentaAtencion,E.EstadoNota as Estado,Em.ApellidoPaterno as CajeroApPat,
Em.ApellidoMaterno as CajeroApMat, Em.Nombres as CajeroNombres,N.idCaja,N.IdCajero,N.idTurno,n.idFarmacia
from NotaCreditoDebito N
inner join CajaCaja c on N.idCaja=c.IdCaja
inner join CajaTurno t on N.idTurno=T.IdTurno
left join Pacientes P on N.IdPaciente=P.IdPaciente
inner join NotaCreditoDebitoEstadoNota E on N.IdEstadoNota=E.IdEstado
inner join Empleados Em on N.IdCajero=Em.IdEmpleado
where N.NroSerie like @NroSerie + '%'
and N.NroDocumento like @NroDocumento +'%'
and (N.FechaPagado between @FDesde and @FHasta)
and N.IdEstadoNota=3
order by IdNota desc
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoDevueltosPorNumYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoFarmNotaIngreso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoFarmNotaIngreso]
	@DocumentoNumero [varchar](20)
WITH EXECUTE AS CALLER
AS
select distinct M.MovNumero,M.MovTipo,M.idAlmacenDestino,A.descripcion,M.DocumentoIdtipo,M.Total,M.fechaCreacion,M.idEstadoMovimiento
from farmMovimientoDetalle D
inner join FarmMovimiento M on M.MovNumero=D.MovNumero
inner join farmAlmacen A on M.idAlmacenDestino=A.idAlmacen
where D.DocumentoNumero=@DocumentoNumero and m.idEstadoMovimiento=1
and M.MovTipo='E'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoFarmNotaIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoParaSunatPorNumYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoParaSunatPorNumYFecha]
	@FDesde [datetime],
	@FHasta [datetime],
	@nSerie [char](4),
	@nDocumento [char](12)
WITH EXECUTE AS CALLER
AS
if @nSerie=''
	select N.*,c.NroSerie as serieComprAfectado,c.NroDocumento as NroComprAfectado,c.IdTipoComprobante,c.RUC as RucComprAfec,c.RazonSocial  as RazonSocialComprAfec, c.IdPaciente as IdPacienteComprAfec,c.IdTipoOrden
	from NotaCreditoDebito N
	inner join CajaComprobantesPago C ON N.IdComprobantePago=C.IdComprobantePago
	where (N.FechaPagado between @FDesde and @FHasta)
	and N.IdEstadoNota=3
	order by IdNota desc
else
	select N.*,c.NroSerie as serieComprAfectado,c.NroDocumento as NroComprAfectado,c.IdTipoComprobante,c.RUC as RucComprAfec,c.RazonSocial  as RazonSocialComprAfec, c.IdPaciente as IdPacienteComprAfec,c.IdTipoOrden
	from NotaCreditoDebito N
	inner join CajaComprobantesPago C ON N.IdComprobantePago=C.IdComprobantePago
	where n.NroSerie =@nSerie and n.NroDocumento=@nDocumento
	and N.IdEstadoNota=3
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoParaSunatPorNumYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoRegistrosTotalesPorNumero]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoRegistrosTotalesPorNumero]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8)
WITH EXECUTE AS CALLER
AS
select N.IdNota,N.IdEstadoNota,N.NroSerie, N.NroDocumento,N.FechaAprueba,N.RazonSocial,N.Direccion,N.RUC,
N.Observaciones,N.Total,E.EstadoNota,N.FechaPagado,M.Motivo,N.idCaja,N.IdCajero,N.idTurno, P.DNI,
ltrim(P.ApellidoPaterno) + ' ' + ltrim(P.ApellidoMaterno) + ' ' + ltrim(P.Nombres) as EmpleadoAutoriza
from NotaCreditoDebito N
inner join NotaCreditoDebitoTipoNota T on N.IdTipoNota=T.IdTipoNota
inner join NotaCreditoDebitoEstadoNota E on N.IdEstadoNota=E.IdEstado
inner join NotaCreditoDebitoMotivo M on N.idMotivo=M.IdMotivo
inner join Empleados P on P.IdEmpleado=N.IdUsuarioAutoriza
where N.NroSerie like @NroSerie + '%'
and N.NroDocumento like @NroDocumento +'%'
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoRegistrosTotalesPorNumero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[NotaCreditoRegistrosTotalesPorNumYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[NotaCreditoRegistrosTotalesPorNumYFecha]
	@NroSerie [varchar](4),
	@NroDocumento [varchar](8),
	@RazonSocial [varchar](20),
	@FDesde [datetime],
	@FHasta [datetime]
WITH EXECUTE AS CALLER
AS
select N.IdNota,N.IdEstadoNota,T.TipoNota + ': ' + N.NroSerie + '-' + N.NroDocumento as 'Documento',N.FechaAprueba,
rtrim(tc.Descripcion) + ': ' + C.NroSerie + '-' + C.NroDocumento + + ' [' + rtrim(N.RazonSocial) COLLATE Modern_Spanish_CS_AS + ']' as 'Comprobante Afectado',
c.FechaCobranza as FComprobAfectado,N.Observaciones,N.Total,E.EstadoNota,p.ApellidoPaterno + ' ' + p.ApellidoPaterno + ', ' + p.Nombres as Cajero,N.FechaPagado
from NotaCreditoDebito N
inner join NotaCreditoDebitoTipoNota T on N.IdTipoNota=T.IdTipoNota
inner join NotaCreditoDebitoEstadoNota E on N.IdEstadoNota=E.IdEstado
inner join CajaComprobantesPago C on N.IdComprobantePago=C.IdComprobantePago
inner join CajaTiposComprobante tc on C.IdTipoComprobante=tc.IdTipoComprobante and T.TipoNota=tc.IdTipoComprobante
left join Empleados P on N.IdCajero=P.IdEmpleado
where N.NroSerie like @NroSerie + '%'
and N.NroDocumento like @NroDocumento +'%'
and N.RazonSocial like '%' + @RazonSocial +'%'
and (CONVERT (char(10), N.FechaAprueba, 102)  between CONVERT (char(10), @FDesde, 102) AND CONVERT (char(10), @FHasta, 102))
order by IdNota desc
GO
ALTER AUTHORIZATION ON [dbo].[NotaCreditoRegistrosTotalesPorNumYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[novafis_edadesSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[novafis_edadesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from novafis_edades
GO
ALTER AUTHORIZATION ON [dbo].[novafis_edadesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ObtenerCabeceraDeMovimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ObtenerCabeceraDeMovimiento]
	@IdGrupoMovimiento [int]
WITH EXECUTE AS CALLER
AS
select distinct IdEmpleadoArchivo, IdEmpleadoTransporte, IdEmpleadoRecepcion, IdMotivo, FechaMovimiento
From MovimientosHistoriaClinica
Where IdGrupoMovimiento = @IdGrupoMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[ObtenerCabeceraDeMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ObtenerHistoriasClinicasDeEsteMovimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ObtenerHistoriasClinicasDeEsteMovimiento]
	@IdGrupoMovimiento [int]
WITH EXECUTE AS CALLER
AS
select MovimientosHistoriaClinica.IdPaciente,
                ServiciosDestino.IdServicio as IdServicioDestino,
                ServiciosDestino.Nombre as ServicioDestino,
                Pacientes.NroHistoriaClinica,
                Pacientes.ApellidoPaterno, PAcientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
                MovimientosHistoriaClinica.IdServicioOrigen, Servicios.Nombre as ServicioOrigen,
                MovimientosHistoriaClinica.NroFolios,
                HistoriasSolicitadas.FechaRequerida,MotivosMovimientoHistoria.Descripcion AS Motivo
                from (((MovimientosHistoriaClinica
                left join Pacientes on MovimientosHistoriaClinica.IdPaciente = Pacientes.IdPaciente)
                left join Servicios on MovimientosHistoriaClinica.IdServicioOrigen = Servicios.IdServicio)
                left join Servicios as ServiciosDestino on MovimientosHistoriaClinica.IdServicioDestino = ServiciosDestino.IdServicio)
                left join HistoriasSolicitadas on MovimientosHistoriaClinica.IdMovimiento =  HistoriasSolicitadas.IdMovimiento
                LEFT JOIN MotivosMovimientoHistoria ON MovimientosHistoriaClinica.IdMotivo = MotivosMovimientoHistoria.IdMotivo
                Where
                MovimientosHistoriaClinica.IdGrupoMovimiento = @IdGrupoMovimiento
                 order by ServiciosDestino.IdServicio, Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[ObtenerHistoriasClinicasDeEsteMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ObtenerListaCodigosProductosHisPorCodigoyNombre]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ObtenerListaCodigosProductosHisPorCodigoyNombre]
	@codigodiagcpt [varchar](20),
	@descripciondiagcpt [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT * FROM HIS_FACTCATALOGOSERVICIOS
where codigodiagcpt  like @codigodiagcpt + '%' and  descripciondiagcpt like @descripciondiagcpt + '%'
GO
ALTER AUTHORIZATION ON [dbo].[ObtenerListaCodigosProductosHisPorCodigoyNombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[OPCsActualizarDesdeOpcsBDFoxPorCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[OPCsActualizarDesdeOpcsBDFoxPorCodigo]
	@Codigo [char](7),
	@Descripcion [varchar](255)
WITH EXECUTE AS CALLER
AS
DECLARE @IdOpcs as integer

IF EXISTS(select * from Opcs WHERE Codigo=@Codigo )
	BEGIN
		update Opcs set
		Descripcion = @Descripcion
		where Codigo=@Codigo
	END
ELSE
	BEGIN
		select  @IdOpcs =count(*) + 1 from Opcs

		insert into Opcs (idOpcs,Descripcion,Codigo)
		values (@IdOpcs,@Descripcion,@Codigo)
	END
GO
ALTER AUTHORIZATION ON [dbo].[OPCsActualizarDesdeOpcsBDFoxPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[OpcsSeleccionarPorCPT]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[OpcsSeleccionarPorCPT]
	@codigoCpt [varchar](7)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.OPCS.Codigo AS opcsCodigo,
                      dbo.OPCS.Descripcion AS opcsDescripcion
FROM         dbo.FactCatalogoServicios LEFT OUTER JOIN
                      dbo.OPCS ON dbo.FactCatalogoServicios.idOpcs = dbo.OPCS.IdOPCS
WHERE  dbo.FactCatalogoServicios.Codigo=@codigoCpt
GO
ALTER AUTHORIZATION ON [dbo].[OpcsSeleccionarPorCPT] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[OpcsSeleccionarTodo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[OpcsSeleccionarTodo]
WITH EXECUTE AS CALLER
AS
select * from Opcs
GO
ALTER AUTHORIZATION ON [dbo].[OpcsSeleccionarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarAtencionPacienteSSES]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesActualizarAtencionPacienteSSES]
	@IdPaciente [int],
	@FechaIngreso [datetime],
	@Edad [int],
	@IdTipoEdad [int]
WITH EXECUTE AS CALLER
AS
declare @NroHistoriaClinica int
declare @TipoEdad char(1)

	if @IdTipoEdad = 1
		set @TipoEdad = 'A'
	if @IdTipoEdad = 2
		set @TipoEdad = 'M'
	if @IdTipoEdad = 3
		set @TipoEdad = 'D'


	select @NroHistoriaClinica = NroHistoriaClinica from Pacientes
	where IdPaciente = @IdPaciente

	print @NroHistoriaClinica

	update SESS.dbo.oeiPacientes
	set
	Edad = @Edad,
	TipoEdad = @TipoEdad,
	FechaDeIngreso = @FechaIngreso
	where  NroHistoriaClinica = @NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarAtencionPacienteSSES] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarDNI]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesActualizarDNI]
	@lnIdPaciente [int],
	@nroDocumento [varchar](12),
	@idtipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
update pacientes set NroDocumento =@nroDocumento, iddocidentidad=1,  IdTipoNumeracion =@idtipoNumeracion   where idPaciente=@lnIdPaciente
update HistoriasClinicas  set IdTipoNumeracion =@idtipoNumeracion   where idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarDNI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarGrupoSanYfactorRH]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesActualizarGrupoSanYfactorRH]
	@lnIdPaciente [int],
	@lcGrupoSanguineo [varchar](10),
	@lcFactorRh [varchar](10)
WITH EXECUTE AS CALLER
AS
update pacientes set GrupoSanguineo=@lcGrupoSanguineo, FactorRh=@lcFactorRh where idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarGrupoSanYfactorRH] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarNroHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesActualizarNroHistoriaClinica]
	@NroHistoriaNew [int],
	@NroHistoriaActual [int]
WITH EXECUTE AS CALLER
AS
update pacientes
set NroHistoriaClinica=@NroHistoriaNew
where nroHistoriaClinica=@NroHistoriaActual
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarNroHistoriaYTipoNumeracion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesActualizarNroHistoriaYTipoNumeracion]
	@NroHistoriaClinica [int],
	@IdTipoNumeracion [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
Update Pacientes
     set NroHistoriaClinica = @NroHistoriaClinica
     ,IdTipoNumeracion = @IdTipoNumeracion
     where IdPaciente = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarNroHistoriaYTipoNumeracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesActualizarPacienteSSES]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesActualizarPacienteSSES]
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@SegundoNombre [varchar](40),
	@FechaNacimiento [datetime],
	@Autogenerado [varchar](30),
	@DireccionDomicilio [varchar](50),
	@IdTipoSexo [int],
	@NroHistoriaClinica [int],
	@IdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
declare @Sexo char(1)

if @IdTipoNumeracion <> 1 and @IdTipoNumeracion <> 2 and @IdTipoNumeracion <> 3
	return

if @IdTipoSexo = 1
	begin
	set @Sexo='M'
	end
else
	begin
	set @Sexo = 'F'
	end

if (select count (*) from SESS.dbo.oeiPacientes where NroHistoriaClinica = @NroHistoriaClinica)  >0
begin
	print 'xxupdate'
	update SESS.dbo.oeiPacientes
	set
	Establecimiento = '05195',
	Autogenerado = @Autogenerado,
	ApellidoPaterno = @ApellidoPaterno,
	ApellidoMaterno = @ApellidoMaterno,
	PrimerNombre = @PrimerNombre,
	UltimoNombre = @SegundoNombre,
	FechaDeNacimiento = @FechaNacimiento,
	Sexo = @Sexo
	where  NroHistoriaClinica = @NroHistoriaClinica

end
else
begin
	print 'xxinsert'
	insert into SESS.dbo.oeiPacientes
	(HistoriaClinica, NroHistoriaClinica, Establecimiento, Autogenerado,ApellidoPaterno,ApellidoMaterno,PrimerNombre,UltimoNombre, FechaDeNacimiento,Sexo,Nombres)
	values
	( right('000000000' + convert(varchar(9), @NroHistoriaClinica),9), @NroHistoriaClinica, '05195', @Autogenerado, @ApellidoPaterno, @ApellidoMaterno, @PrimerNombre, @SegundoNombre,  @FechaNacimiento, @Sexo, @PrimerNombre)
end
GO
ALTER AUTHORIZATION ON [dbo].[PacientesActualizarPacienteSSES] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesAdicionaAutogeneradoHoraNacimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesAdicionaAutogeneradoHoraNacimiento]
WITH EXECUTE AS CALLER
AS
update pacientes set  autogenerado=ltrim(autogenerado)+left(convert(varchar(20),fechaNacimiento,14),5) where len(autogenerado)<20
GO
ALTER AUTHORIZATION ON [dbo].[PacientesAdicionaAutogeneradoHoraNacimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesAgregar]
	@IdPaisNacimiento [int],
	@ApellidoMaterno [varchar](40),
	@DireccionDomicilio [varchar](100),
	@Observacion [varchar](150),
	@IdTipoNumeracion [int],
	@IdPaisProcedencia [int],
	@IdPaciente [int] OUTPUT,
	@ApellidoPaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@SegundoNombre [varchar](40),
	@TercerNombre [varchar](40),
	@FechaNacimiento [datetime],
	@NroDocumento [varchar](12),
	@Telefono [varchar](10),
	@Autogenerado [varchar](30),
	@IdTipoSexo [int],
	@IdProcedencia [int],
	@IdGradoInstruccion [int],
	@IdEstadoCivil [int],
	@IdDocIdentidad [int],
	@IdTipoOcupacion [int],
	@IdCentroPobladoDomicilio [int],
	@NombrePadre [varchar](20),
	@NombreMadre [varchar](20),
	@IdPaisDomicilio [int],
	@NroHistoriaClinica [int],
	@IdCentroPobladoNacimiento [int],
	@IdCentroPobladoProcedencia [int],
	@IdDistritoProcedencia [int],
	@IdDistritoDomicilio [int],
	@IdDistritoNacimiento [int],
	@FichaFamiliar [varchar](20),
	@IdEtnia [varchar](2),
	@GrupoSanguineo [varchar](10),
	@FactorRh [varchar](10),
	@UsoWebReniec [bit],
	@validacionReniec [bit],
	@IdIdioma [int],
	@Email [varchar](50),
	@madreDocumento [varchar](12),
	@madreApellidoPaterno [varchar](20),
	@madreApellidoMaterno [varchar](20),
	@madrePrimerNombre [varchar](20),
	@madreSegundoNombre [varchar](20),
	@NroOrdenHijo [int],
	@madreTipoDocumento [int],
	@sector [varchar](2),
	@sectorista [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Pacientes (
	IdPaisNacimiento,ApellidoMaterno,DireccionDomicilio,Observacion,IdTipoNumeracion,IdPaisProcedencia,ApellidoPaterno,PrimerNombre,SegundoNombre,
	TercerNombre,FechaNacimiento,NroDocumento,Telefono,Autogenerado,IdTipoSexo,IdProcedencia,IdGradoInstruccion,IdEstadoCivil,IdDocIdentidad,
	IdTipoOcupacion,
	IdCentroPobladoDomicilio,NombrePadre,NombreMadre,IdPaisDomicilio,NroHistoriaClinica,
	IdCentroPobladoNacimiento,IdCentroPobladoProcedencia,IdDistritoProcedencia,IdDistritoDomicilio,IdDistritoNacimiento,FichaFamiliar,IdEtnia,GrupoSanguineo,FactorRh,UsoWebReniec,validacionReniec,IdIdioma,Email,
	madreDocumento,madreApellidoPaterno,madreApellidoMaterno,madrePrimerNombre,
	madreSegundoNombre,NroOrdenHijo,madreTipoDocumento,sector,sectorista
	) values (
	@IdPaisNacimiento,@ApellidoMaterno,@DireccionDomicilio,@Observacion,@IdTipoNumeracion,@IdPaisProcedencia,@ApellidoPaterno,@PrimerNombre,@SegundoNombre,
	@TercerNombre,@FechaNacimiento,@NroDocumento,@Telefono,@Autogenerado,@IdTipoSexo,@IdProcedencia,@IdGradoInstruccion,@IdEstadoCivil,@IdDocIdentidad,
	@IdTipoOcupacion,
	@IdCentroPobladoDomicilio,@NombrePadre,@NombreMadre,@IdPaisDomicilio,@NroHistoriaClinica,
	@IdCentroPobladoNacimiento,@IdCentroPobladoProcedencia,@IdDistritoProcedencia,@IdDistritoDomicilio,@IdDistritoNacimiento,@FichaFamiliar,@IdEtnia,@GrupoSanguineo,@FactorRh,@UsoWebReniec,@validacionReniec,@IdIdioma,@Email,
	@madreDocumento,@madreApellidoPaterno,@madreApellidoMaterno,@madrePrimerNombre
	,@madreSegundoNombre,@NroOrdenHijo,@madreTipoDocumento,@sector,@sectorista

	)
	set @IdPaciente = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[PacientesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesAgregarPorHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesAgregarPorHistoriaClinica]
	@IdPaciente [int] OUTPUT,
	@NroHistoriaClinica [int],
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@SegundoNombre [varchar](40),
	@IdTipoSexo [int],
	@FechaNacimiento [datetime],
	@IdTipoNumeracion [int],
	@Autogenerado [varchar](30),
	@IdDistritoDomicilio [int],
	@DireccionDomicilio [varchar](100),
	@NroDocumento [varchar](8),
	@IdDocIdentidad [int],
	@NombrePadre [varchar](20),
	@NombreMadre [varchar](20),
	@IdPaisDomicilio [int],
	@IdPaisProcedencia [int],
	@IdPaisNacimiento [int],
	@FichaFamiliar [varchar](20)
WITH EXECUTE AS CALLER
AS
INSERT INTO PACIENTES (NroHistoriaClinica,ApellidoPaterno,ApellidoMaterno,PrimerNombre,SegundoNombre,
					IdTipoSexo,FechaNacimiento,IdTipoNumeracion,Autogenerado,IdDistritoDomicilio,
					DireccionDomicilio,NroDocumento,IdDocIdentidad,NombrePadre,NombreMadre,
					IdPaisDomicilio,IdPaisProcedencia,IdPaisNacimiento,FichaFamiliar)
	VALUES (@NroHistoriaClinica,@ApellidoPaterno,@ApellidoMaterno,@PrimerNombre,@SegundoNombre,
	@IdTipoSexo,@FechaNacimiento,@IdTipoNumeracion,@Autogenerado,@IdDistritoDomicilio,
	@DireccionDomicilio,@NroDocumento,@IdDocIdentidad,@NombrePadre,@NombreMadre,
	@IdPaisDomicilio,@IdPaisProcedencia,@IdPaisNacimiento,@FichaFamiliar)

	set @IdPaciente = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[PacientesAgregarPorHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesAtencionesSeleccionarPorID]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesAtencionesSeleccionarPorID]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.FechaNacimiento, dbo.Atenciones.FechaIngreso, dbo.Atenciones.HoraIngreso, dbo.Atenciones.IdPaciente
FROM         dbo.Pacientes RIGHT OUTER JOIN
                     dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
WHERE dbo.Atenciones.IdAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesAtencionesSeleccionarPorID] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesBuscarEneMal]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesBuscarEneMal]
	@EneMal [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from pacientes where (ApellidoPaterno like '%' + @EneMal + '%') or (ApellidoMaterno like '%' + @EneMal + '%')
			or (PrimerNombre like '%' + @EneMal + '%') or (SegundoNombre like '%' + @EneMal + '%')
			or (DireccionDomicilio LIKE '%' + @EneMal + '%') or (NroDocumento LIKE '%' + @EneMal + '%')
GO
ALTER AUTHORIZATION ON [dbo].[PacientesBuscarEneMal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesConHistoriasTemporales]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesConHistoriasTemporales]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.TiposNumeracionHistoria.Descripcion, dbo.Pacientes.ApellidoPaterno,
                     dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.FechaNacimiento
FROM         dbo.Pacientes LEFT OUTER JOIN
                     dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
Where (dbo.Pacientes.IdTipoNumeracion > 3)
ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesConHistoriasTemporales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesConsultarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesConsultarTodos]
WITH EXECUTE AS CALLER
AS
Select * from Pacientes
GO
ALTER AUTHORIZATION ON [dbo].[PacientesConsultarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesAgregar]
	@idPaciente [int],
	@antecedentes [varchar](1000),
	@antecedAlergico [varchar](1000),
	@antecedObstetrico [varchar](1000),
	@antecedQuirurgico [varchar](1000),
	@antecedFamiliar [varchar](1000),
	@antecedPatologico [varchar](1000),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PacientesDatosAdicionales (
idPaciente,antecedentes,antecedAlergico,antecedObstetrico,antecedQuirurgico,antecedFamiliar,antecedPatologico
) values (
@idPaciente,@antecedentes,@antecedAlergico,@antecedObstetrico,@antecedQuirurgico,@antecedFamiliar,@antecedPatologico
)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPaciente,'PacientesDatosAdicionales'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesEliminar]
	@idPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PacientesDatosAdicionales
where idPaciente = @idPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPaciente,'PacientesDatosAdicionales'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesModificar]
	@idPaciente [int],
	@antecedentes [varchar](1000),
	@antecedAlergico [varchar](1000),
	@antecedObstetrico [varchar](1000),
	@antecedQuirurgico [varchar](1000),
	@antecedFamiliar [varchar](1000),
	@antecedPatologico [varchar](1000),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PacientesDatosAdicionales
set
antecedentes = @antecedentes,
antecedAlergico=@antecedAlergico,
antecedObstetrico=@antecedObstetrico ,
antecedQuirurgico=@antecedQuirurgico ,
antecedFamiliar=@antecedFamiliar ,
antecedPatologico=@antecedPatologico
where idPaciente = @idPaciente
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPaciente,'PacientesDatosAdicionales'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesPersonalesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesPersonalesAgregar]
	@IdPaciente [int],
	@FNacimientoCalculada [bit]
WITH EXECUTE AS CALLER
AS
IF NOT EXISTS(SELECT 1 FROM PacientesDatosAdicionales WHERE idPaciente = @IdPaciente)
	BEGIN
		INSERT INTO PacientesDatosAdicionales(idPaciente, FNacimientoCalculada)
		VALUES(@IdPaciente, @FNacimientoCalculada);
	END
	ELSE
	BEGIN
		UPDATE PacientesDatosAdicionales SET
			FNacimientoCalculada = @FNacimientoCalculada
		WHERE idPaciente = @IdPaciente;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesPersonalesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesSeleccionarPorId]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from PacientesDatosAdicionales
where idPaciente = @idPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosAdicionalesSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesDatosAdicionalesSeleccionarPorIdPaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PacientesDatosAdicionales.*, dbo.Pacientes.*
             FROM         dbo.Pacientes LEFT OUTER JOIN
                                  dbo.PacientesDatosAdicionales ON dbo.Pacientes.IdPaciente = dbo.PacientesDatosAdicionales.idPaciente
             Where dbo.Pacientes.idPaciente = @lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosAdicionalesSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesDatosParaImpresionFiliacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesDatosParaImpresionFiliacion]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, Distritos_1.Nombre AS NacDistrito,
                      Provincias_1.Nombre AS NacProvincia, Departamentos_1.Nombre AS NacDpto, dbo.TiposOcupacion.descripcion AS TipoOcupacion,
                      dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.NroDocumento, Distritos_2.Nombre AS DomicilioDistrito, dbo.Pacientes.NombrePadre,
                      dbo.Pacientes.NombreMadre, LTRIM(dbo.Pacientes.madreApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.madreApellidoMaterno)
                      + ' ' + dbo.Pacientes.madrePrimerNombre AS ANmadre, Provincias_2.Nombre AS DomProvincia, Departamentos_2.Nombre AS DomDpto,
                      dbo.Pacientes.Telefono, dbo.Pacientes.Email, dbo.Pacientes.GrupoSanguineo, dbo.Pacientes.FactorRh,
                      dbo.TiposGradoInstruccion.Descripcion AS dGradoInst, dbo.TiposIdiomas.Lengua AS dIdioma, dbo.TiposEstadoCivil.Descripcion AS EstadoCivil,
                      dbo.HIS_tabetnia.desetni AS Etnia, Distritos_3.Nombre AS ProcedDistrito, Provincias_3.Nombre AS ProcedProvincia,
                      Departamentos_3.Nombre AS ProcedDpto, dbo.Pacientes.Observacion
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.TiposEstadoCivil ON dbo.Pacientes.IdEstadoCivil = dbo.TiposEstadoCivil.IdEstadoCivil LEFT OUTER JOIN
                      dbo.Distritos Distritos_1 INNER JOIN
                      dbo.Provincias Provincias_1 ON Distritos_1.IdProvincia = Provincias_1.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_1 ON Provincias_1.IdDepartamento = Departamentos_1.IdDepartamento ON
                      dbo.Pacientes.IdDistritoNacimiento = Distritos_1.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias Provincias_2 INNER JOIN
                      dbo.Distritos Distritos_2 ON Provincias_2.IdProvincia = Distritos_2.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_2 ON Provincias_2.IdDepartamento = Departamentos_2.IdDepartamento ON
                      dbo.Pacientes.IdDistritoDomicilio = Distritos_2.IdDistrito LEFT OUTER JOIN
                      dbo.Departamentos Departamentos_3 INNER JOIN
                      dbo.Provincias Provincias_3 ON Departamentos_3.IdDepartamento = Provincias_3.IdDepartamento INNER JOIN
                      dbo.Distritos Distritos_3 ON Provincias_3.IdProvincia = Distritos_3.IdProvincia ON
                      dbo.Pacientes.IdDistritoProcedencia = Distritos_3.IdDistrito LEFT OUTER JOIN
                      dbo.HIS_tabetnia ON dbo.Pacientes.IdEtnia = dbo.HIS_tabetnia.codetni LEFT OUTER JOIN
                      dbo.TiposIdiomas ON dbo.Pacientes.IdIdioma = dbo.TiposIdiomas.IdIdioma LEFT OUTER JOIN
                      dbo.TiposGradoInstruccion ON dbo.Pacientes.IdGradoInstruccion = dbo.TiposGradoInstruccion.IdGradoInstruccion LEFT OUTER JOIN
                      dbo.TiposOcupacion ON dbo.Pacientes.IdTipoOcupacion = dbo.TiposOcupacion.IdTipoOcupacion


             where dbo.Pacientes.idPaciente=@lnIdPaciente   */

/*SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, Distritos_1.Nombre AS NacDistrito,
                      Provincias_1.Nombre AS NacProvincia, Departamentos_1.Nombre AS NacDpto, dbo.TiposOcupacion.descripcion AS TipoOcupacion,
                      dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.NroDocumento, Distritos_2.Nombre AS DomicilioDistrito, dbo.Pacientes.NombrePadre,
                      dbo.Pacientes.NombreMadre, LTRIM(dbo.Pacientes.madreApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.madreApellidoMaterno)
                      + ' ' + dbo.Pacientes.madrePrimerNombre AS ANmadre, Provincias_2.Nombre AS DomProvincia, Departamentos_2.Nombre AS DomDpto,
                      dbo.Pacientes.Telefono, dbo.Pacientes.Email, dbo.Pacientes.GrupoSanguineo, dbo.Pacientes.FactorRh,
                      dbo.CentrosPoblados.IdCentroPoblado AS IdCentroPobladoDomicilio, dbo.CentrosPoblados.Nombre AS CentroPobladoDomicilio,
                      dbo.TiposGradoInstruccion.Descripcion AS dGradoInst, dbo.TiposIdiomas.Lengua AS dIdioma, dbo.TiposEstadoCivil.Descripcion AS EstadoCivil,
                      dbo.HIS_tabetnia.desetni AS Etnia, Distritos_3.Nombre AS ProcedDistrito, Provincias_3.Nombre AS ProcedProvincia,
                      Departamentos_3.Nombre AS ProcedDpto, dbo.Pacientes.Observacion
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.TiposEstadoCivil ON dbo.Pacientes.IdEstadoCivil = dbo.TiposEstadoCivil.IdEstadoCivil LEFT OUTER JOIN
                      dbo.Distritos Distritos_1 INNER JOIN
                      dbo.Provincias Provincias_1 ON Distritos_1.IdProvincia = Provincias_1.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_1 ON Provincias_1.IdDepartamento = Departamentos_1.IdDepartamento ON
                      dbo.Pacientes.IdDistritoNacimiento = Distritos_1.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias Provincias_2 INNER JOIN
                      dbo.Distritos Distritos_2 ON Provincias_2.IdProvincia = Distritos_2.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_2 ON Provincias_2.IdDepartamento = Departamentos_2.IdDepartamento ON
                      dbo.Pacientes.IdDistritoDomicilio = Distritos_2.IdDistrito LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoDomicilio = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Departamentos Departamentos_3 INNER JOIN
                      dbo.Provincias Provincias_3 ON Departamentos_3.IdDepartamento = Provincias_3.IdDepartamento INNER JOIN
                      dbo.Distritos Distritos_3 ON Provincias_3.IdProvincia = Distritos_3.IdProvincia ON
                      dbo.Pacientes.IdDistritoProcedencia = Distritos_3.IdDistrito LEFT OUTER JOIN
                      dbo.HIS_tabetnia ON dbo.Pacientes.IdEtnia = dbo.HIS_tabetnia.codetni LEFT OUTER JOIN
                      dbo.TiposIdiomas ON dbo.Pacientes.IdIdioma = dbo.TiposIdiomas.IdIdioma LEFT OUTER JOIN
                      dbo.TiposGradoInstruccion ON dbo.Pacientes.IdGradoInstruccion = dbo.TiposGradoInstruccion.IdGradoInstruccion LEFT OUTER JOIN
                      dbo.TiposOcupacion ON dbo.Pacientes.IdTipoOcupacion = dbo.TiposOcupacion.IdTipoOcupacion
where dbo.Pacientes.idPaciente=@lnIdPaciente  */


SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, Distritos_1.Nombre AS NacDistrito,
                      Provincias_1.Nombre AS NacProvincia, Departamentos_1.Nombre AS NacDpto, dbo.TiposOcupacion.descripcion AS TipoOcupacion,
                      dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.NroDocumento,dbo.Pacientes.madreDocumento, Distritos_2.Nombre AS DomicilioDistrito, dbo.Pacientes.NombrePadre,
                      dbo.Pacientes.NombreMadre, LTRIM(dbo.Pacientes.madreApellidoPaterno) + ' ' + LTRIM(dbo.Pacientes.madreApellidoMaterno) as ApellidosMadre,
                      dbo.Pacientes.madrePrimerNombre + ' ' + dbo.Pacientes.madreSegundoNombre AS ANmadre, Provincias_2.Nombre AS DomProvincia, Departamentos_2.Nombre AS DomDpto,
                      dbo.Pacientes.Telefono, dbo.Pacientes.Email, dbo.Pacientes.GrupoSanguineo, dbo.Pacientes.FactorRh,
                      dbo.CentrosPoblados.IdCentroPoblado AS IdCentroPobladoDomicilio, dbo.CentrosPoblados.Nombre AS CentroPobladoDomicilio,
                      dbo.TiposGradoInstruccion.Descripcion AS dGradoInst, dbo.TiposDocIdentidad.Descripcion AS TiposDocIdentidad,dbo.TiposIdiomas.Lengua AS dIdioma, dbo.TiposEstadoCivil.Descripcion AS EstadoCivil,
                      dbo.HIS_tabetnia.desetni AS Etnia, Distritos_3.Nombre AS ProcedDistrito, Provincias_3.Nombre AS ProcedProvincia,
                      Departamentos_3.Nombre AS ProcedDpto, dbo.Pacientes.Observacion,  dbo.Pacientes.FichaFamiliar As fichafam,
                      ISNULL(dbo.PacientesDatosAdicionales.FNacimientoCalculada, 0) AS FNacimientoCalculada

FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.TiposEstadoCivil ON dbo.Pacientes.IdEstadoCivil = dbo.TiposEstadoCivil.IdEstadoCivil LEFT OUTER JOIN
                      dbo.Distritos Distritos_1 INNER JOIN
                      dbo.Provincias Provincias_1 ON Distritos_1.IdProvincia = Provincias_1.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_1 ON Provincias_1.IdDepartamento = Departamentos_1.IdDepartamento ON
                      dbo.Pacientes.IdDistritoNacimiento = Distritos_1.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias Provincias_2 INNER JOIN
                      dbo.Distritos Distritos_2 ON Provincias_2.IdProvincia = Distritos_2.IdProvincia INNER JOIN
                      dbo.Departamentos Departamentos_2 ON Provincias_2.IdDepartamento = Departamentos_2.IdDepartamento ON
                      dbo.Pacientes.IdDistritoDomicilio = Distritos_2.IdDistrito LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoDomicilio = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Departamentos Departamentos_3 INNER JOIN
                      dbo.Provincias Provincias_3 ON Departamentos_3.IdDepartamento = Provincias_3.IdDepartamento INNER JOIN
                      dbo.Distritos Distritos_3 ON Provincias_3.IdProvincia = Distritos_3.IdProvincia ON
                      dbo.Pacientes.IdDistritoProcedencia = Distritos_3.IdDistrito LEFT OUTER JOIN
                      dbo.HIS_tabetnia ON dbo.Pacientes.IdEtnia = dbo.HIS_tabetnia.codetni LEFT OUTER JOIN
                      dbo.TiposIdiomas ON dbo.Pacientes.IdIdioma = dbo.TiposIdiomas.IdIdioma LEFT OUTER JOIN
                      dbo.TiposGradoInstruccion ON dbo.Pacientes.IdGradoInstruccion = dbo.TiposGradoInstruccion.IdGradoInstruccion LEFT OUTER JOIN
                      dbo.TiposOcupacion ON dbo.Pacientes.IdTipoOcupacion = dbo.TiposOcupacion.IdTipoOcupacion LEFT OUTER JOIN
                      dbo.TiposDocIdentidad ON dbo.TiposDocIdentidad.IdDocIdentidad = dbo.Pacientes.IdDocIdentidad
                      LEFT OUTER JOIN dbo.PacientesDatosAdicionales ON dbo.PacientesDatosAdicionales.IdPaciente = dbo.Pacientes.IdPaciente
where dbo.Pacientes.idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesDatosParaImpresionFiliacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesEliminar]
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from HistoriasSolicitadas where IdPaciente = @IdPaciente
delete from MovimientosHistoriaClinica where IdPaciente = @IdPaciente
delete from Pacientes where IdPaciente = @IdPaciente


--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPaciente,'Pacientes'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesEliminarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesEliminarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
Delete from Pacientes where idpaciente=@IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesEliminarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFacturacionCuentasAtencionSeleccionarXIdCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFacturacionCuentasAtencionSeleccionarXIdCuentaAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.NroHistoriaClinica, dbo.FacturacionCuentasAtencion.IdPaciente
FROM        dbo.Pacientes RIGHT OUTER JOIN
	     dbo.FacturacionCuentasAtencion ON dbo.Pacientes.IdPaciente = dbo.FacturacionCuentasAtencion.IdPaciente
Where (Not (dbo.Pacientes.NroHistoriaClinica Is Null)) and dbo.FacturacionCuentasAtencion.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFacturacionCuentasAtencionSeleccionarXIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltraPorApellidosYnombre]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltraPorApellidosYnombre]
	@ap [varchar](40),
	@am [varchar](40),
	@PN [varchar](40)
WITH EXECUTE AS CALLER
AS
SELECT * FROM  pacientes WHERE ApellidoPaterno=@ap AND apellidomaterno=@am AND primerNombre=@PN
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltraPorApellidosYnombre] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltraPorNroDocumentoYtipo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltraPorNroDocumentoYtipo]
	@nroDocumento [varchar](12),
	@idDocIdentidad [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where nroDocumento=@nroDocumento and idDocIdentidad=@idDocIdentidad
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltraPorNroDocumentoYtipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarConHistoriasDefinitivas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarConHistoriasDefinitivas]
	@NroHistoriaClinica [int],
	@apellidoPaterno [varchar](40),
	@apellidoMaterno [varchar](40),
	@primerNombre [varchar](40),
	@dni [varchar](12),
	@FichaFamiliar [varchar](20)
WITH EXECUTE AS CALLER
AS
declare @filtroAP varchar(100)
declare @filtroAM varchar(100)
declare @filtroPN varchar(100)
declare @filtroFF varchar(50)
select @filtroAP=@apellidoPaterno+'%'
select @filtroAM=@apellidoMaterno+'%'
select @filtroPN=@PrimerNombre+'%'
select @filtroFF=@fichaFamiliar+'%'
if @NroHistoriaClinica>0
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE      (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.NroHistoriaClinica=@NroHistoriaClinica
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
   if @FichaFamiliar<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE      (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.FichaFamiliar like @filtroFF
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
     if @dni>0
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE      (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.NroDocumento=@dni and dbo.Pacientes.idDocIdentidad=1
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
      if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.ApellidoPaterno like @filtroAP and
		 dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
      if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre=''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.ApellidoPaterno like @filtroAP
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
      if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre=''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.ApellidoPaterno like @filtroAP and
		dbo.Pacientes.ApellidoMaterno like @filtroAM
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
      if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.IdTipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3)) and dbo.Pacientes.ApellidoPaterno like @filtroAP and
			 dbo.Pacientes.PrimerNombre like @filtroPN
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarConHistoriasDefinitivas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarConHistoriasTemporales]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarConHistoriasTemporales]
	@NroHistoriaClinica [int],
	@apellidoPaterno [varchar](40),
	@apellidoMaterno [varchar](40),
	@primerNombre [varchar](40),
	@dni [varchar](12),
	@FichaFamiliar [varchar](20)
WITH EXECUTE AS CALLER
AS
declare @filtroAP varchar(150)
declare @filtroAM varchar(150)
declare @filtroPN varchar(150)
declare @filtroFF varchar(50)
select @filtroAP=@apellidoPaterno+'%'
select @filtroAM=@apellidoMaterno+'%'
select @filtroPN=@PrimerNombre+'%'
select @filtroFF=@fichaFamiliar+'%'
if @NroHistoriaClinica>0
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
            WHERE      (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.NroHistoriaClinica=@NroHistoriaClinica
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
    if @FichaFamiliar<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
            WHERE      (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.FichaFamiliar like @filtroFF
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
     if @dni<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
            WHERE      (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.NroDocumento=@dni and dbo.Pacientes.idDocIdentidad=1
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
       if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion>3) and

                                 dbo.Pacientes.ApellidoPaterno like @filtroAP and
                                 dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
       if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre=''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.ApellidoPaterno like @filtroAP
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
       if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre=''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.ApellidoPaterno like @filtroAP and
                                  dbo.Pacientes.ApellidoMaterno like @filtroAM
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
       if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento,
	                      dbo.TiposNumeracionHistoria.IdTipoNumeracion AS IdTipoNumeracion, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion,dbo.Pacientes.NroDocumento,dbo.Pacientes.idDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion
             WHERE       (dbo.Pacientes.IdTipoNumeracion >3) and dbo.Pacientes.ApellidoPaterno like @filtroAP and
                                 dbo.Pacientes.PrimerNombre like @filtroPN
             order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarConHistoriasTemporales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarHistoriasParaAdmision]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarHistoriasParaAdmision]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select Pacientes.IdPaciente, Pacientes.IdTipoGeneracion ,
Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre,
Pacientes.SegundoNombre , Pacientes.NroHistoriaClinica, TiposGeneracionHistoria.Descripcion
from Pacientes left join TiposGeneracionHistoria
on Pacientes.IdTipoGeneracion = TiposGeneracionHistoria.IdTipoGeneracionNroHistoria
where Pacientes.NroHistoriaClinica = @NroHistoriaClinica
order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarHistoriasParaAdmision] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarParaReporteHistoriaCE]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarParaReporteHistoriaCE]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes
where
IdPaciente = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarParaReporteHistoriaCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarTodos]
	@NroHistoriaClinica [int],
	@apellidoPaterno [varchar](40),
	@apellidoMaterno [varchar](40),
	@primerNombre [varchar](40),
	@segundoNombre [varchar](40),
	@idDocIdentidad [int],
	@NroDocumento [varchar](12),
	@FichaFamiliar [varchar](20)
WITH EXECUTE AS CALLER
AS
declare @filtroAP varchar(150)
declare @filtroAM varchar(150)
declare @filtroPN varchar(150)
declare @filtroSN varchar(150)
declare @filtroFF varchar(50)
select @filtroAP=@apellidoPaterno+'%'
select @filtroAM=@apellidoMaterno+'%'
select @filtroPN=@PrimerNombre+'%'
select @filtroSN=@SegundoNombre+'%'
select @filtroFF=@fichaFamiliar+'%'
if @NroHistoriaClinica>0
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,  dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
	                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
	                          (SELECT     MAX(IdAtencion)
	                            FROM          Atenciones
	                            WHERE  Atenciones.idEstadoAtencion <>0 and    Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
            WHERE      dbo.Pacientes.NroHistoriaClinica=@NroHistoriaClinica
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
     if @FichaFamiliar<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
	                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
	                          (SELECT     MAX(IdAtencion)
	                            FROM          Atenciones
	                            WHERE    Atenciones.idEstadoAtencion <>0 and    Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
            WHERE      dbo.Pacientes.FichaFamiliar like @filtroFF
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
        if @NroDocumento<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
	                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
	                          (SELECT     MAX(IdAtencion)
	                            FROM          Atenciones
	                            WHERE    Atenciones.idEstadoAtencion <>0 and    Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
            WHERE      dbo.Pacientes.NroDocumento=@NroDocumento and dbo.Pacientes.idDocIdentidad=@idDocIdentidad
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
        else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>'' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE   Atenciones.idEstadoAtencion <>0 and     Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	             WHERE       dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
                                            and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre='' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE   Atenciones.idEstadoAtencion <>0 and     Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	             WHERE       dbo.Pacientes.ApellidoPaterno like @filtroAP
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre='' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE    Atenciones.idEstadoAtencion <>0 and    Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	             WHERE       dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>'' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE   Atenciones.idEstadoAtencion <>0 and     Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	             WHERE       dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>''  and @apellidoMaterno='' and @primerNombre<>'' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre,  dbo.DNI_HISTORIAdevuelveSIN9(dbo.Pacientes.NroHistoriaClinica) as nroHistoriaClinica, dbo.Pacientes.fichaFamiliar,dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE  Atenciones.idEstadoAtencion <>0 and     Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio
	             WHERE       dbo.Pacientes.ApellidoPaterno like @filtroAP  and dbo.Pacientes.PrimerNombre like @filtroPN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarTodosSoloHistoriasDefinit_rap]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarTodosSoloHistoriasDefinit_rap]
	@NroHistoriaClinica [int],
	@apellidoPaterno [varchar](40),
	@apellidoMaterno [varchar](40),
	@primerNombre [varchar](40),
	@segundoNombre [varchar](40),
	@idDocIdentidad [int],
	@NroDocumento [varchar](12),
	@FechaNacimiento [datetime],
	@IdTipoSexo [varchar](1)
WITH EXECUTE AS CALLER
AS
BEGIN
  SET NOCOUNT ON;

  DECLARE @sql        NVARCHAR(MAX);
  DECLARE @paramList  NVARCHAR(MAX);

  SET @sql = '
    SELECT
      P.IdPaciente,
      P.ApellidoPaterno,
      P.ApellidoMaterno,
      P.PrimerNombre,
      P.SegundoNombre,
      P.TercerNombre,
      P.NroHistoriaClinica,
      P.FechaNacimiento,
      P.IdTipoNumeracion,
      P.IdDocIdentidad,
      P.IdTipoSexo,
      P.NroDocumento,

      -- Campos de prioridad para ordenar por coincidencia exacta
      CASE WHEN P.ApellidoPaterno = @apellidoPaterno THEN 0 ELSE 1 END AS PrioridadApellidoPaterno,
      CASE WHEN P.ApellidoMaterno = @apellidoMaterno THEN 0 ELSE 1 END AS PrioridadApellidoMaterno,
      CASE WHEN P.PrimerNombre    = @primerNombre    THEN 0 ELSE 1 END AS PrioridadPrimerNombre
    FROM dbo.Pacientes AS P
    FULL OUTER JOIN dbo.HistoriasClinicas AS H
      ON P.IdPaciente = H.IdPaciente
    WHERE H.idEstadoHistoria = 1
      AND P.IdTipoNumeracion IN (1, 2, 3)';

  SET @paramList = N'@NroHistoriaClinica INT,
                     @apellidoPaterno VARCHAR(40),
                     @apellidoMaterno VARCHAR(40),
                     @primerNombre VARCHAR(40),
                     @segundoNombre VARCHAR(40),
                     @idDocIdentidad INT,
                     @NroDocumento VARCHAR(12),
                     @FechaNacimiento DATETIME,
                     @IdTipoSexo VARCHAR(1)';

  IF @NroHistoriaClinica > 0
  BEGIN
    SET @sql += ' AND P.NroHistoriaClinica = @NroHistoriaClinica';
  END
  ELSE
  BEGIN
    IF @IdTipoSexo <> '9'
      SET @sql += ' AND P.IdTipoSexo = @IdTipoSexo';

    IF @NroDocumento <> ''
      SET @sql += ' AND P.NroDocumento = @NroDocumento
                    AND P.IdDocIdentidad = @idDocIdentidad';

    --  Búsqueda por LIKE, priorizando exactos en ORDER BY
    IF @apellidoPaterno <> ''
      SET @sql += ' AND P.ApellidoPaterno LIKE @apellidoPaterno + ''%''';
    IF @apellidoMaterno <> ''
      SET @sql += ' AND P.ApellidoMaterno LIKE @apellidoMaterno + ''%''';
    IF @primerNombre <> ''
      SET @sql += ' AND P.PrimerNombre LIKE @primerNombre + ''%''';
    IF @segundoNombre <> ''
      SET @sql += ' AND (P.SegundoNombre + '' '' + ISNULL(P.TercerNombre, '''')) LIKE @segundoNombre + ''%''';

    IF @FechaNacimiento IS NOT NULL
      SET @sql += ' AND CAST(P.FechaNacimiento AS DATE) = CAST(@FechaNacimiento AS DATE)';
  END

  --  Orden por prioridad exacta, luego alfabético
  SET @sql += '
    ORDER BY
      PrioridadApellidoPaterno,
      PrioridadApellidoMaterno,
      PrioridadPrimerNombre,
      P.ApellidoPaterno,
      P.ApellidoMaterno,
      P.PrimerNombre,
      P.SegundoNombre;';

  EXEC sp_executesql @sql, @paramList,
       @NroHistoriaClinica = @NroHistoriaClinica,
       @apellidoPaterno = @apellidoPaterno,
       @apellidoMaterno = @apellidoMaterno,
       @primerNombre = @primerNombre,
       @segundoNombre = @segundoNombre,
       @idDocIdentidad = @idDocIdentidad,
       @NroDocumento = @NroDocumento,
       @FechaNacimiento = @FechaNacimiento,
       @IdTipoSexo = @IdTipoSexo;
END
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarTodosSoloHistoriasDefinit_rap] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesFiltrarTodosSoloHistoriasDefinitivas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesFiltrarTodosSoloHistoriasDefinitivas]
	@NroHistoriaClinica [int],
	@apellidoPaterno [varchar](40),
	@apellidoMaterno [varchar](40),
	@primerNombre [varchar](40),
	@segundoNombre [varchar](40),
	@idDocIdentidad [int],
	@NroDocumento [varchar](12)
WITH EXECUTE AS CALLER
AS
declare @filtroAP varchar(150)
declare @filtroAM varchar(150)
declare @filtroPN varchar(150)
declare @filtroSN varchar(150)
select @filtroAP=@apellidoPaterno+'%'
select @filtroAM=@apellidoMaterno+'%'
select @filtroPN=@PrimerNombre+'%'
select @filtroSN=@SegundoNombre+'%'
if @NroHistoriaClinica>0
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre,dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
	                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
	                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
	                          (SELECT     MAX(IdAtencion)
	                            FROM          Atenciones
	                            WHERE     Atenciones.idEstadoAtencion <>0 and    Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
            WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.NroHistoriaClinica=@NroHistoriaClinica
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
else
        if @NroDocumento<>''
	SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
	                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
	                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
	                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
	                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
	FROM         dbo.Pacientes LEFT OUTER JOIN
	                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
	                          (SELECT     MAX(IdAtencion)
	                            FROM          Atenciones
	                            WHERE       Atenciones.idEstadoAtencion <>0 and  Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
	                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
	                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
            WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and dbo.Pacientes.NroDocumento=@NroDocumento and dbo.Pacientes.idDocIdentidad=@idDocIdentidad
           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
        else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>'' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
                                            and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno='' and @primerNombre='' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE    Atenciones.idEstadoAtencion <>0 and     Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre='' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE   Atenciones.idEstadoAtencion <>0 and Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>'' and @apellidoMaterno<>'' and @primerNombre<>'' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE       Atenciones.idEstadoAtencion <>0 and  Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE      dbo.HistoriasClinicas.idEstadoHistoria=1 and  dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP  and  dbo.Pacientes.ApellidoMaterno like @filtroAM and  dbo.Pacientes.PrimerNombre like @filtroPN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
            else
             if  @apellidoPaterno<>''  and @apellidoMaterno='' and @primerNombre<>'' and @segundoNombre=''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP  and dbo.Pacientes.PrimerNombre like @filtroPN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre

--Fitro por ap - am - sn

			else
             if  @apellidoPaterno<>''  and @apellidoMaterno<>'' and @primerNombre='' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP and dbo.Pacientes.ApellidoMaterno like @filtroAM and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
-------------
--Fitro por ap - sn

			else
             if  @apellidoPaterno<>''  and @apellidoMaterno='' and @primerNombre='' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoPaterno like @filtroAP and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
-------------
--Fitro por am - sn

			else
             if  @apellidoPaterno=''  and @apellidoMaterno<>'' and @primerNombre='' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and dbo.Pacientes.ApellidoMaterno like @filtroAM and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
-------------

--Fitro por pn - sn

			else
             if  @apellidoPaterno=''  and @apellidoMaterno='' and @primerNombre<>'' and @segundoNombre<>''
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.PrimerNombre like @filtroPN and dbo.Pacientes.SegundoNombre like @filtroSN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
-------------

	else
		SELECT     dbo.Pacientes.IdPaciente, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
		                      dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.FechaNacimiento, dbo.TiposServicio.Descripcion AS TipoServicio,
		                      dbo.Servicios.Nombre AS ServicioIngreso, dbo.TiposNumeracionHistoria.Descripcion AS TipoNumeracion, dbo.Pacientes.IdTipoNumeracion,
		                      CONVERT(char(10), dbo.Atenciones.FechaIngreso, 103) AS FechaIngreso, CONVERT(char(10), dbo.Atenciones.FechaEgreso, 103) AS FechaEgreso,
		                      dbo.HistoriasClinicas.IdEstadoHistoria, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.NroDocumento,dbo.Pacientes.IdDocIdentidad
		FROM         dbo.Pacientes LEFT OUTER JOIN
		                      dbo.TiposNumeracionHistoria ON dbo.Pacientes.IdTipoNumeracion = dbo.TiposNumeracionHistoria.IdTipoNumeracion LEFT OUTER JOIN
		                      dbo.Atenciones ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND dbo.Atenciones.IdAtencion =
		                          (SELECT     MAX(IdAtencion)
		                            FROM          Atenciones
		                            WHERE      Atenciones.idEstadoAtencion <>0 and   Atenciones.IdPaciente = Pacientes.IdPaciente) LEFT OUTER JOIN
		                      dbo.Servicios ON dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso LEFT OUTER JOIN
		                      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio = dbo.Atenciones.IdTipoServicio FULL OUTER JOIN
		                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
	             WHERE     dbo.HistoriasClinicas.idEstadoHistoria=1 and   dbo.Pacientes.IdTipoNumeracion IN (1, 2, 3) and  dbo.Pacientes.ApellidoMaterno like @filtroAM  and dbo.Pacientes.PrimerNombre like @filtroPN
                           order by Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesFiltrarTodosSoloHistoriasDefinitivas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesIgualDNI]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesIgualDNI]
WITH EXECUTE AS CALLER
AS
declare @NroDocumento1 varchar(12)
    declare @NroHistoriaClinica1 int
    declare @nroHistoriaNew int
    declare @registros int
    select @registros =0
	DECLARE VarCursorDesarrollo CURSOR FOR
	select NroDocumento,NroHistoriaClinica  from pacientes where
                 nroDocumento=right('0000000'+ltrim(convert(varchar(12),nroHistoriaClinica)),8) and
                 NroHistoriaClinica <900000000 and IdTipoNumeracion =2
	OPEN VarCursorDesarrollo
	fetch VarCursorDesarrollo INTO @NroDocumento1,@NroHistoriaClinica1
	while(@@fetch_status=0)
	begin
		select @nroHistoriaNew=convert(int,'9' + Right('0000000000' + rTrim(@NroDocumento1), 8))
		exec HistoriasClinicasActualizarNroHistoriaClinica @nroHistoriaNew, @NroHistoriaClinica1
		exec PacientesActualizarNroHistoriaClinica @nroHistoriaNew, @NroHistoriaClinica1

		--select @registros=@registros+1
		--print @NroDocumento1+' '+convert(varchar(20),@NroHistoriaClinica1)
		fetch VarCursorDesarrollo INTO @NroDocumento1,@NroHistoriaClinica1
	end
    CLOSE VarCursorDesarrollo
	DEALLOCATE VarCursorDesarrollo
GO
ALTER AUTHORIZATION ON [dbo].[PacientesIgualDNI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMenoresAunaEdad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesMenoresAunaEdad]
	@ml_EdadMaxima [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.DNI_HISTORIAdevuelveSIN9(dbo.HistoriasClinicas.NroHistoriaClinica) as nroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
                                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
                                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
                                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
                                              dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
                FROM         dbo.HistoriasClinicas INNER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                      dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
                where         DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<=@ml_EdadMaxima
                 order by     dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMenoresAunaEdad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesModificar]
	@IdPaisNacimiento [int],
	@ApellidoMaterno [varchar](40),
	@DireccionDomicilio [varchar](100),
	@Observacion [varchar](150),
	@IdTipoNumeracion [int],
	@IdPaisProcedencia [int],
	@IdPaciente [int],
	@ApellidoPaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@SegundoNombre [varchar](40),
	@TercerNombre [varchar](40),
	@FechaNacimiento [date],
	@NroDocumento [varchar](12),
	@Telefono [varchar](10),
	@Autogenerado [varchar](30),
	@IdTipoSexo [int],
	@IdProcedencia [int],
	@IdGradoInstruccion [int],
	@IdEstadoCivil [int],
	@IdDocIdentidad [int],
	@IdTipoOcupacion [int],
	@IdCentroPobladoDomicilio [int],
	@NombrePadre [varchar](20),
	@NombreMadre [varchar](20),
	@IdPaisDomicilio [int],
	@NroHistoriaClinica [int],
	@IdCentroPobladoNacimiento [int],
	@IdCentroPobladoProcedencia [int],
	@IdDistritoProcedencia [int],
	@IdDistritoDomicilio [int],
	@IdDistritoNacimiento [int],
	@FichaFamiliar [varchar](20),
	@IdEtnia [varchar](2),
	@GrupoSanguineo [varchar](10),
	@FactorRh [varchar](10),
	@UsoWebReniec [bit],
	@IdIdioma [int],
	@Email [varchar](50),
	@madreDocumento [varchar](12),
	@madreApellidoPaterno [varchar](20),
	@madreApellidoMaterno [varchar](20),
	@madrePrimerNombre [varchar](20),
	@madreSegundoNombre [varchar](20),
	@NroOrdenHijo [int],
	@madreTipoDocumento [int],
	@sector [varchar](2),
	@sectorista [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Pacientes
	set
	IdPaisNacimiento = @IdPaisNacimiento,
	ApellidoMaterno = @ApellidoMaterno,
	DireccionDomicilio = @DireccionDomicilio,
	Observacion = @Observacion,
	IdTipoNumeracion = @IdTipoNumeracion,
	IdPaisProcedencia = @IdPaisProcedencia,
	ApellidoPaterno = @ApellidoPaterno,
	PrimerNombre = @PrimerNombre,
	SegundoNombre = @SegundoNombre,
	TercerNombre = @TercerNombre,
	FechaNacimiento = @FechaNacimiento,
	NroDocumento = @NroDocumento,
	Telefono = @Telefono,
	Autogenerado = @Autogenerado,
	IdTipoSexo = @IdTipoSexo,
	IdProcedencia = @IdProcedencia,
	IdGradoInstruccion = @IdGradoInstruccion,
	IdEstadoCivil = @IdEstadoCivil,
	IdDocIdentidad = @IdDocIdentidad,
	IdTipoOcupacion = @IdTipoOcupacion,
	IdCentroPobladoDomicilio = @IdCentroPobladoDomicilio,
	NombrePadre = @NombrePadre,
	NombreMadre = @NombreMadre,
	IdPaisDomicilio = @IdPaisDomicilio,
	NroHistoriaClinica = @NroHistoriaClinica,
	IdCentroPobladoNacimiento = @IdCentroPobladoNacimiento,
	IdCentroPobladoProcedencia = @IdCentroPobladoProcedencia,
	IdDistritoProcedencia=@IdDistritoProcedencia,
	IdDistritoDomicilio=@IdDistritoDomicilio,
	IdDistritoNacimiento=@IdDistritoNacimiento,
	FichaFamiliar=@FichaFamiliar ,
	IdEtnia=@IdEtnia,
	GrupoSanguineo=@GrupoSanguineo,
	FactorRh=@FactorRh,
	UsoWebReniec=@UsoWebReniec,
	IdIdioma=@IdIdioma,
	Email=@Email,
	madreDocumento=@madreDocumento,
	madreApellidoPaterno=@madreApellidoPaterno,
	madreApellidoMaterno=@madreApellidoMaterno,
	madrePrimerNombre =@madrePrimerNombre ,
	madreSegundoNombre=@madreSegundoNombre,
	NroOrdenHijo=@NroOrdenHijo,
	madreTipoDocumento=@madreTipoDocumento,
	sector=@sector,
	sectorista=@sectorista
	where IdPaciente = @IdPaciente

	--SCCQ 14/02/2020 Cambio4 Inicio
	--El siguiente script actualiza la fecha de nacimiento en el formato FUA de la BD SIGH_EXTERNA
	update FUA set FUA.fnacimiento=CONVERT(varchar,@fechanacimiento,101) from SIGH_EXTERNA.dbo.SisFuaAtencion FUA
	inner join sigh.dbo.FacturacionCuentasAtencion CA on FUA.idCuentaAtencion=CA.IdCuentaAtencion
	where IdPaciente=@IdPaciente and CA.IdEstado=1 -- IdEstado=1 es abierto
	--SCCQ 14/02/2020 Cambio4 Inicio

-- CAMBIO ID 7
GO
ALTER AUTHORIZATION ON [dbo].[PacientesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesModificarDatosEneMal]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesModificarDatosEneMal]
	@IdPaciente [int],
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@DireccionDomicilio [varchar](100),
	@NroDocumento [varchar](12),
	@SegundoNombre [varchar](40)
WITH EXECUTE AS CALLER
AS
UPDATE Pacientes
	SET ApellidoPaterno=@ApellidoPaterno,
	ApellidoMaterno=@ApellidoMaterno,
	PrimerNombre=@PrimerNombre,
	DireccionDomicilio=@DireccionDomicilio,
	NroDocumento=@NroDocumento,
	SegundoNombre=@SegundoNombre
	WHERE IDPACIENTE=@IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesModificarDatosEneMal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesModificarDatosMayusculas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesModificarDatosMayusculas]
	@IdPaciente [int],
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@Autogenerado [varchar](20)
WITH EXECUTE AS CALLER
AS
UPDATE Pacientes
SET ApellidoPaterno=@ApellidoPaterno,
ApellidoMaterno=@ApellidoMaterno,
PrimerNombre=@PrimerNombre,
Autogenerado=@Autogenerado
WHERE IDPACIENTE=@IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesModificarDatosMayusculas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMovimientosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesMovimientosAgregar]
	@IdCuentaAtencion [int],
	@Peso [money],
	@Talla [money],
	@idDiagnostico [int],
	@GrafXedadEnMeses [int],
	@GrafYpercentilTE [int],
	@GrafYpercentilPT [int],
	@GrafYpercentilPE [int],
	@ZetaPT [money],
	@ZetaTE [money],
	@ZetaPE [money],
	@Hemoglobina [money],
	@Parasitosis [varchar](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PacientesMovimientos (
IdCuentaAtencion,Peso,Talla,idDxNutricional,GrafXedadEnMeses,GrafYpercentilTE,GrafYpercentilPT,GrafYpercentilPE,ZetaPT,ZetaTE,ZetaPE,Hemoglobina,Parasitosis) values (
@IdCuentaAtencion,@Peso,@Talla,@idDiagnostico,@GrafXedadEnMeses,@GrafYpercentilTE,@GrafYpercentilPT,@GrafYpercentilPE,@ZetaPT,@ZetaTE,@ZetaPE,@Hemoglobina,@Parasitosis)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCuentaAtencion,'PacientesMovimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMovimientosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesMovimientosEliminar]
	@IdCuentaAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PacientesMovimientos
where IdCuentaAtencion = @IdCuentaAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCuentaAtencion,'PacientesMovimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMovimientosFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesMovimientosFiltro]
	@fechaInicio [datetime],
	@fechaFin [datetime],
	@edadAnios [int],
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
if @idPaciente>0
	SELECT     dbo.Atenciones.FechaIngreso, dbo.Pacientes.NroHistoriaClinica, rtrim(dbo.Pacientes.ApellidoPaterno)+' '+rtrim(dbo.Pacientes.ApellidoMaterno)+' '+
	                      rtrim(dbo.Pacientes.PrimerNombre) as lcPaciente, dbo.PacientesMovimientos.IdCuentaAtencion, dbo.PacientesMovimientos.Peso, dbo.PacientesMovimientos.Talla,
	                      dbo.PacientesMovimientosDx.DxNutricional, dbo.PacientesMovimientos.Hemoglobina, dbo.PacientesMovimientos.Parasitosis, dbo.Atenciones.Edad,
	                      dbo.TiposEdad.Descripcion AS EdadTipo, dbo.TiposSexo.Descripcion AS Sexo,dbo.Pacientes.idtiposexo
	FROM         dbo.PacientesMovimientosDx INNER JOIN
	                      dbo.PacientesMovimientos ON dbo.PacientesMovimientosDx.idDxNutricional = dbo.PacientesMovimientos.idDxNutricional INNER JOIN
	                      dbo.Atenciones ON dbo.PacientesMovimientos.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
	                      dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad INNER JOIN
	                      dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
            WHERE     dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaIngreso BETWEEN @fechaInicio and @fechaFin and
	                   datediff(year, dbo.Pacientes.FechaNacimiento,dbo.Atenciones.FechaIngreso)<=@edadAnios and
                                dbo.Pacientes.idPaciente=@idPaciente
	ORDER BY dbo.Atenciones.FechaIngreso desc, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre

else
	SELECT     dbo.Atenciones.FechaIngreso, dbo.Pacientes.NroHistoriaClinica, rtrim(dbo.Pacientes.ApellidoPaterno)+' '+rtrim(dbo.Pacientes.ApellidoMaterno)+' '+
	                      rtrim(dbo.Pacientes.PrimerNombre) as lcPaciente, dbo.PacientesMovimientos.IdCuentaAtencion, dbo.PacientesMovimientos.Peso, dbo.PacientesMovimientos.Talla,
	                      dbo.PacientesMovimientosDx.DxNutricional, dbo.PacientesMovimientos.Hemoglobina, dbo.PacientesMovimientos.Parasitosis, dbo.Atenciones.Edad,
	                      dbo.TiposEdad.Descripcion AS EdadTipo, dbo.TiposSexo.Descripcion AS Sexo,dbo.Pacientes.idtiposexo
	FROM         dbo.PacientesMovimientosDx INNER JOIN
	                      dbo.PacientesMovimientos ON dbo.PacientesMovimientosDx.idDxNutricional = dbo.PacientesMovimientos.idDxNutricional INNER JOIN
	                      dbo.Atenciones ON dbo.PacientesMovimientos.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente INNER JOIN
	                      dbo.TiposEdad ON dbo.Atenciones.IdTipoEdad = dbo.TiposEdad.IdTipoEdad INNER JOIN
	                      dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
	WHERE     dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.FechaIngreso BETWEEN @fechaInicio and @fechaFin and
	                   datediff(year, dbo.Pacientes.FechaNacimiento,dbo.Atenciones.FechaIngreso)<=@edadAnios
	ORDER BY dbo.Atenciones.FechaIngreso desc, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMovimientosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesMovimientosModificar]
	@IdCuentaAtencion [int],
	@Peso [money],
	@Talla [money],
	@idDiagnostico [int],
	@GrafXedadEnMeses [int],
	@GrafYpercentilTE [int],
	@GrafYpercentilPT [int],
	@GrafYpercentilPE [int],
	@ZetaPT [money],
	@ZetaTE [money],
	@ZetaPE [money],
	@Hemoglobina [money],
	@Parasitosis [varchar](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PacientesMovimientos
set
Peso = @Peso,
Talla = @Talla,
idDxNutricional = @idDiagnostico,
GrafXedadEnMeses = @GrafXedadEnMeses,
GrafYpercentilTE = @GrafYpercentilTE,
GrafYpercentilPT = @GrafYpercentilPT,
GrafYpercentilPE = @GrafYpercentilPE,
ZetaPT = @ZetaPT,
ZetaTE = @ZetaTE,
ZetaPE = @ZetaPE,
Hemoglobina = @Hemoglobina,
Parasitosis = @Parasitosis
where IdCuentaAtencion = @IdCuentaAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCuentaAtencion,'PacientesMovimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesMovimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesMovimientosSeleccionarPorId]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PacientesMovimientos
where IdCuentaAtencion = @IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesMovimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesObtenerConElMismoAutogenerado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesObtenerConElMismoAutogenerado]
	@Autogenerado [varchar](30),
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select IdPaciente, NroHistoriaClinica, IdDocIdentidad, NroDocumento, ApellidoPaterno, ApellidoMaterno, PrimerNombre, SegundoNombre, TercerNombre from Pacientes
     where Autogenerado = @Autogenerado  and
     IdPaciente <> @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesObtenerConElMismoAutogenerado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesObtenerConLaMismaHistoriaDefinitiva]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesObtenerConLaMismaHistoriaDefinitiva]
	@NroHistoriaClinica [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select IdPaciente, NroHistoriaClinica, ApellidoPaterno, ApellidoMaterno, PrimerNombre, SegundoNombre from Pacientes
     Where NroHistoriaClinica = @NroHistoriaClinica  and
     IdTipoNumeracion in (1,2,3) and
     IdPaciente <> @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesObtenerConLaMismaHistoriaDefinitiva] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesObtenerIdPacientePorHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesObtenerIdPacientePorHistoriaClinica]
	@lNroHistoriaClinica [int],
	@lIdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
select IdPaciente from Pacientes
         where NroHistoriaClinica = @lNroHistoriaClinica
         and IdTipoNumeracion = @lIdTipoNumeracion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesObtenerIdPacientePorHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMayor12Menor18]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMayor12Menor18]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=12
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<18
else
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=12
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<18 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMayor12Menor18] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMayor18Menor30]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMayor18Menor30]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=18
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<30
else
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=18
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<30  and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMayor18Menor30] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMayor1menor5]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMayor1menor5]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                  SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=1
                          and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<5
else
                  SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=1
                          and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<5  and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMayor1menor5] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMayor30Menor60]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMayor30Menor60]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=30
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<60
else
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=30
                     and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<60 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMayor30Menor60] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMayor5Menor10]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMayor5Menor10]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=5
                        and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<10
else
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=5
                                 and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<10 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMayor5Menor10] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMenores1anio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMenores1anio]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where    DATEDIFF(day, dbo.Pacientes.FechaNacimiento, getdate())>=29
                          and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<1
else
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where    DATEDIFF(day, dbo.Pacientes.FechaNacimiento, getdate())>=29
                          and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<1  and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMenores1anio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarMujeresEdadFertil]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarMujeresEdadFertil]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=2
                 and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=15
                 and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<50
else
                SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=2
                 and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=15
                 and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<50  and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarMujeresEdadFertil] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveNacimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveNacimiento]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.*, dbo.CentrosPoblados.Nombre AS dCentroPobladoNacim, dbo.Distritos.Nombre AS dDistritoNacim,
                      dbo.Provincias.Nombre AS dProvinciaNacim, dbo.Departamentos.Nombre AS dDptoNacim
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoNacimiento = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Distritos ON dbo.CentrosPoblados.IdDistrito = dbo.Distritos.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias ON dbo.Distritos.IdProvincia = dbo.Provincias.IdProvincia LEFT OUTER JOIN
                      dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento
WHERE     (dbo.Pacientes.NroHistoriaClinica = @NroHistoriaClinica)


--SELECT     dbo.Pacientes.*, CentrosPoblados_2.Nombre AS dCentroPobladoNacim, Distritos_2.Nombre AS dDistritoNacim,
--                      Provincias_2.Nombre AS dProvinciaNacim, Departamentos_2.Nombre AS dDptoNacim
--FROM         dbo.Pacientes LEFT OUTER JOIN
--                      dbo.Departamentos Departamentos_2 ON dbo.Pacientes.IdDepartamentoNacimiento = Departamentos_2.IdDepartamento LEFT OUTER JOIN
--                      dbo.CentrosPoblados CentrosPoblados_2 ON dbo.Pacientes.IdCentroPobladoNacimiento = CentrosPoblados_2.IdCentroPoblado LEFT OUTER JOIN
--                      dbo.Provincias Provincias_2 ON dbo.Pacientes.IdProvinciaNacimiento = Provincias_2.IdProvincia LEFT OUTER JOIN
--                      dbo.Distritos Distritos_2 ON dbo.Pacientes.IdDistritoNacimiento = Distritos_2.IdDistrito
--WHERE     (dbo.Pacientes.NroHistoriaClinica = @NroHistoriaClinica)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveNacimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveProcedencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveProcedencia]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.*, dbo.CentrosPoblados.Nombre AS dCentroPobladoProc, dbo.Distritos.Nombre AS dDistritoProc,
                      dbo.Provincias.Nombre AS dProvinciaProc, dbo.Departamentos.Nombre AS dDptoProc, dbo.TiposOcupacion.descripcion AS dOcupacion
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.TiposOcupacion ON dbo.Pacientes.IdTipoOcupacion = dbo.TiposOcupacion.IdTipoOcupacion LEFT OUTER JOIN
                      dbo.CentrosPoblados ON dbo.Pacientes.IdCentroPobladoProcedencia = dbo.CentrosPoblados.IdCentroPoblado LEFT OUTER JOIN
                      dbo.Distritos ON dbo.CentrosPoblados.IdDistrito = dbo.Distritos.IdDistrito LEFT OUTER JOIN
                      dbo.Provincias ON dbo.Distritos.IdProvincia = dbo.Provincias.IdProvincia LEFT OUTER JOIN
                      dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento
WHERE     (dbo.Pacientes.NroHistoriaClinica = @NroHistoriaClinica)

--SELECT     dbo.Pacientes.*, CentrosPoblados_2.Nombre AS dCentroPobladoProc, Distritos_2.Nombre AS dDistritoProc, Provincias_2.Nombre AS dProvinciaProc,
--                      Departamentos_2.Nombre AS dDptoProc, dbo.TiposOcupacion.descripcion AS dOcupacion
--FROM         dbo.Pacientes LEFT OUTER JOIN
--                      dbo.TiposOcupacion ON dbo.Pacientes.IdTipoOcupacion = dbo.TiposOcupacion.IdTipoOcupacion LEFT OUTER JOIN
--                      dbo.Distritos Distritos_2 ON dbo.Pacientes.IdDistritoProcedencia = Distritos_2.IdDistrito LEFT OUTER JOIN
--                      dbo.CentrosPoblados CentrosPoblados_2 ON dbo.Pacientes.IdCentroPobladoProcedencia = CentrosPoblados_2.IdCentroPoblado LEFT OUTER JOIN
--                      dbo.Departamentos Departamentos_2 ON dbo.Pacientes.IdDepartamentoProcedencia = Departamentos_2.IdDepartamento LEFT OUTER JOIN
--                      dbo.Provincias Provincias_2 ON dbo.Pacientes.IdProvinciaProcedencia = Provincias_2.IdProvincia
--WHERE     (dbo.Pacientes.NroHistoriaClinica = @NroHistoriaClinica)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPoNroHistoriaDevuelveProcedencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorFichaFamiliar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorFichaFamiliar]
	@lcFichaFamiliar [varchar](30)
WITH EXECUTE AS CALLER
AS
select * from pacientes where fichaFamiliar=ltrim(@lcFichaFamiliar)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorFichaFamiliar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorHistoriaClinicaDefinitiva]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorHistoriaClinicaDefinitiva]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes
where IdTipoNumeracion in (1,2,3)
and NroHistoriaClinica = @NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorHistoriaClinicaDefinitiva] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorId]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes
where IdPaciente = @IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorIdentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorIdentificador]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where idPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorIdentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HistoriasClinicas.IdTipoHistoria AS IdTipoHistoria, dbo.TiposHistoriaClinica.Descripcion AS dTipoHistoria, dbo.Pacientes.ApellidoPaterno,
                      dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.TercerNombre,
                      dbo.HistoriasClinicas.NroHistoriaClinica
FROM         dbo.Pacientes LEFT OUTER JOIN
                      dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente LEFT OUTER JOIN
                      dbo.TiposHistoriaClinica ON dbo.HistoriasClinicas.IdTipoHistoria = dbo.TiposHistoriaClinica.IdTipoHistoria
WHERE     (dbo.Pacientes.IdPaciente = @idPaciente)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorIdTipoNumeracion1]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorIdTipoNumeracion1]
WITH EXECUTE AS CALLER
AS
select nroHistoriaClinica  from Pacientes where idTipoNumeracion=1 order by nroHistoriaClinica desc
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorIdTipoNumeracion1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorLongitudNroDocumento8IdTipoSexo2]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorLongitudNroDocumento8IdTipoSexo2]
WITH EXECUTE AS CALLER
AS
SELECT NroDocumento,FechaNacimiento From Pacientes WHERE  (LEN(NroDocumento) = '8') AND (IdTipoSexo = 2)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorLongitudNroDocumento8IdTipoSexo2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorNroHistoria]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorNroHistoria]
	@lnNroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where NroHistoriaClinica=@lnNroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorNroHistoria] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorNroHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorNroHistoriaClinica]
	@NroHistoriaClinica [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where nroHistoriaClinica=@NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorNroHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorNroHistoriaClinicaTop1]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorNroHistoriaClinicaTop1]
WITH EXECUTE AS CALLER
AS
select top 1 nroHistoriaClinica from Pacientes order by nroHistoriaClinica desc
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorNroHistoriaClinicaTop1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarPorSectorComunidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarPorSectorComunidad]
	@lcSectorComunidad [varchar](30),
	@Left [int]
WITH EXECUTE AS CALLER
AS
SELECT       0   as NroHistoriaClinica, dbo.HistoriasClinicas.IdTipoHistoria, LTRIM(dbo.Pacientes.ApellidoPaterno)
                                      + ' ' + LTRIM(dbo.Pacientes.ApellidoMaterno) + ' ' + LTRIM(dbo.Pacientes.PrimerNombre) AS lcPaciente, ISNULL(dbo.Pacientes.SegundoNombre, '')
                                      + ' ' + ISNULL(dbo.Pacientes.TercerNombre, '') AS lcSTnombre, dbo.TiposSexo.Descripcion AS lcSexo, dbo.Pacientes.FichaFamiliar,
                                      dbo.Pacientes.FechaNacimiento, dbo.Pacientes.NroDocumento, dbo.Pacientes.DireccionDomicilio, dbo.Pacientes.Autogenerado,
                                              dbo.Pacientes.telefono,DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate()) AS Edad
                FROM         dbo.HistoriasClinicas INNER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                                      dbo.TiposSexo ON dbo.Pacientes.IdTipoSexo = dbo.TiposSexo.IdTipoSexo
                where         left(dbo.Pacientes.fichaFamiliar,@Left)= @lcSectorComunidad
                 order by     dbo.Pacientes.ApellidoPaterno,dbo.Pacientes.ApellidoMaterno,dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarPorSectorComunidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarRn]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarRn]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where DATEDIFF(day, dbo.Pacientes.FechaNacimiento, getdate())<29
else
                 SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where DATEDIFF(day, dbo.Pacientes.FechaNacimiento, getdate())<29 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarRn] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.HistoriasClinicas.FechaCreacion, dbo.HistoriasClinicas.NroHistoriaClinica, dbo.Pacientes.IdTipoNumeracion,dbo.HistoriasClinicas.IdPaciente, dbo.Pacientes.ApellidoPaterno,
                                  dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre, dbo.Pacientes.NroDocumento,
                                  dbo.Pacientes.IdTipoSexo,dbo.Pacientes.fechaNacimiento,dbo.Pacientes.telefono,dbo.Pacientes.email,dbo.Pacientes.autogenerado
             FROM         dbo.Pacientes INNER JOIN
                                  dbo.HistoriasClinicas ON dbo.Pacientes.IdPaciente = dbo.HistoriasClinicas.IdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarTotalFemenino]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarTotalFemenino]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                SELECT     dbo.Pacientes.idTipoSexo
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=2
else
                SELECT     dbo.Pacientes.idTipoSexo
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=2 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarTotalFemenino] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarTotalMasculino]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarTotalMasculino]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                SELECT     dbo.Pacientes.idTipoSexo
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=1
else
                SELECT     dbo.Pacientes.idTipoSexo
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 where dbo.Pacientes.idTipoSexo=1 and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarTotalMasculino] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSeleccionarXTipoNumeracionHistoriaClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSeleccionarXTipoNumeracionHistoriaClinica]
WITH EXECUTE AS CALLER
AS
Select * from Pacientes where idTipoNumeracion<4 and NroHistoriaClinica IS NULL
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSeleccionarXTipoNumeracionHistoriaClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSelecionarMayor10Menor12]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSelecionarMayor10Menor12]
	@anioCreacion [int]
WITH EXECUTE AS CALLER
AS
if @anioCreacion=0
                  SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=10
                    and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<12
else
                  SELECT     dbo.Pacientes.FechaNacimiento
                 FROM         dbo.HistoriasClinicas LEFT OUTER JOIN
                                      dbo.Pacientes ON dbo.HistoriasClinicas.IdPaciente = dbo.Pacientes.IdPaciente
                 WHERE    DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())>=10
                    and DATEDIFF(year, dbo.Pacientes.FechaNacimiento, getdate())<12  and year(dbo.HistoriasClinicas.fechaCreacion)=@anioCreacion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSelecionarMayor10Menor12] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSePuedeEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesSePuedeEliminar]
	@IdPaciente [int],
	@Respuesta [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @CantidadServicios int
declare @CantidadAtenciones int
declare @CantidadPreVenta int
declare @CantidadMovimientos int
declare  @CantidadSolicitud int
declare  @CantidadBoletas int

	select @CantidadAtenciones = count(*) from Atenciones where  IdPaciente = @IdPaciente
             select @CantidadPreVenta = count(*) from farmPreVenta where  IdPaciente = @IdPaciente
             select @CantidadMovimientos = count(*) from MovimientosHistoriaClinica where IdPaciente = @IdPaciente
             select @CantidadSolicitud = count(*) from HistoriasSolicitadas where IdPaciente = @IdPaciente
             select @CantidadServicios = count(*) from FactOrdenServicio where  IdPaciente = @IdPaciente
             select @CantidadBoletas = count(*) from CajaComprobantesPago where  IdPaciente = @IdPaciente

	if (@CantidadServicios > 0 or @CantidadAtenciones > 0 or @CantidadPreVenta>0 or @CantidadMovimientos>0 or  @CantidadSolicitud>0 or @CantidadBoletas>0)
	begin
		set @Respuesta = 0	--No se puede eliminar
	end
	else
	begin
		set @Respuesta = 1	--Se puede eliminar
	end
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSePuedeEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesSinAltaMedicaEnHospEmerg]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PacientesSinAltaMedicaEnHospEmerg]
WITH EXECUTE AS CALLER
AS
/*SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.SegundoNombre,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Atenciones.FechaIngreso,
             (SELECT top 1  'Servicio:' + dbo.Servicios.Nombre+ '  Cama: ' + isnull(dbo.Camas.Codigo,'')  AS ServicioCama
              FROM  dbo.AtencionesEstanciaHospitalaria LEFT OUTER JOIN
                      dbo.Camas ON dbo.AtencionesEstanciaHospitalaria.IdCama = dbo.Camas.IdCama LEFT OUTER JOIN
                      dbo.Servicios ON dbo.AtencionesEstanciaHospitalaria.IdServicio = dbo.Servicios.IdServicio
              where dbo.AtencionesEstanciaHospitalaria.IdAtencion =dbo.Atenciones.IdAtencion  and
                    not (dbo.Servicios.Nombre is null)
               ORDER BY dbo.AtencionesEstanciaHospitalaria.Secuencia DESC) as CamaActual,dbo.TiposServicio.Descripcion as tipoServicio
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.TiposServicio ON dbo.Atenciones.IdTipoServicio = dbo.TiposServicio.IdTipoServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     (dbo.Atenciones.FechaEgreso IS NULL) AND (dbo.Atenciones.idEstadoAtencion <> 0) and
         (dbo.Atenciones.FechaEgresoAdministrativo is null) and
         dbo.Atenciones.IdTipoServicio =2 or dbo.Atenciones.IdTipoServicio =3 and
         dbo.atenciones.IdPaciente in (select dbo.camas.IdPaciente  from dbo.camas
                                       where dbo.camas.IdEstadoCama=3 and
                                             dbo.camas.IdPaciente =dbo.atenciones.IdPaciente)
order by dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre */
SELECT      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.Servicios.Nombre AS Servicio, dbo.Camas.Codigo AS Cama, dbo.TiposServicio.Descripcion AS TipoServicio
FROM         dbo.TiposServicio RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio RIGHT OUTER JOIN
                      dbo.Camas INNER JOIN
                      dbo.Pacientes ON dbo.Camas.IdPaciente = dbo.Pacientes.IdPaciente ON dbo.Servicios.IdServicio = dbo.Camas.IdServicioUbicacionActual
WHERE     (NOT (dbo.Pacientes.ApellidoPaterno IS NULL))
ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesSinAltaMedicaEnHospEmerg] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesTieneCita]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesTieneCita]
	@lcFiltro [varchar](1500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @lcFiltro<>''
   SET  @SQL =  'SELECT  dbo.Citas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServicio
                              FROM   dbo.Citas LEFT OUTER JOIN dbo.Servicios ON dbo.Citas.IdServicio = dbo.Servicios.IdServicio   '+@lcFiltro
else
   SET  @SQL =  'SELECT  dbo.Citas.*, dbo.Servicios.Nombre AS dservicio, dbo.Servicios.Codigo AS codServicio
                              FROM   dbo.Citas LEFT OUTER JOIN dbo.Servicios ON dbo.Citas.IdServicio = dbo.Servicios.IdServicio   '

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[PacientesTieneCita] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesVerificaRepetidosAntesDeGrabarDatos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesVerificaRepetidosAntesDeGrabarDatos]
	@SinProblemas [varchar](100) OUTPUT,
	@Autogenerado [varchar](30),
	@NroHistoriaClinica [int],
	@IdTipoNumeracion [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
declare @NroHistoria int
declare @NroFilas int

set @SinProblemas=''

--Por Numero de Historia Clinica
select @NroHistoria=nroHistoriaClinica from Pacientes where NroHistoriaClinica=@NroHistoriaClinica and IdTipoNumeracion=@IdTipoNumeracion
set @NroFilas = @@rowcount
if @NroFilas>1
            set @SinProblemas='Ya existe el Nro Historia Clínica: '+ltrim(str(@NroHistoria))
else
	begin
	--Por Autogenerado
             DECLARE PacientesCursor CURSOR FOR  select NroHistoriaClinica from Pacientes where Autogenerado=@Autogenerado
             OPEN PacientesCursor
	declare @idPacienteHallado int
	FETCH NEXT FROM PacientesCursor INTO @IdPacienteHallado
	WHILE (@@FETCH_STATUS <> -1)
	BEGIN
                       if  @IdPacienteHallado<>@NroHistoriaClinica
		     set @SinProblemas='El  Nro Historia del  Paciente: '+ltrim(str(@IdPacienteHallado))+'   tiene el mismo Autogenerado (APat,AMat,Pnom,Snom,Nacim,Sexo)'
	          FETCH NEXT FROM PacientesCursor INTO @IdPacienteHallado
	END
	CLOSE PacientesCursor
	DEALLOCATE PacientesCursor
	end
GO
ALTER AUTHORIZATION ON [dbo].[PacientesVerificaRepetidosAntesDeGrabarDatos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesXApellidosYnombres]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesXApellidosYnombres]
	@ApellidoPaterno [varchar](40),
	@ApellidoMaterno [varchar](40),
	@PrimerNombre [varchar](40),
	@SegundoNombre [varchar](40)
WITH EXECUTE AS CALLER
AS
if @SegundoNombre<>''
     select IdPaciente, NroHistoriaClinica, ApellidoPaterno, ApellidoMaterno, PrimerNombre, SegundoNombre from Pacientes
     Where ApellidoPaterno = @ApellidoPaterno  and
     ApellidoMaterno = @ApellidoMaterno and
     PrimerNombre = @PrimerNombre and SegundoNombre=@SegundoNombre
else
     select IdPaciente, NroHistoriaClinica, ApellidoPaterno, ApellidoMaterno, PrimerNombre, SegundoNombre from Pacientes
     Where ApellidoPaterno = @ApellidoPaterno  and
     ApellidoMaterno = @ApellidoMaterno and
     PrimerNombre = @PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[PacientesXApellidosYnombres] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesXdni]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesXdni]
	@lcDni [varchar](12)
WITH EXECUTE AS CALLER
AS
select * from Pacientes where idDocIdentidad=1 and NroDocumento=@lcDni
GO
ALTER AUTHORIZATION ON [dbo].[PacientesXdni] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PacientesXnroHistoriaTipoNumeracion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PacientesXnroHistoriaTipoNumeracion]
	@lnNroHistoriaClinica [int],
	@lnIdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
select * from Pacientes where nroHistoriaClinica=@lnNroHistoriaClinica and idTipoNumeracion=@lnIdTipoNumeracion
GO
ALTER AUTHORIZATION ON [dbo].[PacientesXnroHistoriaTipoNumeracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadNominalBuscarDatosxNroHC]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadNominalBuscarDatosxNroHC]
	@histclinica [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT * FROM PADRONNOMINAL_DETALLE
WHERE HISTCLINICA=@histclinica
GO
ALTER AUTHORIZATION ON [dbo].[PadNominalBuscarDatosxNroHC] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadNominalListaDiagNutricional]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadNominalListaDiagNutricional]
WITH EXECUTE AS CALLER
AS
select pn.idpadnomformulario as IdCodigoDx,pn.descripcion, ltrim(pn.idpadnomformulario) + ' = ' + pn.descripcion as DescripcionLarga
from PadronNominal_DxNutriTemp pn
GO
ALTER AUTHORIZATION ON [dbo].[PadNominalListaDiagNutricional] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadNominalSeleccionarDxNutricionalPorRangoZ]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PadNominalSeleccionarDxNutricionalPorRangoZ]
	@RefCodLab [varchar](10),
	@Z [money]
WITH EXECUTE AS CALLER
AS
select * from padronnominal_dxnutricional
where LabReferencia=@RefCodLab
AND  (@Z BETWEEN RangoInicial AND RangoFinal)
GO
ALTER AUTHORIZATION ON [dbo].[PadNominalSeleccionarDxNutricionalPorRangoZ] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_CabeceraAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_CabeceraAgregar]
	@IdPaNomCabecera [int] OUTPUT,
	@IdResponsableAtencion [int],
	@IdCodigoRenaes [int],
	@Mes [int],
	@Año [char](4),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PadronNominal_Cabecera (
IdResponsableAtencion,IdCodigoRenaes,Mes,Año) values (
@IdResponsableAtencion,@IdCodigoRenaes,@Mes,@Año)
set @IdPaNomCabecera = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPaNomCabecera,'PadronNominal_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_CabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_CabeceraEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_CabeceraEliminar]
	@IdPaNomCabecera [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PadronNominal_Cabecera
where IdPaNomCabecera = @IdPaNomCabecera
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPaNomCabecera,'PadronNominal_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_CabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_CabeceraModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_CabeceraModificar]
	@IdPaNomCabecera [int],
	@IdResponsableAtencion [int],
	@IdCodigoRenaes [int],
	@Mes [int],
	@Año [char](4),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PadronNominal_Cabecera
set
IdResponsableAtencion = @IdResponsableAtencion,
IdCodigoRenaes = @IdCodigoRenaes,
Mes = @Mes,
Año = @Año
where IdPaNomCabecera = @IdPaNomCabecera
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPaNomCabecera,'PadronNominal_Cabecera'
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_CabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_CabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_CabeceraSeleccionarPorId]
	@IdPaNomCabecera [int]
WITH EXECUTE AS CALLER
AS
select * from PadronNominal_Cabecera
where IdPaNomCabecera = @IdPaNomCabecera
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_CabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_DetalleAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_DetalleAgregar]
	@IdPaNomDetalle [int] OUTPUT,
	@IdTipoDoc [int],
	@NumDocumento [int],
	@HistClinica [varchar](10),
	@ApellidoPaterno [varchar](20),
	@ApellidoMaterno [varchar](20),
	@Nombres [varchar](40),
	@idSexo [int],
	@FecNacimiento [varchar](10),
	@IdTipoSeguro [int],
	@NumAfiliacion [varchar](10),
	@FecEvaluacion [varchar](10),
	@Peso [varchar](5),
	@Talla [varchar](3),
	@IdDiagNutricional [int],
	@CodRenaes [int],
	@IdDiagPE [int],
	@IdDiagPT [int],
	@IdDiagTE [int],
	@Hemoglobina [int],
	@heces [varchar](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PadronNominal_Detalle (
IdTipoDoc,NumDocumento,HistClinica,ApellidoPaterno,ApellidoMaterno,Nombres,idSexo,FecNacimiento,IdTipoSeguro,NumAfiliacion,
    FecEvaluacion,Peso,Talla,IdDiagNutricional,CodRenaes,IdDiagPE,IdDiagPT,IdDiagTE,Hemoglobina,heces) values (
@IdTipoDoc,@NumDocumento,@HistClinica,@ApellidoPaterno,@ApellidoMaterno,@Nombres,@idSexo,@FecNacimiento,@IdTipoSeguro,@NumAfiliacion,
   @FecEvaluacion,@Peso,@Talla,@IdDiagNutricional,@CodRenaes,@IdDiagPE,@IdDiagPT,@IdDiagTE,@Hemoglobina,@heces)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPaNomDetalle,'PadronNominal_Detalle'
set @IdPaNomDetalle = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_DetalleEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_DetalleEliminar]
	@IdPaNomDetalle [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PadronNominal_Detalle
where IdPaNomDetalle = @IdPaNomDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPaNomDetalle,'PadronNominal_Detalle'
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_DetalleModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_DetalleModificar]
	@IdPaNomDetalle [int],
	@IdTipoDoc [int],
	@NumDocumento [int],
	@HistClinica [varchar](10),
	@ApellidoPaterno [varchar](20),
	@ApellidoMaterno [varchar](20),
	@Nombres [varchar](40),
	@idSexo [int],
	@FecNacimiento [varchar](10),
	@IdTipoSeguro [int],
	@NumAfiliacion [varchar](10),
	@FecEvaluacion [varchar](10),
	@Peso [varchar](5),
	@Talla [varchar](3),
	@IdDiagNutricional [int],
	@CodRenaes [int],
	@IdDiagPE [int],
	@IdDiagPT [int],
	@IdDiagTE [int],
	@Hemoglobina [int],
	@heces [varchar](2),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PadronNominal_Detalle
set
IdTipoDoc = @IdTipoDoc,
NumDocumento = @NumDocumento,
HistClinica = @HistClinica,
ApellidoPaterno = @ApellidoPaterno,
ApellidoMaterno = @ApellidoMaterno,
Nombres = @Nombres,
idSexo = @idSexo,
FecNacimiento = @FecNacimiento,
IdTipoSeguro = @IdTipoSeguro,
NumAfiliacion = @NumAfiliacion,
FecEvaluacion = @FecEvaluacion,
Peso = @Peso,
Talla = @Talla,
IdDiagNutricional = @IdDiagNutricional,
CodRenaes = @CodRenaes,
IdDiagPE = @IdDiagPE,
IdDiagPT = @IdDiagPT,
IdDiagTE = @IdDiagTE,
Hemoglobina=@Hemoglobina ,
heces =@heces
where IdPaNomDetalle = @IdPaNomDetalle
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPaNomDetalle,'PadronNominal_Detalle'
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_DetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_DetalleSeleccionarPorId]
	@IdPaNomDetalle [int]
WITH EXECUTE AS CALLER
AS
select * from PadronNominal_Detalle
where IdPaNomDetalle = @IdPaNomDetalle
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominal_DetalleSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PadronNominal_DetalleSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT
PD.IdPaNomDetalle,
PD.IdTipoDoc,
TD.Descripcion,
PD.NumDocumento,
PD.HistClinica,
PD.ApellidoPaterno,
PD.ApellidoMaterno,
PD.Nombres,
PD.idSexo,
TS.Descripcion,
PD.FecNacimiento,
PD.IdTipoSeguro,
TF.Descripcion,
PD.NumAfiliacion,
PD.FecEvaluacion,
PD.Peso,
PD.Talla,
PD.IdDiagNutricional,
DN.Descripcion,
PD.CodRenaes,
PD.IdDiagPE,
PD.IdDiagPT,
PD.IdDiagTE,
PD.Hemoglobina,
PD.Heces,
ES.Nombre

FROM PadronNominal_Detalle PD
INNER JOIN TiposDocIdentidad TD ON
	PD.IdTipoDoc=TD.IdDocIdentidad
INNER JOIN TiposSexo TS ON
	PD.idSexo=TS.IdTipoSexo
INNER JOIN TiposFinanciamiento TF ON
	PD.IdTipoSeguro=TF.IdTipoFinanciamiento
INNER JOIN PadronNominal_DxNutriTemp DN ON
	PD.IdDiagNutricional=DN.IdpadNomFormulario
INNER JOIN Establecimientos  ES ON
	right('00'+cast(PD.codRenaes as varchar(5)),5)=eS.codigo
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominal_DetalleSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PadronNominalFiltrarNroHisClinica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PadronNominalFiltrarNroHisClinica]
	@numdocumento [varchar](20),
	@apellidopaterno [varchar](50),
	@apellidomaterno [varchar](50),
	@nombres [varchar](50),
	@histclinica [varchar](20)
WITH EXECUTE AS CALLER
AS
IF @numdocumento=''
	BEGIN
		select p.idpanomdetalle,p.histclinica,p.numdocumento,p.apellidopaterno,
		p.apellidomaterno,p.nombres,p.fecevaluacion,s.descripcion as idsexo,p.peso,p.talla,d.descripcion as iddiagnutricional
		from padronnominal_detalle p inner join tipossexo s on p.idsexo=s.idtiposexo
		inner join PadronNominal_DxNutriTemp d on p.iddiagnutricional=d.idpadnomformulario
		where p.apellidopaterno like '%' + @apellidopaterno + '%'
		and p.apellidomaterno like '%' + @apellidomaterno + '%'
		and p.nombres like '%' + @nombres + '%'
		and p.histclinica like '%' + @histclinica + '%'
	END
ELSE
	BEGIN
		select p.idpanomdetalle,p.histclinica,p.numdocumento,p.apellidopaterno,
		p.apellidomaterno,p.nombres,p.fecevaluacion,s.descripcion as idsexo,p.peso,p.talla,d.descripcion as iddiagnutricional
		from padronnominal_detalle p inner join tipossexo s on p.idsexo=s.idtiposexo
		inner join PadronNominal_DxNutriTemp d on p.iddiagnutricional=d.idpadnomformulario
		where p.numdocumento = @numdocumento
		and p.apellidopaterno like '%' + @apellidopaterno + '%'
		and p.apellidomaterno like '%' + @apellidomaterno + '%'
		and p.nombres like '%' + @nombres + '%'
		and p.histclinica like '%' + @histclinica + '%'
	END
GO
ALTER AUTHORIZATION ON [dbo].[PadronNominalFiltrarNroHisClinica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PaisesEliminar]
	@IdPais [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Paises
where IdPais = @IdPais
GO
ALTER AUTHORIZATION ON [dbo].[PaisesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesFiltrarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PaisesFiltrarTodos]
WITH EXECUTE AS CALLER
AS
select * from paises
GO
ALTER AUTHORIZATION ON [dbo].[PaisesFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PaisesModificar]
	@Nombre [varchar](50),
	@IdPais [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Paises
set
Nombre = @Nombre
where IdPais = @IdPais
GO
ALTER AUTHORIZATION ON [dbo].[PaisesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesModificarCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PaisesModificarCodigo]
	@IdPais [int],
	@Codigo [char](3)
WITH EXECUTE AS CALLER
AS
UPDATE paises
SET Codigo=@Codigo
WHERE IdPais=@IdPais
GO
ALTER AUTHORIZATION ON [dbo].[PaisesModificarCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PaisesSeleccionarPorId]
	@IdPais [int]
WITH EXECUTE AS CALLER
AS
select * from Paises
where IdPais = @IdPais
GO
ALTER AUTHORIZATION ON [dbo].[PaisesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PaisesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdPais, Nombre,
(Convert(varchar(5), IdPais) + ' = ' + Nombre) as DescripcionLarga
 from Paises
 --SCCQ 18/03/2020 Cambio2 Inicio
 where IndFlag =1
 --SCCQ 18/03/2020 Cambio2 Fin
order by Nombre

GO
ALTER AUTHORIZATION ON [dbo].[PaisesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesSeleccionarTodosCampos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PaisesSeleccionarTodosCampos]
WITH EXECUTE AS CALLER
AS
select * from paises
GO
ALTER AUTHORIZATION ON [dbo].[PaisesSeleccionarTodosCampos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PaisesXfiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PaisesXfiltro]
WITH EXECUTE AS CALLER
AS
select codigo,idPais from paises
GO
ALTER AUTHORIZATION ON [dbo].[PaisesXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosActualizaValorTextoXid]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosActualizaValorTextoXid]
	@idParametro [int],
	@valorTexto [varchar](150)
WITH EXECUTE AS CALLER
AS
update parametros set ValorTexto=@valorTexto where idParametro=@idParametro
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosActualizaValorTextoXid] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosAgregar]
	@Descripcion [varchar](150),
	@Codigo [varchar](20),
	@Tipo [varchar](20),
	@IdParametro [int] OUTPUT,
	@ValorFloat [float],
	@ValorInt [int],
	@ValorTexto [varchar](150),
	@grupo [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Parametros (
Descripcion,Codigo,Tipo,ValorFloat,ValorInt,ValorTexto,grupo) values (
@Descripcion,@Codigo,@Tipo,@ValorFloat,@ValorInt,@ValorTexto,@grupo)
set @IdParametro = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdParametro,'Parametros'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosEliminar]
	@IdParametro [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Parametros
where IdParametro = @IdParametro
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdParametro,'Parametros'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosGenerarNroAgrupadorMovimientos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosGenerarNroAgrupadorMovimientos]
	@IdGrupoMovimiento [int] OUTPUT
WITH EXECUTE AS CALLER
AS
select @IdGrupoMovimiento = ValorInt
from Parametros
where Tipo = 'Correlativo' and Codigo = 'AGRUP_MOV_HC'

update  Parametros
set ValorInt  = ValorInt +1
where Tipo = 'Correlativo' and Codigo = 'AGRUP_MOV_HC'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosGenerarNroAgrupadorMovimientos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosGrupos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosGrupos]
WITH EXECUTE AS CALLER
AS
select distinct Grupo from Parametros Where Grupo <> null  and ltrim(grupo)<>''   order by Grupo
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosGrupos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosModificar]
	@Descripcion [varchar](150),
	@Codigo [varchar](20),
	@Tipo [varchar](20),
	@IdParametro [int],
	@ValorFloat [float],
	@ValorInt [int],
	@ValorTexto [varchar](150),
	@grupo [varchar](30),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Parametros
set
Descripcion = @Descripcion,
Codigo = @Codigo,
Tipo = @Tipo,
ValorFloat = @ValorFloat,
ValorInt = @ValorInt,
ValorTexto = @ValorTexto,
grupo=@grupo
where IdParametro = @IdParametro
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdParametro,'Parametros'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[parametrosModificarDniEncriptado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[parametrosModificarDniEncriptado]
	@DniEncriptado [varchar](355)
WITH EXECUTE AS CALLER
AS
update parametros set valorTexto=@DniEncriptado where idParametro=297
GO
ALTER AUTHORIZATION ON [dbo].[parametrosModificarDniEncriptado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosObtenerCodigoDeConsultaDeEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosObtenerCodigoDeConsultaDeEmergencia]
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
    where Tipo ='Facturacion' and codigo = 'CONSULTA_EMERGENCIA'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosObtenerCodigoDeConsultaDeEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosObtenerCodigoDeDuplicadoCarnet]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosObtenerCodigoDeDuplicadoCarnet]
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
    where Tipo ='Facturacion' and codigo = 'DUPLICADO_CARNE'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosObtenerCodigoDeDuplicadoCarnet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosObtenerCodigoDeFolder]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosObtenerCodigoDeFolder]
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
     where Tipo ='Facturacion' and codigo = 'FOLDER'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosObtenerCodigoDeFolder] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosObtenerCodigoDeNuevoCarnet]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosObtenerCodigoDeNuevoCarnet]
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
     where Tipo ='Facturacion' and codigo = 'NUEVO_CARNE'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosObtenerCodigoDeNuevoCarnet] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosObtenerValorIntPorTipoYCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosObtenerValorIntPorTipoYCodigo]
	@sTipo [varchar](20),
	@sCodigo [varchar](20)
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
    where Tipo =@sTipo  and codigo = @sCodigo
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosObtenerValorIntPorTipoYCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarCadenaConexion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarCadenaConexion]
WITH EXECUTE AS CALLER
AS
select ValorTexto from parametros where tipo = 'seguridad' and codigo ='CONEXION'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarCadenaConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarCadenaConexionShape]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarCadenaConexionShape]
WITH EXECUTE AS CALLER
AS
select ValorTexto from parametros where tipo = 'seguridad' and codigo ='CONEXION_SHAPE'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarCadenaConexionShape] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarCadenaConexionSSES]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarCadenaConexionSSES]
WITH EXECUTE AS CALLER
AS
select ValorTexto from parametros where tipo = 'SSES' and codigo ='CONEXION'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarCadenaConexionSSES] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarComparadorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarComparadorFechas]
WITH EXECUTE AS CALLER
AS
select IdParametro, Codigo from parametros
where tipo = 'ComparadorFecha'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarComparadorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarIdServicioArchivoClinico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarIdServicioArchivoClinico]
WITH EXECUTE AS CALLER
AS
select ValorInt from Parametros
    where Tipo ='ID' and codigo = 'ARCHIVO_CLINICO'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarIdServicioArchivoClinico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarInterfaseSSES]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarInterfaseSSES]
WITH EXECUTE AS CALLER
AS
select ValorTexto from parametros where tipo = 'SSES' and codigo ='INTERFASE_HABILITADA'
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarInterfaseSSES] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarPorGrupo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarPorGrupo]
	@Grupo [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from Parametros where Grupo = @Grupo
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarPorGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarPorId]
	@IdParametro [int]
WITH EXECUTE AS CALLER
AS
select * from Parametros
where IdParametro = @IdParametro
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarPorTipo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarPorTipo]
	@Tipo [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from parametros where tipo = @tipo
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarPorTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarTiposConsulta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarTiposConsulta]
WITH EXECUTE AS CALLER
AS
select IdProducto, Codigo + ' = ' + Nombre as Descripcion from FactCatalogoServicios where IdProducto in (select ValorInt from Parametros where Tipo = 'TipoConsulta' and Codigo = 'CE')
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarTiposConsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarTiposConsultaInterconsulta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarTiposConsultaInterconsulta]
WITH EXECUTE AS CALLER
AS
select IdProducto, Codigo + ' = ' + Nombre as Descripcion from FactCatalogoServicios where IdProducto in (select ValorInt from Parametros where Tipo = 'INTERCONSULTA' and Codigo = 'CE')
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarTiposConsultaInterconsulta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ParametrosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ParametrosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from Parametros
GO
ALTER AUTHORIZATION ON [dbo].[ParametrosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PartidasPresupuestalesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PartidasPresupuestalesAgregar]
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdPartidaPresupuestal [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
declare @IdPartida int
SELECT  top 1 @IdPartida=idPartidaPresupuestal FROM FactPartidasPresupuestales order by idPartidaPresupuestal desc
set @IdPartida=@IdPartida+1

insert into PartidasPresupuestales (idPartidaPresupuestal,Descripcion,Codigo) values
(@idPartida,@Descripcion,@Codigo)

--set @IdPartidaPresupuestal = @@Identity
set @IdPartidaPresupuestal =@idPartida

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPartidaPresupuestal,'PartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[PartidasPresupuestalesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PartidasPresupuestalesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PartidasPresupuestalesEliminar]
	@IdPartidaPresupuestal [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PartidasPresupuestales
where IdPartidaPresupuestal = @IdPartidaPresupuestal
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPartidaPresupuestal,'PartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[PartidasPresupuestalesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PartidasPresupuestalesFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PartidasPresupuestalesFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'Select *
            from FactPartidasPresupuestales where 1 = 1    '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[PartidasPresupuestalesFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PartidasPresupuestalesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PartidasPresupuestalesModificar]
	@Descripcion [varchar](255),
	@Codigo [varchar](10),
	@IdPartidaPresupuestal [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PartidasPresupuestales
set
Descripcion = @Descripcion,
Codigo = @Codigo
where IdPartidaPresupuestal = @IdPartidaPresupuestal
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPartidaPresupuestal,'PartidasPresupuestales'
GO
ALTER AUTHORIZATION ON [dbo].[PartidasPresupuestalesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PartidasPresupuestalesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PartidasPresupuestalesSeleccionarPorId]
	@IdPartidaPresupuestal [int]
WITH EXECUTE AS CALLER
AS
select * from PartidasPresupuestales
where IdPartidaPresupuestal = @IdPartidaPresupuestal
GO
ALTER AUTHORIZATION ON [dbo].[PartidasPresupuestalesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionAgregar]
	@idPerinatalAtencion [int] OUTPUT,
	@idPaciente [int],
	@idModulo [int],
	@GrafXedadEnMeses [int],
	@GrafYpercentilTE [int],
	@GrafYpercentilPT [int],
	@GrafYpercentilPE [int],
	@GrafYimc [money],
	@FechaAtencion [datetime],
	@CredN [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PerinatalAtencion (
idPaciente,idModulo,GrafXedadEnMeses,GrafYpercentilTE,GrafYpercentilPT,GrafYpercentilPE,
      GrafYimc,FechaAtencion,CredN)
  values (
@idPaciente,@idModulo,@GrafXedadEnMeses,@GrafYpercentilTE,@GrafYpercentilPT,@GrafYpercentilPE,
       @GrafYimc,@FechaAtencion,@CredN)
set @idPerinatalAtencion = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCptSeleccionarPorIdPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCptSeleccionarPorIdPerinatalAtencion]
	@mo_idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencionProcedimientos.*, dbo.FactCatalogoServicios.Nombre
                FROM         dbo.PerinatalAtencionProcedimientos LEFT OUTER JOIN
                           dbo.FactCatalogoServicios ON dbo.PerinatalAtencionProcedimientos.idProducto = dbo.FactCatalogoServicios.IdProducto
                WHERE dbo.PerinatalAtencionProcedimientos.IdPerinatalAtencion=@mo_idPerinatalAtencion
                ORDER BY dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCptSeleccionarPorIdPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCred1Agregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCred1Agregar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@EstimulacionTemprana [bit],
	@AlimentacionComplementaria [bit],
	@LactanciaMaterna [bit],
	@PersonalSalud [bit],
	@DemandaIndividual [bit],
	@MujerEdadReproductiva [bit],
	@MujerGestante [bit],
	@idAtencion [int],
	@LactanciaMaternaComp [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PerinatalAtencionCred1 (
idPerinatalAtencion,idModulo,EstimulacionTemprana,AlimentacionComplementaria,LactanciaMaterna,
PersonalSalud,DemandaIndividual,MujerEdadReproductiva,MujerGestante,idAtencion,LactanciaMaternaComp) values (
@idPerinatalAtencion,@idModulo,@EstimulacionTemprana,@AlimentacionComplementaria,@LactanciaMaterna,
@PersonalSalud,@DemandaIndividual,@MujerEdadReproductiva,@MujerGestante,@idAtencion,@LactanciaMaternaComp)
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1Agregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCred1Eliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCred1Eliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionCred1
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionCred1'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1Eliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCred1Modificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCred1Modificar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@EstimulacionTemprana [bit],
	@AlimentacionComplementaria [bit],
	@LactanciaMaterna [bit],
	@PersonalSalud [bit],
	@DemandaIndividual [bit],
	@MujerEdadReproductiva [bit],
	@MujerGestante [bit],
	@idAtencion [int],
	@LactanciaMaternaComp [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PerinatalAtencionCred1
set
idModulo = @idModulo,
EstimulacionTemprana = @EstimulacionTemprana,
AlimentacionComplementaria = @AlimentacionComplementaria,
LactanciaMaterna = @LactanciaMaterna,
PersonalSalud = @PersonalSalud,
DemandaIndividual = @DemandaIndividual,
MujerEdadReproductiva = @MujerEdadReproductiva,
MujerGestante = @MujerGestante,
idAtencion = @idAtencion,
LactanciaMaternaComp=@LactanciaMaternaComp
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1Modificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCred1SeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCred1SeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionCred1
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1SeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCred1SeleccionarTodoPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCred1SeleccionarTodoPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionCred1 where idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCred1SeleccionarTodoPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredAgregar]
	@idPerinatalAtencion [int],
	@EdadEnAnios [varchar](10),
	@CredNumero [int],
	@CredCheck [varchar](1),
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PerinatalAtencionCred (
idPerinatalAtencion,EdadEnAnios,CredNumero,CredCheck,idAtencion) values (
@idPerinatalAtencion,@EdadEnAnios,@CredNumero,@CredCheck,@idAtencion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPerinatalAtencion,'PerinatalAtencionCred'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionCred
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionCred'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredEliminarXidAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredEliminarXidAtencion]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionCred
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredModificar]
	@idPerinatalAtencion [int],
	@EdadEnAnios [varchar](10),
	@CredNumero [int],
	@CredCheck [varchar](1),
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PerinatalAtencionCred
set
EdadEnAnios = @EdadEnAnios,
CredNumero = @CredNumero,
CredCheck = @CredCheck,
idAtencion=@idAtencion
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPerinatalAtencion,'PerinatalAtencionCred'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredSeleccionarControles]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredSeleccionarControles]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencion.CredN, dbo.Atenciones.IdCuentaAtencion, dbo.Atenciones.FechaEgreso, dbo.Atenciones.HoraEgreso,
                      dbo.PerinatalAtencionDiaria.idAtencion, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.FechaNacimiento, dbo.Atenciones.Edad, dbo.Atenciones.IdTipoEdad,
                      ltrim(dbo.Empleados.ApellidoPaterno) + ' ' + ltrim(dbo.Empleados.ApellidoMaterno) + ' '+ dbo.Empleados.Nombres as medico, dbo.Medicos.Colegiatura
FROM         dbo.Pacientes RIGHT OUTER JOIN
                      dbo.Empleados INNER JOIN
                      dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado RIGHT OUTER JOIN
                      dbo.PerinatalAtencion INNER JOIN
                      dbo.PerinatalAtencionDiaria ON dbo.PerinatalAtencion.idPerinatalAtencion = dbo.PerinatalAtencionDiaria.idPerinatalAtencion INNER JOIN
                      dbo.Atenciones ON dbo.PerinatalAtencionDiaria.idAtencion = dbo.Atenciones.IdAtencion ON
                      dbo.Medicos.IdMedico = dbo.Atenciones.IdMedicoIngreso ON dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente
WHERE     (dbo.Atenciones.idEstadoAtencion <> 0) and dbo.atenciones.idPaciente=@idPaciente
order by dbo.Atenciones.FechaEgreso desc,dbo.Atenciones.HoraEgreso desc
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredSeleccionarControles] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionCred
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionCredSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionCredSeleccionarPorIdPaciente]
	@ml_idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT  dbo.PerinatalAtencionCred.*, dbo.PerinatalAtencion.idPaciente, dbo.PerinatalAtencion.idModulo,
         dbo.PerinatalAtencionCred.idAtencion,dbo.PerinatalAtencion.FechaAtencion
             FROM         dbo.PerinatalAtencionCred LEFT OUTER JOIN
                                  dbo.PerinatalAtencion ON dbo.PerinatalAtencionCred.idPerinatalAtencion = dbo.PerinatalAtencion.idPerinatalAtencion
             WHERE dbo.PerinatalAtencion.idPaciente=@ml_idPaciente
             ORDER BY dbo.PerinatalAtencionCred.EdadEnAnios DESC,dbo.PerinatalAtencionCred.credNumero
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionCredSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiagnosticosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiagnosticosAgregar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idLista [int],
	@idDiagnostico [int],
	@CodigoHIS [varchar](20),
	@idAtencion [int],
	@labConfHIS [varchar](3),
	@IdSubclasificacionDx [int],
	@IdClasificacionDx [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarItemDiagnostico INT

    SET @VarItemDiagnostico = ISNULL((SELECT MAX(ItemDiagnostico)+1 FROM PerinatalAtencionDiagnosticos WHERE idPerinatalAtencion = @idPerinatalAtencion
                                AND idModulo = @idModulo AND idLista = @idLista AND idDiagnostico = @idDiagnostico), 1)

    INSERT INTO PerinatalAtencionDiagnosticos (ItemDiagnostico,
        idPerinatalAtencion,idModulo,idLista,idDiagnostico,CodigoHIS,idAtencion, labConfHIS,
        IdSubclasificacionDx, IdClasificacionDx
        )
    VALUES (@VarItemDiagnostico,
        @idPerinatalAtencion,@idModulo,@idLista,@idDiagnostico,@CodigoHIS,@idAtencion, @labConfHIS ,
        @IdSubclasificacionDx, @IdClasificacionDx
    )
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPerinatalAtencion,'PerinatalAtencionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiagnosticosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiagnosticosEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionDiagnosticos
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiagnosticosEliminarXidAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiagnosticosEliminarXidAtencion]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionDiagnosticos
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticosEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiagnosticosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiagnosticosModificar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idLista [int],
	@idDiagnostico [int],
	@CodigoHIS [varchar](20),
	@idAtencion [int],
	@labConfHIS [varchar](3),
	@IdSubclasificacionDx [int],
	@IdClasificacionDx [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE PerinatalAtencionDiagnosticos SET
        idModulo = @idModulo,
        idLista = @idLista,
        idDiagnostico = @idDiagnostico,
        CodigoHIS = @CodigoHIS,
        idAtencion =@idAtencion,
        labConfHIS = @labConfHIS,
        IdSubclasificacionDx = @IdSubclasificacionDx,
        IdClasificacionDx = @IdClasificacionDx
    WHERE idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPerinatalAtencion,'PerinatalAtencionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiagnosticosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiagnosticosSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiagnosticos
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiagnosticosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaAgregar]
	@idPerinatalAtencion [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PerinatalAtencionDiaria (
idPerinatalAtencion,idAtencion) values (
@idPerinatalAtencion,@idAtencion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPerinatalAtencion,'PerinatalAtencionDiaria'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionDiaria
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionDiaria'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaEliminarXidAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaEliminarXidAtencion]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionDiaria
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaModificar]
	@idPerinatalAtencion [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PerinatalAtencionDiaria
set
idAtencion = @idAtencion
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPerinatalAtencion,'PerinatalAtencionDiaria'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiaria
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiaria where idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaSeleccionarPorIdPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaSeleccionarPorIdPerinatalAtencion]
	@IdPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiaria where idPerinatalAtencion=@IdPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaSeleccionarPorIdPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaXIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaXIdAtencion]
	@lnIdAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiaria where idAtencion=@lnIdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaXIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDiariaXidPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDiariaXidPerinatalAtencion]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionDiaria where idPerinatalAtencion=@idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDiariaXidPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionDxSeleccionarPorIdPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionDxSeleccionarPorIdPerinatalAtencion]
	@mo_idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencionDiagnosticos.*, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion
                FROM         dbo.PerinatalAtencionDiagnosticos LEFT OUTER JOIN
                                     dbo.Diagnosticos ON dbo.PerinatalAtencionDiagnosticos.idDiagnostico = dbo.Diagnosticos.IdDiagnostico
                WHERE dbo.PerinatalAtencionDiagnosticos.IdPerinatalAtencion=@mo_idPerinatalAtencion
                ORDER BY dbo.Diagnosticos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionDxSeleccionarPorIdPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencion
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresCREDCompleto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresCREDCompleto]
	@FechaReporte [datetime],
	@IdAtenInteItemPlan [int],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- MEJORAR INDICADOR PUES SE DEBE DE ASEGURAR QUE NO HAYA DX CONTRADICTORIOS
	DECLARE @VarFechaInicio datetime;
	-- DECLARE @VarCodigoDX VARCHAR(25);
	-- DECLARE @VarCodigoDX1 VARCHAR(25);
	DECLARE @VarNumeroSesiones INT;

	-- SET @VarCodigoDX = '90669';
	-- SET @VarCodigoDX1 = '90681';
	SET @VarNumeroSesiones = 2;

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -60, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente-- , PPP.idProducto
			FROM AtenIntePlanDesarrolloPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			-- INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND P.IdDistritoDomicilio = @IdDistritoDomicilio
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente--, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente--, PPP.idProducto
			FROM AtenIntePlanDesarrolloPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			-- INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND D.IdProvincia = @IdProvincia
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente--, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente--, PPP.idProducto
			FROM AtenIntePlanDesarrolloPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			-- INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
			LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND PR.IdDepartamento = @IdDepartamento
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente--, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente--, PPP.idProducto
			FROM AtenIntePlanDesarrolloPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			-- INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente--, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresCREDCompleto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresLactanciaMaternaExclusiva]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresLactanciaMaternaExclusiva]
	@FechaReporte [datetime],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- MEJORAR INDICADOR PUES SE DEBE DE ASEGURAR QUE NO HAYA DX CONTRADICTORIOS
	DECLARE @VarFechaInicio datetime;
	DECLARE @VarCodigoDX VARCHAR(25);

	SET @VarCodigoDX = 'Z00.15'

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -40, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND P.IdDistritoDomicilio = @IdDistritoDomicilio
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND D.IdProvincia = @IdProvincia
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND PR.IdDepartamento = @IdDepartamento
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresLactanciaMaternaExclusiva] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresSesionesDemostrativas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresSesionesDemostrativas]
	@FechaReporte [datetime],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- MEJORAR INDICADOR PUES SE DEBE DE ASEGURAR QUE NO HAYA DX CONTRADICTORIOS
	DECLARE @VarFechaInicio datetime;
	DECLARE @VarCodigoDX VARCHAR(25);
	DECLARE @VarNumeroSesiones INT;

	SET @VarCodigoDX = 'C0010'
	SET @VarNumeroSesiones = 2;

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -40, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionProcedimientos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN FactCatalogoServicios AS FCTS ON FCTS.Codigo = @VarCodigoDX AND FCTS.IdProducto = PADX.idProducto
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND P.IdDistritoDomicilio = @IdDistritoDomicilio
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre
		HAVING COUNT(FCTS.Codigo) >=@VarNumeroSesiones;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionProcedimientos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN FactCatalogoServicios AS FCTS ON FCTS.Codigo = @VarCodigoDX AND FCTS.IdProducto = PADX.idProducto
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND D.IdProvincia = @IdProvincia
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre
		HAVING COUNT(FCTS.Codigo) >=@VarNumeroSesiones;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionProcedimientos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN FactCatalogoServicios AS FCTS ON FCTS.Codigo = @VarCodigoDX AND FCTS.IdProducto = PADX.idProducto
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND PR.IdDepartamento = @IdDepartamento
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre
		HAVING COUNT(FCTS.Codigo) >=@VarNumeroSesiones;
	END
	ELSE
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionProcedimientos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN FactCatalogoServicios AS FCTS ON FCTS.Codigo = @VarCodigoDX AND FCTS.IdProducto = PADX.idProducto
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre
		HAVING COUNT(FCTS.Codigo) >=@VarNumeroSesiones;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresSesionesDemostrativas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresSuplementoHierro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresSuplementoHierro]
	@FechaReporte [datetime],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- DECLARE @EdadInicialEnMeses INT;
	-- DECLARE @EdadFinalEnMeses INT;
	-- NIÑOS DE 6 A 35 MESES
	DECLARE @VarFechaInicio datetime;
	DECLARE @VarCodigoDX VARCHAR(25);

	-- SET @EdadInicialEnMeses = 6;
	-- SET @EdadFinalEnMeses = 35;Ç

	SET @VarCodigoDX = 'Z29.82'

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -40, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND P.IdDistritoDomicilio = @IdDistritoDomicilio
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND D.IdProvincia = @IdProvincia
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento

		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND PR.IdDepartamento = @IdDepartamento
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT P.idPaciente) AS total
		FROM PerinatalAtencionDiagnosticos AS PADX
		INNER JOIN PerinatalAtencion AS PA ON PA.idPerinatalAtencion = PADX.idPerinatalAtencion
		INNER JOIN Diagnosticos AS DX ON DX.CodigoCIE2004 = @VarCodigoDX AND DX.IdDiagnostico = PADX.idDiagnostico
		INNER JOIN Pacientes AS P ON P.idPaciente = PA.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE PA.FechaAtencion <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			-- AND PADX.idDiagnostico IN (SELECT IdDiagnostico FROM Diagnosticos WHERE CodigoCIE2004 = @VarCodigoDX)
			AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, PA.FechaAtencion) <=@EdadFinalEnMeses
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresSuplementoHierro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresTotalPacientes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresTotalPacientes]
	@FechaReporte [datetime],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- NIÑOS DE 6 A 35 MESES
	DECLARE @VarFechaInicio datetime;

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -40, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT COUNT(DISTINCT P.idPaciente) AS total
		FROM Pacientes AS P
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		-- LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE P.FechaNacimiento <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND P.IdDistritoDomicilio = @IdDistritoDomicilio
			AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT COUNT(DISTINCT P.idPaciente) AS total
		FROM Pacientes AS P
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		-- LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE P.FechaNacimiento <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND D.IdProvincia = @IdProvincia
			AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT COUNT(DISTINCT P.idPaciente) AS total
		FROM Pacientes AS P
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		-- LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE P.FechaNacimiento <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND PR.IdDepartamento = @IdDepartamento
			AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses;
	END
	ELSE
	BEGIN
		SELECT COUNT(DISTINCT P.idPaciente) AS total
		FROM Pacientes AS P
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		-- LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		WHERE P.FechaNacimiento <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
			AND P.FechaNacimiento IS NOT NULL
			AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresTotalPacientes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionIndicadoresVacunasNeumococoRatavirus]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionIndicadoresVacunasNeumococoRatavirus]
	@FechaReporte [datetime],
	@IdAtenInteItemPlan [int],
	@IdDepartamento [int],
	@IdProvincia [int],
	@IdDistritoDomicilio [int],
	@EdadInicialEnMeses [int],
	@EdadFinalEnMeses [int]
WITH EXECUTE AS CALLER
AS
-- MEJORAR INDICADOR PUES SE DEBE DE ASEGURAR QUE NO HAYA DX CONTRADICTORIOS
	DECLARE @VarFechaInicio datetime;
	DECLARE @VarCodigoDX VARCHAR(25);
	DECLARE @VarCodigoDX1 VARCHAR(25);
	DECLARE @VarNumeroSesiones INT;

	SET @VarCodigoDX = '90669';-- neumococo
	SET @VarCodigoDX1 = '90681';-- rotavirus
	SET @VarNumeroSesiones = 2;

	-- IMPLEMENTAR FILTRO ADICIONAL PARA OPTIMIZAR LA CONSULTA
	SET @VarFechaInicio = dateadd(month, -60, @FechaReporte)

	IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL AND @IdDistritoDomicilio IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente, PPP.idProducto
			FROM AtenIntePlanProcedimientoPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND P.IdDistritoDomicilio = @IdDistritoDomicilio
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL AND @IdProvincia IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente, PPP.idProducto
			FROM AtenIntePlanProcedimientoPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND D.IdProvincia = @IdProvincia
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE IF @IdDepartamento IS NOT NULL
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente, PPP.idProducto
			FROM AtenIntePlanProcedimientoPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
			LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND PR.IdDepartamento = @IdDepartamento
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
	ELSE
	BEGIN
		SELECT DP.Nombre AS Dpto, PR.Nombre AS Provincia, D.Nombre AS Distrito,
			CP.Nombre AS CentroPoblado, COUNT(DISTINCT LF.idPaciente) AS total
		FROM (SELECT PIP.idPaciente, PPP.idProducto
			FROM AtenIntePlanProcedimientoPaciente AS PPP
			INNER JOIN AtenIntePlanIntegralPaciente AS PIP ON PPP.IdAtenInteItemPlan = @IdAtenInteItemPlan AND  PIP.IdPlanIntegralPaciente = PPP.IdPlanIntegralPaciente
			INNER JOIN FactCatalogoServicios AS FCTS ON (FCTS.Codigo = @VarCodigoDX OR FCTS.Codigo = @VarCodigoDX1) AND FCTS.IdProducto = PPP.idProducto
			INNER JOIN Pacientes AS P ON P.idPaciente = PIP.idPaciente
			WHERE PPP.FechaProgramada <= @FechaReporte -- AND PA.FechaAtencion >= @VarFechaInicio
				AND P.FechaNacimiento IS NOT NULL
				AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) >=@EdadInicialEnMeses AND DATEDIFF(month, P.FechaNacimiento, @FechaReporte) <=@EdadFinalEnMeses
			GROUP BY PIP.idPaciente, PPP.idProducto
			HAVING COUNT(PPP.FechaProgramada) = COUNT(PPP.FechaEjecucion)) As LF
		INNER JOIN Pacientes AS P ON P.idPaciente = LF.idPaciente
		LEFT JOIN Distritos AS D ON D.IdDistrito = P.IdDistritoDomicilio
		LEFT JOIN Provincias AS PR ON PR.IdProvincia = D.IdProvincia
		LEFT JOIN Departamentos as DP ON DP.IdDepartamento = PR.IdDepartamento
		LEFT JOIN CentrosPoblados AS CP ON CP.IdCentroPoblado = P.IdCentroPobladoDomicilio
		GROUP BY D.Nombre, PR.Nombre, DP.Nombre, CP.Nombre;
	END
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionIndicadoresVacunasNeumococoRatavirus] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentosAgregar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idProducto [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PerinatalAtencionMedicamentos (
idPerinatalAtencion,idModulo,idProducto,idAtencion) values (
@idPerinatalAtencion,@idModulo,@idProducto,@idAtencion)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPerinatalAtencion,'PerinatalAtencionMedicamentos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentoSeleccionarPorIdPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentoSeleccionarPorIdPerinatalAtencion]
	@mo_idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencionMedicamentos.*, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
                 FROM         dbo.PerinatalAtencionMedicamentos LEFT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumos ON dbo.PerinatalAtencionMedicamentos.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
                 WHERE dbo.PerinatalAtencionMedicamentos.IdPerinatalAtencion=@mo_idPerinatalAtencion
                 ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentoSeleccionarPorIdPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentosEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionMedicamentos
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionMedicamentos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentosEliminarXidAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentosEliminarXidAtencion]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionMedicamentos
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentosEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentosModificar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idProducto [int],
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PerinatalAtencionMedicamentos
set
idModulo = @idModulo,
idProducto = @idProducto,
idAtencion=@idAtencion
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPerinatalAtencion,'PerinatalAtencionMedicamentos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionMedicamentosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionMedicamentosSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionMedicamentos
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionMedicamentosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionModificar]
	@idPerinatalAtencion [int],
	@idPaciente [int],
	@idModulo [int],
	@GrafXedadEnMeses [int],
	@GrafYpercentilTE [int],
	@GrafYpercentilPT [int],
	@GrafYpercentilPE [int],
	@GrafYimc [money],
	@FechaAtencion [datetime],
	@CredN [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PerinatalAtencion
set
idPaciente = @idPaciente,
idModulo = @idModulo,
GrafXedadEnMeses = @GrafXedadEnMeses,
GrafYpercentilTE = @GrafYpercentilTE,
GrafYpercentilPT = @GrafYpercentilPT,
GrafYpercentilPE = @GrafYpercentilPE,
GrafYimc = @GrafYimc,
FechaAtencion=@FechaAtencion,
CredN=@CredN
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientoOrdenServicioInmunizaciones]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientoOrdenServicioInmunizaciones]
	@idLista [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT IdOrden FROM PerinatalAtencionProcedimientos
	WHERE idLista = @idLista AND idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientoOrdenServicioInmunizaciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosAgregar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idLista [int],
	@idProducto [int],
	@CptEsAutomatico [bit],
	@CodigoHIS [varchar](20),
	@idAtencion [int],
	@labConfHIS [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarItemProcedimiento INT;

	SET @VarItemProcedimiento = ISNULL((SELECT MAX(ItemProcedimiento)+1 FROM PerinatalAtencionProcedimientos
									WHERE idPerinatalAtencion = @idPerinatalAtencion AND idModulo = @idModulo
												AND idLista = @idLista AND idProducto = @idProducto), 1)

	INSERT INTO PerinatalAtencionProcedimientos (
			idPerinatalAtencion, idModulo, idLista, idProducto, CptEsAutomatico,
			CodigoHIS,idAtencion, labConfHIS, ItemProcedimiento)
	values (
			@idPerinatalAtencion, @idModulo, @idLista, @idProducto, @CptEsAutomatico,
			@CodigoHIS, @idAtencion, @labConfHIS, @VarItemProcedimiento)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idPerinatalAtencion,'PerinatalAtencionProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosEliminar]
	@idPerinatalAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionProcedimientos
where idPerinatalAtencion = @idPerinatalAtencion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idPerinatalAtencion,'PerinatalAtencionProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosEliminarXidAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosEliminarXidAtencion]
	@idAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PerinatalAtencionProcedimientos
where idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosEliminarXidAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosModificar]
	@idPerinatalAtencion [int],
	@idModulo [int],
	@idLista [int],
	@idProducto [int],
	@CptEsAutomatico [bit],
	@CodigoHIS [varchar](20),
	@idAtencion [int],
	@labConfHIS [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE PerinatalAtencionProcedimientos SET
		idModulo = @idModulo,
		idLista = @idLista,
		idProducto = @idProducto,
		CptEsAutomatico = @CptEsAutomatico,
		CodigoHIS = @CodigoHIS,
		idAtencion=@idAtencion,
		labConfHIS = @labConfHIS
	WHERE idPerinatalAtencion = @idPerinatalAtencion
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idPerinatalAtencion,'PerinatalAtencionProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencionProcedimientos
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionProcedimientosXidPerinatalAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionProcedimientosXidPerinatalAtencion]
	@mo_idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencionProcedimientos.*, dbo.FactCatalogoServicios.Nombre
                FROM         dbo.PerinatalAtencionProcedimientos LEFT OUTER JOIN
                           dbo.FactCatalogoServicios ON dbo.PerinatalAtencionProcedimientos.idProducto = dbo.FactCatalogoServicios.IdProducto
                WHERE dbo.PerinatalAtencionProcedimientos.IdPerinatalAtencion=@mo_idPerinatalAtencion
                ORDER BY dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionProcedimientosXidPerinatalAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionSeleccionarPorId]
	@idPerinatalAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalAtencion
where idPerinatalAtencion = @idPerinatalAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionSeleccionarPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.PerinatalAtencion.*, dbo.PerinatalAtencionDiagnosticos.idAtencion
FROM         dbo.PerinatalAtencion INNER JOIN
                      dbo.PerinatalAtencionDiagnosticos ON dbo.PerinatalAtencion.idPerinatalAtencion = dbo.PerinatalAtencionDiagnosticos.idPerinatalAtencion
where  dbo.PerinatalAtencionDiagnosticos.idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionSeleccionarPorIdPaciente]
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT dbo.PerinatalAtencion.idPerinatalAtencion AS xx, dbo.PerinatalAtencion.idPerinatalAtencion, dbo.PerinatalAtencion.idPaciente,
                      dbo.PerinatalAtencion.idModulo, dbo.PerinatalAtencion.GrafXedadEnMeses, dbo.PerinatalAtencion.GrafYpercentilTE,
                      dbo.PerinatalAtencion.GrafYpercentilPT, dbo.PerinatalAtencion.GrafYpercentilPE, dbo.PerinatalAtencion.GrafYimc,
                      dbo.PerinatalAtencion.FechaAtencion, dbo.PerinatalAtencion.CredN, dbo.PerinatalAtencionDiaria.idAtencion
FROM         dbo.PerinatalAtencion INNER JOIN
                      dbo.PerinatalAtencionDiaria ON dbo.PerinatalAtencion.idPerinatalAtencion = dbo.PerinatalAtencionDiaria.idPerinatalAtencion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.PerinatalAtencionDiaria.idAtencion = dbo.Atenciones.IdAtencion
where    dbo.PerinatalAtencion.idPaciente = @IdPaciente and dbo.Atenciones.idEstadoAtencion<>0
     ORDER BY dbo.PerinatalAtencion.FechaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.FechaNacimiento,
                      dbo.Pacientes.NroHistoriaClinica, dbo.PerinatalAtencion.FechaAtencion, dbo.PerinatalAtencion.idPaciente, dbo.PerinatalAtencionCred.EdadEnAnios,
                      dbo.PerinatalAtencionCred.CredNumero, dbo.PerinatalAtencionCred.CredCheck, dbo.PerinatalAtencionCred.idAtencion,
                      dbo.Atenciones.idEstadoAtencion, dbo.Pacientes.Email, dbo.Pacientes.Telefono, dbo.Distritos.Nombre AS Distrito, dbo.Provincias.Nombre AS Provincia,
                      dbo.Departamentos.Nombre AS Dpto
FROM         dbo.Provincias INNER JOIN
                      dbo.Distritos ON dbo.Provincias.IdProvincia = dbo.Distritos.IdProvincia INNER JOIN
                      dbo.Departamentos ON dbo.Provincias.IdDepartamento = dbo.Departamentos.IdDepartamento RIGHT OUTER JOIN
                      dbo.Pacientes INNER JOIN
                      dbo.PerinatalAtencion ON dbo.Pacientes.IdPaciente = dbo.PerinatalAtencion.idPaciente INNER JOIN
                      dbo.PerinatalAtencionCred ON dbo.PerinatalAtencion.idPerinatalAtencion = dbo.PerinatalAtencionCred.idPerinatalAtencion INNER JOIN
                      dbo.Atenciones ON dbo.PerinatalAtencionCred.idAtencion = dbo.Atenciones.IdAtencion ON dbo.Distritos.IdDistrito = dbo.Pacientes.IdDistritoDomicilio
WHERE     (dbo.PerinatalAtencionCred.CredNumero > 0) AND (dbo.Atenciones.idEstadoAtencion <> 0)
ORDER BY dbo.Pacientes.ApellidoPaterno,  dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre, dbo.Pacientes.FechaNacimiento,dbo.PerinatalAtencion.idPaciente, dbo.PerinatalAtencion.FechaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalAtencionXidPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalAtencionXidPaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT dbo.PerinatalAtencion.idPerinatalAtencion AS xx, dbo.PerinatalAtencion.*, dbo.PerinatalAtencionDiaria.idAtencion
             FROM         dbo.PerinatalAtencion INNER JOIN
                                  dbo.PerinatalAtencionDiaria ON dbo.PerinatalAtencion.idPerinatalAtencion = dbo.PerinatalAtencionDiaria.idPerinatalAtencion
             where dbo.PerinatalAtencion.idPaciente =  @lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalAtencionXidPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCie10ModificarCodigoHis]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCie10ModificarCodigoHis]
	@IdModulo [int],
	@IdLista [int],
	@IdDiagnostico [int],
	@CodigoHIS [varchar](7)
WITH EXECUTE AS CALLER
AS
UPDATE PerinatalCatalogoCie10
SET CodigoHIS=@CodigoHIS
WHERE IdModulo=@IdModulo AND IdLista=@IdLista AND IdDiagnostico=@IdDiagnostico
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCie10ModificarCodigoHis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCie10SeleccionarPorIdModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCie10SeleccionarPorIdModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.PerinatalCatalogoCie10.idModulo, dbo.PerinatalCatalogoCie10.idLista, dbo.Diagnosticos.CodigoCIE2004,
                                  dbo.Diagnosticos.Descripcion, dbo.PerinatalCatalogoCie10.idDiagnostico,dbo.PerinatalCatalogoCie10.RangoInicio,dbo.PerinatalCatalogoCie10.RangoFinal,dbo.PerinatalCatalogoCie10.codigoHIS
              FROM          dbo.PerinatalCatalogoCie10 LEFT OUTER JOIN
                                  dbo.Diagnosticos ON dbo.PerinatalCatalogoCie10.idDiagnostico = dbo.Diagnosticos.IdDiagnostico
              WHERE      dbo.PerinatalCatalogoCie10.idModulo=@IdModulo
              ORDER BY dbo.Diagnosticos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCie10SeleccionarPorIdModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCie10SeleccionarTodoporIdModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCie10SeleccionarTodoporIdModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCie10 where idModulo=@IdModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCie10SeleccionarTodoporIdModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCie10xidModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCie10xidModulo]
	@idModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCie10 where idModulo=@idModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCie10xidModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptAutomaticosSeleccionarporIdModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptAutomaticosSeleccionarporIdModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCptAutomaticos where idModulo=@IdModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptAutomaticosSeleccionarporIdModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptAutomaticosXidModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptAutomaticosXidModulo]
	@idModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCptAutomaticos where idModulo=@idModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptAutomaticosXidModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptModificarCodigoHIS]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptModificarCodigoHIS]
	@IdModulo [int],
	@IdLista [int],
	@IdProducto [int],
	@CodigoHIS [varchar](7)
WITH EXECUTE AS CALLER
AS
UPDATE PerinatalCatalogoCpt
SET CodigoHIS=@CodigoHIS
WHERE IdModulo=@IdModulo AND IdLista=@IdLista AND IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptModificarCodigoHIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptSeleccionarPorIdModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptSeleccionarPorIdModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
if @IdModulo=0
	SELECT        dbo.PerinatalCatalogoCpt.idModulo, dbo.PerinatalCatalogoCpt.idLista,
                                   dbo.PerinatalCatalogoCpt.idProducto , dbo.FactCatalogoServicios.codigo, dbo.FactCatalogoServicios.Nombre
              FROM           dbo.PerinatalCatalogoCpt LEFT OUTER JOIN
                                   dbo.FactCatalogoServicios ON dbo.PerinatalCatalogoCpt.idProducto = dbo.FactCatalogoServicios.IdProducto
              ORDER BY  dbo.FactCatalogoServicios.Nombre
else
	SELECT        dbo.PerinatalCatalogoCpt.idModulo, dbo.PerinatalCatalogoCpt.idLista,
                                   dbo.PerinatalCatalogoCpt.idProducto , dbo.FactCatalogoServicios.codigo, dbo.FactCatalogoServicios.Nombre
              FROM           dbo.PerinatalCatalogoCpt LEFT OUTER JOIN
                                   dbo.FactCatalogoServicios ON dbo.PerinatalCatalogoCpt.idProducto = dbo.FactCatalogoServicios.IdProducto
              WHERE       dbo.PerinatalCatalogoCpt.idModulo=@IdModulo
              ORDER BY  dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptSeleccionarPorIdModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptSeleccionarTodoporIDModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptSeleccionarTodoporIDModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCpt where idModulo=@IdModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptSeleccionarTodoporIDModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoCptXidModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoCptXidModulo]
	@idModulo [int]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCpt where idModulo=@idModulo
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoCptXidModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoDeProcedimientosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoDeProcedimientosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCpt
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoDeProcedimientosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoDiagnosticosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoDiagnosticosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from PerinatalCatalogoCie10
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoDiagnosticosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalCatalogoMedicamentosSeleccionarPorIdModulo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PerinatalCatalogoMedicamentosSeleccionarPorIdModulo]
	@IdModulo [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.PerinatalCatalogoMedicamentos.idModulo, dbo.PerinatalCatalogoMedicamentos.IdProducto,
                                  dbo.PerinatalCatalogoMedicamentos.Cantidad , dbo.FactCatalogoBienesInsumos.codigo, dbo.FactCatalogoBienesInsumos.Nombre
             FROM           dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                  dbo.PerinatalCatalogoMedicamentos ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.PerinatalCatalogoMedicamentos.IdProducto
             WHERE       dbo.PerinatalCatalogoMedicamentos.idModulo=@IdModulo
             ORDER BY  dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalCatalogoMedicamentosSeleccionarPorIdModulo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PerinatalModificarOrdenServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PerinatalModificarOrdenServicio]
	@idLista [int],
	@idAtencion [int],
	@IdOrden [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE PerinatalAtencionProcedimientos SET
		IdOrden = @IdOrden
	where idLista = @idLista AND idAtencion=@idAtencion;
GO
ALTER AUTHORIZATION ON [dbo].[PerinatalModificarOrdenServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PeriodoTiempoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PeriodoTiempoAgregar]
	@IdPeriodoTiempo [int] OUTPUT,
	@PeriodoTiempo [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into PeriodoTiempo (
PeriodoTiempo) values (
@PeriodoTiempo)
set @IdPeriodoTiempo = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPeriodoTiempo,'PeriodoTiempo'
GO
ALTER AUTHORIZATION ON [dbo].[PeriodoTiempoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PeriodoTiempoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PeriodoTiempoEliminar]
	@IdPeriodoTiempo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from PeriodoTiempo
where IdPeriodoTiempo = @IdPeriodoTiempo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPeriodoTiempo,'PeriodoTiempo'
GO
ALTER AUTHORIZATION ON [dbo].[PeriodoTiempoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PeriodoTiempoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PeriodoTiempoModificar]
	@IdPeriodoTiempo [int],
	@PeriodoTiempo [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update PeriodoTiempo
set
PeriodoTiempo = @PeriodoTiempo
where IdPeriodoTiempo = @IdPeriodoTiempo
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPeriodoTiempo,'PeriodoTiempo'
GO
ALTER AUTHORIZATION ON [dbo].[PeriodoTiempoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PeriodoTiempoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PeriodoTiempoSeleccionarPorId]
	@IdPeriodoTiempo [int]
WITH EXECUTE AS CALLER
AS
select * from PeriodoTiempo
where IdPeriodoTiempo = @IdPeriodoTiempo
GO
ALTER AUTHORIZATION ON [dbo].[PeriodoTiempoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PermisosAgregar]
	@Modulo [varchar](50),
	@Descripcion [varchar](100),
	@IdPermiso [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Permisos (
Modulo,Descripcion) values (
@Modulo,@Descripcion)
set @IdPermiso = @@identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPermiso,'Permisos'
GO
ALTER AUTHORIZATION ON [dbo].[PermisosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PermisosEliminar]
	@IdPermiso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Permisos
where IdPermiso = @IdPermiso
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPermiso,'Permisos'
GO
ALTER AUTHORIZATION ON [dbo].[PermisosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PermisosModificar]
	@Modulo [varchar](50),
	@Descripcion [varchar](100),
	@IdPermiso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Permisos
set
Modulo = @Modulo,
Descripcion = @Descripcion
where IdPermiso = @IdPermiso
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPermiso,'Permisos'
GO
ALTER AUTHORIZATION ON [dbo].[PermisosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PermisosSeleccionarPorId]
	@IdPermiso [int]
WITH EXECUTE AS CALLER
AS
select * from Permisos
where IdPermiso = @IdPermiso
GO
ALTER AUTHORIZATION ON [dbo].[PermisosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PermisosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdPermiso, Descripcion from Permisos order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[PermisosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PermisosSoloFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PermisosSoloFarmacia]
WITH EXECUTE AS CALLER
AS
select * from permisos where modulo='Farmacia' order by idPermiso
GO
ALTER AUTHORIZATION ON [dbo].[PermisosSoloFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PreparaTablasDBFhis1]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PreparaTablasDBFhis1]
WITH EXECUTE AS CALLER
AS
delete from his1
select * from his1
GO
ALTER AUTHORIZATION ON [dbo].[PreparaTablasDBFhis1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PreparaTablasDBFhisA]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PreparaTablasDBFhisA]
WITH EXECUTE AS CALLER
AS
delete from hisA
select * from hisA
GO
ALTER AUTHORIZATION ON [dbo].[PreparaTablasDBFhisA] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PreparaTablasDBFhisLote]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PreparaTablasDBFhisLote]
WITH EXECUTE AS CALLER
AS
delete from hisLote
select * from hisLote
GO
ALTER AUTHORIZATION ON [dbo].[PreparaTablasDBFhisLote] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PreparaTablasDBFsip2000]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PreparaTablasDBFsip2000]
WITH EXECUTE AS CALLER
AS
delete from gale_sip
     select * from gale_sip
GO
ALTER AUTHORIZATION ON [dbo].[PreparaTablasDBFsip2000] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCabeceraAgregar]
	@IdPrograma [int],
	@IdProcabecera [int] OUTPUT,
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO ProCabecera (IdPrograma,IdPaciente) VALUES (@IdPrograma,@IdPaciente)
set @IdProcabecera = @@identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraConfigDatosSeleccionarPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCabeceraConfigDatosSeleccionarPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT IdCabDato,Cab_Texto,Cab_Tipo,Cab_Ancho,Cab_EsDatoObligatorio,Cab_TextoToolTip,Cab_EsDatoCalculado,Cab_FormulaCalculaValor,Cab_EsDatoCalculador,Cab_RangoInicial,Cab_RangoFinal,Cab_Fila,Cab_Columna
FROM ProCabeceraConfigDatos
WHERE IdPrograma=@IdPrograma
ORDER BY Cab_Fila,Cab_Columna ASC
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraConfigDatosSeleccionarPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraDatoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCabeceraDatoAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdCabDato [int],
	@CabDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProCabeceraDato (
IdPrograma,IdProCabecera,IdCabDato,CabDato) values (
@IdPrograma,@IdProCabecera,@IdCabDato,@CabDato)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProCabeceraDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraDatoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraDatoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCabeceraDatoEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdCabDato [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProCabeceraDato
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdCabDato=@IdCabDato
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProCabeceraDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraDatoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraDatoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCabeceraDatoModificar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdCabDato [int],
	@CabDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProCabeceraDato
set
CabDato = @CabDato
where IdPrograma = @IdPrograma and IdProCabecera = @IdProCabecera and IdCabDato = @IdCabDato
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPrograma,'ProCabeceraDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraDatoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraDatoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCabeceraDatoSeleccionarPorId]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdCabDato [int]
WITH EXECUTE AS CALLER
AS
select * from ProCabeceraDato
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdCabDato=@IdCabDato
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraDatoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCabeceraEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProCabecera where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCabeceraModificar]
	@IdPrograma [int],
	@IdProcabecera [int],
	@IdPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProCabecera
set
IdPaciente = @IdPaciente
where IdPrograma = @IdPrograma and IdProcabecera = @IdProcabecera
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPrograma,'ProCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCabeceraSeleccionarPorId]
	@IdPrograma [int],
	@IdProCabecera [int]
WITH EXECUTE AS CALLER
AS
select * from ProCabecera
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera
GO
ALTER AUTHORIZATION ON [dbo].[ProCabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCatalogoControlesPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProCatalogoControlesPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT IdControl,Descripcion
FROM ProCatalogoControles
WHERE IdPrograma=@IdPrograma
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoControlesPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCatalogoCptSeleccionarPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCatalogoCptSeleccionarPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT P.IdProducto,RTRIM(D.Codigo) as CODIGO,D.Nombre,
RTRIM(D.Codigo) + ' = '+  D.Nombre as PROCEDIMIENTO
FROM ProCatalogoProcedimientos P INNER JOIN FactCatalogoServicios D ON P.IdProducto=D.IdProducto
WHERE P.IDPROGRAMA=@IdPrograma
ORDER BY D.Nombre ASC
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoCptSeleccionarPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCatalogoDiagnosticosSeleccionarPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCatalogoDiagnosticosSeleccionarPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT P.IDDIAGNOSTICO,RTRIM(D.CODIGOCIE10) as CODIGOCIE10,D.DESCRIPCION,  RTRIM(D.CODIGOCIE10) + '= '+  D.DESCRIPCION as DIAGNOSTICO
FROM PROCATALOGODIAGNOSTICOS P INNER JOIN DIAGNOSTICOS D ON P.IDDIAGNOSTICO=D.IDDIAGNOSTICO
WHERE P.IDPROGRAMA=@IdPrograma
ORDER BY D.CODIGOCIE10 ASC
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoDiagnosticosSeleccionarPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCatalogoProcedimientosSelecionarPorIdProgramaIdDiagnostico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCatalogoProcedimientosSelecionarPorIdProgramaIdDiagnostico]
	@IdPrograma [int],
	@IdDiagnostico [int]
WITH EXECUTE AS CALLER
AS
SELECT P.IDDIAGNOSTICO,P.IDPRODUCTO,S.NOMBRE,D.CodigoCIE10
FROM PROCATALOGOPROCEDIMIENTOS P INNER JOIN FACTCATALOGOSERVICIOS S ON P.IDPRODUCTO=S.IDPRODUCTO
INNER JOIN DIAGNOSTICOS D ON P.IDDIAGNOSTICO=D.IDDIAGNOSTICO
WHERE P.IDPROGRAMA=@IdPrograma AND P.IDDIAGNOSTICO=@IdDiagnostico
order by S.NOMBRE asc
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoProcedimientosSelecionarPorIdProgramaIdDiagnostico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProCatalogoTratamientosSeleccionarPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProCatalogoTratamientosSeleccionarPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT P.IdProducto,F.Codigo, RTRIM(F.NOMBRE) AS Tratamientos
FROM ProCatalogoTratamientos P inner join FactCatalogoBienesInsumos F ON P.IdProducto=F.IdProducto
WHERE P.IdPrograma=@IdPrograma
ORDER BY RTRIM(F.NOMBRE) asc
GO
ALTER AUTHORIZATION ON [dbo].[ProCatalogoTratamientosSeleccionarPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosAgregar]
	@EdadMinDias [int],
	@IdProducto [int],
	@IdTipoSexo [int],
	@DescripcionOPCS [char](10),
	@CodigoOPCS [char](10),
	@EdadMaxDias [int],
	@Restriccion [bit],
	@CodigoCPT2004 [char](7),
	@CodigoCPT99 [char](7),
	@Descripcion [varchar](250),
	@IdProcedimiento [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Procedimientos (
EdadMinDias,IdProducto,IdTipoSexo,DescripcionOPCS,CodigoOPCS,EdadMaxDias,Restriccion,CodigoCPT2004,CodigoCPT99,Descripcion) values (
@EdadMinDias,@IdProducto,@IdTipoSexo,@DescripcionOPCS,@CodigoOPCS,@EdadMaxDias,@Restriccion,@CodigoCPT2004,@CodigoCPT99,@Descripcion)
set @IdProcedimiento = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosEliminar]
	@IdProcedimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Procedimientos
where IdProcedimiento = @IdProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProcedimientosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select IdProcedimiento, CodigoCPT2004, Descripcion from Procedimientos    '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosModificar]
	@EdadMinDias [int],
	@IdProducto [int],
	@IdTipoSexo [int],
	@DescripcionOPCS [char](10),
	@CodigoOPCS [char](10),
	@EdadMaxDias [int],
	@Restriccion [bit],
	@CodigoCPT2004 [char](7),
	@CodigoCPT99 [char](7),
	@Descripcion [varchar](250),
	@IdProcedimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Procedimientos
set
EdadMinDias = @EdadMinDias,
IdProducto = @IdProducto,
IdTipoSexo = @IdTipoSexo,
DescripcionOPCS = @DescripcionOPCS,
CodigoOPCS = @CodigoOPCS,
EdadMaxDias = @EdadMaxDias,
Restriccion = @Restriccion,
CodigoCPT2004 = @CodigoCPT2004,
CodigoCPT99 = @CodigoCPT99,
Descripcion = @Descripcion
where IdProcedimiento = @IdProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosPorAtencionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosPorAtencionAgregar]
	@IdDetalleProducto [int],
	@IdMedico [int],
	@IdServicio [int],
	@IdCuentaAtencion [int],
	@IdFacturacionProcedimiento [int] OUTPUT,
	@HoraRealizacion [char](5),
	@FechaRealizacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProcedimientosPorAtencion (
IdDetalleProducto,IdMedico,IdServicio,IdCuentaAtencion,HoraRealizacion,FechaRealizacion) values (
@IdDetalleProducto,@IdMedico,@IdServicio,@IdCuentaAtencion,@HoraRealizacion,@FechaRealizacion)
set @IdFacturacionProcedimiento = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosPorAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosPorAtencionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosPorAtencionEliminar]
	@IdFacturacionProcedimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProcedimientosPorAtencion
where IdFacturacionProcedimiento = @IdFacturacionProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosPorAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosPorAtencionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosPorAtencionModificar]
	@IdDetalleProducto [int],
	@IdMedico [int],
	@IdServicio [int],
	@IdCuentaAtencion [int],
	@IdFacturacionProcedimiento [int],
	@HoraRealizacion [char](5),
	@FechaRealizacion [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProcedimientosPorAtencion
set
IdDetalleProducto = @IdDetalleProducto,
IdMedico = @IdMedico,
IdServicio = @IdServicio,
IdCuentaAtencion = @IdCuentaAtencion,
HoraRealizacion = @HoraRealizacion,
FechaRealizacion = @FechaRealizacion
where IdFacturacionProcedimiento = @IdFacturacionProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosPorAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosPorAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosPorAtencionSeleccionarPorId]
	@IdFacturacionProcedimiento [int]
WITH EXECUTE AS CALLER
AS
select * from ProcedimientosPorAtencion
where IdFacturacionProcedimiento = @IdFacturacionProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosPorAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosSeleccionarPorCodigo]
	@CodigoCpt [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.Nombre, dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServiciosPtos.idPuntoCarga, dbo.FactCatalogoServicios.Codigo,
	           dbo.FactCatalogoServicios.IdServicioSubGrupo
               FROM          dbo.FactCatalogoServicios INNER JOIN
                                   dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto
               WHERE      dbo.FactCatalogoServicios.Codigo=@CodigoCpt
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosSeleccionarPorId]
	@IdProcedimiento [int]
WITH EXECUTE AS CALLER
AS
select * from Procedimientos
where IdProcedimiento = @IdProcedimiento
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProcedimientosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from Procedimientos
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosXCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProcedimientosXCodigo]
	@CodigoCPT2004 [varchar](7)
WITH EXECUTE AS CALLER
AS
select * from Procedimientos where CodigoCPT2004 = @CodigoCPT2004
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosXCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProcedimientosXpaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProcedimientosXpaciente]
	@lnIdPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdPaciente, dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicio.IdOrden AS Expr1, dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FacturacionServicioDespacho.IdProducto,
                      dbo.FacturacionServicioDespacho.Cantidad, LTRIM(dbo.FactCatalogoServicios.Codigo) + ' ' + dbo.FactCatalogoServicios.Nombre AS item,
                      dbo.FactCatalogoServicios.Codigo, dbo.FactOrdenServicio.FechaDespacho,
                     dbo.Empleados.ApellidoPaterno+' '+ dbo.Empleados.ApellidoMaterno+' '+ dbo.Empleados.Nombres as UsuarioDespacho
FROM         dbo.FactOrdenServicio INNER JOIN
                      dbo.FacturacionServicioDespacho ON dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioDespacho.idOrden LEFT OUTER JOIN
                      dbo.Empleados ON dbo.FactOrdenServicio.IdUsuario = dbo.Empleados.IdEmpleado LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto
WHERE  dbo.FactOrdenServicio.IdEstadoFacturacion<>9 AND dbo.FactOrdenServicio.IdPaciente=@lnIdPaciente
GO
ALTER AUTHORIZATION ON [dbo].[ProcedimientosXpaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProConsultarActualProgramaPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProConsultarActualProgramaPaciente]
	@IdPrograma [int],
	@IdPaciente [int]
WITH EXECUTE AS CALLER
AS
Select Top 1 IdProcabecera
From ProCabecera P
Where P.IdPrograma=@IdPrograma and P.IdPaciente=@IdPaciente
order by IdProCabecera desc
GO
ALTER AUTHORIZATION ON [dbo].[ProConsultarActualProgramaPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProConsultarCabeceraControlPorIdPacienteIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProConsultarCabeceraControlPorIdPacienteIdAtencion]
	@IdPrograma [int],
	@IdPaciente [int],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
Select c.idprocabecera,t.idcontrol
from procabecera c inner join procontroles t on c.idprograma=t.idprograma and c.idprocabecera=t.idprocabecera
where c.idprograma=@IdPrograma and idpaciente=@IdPaciente and t.idatencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ProConsultarCabeceraControlPorIdPacienteIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProConsultarControles]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProConsultarControles]
	@IdPrograma [int],
	@IdProCabecera [int]
WITH EXECUTE AS CALLER
AS
SELECT IDCONTROL,IDATENCION,FECHACONTROL,CONTROLOTROEESS,IDESTABLECIMIENTO
 FROM PROCONTROLES
WHERE IdPrograma=@IdPrograma AND IdProCabecera=@IdProCabecera
GO
ALTER AUTHORIZATION ON [dbo].[ProConsultarControles] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProConsultarDatosCabecera]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProConsultarDatosCabecera]
	@IdPrograma [int],
	@IdProCabecera [int]
WITH EXECUTE AS CALLER
AS
Select p.IdCabdato,p.CabDato,f.cab_tipo,f.cab_ancho
From ProCabeceraDato P inner join ProCabeceraConfigDatos F on P.IdCabDato=F.IdCabDato
Where P.IdPrograma=@IdPrograma and P.IdProCabecera=@IdProCabecera
GO
ALTER AUTHORIZATION ON [dbo].[ProConsultarDatosCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlConfigDatoSeleccionarPorIdPrograma]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProControlConfigDatoSeleccionarPorIdPrograma]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
SELECT IdControlDato,Control_Texto,Control_Tipo,Control_Ancho,Control_EsDatoObligatorio,Control_TextoToolTip,Control_EsPresion,Control_EsPeso,Control_EsTalla,
Control_EsDatoCalculado,Control_FormulaCalculaValor,Control_EsDatoGrafico,Control_EsGraficoEjeX,Control_Fila,Control_Columna
FROM ProControlConfigDatos
WHERE IdPrograma=@IdPrograma
GO
ALTER AUTHORIZATION ON [dbo].[ProControlConfigDatoSeleccionarPorIdPrograma] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlConfigGrafico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlConfigGrafico]
	@IdPrograma [int],
	@EsGraficoX [bit]
WITH EXECUTE AS CALLER
AS
select idcontroldato,control_texto,control_textotooltip,control_esgraficoejex
from procontrolconfigdatos
where idprograma=@IdPrograma and control_esdatografico=1 and control_esgraficoejex=@EsGraficoX
GO
ALTER AUTHORIZATION ON [dbo].[ProControlConfigGrafico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlDatoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProControlDatoAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdControlDato [int],
	@ControlDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProControlDato (
IdPrograma,IdProCabecera,IdControl,IdControlDato,ControlDato) values (
@IdPrograma,@IdProCabecera,@IdControl,@IdControlDato,@ControlDato)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProControlDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDatoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlDatoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlDatoEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdControlDato [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProControlDato
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl and IdControlDato=@IdControlDato
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProControlDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDatoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlDatoEliminarTodo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProControlDatoEliminarTodo]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProControlDato
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProControlDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDatoEliminarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlDatoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlDatoModificar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdControlDato [int],
	@ControlDato [varchar](200),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProControlDato
set ControlDato = @ControlDato
where IdPrograma = @IdPrograma and IdProCabecera = @IdProCabecera and IdControl = @IdControl and IdControlDato = @IdControlDato
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPrograma,'ProControlDato'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDatoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlDatoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlDatoSeleccionarPorId]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
Select p.IdControlDato,p.ControlDato,f.control_tipo,f.control_ancho
From ProControlDato P inner join ProControlConfigDatos F on P.IdControlDato=F.IdControlDato
Where P.IdPrograma=@IdPrograma and P.IdProCabecera=@IdProCabecera and P.IdControl=@IdControl
GO
ALTER AUTHORIZATION ON [dbo].[ProControlDatoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProControlesAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdAtencion [int],
	@FechaControl [varchar](10),
	@ControlOtroEESS [bit],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProControles (
IdPrograma,IdProCabecera,IdControl,IdAtencion,FechaControl,ControlOtroEESS,IdEstablecimiento) values (
@IdPrograma,@IdProCabecera,@IdControl,@IdAtencion,@FechaControl,@ControlOtroEESS,@IdEstablecimiento)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProControles'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlesEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProDiagnosticos where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
delete from ProProcedimientos where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
delete from ProTratamientos where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
delete from ProControlDato where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
delete from ProControles where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProControles'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProControlesModificar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdAtencion [int],
	@FechaControl [varchar](10),
	@ControlOtroEESS [bit],
	@IdEstablecimiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProControles
set
IdAtencion = @IdAtencion,
FechaControl = @FechaControl,
ControlOtroEESS=@ControlOtroEESS,
IdEstablecimiento=@IdEstablecimiento
where IdPrograma = @IdPrograma and IdProCabecera = @IdProCabecera and IdControl = @IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPrograma,'ProControles'
GO
ALTER AUTHORIZATION ON [dbo].[ProControlesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProControlesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProControlesSeleccionarPorId]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
select * from ProControles
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
GO
ALTER AUTHORIZATION ON [dbo].[ProControlesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProDiagnosticosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProDiagnosticosAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdDiagnostico [int],
	@Principal [bit],
	@labConfHIS [varchar](3),
	@IdSubClasificacionDX [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProDiagnosticos (
IdPrograma,IdProCabecera,IdControl,IdDiagnostico,Principal,labConfHIS,IdSubClasificacionDX) values (
@IdPrograma,@IdProCabecera,@IdControl,@IdDiagnostico,@Principal,@labConfHIS,@IdSubClasificacionDX)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProDiagnosticosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProDiagnosticosEliminar]
	@IdPrograma [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProDiagnosticos
where IdPrograma = @IdPrograma
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProDiagnosticosEliminarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProDiagnosticosEliminarTodos]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
delete from ProDiagnosticos
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticosEliminarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProDiagnosticosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProDiagnosticosSeleccionarPorId]
	@IdPrograma [int]
WITH EXECUTE AS CALLER
AS
select * from ProDiagnosticos
where IdPrograma = @IdPrograma
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProDiagnosticosSeleccionarPorIdControl]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProDiagnosticosSeleccionarPorIdControl]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
SELECT P.IDDIAGNOSTICO,RTRIM(D.CODIGOCIE10) as CODIGOCIE10,rtrim(D.DESCRIPCION) as DESCRIPCION,P.PRINCIPAL,P.labConfHIS,P.IdSubClasificacionDX
FROM PRODIAGNOSTICOS P INNER JOIN DIAGNOSTICOS D ON P.IDDIAGNOSTICO=D.IDDIAGNOSTICO
WHERE P.IDPROGRAMA=@IdPrograma AND P.IDPROCABECERA=@IdProCabecera AND P.IDCONTROL=@IdControl
ORDER BY D.CODIGOCIE10 ASC
GO
ALTER AUTHORIZATION ON [dbo].[ProDiagnosticosSeleccionarPorIdControl] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProductoEsParaOrdenesMedicas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProductoEsParaOrdenesMedicas]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
SELECT B.IdProducto,B.Nombre, B.EsCPT,B.IdCentroCosto,*
	FROM FactCatalogoServiciosPtos A INNER JOIN
	FactCatalogoServicios B ON A.idProducto=B.IdProducto
	WHERE idPuntoCarga IN (21,23,20,22,2,32,11) AND B.EsCPT=1 AND B.IdProducto=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[ProductoEsParaOrdenesMedicas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaActualizaTiempoPromedioAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaActualizaTiempoPromedioAtencion]
	@idProgramacion [int],
	@TiempoPromedioAtencion [int]
WITH EXECUTE AS CALLER
AS
update     ProgramacionMedica set TiempoPromedioAtencion=@TiempoPromedioAtencion where idProgramacion=@idProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaActualizaTiempoPromedioAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaAgregar]
	@IdEspecialidad [int],
	@IdTurno [int],
	@Color [int],
	@IdServicio [int],
	@IdProgramacion [int] OUTPUT,
	@IdMedico [int],
	@IdDepartamento [int],
	@IdTipoServicio [int],
	@Fecha [datetime],
	@HoraInicio [char](5),
	@HoraFin [char](5),
	@Descripcion [varchar](100),
	@IdTipoProgramacion [int],
	@FechaReg [datetime],
	@TiempoPromedioAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO ProgramacionMedica (IdEspecialidad, IdTurno, Color, IdServicio,
		IdMedico, IdDepartamento, IdTipoServicio, Fecha, HoraInicio, HoraFin,
		Descripcion, IdTipoProgramacion, FechaReg, TiempoPromedioAtencion, HoraFinProgramacion)
	VALUES (@IdEspecialidad, @IdTurno, @Color, @IdServicio,
		@IdMedico, @IdDepartamento, @IdTipoServicio, @Fecha, @HoraInicio, @HoraFin,
		@Descripcion, @IdTipoProgramacion, @FechaReg, @TiempoPromedioAtencion, @HoraFin)

	SET @IdProgramacion = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProgramacion,'ProgramacionMedica'
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaCitaMasProxima]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaCitaMasProxima]
	@lIdMedico [int],
	@idEspecialidad [int],
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
DECLARE @FechaActual datetime

	SET @FechaActual = CONVERT(varchar(10), getDate(), 112) + ' ' + CONVERT(varchar(5), getDate(), 108)

	IF @lIdMedico IS NOT NULL AND @idEspecialidad IS NOT NULL
	BEGIN
		SELECT TOP 1 PM.IdProgramacion,
					PM.Fecha,
					PM.HoraInicio,
	                PM.HoraFin,
	                PM.IdEspecialidad,
	                PM.IdMedico
		FROM dbo.ProgramacionMedica AS PM
		WHERE (SELECT COUNT(1) FROM dbo.Citas AS C
					WHERE PM.IdProgramacion = C.IdProgramacion) * PM.TiempoPromedioAtencion <
						DATEDIFF(minute, PM.HoraInicio, PM.HoraFin)
			AND PM.IdMedico = @lIdMedico
			AND PM.IdEspecialidad = @idEspecialidad
			AND PM.IdTipoServicio = @IdTipoServicio
			AND CONVERT(datetime, CONVERT(varchar(10), PM.Fecha, 112) + ' '
					+ CONVERT(varchar(5), PM.HoraFin, 108)) >= @FechaActual
		ORDER BY PM.Fecha ASC, PM.HoraInicio ASC
	END
	ELSE IF @idEspecialidad IS NOT NULL
	BEGIN
		SELECT TOP 1 PM.IdProgramacion,
					PM.Fecha,
					PM.HoraInicio,
	                PM.HoraFin,
	                PM.IdEspecialidad,
	                PM.IdMedico
		FROM dbo.ProgramacionMedica AS PM
		WHERE (SELECT COUNT(1) FROM dbo.Citas AS C
					WHERE PM.IdProgramacion = C.IdProgramacion) * PM.TiempoPromedioAtencion <
						DATEDIFF(minute, PM.HoraInicio, PM.HoraFin)
			AND PM.IdEspecialidad = @idEspecialidad
			AND PM.IdTipoServicio = @IdTipoServicio
			AND CONVERT(datetime, CONVERT(varchar(10), PM.Fecha, 112) + ' '
					+ CONVERT(varchar(5), PM.HoraFin, 108)) >= @FechaActual
		ORDER BY PM.Fecha ASC, PM.HoraInicio ASC
	END
	ELSE
	BEGIN
		SELECT TOP 1 PM.IdProgramacion,
					PM.Fecha,
					PM.HoraInicio,
	                PM.HoraFin,
	                PM.IdEspecialidad,
	                PM.IdMedico
		FROM dbo.ProgramacionMedica AS PM
		WHERE (SELECT COUNT(1) FROM dbo.Citas AS C
					WHERE PM.IdProgramacion = C.IdProgramacion) * PM.TiempoPromedioAtencion <
						DATEDIFF(minute, PM.HoraInicio, PM.HoraFin)
			AND PM.IdMedico = @lIdMedico
			AND PM.IdTipoServicio = @IdTipoServicio
			AND CONVERT(datetime, CONVERT(varchar(10), PM.Fecha, 112) + ' '
					+ CONVERT(varchar(5), PM.HoraFin, 108)) >= @FechaActual
		ORDER BY PM.Fecha ASC, PM.HoraInicio ASC
	END
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaCitaMasProxima] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaConTiempoPromedioAtencionNULL]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaConTiempoPromedioAtencionNULL]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*
FROM         dbo.ProgramacionMedica
WHERE     (TiempoPromedioAtencion IS NULL) OR
                      (TiempoPromedioAtencion = 0)
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaConTiempoPromedioAtencionNULL] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaEliminar]
	@IdProgramacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProgramacionMedica
where IdProgramacion = @IdProgramacion
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdProgramacion,'ProgramacionMedica'
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaEliminarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaEliminarPorId]
	@IdProgramacion [int]
WITH EXECUTE AS CALLER
AS
DELETE FROM ProgramacionMedica WHERE idProgramacion=@IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaEliminarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaEliminarPorMedicoYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaEliminarPorMedicoYMes]
	@IdMedico [int],
	@Mes [int],
	@Anio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProgramacionMedica
where IdMedico = @IdMedico
and Month(Fecha) = @Mes
and Year(Fecha) = @Anio

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',0,'ProgramacionMedica'
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaEliminarPorMedicoYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaModificar]
	@IdEspecialidad [int],
	@IdTurno [int],
	@Color [int],
	@IdServicio [int],
	@IdProgramacion [int],
	@IdMedico [int],
	@IdDepartamento [int],
	@IdTipoServicio [int],
	@Fecha [datetime],
	@HoraInicio [char](5),
	@HoraFin [char](5),
	@Descripcion [varchar](100),
	@IdTipoProgramacion [int],
	@TiempoPromedioAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
UPDATE ProgramacionMedica SET
		IdEspecialidad = @IdEspecialidad,
		IdTurno = @IdTurno,
		Color = @Color,
		IdServicio = @IdServicio,
		IdMedico = @IdMedico,
		IdDepartamento = @IdDepartamento,
		IdTipoServicio = @IdTipoServicio,
		Fecha = @Fecha,
		HoraInicio = @HoraInicio,
		HoraFin = @HoraFin,
		Descripcion = @Descripcion,
		IdTipoProgramacion = @IdTipoProgramacion,
		TiempoPromedioAtencion=@TiempoPromedioAtencion,
		HoraFinProgramacion = @HoraFin
	WHERE IdProgramacion = @IdProgramacion
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdProgramacion,'ProgramacionMedica'
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaModificarHoraPorCitaAdicional]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaModificarHoraPorCitaAdicional]
	@IdProgramacion [int],
	@HoraFin [char](5),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
DECLARE  @VarHoraFin char(5);

	SET @VarHoraFin = (SELECT HoraFinProgramacion FROM ProgramacionMedica WHERE IdProgramacion = @IdProgramacion);

	IF @VarHoraFin IS NOT NULL
	BEGIN
		IF (SELECT COUNT(1) FROM dbo.Citas WHERE EsCitaAdicional = 1 AND IdProgramacion = @IdProgramacion) = 0
		BEGIN
			SET @HoraFin = @VarHoraFin;
		END
		ELSE
		BEGIN
			SET @HoraFin = (SELECT MAX(HoraFin) FROM dbo.Citas WHERE EsCitaAdicional = 1 AND IdProgramacion = @IdProgramacion)
		END;
	END

	UPDATE ProgramacionMedica SET HoraFin = @HoraFin
	WHERE IdProgramacion = @IdProgramacion;
	--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdProgramacion,'ProgramacionMedica'
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaModificarHoraPorCitaAdicional] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaPorIdMedicoMesAnio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaPorIdMedicoMesAnio]
	@lIdMedico [int],
	@iMes [int],
	@iAnio [int]
WITH EXECUTE AS CALLER
AS
/*select *  from ProgramacionMedica
             where IdMedico = @lIdMedico
               and Month(Fecha) = @iMes
               and Year(Fecha) = @iAnio
               and IdTipoServicio = 1 order by fecha    */


SELECT     dbo.ProgramacionMedica.*, dbo.Turnos.Codigo AS Turno
FROM         dbo.ProgramacionMedica INNER JOIN
                      dbo.Turnos ON dbo.ProgramacionMedica.IdTurno = dbo.Turnos.IdTurno
             where dbo.ProgramacionMedica.IdMedico = @lIdMedico
               and Month(dbo.ProgramacionMedica.Fecha) = @iMes
               and Year(dbo.ProgramacionMedica.Fecha) = @iAnio
               and dbo.ProgramacionMedica.IdTipoServicio = 1 order by dbo.ProgramacionMedica.fecha
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaPorIdMedicoMesAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorEspecialidad]
	@idEspecialidad [int]
WITH EXECUTE AS CALLER
AS
SELECT      * from dbo.ProgramacionMedica
WHERE      dbo.ProgramacionMedica.IdEspecialidad=@idEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorFechas]
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.ProgramacionMedica.Fecha, dbo.ProgramacionMedica.IdMedico, dbo.ProgramacionMedica.IdServicio, dbo.Servicios.Nombre,
                     dbo.Servicios.IdTipoServicio, dbo.ProgramacionMedica.HoraInicio, dbo.ProgramacionMedica.HoraFin, dbo.Medicos.IdEmpleado,
                     dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres, dbo.ProgramacionMedica.IdEspecialidad,
                     dbo.ProgramacionMedica.IdProgramacion, dbo.Servicios.IdEspecialidad AS Expr1, dbo.EspecialidadCE.TiempoPromedioAtencion
FROM         dbo.EspecialidadCE INNER JOIN
                     dbo.Servicios ON dbo.EspecialidadCE.IdEspecialidad = dbo.Servicios.IdEspecialidad RIGHT OUTER JOIN
                     dbo.ProgramacionMedica ON dbo.Servicios.IdServicio = dbo.ProgramacionMedica.IdServicio LEFT OUTER JOIN
                     dbo.Empleados RIGHT OUTER JOIN
                     dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico
WHERE dbo.Servicios.IdTipoServicio=1 and dbo.ProgramacionMedica.Fecha  Between @FechaInicial and @FechaFinal
ORDER BY dbo.ProgramacionMedica.IdServicio, dbo.ProgramacionMedica.Fecha,dbo.ProgramacionMedica.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorId]
	@IdProgramacion [int]
WITH EXECUTE AS CALLER
AS
select * from ProgramacionMedica
where IdProgramacion = @IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorIdServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorIdServicio]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*, dbo.Medicos.IdMedico, dbo.Medicos.IdEmpleado, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
  dbo.Empleados.Nombres
FROM         dbo.Empleados LEFT OUTER JOIN
   dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado RIGHT OUTER JOIN
   dbo.ProgramacionMedica ON dbo.Medicos.IdMedico = dbo.ProgramacionMedica.IdMedico
where dbo.ProgramacionMedica.idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorMedicoEnOtrosServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorMedicoEnOtrosServicio]
	@IdServicio [int],
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*, dbo.Medicos.IdMedico, dbo.Medicos.IdEmpleado, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno,
	  dbo.Empleados.Nombres
	FROM         dbo.Empleados LEFT OUTER JOIN
	   dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado RIGHT OUTER JOIN
	   dbo.ProgramacionMedica ON dbo.Medicos.IdMedico = dbo.ProgramacionMedica.IdMedico
	where dbo.ProgramacionMedica.idMedico= @IdMedico AND dbo.ProgramacionMedica.idServicio != @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorMedicoEnOtrosServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorMedicoFechaServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorMedicoFechaServicio]
	@IdServicio [int],
	@IdMedico [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
IF @IdServicio = 0
	BEGIN
		Select * from ProgramacionMedica where idMedico=@IdMedico and fecha=@Fecha
	END
ELSE
	BEGIN
	           Select * from ProgramacionMedica where idMedico=@IdMedico and fecha=@Fecha and idServicio=@IdServicio
	END
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorMedicoFechaServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarPorMedicoYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarPorMedicoYMes]
	@IdMedico [int],
	@Mes [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
select * from ProgramacionMedica
where IdMedico = @IdMedico
and Month(Fecha) = @Mes
and Year(Fecha) = @Anio
order by fecha
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarPorMedicoYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarXfechaConsultorio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarXfechaConsultorio]
	@idServicio [int],
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*, dbo.MedicosEspecialidad.IdEspecialidad AS IdEspecialidadMedico, dbo.EspecialidadCE.IdProductoConsulta
     FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
                         dbo.EspecialidadCE ON dbo.ProgramacionMedica.IdEspecialidad = dbo.EspecialidadCE.IdEspecialidadCE LEFT OUTER JOIN
                         dbo.MedicosEspecialidad ON dbo.ProgramacionMedica.IdMedico = dbo.MedicosEspecialidad.IdMedico
     where dbo.ProgramacionMedica.fecha=@fecha and dbo.ProgramacionMedica.idServicio=@idServicio
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarXfechaConsultorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarXFechaMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarXFechaMedico]
	@IdMedico [int],
	@FechaProgramada [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*, dbo.MedicosEspecialidad.IdEspecialidad AS IdEspecialidadMedico, dbo.EspecialidadCE.IdProductoConsulta
FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
                     dbo.EspecialidadCE ON dbo.ProgramacionMedica.IdEspecialidad = dbo.EspecialidadCE.IdEspecialidad LEFT OUTER JOIN
                     dbo.MedicosEspecialidad ON dbo.ProgramacionMedica.IdMedico = dbo.MedicosEspecialidad.IdMedico
where dbo.ProgramacionMedica.fecha=@FechaProgramada and dbo.ProgramacionMedica.idMedico=@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarXFechaMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarXfechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarXfechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Medicos.idColegioHIS, dbo.ProgramacionMedica.Fecha, dbo.ProgramacionMedica.HoraInicio, dbo.ProgramacionMedica.HoraFin,
                      dbo.Turnos.IdTipoServicio, dbo.Turnos.idTipoActividades, dbo.ProgramacionMedica.IdEspecialidad
FROM         dbo.ProgramacionMedica INNER JOIN
                      dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico INNER JOIN
                      dbo.Turnos ON dbo.ProgramacionMedica.IdTurno = dbo.Turnos.IdTurno
WHERE  not (dbo.Medicos.idColegioHIS is null) and dbo.ProgramacionMedica.Fecha  Between @FechaInicio and @FechaFin
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarXfechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSeleccionarXidentificador]
	@IdProgramacion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.*, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
             dbo.Servicios.Nombre AS dservicio
FROM         dbo.Empleados RIGHT OUTER JOIN
                dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado RIGHT OUTER JOIN
            dbo.ProgramacionMedica ON dbo.Medicos.IdMedico = dbo.ProgramacionMedica.IdMedico LEFT OUTER JOIN
            dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio
WHERE dbo.ProgramacionMedica.idProgramacion=@IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaServiciosSeleccionarPorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaServiciosSeleccionarPorFechas]
	@FechaInicial [datetime],
	@FechaFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.ProgramacionMedica.IdProgramacion,dbo.ProgramacionMedica.Fecha, dbo.ProgramacionMedica.IdMedico, dbo.ProgramacionMedica.IdServicio, dbo.Servicios.Nombre as Servicio,
                     dbo.Servicios.IdTipoServicio,dbo.ProgramacionMedica.IdTurno, dbo.ProgramacionMedica.HoraInicio,dbo.ProgramacionMedica.HoraFin,
		     dbo.ProgramacionMedica.IdEspecialidad, dbo.Servicios.IdEspecialidad AS Expr1, dbo.EspecialidadCE.TiempoPromedioAtencion
FROM         dbo.EspecialidadCE INNER JOIN
                     dbo.Servicios ON dbo.EspecialidadCE.IdEspecialidad = dbo.Servicios.IdEspecialidad RIGHT OUTER JOIN
                     dbo.ProgramacionMedica ON dbo.Servicios.IdServicio = dbo.ProgramacionMedica.IdServicio
WHERE dbo.Servicios.IdTipoServicio=1 and dbo.ProgramacionMedica.Fecha  Between @FechaInicial and @FechaFinal
ORDER BY dbo.Servicios.Nombre, dbo.ProgramacionMedica.IdTurno
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaServiciosSeleccionarPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaSinCitasXespecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaSinCitasXespecialidad]
	@idEspecialidad [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.ProgramacionMedica.IdProgramacion, dbo.Citas.IdCita, dbo.ProgramacionMedica.Fecha, dbo.ProgramacionMedica.HoraInicio,
                      dbo.ProgramacionMedica.HoraFin, dbo.ProgramacionMedica.IdEspecialidad
FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
                      dbo.Citas ON dbo.ProgramacionMedica.IdProgramacion = dbo.Citas.IdProgramacion
WHERE     (dbo.Citas.IdCita IS NULL) and dbo.ProgramacionMedica.IdEspecialidad=@idEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaSinCitasXespecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaXmedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaXmedico]
	@lIdMedico [int]
WITH EXECUTE AS CALLER
AS
select * from ProgramacionMedica
    Where IdMedico = @lIdMedico
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaXmedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaXmedicoFechaHOra]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaXmedicoFechaHOra]
	@IdMedico [int],
	@Fecha [datetime],
	@Hora [char](5)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ProgramacionMedica.IdMedico, dbo.ProgramacionMedica.Fecha, dbo.Servicios.Nombre,
            dbo.ProgramacionMedica.HoraInicio, dbo.Turnos.Descripcion as dturno,dbo.TiposServicio.Descripcion as tipoServicio
FROM         dbo.ProgramacionMedica LEFT OUTER JOIN
dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio  LEFT OUTER JOIN
dbo.Turnos on dbo.ProgramacionMedica.IdTurno =dbo.Turnos.IdTurno  LEFT OUTER JOIN
dbo.TiposServicio on dbo.ProgramacionMedica.IdTipoServicio=dbo.TiposServicio.IdTipoServicio
WHERE dbo.ProgramacionMedica.IdMedico=@IdMedico
and dbo.ProgramacionMedica.Fecha=@Fecha and
dbo.ProgramacionMedica.HoraInicio=@Hora

GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaXmedicoFechaHOra] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramacionMedicaXMedicoMesAnio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramacionMedicaXMedicoMesAnio]
	@lIdMedico [int],
	@iMes [int],
	@iAnio [int]
WITH EXECUTE AS CALLER
AS
select distinct(fecha), idTipoServicio from ProgramacionMedica
             where IdMedico = @lIdMedico
               and Month(Fecha) = @iMes
               and Year(Fecha) = @iAnio
               and IdTipoServicio = 1
GO
ALTER AUTHORIZATION ON [dbo].[ProgramacionMedicaXMedicoMesAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramaControlMaternoConsultarTotalControles]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramaControlMaternoConsultarTotalControles]
	@Controles [int]
WITH EXECUTE AS CALLER
AS
SELECT c.idpaciente,cd1.cabdato as FPP,cd2.cabdato as FUM,p.nrohistoriaclinica,p.apellidoPaterno, p.apellidoMaterno,
p.primernombre,p.segundonombre,p.tercernombre,p.email,p.telefono,d.nombre as distrito,
pc.IdControl UltimoControl,pc.FechaControl FechaUltimoControl
FROM procabecera c inner join procabeceradato cd1
on c.idprograma=cd1.idprograma and c.idprocabecera=cd1.idprocabecera and cd1.idcabdato=2 --FPP
inner join procabeceradato cd2
on c.idprograma=cd2.idprograma and c.idprocabecera=cd2.idprocabecera and cd2.idcabdato=1 --FUM
inner join procontroles pc on c.idprograma=pc.idprograma and c.idprocabecera=pc.idprocabecera
inner join pacientes p on c.idpaciente=p.idpaciente
inner join distritos d on d.iddistrito=p.iddistritodomicilio
where c.idprograma=1 and convert(datetime, cd1.cabdato, 103)>=getdate()
and pc.IdControl in (select top 1 pc2.IdControl from procontroles pc2
			where pc2.idprograma=c.idprograma and pc2.idprocabecera=c.idprocabecera
			order by pc2.IdControl desc)
and pc.IdControl<@Controles
order by convert(datetime, cd1.cabdato, 103) asc
GO
ALTER AUTHORIZATION ON [dbo].[ProgramaControlMaternoConsultarTotalControles] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProgramaControlReporteFPP]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProgramaControlReporteFPP]
	@FechaInicio [varchar](10),
	@FechaFin [varchar](10)
WITH EXECUTE AS CALLER
AS
SELECT c.idpaciente,cd1.cabdato as FPP,cd2.cabdato as FUM,p.nrohistoriaclinica,p.apellidoPaterno, p.apellidoMaterno,
p.primernombre,p.segundonombre,p.tercernombre,p.email,p.telefono,d.nombre as distrito,
pc.IdControl UltimoControl,pc.FechaControl FechaUltimoControl
FROM procabecera c inner join procabeceradato cd1
on c.idprograma=cd1.idprograma and c.idprocabecera=cd1.idprocabecera and cd1.idcabdato=2
inner join procabeceradato cd2
on c.idprograma=cd2.idprograma and c.idprocabecera=cd2.idprocabecera and cd2.idcabdato=1
inner join procontroles pc on c.idprograma=pc.idprograma and c.idprocabecera=pc.idprocabecera
inner join pacientes p on c.idpaciente=p.idpaciente
inner join distritos d on d.iddistrito=p.iddistritodomicilio
where c.idprograma=1
and pc.IdControl in (select top 1 pc2.IdControl from procontroles pc2
			where pc2.idprograma=c.idprograma and pc2.idprocabecera=c.idprocabecera
			order by pc2.IdControl desc)
and convert(datetime, cd1.cabdato, 103) between convert(datetime, @FechaInicio, 103)  and convert(datetime, @FechaFin, 103)
order by convert(datetime, cd1.cabdato, 103) asc
GO
ALTER AUTHORIZATION ON [dbo].[ProgramaControlReporteFPP] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProHistoricoDatoControlGrafico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProHistoricoDatoControlGrafico]
	@IdPrograma [int],
	@IdProCabecera [int],
	@Idcontrol [int],
	@IdControlDatoX [int],
	@IdControlDatoY [int]
WITH EXECUTE AS CALLER
AS
select p.idcontrol,p.idcontroldato,control_esgraficoejex,p.controldato
from procontroldato p inner join procontrolconfigdatos c on
p.idprograma=c.idprograma and p.idcontroldato=c.idcontroldato
where p.idprograma=@IdPrograma and p.idprocabecera=@IdProCabecera and c.control_esdatografico=1
and p.idcontroldato in (@IdControlDatoX,@IdControlDatoY) and p.idcontrol=@Idcontrol
GO
ALTER AUTHORIZATION ON [dbo].[ProHistoricoDatoControlGrafico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProProcedimientosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProProcedimientosAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdDiagnostico [int],
	@IdProducto [int],
	@IdResultado [int],
	@labConfHIS [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProProcedimientos (
IdPrograma,IdProCabecera,IdControl,IdDiagnostico,IdProducto,IdResultado,labConfHIS) values (
@IdPrograma,@IdProCabecera,@IdControl,@IdDiagnostico,@IdProducto,@IdResultado,@labConfHIS)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProProcedimientosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProProcedimientosEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdDiagnostico [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProProcedimientos
where IdPrograma = @IdPrograma
and IdProCabecera = @IdProCabecera
and IdControl = @IdControl
and IdDiagnostico = @IdDiagnostico
and IdProducto = @IdProducto

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProProcedimientosEliminarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProProcedimientosEliminarTodos]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
delete from ProProcedimientos
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientosEliminarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProProcedimientosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProProcedimientosModificar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdDiagnostico [int],
	@IdProducto [int],
	@IdResultado [int],
	@labConfHIS [varchar](3),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update ProProcedimientos
set
IdResultado = @IdResultado,
labConfHIS=@labConfHIS
where IdPrograma = @IdPrograma
and IdProCabecera = @IdProCabecera
and IdControl = @IdControl
and IdDiagnostico = @IdDiagnostico
and IdProducto = @IdProducto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdPrograma,'ProProcedimientos'
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProProcedimientosSeleccionarPorIdControl]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProProcedimientosSeleccionarPorIdControl]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
SELECT distinct 1 as IDDIAGNOSTICO,P.IDPRODUCTO,S.NOMBRE,'' as CodigoCIE10,ISNULL(p.IDRESULTADO,1) AS IDRESULTADO,ISNULL(p.IDPROGRAMA,0) AS Seleccionado,p.labConfHIS
FROM PROPROCEDIMIENTOS P INNER JOIN FACTCATALOGOSERVICIOS S ON P.IDPRODUCTO=S.IDPRODUCTO
WHERE P.IDPROGRAMA=@IdPrograma AND p.IdProCabecera=@IdProCabecera AND p.IDCONTROL=@IdControl
ORDER BY S.NOMBRE ASC
GO
ALTER AUTHORIZATION ON [dbo].[ProProcedimientosSeleccionarPorIdControl] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProSeleccionarControlesAnteriores]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProSeleccionarControlesAnteriores]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControlSeleccionado [int]
WITH EXECUTE AS CALLER
AS
select * from procontroles where idprograma=@IdPrograma and idprocabecera=@IdProCabecera and idcontrol<=@IdControlSeleccionado
GO
ALTER AUTHORIZATION ON [dbo].[ProSeleccionarControlesAnteriores] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProTratamientosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProTratamientosAgregar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into ProTratamientos (
IdPrograma,IdProCabecera,IdControl,IdProducto) values (
@IdPrograma,@IdProCabecera,@IdControl,@IdProducto)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdPrograma,'ProTratamientos'
GO
ALTER AUTHORIZATION ON [dbo].[ProTratamientosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProTratamientosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProTratamientosEliminar]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int],
	@IdProducto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from ProTratamientos
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl and IdProducto=@IdProducto
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProTratamientos'
GO
ALTER AUTHORIZATION ON [dbo].[ProTratamientosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProTratamientosEliminarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProTratamientosEliminarTodos]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
delete from ProTratamientos
where IdPrograma = @IdPrograma and IdProCabecera=@IdProCabecera and IdControl=@IdControl
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdPrograma,'ProDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[ProTratamientosEliminarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProTratamientosSeleccionarPorIdControl]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProTratamientosSeleccionarPorIdControl]
	@IdPrograma [int],
	@IdProCabecera [int],
	@IdControl [int]
WITH EXECUTE AS CALLER
AS
SELECT P.IdProducto, RTRIM(F.NOMBRE) AS Tratamientos,ISNULL(T.IdPrograma,0) AS Seleccionado
FROM (ProCatalogoTratamientos P inner join FactCatalogoBienesInsumos F ON P.IdProducto=F.IdProducto)
inner join ProTratamientos T on P.idprograma=T.Idprograma and P.IdProducto=T.IdProducto and T.IdProCabecera=@IdProCabecera and T.IdControl=@IdControl
WHERE P.IdPrograma=@IdPrograma
ORDER BY RTRIM(F.NOMBRE) asc
GO
ALTER AUTHORIZATION ON [dbo].[ProTratamientosSeleccionarPorIdControl] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProveedoresAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProveedoresAgregar]
	@idProveedor [int] OUTPUT,
	@Ruc [varchar](11),
	@RazonSocial [varchar](100),
	@email [varchar](100),
	@direccion [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Proveedores (
Ruc,RazonSocial,email,direccion ) values (
@Ruc,@RazonSocial,@email,@direccion )
set @idProveedor = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[ProveedoresAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProveedoresEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProveedoresEliminar]
	@idProveedor [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Proveedores
where idProveedor = @idProveedor
GO
ALTER AUTHORIZATION ON [dbo].[ProveedoresEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProveedoresModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProveedoresModificar]
	@idProveedor [int],
	@Ruc [varchar](11),
	@RazonSocial [varchar](100),
	@email [varchar](100),
	@direccion [varchar](100),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Proveedores
set
Ruc = @Ruc,
RazonSocial = @RazonSocial,
email=@email,
direccion=@direccion
where idProveedor = @idProveedor
GO
ALTER AUTHORIZATION ON [dbo].[ProveedoresModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProveedoresSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProveedoresSeleccionarPorId]
	@idProveedor [int]
WITH EXECUTE AS CALLER
AS
select * from Proveedores
where idProveedor = @idProveedor
GO
ALTER AUTHORIZATION ON [dbo].[ProveedoresSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProveedoresSeleccionarPorRUC]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProveedoresSeleccionarPorRUC]
	@Ruc [varchar](11)
WITH EXECUTE AS CALLER
AS
select * from Proveedores  where Ruc=@Ruc
GO
ALTER AUTHORIZATION ON [dbo].[ProveedoresSeleccionarPorRUC] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasActualizarInformacionFox]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProvinciasActualizarInformacionFox]
	@IdProvincia [int],
	@Nombre [varchar](50),
	@IdDepartamento [money]
WITH EXECUTE AS CALLER
AS
IF @IdProvincia > 0
BEGIN
	IF NOT EXISTS(select * from Provincias where idProvincia=@IdProvincia)
		BEGIN
			insert into Provincias (IdProvincia,Nombre,IdDepartamento)
			values (@IdProvincia,@Nombre,@IdDepartamento)
		END
END
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasActualizarInformacionFox] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProvinciasAgregar]
	@IdProvincia [int],
	@Nombre [varchar](50),
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
INSERT INTO Provincias(IdProvincia, Nombre, IdDepartamento)
VALUES (@IdProvincia, @Nombre, @IdDepartamento)
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProvinciasEliminar]
	@IdProvincia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Provincias
where IdProvincia = @IdProvincia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProvincia,'Provincias'
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProvinciasModificar]
	@IdDepartamento [int],
	@Nombre [varchar](50),
	@IdProvincia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Provincias
set
IdDepartamento = @IdDepartamento,
Nombre = @Nombre
where IdProvincia = @IdProvincia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProvincia,'Provincias'
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasSeleccionarPorDepartamento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProvinciasSeleccionarPorDepartamento]
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select IdProvincia, Nombre,
(Convert(varchar(5), IdProvincia) + ' = ' + Nombre) as DescripcionLarga
 from Provincias
where IdDepartamento = @IdDepartamento
order by Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasSeleccionarPorDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ProvinciasSeleccionarPorId]
	@IdProvincia [int]
WITH EXECUTE AS CALLER
AS
select * from Provincias
where IdProvincia = @IdProvincia
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ProvinciasSeleccionarTodo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ProvinciasSeleccionarTodo]
WITH EXECUTE AS CALLER
AS
select * from Provincias
GO
ALTER AUTHORIZATION ON [dbo].[ProvinciasSeleccionarTodo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PruebaTieneResultado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[PruebaTieneResultado]
	@IdAnalisis [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labresultado
WHERE idAnalisis=@IdAnalisis
AND idorden=@IdOrden
GO
ALTER AUTHORIZATION ON [dbo].[PruebaTieneResultado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[PruebaTieneResultadoItems]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[PruebaTieneResultadoItems]
	@Codigo [varchar](10),
	@IdOrden [int]
WITH EXECUTE AS CALLER
AS
SELECT *
FROM labResultadoPorItems
WHERE idorden=@IdOrden
and idProductoCpt in (select f.idProducto from factCatalogoServicios f where f.codigo=@Codigo and f.idEstado=1)
GO
ALTER AUTHORIZATION ON [dbo].[PruebaTieneResultadoItems] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaAutomatica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaAutomatica]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle set cantidadDespachada=0 where idReceta=@IdReceta
delete from RecetaDetalleItem  where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaAutomatica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraActualizaFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraActualizaFarmacia]
	@lnIdReceta [int],
	@DocumentoNumero [varchar](20)
WITH EXECUTE AS CALLER
AS
update RecetaCabecera set idEstado=2 where idReceta=@lnIdReceta
update RecetaDetalleItem set DocumentoDespacho=@DocumentoNumero where idReceta=@lnIdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraActualizaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraAgregar]
	@idReceta [int] OUTPUT,
	@IdPuntoCarga [int],
	@FechaReceta [datetime],
	@idCuentaAtencion [int],
	@idServicioReceta [int],
	@idEstado [int],
	@idComprobantePago [int],
	@idMedicoReceta [int],
	@FechaVigencia [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into RecetaCabecera (
IdPuntoCarga,FechaReceta,idCuentaAtencion,idServicioReceta,idEstado,idComprobantePago,idMedicoReceta,FechaVigencia) values (
@IdPuntoCarga,@FechaReceta,@idCuentaAtencion,@idServicioReceta,@idEstado,@idComprobantePago,@idMedicoReceta,@FechaVigencia)
set @idReceta = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idReceta,'RecetaCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraDetalleSeleccionaPorNroReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraDetalleSeleccionaPorNroReceta]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
/*

	    SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                                      dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio, dbo.RecetaDetalle.Total,
                                      dbo.RecetaCabecera.idComprobantePago,
                                      (SELECT     TOP  1 dbo.RecetaDetalleItem.DocumentoDespacho
                                       FROM          dbo.RecetaDetalleItem
                                       WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                      dbo.FactCatalogoBienesInsumos.Codigo,
                                      dbo.FactCatalogoBienesInsumos.Nombre , dbo.Atenciones.IdFormaPago, dbo.Atenciones.IdTipoServicio ,dbo.RecetaCabecera.idMedicoReceta ,dbo.RecetaCabecera.fechaReceta,dbo.RecetaCabecera.fechaVigencia
                 FROM           dbo.Atenciones RIGHT OUTER JOIN
                                      dbo.RecetaCabecera ON dbo.Atenciones.IdCuentaAtencion = dbo.RecetaCabecera.idCuentaAtencion RIGHT OUTER JOIN
                                      dbo.RecetaDetalle LEFT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                      dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
                 Where         (dbo.RecetaCabecera.IdPuntoCarga = 5) and dbo.RecetaCabecera.idReceta=@IdReceta */
SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                                      dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio, dbo.RecetaDetalle.Total,

                                      (SELECT     TOP  1 dbo.RecetaDetalleItem.DocumentoDespacho
                                       FROM          dbo.RecetaDetalleItem
                                       WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                      dbo.FactCatalogoBienesInsumos.Codigo,
                                      dbo.FactCatalogoBienesInsumos.Nombre , dbo.Atenciones.IdFormaPago, dbo.Atenciones.IdTipoServicio ,dbo.RecetaCabecera.idMedicoReceta ,dbo.RecetaCabecera.fechaReceta,dbo.RecetaCabecera.fechaVigencia
                 FROM           dbo.Atenciones RIGHT OUTER JOIN
                                      dbo.RecetaCabecera ON dbo.Atenciones.IdCuentaAtencion = dbo.RecetaCabecera.idCuentaAtencion RIGHT OUTER JOIN
                                      dbo.RecetaDetalle LEFT OUTER JOIN
                                      dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto ON
                                      dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
                 Where         (dbo.RecetaCabecera.IdPuntoCarga = 5) and dbo.RecetaCabecera.idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraDetalleSeleccionaPorNroReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraEliminar]
	@idReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from RecetaCabecera
where idReceta = @idReceta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idReceta,'RecetaCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraFiltraXcuentaYDocumentodespacho]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraFiltraXcuentaYDocumentodespacho]
	@DocumentoDespacho [varchar](50),
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
/*
select idReceta from RecetaCabecera where DocumentoDespacho=@DocumentoDespacho and idCuentaAtencion=@IdCuentaAtencion
*/

SELECT     dbo.RecetaCabecera.idReceta
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalleItem ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalleItem.idReceta
where dbo.RecetaDetalleItem.DocumentoDespacho=@DocumentoDespacho and dbo.RecetaCabecera.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraFiltraXcuentaYDocumentodespacho] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraFiltraXpuntoCargaYDocumentodespacho]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraFiltraXpuntoCargaYDocumentodespacho]
	@DocumentoDespacho [varchar](50),
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.idReceta
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalleItem ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalleItem.idReceta
where dbo.RecetaDetalleItem.DocumentoDespacho=@DocumentoDespacho and
      dbo.RecetaCabecera.IdPuntoCarga =@IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraFiltraXpuntoCargaYDocumentodespacho] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraModificaIdEstado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraModificaIdEstado]
	@DocumentoDespacho [varchar](20),
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaCabecera set idEstado=2
where idReceta=@idReceta
/*
update RecetaDetalleItem set DocumentoDespacho=@DocumentoDespacho
where idReceta=@idReceta*/
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraModificaIdEstado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraModificaIdEstadoYDocumentoDespacho]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraModificaIdEstadoYDocumentoDespacho]
	@IdCuentaAtencion [int],
	@IdReceta [int],
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
If @IdCuentaAtencion > 0 --Paciente con algun Seguro
	begin
		update RecetaCabecera set idEstado=1 where IdReceta=@IdReceta
                           delete from RecetaDetalleItem  where IdReceta=@IdReceta
	end
    Else --Paciente con Boleta
	begin
		update RecetaCabecera set idEstado=1 where idComprobantePago=@IdComprobantePago
                          delete from RecetaDetalleItem  where IdReceta=(select idReceta from RecetaCabecera where idComprobantePago=@IdComprobantePago)
	end
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraModificaIdEstadoYDocumentoDespacho] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraModificar]
	@idReceta [int],
	@IdPuntoCarga [int],
	@FechaReceta [datetime],
	@idCuentaAtencion [int],
	@idServicioReceta [int],
	@idEstado [int],
	@idComprobantePago [int],
	@idMedicoReceta [int],
	@FechaVigencia [datetime],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update RecetaCabecera
set
IdPuntoCarga = @IdPuntoCarga,
FechaReceta = @FechaReceta,
idCuentaAtencion = @idCuentaAtencion,
idServicioReceta = @idServicioReceta,
idEstado = @idEstado,
idComprobantePago = @idComprobantePago,
idMedicoReceta=@idMedicoReceta,
FechaVigencia=@FechaVigencia
where idReceta = @idReceta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idReceta,'RecetaCabecera'
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraPoridReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraPoridReceta]
	@lnidReceta [int]
WITH EXECUTE AS CALLER
AS
DECLARE @NombreEESS varchar(5000), @DireccionEESS varchar(5000)
	DECLARE @TelefonoEESS varchar(5000), @RucEESS varchar(5000)

	SET @NombreEESS = (SELECT ValorTexto FROM Parametros WHERE IdParametro = 205)
	SET @DireccionEESS = (SELECT ValorTexto FROM Parametros WHERE IdParametro = 206)
	SET @TelefonoEESS = 'TELEFONO : ' + ISNULL((SELECT ValorTexto FROM Parametros WHERE IdParametro = 207), '')
	SET @RucEESS = 'RUC : ' + ISNULL((SELECT ValorTexto FROM Parametros WHERE IdParametro = 339),'')

	SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
	                      dbo.FactPuntosCarga.Descripcion AS PuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idReceta,
	                      dbo.RecetaCabecera.FechaReceta, dbo.Servicios.Nombre AS Servicio,dbo.RecetaCabecera.IdPuntoCarga,dbo.Atenciones.IdFormaPago,
                             0 as idComprobantePago,dbo.atenciones.IdservicioIngreso,dbo.atenciones.IdMedicoIngreso,dbo.fuentesfinanciamiento.descripcion,
			      dbo.empleados.ApellidoPaterno + ' ' + dbo.empleados.ApellidoMaterno + ' '+ dbo.empleados.Nombres as NombreMedico,
				dbo.Pacientes.ApellidoPaterno + ' '+ dbo.Pacientes.ApellidoMaterno+' '+ dbo.Pacientes.PrimerNombre As NombrePaciente,
				dbo.Atenciones.FechaIngreso As FechaAtencion, CONVERT(DATETIME, dbo.Atenciones.HoraIngreso) As HoraAtencion,
				dbo.Especialidades.Nombre as NombreEspecialidad,'' As ValidoHasta, dbo.Atenciones.IdAtencion,dbo.TiposServicio.Descripcion as TipoServicio,
				CONVERT(varchar,dbo.Atenciones.Edad)  + ' ' + dbo.TiposEdad.Descripcion as EdadPaciente,
				@NombreEESS AS NombreEESS, @DireccionEESS AS DireccionEESS,
				@TelefonoEESS AS TelefonoEESS, @RucEESS AS RucEESS, dbo.RecetaCabecera.fechaVigencia,dbo.Atenciones.EpsPorcentaje,dbo.Pacientes.FechaNacimiento
	FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
	                      dbo.RecetaCabecera LEFT OUTER JOIN
	                      dbo.Servicios ON dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio ON
	                      dbo.FactPuntosCarga.IdPuntoCarga = dbo.RecetaCabecera.IdPuntoCarga LEFT OUTER JOIN
	                      dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
	                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT JOIN
			      dbo.fuentesfinanciamiento ON dbo.fuentesfinanciamiento.idfuentefinanciamiento = dbo.atenciones.idfuentefinanciamiento RIGHT OUTER JOIN
			      dbo.medicos ON dbo.medicos.idmedico = dbo.RecetaCabecera.IdMedicoReceta INNER JOIN
			      dbo.empleados ON dbo.empleados.idempleado = dbo.medicos.idempleado INNER JOIN
			      dbo.Especialidades on dbo.Especialidades.IdEspecialidad=dbo.Servicios.IdEspecialidad INNER JOIN
			      dbo.TiposEdad on dbo.TiposEdad.IdTipoEdad=dbo.Atenciones.IdTipoEdad INNER JOIN
			      dbo.TiposServicio ON dbo.TiposServicio.IdTipoServicio=dbo.Atenciones.IdTipoServicio
	WHERE   dbo.RecetaCabecera.idReceta = @lnidReceta
	ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.RecetaCabecera.FechaReceta DESC
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraPoridReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraPorRangoFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraPorRangoFechas]
	@fechaInicio [datetime],
	@fechaFin [datetime],
	@apellidoP [varchar](20),
	@idEstado [int]
WITH EXECUTE AS CALLER
AS
if @apellidoP=''
    if @idEstado>0
		SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
							  dbo.FactPuntosCarga.Descripcion AS PuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idReceta,
							  dbo.RecetaCabecera.FechaReceta, dbo.Servicios.Nombre AS Servicio,dbo.RecetaCabecera.IdPuntoCarga,dbo.Atenciones.IdFormaPago
		FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
							  dbo.RecetaCabecera LEFT OUTER JOIN
							  dbo.Servicios ON dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio ON
							  dbo.FactPuntosCarga.IdPuntoCarga = dbo.RecetaCabecera.IdPuntoCarga LEFT OUTER JOIN
							  dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE    dbo.RecetaCabecera.idEstado=@idEstado and
						  dbo.RecetaCabecera.FechaReceta BETWEEN  @FechaInicio and  @FechaFin
		ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.RecetaCabecera.FechaReceta DESC
	else
		SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
							  dbo.FactPuntosCarga.Descripcion AS PuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idReceta,
							  dbo.RecetaCabecera.FechaReceta, dbo.Servicios.Nombre AS Servicio,dbo.RecetaCabecera.IdPuntoCarga,dbo.Atenciones.IdFormaPago
		FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
							  dbo.RecetaCabecera LEFT OUTER JOIN
							  dbo.Servicios ON dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio ON
							  dbo.FactPuntosCarga.IdPuntoCarga = dbo.RecetaCabecera.IdPuntoCarga LEFT OUTER JOIN
							  dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE    dbo.RecetaCabecera.idEstado<>0 and
		          dbo.RecetaCabecera.FechaReceta BETWEEN  @FechaInicio and  @FechaFin
		ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.RecetaCabecera.FechaReceta DESC

else
    if @idEstado>0
		SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
							  dbo.FactPuntosCarga.Descripcion AS PuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idReceta,
							  dbo.RecetaCabecera.FechaReceta, dbo.Servicios.Nombre AS Servicio,dbo.RecetaCabecera.IdPuntoCarga,dbo.Atenciones.IdFormaPago
		FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
							  dbo.RecetaCabecera LEFT OUTER JOIN
							  dbo.Servicios ON dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio ON
							  dbo.FactPuntosCarga.IdPuntoCarga = dbo.RecetaCabecera.IdPuntoCarga LEFT OUTER JOIN
							  dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE    dbo.RecetaCabecera.idEstado=@idEstado and
						  (dbo.RecetaCabecera.FechaReceta BETWEEN  @FechaInicio and  @FechaFin) and dbo.Pacientes.ApellidoPaterno like '%' +@apellidoP
		ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.RecetaCabecera.FechaReceta DESC
    else
		SELECT     dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
							  dbo.FactPuntosCarga.Descripcion AS PuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idReceta,
							  dbo.RecetaCabecera.FechaReceta, dbo.Servicios.Nombre AS Servicio,dbo.RecetaCabecera.IdPuntoCarga,dbo.Atenciones.IdFormaPago
		FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
							  dbo.RecetaCabecera LEFT OUTER JOIN
							  dbo.Servicios ON dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio ON
							  dbo.FactPuntosCarga.IdPuntoCarga = dbo.RecetaCabecera.IdPuntoCarga LEFT OUTER JOIN
							  dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
							  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
		WHERE       dbo.RecetaCabecera.idEstado<>0 and
		          (dbo.RecetaCabecera.FechaReceta BETWEEN  @FechaInicio and  @FechaFin) and dbo.Pacientes.ApellidoPaterno like '%' +@apellidoP
		ORDER BY dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.RecetaCabecera.FechaReceta DESC
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraPorRangoFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraSeleccionarPorId]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaCabecera
where idReceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraSeleccionarPorIdComprobantePago]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraSeleccionarPorIdComprobantePago]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
/*
SELECT     dbo.RecetaCabecera.*,
                          (SELECT     TOP 1 DocumentoDespacho
                            FROM          RecetaDetalleItem
                            WHERE      idReceta = dbo.recetacabecera.idreceta) AS DocumentoDespacho
FROM         dbo.RecetaCabecera
where dbo.RecetaCabecera.IdComprobantePago = @IdComprobantePago¨*/
SELECT     dbo.RecetaCabecera.*, dbo.RecetaDetalleItem.DocumentoDespacho
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalleItem ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalleItem.idReceta
WHERE     (dbo.RecetaDetalleItem.idComprobantePago = @IdComprobantePago)
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraSeleccionarPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraSeleccionarPorIdCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraSeleccionarPorIdCuentaAtencion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.*,
                          (SELECT     TOP 1 DocumentoDespacho
                            FROM          RecetaDetalleItem
                            WHERE      idReceta = dbo.recetacabecera.idreceta) AS DocumentoDespacho
FROM         dbo.RecetaCabecera
where dbo.RecetaCabecera.idCuentaAtencion = @idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraSeleccionarPorIdCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaCabeceraXidCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaCabeceraXidCuentaAtencion]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                                 (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
                            FROM          dbo.RecetaDetalleItem
                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                              dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida
             FROM          dbo.RecetaCabecera RIGHT OUTER JOIN
                                 dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
             Where        (dbo.RecetaCabecera.idEstado = 2) and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetaCabeceraXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleActualizaCantDespachada]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleActualizaCantDespachada]
	@idReceta [int],
	@idItem [int],
	@CantidadDespachada [int],
	@IdEstadoDetalle [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle
set
CantidadDespachada = @CantidadDespachada,
IdEstadoDetalle=@IdEstadoDetalle
where idReceta = @idReceta and idItem=@idItem
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleActualizaCantDespachada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleAgregar]
	@idReceta [int],
	@idItem [int],
	@CantidadPedida [int],
	@Precio [money],
	@Total [money],
	@SaldoEnRegistroReceta [int],
	@SaldoEnDespachoReceta [int],
	@CantidadDespachada [int],
	@idDosisRecetada [int],
	@idEstadoDetalle [int],
	@MotivoAnulacionMedico [varchar](300),
	@observaciones [varchar](300),
	@IdViaAdministracion [int],
	@dx [varchar](20),
	@idPuntoCarga [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into RecetaDetalle (
idReceta,idItem,CantidadPedida,Precio,Total,SaldoEnRegistroReceta,SaldoEnDespachoReceta,CantidadDespachada,idDosisRecetada,
idEstadoDetalle,MotivoAnulacionMedico,IdViaAdministracion,observaciones,dx,idPuntoCarga
) values (
@idReceta,@idItem,@CantidadPedida,@Precio,@Total,@SaldoEnRegistroReceta,@SaldoEnDespachoReceta,@CantidadDespachada,@idDosisRecetada,
@idEstadoDetalle,@MotivoAnulacionMedico,@IdViaAdministracion,@observaciones,@dx,@idPuntoCarga
)
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleDevuelvePuntoCarga]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleDevuelvePuntoCarga]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactPuntosCarga.Descripcion,dbo.FactPuntosCarga.*
FROM         dbo.RecetaDetalle LEFT OUTER JOIN
                      dbo.FactPuntosCarga ON dbo.RecetaDetalle.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
where   dbo.RecetaDetalle.idReceta =@idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleDevuelvePuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleEliminar]
	@idReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from RecetaDetalle
where idReceta = @idReceta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idReceta,'RecetaDetalle'
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemAgregar]
	@idReceta [int],
	@idItem [int],
	@DocumentoDespacho [varchar](20),
	@CantidadDespachada [int],
	@idComprobantePago [int],
	@idEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into RecetaDetalleItem (
idReceta,idItem,DocumentoDespacho,CantidadDespachada,idComprobantePago,idEstado) values (
@idReceta,@idItem,@DocumentoDespacho,@CantidadDespachada,@idComprobantePago,@idEstado)
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemEliminar]
	@idReceta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from RecetaDetalleItem
where idReceta = @idReceta
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idReceta,'RecetaDetalleItem'
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemFiltraXidComprobantePagoYpuntoCarga]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemFiltraXidComprobantePagoYpuntoCarga]
	@idComprobantePago [int],
	@IdPuntoCarga [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.idReceta,dbo.RecetaDetalleItem.idEstado
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalleItem ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalleItem.idReceta
where dbo.RecetaDetalleItem.idComprobantePago =@idComprobantePago  and
      dbo.RecetaCabecera.IdPuntoCarga =@IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemFiltraXidComprobantePagoYpuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemModificar]
	@idReceta [int],
	@idItem [int],
	@DocumentoDespacho [varchar](20),
	@CantidadDespachada [int],
	@idComprobantePago [int],
	@idEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalleItem
set
idItem = @idItem,
DocumentoDespacho = @DocumentoDespacho,
CantidadDespachada = @CantidadDespachada,
idComprobantePago=@idComprobantePago,
idEstado=@idEstado
where idReceta = @idReceta and idItem =@idItem  and DocumentoDespacho =@DocumentoDespacho
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemModificarItem]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemModificarItem]
	@idReceta [int],
	@idItem [int],
	@DocumentoDespacho [varchar](20),
	@CantidadDespachada [int],
	@idComprobantePago [int],
	@idEstado [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalleItem
set
DocumentoDespacho = @DocumentoDespacho,
CantidadDespachada = @CantidadDespachada,
idComprobantePago=@idComprobantePago,
idEstado=@idEstado
where idReceta = @idReceta and idItem =@idItem
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemModificarItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleItemSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleItemSeleccionarPorId]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaDetalleItem
where idReceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleItemSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleModificacantidadDespachada]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleModificacantidadDespachada]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle set cantidadDespachada=0 where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleModificacantidadDespachada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleModificar]
	@idReceta [int],
	@idItem [int],
	@CantidadPedida [int],
	@Precio [money],
	@Total [money],
	@SaldoEnRegistroReceta [int],
	@SaldoEnDespachoReceta [int],
	@CantidadDespachada [int],
	@idDosisRecetada [int],
	@idEstadoDetalle [int],
	@MotivoAnulacionMedico [varchar](300),
	@observaciones [varchar](300),
	@IdViaAdministracion [int],
	@IdUsuarioAuditoria [int],
	@dx [varchar](20),
	@idPuntoCarga [int],
	@WhereIdRecetaItem [int]
WITH EXECUTE AS CALLER
AS
if @WhereIdRecetaItem=1
	update RecetaDetalle
	set
	CantidadPedida = @CantidadPedida,
	Precio = @Precio,
	Total = @Total,
	SaldoEnRegistroReceta = @SaldoEnRegistroReceta,
	SaldoEnDespachoReceta = @SaldoEnDespachoReceta,
	CantidadDespachada = @CantidadDespachada,
	idDosisRecetada=@idDosisRecetada,
	idEstadoDetalle=@idEstadoDetalle,
	MotivoAnulacionMedico=@MotivoAnulacionMedico,
	IdViaAdministracion=@IdViaAdministracion,
	observaciones=@observaciones,
	dx=@dx,
        idPuntoCarga=@idPuntoCarga
	where idReceta = @idReceta and idItem=@idItem
else
	update RecetaDetalle
	set
	CantidadPedida = @CantidadPedida,
	Precio = @Precio,
	Total = @Total,
	SaldoEnRegistroReceta = @SaldoEnRegistroReceta,
	SaldoEnDespachoReceta = @SaldoEnDespachoReceta,
	CantidadDespachada = @CantidadDespachada,
	idDosisRecetada=@idDosisRecetada,
	idEstadoDetalle=@idEstadoDetalle,
	MotivoAnulacionMedico=@MotivoAnulacionMedico,
	IdViaAdministracion=@IdViaAdministracion,
	observaciones=@observaciones,
	dx=@dx,
        idPuntoCarga=@idPuntoCarga
	where idReceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleModificaSaldoEnDespachoReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleModificaSaldoEnDespachoReceta]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle set SaldoEnDespachoReceta=0,cantidadDespachada=0  where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleModificaSaldoEnDespachoReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleModificaSaldoEnDespachoRecetaYCantidadDespachada]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleModificaSaldoEnDespachoRecetaYCantidadDespachada]
	@SaldoEnDespachoReceta [int],
	@CantidadDespachada [int],
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
update RecetaDetalle
set SaldoEnDespachoReceta=@SaldoEnDespachoReceta,cantidadDespachada=@CantidadDespachada
where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleModificaSaldoEnDespachoRecetaYCantidadDespachada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetallePorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetallePorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT   dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.dx,
          dbo.RecetaCabecera.idCuentaAtencion,dbo.RecetaCabecera.FechaReceta, dbo.RecetaCabecera.idEstado
FROM         dbo.RecetaDetalle INNER JOIN
                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta
WHERE    dbo.RecetaCabecera.idEstado<>0 and  dbo.RecetaCabecera.idCuentaAtencion = @idCuentaAtencion
ORDER BY dbo.RecetaCabecera.FechaReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetallePorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetallePorIdReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetallePorIdReceta]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre,
			   dbo.FactCatalogoBienesInsumos.Concentracion,
	           dbo.FactCatalogoBienesInsumos.FormaFarmaceutica,
	           dbo.RecetaDetalle.CantidadPedida,dbo.RecetaDetalle.idDosisRecetada,
	           dbo.RecetaViaAdministracion.Descripcion AS ViaAdministracion,
			   dbo.RecetaDosis.NumeroDosis AS Dosis, dbo.RecetaDetalle.observaciones As Frecuencia,
			   dbo.RecetaDetalle.dx
	    FROM   dbo.RecetaCabecera INNER JOIN
	           dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta LEFT OUTER JOIN
	           dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
	           dbo.RecetaDosis ON dbo.RecetaDosis.idDosis=dbo.RecetaDetalle.idDosisRecetada LEFT OUTER JOIN
	           dbo.RecetaViaAdministracion ON dbo.RecetaViaAdministracion.IdViaAdministracion=dbo.RecetaDetalle.IdViaAdministracion
	    Where dbo.RecetaCabecera.idreceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetallePorIdReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSeleccioarPorIdReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSeleccioarPorIdReceta]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaDetalle where idReceta=@IdReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSeleccioarPorIdReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSeleccionarPorId]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaDetalle
where idReceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSeleccionarPorIdRecetaIditem]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSeleccionarPorIdRecetaIditem]
	@idReceta [int],
	@idItem [int]
WITH EXECUTE AS CALLER
AS
select * from RecetaDetalle
where idReceta = @idReceta and idItem=@idItem
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSeleccionarPorIdRecetaIditem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSeleccionarXidCuentaIdItemDocumento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSeleccionarXidCuentaIdItemDocumento]
	@idCuentaAtencion [int],
	@IdProducto [int],
	@DocumentoNumero [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT      dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                           (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
                            FROM          dbo.RecetaDetalleItem
                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta and dbo.RecetaDetalleItem.DocumentoDespacho=@DocumentoNumero) AS DocumentoDespacho,
 dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida
             FROM          dbo.RecetaCabecera INNER JOIN
                                 dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
             Where         (dbo.RecetaCabecera.idPuntoCarga = 5) and dbo.RecetaCabecera.idEstado=2
	                    and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
	                    and dbo.RecetaDetalle.idItem=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSeleccionarXidCuentaIdItemDocumento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleServicioPorIdReceta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleServicioPorIdReceta]
	@idReceta [int]
WITH EXECUTE AS CALLER
AS
SELECT        dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
                            FROM          dbo.RecetaDetalleItem
                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                                dbo.RecetaDetalle.idItem AS idProducto, dbo.RecetaDetalle.CantidadPedida,
                                   dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre + ' ('+  rtrim(dbo.RecetaDetalle.observaciones)+ ')' as nombre,
                                   dbo.RecetaDetalle.Precio,dbo.RecetaDetalle.dx
                 FROM        dbo.RecetaCabecera INNER JOIN
                                   dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta LEFT OUTER JOIN
                                   dbo.FactCatalogoServicios ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoServicios.IdProducto
             Where          dbo.RecetaCabecera.idreceta = @idReceta
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleServicioPorIdReceta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSoloFarmaciaSeleccionarXidCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSoloFarmaciaSeleccionarXidCuentaAtencion]
	@idCuentaAtencion [int],
	@SoloRegistradasYnoDespachadas [varchar](50)
WITH EXECUTE AS CALLER
AS
IF @SoloRegistradasYnoDespachadas = ' '
	BEGIN
		SELECT        dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
		                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
		                            FROM          dbo.RecetaDetalleItem
		                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                                dbo.RecetaDetalle.idItem AS idProducto, dbo.RecetaDetalle.CantidadPedida,
	                                   dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.FactCatalogoBienesInsumos.TipoProducto,
	                                   dbo.RecetaDetalle.Precio,dbo.FactCatalogoBienesInsumos.FormaFarmaceutica,dbo.FactCatalogoBienesInsumos.esPaquete
	                 FROM        dbo.RecetaCabecera INNER JOIN
	                                   dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta LEFT OUTER JOIN
	                                   dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto
	              Where         (dbo.RecetaCabecera.idPuntoCarga = 5)   and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
	END

ELSE
	BEGIN
		SELECT        dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
		                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
		                            FROM          dbo.RecetaDetalleItem
		                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                                 dbo.RecetaDetalle.idItem AS idProducto, dbo.RecetaDetalle.CantidadPedida,
	                                   dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.FactCatalogoBienesInsumos.TipoProducto,
	                                   dbo.RecetaDetalle.Precio,dbo.FactCatalogoBienesInsumos.FormaFarmaceutica,dbo.FactCatalogoBienesInsumos.esPaquete
	              FROM           dbo.RecetaCabecera INNER JOIN
	                                   dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta LEFT OUTER JOIN
	                                   dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto
	              Where         (dbo.RecetaCabecera.idPuntoCarga = 5) and  dbo.RecetaCabecera.idEstado=1  and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
	END
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSoloFarmaciaSeleccionarXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleSoloServiciosSeleccionarXidCuentaAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleSoloServiciosSeleccionarXidCuentaAtencion]
	@idCuentaAtencion [int],
	@SoloRegistradasYnoDespachadas [varchar](50)
WITH EXECUTE AS CALLER
AS
IF @SoloRegistradasYnoDespachadas = ' '
	BEGIN
		 SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
		                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
		                            FROM          dbo.RecetaDetalleItem
		                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                                  dbo.RecetaDetalle.idItem AS idProducto, dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio,
	                                   dbo.FactCatalogoServicios.Codigo , dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.codigoSIS
	              FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                                   dbo.RecetaCabecera INNER JOIN
	                                   dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta ON
	                                   dbo.FactCatalogoServicios.idProducto = dbo.RecetaDetalle.idItem
	              Where         (dbo.RecetaCabecera.idPuntoCarga <> 5)   and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
	END

ELSE
	BEGIN
		SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
		                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
		                            FROM          dbo.RecetaDetalleItem
		                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,
                                                dbo.RecetaDetalle.idItem AS idProducto, dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio,
	                                   dbo.FactCatalogoServicios.Codigo , dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.codigoSIS
	              FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                                   dbo.RecetaCabecera INNER JOIN
	                                   dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta ON
	                                   dbo.FactCatalogoServicios.idProducto = dbo.RecetaDetalle.idItem
	              Where         (dbo.RecetaCabecera.idPuntoCarga <> 5)  and  dbo.RecetaCabecera.idEstado=1 and dbo.RecetaCabecera.idCuentaAtencion=@idCuentaAtencion
	END
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleSoloServiciosSeleccionarXidCuentaAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDetalleXultimaViaAdministracion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDetalleXultimaViaAdministracion]
	@idproducto [int]
WITH EXECUTE AS CALLER
AS
SELECT     TOP 1 dbo.RecetaDetalle.IdViaAdministracion, dbo.RecetaCabecera.idReceta, dbo.RecetaDetalle.idItem, dbo.RecetaCabecera.IdPuntoCarga
FROM         dbo.RecetaCabecera INNER JOIN
                      dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta
WHERE     (dbo.RecetaDetalle.IdViaAdministracion > 0) AND (dbo.RecetaCabecera.IdPuntoCarga = 5) and dbo.RecetaDetalle.idItem=@idproducto
ORDER BY dbo.RecetaCabecera.idReceta DESC
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDetalleXultimaViaAdministracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDiagnosticosPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetaDiagnosticosPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT top 3 SubclasificacionDiagnosticos.Descripcion as Tipo,Diagnosticos.idDiagnostico,
Diagnosticos.codigoCIE10, diagnosticos.descripcion
FROM AtencionesDiagnosticos inner join Diagnosticos ON Diagnosticos.idDiagnostico=AtencionesDiagnosticos.idDiagnostico
left join SubclasificacionDiagnosticos on SubclasificacionDiagnosticos.IdSubClasificacionDx=AtencionesDiagnosticos.IdSubClasificacionDx
and AtencionesDiagnosticos.IdClasificacionDx=SubclasificacionDiagnosticos.IdClasificacionDx
where AtencionesDiagnosticos.idAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDiagnosticosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaDosisSelecionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaDosisSelecionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaDosis.*
FROM         dbo.RecetaDosis
GO
ALTER AUTHORIZATION ON [dbo].[RecetaDosisSelecionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetaFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetaFiltrar]
	@Filtro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

seT  @SQL =  'SELECT    DISTINCT  dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.FechaReceta, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno,
                                  dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroDocumento,dbo.Atenciones.idTipoServicio
             FROM         dbo.RecetaCabecera LEFT OUTER JOIN
                                  dbo.Atenciones ON dbo.RecetaCabecera.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                                  dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente where  ' + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[RecetaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasConCabeceraYdetalleSoloCpt]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetasConCabeceraYdetalleSoloCpt]
	@IdReceta [int]
WITH EXECUTE AS CALLER
AS
/*SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                                      dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                      dbo.RecetaDetalle.Precio , dbo.RecetaDetalle.Total,dbo.RecetaCabecera.idComprobantePago,
	                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
	                            FROM          dbo.RecetaDetalleItem
	                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,dbo.RecetaDetalle.observaciones

                 FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                      dbo.RecetaDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.RecetaDetalle.idItem LEFT OUTER JOIN
                                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta
                 WHERE       dbo.RecetaCabecera.idReceta=@IdReceta*/
               SELECT       dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.idCuentaAtencion, dbo.RecetaCabecera.idEstado,
                                      dbo.RecetaDetalle.idItem, dbo.RecetaDetalle.CantidadPedida, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                      dbo.RecetaDetalle.Precio , dbo.RecetaDetalle.Total,
	                          (SELECT     TOP 1 dbo.RecetaDetalleItem.DocumentoDespacho
	                            FROM          dbo.RecetaDetalleItem
	                            WHERE      dbo.RecetaDetalleItem.idReceta = dbo.RecetaCabecera.idReceta) AS DocumentoDespacho,dbo.RecetaDetalle.observaciones,
	                           dbo.RecetaDetalle.idEstadoDetalle ,dbo.RecetaCabecera.idMedicoReceta,
	                           (select top 1 idpaciente from FacturacionCuentasAtencion where IdCuentaAtencion =dbo.RecetaCabecera.idCuentaAtencion  ) as idPaciente

                 FROM           dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                      dbo.RecetaDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.RecetaDetalle.idItem LEFT OUTER JOIN
                                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta
                 WHERE       dbo.RecetaCabecera.idReceta=@IdReceta

GO
ALTER AUTHORIZATION ON [dbo].[RecetasConCabeceraYdetalleSoloCpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasConSinDespachoXcuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetasConSinDespachoXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.FechaReceta, dbo.RecetaCabecera.idCuentaAtencion,
                      dbo.RecetaCabecera.idEstado, dbo.RecetaDetalle.CantidadPedida, dbo.FactCatalogoServicios.Nombre, dbo.RecetaDetalle.idItem,
                          (SELECT     TOP 1 documentoDespacho
                            FROM          recetadetalleItem
                            WHERE      idReceta = dbo.recetadetalle.idreceta AND iditem = dbo.recetadetalle.iditem) AS DocDespacho
FROM         dbo.RecetaDetalle INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta
WHERE     (dbo.RecetaCabecera.IdPuntoCarga <> 5) AND (dbo.RecetaCabecera.idEstado <> 0) and dbo.RecetaCabecera.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetasConSinDespachoXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasCPTconSinDespachoXcuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetasCPTconSinDespachoXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.FechaReceta, dbo.RecetaCabecera.idCuentaAtencion,
                      dbo.RecetaCabecera.idEstado, dbo.RecetaDetalle.CantidadPedida, dbo.FactCatalogoServicios.Nombre, dbo.RecetaDetalle.idItem,dbo.FactCatalogoServicios.Codigo,
                          (SELECT     TOP 1 documentoDespacho
                            FROM          recetadetalleItem
                            WHERE      idReceta = dbo.recetadetalle.idreceta AND iditem = dbo.recetadetalle.iditem) AS DocDespacho
FROM         dbo.RecetaDetalle INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoServicios.IdProducto INNER JOIN
                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta
WHERE     (dbo.RecetaCabecera.IdPuntoCarga <> 5) AND (dbo.RecetaCabecera.idEstado <> 0) and dbo.RecetaCabecera.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetasCPTconSinDespachoXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasDevuelveDatosDelDetalle]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetasDevuelveDatosDelDetalle]
	@IdReceta [int],
	@IdPuntoCarga [int],
	@PtoCargaFarmacia [int]
WITH EXECUTE AS CALLER
AS
If @IdPuntoCarga = @PtoCargaFarmacia
       Begin
	        SELECT      dbo.RecetaDetalle.*, ltrim(dbo.FactCatalogoBienesInsumos.Codigo)+'//'+ltrim(dbo.FactCatalogoBienesInsumos.Nombre) as Producto
                     FROM          dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                                         dbo.RecetaDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.RecetaDetalle.idItem
                     Where         dbo.RecetaDetalle.idReceta=@IdReceta
      End
Else
     Begin
		        SELECT      dbo.RecetaDetalle.*, ltrim(dbo.FactCatalogoServicios.Codigo)+'//'+ltrim(dbo.FactCatalogoServicios.Nombre) as Producto
                     FROM          dbo.RecetaDetalle LEFT OUTER JOIN
                                         dbo.FactCatalogoServicios ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoServicios.IdProducto
                     Where         dbo.RecetaDetalle.idReceta=@IdReceta
      End
GO
ALTER AUTHORIZATION ON [dbo].[RecetasDevuelveDatosDelDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasFarmaciaConSinDespachoXcuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetasFarmaciaConSinDespachoXcuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RecetaCabecera.idReceta, dbo.RecetaCabecera.IdPuntoCarga, dbo.RecetaCabecera.FechaReceta, dbo.RecetaCabecera.idCuentaAtencion,
                      dbo.RecetaCabecera.idEstado, dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.idItem,
                          (SELECT     TOP 1 documentoDespacho
                            FROM          recetadetalleItem
                            WHERE      idReceta = dbo.recetadetalle.idreceta AND iditem = dbo.recetadetalle.iditem) AS DocDespacho, dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre
FROM         dbo.RecetaDetalle INNER JOIN
                      dbo.RecetaCabecera ON dbo.RecetaDetalle.idReceta = dbo.RecetaCabecera.idReceta INNER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.RecetaDetalle.idItem = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE     (dbo.RecetaCabecera.IdPuntoCarga = 5) AND (dbo.RecetaCabecera.idEstado <> 0) and dbo.RecetaCabecera.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[RecetasFarmaciaConSinDespachoXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasListadoViasAdministracion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RecetasListadoViasAdministracion]
WITH EXECUTE AS CALLER
AS
SELECT IdViaAdministracion,Descripcion FROM RecetaViaAdministracion
GO
ALTER AUTHORIZATION ON [dbo].[RecetasListadoViasAdministracion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecetasPrescritosYentregadas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecetasPrescritosYentregadas]
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
if @idFuenteFinanciamiento=0
	SELECT     dbo.TiposServicio.Descripcion AS TipoServicio, dbo.Servicios.Nombre AS Servicio, dbo.Servicios.IdServicio,
	                      dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio, dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaCabecera.FechaReceta,
	                      dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.idEstadoAtencion,dbo.Atenciones.idtipoServicio
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.RecetaCabecera INNER JOIN
	                      dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta ON
	                      dbo.Atenciones.IdCuentaAtencion = dbo.RecetaCabecera.idCuentaAtencion LEFT OUTER JOIN
	                      dbo.TiposServicio INNER JOIN
	                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio ON
	                      dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio
	WHERE     (dbo.Atenciones.idEstadoAtencion <> 0) and dbo.RecetaCabecera.idEstado<>0  and
                                dbo.RecetaCabecera.FechaReceta between @FechaRequeridaDesde and @FechaRequeridaHasta
	ORDER BY dbo.Servicios.IdServicio
else
	SELECT     dbo.TiposServicio.Descripcion AS TipoServicio, dbo.Servicios.Nombre AS Servicio, dbo.Servicios.IdServicio,
	                      dbo.RecetaDetalle.CantidadPedida, dbo.RecetaDetalle.Precio, dbo.RecetaDetalle.CantidadDespachada, dbo.RecetaCabecera.FechaReceta,
	                      dbo.Atenciones.idFuenteFinanciamiento, dbo.Atenciones.idEstadoAtencion,dbo.Atenciones.idtipoServicio
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.RecetaCabecera INNER JOIN
	                      dbo.RecetaDetalle ON dbo.RecetaCabecera.idReceta = dbo.RecetaDetalle.idReceta ON
	                      dbo.Atenciones.IdCuentaAtencion = dbo.RecetaCabecera.idCuentaAtencion LEFT OUTER JOIN
	                      dbo.TiposServicio INNER JOIN
	                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio ON
	                      dbo.RecetaCabecera.idServicioReceta = dbo.Servicios.IdServicio
	WHERE     (dbo.Atenciones.idEstadoAtencion <> 0) and dbo.RecetaCabecera.idEstado<>0 and
                                dbo.Atenciones.idFuenteFinanciamiento=@idFuenteFinanciamiento and
                                dbo.RecetaCabecera.FechaReceta between @FechaRequeridaDesde and @FechaRequeridaHasta
	ORDER BY dbo.Servicios.IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[RecetasPrescritosYentregadas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RecienNacidosVivosHospitalizadosSeleccionarPorAnioYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RecienNacidosVivosHospitalizadosSeleccionarPorAnioYMes]
	@Anio [int],
	@Mes [char](2),
	@Departamento [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.idCuentaAtencion
FROM Pacientes, Atenciones, Especialidades, DepartamentosHospital, AtencionesDatosAdicionales, Servicios, TiposOrigenAtencion
WHERE dbo.Pacientes.IdPaciente = dbo.Atenciones.IdPaciente AND
                    dbo.Especialidades.IdDepartamento = dbo.DepartamentosHospital.IdDepartamento AND
                    dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad AND
                    dbo.Atenciones.IdServicioEgreso = dbo.Servicios.IdServicio AND
                    dbo.Atenciones.IdAtencion = dbo.AtencionesDatosAdicionales.IdAtencion AND
                    dbo.Atenciones.IdTipoServicio = 3 AND dbo.Atenciones.FechaEgreso IS NOT NULL AND
                    YEAR(dbo.Atenciones.FechaEgreso)=@Anio AND
                    MONTH(dbo.Atenciones.FechaEgreso)=@Mes
                    AND atenciones.idOrigenAtencion=tiposOrigenAtencion.idOrigenAtencion AND
                    tiposOrigenAtencion.idTipoServicio=atenciones.idTipoServicio AND tiposOrigenAtencion.Codigo<>'X' AND
                    Atenciones.idEstadoAtencion<>0 AND AtencionesDatosAdicionales.recienNacido=1 AND
                    dbo.DepartamentosHospital.IdDepartamento=@Departamento
GO
ALTER AUTHORIZATION ON [dbo].[RecienNacidosVivosHospitalizadosSeleccionarPorAnioYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReembolsoDetalleItemSeleccionarPorIdCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReembolsoDetalleItemSeleccionarPorIdCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdOrden, dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactOrdenServicio.IdCuentaAtencion,
                                dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.FacturacionServicioFinanciamientos.idProducto,
                                dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento, dbo.FacturacionServicioFinanciamientos.TotalFinanciado,
                                dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
                                dbo.Atenciones.IdTipoServicio, dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.IdServicioGrupo
           FROM          dbo.Atenciones RIGHT OUTER JOIN
                                dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion RIGHT OUTER JOIN
                                dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                                dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.IdOrden
           Where          (dbo.FactOrdenServicio.idCuentaAtencion = @IdCuentaAtencion) And (dbo.FactOrdenServicio.IdEstadoFacturacion = 4)
           ORDER BY dbo.FactOrdenServicio.IdPuntoCarga
GO
ALTER AUTHORIZATION ON [dbo].[ReembolsoDetalleItemSeleccionarPorIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePago]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePago]
	@lnIdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactReembolsosDocumentos.idFactReembolso, dbo.FactReembolsosDocumentos.idComprobantePago,
                                 dbo.FacturacionReembolsos.ReembolsoPagadoFarmacia, dbo.FacturacionReembolsos.ReembolsoPagadoServicio,
                                 dbo.FactReembolsos.idEstadoReembolso, dbo.FacturacionReembolsos.idCuentaAtencion
                FROM       dbo.FacturacionReembolsos LEFT OUTER JOIN
			       dbo.FactReembolsos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsos.idFactReembolso LEFT OUTER JOIN
                                 dbo.FactReembolsosDocumentos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso
                where        dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FactReembolsosDocumentos.idComprobantePago=@lnIdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePagoIdCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePagoIdCuenta]
	@IdComprobantePago [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactReembolsosDocumentos.idFactReembolso, dbo.FactReembolsosDocumentos.idComprobantePago,
                                   dbo.FacturacionReembolsos.ReembolsoPagadoFarmacia, dbo.FacturacionReembolsos.ReembolsoPagadoServicio,
                                   dbo.FactReembolsos.idEstadoReembolso, dbo.FacturacionReembolsos.idCuentaAtencion
                 FROM        dbo.FacturacionReembolsos LEFT OUTER JOIN
                                   dbo.FactReembolsos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsos.idFactReembolso LEFT OUTER JOIN
                                   dbo.FactReembolsosDocumentos ON dbo.FacturacionReembolsos.idFactReembolso = dbo.FactReembolsosDocumentos.idFactReembolso
                 where         dbo.FactReembolsos.idEstadoReembolso=1 and dbo.FactReembolsosDocumentos.idComprobantePago=@IdComprobantePago
                                   and dbo.FacturacionReembolsos.idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ReembolsoDetalleSeleccionaPorIdComprobantePagoIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReembolsosAnular]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReembolsosAnular]
	@IdFactReembolso [int]
WITH EXECUTE AS CALLER
AS
select * from FacturacionReembolsos where idFactReembolso=@IdFactReembolso
GO
ALTER AUTHORIZATION ON [dbo].[ReembolsosAnular] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicio]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHasta]
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
And FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolDesdeHasta]
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
And FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
And FechaSolicitud between @FechaSolicitudDesde and @FechaSolicitudHasta
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolicitud]
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
And FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
and FechaSolicitud =@FechaSolicitudDesde
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaReqDesdeHastaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequerida]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequerida]
	@FechaRequeridaDesde [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
and FechaRequerida = @FechaRequeridaDesde
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequerida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolDesdeHasta]
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
And FechaRequerida = @FechaRequeridaDesde
And FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolicitud]
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
And FechaRequerida = @FechaRequeridaDesde
and FechaSolicitud = @FechaSolicitudDesde
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaRequeridaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolDesdeHasta]
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
 And FechaSolicitud between @FechaSolicitudDesde  and @FechaSolicitudHasta
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolicitud]
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
Select Servicios.Codigo, Servicios.idTipoServicio,Servicios.Nombre as Servicio, count(*) as Cantidad
	         From HistoriasSolicitadas left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio
	         where 1 = 1
and FechaSolicitud = @FechaSolicitudDesde
Group By Servicios.Codigo, Servicios.Nombre,Servicios.idTipoServicio
Order By Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RepCantidadHistoriaSolicitadasPorServicioFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepDesagregaCuentasItemsXreembolso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepDesagregaCuentasItemsXreembolso]
	@IdComprobantePago [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FacturacionReembolsos.idCuentaAtencion, dbo.FacturacionReembolsos.ReembolsoPagadoServicio,
                                  dbo.FactReembolsosDocumentos.idFactReembolso, dbo.FactReembolsosDocumentos.idComprobantePago,
                                  dbo.FactReembolsos.idFuenteFinanciamiento
             FROM         dbo.FactReembolsosDocumentos RIGHT OUTER JOIN
                                  dbo.FacturacionReembolsos ON
                                  dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FacturacionReembolsos.idFactReembolso FULL OUTER JOIN
                                  dbo.FactReembolsos ON dbo.FactReembolsosDocumentos.idFactReembolso = dbo.FactReembolsos.idFactReembolso
             WHERE      dbo.FactReembolsosDocumentos.idComprobantePago=@IdComprobantePago
GO
ALTER AUTHORIZATION ON [dbo].[RepDesagregaCuentasItemsXreembolso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepDesagregaCuentasItemsXreembolsoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepDesagregaCuentasItemsXreembolsoServicio]
	@IdCuentaAtencion [int],
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FacturacionServicioFinanciamientos.idOrden, dbo.FacturacionServicioFinanciamientos.idProducto,
                                          dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento, dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento,
                                          dbo.FacturacionServicioFinanciamientos.CantidadFinanciada, dbo.FacturacionServicioFinanciamientos.PrecioFinanciado,
                                          dbo.FacturacionServicioFinanciamientos.TotalFinanciado, dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion,
                                          dbo.FactCatalogoServicios.Codigo , dbo.FactCatalogoServicios.Nombre, dbo.FactCatalogoServicios.IdPartida, dbo.TiposTarifaCpt.idTipoTarifa
                     FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                          dbo.TiposTarifaCpt ON dbo.FactCatalogoServicios.IdProducto = dbo.TiposTarifaCpt.idProductoCpt RIGHT OUTER JOIN
                                          dbo.FacturacionServicioFinanciamientos ON
                                          dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto LEFT OUTER JOIN
                                          dbo.FactOrdenServicio ON dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
                     WHERE dbo.FactOrdenServicio.IdCuentaAtencion=@IdCuentaAtencion  and dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento= @IdFuenteFinanciamiento
                     and (dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=1 or dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion=4)
GO
ALTER AUTHORIZATION ON [dbo].[RepDesagregaCuentasItemsXreembolsoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida between  @FechaRequeridaDesde  and  @FechaRequeridaHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida between  @FechaRequeridaDesde  and  @FechaRequeridaHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,


			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida between  @FechaRequeridaDesde  and  @FechaRequeridaHasta
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				 and FechaRequerida between  @FechaRequeridaDesde  and  @FechaRequeridaHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN

		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and FechaSolicitud = @FechaSolicitudDesde
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaReqDesdeHastaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaRequerida]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaRequerida]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida =@FechaRequeridaDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida =@FechaRequeridaDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida =@FechaRequeridaDesde
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida =@FechaRequeridaDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaRequerida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida =@FechaRequeridaDesde
				and FechaSolicitud between @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida =@FechaRequeridaDesde
				and FechaSolicitud between @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida =@FechaRequeridaDesde
				and FechaSolicitud between @FechaSolicitudDesde and @FechaSolicitudHasta
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida =@FechaRequeridaDesde
				and FechaSolicitud between @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)  and IdMovimiento is null
				and FechaRequerida =  @FechaRequeridaDesde
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
			               select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                where Servicios.IdTipoServicio = @IdTipoServicio and HistoriasSolicitadas.IdServicio in
			               (select IdServicio from ArchiveroServicio where IdEmpleado = @IdResponsable)
				and FechaRequerida =  @FechaRequeridaDesde
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 -- AGREGA (and IdMovimiento is null)
			BEGIN
				Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida =  @FechaRequeridaDesde
				and FechaSolicitud = @FechaSolicitudDesde
				 Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
		ELSE
			BEGIN
				 Select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
			               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
			               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
			               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
			                from (((HistoriasSolicitadas
			               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
			                             where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida =  @FechaRequeridaDesde
				and FechaSolicitud = @FechaSolicitudDesde
				Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaRequeridaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		SET @SQL=' select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
		               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
		               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
		               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
		               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
		               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
		               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
		                from (((HistoriasSolicitadas
		               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
		               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
		               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
		               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
		                where Servicios.IdTipoServicio =' + @IdTipoServicio + '  and HistoriasSolicitadas.IdServicio in
		               (select IdServicio from ArchiveroServicio where IdEmpleado =' + @IdResponsable + ')  ' + @IncluyeHistoriasQueSalieron
	END
ELSE
	BEGIN
		SET @SQL=' select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
		               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
		               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
		               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
		               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
		               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
		               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
		                from (((HistoriasSolicitadas
		               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
		               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
		               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
		               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
		                where Servicios.IdTipoServicio =' + @IdTipoServicio + ' ' +  @IncluyeHistoriasQueSalieron
	END

SET @SQL=@SQL + '  And FechaSolicitud between ' +  @FechaSolicitudDesde + ' and ' + @FechaSolicitudHasta
SET @SQL= @SQL + ' Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepFiltrarHistoriaSolicitadasFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepFiltrarHistoriaSolicitadasFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

IF @SeleccionaFilaParametro231 <> 'S'
	BEGIN
		SET @SQL=' select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
		               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
		               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
		               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
		               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
		               TiposHistoriaClinica.Descripcion as TipoHistoria,HistoriasSolicitadas.idAtencion,
		               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
		                from (((HistoriasSolicitadas
		               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
		               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
		               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
		               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
		                where Servicios.IdTipoServicio =' + @IdTipoServicio + '  and HistoriasSolicitadas.IdServicio in
		               (select IdServicio from ArchiveroServicio where IdEmpleado =' + @IdResponsable + ')  ' + @IncluyeHistoriasQueSalieron
	END
ELSE
	BEGIN
		SET @SQL=' select HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
		               HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
		               Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
		               convert(varchar(10), FechaSolicitud, 103) as FechaSolicitud,
		               convert(VarChar(10), FechaRequerida, 103) As FechaRequerida,
		               TiposHistoriaClinica.Descripcion as TipoHistoria, HistoriasSolicitadas.idAtencion,
		               HistoriasSolicitadas.HoraSolicitud,HistoriasSolicitadas.HoraRequerida,HistoriasSolicitadas.fechaHoraReg
		                from (((HistoriasSolicitadas
		               left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
		               left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
		               left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
		               left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria
		                where Servicios.IdTipoServicio =' + @IdTipoServicio + ' ' +  @IncluyeHistoriasQueSalieron
	END

SET @SQL=@SQL + ' and FechaSolicitud =' + @FechaSolicitudDesde + ' '
SET @SQL= @SQL + 'Order By HistoriasSolicitadas.IdServicio,HistoriasSolicitadas.FechaRequerida, HistoriasSolicitadas.HoraRequerida,Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[RepFiltrarHistoriaSolicitadasFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReportDiarioDeCaja]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReportDiarioDeCaja]
	@Estados [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'Select FactCatalogoServicios.IdProducto, FactPartidasPresupuestales.codigo , FactCatalogoServicios.Nombre, Sum(FacturacionServicios.TotalPorPagar) as TotalPorPagar
	          From (((CajaGestion
	          Left join  CajaComprobantesPago on CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja)
	          Left join FacturacionServicios on CajaComprobantesPago.IdComprobantePago = FacturacionServicios.IdComprobantePago)
	          Left join FactCatalogoServicios on FacturacionServicios.IdProducto = FactCatalogoServicios.IdProducto)
	          Left join FactPartidasPresupuestales on FactCatalogoServicios.IdPartida = FactPartidasPresupuestales.IdPartidaPresupuestal
	          Where FactCatalogoServicios.IdProducto Is Not Null
	          And FacturacionServicios.IdEstadoFacturacion in ' +  @Estados +
	          ' Group By FactCatalogoServicios.IdProducto , FactPartidasPresupuestales.codigo, FactCatalogoServicios.Nombre'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ReportDiarioDeCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[reporte_cabeceraInsertar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[reporte_cabeceraInsertar]
	@nroCuenta [int],
	@Paciente [varchar](100)
WITH EXECUTE AS CALLER
AS
insert into reporte_cabecera (
nroCuenta,Paciente)
values (
@nroCuenta,@Paciente)
GO
ALTER AUTHORIZATION ON [dbo].[reporte_cabeceraInsertar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[reporte_detalleInsertar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[reporte_detalleInsertar]
	@idUsuario [int],
	@nroCuenta [int],
	@ConsumoDescripcion [varchar](200),
	@ConsumoImporte [money]
WITH EXECUTE AS CALLER
AS
insert into reporte_detalle(
idUsuario,nroCuenta,ConsumoDescripcion,ConsumoImporte)
values (
@idUsuario,@nroCuenta,@ConsumoDescripcion,@ConsumoImporte)
GO
ALTER AUTHORIZATION ON [dbo].[reporte_detalleInsertar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteConsolidadodeServiciosExoneraciones]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteConsolidadodeServiciosExoneraciones]
WITH EXECUTE AS CALLER
AS
Select CajaGestion.IdGestionCaja, CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.nroSerie, CajaComprobantesPago.NroDocumento,
FacturacionCuentasAtencion.idPaciente , Pacientes.NroHistoriaClinica, CajaComprobantesPago.RazonSocial, Sum(FacturacionServicios.TotalPorPagar) as TotalPorPagar
From ((((CajaGestion
Left Join CajaComprobantesPago on CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja)
Left Join FacturacionServicios on CajaComprobantesPago.IdComprobantePago = FacturacionServicios.IdComprobantePago)
Left Join FactCatalogoServicios on FacturacionServicios.IdProducto = FactCatalogoServicios.IdProducto)
Left Join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = CajaComprobantesPago.IdCuentaAtencion)
Left Join PAcientes on Pacientes.IdPaciente = FacturacionCuentasAtencion.IdPaciente
WHERE FacturacionServicios.IdEstadoFacturacion = 4
And FacturacionServicios.IdProducto = 4692
Group By
CajaGestion.IdGestionCaja, CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento,
FacturacionCuentasAtencion.IdPaciente , Pacientes.NroHistoriaClinica, CajaComprobantesPago.RazonSocial
GO
ALTER AUTHORIZATION ON [dbo].[ReporteConsolidadodeServiciosExoneraciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteConsolidadodeServiciosSinExoneraciones]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteConsolidadodeServiciosSinExoneraciones]
	@Estados [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'Select CajaGestion.IdGestionCaja, CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.nroSerie, CajaComprobantesPago.NroDocumento,
		FacturacionCuentasAtencion.idPaciente , Pacientes.NroHistoriaClinica, CajaComprobantesPago.RazonSocial, Sum(FacturacionServicios.TotalPorPagar) as TotalPorPagar
		from ((((CajaGestion
		left join  CajaComprobantesPago on CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja)
		left join FacturacionServicios on CajaComprobantesPago.IdComprobantePago = FacturacionServicios.IdComprobantePago)
		left join FactCatalogoServicios on FacturacionServicios.IdProducto = FactCatalogoServicios.IdProducto)
		left join FacturacionCuentasAtencion on FacturacionCuentasAtencion.IdCuentaAtencion = CajaComprobantesPago.IdCuentaAtencion)
		left join PAcientes on Pacientes.IdPaciente = FacturacionCuentasAtencion.IdPaciente
		where FacturacionServicios.IdEstadoFacturacion In ' + @Estados + ' And FacturacionServicios.IdProducto <> 4692
		Group By CajaGestion.IdGestionCaja, CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.nroSerie, CajaComprobantesPago.NroDocumento,
		FacturacionCuentasAtencion.idPaciente , Pacientes.NroHistoriaClinica, CajaComprobantesPago.RazonSocial'
EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ReporteConsolidadodeServiciosSinExoneraciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteEgresosHospitalarios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ReporteEgresosHospitalarios]
	@IdDepartamentoEgreso [int],
	@IdServicioEgreso [int],
	@IdEspecialidadEgreso [int],
	@TipoEspecialidad [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @TipoEspecialidad = 3
	BEGIN
		IF @IdServicioEgreso = 0
			BEGIN
				 IF @IdDepartamentoEgreso <> 0
					BEGIN
						IF @IdEspecialidadEgreso <> 0
							BEGIN
								Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
								Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
								TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
								ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
								FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion  ,
								Pacientes.NroDocumento
								From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
								LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
								left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
								left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								 Where Atenciones.IdTipoServicio = 3         --Solo Hospitalizacion
								 and  Atenciones.FechaEgreso is not null
									 and  Atenciones.FechaEgreso Between @FechaEgrIni  and @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								 and Especialidades.IdDepartamento =@IdDepartamentoEgreso
								 and Especialidades.IdEspecialidad =@IdEspecialidadEgreso
								 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
								Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
								TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
								ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
								FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
								Pacientes.NroDocumento
								From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
								LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
								left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
								left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								 Where Atenciones.IdTipoServicio = 3         --Solo Hospitalizacion
								 and  Atenciones.FechaEgreso is not null
									 and  Atenciones.FechaEgreso Between @FechaEgrIni and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								 and Especialidades.IdDepartamento =@IdDepartamentoEgreso
								 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
				ELSE
					BEGIN
						IF @IdEspecialidadEgreso <> 0
							BEGIN
								Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
								Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
								TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
								ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
								FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
								Pacientes.NroDocumento
								From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
								LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
								left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
								left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								 Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
								 and  Atenciones.FechaEgreso is not null
									 and  Atenciones.FechaEgreso Between  @FechaEgrIni  and @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								 and Especialidades.IdEspecialidad =@IdEspecialidadEgreso
								 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
								Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
								TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
								ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
								FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
								Pacientes.NroDocumento
								From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
								LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
								left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
								left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								 Where Atenciones.IdTipoServicio = 3         --Solo Hospitalizacion
								 and  Atenciones.FechaEgreso is not null
									 and  Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
			END
		ELSE --@IdServicioEgreso <> 0
			BEGIN
				Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
				Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
				Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
				convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
				TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
				ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
				FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
				Pacientes.NroDocumento
				From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
				left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
				left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
				LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
				LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
				left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
				left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
				 Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
				 and  Atenciones.FechaEgreso is not null
					 and  Atenciones.FechaEgreso Between  @FechaEgrIni and @FechaEgrFin
				and Atenciones.idEstadoAtencion<>0
				and Atenciones.IdServicioEgreso = @IdServicioEgreso
				 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
ELSE
	BEGIN
		IF @TipoEspecialidad=1
			BEGIN
				IF @IdServicioEgreso = 0
					BEGIN
						 IF @IdDepartamentoEgreso <> 0
							BEGIN
								IF @IdEspecialidadEgreso <> 0
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio = 1         --Solo Consultorio Externo
										 and  Atenciones.fechaIngreso Between @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdDepartamento = @IdDepartamentoEgreso
										 and Especialidades.IdEspecialidad = @IdEspecialidadEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
								ELSE
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio = 1         --Solo Consultorio Externo
										 and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdDepartamento = @IdDepartamentoEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
							END
						ELSE
							BEGIN
								IF @IdEspecialidadEgreso <> 0
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio = 1         --Solo Consultorio Externo
										 and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdEspecialidad =@IdEspecialidadEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
								ELSE
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio = 1        --Solo Consultorio Externo
										 and  Atenciones.fechaIngreso Between  @FechaEgrIni  and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
							END
					END
				ELSE --@IdServicioEgreso <> 0
					BEGIN
						Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
						Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
						Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
						convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
						TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
						ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
						FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
						Pacientes.NroDocumento
						From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
						left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
						left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
						LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
						LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
						left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
						left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
						 Where Atenciones.IdTipoServicio = 1        --Solo Consultorio Externo
						 and  Atenciones.fechaIngreso Between  @FechaEgrIni and @FechaEgrFin
						and Atenciones.idEstadoAtencion<>0
						and Atenciones.IdServicioIngreso = @IdServicioEgreso
						 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
					END

			END
		ELSE
			BEGIN
				IF @IdServicioEgreso = 0
					BEGIN
						 IF @IdDepartamentoEgreso <> 0
							BEGIN
								IF @IdEspecialidadEgreso <> 0
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
											 and  Atenciones.FechaEgreso is not null
											 and  Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdDepartamento = @IdDepartamentoEgreso
										 and Especialidades.IdEspecialidad =@IdEspecialidadEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
								ELSE
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
											 and  Atenciones.FechaEgreso is not null
											 and  Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdDepartamento = @IdDepartamentoEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
							END
						ELSE
							BEGIN
								IF @IdEspecialidadEgreso <> 0
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio in (2,4)    --Solo emergencia
											 and  Atenciones.FechaEgreso is not null
											 and  Atenciones.FechaEgreso Between  @FechaEgrIni  and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 and Especialidades.IdEspecialidad =@IdEspecialidadEgreso
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END
								ELSE
									BEGIN
										Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
										Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
										Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
										convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
										TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
										ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
										FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
										Pacientes.NroDocumento
										From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
										left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
										left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
										LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
										LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
										left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
										left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
										 Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
											 and  Atenciones.FechaEgreso is not null
											 and  Atenciones.FechaEgreso Between  @FechaEgrIni and  @FechaEgrFin
										and Atenciones.idEstadoAtencion<>0
										 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
									END

							END
					END
				ELSE --@IdServicioEgreso <> 0
					BEGIN
						Select Atenciones.IdAtencion as IdAtencion, FacturacionCuentasAtencion.IdCuentaAtencion, Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
						Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as TipoEdad,
						Departamentos.Nombre AS Departamento, Provincias.Nombre AS Provincia, Distritos.Nombre AS Distrito, CentrosPoblados.Nombre AS CentroPoblado, '', '',
						convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,  convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso,
						TiposCondicionAlta.Descripcion as CondicionAlta,  ServIng.Codigo as ServicioIngresoCodigo , ServIng.Nombre as ServicioIngresoNombre,
						ServEgr.Codigo as ServicioEgresoCodigo, ServEgr.Nombre as ServicioEgresoNombre, TiposAlta.Descripcion as TipoAlta, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento,
						FuentesFinanciamiento.descripcion as DescFuenteFinanciamiento, Pacientes.telefono,Pacientes.DireccionDomicilio,Atenciones.IdCondicionAlta ,Pacientes.IdPaciente, atenciones.horaInicioAtencion,
						Pacientes.NroDocumento
						From ((((((((((((((Atenciones  left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)  left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
						left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
						left join FuentesFinanciamiento on Atenciones.IdFuenteFinanciamiento= FuentesFinanciamiento.idFuenteFinanciamiento)     left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
						LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)           LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito)
						LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia)   LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)
						left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)   left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)
						left join Especialidades on ServEgr.IdEspecialidad = Especialidades.IdEspecialidad)   left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)   left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
						 Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
						 and  Atenciones.FechaEgreso is not null
						 and  Atenciones.FechaEgreso Between @FechaEgrIni and  @FechaEgrFin
						 and Atenciones.idEstadoAtencion<>0
						and Atenciones.IdServicioEgreso = @IdServicioEgreso
						 order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
					END

			END
	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteEgresosHospitalarios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteEliminaTodoContenido]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteEliminaTodoContenido]
	@NombreTabla [varchar](50)
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON;

DECLARE @sql nvarchar(100);

SET @sql = 'DELETE FROM ' + @NombreTabla

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[ReporteEliminaTodoContenido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedico]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde  and @FechaRequeridaHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas

			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and FechaRequerida between @FechaRequeridaDesde  and @FechaRequeridaHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and FechaRequerida between @FechaRequeridaDesde  and @FechaRequeridaHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and FechaRequerida between @FechaRequeridaDesde  and @FechaRequeridaHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud between @FechaSolicitudDesde and  @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaRequeridaHasta [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud =@FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud =@FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud =@FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaRequerida between @FechaRequeridaDesde and  @FechaRequeridaHasta
				and HistoriasSolicitadas.FechaSolicitud =@FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaReqDesdeHastaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequerida]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequerida]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequerida] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =@FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaRequerida =@FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =@FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaRequerida =@FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaRequeridaDesde [datetime],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaRequerida =  @FechaRequeridaDesde
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaRequeridaFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolDesdeHasta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolDesdeHasta]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaSolicitudDesde [datetime],
	@FechaSolicitudHasta [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaSolicitud between  @FechaSolicitudDesde and @FechaSolicitudHasta
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolDesdeHasta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolicitud]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolicitud]
	@IdResponsable [int],
	@IdTipoServicio [int],
	@SeleccionaFilaParametro231 [char](1),
	@IncluyeHistoriasQueSalieron [int],
	@FechaSolicitudDesde [datetime]
WITH EXECUTE AS CALLER
AS
IF @SeleccionaFilaParametro231 = 'S'
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and IdMovimiento is null
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				 Empleados.Nombres MedicoNombres , ltrim(Empleados.ApellidoPaterno)+" "+ltrim(Empleados.ApellidoMaterno)+" "+ltrim(Empleados.Nombres) as nMedico,
			              HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida , Pacientes.FichaFamiliar,Pacientes.nroDocumento,
			              TiposHistoriaClinica.Descripcion as TipoHistoria, ltrim(Pacientes.ApellidoPaterno)+" "+ltrim(Pacientes.ApellidoMaterno)+" "+ltrim(Pacientes.PrimerNombre) as nPaciente,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END


	END
ELSE
	BEGIN
		IF @IncluyeHistoriasQueSalieron=0 --AGREGA and IdMovimiento is null
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable) and IdMovimiento is null
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio
			END
		ELSE
			BEGIN
				Select Medicos.IdMedico, Empleados.ApellidoPaterno MedicoApellidoPaterno, Empleados.ApellidoMaterno MedicoApellidoMaterno,
				Empleados.Nombres MedicoNombres , HistoriasSolicitadas.IdServicio, Servicios.Nombre as Servicio,
			              HistoriasSolicitadas.IdPaciente, Pacientes.NroHistoriaClinica,
			              Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre, Pacientes.SegundoNombre,
			              convert(varchar(10), HistoriasSolicitadas.FechaSolicitud, 103) as FechaSolicitud,
			              convert(VarChar(10), HistoriasSolicitadas.FechaRequerida, 103) As FechaRequerida,
			               HistoriasSolicitadas.HoraRequerida ,
			              TiposHistoriaClinica.Descripcion as TipoHistoria,
			              HistoriasSolicitadas.HoraSolicitud, HistoriasSolicitadas.HoraRequerida, HistoriasSolicitadas.fechaHoraReg
			               from ((((((Citas
			              left join HistoriasSolicitadas on Citas.IdPaciente = HistoriasSolicitadas.IdPaciente
			              and Citas.Fecha = HistoriasSolicitadas.FechaRequerida
			              and Citas.HoraInicio = HistoriasSolicitadas.HoraRequerida)
			              left join Pacientes on HistoriasSolicitadas.IdPaciente = Pacientes.IdPaciente)
			              left join Servicios on HistoriasSolicitadas.IdServicio = Servicios.IdServicio)
			              left join HistoriasClinicas on Pacientes.IdPaciente = HistoriasClinicas.IdPaciente)
			              left join TiposHistoriaClinica on HistoriasClinicas.IdTipoHistoria = TiposHistoriaClinica.IdTipoHistoria)
			              left join Medicos on Medicos.IdMedico = Citas.IdMedico)
			              left join Empleados on Medicos.IdEmpleado = Empleados.IdEmpleado
			              where Servicios.IdTipoServicio =@IdTipoServicio and HistoriasSolicitadas.IdServicio in
			              (select IdServicio from ArchiveroServicio where IdEmpleado =@IdResponsable)
				and HistoriasSolicitadas.FechaSolicitud = @FechaSolicitudDesde
				Order By Empleados.ApellidoPaterno, Empleados.ApellidoMaterno, Empleados.Nombres, Citas.Fecha, Citas.HoraInicio

			END

	END
GO
ALTER AUTHORIZATION ON [dbo].[ReporteHistoriasSolicitadasCEPorMedicoFechaSolicitud] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteIngresosHospitalarios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ReporteIngresosHospitalarios]
	@IdDepartamentoIngreso [int],
	@IdServicioIngreso [int],
	@IdEspecialidadIngreso [int],
	@TipoEspecialidad [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
IF @TipoEspecialidad = 3
	BEGIN
		IF @IdServicioIngreso = 0
			BEGIN
				 IF @IdDepartamentoIngreso <> 0
					BEGIN
						IF @IdEspecialidadIngreso <> 0
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr

								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
								and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdDepartamento = @IdDepartamentoIngreso
								and Especialidades.IdEspecialidad =@IdEspecialidadIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
								and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdDepartamento = @IdDepartamentoIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
				  ELSE
					BEGIN
						IF @IdEspecialidadIngreso <> 0
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio = 3         --Solo Hospitalizacion
								and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdEspecialidad = @IdEspecialidadIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
								and  Atenciones.fechaIngreso Between @FechaEgrIni and @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
			END
		ELSE
			BEGIN
				Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
				Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
				Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
				convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
				convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
				ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
				TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
				, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
				, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
				Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
				 From (((((((((((((((Atenciones
				left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
				left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
				left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
				left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
				and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
				left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
				left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
				LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
				LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
				LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
				left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
				left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
				Where Atenciones.IdTipoServicio = 3         --Solo Hospitalizacion

				and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
				and Atenciones.idEstadoAtencion<>0
				and Atenciones.IdServicioIngreso = @IdServicioIngreso
				order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END

	END
ELSE
	BEGIN
		IF @IdServicioIngreso = 0
			BEGIN
				 IF @IdDepartamentoIngreso <> 0
					BEGIN
						IF @IdEspecialidadIngreso <> 0
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion,
								Atenciones.idCuentaAtencion ,Atenciones.IdTipoGravedad,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
								and  Atenciones.fechaIngreso Between @FechaEgrIni and @FechaEgrFin
								 and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdDepartamento = @IdDepartamentoIngreso
								and Especialidades.IdEspecialidad = @IdEspecialidadIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
								and  Atenciones.fechaIngreso Between @FechaEgrIni  and  @FechaEgrFin
								and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdDepartamento = @IdDepartamentoIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
				  ELSE
					BEGIN
						IF @IdEspecialidadIngreso <> 0
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
								and  Atenciones.fechaIngreso Between  @FechaEgrIni and @FechaEgrFin
								 and Atenciones.idEstadoAtencion<>0
								and Especialidades.IdEspecialidad = @IdEspecialidadIngreso
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
						ELSE
							BEGIN
								Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
								Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
								Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
								convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
								convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
								ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
								TiposAlta.Descripcion as TipoAlta,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
								, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
								, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
								Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
								 From (((((((((((((((Atenciones
								left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
								left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
								left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
								left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
								and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
								left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
								left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
								LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
								LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
								LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
								left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
								left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
								Where Atenciones.IdTipoServicio in (2,4)   --Solo emergencia
								and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
								 and Atenciones.idEstadoAtencion<>0
								order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
							END
					END
			END
		ELSE
			BEGIN
				Select Pacientes.NroHistoriaClinica, TiposNumeracionHistoria.Descripcion as TipoNumeracion,
				Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno , Pacientes.PrimerNombre, Pacientes.SegundoNombre, TiposSexo.Descripcion as Sexo, Atenciones.Edad, TiposEdad.Codigo as tEdad,
				Departamentos.Nombre as Dpto, Provincias.Nombre as Prov, Distritos.Nombre as Dist, CentrosPoblados.Nombre as CentP,'', '',
				convert(char(10),Atenciones.FechaIngreso,103) as FechaIngreso, Atenciones.HoraIngreso,
				convert(char(10),Atenciones.FechaEgreso,103) as FechaEgreso, Atenciones.HoraEgreso, TiposCondicionAlta.Descripcion as CondicionAlta,
				ServIng.Codigo as CodServIng, ServIng.Nombre as ServicioIngreso, ServEgr.Codigo, ServEgr.Nombre as ServicioEgreso,
				TiposAlta.Descripcion as TipoAlta ,serving.codigoServicioSuSalud as CodServSSing, ServEgr.codigoServicioSuSalud as CodServSSegr
				, Diagnosticos.CodigoCIE2004 as DxPrincipal, Diagnosticos.Descripcion as Ddx
				, Atenciones.IdServicioIngreso, Atenciones.IdServicioEgreso,Atenciones.idFuenteFinanciamiento, Pacientes.IdTipoNumeracion ,
				Atenciones.idCuentaAtencion,Atenciones.IdTipoGravedad ,Atenciones.IdAtencion,Atenciones.IdCondicionAlta
				 From (((((((((((((((Atenciones
				left join Pacientes on Atenciones.IdPaciente = Pacientes.IdPaciente)
				left join TiposNumeracionHistoria on Pacientes.IdTipoNumeracion = TiposNumeracionHistoria.IdTipoNumeracion)
				left join FacturacionCuentasAtencion on Atenciones.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion)
				left join AtencionesDiagnosticos on (Atenciones.IdAtencion = AtencionesDiagnosticos.IdAtencion
				and AtencionesDiagnosticos.IdClasificacionDx = 3   and AtencionesDiagnosticos.IdSubClasificacionDx = 301))
				left join Diagnosticos on AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico)   left join TiposAlta on Atenciones.IdTipoAlta = TiposAlta.IdTipoAlta)
				left join TiposCondicionAlta on Atenciones.IdCondicionAlta = TiposCondicionAlta.IdCondicionAlta)
				LEFT OUTER JOIN  CentrosPoblados ON Pacientes.IdCentroPobladoDomicilio = CentrosPoblados.IdCentroPoblado)
				LEFT OUTER JOIN  Distritos ON Pacientes.IdDistritoDomicilio = Distritos.IdDistrito )  LEFT OUTER JOIN  Provincias ON Distritos.IdProvincia = Provincias.IdProvincia )
				LEFT OUTER JOIN  Departamentos ON Provincias.IdDepartamento = Departamentos.IdDepartamento)   left join Servicios as ServIng on Atenciones.IdServicioIngreso = ServIng.IdServicio)
				left join Servicios as ServEgr on Atenciones.IdServicioEgreso = ServEgr.IdServicio)   left join Especialidades on ServIng.IdEspecialidad = Especialidades.IdEspecialidad)
				left join TiposSexo on Pacientes.IdTipoSexo = TiposSexo.IdTipoSexo)  left join TiposEdad on Atenciones.IdTipoEdad = TiposEdad.IdTipoEdad
				Where Atenciones.IdTipoServicio in (2,4)     --Solo emergencia
				and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
				and Atenciones.idEstadoAtencion<>0
				and Atenciones.IdServicioIngreso =@IdServicioIngreso
				order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
			END
	END

GO
ALTER AUTHORIZATION ON [dbo].[ReporteIngresosHospitalarios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteIngresosHospitalariosXfuente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ReporteIngresosHospitalariosXfuente]
	@idFuenteFinanciamiento [int],
	@diasEstancia [int],
	@FechaEgrIni [datetime],
	@FechaEgrFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     LEFT(LTRIM(STR(dbo.Atenciones.IdCuentaAtencion)), 10) AS nroCuenta, LEFT(LTRIM(STR(dbo.Pacientes.NroHistoriaClinica)), 10) AS HistoriaClinica,
                      LEFT(dbo.Pacientes.ApellidoPaterno + ' ' + dbo.Pacientes.ApellidoMaterno + ' ' + dbo.Pacientes.PrimerNombre, 50) AS paciente,
                      Atenciones.FechaIngreso,
                      dbo.Atenciones.HoraIngreso, LEFT(dbo.Servicios.Nombre, 30) AS ServicioIngreso,
                      datediff(day,   convert(datetime,convert(char(10),Atenciones.FechaIngreso,103) +' '+atenciones.horaIngreso),    @FechaEgrFin) as Estancia

FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
Where Atenciones.IdTipoServicio = 3        --Solo Hospitalizacion
		and  Atenciones.fechaIngreso Between  @FechaEgrIni and  @FechaEgrFin
		and Atenciones.idEstadoAtencion<>0
		and Atenciones.idFuenteFinanciamiento = @idFuenteFinanciamiento
		and Atenciones.FechaEgreso is null
                           and datediff(day,
			      convert(datetime,convert(char(10),Atenciones.FechaIngreso,103) +' '+atenciones.horaIngreso),
		                   @FechaEgrFin)  >= @diasEstancia
		order by Atenciones.FechaIngreso desc, Atenciones.HoraIngreso desc, Pacientes.ApellidoPaterno, Pacientes.ApellidoMaterno, Pacientes.PrimerNombre
GO
ALTER AUTHORIZATION ON [dbo].[ReporteIngresosHospitalariosXfuente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteProgramacionMedicaPorMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ReporteProgramacionMedicaPorMedico]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
select ProgramacionMedica.IdMedico, ProgramacionMedica.Fecha, ProgramacionMedica.HoraInicio,
            ProgramacionMedica.HoraFin , ProgramacionMedica.IdTurno, Turnos.Codigo as CodigoTurno
From ProgramacionMedica  left join Turnos on ProgramacionMedica.IdTurno = Turnos.IdTurno
Where ProgramacionMedica.Fecha between  @FechaInicio and  @FechaFin
and ProgramacionMedica.IdMedico = @IdMedico
order by ProgramacionMedica.Fecha,ProgramacionMedica.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[ReporteProgramacionMedicaPorMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteProgramacionMedicaPorMedicoyEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ReporteProgramacionMedicaPorMedicoyEspecialidad]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@IdMedico [int],
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select ProgramacionMedica.IdMedico, ProgramacionMedica.Fecha, ProgramacionMedica.HoraInicio,
            ProgramacionMedica.HoraFin , ProgramacionMedica.IdTurno, Turnos.Codigo as CodigoTurno
From ProgramacionMedica  left join Turnos on ProgramacionMedica.IdTurno = Turnos.IdTurno
Where  ProgramacionMedica.Fecha between  @FechaInicio and  @FechaFin
and ProgramacionMedica.IdMedico = @IdMedico
and ProgramacionMedica.IdEspecialidad =@IdEspecialidad
order by ProgramacionMedica.Fecha,ProgramacionMedica.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[ReporteProgramacionMedicaPorMedicoyEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ReporteSeleccionaTodoContenido]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ReporteSeleccionaTodoContenido]
	@NombreTabla [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @sql nvarchar(1000);

SET @sql = 'SELECT * FROM ' + @NombreTabla

EXEC (@sql)
GO
ALTER AUTHORIZATION ON [dbo].[ReporteSeleccionaTodoContenido] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepPreparaConsultaTablasReportesCabecera]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepPreparaConsultaTablasReportesCabecera]
WITH EXECUTE AS CALLER
AS
select * from reporte_cabecera
GO
ALTER AUTHORIZATION ON [dbo].[RepPreparaConsultaTablasReportesCabecera] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepPreparaConsultaTablasReportesDetalle]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepPreparaConsultaTablasReportesDetalle]
WITH EXECUTE AS CALLER
AS
select * from reporte_detalle
GO
ALTER AUTHORIZATION ON [dbo].[RepPreparaConsultaTablasReportesDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RepPreparaEliminaTablasReportes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RepPreparaEliminaTablasReportes]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION
Delete from reporte_cabecera
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
Delete from reporte_detalle
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END
GO
ALTER AUTHORIZATION ON [dbo].[RepPreparaEliminaTablasReportes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaFechaServidorSQL]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaFechaServidorSQL]
WITH EXECUTE AS CALLER
AS
select  getdate() as FechaHoraSQL
GO
ALTER AUTHORIZATION ON [dbo].[RetornaFechaServidorSQL] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaHoraServidorSQLserverFormatoGalenhos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaHoraServidorSQLserverFormatoGalenhos]
WITH EXECUTE AS CALLER
AS
select left(convert(varchar(10), GETDATE(), 108),5) as HoraSQLFormatoGalenhos
GO
ALTER AUTHORIZATION ON [dbo].[RetornaHoraServidorSQLserverFormatoGalenhos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaNombreDeServidor]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaNombreDeServidor]
WITH EXECUTE AS CALLER
AS
SELECT @@SERVERNAME as Nombre
GO
ALTER AUTHORIZATION ON [dbo].[RetornaNombreDeServidor] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaOpcionesReporteQueTieneAcceso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaOpcionesReporteQueTieneAcceso]
	@lnIdUsuario [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.UsuariosRoles.IdRol, dbo.UsuariosRoles.IdEmpleado, dbo.ListBarReporte.idReporte, dbo.ListBarReporte.Reporte,
                        dbo.ListBarReporte.id_MenuReporte , dbo.ListBarReporte.MODULO
                FROM         dbo.ListBarReporte RIGHT OUTER JOIN
                   dbo.RolesReportes ON dbo.ListBarReporte.idReporte = dbo.RolesReportes.IdReporte RIGHT OUTER JOIN
                   dbo.UsuariosRoles ON dbo.RolesReportes.idRol = dbo.UsuariosRoles.IdRol
               WHERE dbo.RolesReportes.TieneAcceso=1 and dbo.UsuariosRoles.IdEmpleado=@lnIdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[RetornaOpcionesReporteQueTieneAcceso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaTotalConsumoFarmaciaParaPagantePorNroCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaTotalConsumoFarmaciaParaPagantePorNroCuenta]
	@NroCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre AS NombreProducto,
                                  dbo.FacturacionBienesPagos.CantidadPagar AS cantidad, dbo.FacturacionBienesPagos.PrecioVenta AS PrecioUnitario,
                                  dbo.FacturacionBienesPagos.TotalPagar AS TotalPorPagar, dbo.FactOrdenesBienes.idOrden, dbo.FactOrdenesBienes.idComprobantePago,
                                  dbo.FacturacionBienesPagos.IdProducto, dbo.FactOrdenesBienes.idOrden AS IdFacturacionProducto,
                                  dbo.FactOrdenesBienes.idEstadoFacturacion, dbo.FactOrdenesBienes.idPuntoCarga, dbo.FactOrdenesBienes.MovNumero,
                                  dbo.FactOrdenesBienes.MovTipo , dbo.FactOrdenesBienes.ImporteExonerado, dbo.FactOrdenesBienes.IdOrden
             FROM           dbo.FacturacionBienesPagos LEFT OUTER JOIN
                                  dbo.FactOrdenesBienes ON dbo.FacturacionBienesPagos.IdOrden = dbo.FactOrdenesBienes.idOrden LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.FacturacionBienesPagos.IdProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             where           dbo.FactOrdenesBienes.idEstadoFacturacion<>9 and  dbo.FactOrdenesBienes.idCuentaAtencion=@NroCuenta
             order by        dbo.FactOrdenesBienes.idOrden
GO
ALTER AUTHORIZATION ON [dbo].[RetornaTotalConsumoFarmaciaParaPagantePorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaTotalConsumoServiciosParaPagantePorNroCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaTotalConsumoServiciosParaPagantePorNroCuenta]
	@NroCuenta [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre AS NombreProducto, dbo.FacturacionServicioPagos.Cantidad,
                                  dbo.FacturacionServicioPagos.Precio AS PrecioUnitario, dbo.FacturacionServicioPagos.Total AS TotalPorPagar,
                                  dbo.FactOrdenServicioPagos.idOrdenPago AS idFacturacionProducto, dbo.FactOrdenServicio.IdCuentaAtencion,
                                  dbo.FactOrdenServicioPagos.idComprobantePago, dbo.FacturacionServicioPagos.idProducto, dbo.FactOrdenServicio.idTipoFinanciamiento,
                                  dbo.FactOrdenServicioPagos.IdEstadoFacturacion, dbo.FactOrdenServicio.IdPuntoCarga,dbo.FactOrdenServicioPagos.idOrdenPago ,
                    dbo.FactOrdenServicioPagos.ImporteExonerado,dbo.FactOrdenServicio.idEstadoFacturacion as EstadoFacOrdenServicio
             FROM         dbo.FactOrdenServicio RIGHT OUTER JOIN
                                  dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden RIGHT OUTER JOIN
                                  dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago LEFT OUTER JOIN
                                  dbo.FactCatalogoServicios ON dbo.FacturacionServicioPagos.idProducto = dbo.FactCatalogoServicios.IdProducto
             WHERE dbo.FactOrdenServicioPagos.IdEstadoFacturacion<>9 and dbo.FactOrdenServicio.idCuentaAtencion=@NroCuenta
             ORDER BY dbo.FactOrdenServicioPagos.idOrdenPago
GO
ALTER AUTHORIZATION ON [dbo].[RetornaTotalConsumoServiciosParaPagantePorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RetornaVersionDeServidor]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RetornaVersionDeServidor]
WITH EXECUTE AS CALLER
AS
SELECT @@Version as VersionServidor
GO
ALTER AUTHORIZATION ON [dbo].[RetornaVersionDeServidor] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesAgregar]
	@Nombre [varchar](50),
	@IdRol [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Roles (
Nombre) values (
@Nombre)
set @IdRol = @@Identity

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdRol,'Roles'
GO
ALTER AUTHORIZATION ON [dbo].[RolesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesEliminaHospEmergDelADMINISTRADOR]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesEliminaHospEmergDelADMINISTRADOR]
WITH EXECUTE AS CALLER
AS
delete from RolesReportes where idRol=1 and idReporte in
          (select idReporte from listBarReporte where modulo='HOSPITALIZACION' or modulo='EMERGENCIA' )
GO
ALTER AUTHORIZATION ON [dbo].[RolesEliminaHospEmergDelADMINISTRADOR] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesEliminar]
	@IdRol [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Roles
where IdRol = @IdRol
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdRol,'Roles'
GO
ALTER AUTHORIZATION ON [dbo].[RolesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesItemsAgregar]
	@Consultar [bit],
	@Eliminar [bit],
	@Modificar [bit],
	@Agregar [bit],
	@IdRol [int],
	@IdListItem [int],
	@IdRolItem [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into RolesItems (
Consultar,Eliminar,Modificar,Agregar,IdRol,IdListItem) values (
@Consultar,@Eliminar,@Modificar,@Agregar,@IdRol,@IdListItem)
set @IdRolItem = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemSeleccionarPermisosPorIdEmpleadoYIdListItem]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesItemSeleccionarPermisosPorIdEmpleadoYIdListItem]
	@IdEmpleado [int],
	@IdListItem [int]
WITH EXECUTE AS CALLER
AS
select
sum(cast(RolesItems.Agregar as int)) as Agregar,
sum(cast(RolesItems.Modificar as int)) as Modificar,
sum(cast(RolesItems.Eliminar as int)) as Eliminar,
sum(cast(RolesItems.Consultar as int)) as Consultar
from (Empleados
inner join UsuariosRoles on Empleados.IdEmpleado = UsuariosRoles.IdEmpleado)
inner join RolesItems on UsuariosRoles.IdRol = RolesItems.IdRol
where Empleados.IdEmpleado = @IdEmpleado
and RolesItems.IdListItem = @IdListItem
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemSeleccionarPermisosPorIdEmpleadoYIdListItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesItemsEliminar]
	@IdRolItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from RolesItems
where IdRolItem = @IdRolItem
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsEliminarXidRol]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesItemsEliminarXidRol]
	@lIdRol [int]
WITH EXECUTE AS CALLER
AS
delete from RolesItems where IdRol = @lIdRol
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsEliminarXidRol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesItemsModificar]
	@Consultar [bit],
	@Eliminar [bit],
	@Modificar [bit],
	@Agregar [bit],
	@IdRol [int],
	@IdListItem [int],
	@IdRolItem [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update RolesItems
set
Consultar = @Consultar,
Eliminar = @Eliminar,
Modificar = @Modificar,
Agregar = @Agregar,
IdRol = @IdRol,
IdListItem = @IdListItem
where IdRolItem = @IdRolItem
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsSeleccionarGruposPorUsuario]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesItemsSeleccionarGruposPorUsuario]
	@lIdUsuario [int]
WITH EXECUTE AS CALLER
AS
select distinct ListBarGrupos.IdListGrupo, ListBarGrupos.Clave
                 , ListBarGrupos.Texto , ListBarGrupos.Indice
             From
                 (((Empleados
                 left join UsuariosRoles on Empleados.IdEmpleado = UsuariosRoles.IdEmpleado)
                 left join RolesItems on UsuariosRoles.IdRol = RolesItems.IdRol)
                 left join ListBarItems on RolesItems.IdListItem = ListBarItems.IdListItem)
                 left join ListBarGrupos on ListBarGrupos.IdListGrupo = ListBarItems.IdListGrupo
             where Empleados.IdEmpleado = @lIdUsuario
             order by ListBarGrupos.Indice asc
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsSeleccionarGruposPorUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsSeleccionarItemsPorUsuarioYGrupo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesItemsSeleccionarItemsPorUsuarioYGrupo]
	@lIdGrupo [int],
	@lIdUsuario [int]
WITH EXECUTE AS CALLER
AS
if @lIdGrupo=0
      select distinct ListBarItems.IdListItem, ListBarItems.Clave,
                ListbarItems.Texto , ListbarItems.Indice, ListbarItems.KeyIcon,ListBarItems.IdListGrupo
             From
                (((Empleados
                left join UsuariosRoles on Empleados.IdEmpleado = UsuariosRoles.IdEmpleado)
                left join RolesItems on UsuariosRoles.IdRol = RolesItems.IdRol)
                left join ListBarItems on RolesItems.IdListItem = ListBarItems.IdListItem)
                left join ListBarGrupos on ListBarGrupos.IdListGrupo = ListBarItems.IdListGrupo
             where Empleados.IdEmpleado = @lIdUsuario
              order by ListBarItems.indice
else
      select distinct ListBarItems.IdListItem, ListBarItems.Clave,
                ListbarItems.Texto , ListbarItems.Indice, ListbarItems.KeyIcon,ListBarItems.IdListGrupo
             From
                (((Empleados
                left join UsuariosRoles on Empleados.IdEmpleado = UsuariosRoles.IdEmpleado)
                left join RolesItems on UsuariosRoles.IdRol = RolesItems.IdRol)
                left join ListBarItems on RolesItems.IdListItem = ListBarItems.IdListItem)
                left join ListBarGrupos on ListBarGrupos.IdListGrupo = ListBarItems.IdListGrupo
             where Empleados.IdEmpleado = @lIdUsuario
             and ListBarItems.IdListGrupo = @lIdGrupo
             order by ListBarItems.indice
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsSeleccionarItemsPorUsuarioYGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesItemsSeleccionarPorId]
	@IdRolItem [int]
WITH EXECUTE AS CALLER
AS
select * from RolesItems
where IdRolItem = @IdRolItem
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesItemsSeleccionarPorRol]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesItemsSeleccionarPorRol]
	@IdRol [int]
WITH EXECUTE AS CALLER
AS
select ListbarItems.IdListItem, ListbarItems.Texto SubModulo, ListbarGrupos.Texto Modulo,
RolesItems.Agregar, RolesItems.Modificar, RolesItems.Consultar, RolesItems.Eliminar
from (RolesItems
left join ListbarItems on RolesItems.IdListItem = ListbarItems.IdListItem)
left join ListbarGrupos on ListbarItems.IdListGrupo = ListbarGrupos.IdListGrupo
where RolesItems.IdRol = @IdRol
order by ListbarGrupos.Texto, ListbarItems.Texto
GO
ALTER AUTHORIZATION ON [dbo].[RolesItemsSeleccionarPorRol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesModificar]
	@Nombre [varchar](50),
	@IdRol [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Roles
set
Nombre = @Nombre
where IdRol = @IdRol

--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdRol,'Roles'
GO
ALTER AUTHORIZATION ON [dbo].[RolesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesPermisosAgregar]
	@IdRol [int],
	@IdPermiso [int],
	@IdRolPermiso [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into RolesPermisos (
IdRol,IdPermiso) values (
@IdRol,@IdPermiso)
set @IdRolPermiso = @@identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdRolPermiso,'RolesPermisos'
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesPermisosEliminar]
	@IdRolPermiso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from RolesPermisos
where IdRolPermiso = @IdRolPermiso
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdRolPermiso,'RolesPermisos'
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosEliminarPorIdRol]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesPermisosEliminarPorIdRol]
	@lIdRol [int]
WITH EXECUTE AS CALLER
AS
delete from RolesPermisos where IdRol = @lIdRol
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosEliminarPorIdRol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesPermisosModificar]
	@IdRol [int],
	@IdPermiso [int],
	@IdRolPermiso [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update RolesPermisos
set
IdRol = @IdRol,
IdPermiso = @IdPermiso
where IdRolPermiso = @IdRolPermiso
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdRolPermiso,'RolesPermisos'
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesPermisosSeleccionarPorId]
	@IdRolPermiso [int]
WITH EXECUTE AS CALLER
AS
select * from RolesPermisos
where IdRolPermiso = @IdRolPermiso
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosSeleccionarPorRol]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesPermisosSeleccionarPorRol]
	@IdRol [int]
WITH EXECUTE AS CALLER
AS
select Permisos.IdPermiso,Permisos.Descripcion from RolesPermisos
left join Permisos on RolesPermisos.IdPermiso  = Permisos.IdPermiso
where RolesPermisos.IdRol = @IdRol
order by Permisos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosSeleccionarPorRol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesPermisosXidEmpleado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesPermisosXidEmpleado]
	@lIdEmpleado [int]
WITH EXECUTE AS CALLER
AS
sELECT DISTINCT dbo.RolesPermisos.IdPermiso, dbo.Permisos.Descripcion, dbo.Permisos.Modulo
             FROM         dbo.Empleados LEFT OUTER JOIN
                                  dbo.UsuariosRoles ON dbo.Empleados.IdEmpleado = dbo.UsuariosRoles.IdEmpleado LEFT OUTER JOIN
                                  dbo.Roles ON dbo.UsuariosRoles.IdRol = dbo.Roles.IdRol LEFT OUTER JOIN
                                  dbo.RolesPermisos ON dbo.Roles.IdRol = dbo.RolesPermisos.IdRol LEFT OUTER JOIN
                                  dbo.Permisos ON dbo.RolesPermisos.IdPermiso = dbo.Permisos.IdPermiso
             WHERE     dbo.Empleados.IdEmpleado = @lIdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[RolesPermisosXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesReportesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesReportesAgregar]
	@idRol [int],
	@idReporte [int],
	@tieneAcceso [bit]
WITH EXECUTE AS CALLER
AS
insert into RolesReportes (idRol,idReporte,tieneAcceso) values (
@idRol,@idReporte,@tieneAcceso)
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesReportesConsultar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesReportesConsultar]
WITH EXECUTE AS CALLER
AS
select * from RolesReportes
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportesConsultar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesReportesEliminarConsultar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesReportesEliminarConsultar]
	@IdRol [int]
WITH EXECUTE AS CALLER
AS
delete from RolesReportes where idrol=@IdRol
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportesEliminarConsultar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesReportesRolesPermisosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesReportesRolesPermisosEliminar]
	@IdRol [int]
WITH EXECUTE AS CALLER
AS
BEGIN TRANSACTION

delete from RolesReportes where idrol=@IdRol
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

delete from RolesPermisos where idrol=@IdRol
IF @@ERROR <> 0
	BEGIN
		ROLLBACK
		RETURN
	END

COMMIT
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportesRolesPermisosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesReportesSeleccionarXrol]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesReportesSeleccionarXrol]
	@lnIdRol [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.RolesReportes.idRol, dbo.RolesReportes.IdReporte, dbo.ListBarReporte.Reporte, dbo.ListBarReporte.MODULO,
                      dbo.ListBarReporte.id_MenuReporte, dbo.RolesReportes.tieneAcceso
             FROM         dbo.RolesReportes LEFT OUTER JOIN
                      dbo.ListBarReporte ON dbo.RolesReportes.IdReporte = dbo.ListBarReporte.idReporte
             WHERE    dbo.RolesReportes.TieneAcceso=1 and dbo.RolesReportes.idRol=@lnIdRol
             ORDER BY dbo.ListBarReporte.MODULO,dbo.ListBarReporte.Reporte
GO
ALTER AUTHORIZATION ON [dbo].[RolesReportesSeleccionarXrol] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[RolesSeleccionarPorId]
	@IdRol [int]
WITH EXECUTE AS CALLER
AS
select * from Roles
where IdRol = @IdRol
GO
ALTER AUTHORIZATION ON [dbo].[RolesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from Roles order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[RolesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[RolesSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[RolesSeleccionarXidentificador]
	@lIdRol [int]
WITH EXECUTE AS CALLER
AS
select * from Roles where idRol=@lIdRol
GO
ALTER AUTHORIZATION ON [dbo].[RolesSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SacarGruposLaboratorio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SacarGruposLaboratorio]
WITH EXECUTE AS CALLER
AS
SELECT idGrupo, rTRIM(NombreGrupo) + ' (' + rTRIM(siglasGrupo) + ')' AS Nombre
FROM labGrupos
ORDER BY Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SacarGruposLaboratorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SacarPruebasPorGrupo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SacarPruebasPorGrupo]
	@Grupo [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT labPruebas.codigoCPT, factCatalogoServicios.NombreMINSA as Nombre, factCatalogoServicios.IdProducto
FROM labPruebas, factCatalogoServicios
WHERE left(labPruebas.CodigoPrueba,3)=@Grupo AND labpruebas.codigoCPT=factcatalogoservicios.codigo ORDER BY factcatalogoservicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SacarPruebasPorGrupo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SacarPruebasTodas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SacarPruebasTodas]
WITH EXECUTE AS CALLER
AS
SELECT labPruebas.codigoCPT, factCatalogoServicios.NombreMINSA as Nombre, factCatalogoServicios.IdProducto
FROM labPruebas, factCatalogoServicios WHERE labpruebas.codigoCPT=factcatalogoservicios.codigo ORDER BY factcatalogoservicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SacarPruebasTodas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldoDetalladoPorItemSeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SaldoDetalladoPorItemSeleccionarPorCodigo]
	@lcCodigoItem [varchar](50)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmAlmacen.descripcion as Almacen, dbo.farmSaldo.cantidad, dbo.farmSaldo.Precio as PrecPond, dbo.farmSaldo.cantidad * dbo.farmSaldo.Precio AS Importe,
                                       dbo.FactCatalogoBienesInsumos.Codigo
                 FROM           dbo.farmSaldo LEFT OUTER JOIN
                                       dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto LEFT OUTER JOIN
                                       dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen
                 WHERE not   (dbo.farmAlmacen.codigoSismed is null) and  dbo.FactCatalogoBienesInsumos.Codigo=@lcCodigoItem
                            and dbo.farmAlmacen.idEstado =1
                 ORDER BY dbo.farmAlmacen.descripcion
GO
ALTER AUTHORIZATION ON [dbo].[SaldoDetalladoPorItemSeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldoEliminarTodosSegunFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SaldoEliminarTodosSegunFiltro]
	@Where [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL = 'BEGIN TRANSACTION
			delete from FarmSaldoDetallado ' + @Where + '
				IF @@ERROR <> 0
					BEGIN
						ROLLBACK
						RETURN
					END

			delete from FarmSaldo ' + @Where + '
			IF @@ERROR <> 0
				BEGIN
					ROLLBACK
					RETURN
				END
		COMMIT'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[SaldoEliminarTodosSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldoMensualEliminarTodosSegunFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SaldoMensualEliminarTodosSegunFiltro]
	@Where [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

SET @SQL = 'BEGIN TRANSACTION
		delete from FarmSaldoMensual ' + @Where + '
				IF @@ERROR <> 0
					BEGIN
						ROLLBACK
						RETURN
					END

			delete from FarmSaldoMensualDetallado ' + @Where + '
			IF @@ERROR <> 0
				BEGIN
					ROLLBACK
					RETURN
				END
		COMMIT'

EXEC(@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[SaldoMensualEliminarTodosSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldosNegativos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SaldosNegativos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.farmSaldo.idAlmacen, dbo.farmSaldo.idProducto, dbo.farmSaldo.cantidad, dbo.FactCatalogoBienesInsumos.Codigo,
                                dbo.FactCatalogoBienesInsumos.Nombre , dbo.farmAlmacen.descripcion
             FROM         dbo.farmSaldo LEFT OUTER JOIN
                                dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
            Where (dbo.farmSaldo.cantidad < 0 and dbo.farmAlmacen.idEstado=1)
GO
ALTER AUTHORIZATION ON [dbo].[SaldosNegativos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldosSegunOrden]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SaldosSegunOrden]
	@lnOrdenadoPor [int]
WITH EXECUTE AS CALLER
AS
If @lnOrdenadoPor = 0
        SELECT     0  AS idAlmacen, farmSaldo.idProducto, AVG(farmSaldo.Precio) AS Precio, FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre,FactCatalogoBienesInsumos.TipoProducto,
                                          SUM(farmSaldo.cantidad) AS Cantidad, 0 AS stockMinimo,'' as lote,
                                          '' as fechaVencimiento,0 as cantidadLote
                     FROM           farmSaldo LEFT OUTER JOIN
                                          farmAlmacen ON farmSaldo.idAlmacen = farmAlmacen.idAlmacen LEFT OUTER JOIN
                                          FactCatalogoBienesInsumos ON farmSaldo.idProducto = FactCatalogoBienesInsumos.IdProducto
                     Where (Not (farmAlmacen.CodigoSismed Is Null))
                     GROUP BY farmSaldo.idProducto, FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre,FactCatalogoBienesInsumos.TipoProducto
                     ORDER BY dbo.FactCatalogoBienesInsumos.Codigo
    Else
        SELECT     0 AS idAlmacen, farmSaldo.idProducto, AVG(farmSaldo.Precio) AS Precio, FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre,FactCatalogoBienesInsumos.TipoProducto,
                                          SUM(farmSaldo.cantidad) AS Cantidad, 0 AS stockMinimo,'' as lote,
                                          '' as fechaVencimiento,0 as cantidadLote
                     FROM           farmSaldo LEFT OUTER JOIN
                                          farmAlmacen ON farmSaldo.idAlmacen = farmAlmacen.idAlmacen LEFT OUTER JOIN
                                          FactCatalogoBienesInsumos ON farmSaldo.idProducto = FactCatalogoBienesInsumos.IdProducto
                     Where (Not (farmAlmacen.CodigoSismed Is Null))
                     GROUP BY farmSaldo.idProducto, FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre,FactCatalogoBienesInsumos.TipoProducto
                     ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SaldosSegunOrden] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldoTotalDelEstablecimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SaldoTotalDelEstablecimiento]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, SUM(dbo.farmSaldo.cantidad)
                                  AS SaldoTotal
             FROM           dbo.farmSaldo LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             WHERE  not   (dbo.farmAlmacen.codigoSismed is null) and dbo.farmAlmacen.idEstado =1
             GROUP BY dbo.farmSaldo.idProducto, dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre
             ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SaldoTotalDelEstablecimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SaldoTotalPorAlmacen]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SaldoTotalPorAlmacen]
	@idAlmacen [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmSaldo.cantidad
                                  AS SaldoTotal,dbo.farmsaldo.idAlmacen, dbo.farmsaldo.idProducto
             FROM           dbo.farmSaldo LEFT OUTER JOIN
                                  dbo.farmAlmacen ON dbo.farmSaldo.idAlmacen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                                  dbo.FactCatalogoBienesInsumos ON dbo.farmSaldo.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
             WHERE  dbo.farmSaldo.idAlmacen=@idAlmacen
             ORDER BY dbo.FactCatalogoBienesInsumos.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[SaldoTotalPorAlmacen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaInsumos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaInsumos]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@idFarmacia [int],
	@idVendedor [int],
	@soloCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

	SET @VarSql = 'SELECT  Nombre, SUM(CantidadPagar) AS Cantidad, SUM(TotalPagar) AS Total,codigo
			FROM	(
				SELECT DISTINCT 	nroserie,nrodocumento,FactCatalogoBienesInsumos.Nombre,  FacturacionBienesPagos.CantidadPagar,
				          FacturacionBienesPagos.TotalPagar,FactCatalogoBienesInsumos.codigo
				FROM	CajaComprobantesPago INNER JOIN
						FactOrdenesBienes ON CajaComprobantesPago.IdComprobantePago = FactOrdenesBienes.idComprobantePago INNER JOIN
						FacturacionBienesPagos ON FactOrdenesBienes.idOrden = FacturacionBienesPagos.IdOrden INNER JOIN
						FactCatalogoBienesInsumos ON FacturacionBienesPagos.IdProducto = FactCatalogoBienesInsumos.IdProducto '


	IF @IdFarmacia <> 0 or @idVendedor<>0
	BEGIN
		SET @VarSql = @VarSql + ' INNER JOIN FarmPreVenta ON FactOrdenesBienes.idPreventa = farmPreVenta.idPreventa '
	END

	SET @VarSql = @VarSql  + ' WHERE (CajaComprobantesPago.IdTipoOrden = 2 OR CajaComprobantesPago.IdTipoOrden = 3) AND
						(CajaComprobantesPago.FechaCobranza >= @FechaCobranzaInicial) AND (CajaComprobantesPago.FechaCobranza <= @FechaCobranzaFinal) '

	-- ===================================================================
	-- Parametros
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END
	IF @idFarmacia <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idAlmacen = ' + CONVERT(VARCHAR(10), @idFarmacia)
	END
	IF @idVendedor <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idVendedor = ' + CONVERT(VARCHAR(10), @idVendedor)
	END
	-- ===================================================================
	SET @VarSql = @VarSql  + ' ) DERIVEDTBL GROUP BY Nombre,codigo';
	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	--print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaInsumos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaInsumosRedondeo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaInsumosRedondeo]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@idFarmacia [int],
	@idVendedor [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

SET @VarSql = 'select sum(Total)as totalDocto,sum(TotalItem)as totalItem,(sum(Total)-sum(TotalItem))as redondeo
		from(
			select Total,nroserie,nroDocumento,sum(TotalPagar)as TotalItem
			from(
				SELECT	CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento, CajaComprobantesPago.Total,
							CajaComprobantesPago.FechaCobranza, FacturacionBienesPagos.TotalPagar
				FROM	CajaComprobantesPago INNER JOIN
						FactOrdenesBienes ON CajaComprobantesPago.IdComprobantePago = FactOrdenesBienes.idComprobantePago INNER JOIN
					FacturacionBienesPagos ON FactOrdenesBienes.idOrden = FacturacionBienesPagos.IdOrden  '

	IF @IdFarmacia <> 0 or @idVendedor<>0
	BEGIN
		SET @VarSql = @VarSql + ' INNER JOIN FarmPreVenta ON FactOrdenesBienes.idPreventa = farmPreVenta.idPreventa '
	END

SET @VarSql = @VarSql  + ' WHERE 	(CajaComprobantespago.IdEstadoComprobante=4) AND
					(CajaComprobantesPago.IdTipoOrden = 2 OR CajaComprobantesPago.IdTipoOrden = 3) AND
					(CajaComprobantesPago.FechaCobranza >= @FechaCobranzaInicial) AND (CajaComprobantesPago.FechaCobranza <= @FechaCobranzaFinal) '

-- ===================================================================
	-- Parametros
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END
	IF @idFarmacia <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idAlmacen = ' + CONVERT(VARCHAR(10), @idFarmacia)
	END
	IF @idVendedor <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idVendedor = ' + CONVERT(VARCHAR(10), @idVendedor)
	END
	-- ===================================================================

	SET @VarSql = @VarSql  + ' 	)derivebtbl group by Total, nroserie, nroDocumento
					)deribedtbl '

	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	--print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaInsumosRedondeo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaInsumosRedondeoAnulados]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaInsumosRedondeoAnulados]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@idFarmacia [int],
	@idVendedor [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

SET @VarSql = 'select sum(Total)as total,sum(TotalPagar)as totalpagar
		from(
			select Total,nroserie,nroDocumento,sum(TotalPagar)as TotalPagar
			from(
				SELECT	CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento, CajaComprobantesPago.Total,
							CajaComprobantesPago.FechaCobranza, FacturacionBienesPagos.TotalPagar
				FROM	CajaComprobantesPago INNER JOIN
						FactOrdenesBienes ON CajaComprobantesPago.IdComprobantePago = FactOrdenesBienes.idComprobantePago INNER JOIN
					FacturacionBienesPagos ON FactOrdenesBienes.idOrden = FacturacionBienesPagos.IdOrden '

	IF @IdFarmacia <> 0 or @idVendedor<>0
	BEGIN
		SET @VarSql = @VarSql + ' INNER JOIN FarmPreVenta ON FactOrdenesBienes.idPreventa = farmPreVenta.idPreventa '
	END

SET @VarSql = @VarSql  + ' WHERE 	(CajaComprobantespago.IdEstadoComprobante=9) AND
					(CajaComprobantesPago.IdTipoOrden = 2 OR CajaComprobantesPago.IdTipoOrden = 3) AND
					(CajaComprobantesPago.FechaCobranza >= @FechaCobranzaInicial) AND (CajaComprobantesPago.FechaCobranza <= @FechaCobranzaFinal) '

-- ===================================================================
	-- Parametros
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END
	IF @idFarmacia <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idAlmacen = ' + CONVERT(VARCHAR(10), @idFarmacia)
	END
	IF @idVendedor <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idVendedor = ' + CONVERT(VARCHAR(10), @idVendedor)
	END
	-- ===================================================================

	SET @VarSql = @VarSql  + ' )derivebtbl group by Total, nroserie, nroDocumento
		)deribedtbl';
	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	--print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaInsumosRedondeoAnulados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaInsumosTotales]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaInsumosTotales]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@idFarmacia [int],
	@idVendedor [int],
	@SoloCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
DECLARE @ParmDefinition NVARCHAR(500)

	SET @VarSql = ' SELECT SUM(SubTotal) AS SubTotal, SUM(IGV) AS IGV, SUM(Total) AS Total, SUM(Dctos) AS Dsctos,
			SUM(Exoneraciones) AS Exoneraciones, SUM(Adelantos)  AS Adelantos, SUM(Pagado) AS Pagado, SUM(Anulado) AS Anulado, SUM(Devolucion) AS Devolucion
			FROM	(
				SELECT DISTINCT 	nroserie,nrodocumento,SubTotal, IGV, CajaComprobantesPago.Total, Dctos, Exoneraciones, Adelantos, idEstadoComprobante,
						(CASE WHEN idEstadoComprobante = 4 THEN CajaComprobantesPago.Total ELSE 0 END) AS Pagado,
						(CASE WHEN idEstadoComprobante = 9 THEN CajaComprobantesPago.Total ELSE 0 END) AS Anulado,
						(CASE WHEN idEstadoComprobante = 6 THEN CajaComprobantesPago.Total ELSE 0 END) AS Devolucion
				FROM	CajaComprobantesPago INNER JOIN
						FactOrdenesBienes ON CajaComprobantesPago.IdComprobantePago = FactOrdenesBienes.idComprobantePago INNER JOIN
						FacturacionBienesPagos ON FactOrdenesBienes.idOrden = FacturacionBienesPagos.IdOrden INNER JOIN
						FactCatalogoBienesInsumos ON FacturacionBienesPagos.IdProducto = FactCatalogoBienesInsumos.IdProducto  '
	IF @IdFarmacia <> 0 or @idVendedor<>0
	BEGIN
		SET @VarSql = @VarSql + ' INNER JOIN FarmPreVenta ON FactOrdenesBienes.idPreventa = farmPreVenta.idPreventa '
	END

	SET @VarSql = @VarSql  + ' WHERE (CajaComprobantesPago.IdTipoOrden = 2 OR CajaComprobantesPago.IdTipoOrden = 3) AND
						(CajaComprobantesPago.FechaCobranza >= @FechaCobranzaInicial) AND (CajaComprobantesPago.FechaCobranza <= @FechaCobranzaFinal) '

-- ===================================================================
-- Parametros
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END

	if @SoloCredito='C'
	   SET @VarSql = @VarSql + ' AND not ( CajaComprobantesPago.tieneCredito is null)'
	else
           SET @VarSql = @VarSql + ' AND CajaComprobantesPago.tieneCredito is null'

	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END
	IF @idFarmacia <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idAlmacen = ' + CONVERT(VARCHAR(10), @idFarmacia)
	END
	IF @idVendedor <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND farmPreVenta.idVendedor = ' + CONVERT(VARCHAR(10), @idVendedor)
	END
-- ===================================================================
	SET @VarSql = @VarSql  + ' ) DERIVEDTBL';
	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	--print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaInsumosTotales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaServicios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaServicios]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@SoloCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

	SET @VarSql = 'SELECT     Nombre,  SUM(Cantidad) AS Cantidad, SUM(Total) AS Total,codigo
			FROM	(SELECT     	CajaComprobantesPago.IdTipoOrden, CajaComprobantesPago.idTurno, CajaComprobantesPago.idCaja, CajaComprobantesPago.IdCajero,
							CajaComprobantesPago.FechaCobranza, FacturacionServicioPagos.Cantidad, FacturacionServicioPagos.Precio,
							FacturacionServicioPagos.Total, FactCatalogoServicios.Nombre, FactCatalogoServicios.codigo
					FROM	CajaComprobantesPago INNER JOIN
							FactOrdenServicioPagos ON CajaComprobantesPago.IdComprobantePago = FactOrdenServicioPagos.idComprobantePago INNER JOIN
							FacturacionServicioPagos ON FactOrdenServicioPagos.idOrdenPago = FacturacionServicioPagos.idOrdenPago INNER JOIN
							FactCatalogoServicios ON FacturacionServicioPagos.idProducto = FactCatalogoServicios.IdProducto'

	SET @VarSql = @VarSql + '  WHERE	(CajaComprobantesPago.IdTipoOrden = 1)
						and (CajaComprobantesPago.FechaCobranza>=@FechaCobranzaInicial ) and (CajaComprobantesPago.FechaCobranza<=@FechaCobranzaFinal)'
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END

	if @SoloCredito='C'
	   SET @VarSql = @VarSql + ' AND not (CajaComprobantesPago.tieneCredito is null)'
	else
           SET @VarSql = @VarSql + ' AND CajaComprobantesPago.tieneCredito is null'

	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END

	SET @VarSql = @VarSql  + '  )DERIVEDTBL GROUP BY Nombre,codigo'

	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	-- print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaServicios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaServiciosRedondeo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaServiciosRedondeo]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

SET @VarSql ='	SELECT sum(TotalItem)AS TotalItem,sum(TotalDocto) AS TotalDocto, (sum(TotalItem)-sum(TotalDocto))AS Redondeo
		FROM (
			SELECT TotalDocto,nroserie,nroDocumento,sum(TotalItem) as TotalItem
			FROM (
				SELECT	CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento, CajaComprobantesPago.Total as TotalDocto,
							CajaComprobantesPago.FechaCobranza, FacturacionServicioPagos.Total as TotalItem
				FROM	CajaComprobantesPago INNER JOIN
						FactOrdenServicioPagos ON CajaComprobantesPago.IdComprobantePago = FactOrdenServicioPagos.idComprobantePago INNER JOIN
					FacturacionServicioPagos ON FactOrdenServicioPagos.idOrdenPago = FacturacionServicioPagos.IdOrdenPago '

SET @VarSql = @VarSql  + ' WHERE 	'--(CajaComprobantespago.IdEstadoComprobante=4) AND
					+'(CajaComprobantesPago.IdTipoOrden =1) AND
					(CajaComprobantesPago.FechaCobranza >= @FechaCobranzaInicial) AND (CajaComprobantesPago.FechaCobranza <= @FechaCobranzaFinal) '

-- ===================================================================
	-- Parametros
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END

	-- ===================================================================

	SET @VarSql = @VarSql  + ' 	)DERIVEBTBL GROUP BY  TotalDocto, nroserie, nroDocumento
				)DERIVEBTBL '
	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	--print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaServiciosRedondeo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaServiciosServiciosHospitalarios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaServiciosServiciosHospitalarios]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
	DECLARE @ParmDefinition NVARCHAR(500)

	SET @VarSql = 'SELECT     SUM(Total) AS ServiciosHospitalarios
			FROM	(SELECT     CajaComprobantesPago.IdComprobantePago, CajaComprobantesPago.Total, CajaComprobantesPago.FechaCobranza
					FROM	FactOrdenServicioPagos INNER JOIN
							CajaComprobantesPago ON FactOrdenServicioPagos.idComprobantePago = CajaComprobantesPago.IdComprobantePago INNER JOIN
							FacturacionServicioPagos ON FactOrdenServicioPagos.idOrdenPago = FacturacionServicioPagos.idOrdenPago '

	SET @VarSql = @VarSql + '  WHERE	(CajaComprobantesPago.IdTipoOrden = 1)  AND
						(FacturacionServicioPagos.idProducto = ' + CONVERT(VARCHAR(10), @IdProducto) + ') AND
						(CajaComprobantespago.idEstadoComprobante<>0) AND
						(CajaComprobantesPago.FechaCobranza>=@FechaCobranzaInicial ) and (CajaComprobantesPago.FechaCobranza<=@FechaCobranzaFinal) '
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END

	SET @VarSql = @VarSql  + '  )DERIVEDTBL '

	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	-- print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaServiciosServiciosHospitalarios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaCierreCajaServiciosTotales]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaCierreCajaServiciosTotales]
	@FechaCobranzaInicial [datetime],
	@FechaCobranzaFinal [datetime],
	@IdCaja [int],
	@IdTurno [int],
	@idCajero [int],
	@idTComprobante [int],
	@SoloCredito [varchar](1)
WITH EXECUTE AS CALLER
AS
DECLARE @VarSql NVARCHAR(4000);
DECLARE @ParmDefinition NVARCHAR(500)

	SET @VarSql =	'SELECT	SUM(SubTotal) AS SubTotal, SUM(IGV) AS IGV, SUM(Total) AS Total, SUM(Dctos) AS Dsctos, SUM(Exoneraciones) AS Exoneraciones,
					SUM(Adelantos)as Adelantos,sum(Pagado) as Pagado,sum(Anulado)as Anulado,sum(Devolucion)as Devolucion
			FROM	(SELECT	SubTotal, IGV, Total, Dctos, Exoneraciones, Adelantos, idEstadoComprobante,
						(CASE WHEN idEstadoComprobante = 4 THEN Total ELSE 0 END) AS Pagado,
						(CASE WHEN idEstadoComprobante = 9 THEN Total ELSE 0 END) AS Anulado,
						(CASE WHEN idEstadoComprobante = 6 THEN Total ELSE 0 END) as Devolucion
				FROM         CajaComprobantesPago
				WHERE      (IdTipoOrden = 1) AND (FechaCobranza >= @FechaCobranzaInicial) AND (FechaCobranza <= @FechaCobranzaFinal)  '
	IF @IdCaja <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idCaja = ' + CONVERT(VARCHAR(10), @IdCaja)
	END
        if @SoloCredito='C'
	   SET @VarSql = @VarSql + ' AND not (CajaComprobantesPago.tieneCredito is null) '
	else
           SET @VarSql = @VarSql + ' AND CajaComprobantesPago.tieneCredito is null'


	IF @idCajero <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.IdCajero = ' + CONVERT(VARCHAR(10), @idCajero)
	END
	IF @IdTurno <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTurno = ' + CONVERT(VARCHAR(10), @IdTurno)
	END
	IF @idTComprobante <> 0
	BEGIN
		SET @VarSql = @VarSql + ' AND CajaComprobantesPago.idTipoComprobante = ' + CONVERT(VARCHAR(10), @idTComprobante)
	END

	SET @VarSql = @VarSql  + ' ) DERIVEDTBL';
	SET @ParmDefinition = '@FechaCobranzaInicial DATETIME, @FechaCobranzaFinal DATETIME'
	-- print @VarSql;
	EXECUTE SP_EXECUTESQL  @VarSql, @ParmDefinition, @FechaCobranzaInicial,  @FechaCobranzaFinal
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaCierreCajaServiciosTotales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDatosCajero]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDatosCajero]
	@IdCajero [int]
WITH EXECUTE AS CALLER
AS
select *
from Empleados
where IdEmpleado =@IdCajero
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDatosCajero] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDatosCajeroConexion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDatosCajeroConexion]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from Empleados where IdEmpleado = @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDatosCajeroConexion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDatosCajeroRpt]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDatosCajeroRpt]
	@lnIdCajero [int]
WITH EXECUTE AS CALLER
AS
select * from Empleados where IdEmpleado =@lnIdCajero
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDatosCajeroRpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDevolucionesPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDevolucionesPorCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimientoNotaIngreso.MovNumero,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.descripcion as dAlmacen,
                      dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFinanciamiento, dbo.Empleados.Usuario,dbo.farmMovimiento.idTipoConcepto,
                       dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.documentoNumero
FROM         dbo.Empleados RIGHT OUTER JOIN
                      dbo.farmAlmacen INNER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino ON
                       dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario LEFT OUTER JOIN
                      dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago ON
                      dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE       dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion AND farmMovimiento.idTipoConcepto=21
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDevolucionesPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDevolucionesPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDevolucionesPorCuentaYFecha]
	@idCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimientoNotaIngreso.MovNumero,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.descripcion as dAlmacen,
                      dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFinanciamiento, dbo.Empleados.Usuario,dbo.farmMovimiento.idTipoConcepto,
                       dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.documentoNumero
FROM         dbo.Empleados RIGHT OUTER JOIN
                      dbo.farmAlmacen INNER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino ON
                       dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario LEFT OUTER JOIN
                      dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago ON
                      dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE       dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion  AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal  AND farmMovimiento.idTipoConcepto=21
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDevolucionesPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDevolucionesPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDevolucionesPorCuentaYServicio]
	@idCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimientoNotaIngreso.MovNumero,
                     dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoDetalle.Cantidad,
                     dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.descripcion as dAlmacen,
                     dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFinanciamiento, dbo.Empleados.Usuario,dbo.farmMovimiento.idTipoConcepto,
                      dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.documentoNumero
--FROM farmmovimientoventas, dbo.Empleados RIGHT OUTER JOIN
--                      dbo.farmAlmacen INNER JOIN
--                      dbo.farmMovimientoNotaIngreso INNER JOIN
--                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
--                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino ON
--                       dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario LEFT OUTER JOIN
--                      dbo.TiposFinanciamiento RIGHT OUTER JOIN
--                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago ON
--                      dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
--                     dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
--                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
--                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
--                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
--                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
--WHERE       dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion AND farmMovimiento.idTipoConcepto=21 AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente AND farmmovimientoventas.idcuentaatencion=farmmovimientonotaingreso.idcuentaatencion
--ORDER BY dbo.farmMovimiento.fechaCreacion

FROM   Atenciones, Empleados, TiposFinanciamiento, FactCatalogoBienesInsumos, farmmovimientoventas, farmAlmacen, farmMovimientoNotaIngreso, farmMovimiento, farmEstadosMovimientos, farmMovimientoDetalle
WHERE  dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
AND dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero
AND dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto
AND dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento
       AND dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
AND dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago
AND dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario
       AND dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino
AND dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo AND
       dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero
       AND dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion
AND farmMovimiento.idTipoConcepto=21
AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente
AND farmmovimientoventas.idcuentaatencion=farmmovimientonotaingreso.idcuentaatencion
--AND farmmovimientonotaingreso.idcuentaatencion=atenciones.idcuentaatencion
--AND farmmovimientoventas.movnumero=farmmovimientodetalle.movnumero
--AND farmmovimientoventas.movtipo=farmmovimientonotaingreso.movtipo

ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDevolucionesPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDevolucionesPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaDevolucionesPorCuentaYServicioYFecha]
	@idCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.farmMovimiento.fechaCreacion,  dbo.farmMovimientoNotaIngreso.MovNumero,
                      dbo.FactCatalogoBienesInsumos.Codigo, dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoDetalle.Cantidad,
                      dbo.farmMovimientoDetalle.Precio, dbo.farmMovimientoDetalle.Total, dbo.farmEstadosMovimientos.Estado, dbo.farmAlmacen.descripcion as dAlmacen,
                      dbo.Atenciones.IdFormaPago, dbo.TiposFinanciamiento.Descripcion AS dFinanciamiento, dbo.Empleados.Usuario,dbo.farmMovimiento.idTipoConcepto,
                       dbo.farmMovimiento.idEstadoMovimiento, dbo.farmMovimiento.documentoNumero
FROM farmmovimientoventas, dbo.Empleados RIGHT OUTER JOIN
                      dbo.farmAlmacen INNER JOIN
                      dbo.farmMovimientoNotaIngreso INNER JOIN
                      dbo.farmMovimiento ON dbo.farmMovimientoNotaIngreso.MovNumero = dbo.farmMovimiento.MovNumero AND
                      dbo.farmMovimientoNotaIngreso.MovTipo = dbo.farmMovimiento.MovTipo ON dbo.farmAlmacen.idAlmacen = dbo.farmMovimiento.idAlmacenDestino ON
                       dbo.Empleados.IdEmpleado = dbo.farmMovimiento.idUsuario LEFT OUTER JOIN
                      dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago ON
                      dbo.farmMovimientoNotaIngreso.idCuentaAtencion = dbo.Atenciones.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos RIGHT OUTER JOIN
                      dbo.farmMovimientoDetalle ON dbo.FactCatalogoBienesInsumos.IdProducto = dbo.farmMovimientoDetalle.idProducto ON
                      dbo.farmMovimiento.MovNumero = dbo.farmMovimientoDetalle.MovNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoDetalle.MovTipo
WHERE       dbo.farmMovimientoNotaIngreso.idCuentaAtencion=@idCuentaAtencion AND farmMovimiento.idTipoConcepto=21 AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente  AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal  AND farmmovimientoventas.idcuentaatencion=farmmovimientonotaingreso.idcuentaatencion
ORDER BY dbo.farmMovimiento.fechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDevolucionesPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaDiagnosticoDeAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaDiagnosticoDeAtencion]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT Diagnosticos.IdDiagnostico, Diagnosticos.CodigoCIE10, Diagnosticos.Descripcion
FROM AtencionesDiagnosticos
INNER JOIN Diagnosticos ON AtencionesDiagnosticos.IdDiagnostico = Diagnosticos.IdDiagnostico
INNER JOIN Atenciones ON AtencionesDiagnosticos.IdAtencion = Atenciones.IdAtencion
WHERE (Atenciones.IdCuentaAtencion =@IdCuentaAtencion)
GROUP BY Diagnosticos.IdDiagnostico, Diagnosticos.CodigoCIE10, Diagnosticos.Descripcion ORDER BY Diagnosticos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaDiagnosticoDeAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmacia]
	@FechaCobranzaInicial [varchar](50),
	@FechaCobranzaFinal [varchar](50),
	@IdCaja [int],
	@IdTurno [int],
	@idTComprobante [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
DECLARE @CAJA AS VARCHAR(50)
DECLARE @TURNO AS VARCHAR(50)
DECLARE @TCOMPROBANTE AS VARCHAR(50)

SET @CAJA= ' '
SET @TURNO= ' '
SET @TCOMPROBANTE= ' '

If @IdCaja <> 0
	BEGIN
		SET @CAJA = ' AND CajaComprobantesPago.idCaja= ' + @IdCaja
	END
If @IdTurno <> 0
	BEGIN
		SET @TURNO =  'AND  CajaComprobantesPago.idTurno= ' + @IdTurno
	END
If @idTComprobante <> 0
	BEGIN
		SET @TCOMPROBANTE = ' AND  CajaComprobantesPago.IdTipoComprobante= ' +@idTComprobante
	END


SET  @SQL =                 'SELECT FactCatalogoBienesInsumos.Codigo, FactCatalogoBienesInsumos.Nombre AS Producto, CajaComprobantesPago.NroSerie AS nroSerie, CajaComprobantesPago.NroDocumento AS nroDocumento, CajaComprobantesPago.Total AS TotalBoleta, CajaComprobantesPago.RazonSocial AS RazonSocial, CajaComprobantesPago.FechaCobranza AS FechaCobranza, CajaComprobantesPago.IdEstadoComprobante AS IdEstadoComprobante, CajaComprobantesPago.IdTipoOrden, CajaGestion.FechaApertura AS FechaApertura, CajaGestion.IdCaja AS idCaja, CajaGestion.IdTurno AS idTurno, CajaGestion.FechaCierre, CajaGestion.IdCajero, FacturacionCuentasAtencion.IdPaciente, Pacientes.ApellidoPaterno AS ApellidoPaterno, Pacientes.ApellidoMaterno AS ApellidoMaterno, Pacientes.PrimerNombre AS PrimerNombre, Pacientes.NroHistoriaClinica AS NroHistoriaClinica, CajaComprobantesPago.IdTipoPago AS idTipoPago, CajaComprobantesPago.Dctos AS Dctos, FacturacionBienesPagos.*, FactOrdenesBienes.idComprobantePago, FactOrdenesBienes.MovNumero, FactOrdenesBienes.MovTipo,
				CajaComprobantesPago.exoneraciones,CajaComprobantesPago.subTotal,CajaComprobantesPago.Total as totalPagado, FactCatalogoBienesInsumos.idCentroCosto ,CajaComprobantesPago.adelantos,CajaComprobantesPago.IdTipoComprobante,CajaComprobantesPago.idTipoFinanciamiento
				FROM CajaComprobantesPago INNER JOIN CajaGestion ON CajaComprobantesPago.IdGestionCaja = CajaGestion.IdGestionCaja RIGHT OUTER JOIN FactOrdenesBienes ON CajaComprobantesPago.IdComprobantePago = FactOrdenesBienes.idComprobantePago RIGHT OUTER JOIN FacturacionBienesPagos LEFT OUTER JOIN FactCatalogoBienesInsumos ON FacturacionBienesPagos.IdProducto = FactCatalogoBienesInsumos.IdProducto ON FactOrdenesBienes.idOrden = FacturacionBienesPagos.IdOrden LEFT OUTER JOIN FacturacionCuentasAtencion ON CajaComprobantesPago.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN Pacientes ON FacturacionCuentasAtencion.IdPaciente = Pacientes.IdPaciente
				WHERE (CajaComprobantesPago.IdTipoOrden in (2,3)) AND CajaComprobantesPago.FechaCobranza>=CONVERT(DATETIME' + ' ' + @FechaCobranzaInicial  + ' ' + ' AND CajaComprobantesPago.FechaCobranza<=CONVERT(DATETIME, ' + @FechaCobranzaFinal + ' ,103) ' +  @CAJA  + ' ' + @TURNO  + ' ' +  @TCOMPROBANTE +
				'ORDER BY CajaComprobantesPago.FechaCobranza, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento'
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmaciaDebbSql2000]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmaciaDebbSql2000]
	@FechaCobranzaInicial [varchar](50),
	@FechaCobranzaFinal [varchar](50),
	@IdCaja [int],
	@IdTurno [int],
	@idTComprobante [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
DECLARE @CAJA AS VARCHAR(50)
DECLARE @TURNO AS VARCHAR(50)
DECLARE @TCOMPROBANTE AS VARCHAR(50)

SET @CAJA= ' '
SET @TURNO= ' '
SET @TCOMPROBANTE= ' '

If @IdCaja <> 0
	BEGIN
		SET @CAJA = ' AND CajaComprobantesPago.idCaja= ' + @IdCaja
	END
If @IdTurno <> 0
	BEGIN
		SET @TURNO =  'AND  CajaComprobantesPago.idTurno= ' + @IdTurno
	END
If @idTComprobante <> 0
	BEGIN
		SET @TCOMPROBANTE = ' AND  CajaComprobantesPago.IdTipoComprobante= ' +@idTComprobante
	END


SET  @SQL =                  'SELECT DISTINCT  dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.*,dbo.CajaComprobantesPago.Total as TotalPagado
				  FROM                      dbo.CajaComprobantesPago LEFT OUTER JOIN
				                                  dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
				  WHERE                  (CajaComprobantesPago.IdTipoOrden in (2,3)) AND CajaComprobantesPago.FechaCobranza>=CONVERT(DATETIME, ' + @FechaCobranzaInicial + ' ,103) AND CajaComprobantesPago.FechaCobranza<=CONVERT(DATETIME, ' + @FechaCobranzaFinal + ' ,103) ' + ' ' +  @CAJA + ' ' +  @TURNO + ' ' +  @TCOMPROBANTE +
				 ' ORDER BY             CajaComprobantesPago.FechaCobranza, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento'
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmaciaDebbSql2000] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmaciaPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmaciaPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
--FARMACIA
SELECT     tipo='MEDICAMENTOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1 AND dbo.farmMovimientoVentas.IdServicioPaciente<>0
AND dbo.FactCatalogoBienesInsumos.TipoProducto=0 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.idtipoconcepto<>21
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC, dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmaciaPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmaciaPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmaciaPorCuentaYFecha]
	@IdCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--FARMACIA
SELECT     tipo='MEDICAMENTOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1 AND dbo.farmMovimientoVentas.IdServicioPaciente<>0
AND dbo.FactCatalogoBienesInsumos.TipoProducto=0 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal  AND farmMovimiento.idtipoconcepto<>21
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC, dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmaciaPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmaciaPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmaciaPorCuentaYServicio]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
--FARMACIA
SELECT     tipo='MEDICAMENTOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1  AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente AND dbo.FactCatalogoBienesInsumos.TipoProducto=0 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.idtipoconcepto<>21
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC, dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmaciaPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaFarmaciaPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaFarmaciaPorCuentaYServicioYFecha]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--FARMACIA
SELECT     tipo='MEDICAMENTOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1  AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente AND dbo.FactCatalogoBienesInsumos.TipoProducto=0 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal AND farmMovimiento.idtipoconcepto<>21
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC, dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaFarmaciaPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaImagenologiaPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaImagenologiaPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
--RAYOS X
SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente,  dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (4, 20, 21, 22, 23) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaImagenologiaPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaImagenologiaPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaImagenologiaPorCuentaYFecha]
	@IdCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--RAYOS X
--SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
--                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
--                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
--                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
--	        dbo.FactOrdenServicio.IdServicioPaciente
--FROM         dbo.FacturacionServicioDespacho INNER JOIN
--                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
--                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
--                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
--                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
--                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente , dbo.FactCatalogoServicios.NombreMINSA, FacturacionServicioFinanciamientos.cantidadfinanciada as Cantidad, FacturacionServicioFinanciamientos.preciofinanciado as precio, FacturacionServicioFinanciamientos.totalfinanciado as total
FROM   FacturacionServicioFinanciamientos INNER JOIN   FacturacionServicioDespacho ON  FacturacionServicioFinanciamientos.idorden=FacturacionServicioDespacho.idOrden AND FacturacionServicioFinanciamientos.idProducto=FacturacionServicioDespacho.IdProducto INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (4, 20, 21, 22, 23) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaImagenologiaPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaImagenologiaPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaImagenologiaPorCuentaYServicio]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
--RAYOS X
SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente , dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (4, 20, 21, 22, 23) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaImagenologiaPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaImagenologiaPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaImagenologiaPorCuentaYServicioYFecha]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--RAYOS X
--SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
--                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
--                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
--                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
--	        dbo.FactOrdenServicio.IdServicioPaciente
--FROM         dbo.FacturacionServicioDespacho INNER JOIN
--                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
--                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
--                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
--                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
--                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
SELECT    tipo='RAYOS X', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente , dbo.FactCatalogoServicios.NombreMINSA, FacturacionServicioFinanciamientos.cantidadfinanciada as Cantidad, FacturacionServicioFinanciamientos.preciofinanciado as precio, FacturacionServicioFinanciamientos.totalfinanciado as total
FROM   FacturacionServicioFinanciamientos INNER JOIN   FacturacionServicioDespacho ON  FacturacionServicioFinanciamientos.idorden=FacturacionServicioDespacho.idOrden AND FacturacionServicioFinanciamientos.idProducto=FacturacionServicioDespacho.IdProducto INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (4, 20, 21, 22, 23) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaImagenologiaPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaInsumosPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaInsumosPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
--INSUMOS
SELECT    tipo='INSUMOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1 AND dbo.farmMovimientoVentas.IdServicioPaciente<>0
AND dbo.FactCatalogoBienesInsumos.TipoProducto=1 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1--  AND farmMovimientoVentas.TipoVenta<>'D'
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC,  dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaInsumosPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaInsumosPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaInsumosPorCuentaYFecha]
	@IdCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--INSUMOS
SELECT    tipo='INSUMOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1 AND dbo.farmMovimientoVentas.IdServicioPaciente<>0
AND dbo.FactCatalogoBienesInsumos.TipoProducto=1 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal --AND farmMovimientoVentas.TipoVenta<>'D'
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC,  dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaInsumosPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaInsumosPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaInsumosPorCuentaYServicio]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
--INSUMOS
SELECT    tipo='INSUMOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1  AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente AND dbo.FactCatalogoBienesInsumos.TipoProducto=1 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1-- AND farmMovimientoVentas.TipoVenta<>'D'
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC,  dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaInsumosPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaInsumosPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaInsumosPorCuentaYServicioYFecha]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--INSUMOS
SELECT    tipo='INSUMOS', dbo.FactCatalogoBienesInsumos.Codigo,
                      dbo.FactCatalogoBienesInsumos.Nombre, dbo.farmMovimientoVentasDetalle.cantidad, dbo.farmMovimientoVentasDetalle.precio,
                      dbo.farmMovimientoVentasDetalle.cantidad*dbo.farmMovimientoVentasDetalle.precio AS total, dbo.farmMovimientoVentas.idTipoFinanciamiento,
                      dbo.farmMovimientoVentasDetalle.idProducto, dbo.farmMovimientoVentas.idFuenteFinanciamiento, dbo.Atenciones.IdFormaPago AS idTipoFinanAtenciones,
                      dbo.farmMovimientoVentas.idServicioPaciente, dbo.farmMovimientoVentasDetalle.MovNumero, dbo.farmMovimientoVentasDetalle.MovTipo
FROM         dbo.TiposFinanciamiento RIGHT OUTER JOIN
                      dbo.Atenciones ON dbo.TiposFinanciamiento.IdTipoFinanciamiento = dbo.Atenciones.IdFormaPago RIGHT OUTER JOIN
                      dbo.farmMovimiento INNER JOIN
                      dbo.farmMovimientoVentas ON dbo.farmMovimiento.MovNumero = dbo.farmMovimientoVentas.movNumero AND
                      dbo.farmMovimiento.MovTipo = dbo.farmMovimientoVentas.movTipo ON
                      dbo.Atenciones.IdCuentaAtencion = dbo.farmMovimientoVentas.idCuentaAtencion LEFT OUTER JOIN
                      dbo.farmEstadosMovimientos ON dbo.farmMovimiento.idEstadoMovimiento = dbo.farmEstadosMovimientos.idEstadoMovimiento LEFT OUTER JOIN
                      dbo.farmAlmacen ON dbo.farmMovimiento.idAlmacenOrigen = dbo.farmAlmacen.idAlmacen LEFT OUTER JOIN
                      dbo.Empleados ON dbo.farmMovimiento.idUsuario = dbo.Empleados.IdEmpleado RIGHT OUTER JOIN
                      dbo.farmMovimientoVentasDetalle ON dbo.farmMovimientoVentas.movNumero = dbo.farmMovimientoVentasDetalle.MovNumero AND
                      dbo.farmMovimientoVentas.movTipo = dbo.farmMovimientoVentasDetalle.MovTipo LEFT OUTER JOIN
                      dbo.FactCatalogoBienesInsumos ON dbo.farmMovimientoVentasDetalle.idProducto = dbo.FactCatalogoBienesInsumos.IdProducto
WHERE         dbo.farmMovimientoVentas.idCuentaAtencion=@IdCuentaAtencion and dbo.farmMovimiento.idEstadoMovimiento=1  AND dbo.farmMovimientoVentas.IdServicioPaciente=@ServicioPaciente AND dbo.FactCatalogoBienesInsumos.TipoProducto=1 AND dbo.farmEstadosMovimientos.idEstadoMovimiento=1 AND farmMovimiento.FechaCreacion>=@FInicio AND farmMovimiento.FechaCreacion<=@FFinal --AND farmMovimientoVentas.TipoVenta<>'D'
ORDER BY dbo.FactCatalogoBienesInsumos.Nombre ASC,  dbo.farmMovimientoVentasDetalle.precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaInsumosPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaLaboratorioPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaLaboratorioPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
--LABORATORIO
SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente,dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaLaboratorioPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaLaboratorioPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaLaboratorioPorCuentaYFecha]
	@IdCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--LABORATORIO
--SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
--                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
--                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
--                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
--	        dbo.FactOrdenServicio.IdServicioPaciente
--FROM         dbo.FacturacionServicioDespacho INNER JOIN
--                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
--                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
--                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
--                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
--                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.NombreMINSA, FacturacionServicioFinanciamientos.cantidadfinanciada as Cantidad, FacturacionServicioFinanciamientos.preciofinanciado as precio, FacturacionServicioFinanciamientos.totalfinanciado as total
FROM   FacturacionServicioFinanciamientos INNER JOIN   FacturacionServicioDespacho ON  FacturacionServicioFinanciamientos.idorden=FacturacionServicioDespacho.idOrden AND FacturacionServicioFinanciamientos.idProducto=FacturacionServicioDespacho.IdProducto INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaLaboratorioPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaLaboratorioPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaLaboratorioPorCuentaYServicio]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
--LABORATORIO
SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaLaboratorioPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaLaboratorioPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaLaboratorioPorCuentaYServicioYFecha]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--LABORATORIO
--SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
--                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.Total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
--                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
--                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
--	        dbo.FactOrdenServicio.IdServicioPaciente
--FROM         dbo.FacturacionServicioDespacho INNER JOIN
--                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
--                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
--                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
--                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
--                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
SELECT    tipo='LABORATORIO', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                     dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.NombreMINSA, FacturacionServicioFinanciamientos.cantidadfinanciada as Cantidad, FacturacionServicioFinanciamientos.preciofinanciado as precio, FacturacionServicioFinanciamientos.totalfinanciado as total
FROM   FacturacionServicioFinanciamientos INNER JOIN   FacturacionServicioDespacho ON  FacturacionServicioFinanciamientos.idorden=FacturacionServicioDespacho.idOrden AND FacturacionServicioFinanciamientos.idProducto=FacturacionServicioDespacho.IdProducto INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND dbo.FactOrdenServicio.idPuntoCarga IN (2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio ASC
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaLaboratorioPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaProcedimientosPorCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaProcedimientosPorCuenta]
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
--PROCEDIMIENTOS
SELECT     tipo='PROCEDIMIENTOS', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.cantidad*dbo.FacturacionServicioDespacho.precio AS total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND FactCatalogoServicios.EsCPT=1 AND dbo.FactOrdenServicio.idPuntoCarga NOT IN (4, 20, 21, 22, 23, 2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaProcedimientosPorCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaProcedimientosPorCuentaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaProcedimientosPorCuentaYFecha]
	@IdCuentaAtencion [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--PROCEDIMIENTOS
SELECT     tipo='PROCEDIMIENTOS', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.cantidad*dbo.FacturacionServicioDespacho.precio AS total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND FactCatalogoServicios.EsCPT=1 AND dbo.FactOrdenServicio.idPuntoCarga NOT IN (4, 20, 21, 22, 23, 2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente<>0 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal AND FactCatalogoServicios.Codigo<>'99221' -- AND FactCatalogoServicios.Codigo<>'F00001'
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaProcedimientosPorCuentaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaProcedimientosPorCuentaYServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaProcedimientosPorCuentaYServicio]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int]
WITH EXECUTE AS CALLER
AS
--PROCEDIMIENTOS
SELECT     tipo='PROCEDIMIENTOS', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.cantidad*dbo.FacturacionServicioDespacho.precio AS total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente, dbo.FactCatalogoServicios.NombreMINSA
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND FactCatalogoServicios.EsCPT=1 AND dbo.FactOrdenServicio.idPuntoCarga NOT IN (4, 20, 21, 22, 23, 2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaProcedimientosPorCuentaYServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaProcedimientosPorCuentaYServicioYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaProcedimientosPorCuentaYServicioYFecha]
	@IdCuentaAtencion [int],
	@ServicioPaciente [int],
	@FInicio [datetime],
	@FFinal [datetime]
WITH EXECUTE AS CALLER
AS
--PROCEDIMIENTOS
SELECT     tipo='PROCEDIMIENTOS', dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.FacturacionServicioDespacho.idOrden, dbo.FacturacionServicioDespacho.Cantidad,
                      dbo.FacturacionServicioDespacho.Precio, dbo.FacturacionServicioDespacho.cantidad*dbo.FacturacionServicioDespacho.precio AS total, dbo.FactOrdenServicio.IdCuentaAtencion, dbo.FactOrdenServicio.idTipoFinanciamiento,
                      dbo.FactOrdenServicio.FechaCreacion, dbo.EstadosFacturacion.Descripcion, dbo.TiposFinanciamiento.Descripcion AS dfinanciamiento,
                      dbo.FactOrdenServicio.IdEstadoFacturacion, dbo.Atenciones.idFuenteFinanciamiento, dbo.FactOrdenServicio.idPuntoCarga, dbo.FacturacionServicioDespacho.IdProducto,
	        dbo.FactOrdenServicio.IdServicioPaciente
FROM         dbo.FacturacionServicioDespacho INNER JOIN
                      dbo.FactOrdenServicio ON dbo.FacturacionServicioDespacho.idOrden = dbo.FactOrdenServicio.IdOrden INNER JOIN
                      dbo.FactCatalogoServicios ON dbo.FacturacionServicioDespacho.IdProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
                      dbo.TiposFinanciamiento ON dbo.FactOrdenServicio.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento LEFT OUTER JOIN
                      dbo.EstadosFacturacion ON dbo.FactOrdenServicio.IdEstadoFacturacion = dbo.EstadosFacturacion.IdEstadoFacturacion LEFT OUTER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion
WHERE       @IdCuentaAtencion=dbo.FactOrdenServicio.IdCuentaAtencion AND FactCatalogoServicios.EsCPT=1 AND dbo.FactOrdenServicio.idPuntoCarga NOT IN (4, 20, 21, 22, 23, 2, 3, 11, 31, 32, 33, 34, 35, 36, 37, 38) AND dbo.FactOrdenServicio.IdServicioPaciente=@ServicioPaciente AND dbo.EstadosFacturacion.IdEstadoFacturacion<>9 AND dbo.EstadosFacturacion.IdEstadoFacturacion<>12 AND FactOrdenServicio.FechaCreacion>=@FInicio AND FactOrdenServicio.FechaCreacion<=@FFinal AND FactCatalogoServicios.Codigo<>'99221' -- AND FactCatalogoServicios.Codigo<>'F00001'
ORDER BY  dbo.FactCatalogoServicios.Nombre ASC, dbo.FacturacionServicioDespacho.Precio
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaProcedimientosPorCuentaYServicioYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionarOrdenesPendientesDePago]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionarOrdenesPendientesDePago]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     ltrim(str(dbo.FactOrdenesBienes.idPreventa))+'F' AS Nro_PreVta, dbo.FactOrdenesBienes.FechaCreacion, dbo.FactOrdenesBienes.idOrden,
                      dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre,
                     dbo.Pacientes.nroDocumento,dbo.Pacientes.idDocIdentidad,dbo.FactOrdenesBienes.idPreventa AS Nro_Preventa
FROM         dbo.FactOrdenesBienes LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.FactOrdenesBienes.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     dbo.FactOrdenesBienes.idEstadoFacturacion=1  and (dbo.FactOrdenesBienes.fechaCreacion Between  @FechaInicio and  @FechaFin)
                  and dbo.FactOrdenesBienes.idPreventa<>null
ORDER BY dbo.FactOrdenesBienes.idPreventa desc
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionarOrdenesPendientesDePago] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaServicios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaServicios]
	@FechaCobranzaInicial [varchar](50),
	@FechaCobranzaFinal [varchar](50),
	@IdCaja [int],
	@IdTurno [int],
	@idTComprobante [int]
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
DECLARE @CAJA AS VARCHAR(50)
DECLARE @TURNO AS VARCHAR(50)
DECLARE @TCOMPROBANTE AS VARCHAR(50)

SET @CAJA= ' '
SET @TURNO= ' '
SET @TCOMPROBANTE= ' '

If @IdCaja <> 0
	BEGIN
		SET @CAJA = ' AND CajaComprobantesPago.idCaja= ' + @IdCaja
	END
If @IdTurno <> 0
	BEGIN
		SET @TURNO =  'AND  CajaComprobantesPago.idTurno= ' + @IdTurno
	END
If @idTComprobante <> 0
	BEGIN
		SET @TCOMPROBANTE = ' AND  CajaComprobantesPago.IdTipoComprobante= ' +@idTComprobante
	END


SET  @SQL =                   'SELECT CajaComprobantesPago.NroSerie AS NroSerie, CajaComprobantesPago.NroDocumento AS NroDocumento, CajaComprobantesPago.Total AS TotalBoleta, CajaComprobantesPago.IdTipoOrden AS idTipoOrden, CajaComprobantesPago.IdTipoPago AS idTipoPago, CajaComprobantesPago.RazonSocial AS RazonSocial, CajaComprobantesPago.FechaCobranza AS FechaCobranza, Pacientes.ApellidoPaterno AS apellidoPaterno, Pacientes.NroHistoriaClinica, Pacientes.ApellidoMaterno AS apellidoMaterno, Pacientes.PrimerNombre AS PrimerNombre, CajaGestion.IdGestionCaja, CajaGestion.FechaApertura AS FechaApertura, CajaGestion.IdCaja AS idCaja, CajaGestion.IdTurno AS idTurno, CajaGestion.FechaCierre AS FechaCierre, CajaGestion.IdCajero AS idCajeroGestion,
				  FactCatalogoServicios.Codigo AS codigo, FactCatalogoServicios.Nombre AS dproducto, CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante, CajaComprobantesPago.Dctos AS Dctos, FacturacionServicioPagos.*, FactOrdenServicioPagos.idComprobantePago, FactOrdenServicioPagos.idOrden, CajaComprobantesPago.exoneraciones,CajaComprobantesPago.subTotal, CajaComprobantesPago.Total as totalPagado,FactCatalogoServicios.idCentroCosto,CajaComprobantesPago.adelantos, CajaComprobantesPago.IdTipoComprobante, CajaComprobantesPago.idCuentaAtencion, FactCatalogoServicios.IdServicioGrupo, CajaComprobantesPago.idTipoFinanciamiento, CajaComprobantesPago.IdCajero
				  FROM CajaGestion RIGHT OUTER JOIN FactCatalogoServicios RIGHT OUTER JOIN FacturacionServicioPagos ON FactCatalogoServicios.IdProducto = FacturacionServicioPagos.idProducto LEFT OUTER JOIN CajaComprobantesPago RIGHT OUTER JOIN FactOrdenServicioPagos ON CajaComprobantesPago.IdComprobantePago = FactOrdenServicioPagos.idComprobantePago ON FacturacionServicioPagos.idOrdenPago = FactOrdenServicioPagos.idOrdenPago ON CajaGestion.IdGestionCaja = CajaComprobantesPago.IdGestionCaja LEFT OUTER JOIN FacturacionCuentasAtencion ON CajaComprobantesPago.IdCuentaAtencion = FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN Pacientes ON FacturacionCuentasAtencion.IdPaciente = Pacientes.IdPaciente
				  WHERE (CajaComprobantesPago.IdTipoOrden = 1) AND CajaComprobantesPago.FechaCobranza >= ' + ' ' + @FechaCobranzaInicial  + ' ' + ' AND CajaComprobantesPago.FechaCobranza<=CONVERT(DATETIME, ' + @FechaCobranzaFinal + ' ,103) ' +  @CAJA  + ' ' + @TURNO  + ' ' +  @TCOMPROBANTE +
				  'ORDER BY CajaComprobantesPago.FechaCobranza, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento'


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaServicios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaServiciosDebb]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SeleccionaServiciosDebb]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.*,dbo.CajaComprobantesPago.Total as TotalPagado
FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
                  dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE CajaComprobantesPago.FechaCobranza >= @FechaInicio AND CajaComprobantesPago.FechaCobranza<=@FechaFin
ORDER BY CajaComprobantesPago.FechaCobranza, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaServiciosDebb] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SeleccionaServiciosDebb1]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SeleccionaServiciosDebb1]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT dbo.Pacientes.NroHistoriaClinica, dbo.CajaComprobantesPago.*,dbo.CajaComprobantesPago.Total as TotalPagado
FROM         dbo.CajaComprobantesPago LEFT OUTER JOIN
                  dbo.Pacientes ON dbo.CajaComprobantesPago.IdPaciente = dbo.Pacientes.IdPaciente
WHERE CajaComprobantesPago.fechaEmision  >= @FechaInicio AND CajaComprobantesPago.fechaEmision<=@FechaFin
ORDER BY CajaComprobantesPago.fechaEmision, CajaComprobantesPago.NroSerie, CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[SeleccionaServiciosDebb1] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioBoletasPorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioBoletasPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FactCatalogoServicios.Codigo,
                      dbo.FactCatalogoServicios.NombreMINSA as nombre, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso, dbo.Servicios.IdEspecialidad,
                      dbo.Servicios.Nombre AS dservicio, dbo.FactOrdenServicioPagos.idComprobantePago, dbo.Atenciones.IdAtencion,
                      dbo.FacturacionServicioPagos.idProducto, dbo.FacturacionServicioPagos.Cantidad, dbo.FacturacionServicioPagos.Precio AS PrecioUnitario,
                      dbo.FacturacionServicioPagos.Total AS TotalPorPagar
FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.Atenciones.IdCuentaAtencion = dbo.CajaComprobantesPago.IdCuentaAtencion LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                      dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago
 Where dbo.Atenciones.idTipoServicio=1 and  dbo.CajaComprobantesPago.IdEstadoComprobante=4
                and  dbo.Atenciones.FechaIngreso Between @FechaInicio and @FechaFin and dbo.Atenciones.idEstadoAtencion<>0
 ORDER BY dbo.FactCatalogoServicios.Codigo
GO
ALTER AUTHORIZATION ON [dbo].[ServicioBoletasPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioBoletasPorIdPacienteIdCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioBoletasPorIdPacienteIdCuenta]
	@idPaciente [int],
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.IdPaciente, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento,
                      dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.IdEstadoComprobante, dbo.FacturacionServicioPagos.idProducto,
                      dbo.FacturacionServicioPagos.Cantidad, dbo.FacturacionServicioPagos.Precio AS PrecioUnitario,
                      dbo.FacturacionServicioPagos.Total AS TotalPorPagar, dbo.FactOrdenServicioPagos.idComprobantePago
FROM         dbo.FactOrdenServicioPagos RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago LEFT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.FactOrdenServicioPagos.idComprobantePago = dbo.CajaComprobantesPago.IdComprobantePago
Where   dbo.CajaComprobantesPago.IdPaciente=@idPaciente and
           dbo.CajaComprobantesPago.IdEstadoComprobante=4  and dbo.CajaComprobantesPago.idCuentaAtencion=@idCuentaAtencion
ORDER BY dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[ServicioBoletasPorIdPacienteIdCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioConsolidado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioConsolidado]
	@idCaja [int],
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTurno [int],
	@idCajero [int]
WITH EXECUTE AS CALLER
AS
If @idCaja = 0 And @idTurno = 0 And @idCajero = 0

	 SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                    dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                    dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                    dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                    dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                    dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaComprobantesPago.IdCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                    dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                    dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                    dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idComprobantePago,
                                    dbo.FactOrdenServicioPagos.idOrden, dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,
                                    dbo.CajaComprobantesPago.Total as totalPagado,dbo.FactCatalogoServicios.idCentroCosto,dbo.CajaComprobantesPago.adelantos, dbo.FactCatalogoServicios.NombreMINSA,
                                    dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.idCuentaAtencion, dbo.FactCatalogoServicios.IdServicioGrupo, dbo.CajaComprobantesPago.idTipoFinanciamiento,
                                    dbo.CajaComprobantesPago.IdCajero,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
              FROM            dbo.CajaGestion RIGHT OUTER JOIN
                                    dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                    dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                    dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                    dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                    dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                    dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja LEFT OUTER JOIN
                                    dbo.FacturacionCuentasAtencion ON
                                    dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                    dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
	Where           (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio and @FechaFin
             ORDER BY    dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento

Else If @idCaja > 0 And @idTurno = 0 And @idCajero = 0

	 SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                    dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                    dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                    dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                    dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                    dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaComprobantesPago.IdCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                    dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                    dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                    dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idComprobantePago,
                                    dbo.FactOrdenServicioPagos.idOrden, dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,
                                    dbo.CajaComprobantesPago.Total as totalPagado,dbo.FactCatalogoServicios.idCentroCosto,dbo.CajaComprobantesPago.adelantos, dbo.FactCatalogoServicios.NombreMINSA,
                                    dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.idCuentaAtencion, dbo.FactCatalogoServicios.IdServicioGrupo, dbo.CajaComprobantesPago.idTipoFinanciamiento,
                                    dbo.CajaComprobantesPago.IdCajero,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
              FROM            dbo.CajaGestion RIGHT OUTER JOIN
                                    dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                    dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                    dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                    dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                    dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                    dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja LEFT OUTER JOIN
                                    dbo.FacturacionCuentasAtencion ON
                                    dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                    dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
	Where           (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                    and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
                                    and dbo.CajaComprobantesPago.idCaja=@idCaja
            ORDER BY      dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento


Else If @idCaja > 0 And @idTurno > 0 And @idCajero = 0

	 SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                    dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                    dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                    dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                    dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                    dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaComprobantesPago.IdCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                    dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                    dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                    dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idComprobantePago,
                                    dbo.FactOrdenServicioPagos.idOrden, dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,
                                    dbo.CajaComprobantesPago.Total as totalPagado,dbo.FactCatalogoServicios.idCentroCosto,dbo.CajaComprobantesPago.adelantos, dbo.FactCatalogoServicios.NombreMINSA,
                                    dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.idCuentaAtencion, dbo.FactCatalogoServicios.IdServicioGrupo, dbo.CajaComprobantesPago.idTipoFinanciamiento,
                                    dbo.CajaComprobantesPago.IdCajero,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
              FROM            dbo.CajaGestion RIGHT OUTER JOIN
                                    dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                    dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                    dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                    dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                    dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                    dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja LEFT OUTER JOIN
                                    dbo.FacturacionCuentasAtencion ON
                                    dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                    dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
	Where           (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                    and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
                                    and dbo.CajaComprobantesPago.idCaja=@idCaja
                                    and dbo.CajaComprobantesPago.idTurno=@idTurno
            ORDER BY      dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento

Else

	 SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                    dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                    dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                    dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                    dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                    dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaComprobantesPago.IdCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                    dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                    dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                    dbo.CajaComprobantesPago.Dctos AS Dctos, dbo.FacturacionServicioPagos.*, dbo.FactOrdenServicioPagos.idComprobantePago,
                                    dbo.FactOrdenServicioPagos.idOrden, dbo.CajaComprobantesPago.exoneraciones,dbo.CajaComprobantesPago.subTotal,
                                    dbo.CajaComprobantesPago.Total as totalPagado,dbo.FactCatalogoServicios.idCentroCosto,dbo.CajaComprobantesPago.adelantos, dbo.FactCatalogoServicios.NombreMINSA,
                                    dbo.CajaComprobantesPago.IdTipoComprobante, dbo.CajaComprobantesPago.idCuentaAtencion, dbo.FactCatalogoServicios.IdServicioGrupo, dbo.CajaComprobantesPago.idTipoFinanciamiento,
                                    dbo.CajaComprobantesPago.IdCajero,dbo.CajaComprobantesPago.igv,dbo.CajaComprobantesPago.TieneCredito
              FROM            dbo.CajaGestion RIGHT OUTER JOIN
                                    dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                    dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                    dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                    dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                    dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                    dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja LEFT OUTER JOIN
                                    dbo.FacturacionCuentasAtencion ON
                                    dbo.CajaComprobantesPago.IdCuentaAtencion = dbo.FacturacionCuentasAtencion.IdCuentaAtencion LEFT OUTER JOIN
                                    dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente
           Where              (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                    and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
                                    and dbo.CajaComprobantesPago.idCaja=@idCaja
                                    and dbo.CajaComprobantesPago.idTurno=@idTurno
                                    and dbo.CajaComprobantesPago.idCajero=@idCajero
          ORDER BY        dbo.CajaComprobantesPago.FechaCobranza, dbo.CajaComprobantesPago.NroSerie, dbo.CajaComprobantesPago.NroDocumento
GO
ALTER AUTHORIZATION ON [dbo].[ServicioConsolidado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioConsumoConvenioConsultaExternaPorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioConsumoConvenioConsultaExternaPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CentrosCosto.Codigo, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.FechaCreacion ,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre ,
	                      dbo.Pacientes.NroHistoriaClinica
	FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
	                      dbo.CentrosCosto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.CentrosCosto.IdCentroCosto = dbo.FactCatalogoServicios.IdCentroCosto ON
	                      dbo.FacturacionServicioFinanciamientos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	Where (dbo.FactOrdenServicio.IdTipoFinanciamiento = 4) and
	                      dbo.FactOrdenServicio.FechaCreacion Between @FechaInicio and @FechaFin
	                   and  dbo.FacturacionServicioFinanciamientos.idProducto=4583       --Consulta médica hasta 15 minutos
		    and dbo.FactOrdenServicio.idPaciente=@idPaciente
	 order by dbo.FactOrdenServicio.FechaCreacion
GO
ALTER AUTHORIZATION ON [dbo].[ServicioConsumoConvenioConsultaExternaPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioConsumoConveniosPorFechas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioConsumoConveniosPorFechas]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@Orden [int]
WITH EXECUTE AS CALLER
AS
if @Orden=1   --dbo.FactOrdenServicio.idPaciente,dbo.CentrosCosto.Codigo
	SELECT     dbo.CentrosCosto.Codigo, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.FechaCreacion ,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre ,
	                      dbo.Pacientes.NroHistoriaClinica
	FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
	                      dbo.CentrosCosto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.CentrosCosto.IdCentroCosto = dbo.FactCatalogoServicios.IdCentroCosto ON
	                      dbo.FacturacionServicioFinanciamientos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	Where (dbo.FactOrdenServicio.IdTipoFinanciamiento = 4) and
	                      dbo.FactOrdenServicio.FechaCreacion Between @FechaInicio and @FechaFin
	                    and  dbo.FacturacionServicioFinanciamientos.idProducto<>4583       --Consulta médica hasta 15 minutos
	 order by dbo.FactOrdenServicio.idPaciente,dbo.CentrosCosto.Codigo
else
	SELECT     dbo.CentrosCosto.Codigo, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.FechaCreacion ,
	                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno , dbo.Pacientes.PrimerNombre ,
	                      dbo.Pacientes.NroHistoriaClinica ,dbo.CentrosCosto.descripcion
	FROM         dbo.FacturacionServicioFinanciamientos LEFT OUTER JOIN
	                      dbo.CentrosCosto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServicios ON dbo.CentrosCosto.IdCentroCosto = dbo.FactCatalogoServicios.IdCentroCosto ON
	                      dbo.FacturacionServicioFinanciamientos.idProducto = dbo.FactCatalogoServicios.IdProducto LEFT OUTER JOIN
	                      dbo.Pacientes RIGHT OUTER JOIN
	                      dbo.FactOrdenServicio ON dbo.Pacientes.IdPaciente = dbo.FactOrdenServicio.IdPaciente ON
	                      dbo.FacturacionServicioFinanciamientos.idOrden = dbo.FactOrdenServicio.IdOrden
	Where (dbo.FactOrdenServicio.IdTipoFinanciamiento = 4) and
	                      dbo.FactOrdenServicio.FechaCreacion Between @FechaInicio and @FechaFin
	                    and  dbo.FacturacionServicioFinanciamientos.idProducto<>4583       --Consulta médica hasta 15 minutos
	 order by dbo.CentrosCosto.descripcion
GO
ALTER AUTHORIZATION ON [dbo].[ServicioConsumoConveniosPorFechas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo]
	@FechaInicio [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Servicios.Nombre AS Dservicio, dbo.Servicios.Codigo AS CodServicio,
                      dbo.Atenciones.IdCuentaAtencion AS idCuentaAtencion, dbo.Atenciones.IdServicioEgreso AS IdServicioEgreso,
                      dbo.CajaComprobantesPago.Dctos, dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                      dbo.Atenciones.FechaEgresoAdministrativo, dbo.FacturacionServicioPagos.*, dbo.Atenciones.IdTipoServicio,dbo.FactOrdenServicioPagos. idEstadoFacturacion
FROM         dbo.Servicios RIGHT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.CajaComprobantesPago ON dbo.Atenciones.IdCuentaAtencion = dbo.CajaComprobantesPago.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactOrdenServicioPagos ON
                      dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago RIGHT OUTER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioEgreso
 WHERE (dbo.Atenciones.IdTipoServicio = 3) AND (dbo.Atenciones.IdServicioEgreso IS NOT NULL) and (dbo.Atenciones.FechaEgresoAdministrativo IS NOT NULL) and
                      dbo.Atenciones.FechaEgresoAdministrativo Between @FechaInicio and  @FechaFin
 order by dbo.CajaComprobantesPago.IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServicioConsumosHospitalizadosFiltraPorFechasEgresoAdministrativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioEsPuntoCarga]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioEsPuntoCarga]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from FactPuntosCarga where idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServicioEsPuntoCarga] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioFinanciamientosPorFuenteFinanciamientoFechaLiquidacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioFinanciamientosPorFuenteFinanciamientoFechaLiquidacion]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionServicioFinanciamientos.*
FROM         dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado
Where           (dbo.FacturacionServicioFinanciamientos.idFuenteFinanciamiento = @idFuenteFinanciamiento) and
	           dbo.FacturacionServicioFinanciamientos.FechaAutoriza Between @FechaInicio and @FechaFin
	       and dbo.Atenciones.idEstadoAtencion<>0
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[ServicioFinanciamientosPorFuenteFinanciamientoFechaLiquidacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioFinanciamientosPorNroCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioFinanciamientosPorNroCuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT	c.Codigo, c.Nombre, a.IdPaciente, a.IdCuentaAtencion,
		p.ApellidoPaterno, p.ApellidoMaterno, p.PrimerNombre, p.NroHistoriaClinica,
		f.IdEstado, a.IdTipoServicio, a.FechaIngreso, ec.Descripcion AS DestadoCta, s.*,
		o.idEstadoFacturacion,s.idEstadoFacturacion as idEstadoFacturacionFinanciamiento
FROM FacturacionCuentasAtencion f
INNER JOIN Atenciones a ON f.IdCuentaAtencion=a.IdCuentaAtencion
INNER JOIN FactOrdenServicio o ON a.IdCuentaAtencion=o.IdCuentaAtencion
INNER JOIN FacturacionServicioFinanciamientos s ON o.idOrden=s.idOrden
INNER JOIN FactCatalogoServicios c ON s.IdProducto=c.IdProducto
INNER JOIN EstadosCuenta ec ON f.IdEstado=ec.IdEstado
INNER JOIN Pacientes p ON a.IdPaciente=p.IdPaciente
WHERE f.idCuentaAtencion=@idCuentaAtencion AND a.idEstadoAtencion<>0 AND o.IdEstadoFacturacion<>9
order BY p.ApellidoPaterno, p.ApellidoMaterno, p.PrimerNombre, p.NroHistoriaClinica

--SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion,
--dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
--dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
--dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionServicioFinanciamientos.*,
--dbo.FactOrdenServicio.idEstadoFacturacion,dbo.FacturacionServicioFinanciamientos.idEstadoFacturacion as idEstadoFacturacionFinanciamiento
--FROM         dbo.EstadosCuenta
--RIGHT OUTER JOIN      dbo.FacturacionCuentasAtencion
--RIGHT OUTER JOIN      dbo.Atenciones
--RIGHT OUTER JOIN      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion
--RIGHT OUTER JOIN	  dbo.FactCatalogoServicios
--RIGHT OUTER JOIN      dbo.FacturacionServicioFinanciamientos
--					ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto
--					ON dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden
--RIGHT OUTER JOIN      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
--                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
--                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado
--Where           dbo.Atenciones.idCuentaAtencion=1049180   and dbo.Atenciones.idEstadoAtencion<>0
--order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica

GO
ALTER AUTHORIZATION ON [dbo].[ServicioFinanciamientosPorNroCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaAltaMedica]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaAltaMedica]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.idEstadoFacturacion,
		 dbo.Atenciones.fechaEgreso,dbo.Atenciones.idTipoServicio
FROM         dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado
Where           ( dbo.Atenciones.idFormaPago = @idTipoFinanciamiento) and
	          dbo.Atenciones.FechaEgreso Between @FechaInicio and @FechaFin
	       and dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio>1
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaAltaMedica] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaIngreso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaIngreso]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.idEstadoFacturacion,
		 dbo.Atenciones.fechaEgreso,dbo.Atenciones.idTipoServicio
FROM         dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado
Where           (dbo.Atenciones.idFormaPago = @idTipoFinanciamiento) and
	          dbo.Atenciones.FechaIngreso Between @FechaInicio and @FechaFin
	       and dbo.Atenciones.idEstadoAtencion<>0 and dbo.Atenciones.idTipoServicio=1
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaLiquidacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaLiquidacion]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre, dbo.Atenciones.IdPaciente, dbo.Atenciones.IdCuentaAtencion,
                      dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica,
                      dbo.FacturacionCuentasAtencion.IdEstado, dbo.Atenciones.IdTipoServicio, dbo.Atenciones.FechaIngreso,
                      dbo.EstadosCuenta.Descripcion AS DestadoCta, dbo.FacturacionServicioFinanciamientos.*, dbo.FactOrdenServicio.idEstadoFacturacion
FROM         dbo.EstadosCuenta RIGHT OUTER JOIN
                      dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                      dbo.Atenciones RIGHT OUTER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioFinanciamientos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioFinanciamientos.idProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioFinanciamientos.idOrden RIGHT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente ON
                      dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                      dbo.EstadosCuenta.IdEstado = dbo.FacturacionCuentasAtencion.IdEstado
Where           (dbo.FacturacionServicioFinanciamientos.IdTipoFinanciamiento = @idTipoFinanciamiento) and
	           dbo.FacturacionServicioFinanciamientos.FechaAutoriza Between @FechaInicio and @FechaFin
	       and dbo.Atenciones.idEstadoAtencion<>0
order by       dbo.Pacientes.ApellidoPaterno, dbo.Pacientes.ApellidoMaterno, dbo.Pacientes.PrimerNombre, dbo.Pacientes.NroHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[ServicioFinanciamientosPorTipoFinanciamientoFechaLiquidacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioParteDiario]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioParteDiario]
	@FechaInicio [datetime],
	@FechaFin [datetime],
	@idCaja [int],
	@idTurno [int],
	@idCajero [int]
WITH EXECUTE AS CALLER
AS
If @idCaja > 0 And @idTurno > 0 And @idCajero > 0

	SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                   dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                   dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                   dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                   dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                   dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                   dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                   dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                   dbo.FactPartidasPresupuestales.Codigo AS Partida, dbo.FactPartidasPresupuestales.Descripcion AS dpartida,
                                   dbo.FactPartidasPresupuestales.IdPartidaPresupuestal AS idPartidaPresupuestal, dbo.CajaComprobantesPago.Dctos, dbo.FacturacionServicioPagos.*,
                                   dbo.FactOrdenServicioPagos.IdOrden , dbo.FactOrdenServicioPagos.IdComprobantePago
             FROM            dbo.FactPartidasPresupuestales RIGHT OUTER JOIN
                                   dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                                   dbo.CajaGestion RIGHT OUTER JOIN
                                   dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                   dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                   dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                   dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                   dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                   dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja ON
                                   dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.CajaComprobantesPago.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente ON
                                   dbo.FactPartidasPresupuestales.IdPartidaPresupuestal = dbo.FactCatalogoServicios.IdPartida
	Where          (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio  and @FechaFin
                                   and dbo.CajaComprobantesPago.idCaja=@idCaja
                                   and dbo.CajaComprobantesPago.idTurno=@idTurno
                                   and dbo.CajaComprobantesPago.idCajero=@idCajero
            ORDER BY     dbo.FactPartidasPresupuestales.idPartidaPresupuestal

Else
	SELECT        dbo.CajaComprobantesPago.NroSerie AS NroSerie, dbo.CajaComprobantesPago.NroDocumento AS NroDocumento,
                                   dbo.CajaComprobantesPago.Total AS TotalBoleta, dbo.CajaComprobantesPago.IdTipoOrden AS idTipoOrden,
                                   dbo.CajaComprobantesPago.IdTipoPago AS idTipoPago, dbo.CajaComprobantesPago.RazonSocial AS RazonSocial,
                                   dbo.CajaComprobantesPago.FechaCobranza AS FechaCobranza, dbo.Pacientes.ApellidoPaterno AS apellidoPaterno, dbo.Pacientes.NroHistoriaClinica,
                                   dbo.Pacientes.ApellidoMaterno AS apellidoMaterno, dbo.Pacientes.PrimerNombre AS PrimerNombre, dbo.CajaGestion.IdGestionCaja,
                                   dbo.CajaGestion.FechaApertura AS FechaApertura, dbo.CajaGestion.IdCaja AS idCaja, dbo.CajaGestion.IdTurno AS idTurno,
                                   dbo.CajaGestion.FechaCierre AS FechaCierre, dbo.CajaGestion.IdCajero AS idCajeroGestion, dbo.FactCatalogoServicios.Codigo AS codigo,
                                   dbo.FactCatalogoServicios.Nombre AS dproducto, dbo.CajaComprobantesPago.IdEstadoComprobante AS idEstadoComprobante,
                                   dbo.FactPartidasPresupuestales.Codigo AS Partida, dbo.FactPartidasPresupuestales.Descripcion AS dpartida,
                                   dbo.FactPartidasPresupuestales.IdPartidaPresupuestal AS idPartidaPresupuestal, dbo.CajaComprobantesPago.Dctos, dbo.FacturacionServicioPagos.*,
                                   dbo.FactOrdenServicioPagos.IdOrden , dbo.FactOrdenServicioPagos.IdComprobantePago
             FROM            dbo.FactPartidasPresupuestales RIGHT OUTER JOIN
                                   dbo.FacturacionCuentasAtencion RIGHT OUTER JOIN
                                   dbo.CajaGestion RIGHT OUTER JOIN
                                   dbo.FactCatalogoServicios RIGHT OUTER JOIN
                                   dbo.FacturacionServicioPagos ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioPagos.idProducto LEFT OUTER JOIN
                                   dbo.CajaComprobantesPago RIGHT OUTER JOIN
                                   dbo.FactOrdenServicioPagos ON dbo.CajaComprobantesPago.IdComprobantePago = dbo.FactOrdenServicioPagos.idComprobantePago ON
                                   dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago ON
                                   dbo.CajaGestion.IdGestionCaja = dbo.CajaComprobantesPago.IdGestionCaja ON
                                   dbo.FacturacionCuentasAtencion.IdCuentaAtencion = dbo.CajaComprobantesPago.IdCuentaAtencion LEFT OUTER JOIN
                                   dbo.Pacientes ON dbo.FacturacionCuentasAtencion.IdPaciente = dbo.Pacientes.IdPaciente ON
                                   dbo.FactPartidasPresupuestales.IdPartidaPresupuestal = dbo.FactCatalogoServicios.IdPartida
	Where          (dbo.CajaComprobantesPago.IdTipoOrden = 1)
                                   and CajaComprobantesPago.FechaCobranza Between @FechaInicio and  @FechaFin
             ORDER BY   dbo.FactPartidasPresupuestales.idPartidaPresupuestal
GO
ALTER AUTHORIZATION ON [dbo].[ServicioParteDiario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosActualizaIdEstancia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosActualizaIdEstancia]
WITH EXECUTE AS CALLER
AS
update servicios set idproducto=4590 WHERE (idTipoServicio=2 or idTipoServicio=3)  and idproducto is null
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosActualizaIdEstancia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosAgregar]
	@IdProducto [int],
	@SVG [varchar](8000),
	@Codigo [varchar](6),
	@IdServicio [int] OUTPUT,
	@Nombre [varchar](50),
	@IdEspecialidad [int],
	@IdTipoServicio [int],
	@soloTipoSexo [int],
	@maximaEdad [int],
	@codigoServicioSEM [varchar](10),
	@ubicacionSEM [varchar](5),
	@codigoServicioHIS [varchar](6),
	@CostoCeroCE [varchar](1),
	@minimaEdad [int],
	@Triaje [bit],
	@EsObservacionEmergencia [bit],
	@UsaModuloNinoSano [bit],
	@UsaModuloMaterno [bit],
	@UsaGalenHos [bit],
	@TipoEdad [int],
	@UsaFUA [bit],
	@codigoServicioSuSalud [varchar](7),
	@codigoServicioFUA [varchar](6),
	@FuaTipoAnexo2015 [int],
	@MaxCuposCitasAdelantadas [int],
	@MaxCuposAdicionales [int],
	@MaxCuposCitasHoySIS [int],
	@MaxCuposCitasAdelandatasSIS [int],
	@usaNacimiento [int],
	@emergenciaCorrelativo [varchar](10),
	@NoUsaMensajeTexto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Servicios (
IdProducto,SVG,Codigo,Nombre,IdEspecialidad,IdTipoServicio,soloTipoSexo,maximaEdad,codigoServicioSEM,ubicacionSEM,codigoServicioHIS,
CostoCeroCE,minimaEdad,Triaje,EsObservacionEmergencia,idEstado,UsaModuloNinoSano,UsaModuloMaterno,UsaGalenHos,TipoEdad,UsaFUA,
codigoServicioSuSalud,codigoServicioFUA,FuaTipoAnexo2015,MaxCuposCitasAdelantadas,MaxCuposAdicionales,
MaxCuposCitasHoySIS,MaxCuposCitasAdelandatasSIS,usaNacimiento,emergenciaCorrelativo,NoUsaMensajeTexto)
values (
@IdProducto,@SVG,@Codigo,@Nombre,@IdEspecialidad,@IdTipoServicio,@soloTipoSexo,@maximaEdad,@codigoServicioSEM,@ubicacionSEM,@codigoServicioHIS,
@CostoCeroCE,@minimaEdad,@Triaje,@EsObservacionEmergencia,1,@UsaModuloNinoSano,@UsaModuloMaterno,@UsaGalenHos,@TipoEdad,@UsaFUA,
@codigoServicioSuSalud,@codigoServicioFUA,@FuaTipoAnexo2015,@MaxCuposCitasAdelantadas,@MaxCuposAdicionales,
@MaxCuposCitasHoySIS,@MaxCuposCitasAdelandatasSIS,@usaNacimiento,@emergenciaCorrelativo,@NoUsaMensajeTexto)
set @IdServicio = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaAgregar]
	@IdServicio [int],
	@idServicioAtencionSimultanea [int]
WITH EXECUTE AS CALLER
AS
insert   ServiciosAtenSimultanea  (IdServicio,idServicioAtencionSimultanea) values
                                                           (@IdServicio,@idServicioAtencionSimultanea)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaEliminar]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
delete from ServiciosAtenSimultanea where idServicio=@idServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaAgregar]
	@idCorrelativo [int],
	@idAtencion [int],
	@item [int],
	@idTipo [int],
	@idFuaCorrelativo [int],
	@idFuaIdCuentaAtencion [int],
	@FuaCodigoPrestacion [varchar](3)
WITH EXECUTE AS CALLER
AS
insert   ServiciosAtenSimultaneaFua  (AScorrelativo,idAtencion,item,idTipo,idFuaCorrelativo,idFuaIdCuentaAtencion,FuaCodigoPrestacion) values
                                                           (@idCorrelativo,@idAtencion,@item,@idTipo,@idFuaCorrelativo,@idFuaIdCuentaAtencion,@FuaCodigoPrestacion)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaEliminar]
	@idCorrelativo [int]
WITH EXECUTE AS CALLER
AS
delete  from   ServiciosAtenSimultaneaFua where   AScorrelativo=@idCorrelativo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaElimXatencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaElimXatencion]
	@idCorrelativo [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
delete  from   ServiciosAtenSimultaneaFua where   AScorrelativo=@idCorrelativo and idAtencion=@idatencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaElimXatencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFUAequivXups]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFUAequivXups]
	@ups [varchar](6)
WITH EXECUTE AS CALLER
AS
select * from ServiciosAtenSimultaneaFUAequiv where ups=@ups
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFUAequivXups] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaModificar]
	@idCorrelativo [int],
	@idFuaCorrelativo [int],
	@idFuaIdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
update ServiciosAtenSimultaneaFua set idFuaIdCuentaAtencion=@idFuaIdCuentaAtencion where  AScorrelativo=@idCorrelativo and idFuaCorrelativo=@idFuaCorrelativo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaSoloDx]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaSoloDx]
	@idCorrelativo [int],
	@conDistinct [int]
WITH EXECUTE AS CALLER
AS
if @conDistinct=1
	SELECT     distinct dbo.ServiciosAtenSimultaneaFua.idFuaCorrelativo as FUA, ltrim(dbo.Diagnosticos.CodigoCIE2004)+' '+ dbo.Diagnosticos.Descripcion as Diagnosticos,
	                  dbo.Diagnosticos.codigoCIEsinPto, dbo.ServiciosAtenSimultaneaFua.idFuaIdCuentaAtencion,dbo.ServiciosAtenSimultaneaFua.fuaCodigoPrestacion
	FROM         dbo.ServiciosAtenSimultaneaFua LEFT OUTER JOIN
	                      dbo.Diagnosticos ON dbo.ServiciosAtenSimultaneaFua.item = dbo.Diagnosticos.IdDiagnostico
	WHERE     (dbo.ServiciosAtenSimultaneaFua.idTipo = 3) and dbo.ServiciosAtenSimultaneaFua.AScorrelativo=@idCorrelativo
              ORDER BY dbo.ServiciosAtenSimultaneaFua.idFuaCorrelativo
else
	SELECT     dbo.ServiciosAtenSimultaneaFua.idFuaCorrelativo as FUA, ltrim(dbo.Diagnosticos.CodigoCIE2004)+' '+ dbo.Diagnosticos.Descripcion as Diagnosticos,
	                  dbo.Diagnosticos.codigoCIEsinPto, dbo.ServiciosAtenSimultaneaFua.idFuaIdCuentaAtencion,dbo.ServiciosAtenSimultaneaFua.fuaCodigoPrestacion
	FROM         dbo.ServiciosAtenSimultaneaFua LEFT OUTER JOIN
	                      dbo.Diagnosticos ON dbo.ServiciosAtenSimultaneaFua.item = dbo.Diagnosticos.IdDiagnostico
	WHERE     (dbo.ServiciosAtenSimultaneaFua.idTipo = 3) and dbo.ServiciosAtenSimultaneaFua.AScorrelativo=@idCorrelativo
	ORDER BY dbo.ServiciosAtenSimultaneaFua.idFuaCorrelativo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaSoloDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaXcorrelativo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaXcorrelativo]
	@idCorrelativo [int]
WITH EXECUTE AS CALLER
AS
select *  from   ServiciosAtenSimultaneaFua where   AScorrelativo=@idCorrelativo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaXcorrelativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaFuaXidatencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaFuaXidatencion]
	@idCorrelativo [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select *  from   ServiciosAtenSimultaneaFua where   AScorrelativo=@idCorrelativo and idatencion=@idatencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaFuaXidatencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaImpHISxUPS]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaImpHISxUPS]
	@ups [varchar](6)
WITH EXECUTE AS CALLER
AS
SELECT      ServiciosAtenSimultaneaImpHIS.*, TiposServiciosIntermedios.Tipo AS dtipo
FROM         ServiciosAtenSimultaneaImpHIS LEFT OUTER JOIN
                      TiposServiciosIntermedios ON ServiciosAtenSimultaneaImpHIS.idTipo = TiposServiciosIntermedios.idTipo
where ups=@ups
order by ServiciosAtenSimultaneaImpHIS.grupo,ServiciosAtenSimultaneaImpHIS.subGrupoOrden
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaImpHISxUPS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovAgregar]
	@idCorrelativo [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
insert   ServiciosAtenSimultaneaMov  (AScorrelativo,idAtencion) values
                                                           (@idCorrelativo,@idAtencion)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovCpt]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovCpt]
	@Correlativo [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactOrdenServicio.IdPuntoCarga, dbo.FactCatalogoServicios.IdProducto,  dbo.Servicios.Nombre AS Consultorio, dbo.FactCatalogoServicios.Codigo,
                   dbo.FactCatalogoServicios.Nombre,
                      dbo.FacturacionServicioDespacho.labConfHIS, dbo.FacturacionServicioDespacho.Cantidad, dbo.FacturacionServicioDespacho.Precio,
                      dbo.FacturacionServicioDespacho.Total,dbo.FactOrdenServicio.IdCuentaAtencion,
                      dbo.FactOrdenServicio.IdOrden,dbo.FactOrdenServicio.idServicioPaciente as idServicio,
                     dbo.FacturacionServicioDespacho.grupoHIS,dbo.FacturacionServicioDespacho.subGrupoHIS
FROM         dbo.Servicios INNER JOIN
                      dbo.Atenciones INNER JOIN
                      dbo.ServiciosAtenSimultaneaMov ON dbo.Atenciones.IdAtencion = dbo.ServiciosAtenSimultaneaMov.idAtencion INNER JOIN
                      dbo.FactOrdenServicio ON dbo.Atenciones.IdCuentaAtencion = dbo.FactOrdenServicio.IdCuentaAtencion ON
                      dbo.Servicios.IdServicio = dbo.Atenciones.IdServicioIngreso RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.FacturacionServicioDespacho ON dbo.FactCatalogoServicios.IdProducto = dbo.FacturacionServicioDespacho.IdProducto ON
                      dbo.FactOrdenServicio.IdOrden = dbo.FacturacionServicioDespacho.idOrden
Where (dbo.FactOrdenServicio.idPuntoCarga = 1) And (dbo.FactOrdenServicio.IdEstadoFacturacion <> 9)
                      and  dbo.ServiciosAtenSimultaneaMov.AScorrelativo=@Correlativo
                ORDER BY dbo.Servicios.Nombre,dbo.FactCatalogoServicios.Codigo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovCpt] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovEliminar]
	@idCorrelativo [int]
WITH EXECUTE AS CALLER
AS
delete  from   ServiciosAtenSimultaneaMov where   AScorrelativo=@idCorrelativo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovElimXatencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovElimXatencion]
	@idCorrelativo [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
delete  from   ServiciosAtenSimultaneaMov where   AScorrelativo=@idCorrelativo and idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovElimXatencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovUltimo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovUltimo]
WITH EXECUTE AS CALLER
AS
select top 1 AScorrelativo from    ServiciosAtenSimultaneaMov order by AScorrelativo desc
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovUltimo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovXcorrelativo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovXcorrelativo]
	@idCorrelativo [int],
	@OrdenadoPorConsultorio [int]
WITH EXECUTE AS CALLER
AS
if @OrdenadoPorConsultorio=1
	SELECT     dbo.Atenciones.IdServicioIngreso, dbo.ServiciosAtenSimultaneaMov.idAtencion, dbo.Atenciones.IdCuentaAtencion,
	                      dbo.Servicios.Nombre as Consultorio
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.ServiciosAtenSimultaneaMov ON dbo.Atenciones.IdAtencion = dbo.ServiciosAtenSimultaneaMov.idAtencion INNER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
	where   dbo.ServiciosAtenSimultaneaMov.AScorrelativo=@idCorrelativo
	ORDER BY  dbo.Servicios.Nombre
else
	SELECT     dbo.Atenciones.IdServicioIngreso, dbo.ServiciosAtenSimultaneaMov.idAtencion, dbo.Atenciones.IdCuentaAtencion,
	                      dbo.Servicios.Nombre as Consultorio
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.ServiciosAtenSimultaneaMov ON dbo.Atenciones.IdAtencion = dbo.ServiciosAtenSimultaneaMov.idAtencion INNER JOIN
	                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
	where   dbo.ServiciosAtenSimultaneaMov.AScorrelativo=@idCorrelativo
	ORDER BY dbo.Atenciones.IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovXcorrelativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovXcuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovXcuenta]
	@idCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
DECLARE @asCorrelativo INT;

	DECLARE VarCursorDesarrollo CURSOR FOR
	SELECT     dbo.ServiciosAtenSimultaneaMov.asCorrelativo
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.ServiciosAtenSimultaneaMov ON dbo.Atenciones.IdAtencion = dbo.ServiciosAtenSimultaneaMov.idAtencion
	where dbo.Atenciones.IdCuentaAtencion=@IdCuentaAtencion;

	OPEN VarCursorDesarrollo;
	FETCH NEXT FROM VarCursorDesarrollo INTO @asCorrelativo;
	CLOSE VarCursorDesarrollo
	DEALLOCATE VarCursorDesarrollo

	SELECT     dbo.ServiciosAtenSimultaneaMov.*, dbo.Atenciones.IdCuentaAtencion
	FROM         dbo.Atenciones INNER JOIN
	                      dbo.ServiciosAtenSimultaneaMov ON dbo.Atenciones.IdAtencion = dbo.ServiciosAtenSimultaneaMov.idAtencion
              where dbo.ServiciosAtenSimultaneaMov.asCorrelativo=@asCorrelativo;
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovXcuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaMovXidatencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaMovXidatencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from   ServiciosAtenSimultaneaMov where   idAtencion=@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaMovXidatencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaSeleccionarXConsultorio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaSeleccionarXConsultorio]
	@idServicioAtencionSimultanea [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ServiciosAtenSimultanea.*, dbo.Servicios.Nombre
FROM         dbo.ServiciosAtenSimultanea INNER JOIN
                      dbo.Servicios ON dbo.ServiciosAtenSimultanea.idServicio = dbo.Servicios.IdServicio
where dbo.ServiciosAtenSimultanea.idServicioAtencionSimultanea=@idServicioAtencionSimultanea
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaSeleccionarXConsultorio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosAtenSimultaneaSeleccionarXidServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosAtenSimultaneaSeleccionarXidServicio]
	@idServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.ServiciosAtenSimultanea.*, dbo.Servicios.Nombre
FROM         dbo.ServiciosAtenSimultanea INNER JOIN
                      dbo.Servicios ON dbo.ServiciosAtenSimultanea.idServicioAtencionSimultanea = dbo.Servicios.IdServicio
where dbo.ServiciosAtenSimultanea.idServicio=@idServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosAtenSimultaneaSeleccionarXidServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDevuelveEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosDevuelveEspecialidad]
	@lnIdServicio [int]
WITH EXECUTE AS CALLER
AS
select idEspecialidad from Servicios where idServicio=@lnIdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDevuelveEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDevuelveIdDepartamento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosDevuelveIdDepartamento]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Servicios.IdServicio, dbo.Especialidades.IdEspecialidad, dbo.Especialidades.IdDepartamento
             FROM         dbo.Especialidades RIGHT OUTER JOIN
                                dbo.Servicios ON dbo.Especialidades.IdEspecialidad = dbo.Servicios.IdEspecialidad
              WHERE     dbo.Servicios.IdServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDevuelveIdDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDondeEstuvoElPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosDondeEstuvoElPaciente]
	@idPaciente [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT AtencionesEstanciaHospitalaria.idEstanciaHospitalaria,  servicios.nombre as NombreServicio, AtencionesEstanciaHospitalaria.IdServicio, AtencionesEstanciaHospitalaria.FechaOcupacion, AtencionesEstanciaHospitalaria.HoraOcupacion, AtencionesEstanciaHospitalaria.FechaDesocupacion, AtencionesEstanciaHospitalaria.HoraDesocupacion, AtencionesEstanciaHospitalaria.IdCama
FROM atenciones, AtencionesEstanciaHospitalaria, Servicios
WHERE atenciones.idAtencion=AtencionesEstanciaHospitalaria.idAtencion AND atenciones.idPaciente=@idPaciente AND servicios.idServicio=AtencionesEstanciaHospitalaria.idServicio AND AtencionesEstanciaHospitalaria.idAtencion=@idAtencion
ORDER BY AtencionesEstanciaHospitalaria.idEstanciaHospitalaria DESC
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDondeEstuvoElPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDondeEstuvoElPacienteCE]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosDondeEstuvoElPacienteCE]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT    0 as idEstanciaHospitalaria ,dbo.Servicios.Nombre AS NombreServicio,
        dbo.Servicios.IdServicio,dbo.Atenciones.FechaIngreso  as FechaOcupacion,
        dbo.Atenciones.HoraIngreso  as HoraOcupacion ,dbo.Atenciones.FechaEgreso as FechaDesocupacion,
        dbo.Atenciones.HoraEgreso as horaDesocupacion, 0 as idCama
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio
where dbo.Atenciones.IdAtencion =@idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDondeEstuvoElPacienteCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDondeEstuvoElPacientePorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosDondeEstuvoElPacientePorId]
	@idPaciente [int],
	@idServicio [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT AtencionesEstanciaHospitalaria.idEstanciaHospitalaria, servicios.nombre as NombreServicio, AtencionesEstanciaHospitalaria.IdServicio, AtencionesEstanciaHospitalaria.FechaOcupacion, AtencionesEstanciaHospitalaria.HoraOcupacion, AtencionesEstanciaHospitalaria.FechaDesocupacion, AtencionesEstanciaHospitalaria.HoraDesocupacion, AtencionesEstanciaHospitalaria.IdCama
FROM atenciones, AtencionesEstanciaHospitalaria, Servicios
WHERE atenciones.idAtencion=AtencionesEstanciaHospitalaria.idAtencion AND atenciones.idPaciente=@idPaciente AND servicios.idServicio=AtencionesEstanciaHospitalaria.idServicio AND AtencionesEstanciaHospitalaria.idAtencion=@idAtencion AND AtencionesEstanciaHospitalaria.IdServicio=@idServicio
ORDER BY AtencionesEstanciaHospitalaria.idEstanciaHospitalaria DESC
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDondeEstuvoElPacientePorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosDondeSeAtendioElPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosDondeSeAtendioElPaciente]
	@idPaciente [int],
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT atenciones.idAtencion AS idEstanciaHospitalaria, servicios.nombre AS NombreServicio, atenciones.idServicioIngreso AS idServicio, atenciones.FechaIngreso AS FechaOcupacion, atenciones.HoraIngreso AS HoraOcupacion, atenciones.FechaEgreso AS FechaDesocupacion, atenciones.HoraEgreso AS HoraDesocupacion, atenciones.idCamaIngreso AS IdCama
FROM atenciones, servicios
WHERE atenciones.idPaciente=@idPaciente  AND servicios.idServicio=atenciones.idServicioIngreso AND atenciones.idAtencion=@idAtencion AND atenciones.idEstadoAtencion<>0
ORDER BY atenciones.idAtencion DESC
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosDondeSeAtendioElPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosEliminar]
	@IdServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Servicios
where IdServicio = @IdServicio
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdServicio,'Servicios'
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioSeUsanModulosPerinatalyMaterno]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioSeUsanModulosPerinatalyMaterno]
	@IdCita [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Servicios.*, dbo.Citas.IdCita
FROM         dbo.Citas LEFT OUTER JOIN
                     dbo.Servicios ON dbo.Citas.IdServicio = dbo.Servicios.IdServicio
WHERE dbo.Citas.IdCita=@IdCita
GO
ALTER AUTHORIZATION ON [dbo].[ServicioSeUsanModulosPerinatalyMaterno] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosFacturadosPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosFacturadosPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
/*	   SELECT        dbo.FactOrdenServicioPagos.idOrdenPago as idOrden,
                                      dbo.Atenciones.IdAtencion,  dbo.FacturacionServicioPagos.idProducto,
                                      dbo.FactOrdenServicioPagos.idEstadoFacturacion
                 FROM          dbo.FacturacionServicioPagos LEFT OUTER JOIN
                                      dbo.FactOrdenServicioPagos ON dbo.FacturacionServicioPagos.idOrdenPago = dbo.FactOrdenServicioPagos.idOrdenPago LEFT OUTER JOIN
                                      dbo.FactOrdenServicio LEFT OUTER JOIN
                                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion ON
                                      dbo.FactOrdenServicioPagos.IdOrden = dbo.FactOrdenServicio.IdOrden
                 WHERE       dbo.Atenciones.IdAtencion=@IdAtencion    */
SELECT      dbo.FactOrdenServicioPagos.idOrdenPago AS idOrden, dbo.Atenciones.IdAtencion, dbo.FacturacionServicioPagos.idProducto,
                      dbo.FactOrdenServicioPagos.IdEstadoFacturacion
FROM         dbo.FactOrdenServicio INNER JOIN
                      dbo.Atenciones ON dbo.FactOrdenServicio.IdCuentaAtencion = dbo.Atenciones.IdCuentaAtencion INNER JOIN
                      dbo.FactOrdenServicioPagos ON dbo.FactOrdenServicio.IdOrden = dbo.FactOrdenServicioPagos.idOrden INNER JOIN
                      dbo.FacturacionServicioPagos ON dbo.FactOrdenServicioPagos.idOrdenPago = dbo.FacturacionServicioPagos.idOrdenPago
WHERE       dbo.Atenciones.IdAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosFacturadosPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select Servicios.IdServicio, Servicios.Codigo, Servicios.Nombre, Especialidades.Nombre as Especialidad,Servicios.CodigoServicioHIS
                 from (Servicios
                 left Join Especialidades on Servicios.IdEspecialidad = Especialidades.IdEspecialidad)
                 left Join DepartamentosHospital on Especialidades.IdDepartamento = DepartamentosHospital.IdDepartamento    '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosFiltrarDepartamentoHosp]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosFiltrarDepartamentoHosp]
	@lIdServicio [int]
WITH EXECUTE AS CALLER
AS
select Especialidades.IdDepartamento from Servicios
            left join Especialidades on Servicios.IdEspecialidad =  Especialidades.IdEspecialidad
            where Servicios.IdServicio =@lIdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosFiltrarDepartamentoHosp] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosFiltrarPorIdArchiveroTipoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosFiltrarPorIdArchiveroTipoServicio]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

/*   SET  @SQL =  'SELECT    dbo.Servicios.IdServicio, dbo.Servicios.Codigo + " - " + LTRIM(dbo.Servicios.Nombre) + "  (" + LTRIM(dbo.Especialidades.Nombre)
                      + ")  ( " + LTRIM(dbo.TiposServicio.Descripcion) + ")" AS DescripcionLarga, dbo.Especialidades.Nombre AS dEspecialidad,
                      dbo.TiposServicio.Descripcion AS dTipoServicio
             FROM         dbo.TiposServicio RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio LEFT OUTER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad RIGHT OUTER JOIN
                      dbo.ArchiveroServicio ON dbo.Servicios.IdServicio = dbo.ArchiveroServicio.IdServicio   '+@lcFiltro   */


   SET  @SQL =  'SELECT  distinct   dbo.Servicios.Nombre, dbo.Servicios.IdServicio, dbo.Servicios.Codigo + " - " + LTRIM(dbo.Servicios.Nombre) + "  (" + LTRIM(dbo.Especialidades.Nombre)
                      + ")  ( " + LTRIM(dbo.TiposServicio.Descripcion) + ")" AS DescripcionLarga, dbo.Especialidades.Nombre AS dEspecialidad,
                      dbo.TiposServicio.Descripcion AS dTipoServicio
             FROM         dbo.TiposServicio RIGHT OUTER JOIN
                      dbo.Servicios ON dbo.TiposServicio.IdTipoServicio = dbo.Servicios.IdTipoServicio LEFT OUTER JOIN
                      dbo.Especialidades ON dbo.Servicios.IdEspecialidad = dbo.Especialidades.IdEspecialidad RIGHT OUTER JOIN
                      dbo.ArchiveroServicio ON dbo.Servicios.IdServicio = dbo.ArchiveroServicio.IdServicio   '+@lcFiltro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosFiltrarPorIdArchiveroTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosModificar]
	@IdProducto [int],
	@SVG [varchar](8000),
	@Codigo [varchar](6),
	@IdServicio [int],
	@Nombre [varchar](50),
	@IdEspecialidad [int],
	@IdTipoServicio [int],
	@soloTipoSexo [int],
	@maximaEdad [int],
	@codigoServicioSEM [varchar](10),
	@ubicacionSEM [varchar](5),
	@codigoServicioHIS [varchar](6),
	@CostoCeroCE [varchar](1),
	@minimaEdad [int],
	@idEstado [int],
	@Triaje [bit],
	@EsObservacionEmergencia [bit],
	@UsaModuloNinoSano [bit],
	@UsaModuloMaterno [bit],
	@UsaGalenHos [bit],
	@TipoEdad [int],
	@UsaFUA [bit],
	@codigoServicioSuSalud [varchar](7),
	@codigoServicioFUA [varchar](6),
	@FuaTipoAnexo2015 [int],
	@MaxCuposCitasAdelantadas [int],
	@MaxCuposAdicionales [int],
	@MaxCuposCitasHoySIS [int],
	@MaxCuposCitasAdelandatasSIS [int],
	@usaNacimiento [int],
	@emergenciaCorrelativo [varchar](10),
	@NoUsaMensajeTexto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Servicios
set
IdProducto = @IdProducto,
SVG = @SVG,
Codigo = @Codigo,
Nombre = @Nombre,
IdEspecialidad = @IdEspecialidad,
IdTipoServicio = @IdTipoServicio,
soloTipoSexo=@soloTipoSexo,
maximaEdad=@maximaEdad ,
codigoServicioSEM=@codigoServicioSEM,
ubicacionSEM=@ubicacionSEM,
codigoServicioHIS=@codigoServicioHIS,
CostoCeroCE=@CostoCeroCE,
minimaEdad=@minimaEdad,
idEstado=@idEstado,
Triaje=@Triaje,
EsObservacionEmergencia=@EsObservacionEmergencia,
UsaModuloNinoSano=@UsaModuloNinoSano,
UsaModuloMaterno=@UsaModuloMaterno,
UsaGalenHos=@UsaGalenHos,
TipoEdad=@TipoEdad,
UsaFUA=@UsaFUA,
codigoServicioSuSalud=@codigoServicioSuSalud,
codigoServicioFUA=@codigoServicioFUA ,
FuaTipoAnexo2015=@FuaTipoAnexo2015,
MaxCuposCitasAdelantadas=@MaxCuposCitasAdelantadas,
MaxCuposAdicionales=@MaxCuposAdicionales,
MaxCuposCitasHoySIS=@MaxCuposCitasHoySIS,
MaxCuposCitasAdelandatasSIS=@MaxCuposCitasAdelandatasSIS,
usaNacimiento=@usaNacimiento,
emergenciaCorrelativo=@emergenciaCorrelativo ,
NoUsaMensajeTexto=@NoUsaMensajeTexto
where IdServicio = @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosObtenerIdDepartamento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosObtenerIdDepartamento]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select Especialidades.IdDepartamento from Servicios
left join Especialidades on Servicios.IdEspecialidad =  Especialidades.IdEspecialidad
where Servicios.IdServicio = @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosObtenerIdDepartamento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarCEDisponiblesXFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarCEDisponiblesXFecha]
	@IdEspecialidad [int],
	@HoraInicio [char](5),
	@HoraFin [char](5),
	@Fecha [date]
WITH EXECUTE AS CALLER
AS
--Tabla

set @HoraInicio=convert(numeric(5,2),REPLACE(@HoraInicio,':','.'))

set @HoraFin=convert(numeric(5,2),REPLACE(@HoraFin,':','.'))

select CE.IdServicio, Codigo + ' = ' +lTRIM(nombre)+ ' ('+ltrim(str(isnull(codigoServicioHIS,0)))+')' as DescripcionLarga,Nombre,idEstado
from Servicios CE
left join (select  * from ProgramacionMedica
where IdTipoServicio=1 and Fecha =@Fecha
and IdEspecialidad=@IdEspecialidad
and ((@HoraInicio>=convert(numeric(5,2),REPLACE(HoraInicio,':','.')) and @HoraInicio<=convert(numeric(5,2),REPLACE(HoraFin,':','.')))
		or(@HoraFin>=convert(numeric(5,2),REPLACE(HoraInicio,':','.')) and @HoraFin <=convert(numeric(5,2),REPLACE(HoraFin,':','.'))))
) PR on CE.IdServicio=PR.IdServicio
where
PR.IdServicio is null
and
 CE.IdTipoServicio = 1 --SERVICIOS EN CONSULTORIO EXTERNO
AND CE.IdEspecialidad=@IdEspecialidad
and CE.idEstado=1--Activos
order by Nombre
--SCCQ 20/02/2020 Cambio7 Fin

GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarCEDisponiblesXFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarCEPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarCEPorEspecialidad]
	@Especialidad [int]
WITH EXECUTE AS CALLER
AS
select idServicio,codigo+' = '+nombre  as DescripcionLarga from Servicios
             where IdTipoServicio=1 and idEspecialidad = @Especialidad
             order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarCEPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarConsultoriosPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarConsultoriosPorEspecialidad]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select IdServicio, Nombre,  ltrim(str(codigoServicioHIs)) + ' = '  + Nombre as DescripcionLarga,idEstado,UsaGalenHos,UsaFua,NoUsaMensajeTexto,CostoCeroCE  from Servicios
where IdTipoServicio in (1,5,6,7)
and IdEspecialidad = @IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarConsultoriosPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarEmergenciaPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarEmergenciaPorEspecialidad]
	@Especialidad [int]
WITH EXECUTE AS CALLER
AS
select idServicio,codigo+' = '+nombre  as DescripcionLarga from Servicios
             where IdTipoServicio in (2,4) and idEspecialidad = @Especialidad
             order by nombre
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarEmergenciaPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarIdTipoServicio2y3]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarIdTipoServicio2y3]
WITH EXECUTE AS CALLER
AS
SELECT * from Servicios where idTipoServicio in (2,3)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarIdTipoServicio2y3] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarJerarquia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarJerarquia]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select
DepartamentosHospital.IDDepartamento, DepartamentosHospital.Nombre,
Especialidades.IdEspecialidad, Especialidades.Nombre ,
Servicios.IdServicio, Servicios.Nombre
from
(DepartamentosHospital inner join Especialidades on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento)
inner join Servicios on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
where IdTipoServicio = @IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarJerarquia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorFiltro]
	@Filtro [varchar](50),
	@OrdenadoPor [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
IF @FILTRO = ' '
	SET  @SQL =  'select * from Servicios ' + @OrdenadoPor
ELSE
	SET  @SQL = 'select * from Servicios where ' + ' ' + @Filtro + ' ' +  @OrdenadoPor

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorId]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from Servicios
where IdServicio = @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorTipo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorTipo]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select Servicios.IdServicio, Servicios.Codigo , Servicios.Nombre as Servicio,
Especialidades.Nombre  as Especialidad,
DepartamentosHospital.Nombre as Departamento,
Servicios.soloTipoSexo,Servicios.maximaEdad,Servicios.codigoServicioSEM,Servicios.ubicacionSEM,Servicios.codigoServicioHIS
from
(Servicios
left join Especialidades on Servicios.IdEspecialidad = Especialidades.IdEspecialidad)
left join DepartamentosHospital on Especialidades.IdDepartamento  = DepartamentosHospital.IdDepartamento
where IdTipoServicio = @IdTipoServicio
order by  Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorTipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorTipoServicioDptoEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorTipoServicioDptoEspecialidad]
	@IdTipoServicio [int],
	@IdDepartamento [int],
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
select
Servicios.IdServicio, Servicios.Nombre, Servicios.Codigo + ' = ' + Servicios.Nombre as DescripcionLarga
from
(DepartamentosHospital inner join Especialidades on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento)
inner join Servicios on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
where IdTipoServicio = @IdTipoServicio
and DepartamentosHospital.IdDepartamento = @IdDepartamento
and Especialidades.IdEspecialidad = @IdEspecialidad
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorTipoServicioDptoEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorTipoServicioYDpto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorTipoServicioYDpto]
	@IdTipoServicio [int],
	@IdDepartamento [int]
WITH EXECUTE AS CALLER
AS
select
Servicios.IdServicio, Servicios.Nombre, Servicios.Codigo + ' = ' + Servicios.Nombre as DescripcionLarga
from
(DepartamentosHospital inner join Especialidades on DepartamentosHospital.IdDepartamento = Especialidades.IdDepartamento)
inner join Servicios on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
where IdTipoServicio = @IdTipoServicio
and DepartamentosHospital.IdDepartamento = @IdDepartamento
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorTipoServicioYDpto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorTipoV2]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorTipoV2]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select Servicios.IdServicio, Servicios.Codigo + ' = ' +lTRIM(nombre)+ ' ('+ltrim(str(isnull(servicios.codigoServicioHIS,0)))+')' as DescripcionLarga,Servicios.Nombre,servicios.idEstado
from Servicios
where IdTipoServicio = @IdTipoServicio
order by Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorTipoV2] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarPorTipoV2debb]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarPorTipoV2debb]
	@idTipoServicio [int],
	@Filtro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)
if @Filtro<>''
		SET  @SQL = 'select Servicios.IdServicio,
					Servicios.Codigo + '' = '' + Servicios.Nombre as DescripcionLarga,
					idEstado,EsObservacionEmergencia
					From Servicios
					where IdTipoServicio =' + convert(varchar(10),@idTipoServicio) +
					' and ' + @Filtro
else
		SET  @SQL = 'select Servicios.IdServicio,
					Servicios.Codigo + '' = '' + Servicios.Nombre as DescripcionLarga,
					idEstado,EsObservacionEmergencia
					From Servicios
					where IdTipoServicio =' + convert(varchar(10),@idTipoServicio)


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarPorTipoV2debb] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarSoloCE]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarSoloCE]
WITH EXECUTE AS CALLER
AS
SELECT     idServicio,Nombre,idEspecialidad,soloTipoSexo,minimaEdad,maximaEdad,idEstado
FROM         Servicios where idtiposervicio=1
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarSoloCE] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSeleccionarXidentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSeleccionarXidentificador]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select * from Servicios where idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSeleccionarXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosSoloEmergenciaHospitalizacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosSoloEmergenciaHospitalizacion]
WITH EXECUTE AS CALLER
AS
SELECT * from Servicios where idTipoServicio in (2,3)
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosSoloEmergenciaHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosXcodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosXcodigo]
	@codigo [varchar](6)
WITH EXECUTE AS CALLER
AS
select *  from Servicios where Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosXcodigoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[ServiciosXcodigoServicio]
	@codigo [varchar](6),
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select Servicios.IdServicio, Servicios.Nombre, Especialidades.Nombre as Especialidad,SERVICIOS.Codigo
     From Servicios
     left join Especialidades on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
     where Servicios.codigo = @codigo
     and Servicios.IdServicio <> @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosXcodigoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosXEspecialidadYtipoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosXEspecialidadYtipoServicio]
	@IdEspecialidad [int],
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select idServicio,Nombre as DescripcionLarga from Servicios where idEstado=1 and idEspecialidad=@IdEspecialidad and idTipoServicio=@IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosXEspecialidadYtipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosXidEmpleado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosXidEmpleado]
	@lIdEmpleado [int]
WITH EXECUTE AS CALLER
AS
If @lIdEmpleado > 0
          select Servicios.IdServicio, Servicios.Codigo + ' - ' + Servicios.Nombre as DescripcionLarga
            from ArchiveroServicio left join Servicios on ArchiveroServicio.IdServicio = Servicios.IdServicio
           Where ArchiveroServicio.IdEmpleado = @lIdEmpleado
           order by Servicios.Nombre
else
            select Servicios.IdServicio, Servicios.Codigo + ' - ' + Servicios.Nombre as DescripcionLarga
            from ArchiveroServicio left join Servicios on ArchiveroServicio.IdServicio = Servicios.IdServicio
           order by Servicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServiciosXnombreIdServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServiciosXnombreIdServicio]
	@Nombre [varchar](50),
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select Servicios.IdServicio, Servicios.Codigo, Especialidades.Nombre as Especialidad
     From Servicios
     left join Especialidades on Servicios.IdEspecialidad = Especialidades.IdEspecialidad
     where Servicios.nombre = @Nombre
     and Servicios.IdServicio <> @IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServiciosXnombreIdServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ServicioUsaGalenHos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ServicioUsaGalenHos]
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
select UsaGalenHos from Servicios where idServicio=@IdServicio
GO
ALTER AUTHORIZATION ON [dbo].[ServicioUsaGalenHos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[siCitasActualizaDatos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[siCitasActualizaDatos]
	@Paciente [varchar](100),
	@telefono [varchar](10),
	@direccion [varchar](100)
WITH EXECUTE AS CALLER
AS
if @telefono<>''
   update SiCitas set telefono =@telefono where Paciente =@Paciente
if @direccion <>''
   update SiCitas set direccion =@direccion  where Paciente =@Paciente
GO
ALTER AUTHORIZATION ON [dbo].[siCitasActualizaDatos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasAgregar]
	@idCitaSI [int] OUTPUT,
	@idPuntoCarga [int],
	@Fecha [datetime],
	@horaInicio [varchar](5),
	@HoraFinal [varchar](5),
	@idCuentaAtencion [int],
	@idComprobantePago [int],
	@Paciente [varchar](100),
	@idTipoSexo [int],
	@FechaNacimiento [datetime],
	@idPaciente [int],
	@idMedico [int],
	@idMovimiento [int],
	@idUsuario [int],
	@FechaCreacion [datetime],
	@idEstado [int],
	@idReceta [int],
	@idSala [int],
	@llaveTicket [varchar](20),
	@cupo [int],
	@telefono [varchar](10),
	@direccion [varchar](100),
	@idProgramacion [int],
	@idResponsable [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into SiCitas (
idPuntoCarga,Fecha,horaInicio,HoraFinal,idCuentaAtencion,idComprobantePago,Paciente,idTipoSexo,FechaNacimiento,idPaciente,
idMedico,idMovimiento,idUsuario,FechaCreacion,idEstado,idReceta,idSala,llaveTicket,cupo,telefono,direccion,idProgramacion,idResponsable) values
 (
@idPuntoCarga,@Fecha,@horaInicio,@HoraFinal,@idCuentaAtencion,@idComprobantePago,@Paciente,@idTipoSexo,@FechaNacimiento,@idPaciente,
@idMedico,@idMovimiento,@idUsuario,@FechaCreacion,@idEstado,@idReceta,@idSala,@llaveTicket,@cupo,@telefono,@direccion,@idProgramacion,@idResponsable)

set @idCitaSI = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasDetalleActualizaLlave]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasDetalleActualizaLlave]
	@llaveTicket [varchar](20),
	@idCitaSi [int]
WITH EXECUTE AS CALLER
AS
update SiCitasDetalle set llaveTicket =@llaveTicket where idCitaSI=@idcitaSi
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalleActualizaLlave] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasDetalleAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasDetalleAgregar]
	@idCitaSI [int],
	@idProductoCpt [int],
	@cantidad [int],
	@precio [money],
	@observaciones [varchar](200),
	@llaveTicket [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into SiCitasDetalle (
idCitaSI,idProductoCpt,cantidad,precio,observaciones,llaveTicket)
values (
@idCitaSI,@idProductoCpt,@cantidad,@precio,@observaciones,@llaveTicket)
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalleAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasDetalleEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasDetalleEliminar]
	@idCitaSI [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from SiCitasDetalle
where idCitaSI = @idCitaSI
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalleEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasDetalleSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasDetalleSeleccionarPorId]
	@idCitaSI [int]
WITH EXECUTE AS CALLER
AS
select * from SiCitasDetalle
where idCitaSI = @idCitaSI
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalleSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasDetalleSeleccionarPorLlaveTicket]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasDetalleSeleccionarPorLlaveTicket]
	@llaveTicket [varchar](20)
WITH EXECUTE AS CALLER
AS
SELECT DISTINCT
                      dbo.SiCitasDetalle.idProductoCpt, dbo.SiCitasDetalle.cantidad, dbo.SiCitasDetalle.observaciones,
                      dbo.FactCatalogoServicios.Codigo + ' ' + dbo.FactCatalogoServicios.Nombre AS item,
                      dbo.FactPuntosCarga.Descripcion AS PuntoCarga,dbo.SiCitasDetalle.idCitaSI

FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
                      dbo.SiCitas ON dbo.FactPuntosCarga.IdPuntoCarga = dbo.SiCitas.idPuntoCarga RIGHT OUTER JOIN
                      dbo.FactCatalogoServicios RIGHT OUTER JOIN
                      dbo.SiCitasDetalle ON dbo.FactCatalogoServicios.IdProducto = dbo.SiCitasDetalle.idProductoCpt ON
                      dbo.SiCitas.llaveTicket = dbo.SiCitasDetalle.llaveTicket
where dbo.SiCitas.llaveTicket=@llaveTicket
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasDetalleSeleccionarPorLlaveTicket] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasEliminar]
	@idCitaSI [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from SiCitas
 where idCitaSI = @idCitaSI
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasFiltroPorPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasFiltroPorPaciente]
	@filtro [varchar](100)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.SiCitas.Paciente, dbo.SiCitas.Fecha, dbo.SiCitas.horaInicio, dbo.SiCitas.idCitaSI AS Ncita, dbo.FactPuntosCarga.Descripcion AS puntoCarga
FROM         dbo.SiCitas LEFT OUTER JOIN
                      dbo.FactPuntosCarga ON dbo.SiCitas.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga
where dbo.SiCitas.Paciente like @filtro+'%' order by dbo.SiCitas.Paciente , dbo.SiCitas.Fecha desc
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasFiltroPorPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasModificar]
	@idCitaSI [int],
	@idPuntoCarga [int],
	@Fecha [datetime],
	@horaInicio [varchar](5),
	@HoraFinal [varchar](5),
	@idCuentaAtencion [int],
	@idComprobantePago [int],
	@Paciente [varchar](100),
	@idTipoSexo [int],
	@FechaNacimiento [datetime],
	@idPaciente [int],
	@idMedico [int],
	@idMovimiento [int],
	@idUsuario [int],
	@FechaCreacion [datetime],
	@idEstado [int],
	@idReceta [int],
	@idSala [int],
	@llaveTicket [varchar](20),
	@cupo [int],
	@telefono [varchar](10),
	@direccion [varchar](100),
	@idProgramacion [int],
	@idResponsable [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update SiCitas
set
idPuntoCarga = @idPuntoCarga,
Fecha = @Fecha,
horaInicio = @horaInicio,
HoraFinal = @HoraFinal,
idCuentaAtencion = @idCuentaAtencion,
idComprobantePago = @idComprobantePago,

Paciente = @Paciente,
idTipoSexo = @idTipoSexo,
FechaNacimiento = @FechaNacimiento,
idPaciente = @idPaciente,
idMedico = @idMedico,
idMovimiento = @idMovimiento,
idUsuario = @idUsuario,

FechaCreacion = @FechaCreacion,
idEstado = @idEstado,
idReceta=@idReceta,idSala=@idSala ,llaveTicket=@llaveTicket ,cupo=@cupo , telefono=@telefono,direccion=@direccion,
idProgramacion=@idProgramacion, idResponsable=@idResponsable

 where idCitaSI = @idCitaSI
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasPorDia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasPorDia]
	@fechaCita [datetime],
	@idSala [int]
WITH EXECUTE AS CALLER
AS
SELECT * from dbo.SiCitas
where  dbo.SiCitas.Fecha =CONVERT(datetime,@fechaCita,103) and dbo.SiCitas.idSala =@idSala
order by dbo.SiCitas.horaInicio  desc
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasPorDia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasPorGrupoYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasPorGrupoYMes]
	@idSala [int],
	@mes [int],
	@anio [int]
WITH EXECUTE AS CALLER
AS
select * from SiCitas where idSala =@idSala and YEAR(Fecha)=@anio and MONTH(fecha)=@mes
order by fecha
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasPorGrupoYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasResumenPorDia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasResumenPorDia]
	@fechaCita [datetime],
	@idSala [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.Codigo,dbo.FactCatalogoServicios.Nombre, count(dbo.SiCitasDetalle.cantidad) as Cant
FROM         dbo.SiCitas RIGHT OUTER JOIN
                      dbo.SiCitasDetalle ON dbo.SiCitas.idCitaSI = dbo.SiCitasDetalle.idCitaSI LEFT OUTER JOIN
                      dbo.FactCatalogoServicios ON dbo.SiCitasDetalle.idProductoCpt = dbo.FactCatalogoServicios.IdProducto
where dbo.SiCitas.Fecha =CONVERT(datetime,@fechaCita,103) and dbo.SiCitas.idSala =@idSala
GROUP BY   dbo.FactCatalogoServicios.Codigo  ,dbo.FactCatalogoServicios.Nombre

drop procedure SiCitasDetallePorIdentificador
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasResumenPorDia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasSalasSeleccionarTodas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasSalasSeleccionarTodas]
WITH EXECUTE AS CALLER
AS
select * from SiCitasSalas order by sala
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSalasSeleccionarTodas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasSeleccionarPorId]
	@idCitaSI [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.SiCitas.*, dbo.FactPuntosCarga.Descripcion AS puntoCarga
FROM         dbo.SiCitas LEFT OUTER JOIN
                      dbo.FactPuntosCarga ON dbo.SiCitas.idPuntoCarga = dbo.FactPuntosCarga.IdPuntoCarga

where dbo.SiCitas.idCitaSI = @idCitaSI
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasSeleccionarPorIdMovimiento]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasSeleccionarPorIdMovimiento]
	@idMovimiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     * from siCitas
where idMovimiento = @idMovimiento
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSeleccionarPorIdMovimiento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasSeleccionarPorIdPuntoCArgaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasSeleccionarPorIdPuntoCArgaYFecha]
	@idPuntoCarga [int],
	@fechaCita [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FactPuntosCarga.NroCupos, dbo.FactPuntosCarga.NroCuposMinutos, dbo.FactPuntosCarga.HoraInicioDiaCita, dbo.SiCitas.Fecha,
                      dbo.SiCitas.horaInicio
FROM         dbo.FactPuntosCarga RIGHT OUTER JOIN
                      dbo.SiCitas ON dbo.FactPuntosCarga.IdPuntoCarga = dbo.SiCitas.idPuntoCarga
where dbo.SiCitas.idPuntoCarga =@idPuntoCarga and dbo.SiCitas.Fecha =CONVERT(datetime,@fechaCita,103)
order by dbo.SiCitas.horaInicio desc
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSeleccionarPorIdPuntoCArgaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[siCitasSeleccionarPorllaveTicket]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[siCitasSeleccionarPorllaveTicket]
	@llaveTicket [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from SiCitas WHERE     dbo.SiCitas.llaveTicket = @llaveTicket
GO
ALTER AUTHORIZATION ON [dbo].[siCitasSeleccionarPorllaveTicket] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiCitasSeleccionarPorSalaYFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiCitasSeleccionarPorSalaYFecha]
	@idSala [int],
	@fechaCita [datetime]
WITH EXECUTE AS CALLER
AS
select * from SiCitas where idSala =@idSala and  Fecha =@fechaCita
GO
ALTER AUTHORIZATION ON [dbo].[SiCitasSeleccionarPorSalaYFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[siCitasXidprogramacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[siCitasXidprogramacion]
	@idProgramacion [int]
WITH EXECUTE AS CALLER
AS
select * from SiCitas where idprogramacion=@idProgramacion order by horaInicio desc
GO
ALTER AUTHORIZATION ON [dbo].[siCitasXidprogramacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiFechasNoLaborablesAgregaFeriado]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiFechasNoLaborablesAgregaFeriado]
	@idSala [int],
	@feriado [datetime]
WITH EXECUTE AS CALLER
AS
INSERT SiFechasNoLaborables (idSala, fechaNoLaborable) VALUES (@idSala, @feriado)
GO
ALTER AUTHORIZATION ON [dbo].[SiFechasNoLaborablesAgregaFeriado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiFechasNoLaborablesEliminaXmesAnio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiFechasNoLaborablesEliminaXmesAnio]
	@idSala [int],
	@mes [int],
	@anio [int]
WITH EXECUTE AS CALLER
AS
delete from SiFechasNoLaborables where idsala=@idSala
       and MONTH(fechaNoLaborable)=@mes and YEAR(fechaNoLaborable)=@anio
GO
ALTER AUTHORIZATION ON [dbo].[SiFechasNoLaborablesEliminaXmesAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiFechasNoLaborablesXmesAnio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiFechasNoLaborablesXmesAnio]
	@idSala [int],
	@mes [int],
	@anio [int]
WITH EXECUTE AS CALLER
AS
select * from SiFechasNoLaborables where idsala=@idSala
       and MONTH(fechaNoLaborable)=@mes and YEAR(fechaNoLaborable)=@anio
GO
ALTER AUTHORIZATION ON [dbo].[SiFechasNoLaborablesXmesAnio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sighWebActualizaDatosEESSrenaes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sighWebActualizaDatosEESSrenaes]
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
begin
    set nocount on
    create table #myTempTable1(fecha datetime,cantidad int,codigo varchar(50))

    create table #myTempTable2(fecha datetime,importe money,codigo varchar(50))


    create table #myTempTable(citasCEsis int,citasCEpart int,citasCEsoat int,citasCEotros int,
          IngresosEMERsis int, IngresosEMERpart int, IngresosEMERsoat int,IngresosEMERotros int,
          IngresosHOSPsis int, IngresosHOSPpart int, IngresosHOSPsoat int,IngresosHOSPotros int,
          atencionesCEsis int, atencionesCEpat int, atencionesCEsoat int,atencionesCEotros int,
          atencionesEMERsis int, atencionesEMERpat int, atencionesEMERsoat int,atencionesEMERotros int,
          atencionesHOSPsis int, atencionesHOSPpat int, atencionesHOSPsoat int,atencionesHOSPotros int,
          CajaTotal money)

    declare @fecha2 datetime
	select @fecha2=@fecha+1
    insert into #myTempTable2(fecha,importe ,codigo)
	select convert(varchar(10),FechaCobranza,103) ,sum(Total ),'CajaTotal'  from CajaComprobantesPago where IdEstadoComprobante  <>9 and
          FechaCobranza>=@fecha and FechaCobranza<@fecha2
                                     group by convert(varchar(10),FechaCobranza ,103)

   insert into #myTempTable2(fecha,importe ,codigo)
	select convert(varchar(10),FechaPagado,103) ,sum(Total ),'NcTotal'  from NotaCreditoDebito where IdEstadoNota =3 and
          FechaPagado>=@fecha and FechaPagado<@fecha2
                                     group by convert(varchar(10),FechaPagado ,103)



	insert into #myTempTable1(fecha,cantidad,codigo)
	                   select fechaIngreso,COUNT(idatencion),'citasCEsis'  from Atenciones where IdFormaPago =2 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

    insert into #myTempTable1(fecha,cantidad,codigo)
                       select fechaIngreso,COUNT(idatencion),'citasCEpart'  from Atenciones where IdFormaPago =1 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		               select FechaIngreso,COUNT(idatencion),'citasCEsoat' from Atenciones where IdFormaPago =3 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		               select fechaIngreso,COUNT(idatencion),'citasCEotros'  from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso



	insert into #myTempTable1(fecha,cantidad,codigo)
		                select fechaIngreso,COUNT(idatencion),'IngresosEMERsis'  from Atenciones where IdFormaPago =2 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
			   select fechaIngreso,COUNT(idatencion),'IngresosEMERpart'  from Atenciones where IdFormaPago =1 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
	                   select fechaIngreso,COUNT(idatencion),'IngresosEMERsoat'  from Atenciones where IdFormaPago =3 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
	                     select fechaIngreso,COUNT(idatencion),'IngresosEMERotros'  from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso



	insert into #myTempTable1(fecha,cantidad,codigo)
			   select fechaIngreso,COUNT(idatencion),'IngresosHOSPsis'  from Atenciones where IdFormaPago =2 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		               select fechaIngreso,COUNT(idatencion),'IngresosHOSPpart'  from Atenciones where IdFormaPago =1 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		               select fechaIngreso,COUNT(idatencion),'IngresosHOSPsoat'  from Atenciones where IdFormaPago =3 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                 select fechaIngreso,COUNT(idatencion),'IngresosHOSPotros'  from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by FechaIngreso




	insert into #myTempTable1(fecha,cantidad,codigo)
		                   select fechaIngreso,COUNT(idatencion),'atencionesCEsis'  from Atenciones where IdFormaPago =2 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0 and
									 not(fechaEgreso is null)
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                 select fechaIngreso,COUNT(idatencion),'atencionesCEpat'  from Atenciones where IdFormaPago =1 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0 and
									 not(fechaEgreso is null)
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		               select fechaIngreso,COUNT(idatencion),'atencionesCEsoat'  from Atenciones where IdFormaPago =3 and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0 and
									 not(fechaEgreso is null)
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaIngreso,COUNT(idatencion),'atencionesCEotros'  from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaingreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =1 and
									 idEstadoAtencion<>0 and
									 not(fechaEgreso is null)
                                     group by FechaIngreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesEMERsis'  from Atenciones where IdFormaPago =2 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesEMERpat'  from Atenciones where IdFormaPago =1 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesEMERsoat'  from Atenciones where IdFormaPago =3 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesEMERotros' from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =2 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso




	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesHOSPsis' from Atenciones where IdFormaPago =2 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                select  fechaEgreso,COUNT(idatencion),'atencionesHOSPpat'  from Atenciones where IdFormaPago =1 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                  select fechaEgreso,COUNT(idatencion),'atencionesHOSPsoat' from Atenciones where IdFormaPago =3 and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso

	insert into #myTempTable1(fecha,cantidad,codigo)
		                  select fechaEgreso,COUNT(idatencion),'atencionesHOSPotros' from Atenciones where not(IdFormaPago in (1,2,3)) and
		                             fechaEgreso=CONVERT(DATETIME,@fecha ,103) and
									 IdTipoServicio =3 and
									 idEstadoAtencion<>0
                                     group by fechaEgreso


   insert into #myTempTable
         (citasCEsis,
          citasCEpart,
		  citasCEsoat,
		  citasCEotros,
          IngresosEMERsis,
		  IngresosEMERpart,
		   IngresosEMERsoat,
		   IngresosEMERotros,
          IngresosHOSPsis,
		   IngresosHOSPpart,
		    IngresosHOSPsoat,
			IngresosHOSPotros,
          atencionesCEsis,
		  atencionesCEpat ,
		   atencionesCEsoat ,
		   atencionesCEotros ,
          atencionesEMERsis ,
		   atencionesEMERpat,
		   atencionesEMERsoat ,
		   atencionesEMERotros,
          atencionesHOSPsis ,
		   atencionesHOSPpat ,
		   atencionesHOSPsoat,
		   atencionesHOSPotros ) values
          (0,
          0,
		 0,
		  0,
          0,
		  0,
		   0,
		   0,
          0,
		   0,
		    0,
			0,
          0,
		  0,
		   0,
		   0,
          0,
		   0,
		   0,
		   0,
          0,
		   0,
		   0,
		   0)


   update #myTempTable set citasCEsis =isnull((select cantidad from #myTempTable1 where codigo='citasCEsis'),0)
   update #myTempTable set citasCEpart  =isnull((select cantidad from #myTempTable1 where codigo='citasCEpart'),0)
   update #myTempTable set citasCEsoat   =isnull((select cantidad from #myTempTable1 where codigo='citasCEsoat'),0)
   update #myTempTable set citasCEotros   =isnull((select cantidad from #myTempTable1 where codigo='citasCEotros'),0)

   update #myTempTable set IngresosEMERsis  =isnull((select cantidad from #myTempTable1 where codigo='IngresosEMERsis'),0)
   update #myTempTable set IngresosEMERpart  =isnull((select cantidad from #myTempTable1 where codigo='IngresosEMERpart'),0)
   update #myTempTable set IngresosEMERsoat    =isnull((select cantidad from #myTempTable1 where codigo='IngresosEMERsoat'),0)
   update #myTempTable set IngresosEMERotros    =isnull((select cantidad from #myTempTable1 where codigo='IngresosEMERotros'),0)

   update #myTempTable set IngresosHOSPsis   =isnull((select cantidad from #myTempTable1 where codigo='IngresosHOSPsis'),0)
   update #myTempTable set IngresosHOSPpart   =isnull((select cantidad from #myTempTable1 where codigo='IngresosHOSPpart'),0)
   update #myTempTable set IngresosHOSPsoat     =isnull((select cantidad from #myTempTable1 where codigo='IngresosHOSPsoat'),0)
   update #myTempTable set IngresosHOSPotros     =isnull((select cantidad from #myTempTable1 where codigo='IngresosHOSPotros'),0)

   update #myTempTable set atencionesCEsis    =isnull((select cantidad from #myTempTable1 where codigo='atencionesCEsis'),0)
   update #myTempTable set atencionesCEpat    =isnull((select cantidad from #myTempTable1 where codigo='atencionesCEpat'),0)
   update #myTempTable set atencionesCEsoat      =isnull((select cantidad from #myTempTable1 where codigo='atencionesCEsoat'),0)
   update #myTempTable set atencionesCEotros      =isnull((select cantidad from #myTempTable1 where codigo='atencionesCEotros'),0)

   update #myTempTable set atencionesEMERsis    =isnull((select cantidad from #myTempTable1 where codigo='atencionesEMERsis'),0)
   update #myTempTable set atencionesEMERpat     =isnull((select cantidad from #myTempTable1 where codigo='atencionesEMERpat'),0)
   update #myTempTable set atencionesEMERsoat       =isnull((select cantidad from #myTempTable1 where codigo='atencionesEMERsoat'),0)
   update #myTempTable set atencionesEMERotros      =isnull((select cantidad from #myTempTable1 where codigo='atencionesEMERotros'),0)

   update #myTempTable set atencionesHOSPsis    =isnull((select cantidad from #myTempTable1 where codigo='atencionesHOSPsis'),0)
   update #myTempTable set atencionesHOSPpat      =isnull((select cantidad from #myTempTable1 where codigo='atencionesHOSPpat'),0)
   update #myTempTable set atencionesHOSPsoat        =isnull((select cantidad from #myTempTable1 where codigo='atencionesHOSPsoat'),0)
   update #myTempTable set atencionesHOSPotros       =isnull((select cantidad from #myTempTable1 where codigo='atencionesHOSPotros'),0)

   update #myTempTable set CajaTotal       =isnull((select importe from #myTempTable2 where codigo='CajaTotal'),0) - isnull((select importe from #myTempTable2 where codigo='NcTotal'),0)

   select * from #myTempTable

   drop table #myTempTable
   drop table #myTempTable1
   drop table #myTempTable2
END
GO
ALTER AUTHORIZATION ON [dbo].[sighWebActualizaDatosEESSrenaes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionAgregar]
	@IdProgramacion [int] OUTPUT,
	@IdResponsable [int],
	@Fecha [datetime],
	@HoraInicio [char](5),
	@HoraFin [char](5),
	@IdTurno [int],
	@IdSala [int],
	@FechaReg [datetime],
	@TiempoPromedioAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into SiProgramacion (
IdResponsable,Fecha,HoraInicio,HoraFin,IdTurno,IdSala,FechaReg,TiempoPromedioAtencion) values (
@IdResponsable,@Fecha,@HoraInicio,@HoraFin,@IdTurno,@IdSala,@FechaReg,@TiempoPromedioAtencion)
set @IdProgramacion = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionEliminar]
	@IdProgramacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from SiProgramacion
where IdProgramacion = @IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionMedicaSeleccionarPorResponsableYMes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionMedicaSeleccionarPorResponsableYMes]
	@IdResponsable [int],
	@Mes [int],
	@Anio [int]
WITH EXECUTE AS CALLER
AS
select * from siprogramacion
where IdResponsable  = @IdResponsable
and Month(Fecha) = @Mes
and Year(Fecha) = @Anio
order by fecha
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionMedicaSeleccionarPorResponsableYMes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionModificar]
	@IdProgramacion [int],
	@IdResponsable [int],
	@Fecha [datetime],
	@HoraInicio [char](5),
	@HoraFin [char](5),
	@IdTurno [int],
	@IdSala [int],
	@FechaReg [datetime],
	@TiempoPromedioAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update SiProgramacion
set
IdResponsable = @IdResponsable,
Fecha = @Fecha,
HoraInicio = @HoraInicio,
HoraFin = @HoraFin,
IdTurno = @IdTurno,
IdSala = @IdSala,
FechaReg = @FechaReg,
TiempoPromedioAtencion = @TiempoPromedioAtencion
where IdProgramacion = @IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionSeleccionarPorId]
	@IdProgramacion [int]
WITH EXECUTE AS CALLER
AS
select * from SiProgramacion
where IdProgramacion = @IdProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionXmedicoFechaHOra]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionXmedicoFechaHOra]
	@IdMedico [int],
	@Fecha [datetime],
	@Hora [char](5)
WITH EXECUTE AS CALLER
AS
SELECT     dbo.SiProgramacion.IdResponsable, dbo.SiProgramacion.Fecha, dbo.SiCitasSalas.Sala AS nombre, dbo.SiProgramacion.HoraInicio,
                      dbo.Turnos.Descripcion AS dTurno
FROM         dbo.SiProgramacion LEFT OUTER JOIN
                      dbo.Turnos ON dbo.SiProgramacion.IdTurno = dbo.Turnos.IdTurno LEFT OUTER JOIN
                      dbo.SiCitasSalas ON dbo.SiProgramacion.IdSala = dbo.SiCitasSalas.idSala
WHERE dbo.SiProgramacion.idresponsable=@IdMedico
and dbo.SiProgramacion.Fecha=@Fecha and
dbo.SiProgramacion.HoraInicio=@Hora
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionXmedicoFechaHOra] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionXresponsableYfechaYsala]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionXresponsableYfechaYsala]
	@idSala [int],
	@IdResponsable [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
select * from SiProgramacion where IdResponsable=@IdResponsable and Fecha =@Fecha and IdSala <>@idSala
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionXresponsableYfechaYsala] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SiProgramacionXsalaFecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SiProgramacionXsalaFecha]
	@IdSala [int],
	@Fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT    *,   dbo.Empleados.ApellidoPaterno + ' ' + dbo.Empleados.ApellidoMaterno + ' ' + dbo.Empleados.Nombres AS Responsable,
         (select COUNT(dbo.SiCitas.idCitaSI)  from dbo.SiCitas
          where dbo.SiCitas.idprogramacion=dbo.SiProgramacion.idprogramacion   ) as CuposLlenos
FROM         dbo.SiProgramacion LEFT OUTER JOIN
                      dbo.Empleados ON dbo.SiProgramacion.IdResponsable = dbo.Empleados.IdEmpleado
WHERE dbo.SiProgramacion.idsala=@IdSala and dbo.SiProgramacion.Fecha=@Fecha
order by dbo.SiProgramacion.horaInicio
GO
ALTER AUTHORIZATION ON [dbo].[SiProgramacionXsalaFecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[siProgramacionXsalaYfecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[siProgramacionXsalaYfecha]
	@idSala [int],
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.SiProgramacion.*, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres
FROM         dbo.SiProgramacion LEFT OUTER JOIN
                      dbo.Empleados ON dbo.SiProgramacion.IdResponsable = dbo.Empleados.IdEmpleado
 where dbo.SiProgramacion.IdSala =@idSala and dbo.SiProgramacion.Fecha =@fecha
  order by dbo.SiProgramacion.HoraInicio
GO
ALTER AUTHORIZATION ON [dbo].[siProgramacionXsalaYfecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SisafilicianesObtenerNombreApellidosPorNroDocumentoYtipo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SisafilicianesObtenerNombreApellidosPorNroDocumentoYtipo]
	@DocumentoNumero [varchar](10),
	@DocumentoTipo [char](1)
WITH EXECUTE AS CALLER
AS
select * from sisfiliaciones
where DocumentoNumero=@DocumentoNumero and DocumentoTipo=@DocumentoTipo
GO
ALTER AUTHORIZATION ON [dbo].[SisafilicianesObtenerNombreApellidosPorNroDocumentoYtipo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sismedv2SeleccionarPrecios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sismedv2SeleccionarPrecios]
	@TablaDBF [varchar](50),
	@Where [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)

SET  @SQL =  'select * from ' + @TablaDBF  + '  ' + @Where

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[Sismedv2SeleccionarPrecios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sms_diagnosticosgravesPORdx]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sms_diagnosticosgravesPORdx]
	@dx [varchar](7)
WITH EXECUTE AS CALLER
AS
select * from sms_diagnosticosgraves where dx=@dx
GO
ALTER AUTHORIZATION ON [dbo].[sms_diagnosticosgravesPORdx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sms_mensajesAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sms_mensajesAgregar]
	@idMensaje [int] OUTPUT,
	@celular [varchar](20),
	@idCuentaAtencion [int],
	@Mensaje [varchar](140),
	@idPaciente [int],
	@FechaEnvio [datetime],
	@FechaCreacion [datetime],
	@opcion [varchar](50),
	@idEstadoEnvio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into sms_mensajes (
celular,idCuentaAtencion,Mensaje,idPaciente,FechaEnvio,FechaCreacion,opcion,idEstadoEnvio) values (
@celular,@idCuentaAtencion,@Mensaje,@idPaciente,@FechaEnvio,@FechaCreacion,@opcion,@idEstadoEnvio)
set @idMensaje = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[sms_mensajesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sms_mensajesEliminarMenoresAfecha]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sms_mensajesEliminarMenoresAfecha]
	@fecha [datetime]
WITH EXECUTE AS CALLER
AS
delete from sms_mensajes
where fechaCreacion < @fecha
GO
ALTER AUTHORIZATION ON [dbo].[sms_mensajesEliminarMenoresAfecha] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SP_MovimientoHistoriasClinicas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_MovimientoHistoriasClinicas]
	@FechaMovimientoInicio [date]
WITH EXECUTE AS CALLER
AS
BEGIN
DECLARE @I_CONTEO INT = (SELECT COUNT(FechaMovimiento)
		    FROM MovimientosHistoriaClinica
		WHERE CAST(FechaMovimiento AS date) = @FechaMovimientoInicio);
IF @I_CONTEO = 0
BEGIN
	print 'No existe registro para mostrar'
END
ELSE
BEGIN
SELECT M.IdMovimiento
       ,[NroDocumento] = COALESCE(P.NroDocumento,' ')
	   ,P.ApellidoPaterno
	   ,P.ApellidoMaterno
	   ,P.PrimerNombre
	   ,[HistoriaClinica] = dbo.DNI_HISTORIAdevuelveSIN9(HC.NroHistoriaClinica)
	   ,[FichaFamiliar] = COALESCE(P.FichaFamiliar,'')
	   ,[FechaMovimiento] = CONVERT(CHAR(20),M.FechaMovimiento, 100)
	   ,[Origen] = SO.Codigo + ' ' + UPPER(SO.Nombre)
	   ,[Destino] = SD.Codigo + ' ' + UPPER(SD.Nombre)
	   ,[Motivo] = MT.Descripcion
	   ,[NroFolios] = COALESCE(M.NroFolios,' ')
	   ,[Observacion] = COALESCE(M.Observacion,' ')
	   ,M.idPaciente
	   ,M.FechaMovimiento
FROM MovimientosHistoriaClinica M
INNER JOIN MotivosMovimientoHistoria MT ON M.IdMotivo = MT.IdMotivo
INNER JOIN Pacientes P ON M.IdPaciente = P.IdPaciente
INNER JOIN Servicios SO ON M.IdServicioOrigen = SO.IdServicio
INNER JOIN Servicios SD ON M.IdServicioDestino = SD.IdServicio
INNER JOIN HistoriasClinicas HC ON HC.IdPaciente = P.IdPaciente
WHERE CAST(M.FechaMovimiento as date) = @FechaMovimientoInicio
END
END
/*Crear procedimiento almacenado - FIN(GLCC)*/
GO
ALTER AUTHORIZATION ON [dbo].[SP_MovimientoHistoriasClinicas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosAgregar]
	@IdTipoServicio [int],
	@IdClasificacionDx [int],
	@Descripcion [varchar](100),
	@Codigo [varchar](5),
	@IdSubclasificacionDx [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into SubclasificacionDiagnosticos (
IdTipoServicio,IdClasificacionDx,Descripcion,Codigo) values (
@IdTipoServicio,@IdClasificacionDx,@Descripcion,@Codigo)
set @IdSubclasificacionDx = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdSubclasificacionDx,'SubclasificacionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosEliminar]
	@IdSubclasificacionDx [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from SubclasificacionDiagnosticos
where IdSubclasificacionDx = @IdSubclasificacionDx
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdSubclasificacionDx,'SubclasificacionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosModificar]
	@IdTipoServicio [int],
	@IdClasificacionDx [int],
	@Descripcion [varchar](100),
	@Codigo [varchar](5),
	@IdSubclasificacionDx [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update SubclasificacionDiagnosticos
set
IdTipoServicio = @IdTipoServicio,
IdClasificacionDx = @IdClasificacionDx,
Descripcion = @Descripcion,
Codigo = @Codigo
where IdSubclasificacionDx = @IdSubclasificacionDx
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdSubclasificacionDx,'SubclasificacionDiagnosticos'
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxConsultaExterna]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxConsultaExterna]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 1 and IdClasificacionDx = 1
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxConsultaExterna] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospComplicaciones]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospComplicaciones]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 6
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospComplicaciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospEgreso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospEgreso]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 3
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospEgreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospIngreso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospIngreso]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 2
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMortalidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMortalidad]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 4
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMortalidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMuerteFetal]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMuerteFetal]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 5
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxHospMuerteFetal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarDxInterconsultas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarDxInterconsultas]
WITH EXECUTE AS CALLER
AS
select IdSubclasificacionDx, Codigo + ' = ' + descripcion as DescripcionLarga
from SubclasificacionDiagnosticos
where IdTipoServicio = 3 and IdClasificacionDx = 7
order by IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarDxInterconsultas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarIdPorCodigoYClasificacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarIdPorCodigoYClasificacion]
	@Codigo [varchar](3),
	@IdClasificacionDx [int]
WITH EXECUTE AS CALLER
AS
Select IdSubclasificacionDx from SubclasificacionDiagnosticos
where codigo = @Codigo and IdClasificacionDx = @IdClasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarIdPorCodigoYClasificacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SubclasificacionDiagnosticosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SubclasificacionDiagnosticosSeleccionarPorId]
	@IdSubclasificacionDx [int]
WITH EXECUTE AS CALLER
AS
select * from SubclasificacionDiagnosticos
where IdSubclasificacionDx = @IdSubclasificacionDx
GO
ALTER AUTHORIZATION ON [dbo].[SubclasificacionDiagnosticosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Suna_TramaPresSaludConsultoriosDx]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Suna_TramaPresSaludConsultoriosDx]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.SubclasificacionDiagnosticos.Codigo,
                      dbo.SubclasificacionDiagnosticos.Descripcion AS Expr1
FROM         dbo.AtencionesDiagnosticos INNER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
                      dbo.SubclasificacionDiagnosticos ON dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx
where dbo.AtencionesDiagnosticos.IdAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Suna_TramaPresSaludConsultoriosDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_EmisionCitasAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_EmisionCitasAgregar]
	@Cod_ipress [varchar](20),
	@PerInfProgAsistencial [varchar](20),
	@ColprofRespPrestacion [varchar](20),
	@NumcolegProf [varchar](20),
	@ServEspBridAtencion [varchar](100),
	@Actividad [varchar](20),
	@SubActividad [varchar](20),
	@TipoOferta [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_EmisionCitas (
Cod_ipress,PerInfProgAsistencial,ColprofRespPrestacion,NumcolegProf,ServEspBridAtencion,Actividad,SubActividad,TipoOferta) values (
@Cod_ipress,@PerInfProgAsistencial,@ColprofRespPrestacion,@NumcolegProf,@ServEspBridAtencion,@Actividad,@SubActividad,@TipoOferta)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@Cod_ipress,'Sunasa_EmisionCitas'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_EmisionCitasAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_EmisionCitasEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_EmisionCitasEliminar]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_EmisionCitas
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@Cod_ipress,'Sunasa_EmisionCitas'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_EmisionCitasEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_ConsultoriosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_ConsultoriosAgregar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecAtencion [varchar](20),
	@HoraAtencion [varchar](20),
	@Actividad [varchar](20),
	@ColprofRespPrestacion [varchar](20),
	@NumcolegProf [varchar](20),
	@ServEspBridAtencion [varchar](100),
	@FecEmisionCitas [varchar](20),
	@Primeriagnostico [varchar](20),
	@PtimerTipoDiagnostico [varchar](20),
	@SegundoDiagnostico [varchar](20),
	@SegundoTipoDiagnostico [varchar](20),
	@TercerDiagnostico [varchar](20),
	@TercerTipoDiagnostico [varchar](20),
	@ResultadoAtencionAmbulatoria [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_PrestacionsSalud_Consultorios (
PeriodoReporte,CodIafas,NumHistClinica,TipDocIdentidad,NumDocIdentidad,RegSeguroPaciente,SexoPaciente,FecNacPaciente,FecAtencion,HoraAtencion,Actividad,ColprofRespPrestacion,NumcolegProf,ServEspBridAtencion,FecEmisionCitas,Primeriagnostico,PtimerTipoDiagnostico,SegundoDiagnostico,SegundoTipoDiagnostico,TercerDiagnostico,TercerTipoDiagnostico,ResultadoAtencionAmbulatoria) values (
@PeriodoReporte,@CodIafas,@NumHistClinica,@TipDocIdentidad,@NumDocIdentidad,@RegSeguroPaciente,@SexoPaciente,@FecNacPaciente,@FecAtencion,@HoraAtencion,@Actividad,@ColprofRespPrestacion,@NumcolegProf,@ServEspBridAtencion,@FecEmisionCitas,@Primeriagnostico,@PtimerTipoDiagnostico,@SegundoDiagnostico,@SegundoTipoDiagnostico,@TercerDiagnostico,@TercerTipoDiagnostico,@ResultadoAtencionAmbulatoria)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@PeriodoReporte,'Sunasa_PrestacionsSalud_Consultorios'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_ConsultoriosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_ConsultoriosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_ConsultoriosEliminar]
	@PeriodoReporte [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_PrestacionsSalud_Consultorios
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@PeriodoReporte,'Sunasa_PrestacionsSalud_Consultorios'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_ConsultoriosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_ConsultoriosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_ConsultoriosModificar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecAtencion [varchar](20),
	@HoraAtencion [varchar](20),
	@Actividad [varchar](20),
	@ColprofRespPrestacion [varchar](20),
	@NumcolegProf [varchar](20),
	@ServEspBridAtencion [varchar](100),
	@FecEmisionCitas [varchar](20),
	@Primeriagnostico [varchar](20),
	@PtimerTipoDiagnostico [varchar](20),
	@SegundoDiagnostico [varchar](20),
	@SegundoTipoDiagnostico [varchar](20),
	@TercerDiagnostico [varchar](20),
	@TercerTipoDiagnostico [varchar](20),
	@ResultadoAtencionAmbulatoria [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Sunasa_PrestacionsSalud_Consultorios
set
CodIafas = @CodIafas,
NumHistClinica = @NumHistClinica,
TipDocIdentidad = @TipDocIdentidad,
NumDocIdentidad = @NumDocIdentidad,
RegSeguroPaciente = @RegSeguroPaciente,
SexoPaciente = @SexoPaciente,
FecNacPaciente = @FecNacPaciente,
FecAtencion = @FecAtencion,
HoraAtencion = @HoraAtencion,
Actividad = @Actividad,
ColprofRespPrestacion = @ColprofRespPrestacion,
NumcolegProf = @NumcolegProf,
ServEspBridAtencion = @ServEspBridAtencion,
FecEmisionCitas = @FecEmisionCitas,
Primeriagnostico = @Primeriagnostico,
PtimerTipoDiagnostico = @PtimerTipoDiagnostico,
SegundoDiagnostico = @SegundoDiagnostico,
SegundoTipoDiagnostico = @SegundoTipoDiagnostico,
TercerDiagnostico = @TercerDiagnostico,
TercerTipoDiagnostico = @TercerTipoDiagnostico,
ResultadoAtencionAmbulatoria = @ResultadoAtencionAmbulatoria
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@PeriodoReporte,'Sunasa_PrestacionsSalud_Consultorios'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_ConsultoriosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_ConsultoriosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_ConsultoriosSeleccionarPorId]
	@PeriodoReporte [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from Sunasa_PrestacionsSalud_Consultorios
where PeriodoReporte = @PeriodoReporte
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_ConsultoriosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_EmergenciaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_EmergenciaAgregar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecIngrEmergencia [varchar](20),
	@HorIngrEmergencia [varchar](20),
	@DiagnosticoEmergencia [varchar](20),
	@TipoDiagnostico [varchar](20),
	@FecAltaEmergencia [varchar](20),
	@HorAltaEmergencia [varchar](20),
	@CondicionAlta [varchar](20),
	@ResultadoAtencionEmergencia [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_PrestacionsSalud_Emergencia (
PeriodoReporte,CodIafas,NumHistClinica,TipDocIdentidad,NumDocIdentidad,RegSeguroPaciente,SexoPaciente,FecNacPaciente,FecIngrEmergencia,HorIngrEmergencia,DiagnosticoEmergencia,TipoDiagnostico,FecAltaEmergencia,HorAltaEmergencia,CondicionAlta,ResultadoAtencionEmergencia) values (
@PeriodoReporte,@CodIafas,@NumHistClinica,@TipDocIdentidad,@NumDocIdentidad,@RegSeguroPaciente,@SexoPaciente,@FecNacPaciente,@FecIngrEmergencia,@HorIngrEmergencia,@DiagnosticoEmergencia,@TipoDiagnostico,@FecAltaEmergencia,@HorAltaEmergencia,@CondicionAlta,@ResultadoAtencionEmergencia)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@PeriodoReporte,'Sunasa_PrestacionsSalud_Emergencia'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_EmergenciaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_EmergenciaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_EmergenciaEliminar]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_PrestacionsSalud_Emergencia
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@PeriodoReporte,'Sunasa_PrestacionsSalud_Emergencia'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_EmergenciaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_EmergenciaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_EmergenciaModificar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecIngrEmergencia [varchar](20),
	@HorIngrEmergencia [varchar](20),
	@DiagnosticoEmergencia [varchar](20),
	@TipoDiagnostico [varchar](20),
	@FecAltaEmergencia [varchar](20),
	@HorAltaEmergencia [varchar](20),
	@CondicionAlta [varchar](20),
	@ResultadoAtencionEmergencia [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Sunasa_PrestacionsSalud_Emergencia
set
CodIafas = @CodIafas,
NumHistClinica = @NumHistClinica,
TipDocIdentidad = @TipDocIdentidad,
NumDocIdentidad = @NumDocIdentidad,
RegSeguroPaciente = @RegSeguroPaciente,
SexoPaciente = @SexoPaciente,
FecNacPaciente = @FecNacPaciente,
FecIngrEmergencia = @FecIngrEmergencia,
HorIngrEmergencia = @HorIngrEmergencia,
DiagnosticoEmergencia = @DiagnosticoEmergencia,
TipoDiagnostico = @TipoDiagnostico,
FecAltaEmergencia = @FecAltaEmergencia,
HorAltaEmergencia = @HorAltaEmergencia,
CondicionAlta = @CondicionAlta,
ResultadoAtencionEmergencia = @ResultadoAtencionEmergencia
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@PeriodoReporte,'Sunasa_PrestacionsSalud_Emergencia'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_EmergenciaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_EmergenciaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_EmergenciaSeleccionarPorId]
	@PeriodoReporte [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from Sunasa_PrestacionsSalud_Emergencia
where PeriodoReporte = @PeriodoReporte
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_EmergenciaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionAgregar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecHospitalizacion [varchar](20),
	@AreaProcedencia [varchar](20),
	@NumColMedSolicitoIngHospitalizacion [varchar](20),
	@PrimerdiagIngresoHospitalizacion [varchar](20),
	@SegundoDiagIngresoHospitalizacion [varchar](20),
	@TercerDiagIngresoHospitalizacion [varchar](20),
	@TipPerRespAtencionAltaOParto [varchar](20),
	@NumColeProfResponsable [varchar](20),
	@PrimerdiagEgresoHospitalizacion [varchar](20),
	@SegundoDiagEgresoHospitalizacion [varchar](20),
	@TercerDiagEgresoHospitalizacion [varchar](20),
	@MotivoAltaEstablecimiento [varchar](20),
	@FecAlta [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_PrestacionsSalud_Hospitalizacion (
PeriodoReporte,CodIafas,NumHistClinica,TipDocIdentidad,NumDocIdentidad,RegSeguroPaciente,SexoPaciente,FecNacPaciente,FecHospitalizacion,AreaProcedencia,NumColMedSolicitoIngHospitalizacion,PrimerdiagIngresoHospitalizacion,SegundoDiagIngresoHospitalizacion,TercerDiagIngresoHospitalizacion,TipPerRespAtencionAltaOParto,NumColeProfResponsable,PrimerdiagEgresoHospitalizacion,SegundoDiagEgresoHospitalizacion,TercerDiagEgresoHospitalizacion,MotivoAltaEstablecimiento,FecAlta) values (
@PeriodoReporte,@CodIafas,@NumHistClinica,@TipDocIdentidad,@NumDocIdentidad,@RegSeguroPaciente,@SexoPaciente,@FecNacPaciente,@FecHospitalizacion,@AreaProcedencia,@NumColMedSolicitoIngHospitalizacion,@PrimerdiagIngresoHospitalizacion,@SegundoDiagIngresoHospitalizacion,@TercerDiagIngresoHospitalizacion,@TipPerRespAtencionAltaOParto,@NumColeProfResponsable,@PrimerdiagEgresoHospitalizacion,@SegundoDiagEgresoHospitalizacion,@TercerDiagEgresoHospitalizacion,@MotivoAltaEstablecimiento,@FecAlta)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@PeriodoReporte,'Sunasa_PrestacionsSalud_Hospitalizacion'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionEliminar]
	@PeriodoReporte [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_PrestacionsSalud_Hospitalizacion
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@PeriodoReporte,'Sunasa_PrestacionsSalud_Hospitalizacion'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionModificar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecHospitalizacion [varchar](20),
	@AreaProcedencia [varchar](20),
	@NumColMedSolicitoIngHospitalizacion [varchar](20),
	@PrimerdiagIngresoHospitalizacion [varchar](20),
	@SegundoDiagIngresoHospitalizacion [varchar](20),
	@TercerDiagIngresoHospitalizacion [varchar](20),
	@TipPerRespAtencionAltaOParto [varchar](20),
	@NumColeProfResponsable [varchar](20),
	@PrimerdiagEgresoHospitalizacion [varchar](20),
	@SegundoDiagEgresoHospitalizacion [varchar](20),
	@TercerDiagEgresoHospitalizacion [varchar](20),
	@MotivoAltaEstablecimiento [varchar](20),
	@FecAlta [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Sunasa_PrestacionsSalud_Hospitalizacion
set
CodIafas = @CodIafas,
NumHistClinica = @NumHistClinica,
TipDocIdentidad = @TipDocIdentidad,
NumDocIdentidad = @NumDocIdentidad,
RegSeguroPaciente = @RegSeguroPaciente,
SexoPaciente = @SexoPaciente,
FecNacPaciente = @FecNacPaciente,
FecHospitalizacion = @FecHospitalizacion,
AreaProcedencia = @AreaProcedencia,
NumColMedSolicitoIngHospitalizacion = @NumColMedSolicitoIngHospitalizacion,
PrimerdiagIngresoHospitalizacion = @PrimerdiagIngresoHospitalizacion,
SegundoDiagIngresoHospitalizacion = @SegundoDiagIngresoHospitalizacion,
TercerDiagIngresoHospitalizacion = @TercerDiagIngresoHospitalizacion,
TipPerRespAtencionAltaOParto = @TipPerRespAtencionAltaOParto,
NumColeProfResponsable = @NumColeProfResponsable,
PrimerdiagEgresoHospitalizacion = @PrimerdiagEgresoHospitalizacion,
SegundoDiagEgresoHospitalizacion = @SegundoDiagEgresoHospitalizacion,
TercerDiagEgresoHospitalizacion = @TercerDiagEgresoHospitalizacion,
MotivoAltaEstablecimiento = @MotivoAltaEstablecimiento,
FecAlta = @FecAlta
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@PeriodoReporte,'Sunasa_PrestacionsSalud_Hospitalizacion'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosAgregar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecParto [varchar](20),
	@SemanaGestacion [varchar](20),
	@TipoParto [varchar](20),
	@DiagAtencion [varchar](20),
	@EstadoRecienNacido [varchar](20),
	@HoraNacieminto [varchar](20),
	@PesoNeonato [varchar](20),
	@ApgarPrimerMinuto [varchar](20),
	@ApgarCincoMinutos [varchar](20),
	@FechaCirugia [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_PrestacionsSalud_HospitalizacionPorPartos (
PeriodoReporte,CodIafas,NumHistClinica,TipDocIdentidad,NumDocIdentidad,RegSeguroPaciente,SexoPaciente,FecNacPaciente,FecParto,SemanaGestacion,TipoParto,DiagAtencion,EstadoRecienNacido,HoraNacieminto,PesoNeonato,ApgarPrimerMinuto,ApgarCincoMinutos,FechaCirugia) values (
@PeriodoReporte,@CodIafas,@NumHistClinica,@TipDocIdentidad,@NumDocIdentidad,@RegSeguroPaciente,@SexoPaciente,@FecNacPaciente,@FecParto,@SemanaGestacion,@TipoParto,@DiagAtencion,@EstadoRecienNacido,@HoraNacieminto,@PesoNeonato,@ApgarPrimerMinuto,@ApgarCincoMinutos,@FechaCirugia)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@PeriodoReporte,'Sunasa_PrestacionsSalud_HospitalizacionPorPartos'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosEliminar]
	@PeriodoReporte [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_PrestacionsSalud_HospitalizacionPorPartos
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@PeriodoReporte,'Sunasa_PrestacionsSalud_HospitalizacionPorPartos'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosModificar]
	@PeriodoReporte [varchar](20),
	@CodIafas [varchar](20),
	@NumHistClinica [varchar](20),
	@TipDocIdentidad [varchar](20),
	@NumDocIdentidad [varchar](20),
	@RegSeguroPaciente [varchar](20),
	@SexoPaciente [varchar](20),
	@FecNacPaciente [varchar](20),
	@FecParto [varchar](20),
	@SemanaGestacion [varchar](20),
	@TipoParto [varchar](20),
	@DiagAtencion [varchar](20),
	@EstadoRecienNacido [varchar](20),
	@HoraNacieminto [varchar](20),
	@PesoNeonato [varchar](20),
	@ApgarPrimerMinuto [varchar](20),
	@ApgarCincoMinutos [varchar](20),
	@FechaCirugia [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Sunasa_PrestacionsSalud_HospitalizacionPorPartos
set
CodIafas = @CodIafas,
NumHistClinica = @NumHistClinica,
TipDocIdentidad = @TipDocIdentidad,
NumDocIdentidad = @NumDocIdentidad,
RegSeguroPaciente = @RegSeguroPaciente,
SexoPaciente = @SexoPaciente,
FecNacPaciente = @FecNacPaciente,
FecParto = @FecParto,
SemanaGestacion = @SemanaGestacion,
TipoParto = @TipoParto,
DiagAtencion = @DiagAtencion,
EstadoRecienNacido = @EstadoRecienNacido,
HoraNacieminto = @HoraNacieminto,
PesoNeonato = @PesoNeonato,
ApgarPrimerMinuto = @ApgarPrimerMinuto,
ApgarCincoMinutos = @ApgarCincoMinutos,
FechaCirugia = @FechaCirugia
where PeriodoReporte = @PeriodoReporte
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@PeriodoReporte,'Sunasa_PrestacionsSalud_HospitalizacionPorPartos'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosSeleccionarPorId]
	@PeriodoReporte [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from Sunasa_PrestacionsSalud_HospitalizacionPorPartos
where PeriodoReporte = @PeriodoReporte
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionPorPartosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_PrestacionsSalud_HospitalizacionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_PrestacionsSalud_HospitalizacionSeleccionarPorId]
	@PeriodoReporte [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from Sunasa_PrestacionsSalud_Hospitalizacion
where PeriodoReporte = @PeriodoReporte
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_PrestacionsSalud_HospitalizacionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_ProgramacionAsistencialAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_ProgramacionAsistencialAgregar]
	@Cod_ipress [varchar](20),
	@PerInfProgAsistencial [varchar](20),
	@ColprofRespPrestacion [varchar](20),
	@NumcolegProf [varchar](20),
	@ServEspBridAtencion [varchar](100),
	@Actividad [varchar](20),
	@SubActividad [varchar](20),
	@TipoOferta [varchar](20),
	@FecRegActividad [varchar](20),
	@FecAperActividad [varchar](20),
	@FecModifActividad [varchar](20),
	@FecSusActividad [varchar](20),
	@FecReProgAsistencia [varchar](20),
	@FecIniAsistencial [varchar](20),
	@HorIniTurno [varchar](20),
	@FecFinAsistencial [varchar](20),
	@HorFinTurno [varchar](20),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunasa_ProgAsistencial (
Cod_ipress,PerInfProgAsistencial,ColprofRespPrestacion,NumcolegProf,ServEspBridAtencion,Actividad,SubActividad,TipoOferta,FecRegActividad,FecAperActividad,FecModifActividad,FecSusActividad,FecReProgAsistencia,FecIniAsistencial,HorIniTurno,FecFinAsistencial,HorFinTurno) values (
@Cod_ipress,@PerInfProgAsistencial,@ColprofRespPrestacion,@NumcolegProf,@ServEspBridAtencion,@Actividad,@SubActividad,@TipoOferta,@FecRegActividad,@FecAperActividad,@FecModifActividad,@FecSusActividad,@FecReProgAsistencia,@FecIniAsistencial,@HorIniTurno,@FecFinAsistencial,@HorFinTurno)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@Cod_ipress,'Sunasa_ProgramacionAsistencial'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_ProgramacionAsistencialAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_ProgramacionAsistencialEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_ProgramacionAsistencialEliminar]
WITH EXECUTE AS CALLER
AS
delete from Sunasa_ProgAsistencial
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@Cod_ipress,'Sunasa_ProgramacionAsistencial'
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_ProgramacionAsistencialEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaEmisionCitas]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaEmisionCitas]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT      rtrim(convert(char(10),Year(dbo.ProgramacionMedica.Fecha),113)) + replace(str(month(dbo.ProgramacionMedica.Fecha),2),space(1),'0') as PerInfProgAsistencial,
	    dbo.HIS_colegios.cod_col as CodigoColegio, dbo.HIS_colegios.des_col, dbo.Medicos.Colegiatura as NumeroColegiatura, dbo.Servicios.Nombre as Especialidad,
                      dbo.Citas.IdCita
FROM         dbo.ProgramacionMedica INNER JOIN
                      dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico INNER JOIN
                      dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio INNER JOIN
                      dbo.Citas ON dbo.ProgramacionMedica.IdProgramacion = dbo.Citas.IdProgramacion LEFT OUTER JOIN
                      dbo.HIS_colegios ON dbo.Medicos.idColegioHIS = dbo.HIS_colegios.cod_col
WHERE     (NOT (dbo.HIS_colegios.cod_col IS NULL)) AND (dbo.Citas.IdCita > 0)
AND dbo.ProgramacionMedica.Fecha Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaEmisionCitas] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludConsultorios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludConsultorios]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.Atenciones.idAtencion, dbo.Pacientes.NroHistoriaClinica, dbo.Pacientes.IdDocIdentidad, dbo.Pacientes.NroDocumento, dbo.Pacientes.IdTipoSexo, dbo.Pacientes.IdDocIdentidad as TipDocIdentidad,
	      rtrim(convert(char(10),Year(dbo.Pacientes.FechaNacimiento),113)) + replace(str(month(dbo.Pacientes.FechaNacimiento),2),space(1),'0') + replace(str(day(dbo.Pacientes.FechaNacimiento),2),space(1),'0') as FechaNacimiento,
	      rtrim(convert(char(10),Year(dbo.Atenciones.FechaIngreso),113)) + replace(str(month(dbo.Atenciones.FechaIngreso),2),space(1),'0') + replace(str(day(dbo.Atenciones.FechaIngreso),2),space(1),'0') as FechaIngreso,
	      replace(dbo.Atenciones.HoraIngreso,':','') + '00' as HoraIngreso, dbo.Atenciones.IdTipoServicio,
              dbo.HIS_colegios.cod_col, dbo.HIS_colegios.des_col, dbo.Medicos.Colegiatura, dbo.Servicios.Nombre, dbo.TiposDestinoAtencion.IdDestinoAtencion,
              dbo.TiposDestinoAtencion.Descripcion, dbo.Atenciones.idEstadoAtencion
FROM          dbo.TiposDestinoAtencion RIGHT OUTER JOIN
              dbo.Atenciones ON dbo.TiposDestinoAtencion.IdDestinoAtencion = dbo.Atenciones.IdDestinoAtencion LEFT OUTER JOIN
              dbo.Servicios ON dbo.Atenciones.IdServicioIngreso = dbo.Servicios.IdServicio LEFT OUTER JOIN
              dbo.HIS_colegios RIGHT OUTER JOIN
              dbo.Medicos ON dbo.HIS_colegios.cod_col = dbo.Medicos.idColegioHIS ON
              dbo.Atenciones.IdMedicoIngreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
              dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE     (dbo.Atenciones.IdTipoServicio = 1) AND (dbo.Atenciones.idEstadoAtencion <> 0)
AND dbo.Atenciones.FechaIngreso Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludConsultorios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludEmergencia]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT    dbo.Atenciones.idatencion, dbo.Pacientes.NroHistoriaClinica,
dbo.Pacientes.IdDocIdentidad as TipDocIdentidad,
dbo.Pacientes.NroDocumento,
dbo.Atenciones.IdTipoServicio,
dbo.Atenciones.idEstadoAtencion,
dbo.Pacientes.IdTipoSexo,
rtrim(convert(char(10),Year(dbo.Pacientes.FechaNacimiento),113)) + replace(str(month(dbo.Pacientes.FechaNacimiento),2),space(1),'0') + replace(str(day(dbo.Pacientes.FechaNacimiento),2),space(1),'0') as FechaNacimiento,
rtrim(convert(char(10),Year(dbo.Atenciones.FechaIngreso),113)) + replace(str(month(dbo.Atenciones.FechaIngreso),2),space(1),'0') + replace(str(day(dbo.Atenciones.FechaIngreso),2),space(1),'0') as FechaIngreso,
replace(dbo.Atenciones.HoraIngreso,':','') + '00' as HoraIngreso,
rtrim(convert(char(10),Year(dbo.Atenciones.FechaEgreso),113)) + replace(str(month(dbo.Atenciones.FechaEgreso),2),space(1),'0') + replace(str(day(dbo.Atenciones.FechaEgreso),2),space(1),'0') as FechaEgreso,
replace(dbo.Atenciones.HoraEgreso,':','') + '00' as HoraEgreso,
dbo.TiposCondicionAlta.Descripcion,
dbo.TiposCondicionAlta.codigoCondicionAltaSEM,
dbo.TiposDestinoAtencion.Codigo,
dbo.TiposDestinoAtencion.Descripcion AS Expr1,
dbo.TiposDestinoAtencion.DestinoSEM,
dbo.TiposDestinoAtencion.id_destinoAseguradoSIS
FROM         dbo.Atenciones LEFT OUTER JOIN
                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.TiposDestinoAtencion ON dbo.Atenciones.IdDestinoAtencion = dbo.TiposDestinoAtencion.IdDestinoAtencion
WHERE     (dbo.Atenciones.IdTipoServicio = 2) AND (dbo.Atenciones.idEstadoAtencion <> 0)
AND dbo.Atenciones.FechaIngreso Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludEmergenciaDx]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludEmergenciaDx]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT    top 1 dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.SubclasificacionDiagnosticos.Codigo,
                      dbo.SubclasificacionDiagnosticos.Descripcion AS Expr1
FROM         dbo.AtencionesDiagnosticos INNER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico INNER JOIN
                      dbo.SubclasificacionDiagnosticos ON dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx
WHERE	dbo.AtencionesDiagnosticos.IdAtencion=@IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludEmergenciaDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludHospitalizacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludHospitalizacion]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.idatencion,
dbo.Pacientes.NroHistoriaClinica as NumHistClinica,
dbo.Pacientes.IdDocIdentidad as TipDocIdentidad,
dbo.Pacientes.NroDocumento as NumDocIdentidad,
dbo.Atenciones.IdTipoServicio,
dbo.Atenciones.idEstadoAtencion,
dbo.Pacientes.IdTipoSexo as SexoPaciente,
rtrim(convert(char(10),Year(dbo.Pacientes.FechaNacimiento),113)) + replace(str(month(dbo.Pacientes.FechaNacimiento),2),space(1),'0') + replace(str(day(dbo.Pacientes.FechaNacimiento),2),space(1),'0') as FechaNacimiento,
rtrim(convert(char(10),Year(dbo.Atenciones.FechaIngreso),113)) + replace(str(month(dbo.Atenciones.FechaIngreso),2),space(1),'0') + replace(str(day(dbo.Atenciones.FechaIngreso),2),space(1),'0') as FechaIngreso,
dbo.TiposOrigenAtencion.Codigo AS Proced1,
dbo.TiposOrigenAtencion.Descripcion AS Proced2,
dbo.HIS_colegios.cod_col AS mIngColegio,
dbo.HIS_colegios.des_col AS mIngDcolegio,
dbo.Medicos.Colegiatura AS mIngNroColegio,
HIS_colegios_1.cod_col AS mSalColegio,
HIS_colegios_1.des_col AS mSalDcolegio,
Medicos_1.Colegiatura AS mSalNroColegio,
dbo.TiposDestinoAtencion.Codigo AS Dest1,
dbo.TiposDestinoAtencion.Descripcion AS Dest2,
rtrim(convert(char(10),Year(dbo.Atenciones.FechaEgreso),113)) + replace(str(month(dbo.Atenciones.FechaEgreso),2),space(1),'0') + replace(str(day(dbo.Atenciones.FechaEgreso),2),space(1),'0') as FecAlta
FROM         dbo.HIS_colegios HIS_colegios_1 RIGHT OUTER JOIN
                      dbo.Medicos Medicos_1 ON HIS_colegios_1.cod_col = Medicos_1.idColegioHIS RIGHT OUTER JOIN
                      dbo.Atenciones ON Medicos_1.IdMedico = dbo.Atenciones.IdMedicoEgreso LEFT OUTER JOIN
                      dbo.Medicos ON dbo.Atenciones.IdMedicoIngreso = dbo.Medicos.IdMedico LEFT OUTER JOIN
                      dbo.HIS_colegios ON dbo.Medicos.idColegioHIS = dbo.HIS_colegios.cod_col LEFT OUTER JOIN
                      dbo.TiposOrigenAtencion ON dbo.Atenciones.IdOrigenAtencion = dbo.TiposOrigenAtencion.IdOrigenAtencion LEFT OUTER JOIN
                      dbo.TiposCondicionAlta ON dbo.Atenciones.IdCondicionAlta = dbo.TiposCondicionAlta.IdCondicionAlta LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente LEFT OUTER JOIN
                      dbo.TiposDestinoAtencion ON dbo.Atenciones.IdDestinoAtencion = dbo.TiposDestinoAtencion.IdDestinoAtencion
WHERE     (dbo.Atenciones.IdTipoServicio = 3) AND (dbo.Atenciones.idEstadoAtencion <> 0)
AND dbo.Atenciones.FechaIngreso Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludHospitalizacionDxAlta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludHospitalizacionDxAlta]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT    top 3 dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.SubclasificacionDiagnosticos.Codigo,
                      dbo.SubclasificacionDiagnosticos.Descripcion AS Expr1
FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                      dbo.SubclasificacionDiagnosticos ON
                      dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
WHERE     (dbo.AtencionesDiagnosticos.IdAtencion = @IdAtencion) AND (NOT (dbo.SubclasificacionDiagnosticos.Codigo IS NULL))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludHospitalizacionDxAlta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludHospitalizacionDxIngreso]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludHospitalizacionDxIngreso]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT    top 3 dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.SubclasificacionDiagnosticos.Codigo,
                      dbo.SubclasificacionDiagnosticos.Descripcion AS Expr1
FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                      dbo.SubclasificacionDiagnosticos ON
                      dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
WHERE     (dbo.AtencionesDiagnosticos.IdAtencion = @IdAtencion) AND (dbo.SubclasificacionDiagnosticos.Codigo IS NULL)
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludHospitalizacionDxIngreso] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaPresSaludHospParto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaPresSaludHospParto]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT dbo.Atenciones.Idatencion,
dbo.Pacientes.NroHistoriaClinica as NumHistClinica,
dbo.Pacientes.IdDocIdentidad as TipDocIdentidad,
dbo.Pacientes.NroDocumento as NumDocIdentidad,
dbo.Pacientes.IdTipoSexo as SexoPaciente,
rtrim(convert(char(10),Year(dbo.Pacientes.FechaNacimiento),113)) + replace(str(month(dbo.Pacientes.FechaNacimiento),2),space(1),'0') + replace(str(day(dbo.Pacientes.FechaNacimiento),2),space(1),'0') as fNacimMadre,
rtrim(convert(char(10),Year(dbo.AtencionesNacimientos.FechaNacimiento),113)) + replace(str(month(dbo.AtencionesNacimientos.FechaNacimiento),2),space(1),'0') + replace(str(day(dbo.AtencionesNacimientos.FechaNacimiento),2),space(1),'0') as FechaHoraParto,
dbo.AtencionesNacimientos.EdadSemanas as SemanaGestacion,
dbo.AtencionesNacimientos.IdCondicionRN AS VivoMuerto,
dbo.AtencionesNacimientos.Peso as PesoNeonato,
dbo.AtencionesNacimientos.apgar_1 as ApgarPrimerMinuto,
dbo.AtencionesNacimientos.apgar_5 as ApgarCincoMinutos
FROM         dbo.Atenciones INNER JOIN
                      dbo.AtencionesNacimientos ON dbo.Atenciones.IdAtencion = dbo.AtencionesNacimientos.IdAtencion LEFT OUTER JOIN
                      dbo.Pacientes ON dbo.Atenciones.IdPaciente = dbo.Pacientes.IdPaciente
WHERE dbo.Atenciones.idEstadoAtencion <>0 AND
      dbo.Atenciones.FechaIngreso Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
order by dbo.Atenciones.IdAtencion
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaPresSaludHospParto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunasa_TramaProgramacionAsistencial]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[Sunasa_TramaProgramacionAsistencial]
	@FechaIni [datetime],
	@FechaFin [datetime]
WITH EXECUTE AS CALLER
AS
SELECT     rtrim(convert(char(10),Year(dbo.ProgramacionMedica.Fecha),113)) + replace(str(month(dbo.ProgramacionMedica.Fecha),2),space(1),'0') as PerInfProgAsistencial
, dbo.HIS_colegios.cod_col as CodigoColegio, dbo.HIS_colegios.des_col, dbo.Medicos.Colegiatura as NumeroColegiatura, dbo.Servicios.Nombre as Especialidad
FROM       dbo.ProgramacionMedica INNER JOIN
           dbo.Medicos ON dbo.ProgramacionMedica.IdMedico = dbo.Medicos.IdMedico INNER JOIN
           dbo.Servicios ON dbo.ProgramacionMedica.IdServicio = dbo.Servicios.IdServicio LEFT OUTER JOIN
           dbo.HIS_colegios ON dbo.Medicos.idColegioHIS = dbo.HIS_colegios.cod_col
WHERE      (NOT (dbo.HIS_colegios.cod_col IS NULL))
AND dbo.ProgramacionMedica.Fecha Between  (CONVERT(DATETIME,@FechaIni,103)) and (CONVERT(DATETIME,@FechaFin,103))
GO
ALTER AUTHORIZATION ON [dbo].[Sunasa_TramaProgramacionAsistencial] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaPacientesHistoricosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SunasaPacientesHistoricosAgregar]
	@idSunasaPacienteHistorico [int] OUTPUT,
	@idPaciente [int],
	@CodigoIAFA [varchar](5),
	@idPaisTitular [int],
	@idTipoDocumentoTitular [int],
	@NroDocumentoTitular [varchar](10),
	@ApellidoCasada [varchar](35),
	@ValidacionRegIdentidad [bit],
	@NroCarnetIdentidad [varchar](10),
	@EstadoDelSeguro [int],
	@IdAfiliacion [int],
	@ProductoYplan [varchar](7),
	@FechaInicioAfiliacion [datetime],
	@FechaFinalAfiliacion [datetime],
	@idRegimen [int],
	@CodigoEstablecimientoIAFA [varchar](8),
	@CodigoEstablecimientoRENAES [varchar](8),
	@idParentesco [int],
	@RUCempleador [varchar](11),
	@AnteriorIdTipoDocumentoAsegurado [int],
	@AnteriorNroDocumentoAsegurado [varchar](10),
	@DNIusarioOperacion [varchar](8),
	@idOperacion [int],
	@FechaEnvio [datetime],
	@SisSepelioParienteEncargado [varchar](100),
	@SisSepelioDni [varchar](8),
	@SisSepelioFnacimiento [datetime],
	@SisSepelioSexo [int],
	@SisNroAfiliacion [varchar](20),
	@YaNoTieneSeguro [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into SunasaPacientesHistoricos (
idPaciente,CodigoIAFA,idPaisTitular,idTipoDocumentoTitular,NroDocumentoTitular,ApellidoCasada,ValidacionRegIdentidad,NroCarnetIdentidad,EstadoDelSeguro,IdAfiliacion,ProductoYplan,FechaInicioAfiliacion,FechaFinalAfiliacion,idRegimen,CodigoEstablecimientoIAFA,CodigoEstablecimientoRENAES,idParentesco,RUCempleador,AnteriorIdTipoDocumentoAsegurado,AnteriorNroDocumentoAsegurado,DNIusarioOperacion,idOperacion,FechaEnvio,SisSepelioParienteEncargado,SisSepelioDni,SisSepelioFnacimiento,SisSepelioSexo,SisNroAfiliacion,YaNoTieneSeguro
) values (
@idPaciente,@CodigoIAFA,@idPaisTitular,@idTipoDocumentoTitular,@NroDocumentoTitular,@ApellidoCasada,@ValidacionRegIdentidad,@NroCarnetIdentidad,@EstadoDelSeguro,@IdAfiliacion,@ProductoYplan,@FechaInicioAfiliacion,@FechaFinalAfiliacion,@idRegimen,@CodigoEstablecimientoIAFA,@CodigoEstablecimientoRENAES,@idParentesco,@RUCempleador,@AnteriorIdTipoDocumentoAsegurado,@AnteriorNroDocumentoAsegurado,@DNIusarioOperacion,@idOperacion,@FechaEnvio,@SisSepelioParienteEncargado,@SisSepelioDni,@SisSepelioFnacimiento,@SisSepelioSexo,@SisNroAfiliacion,@YaNoTieneSeguro
)
set @idSunasaPacienteHistorico = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idSunasaPacienteHistorico,'SunasaPacientesHistoricos'
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaPacientesHistoricosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SunasaPacientesHistoricosEliminar]
	@idSunasaPacienteHistorico [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from SunasaPacientesHistoricos
where idSunasaPacienteHistorico = @idSunasaPacienteHistorico
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idSunasaPacienteHistorico,'SunasaPacientesHistoricos'
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaPacientesHistoricosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SunasaPacientesHistoricosModificar]
	@idSunasaPacienteHistorico [int],
	@idPaciente [int],
	@CodigoIAFA [varchar](5),
	@idPaisTitular [int],
	@idTipoDocumentoTitular [int],
	@NroDocumentoTitular [varchar](10),
	@ApellidoCasada [varchar](35),
	@ValidacionRegIdentidad [bit],
	@NroCarnetIdentidad [varchar](10),
	@EstadoDelSeguro [int],
	@IdAfiliacion [int],
	@ProductoYplan [varchar](7),
	@FechaInicioAfiliacion [datetime],
	@FechaFinalAfiliacion [datetime],
	@idRegimen [int],
	@CodigoEstablecimientoIAFA [varchar](8),
	@CodigoEstablecimientoRENAES [varchar](8),
	@idParentesco [int],
	@RUCempleador [varchar](11),
	@AnteriorIdTipoDocumentoAsegurado [int],
	@AnteriorNroDocumentoAsegurado [varchar](10),
	@DNIusarioOperacion [varchar](8),
	@idOperacion [int],
	@FechaEnvio [datetime],
	@SisSepelioParienteEncargado [varchar](100),
	@SisSepelioDni [varchar](8),
	@SisSepelioFnacimiento [datetime],
	@SisSepelioSexo [int],
	@SisNroAfiliacion [varchar](20),
	@YaNoTieneSeguro [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update SunasaPacientesHistoricos
set
idPaciente = @idPaciente,
CodigoIAFA = @CodigoIAFA,
idPaisTitular = @idPaisTitular,
idTipoDocumentoTitular = @idTipoDocumentoTitular,
NroDocumentoTitular = @NroDocumentoTitular,
ApellidoCasada = @ApellidoCasada,
ValidacionRegIdentidad = @ValidacionRegIdentidad,
NroCarnetIdentidad = @NroCarnetIdentidad,
EstadoDelSeguro = @EstadoDelSeguro,
IdAfiliacion = @IdAfiliacion,
ProductoYplan = @ProductoYplan,
FechaInicioAfiliacion = @FechaInicioAfiliacion,
FechaFinalAfiliacion = @FechaFinalAfiliacion,
idRegimen = @idRegimen,
CodigoEstablecimientoIAFA = @CodigoEstablecimientoIAFA,
CodigoEstablecimientoRENAES = @CodigoEstablecimientoRENAES,
idParentesco = @idParentesco,
RUCempleador = @RUCempleador,
AnteriorIdTipoDocumentoAsegurado = @AnteriorIdTipoDocumentoAsegurado,
AnteriorNroDocumentoAsegurado = @AnteriorNroDocumentoAsegurado,
DNIusarioOperacion = @DNIusarioOperacion,
idOperacion = @idOperacion,
FechaEnvio = @FechaEnvio,
SisSepelioParienteEncargado = @SisSepelioParienteEncargado,
SisSepelioDni = @SisSepelioDni,
SisSepelioFnacimiento = @SisSepelioFnacimiento,
SisSepelioSexo = @SisSepelioSexo,
SisNroAfiliacion = @SisNroAfiliacion,
YaNoTieneSeguro=@YaNoTieneSeguro
where idSunasaPacienteHistorico = @idSunasaPacienteHistorico AND @idPaciente <> 0
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idSunasaPacienteHistorico,'SunasaPacientesHistoricos'
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaPacientesHistoricosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SunasaPacientesHistoricosSeleccionarPorId]
	@idSunasaPacienteHistorico [int]
WITH EXECUTE AS CALLER
AS
select * from SunasaPacientesHistoricos
where idSunasaPacienteHistorico = @idSunasaPacienteHistorico
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaPacientesHistoricosSeleccionarPorIdPaciente]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SunasaPacientesHistoricosSeleccionarPorIdPaciente]
	@idPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from SunasaPacientesHistoricos
where idPaciente = @idPaciente
order by IdSunasaPacienteHistorico desc
GO
ALTER AUTHORIZATION ON [dbo].[SunasaPacientesHistoricosSeleccionarPorIdPaciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaTiposAfiliacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SunasaTiposAfiliacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from SunasaTiposAfiliacion
order by afiliacion
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposAfiliacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaTiposOperacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SunasaTiposOperacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from SunasaTiposOperacion
order by operacion
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposOperacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaTiposParentescoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SunasaTiposParentescoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from SunasaTiposParentesco
order by parentesco
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposParentescoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SunasaTiposRegimenSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SunasaTiposRegimenSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from SunasaTiposRegimen
order by regimen
GO
ALTER AUTHORIZATION ON [dbo].[SunasaTiposRegimenSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sunat_onuBuscarPorCodigoDescripcion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sunat_onuBuscarPorCodigoDescripcion]
	@codigo [varchar](20),
	@descripcion [varchar](100)
WITH EXECUTE AS CALLER
AS
if @codigo =''
   select * from sunat_onu where descripcion like '%'+@descripcion+'%' order by descripcion
else
   select * from sunat_onu where codigo=@codigo
GO
ALTER AUTHORIZATION ON [dbo].[sunat_onuBuscarPorCodigoDescripcion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioAgregar]
	@id [int] OUTPUT,
	@DctoRDI [varchar](50),
	@fechaEmision [varchar](10),
	@fechaResumen [varchar](10),
	@tipoDcto [varchar](2),
	@SerieDocumento [varchar](15),
	@PacienteTipoDoc [varchar](1),
	@PacienteNumeroDoc [varchar](8),
	@Moneda [varchar](3),
	@OpeGravadas [varchar](15),
	@OpeExoneradas [varchar](15),
	@OpeInafectas [varchar](15),
	@OpeGratuitas [varchar](15),
	@OtrosCargos [varchar](15),
	@TotalIsc [varchar](15),
	@TotalIgv [varchar](15),
	@TotalOtros [varchar](15),
	@ImporteVenta [varchar](15),
	@ModTipoDcto [varchar](5),
	@ModSerie [varchar](5),
	@ModDocumento [varchar](10),
	@PercepRegimen [varchar](15),
	@PercepPorcen [varchar](15),
	@PercepBaseImp [varchar](15),
	@PercepMonto [varchar](15),
	@PercepCobrar [varchar](15),
	@Estado [varchar](1),
	@DctoSunat [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Sunat_ResumenDiario (
DctoRDI,fechaEmision,fechaResumen,tipoDcto,SerieDocumento,PacienteTipoDoc,PacienteNumeroDoc,Moneda,OpeGravadas,OpeExoneradas,OpeInafectas,OpeGratuitas,OtrosCargos,
TotalIsc,TotalIgv,TotalOtros,ImporteVenta,ModTipoDcto,ModSerie,ModDocumento,PercepRegimen,PercepPorcen,PercepBaseImp,PercepMonto,PercepCobrar,Estado,DctoSunat)
values (
@DctoRDI,@fechaEmision,@fechaResumen,@tipoDcto,@SerieDocumento,@PacienteTipoDoc,@PacienteNumeroDoc,@Moneda,@OpeGravadas,@OpeExoneradas,@OpeInafectas,@OpeGratuitas,@OtrosCargos,
@TotalIsc,@TotalIgv,@TotalOtros,@ImporteVenta,@ModTipoDcto,@ModSerie,@ModDocumento,@PercepRegimen,@PercepPorcen,@PercepBaseImp,@PercepMonto,@PercepCobrar,@Estado,@DctoSunat)

set @id = @@identity
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioEliminar]
	@id [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Sunat_ResumenDiario
where id = @id
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioEliminarPorFechaEmision]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioEliminarPorFechaEmision]
	@fechaEmision [varchar](10)
WITH EXECUTE AS CALLER
AS
delete from Sunat_ResumenDiario
where fechaEmision = @fechaEmision
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioEliminarPorFechaEmision] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioModificar]
	@id [int],
	@DctoRDI [varchar](50),
	@fechaEmision [varchar](10),
	@fechaResumen [varchar](10),
	@tipoDcto [varchar](2),
	@SerieDocumento [varchar](15),
	@PacienteTipoDoc [varchar](1),
	@PacienteNumeroDoc [varchar](8),
	@Moneda [varchar](3),
	@OpeGravadas [varchar](15),
	@OpeExoneradas [varchar](15),
	@OpeInafectas [varchar](15),
	@OpeGratuitas [varchar](15),
	@OtrosCargos [varchar](15),
	@TotalIsc [varchar](15),
	@TotalIgv [varchar](15),
	@TotalOtros [varchar](15),
	@ImporteVenta [varchar](15),
	@ModTipoDcto [varchar](5),
	@ModSerie [varchar](5),
	@ModDocumento [varchar](10),
	@PercepRegimen [varchar](15),
	@PercepPorcen [varchar](15),
	@PercepBaseImp [varchar](15),
	@PercepMonto [varchar](15),
	@PercepCobrar [varchar](15),
	@Estado [varchar](1),
	@DctoSunat [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Sunat_ResumenDiario
set
DctoRDI = @DctoRDI,
fechaEmision = @fechaEmision,
fechaResumen = @fechaResumen,
tipoDcto = @tipoDcto,
SerieDocumento = @SerieDocumento,
PacienteTipoDoc = @PacienteTipoDoc,
PacienteNumeroDoc = @PacienteNumeroDoc,Moneda = @Moneda,
OpeGravadas = @OpeGravadas,
OpeExoneradas = @OpeExoneradas,
OpeInafectas = @OpeInafectas,
OpeGratuitas = @OpeGratuitas,
OtrosCargos = @OtrosCargos,

TotalIsc = @TotalIsc,
TotalIgv = @TotalIgv,TotalOtros = @TotalOtros,
ImporteVenta = @ImporteVenta,
ModTipoDcto = @ModTipoDcto,
ModSerie = @ModSerie,
ModDocumento = @ModDocumento,
PercepRegimen = @PercepRegimen,

PercepPorcen = @PercepPorcen,
PercepBaseImp = @PercepBaseImp,
PercepMonto = @PercepMonto,
PercepCobrar = @PercepCobrar,
Estado = @Estado,
DctoSunat = @DctoSunat

where id = @id
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioSeleccionarPorFechaEmision]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioSeleccionarPorFechaEmision]
	@fechaEmision [varchar](10)
WITH EXECUTE AS CALLER
AS
select * from Sunat_ResumenDiario
where fechaEmision = @fechaEmision
order by fechaEmision,estado


GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioSeleccionarPorFechaEmision] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[Sunat_ResumenDiarioSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Sunat_ResumenDiarioSeleccionarPorId]
	@id [int]
WITH EXECUTE AS CALLER
AS
select * from Sunat_ResumenDiario
where id = @id
GO
ALTER AUTHORIZATION ON [dbo].[Sunat_ResumenDiarioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[sunat_ResumenDiarioUltimoCorrelativo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sunat_ResumenDiarioUltimoCorrelativo]
WITH EXECUTE AS CALLER
AS
select top 1 DctoRDI from Sunat_ResumenDiario where len(DctoRDI)=27 and convert(integer,left(fechaResumen,4))=YEAR(getdate())
order by DctoRDI desc
GO
ALTER AUTHORIZATION ON [dbo].[sunat_ResumenDiarioUltimoCorrelativo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SuSalud_upsSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SuSalud_upsSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select descripcion,codigo from SuSalud_ups order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[SuSalud_upsSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[SVGEstructuraSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[SVGEstructuraSeleccionarPorId]
	@Tipo [varchar](20),
	@Codigo [varchar](20)
WITH EXECUTE AS CALLER
AS
select * from SVGEstructura
where Tipo = @Tipo and codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[SVGEstructuraSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TarifasNULLplanesNULLlesAsignaValor]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TarifasNULLplanesNULLlesAsignaValor]
	@IdFormaPago [int],
	@IdFuenteFinanciamiento [int],
	@IdEstado [int],
	@IdEstadoAtencion [int],
	@IdCuentaAtencion [int]
WITH EXECUTE AS CALLER
AS
declare @idFP int
if @IdFuenteFinanciamiento > 0
begin
               DECLARE FFcursor CURSOR FOR select top 1 IdTipoFinanciamiento from FuentesFinanciamientoTarifas where idFuenteFinanciamiento=@IdFuenteFinanciamiento
               OPEN FFcursor
              FETCH NEXT FROM FFcursor INTO @IdFP
               if (@@FETCH_STATUS = -1)
                            set @IdFP=17
	CLOSE FFcursor
	DEALLOCATE FFcursor
--             update parametros set valorint= @idFP where idParametro=1

end

IF @IdFormaPago > 0 And @IdFuenteFinanciamiento > 0
			UPDATE Atenciones SET idFormaPago=@IdFormaPago, idFuenteFinanciamiento= @IdFuenteFinanciamiento WHERE idCuentaAtencion=@IdCuentaAtencion
ELSE

                IF @IdEstado = 9 Or @IdEstadoAtencion = 0
				update Atenciones set idFormaPago=1, idFuenteFinanciamiento=1 where idCuentaAtencion=@IdCuentaAtencion
                ELSE
	                    IF @IdFormaPago = 0 And @IdFuenteFinanciamiento > 0
                                               update Atenciones SET IdFormaPago=@IdFP  WHERE idCuentaAtencion=@IdCuentaAtencion
                                 else
					IF @IdFormaPago > 0
						update Atenciones set idFormaPago=@IdFormaPago where idCuentaAtencion=@IdCuentaAtencion
GO
ALTER AUTHORIZATION ON [dbo].[TarifasNULLplanesNULLlesAsignaValor] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[tempMovimientosEliminarXidUsuario]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[tempMovimientosEliminarXidUsuario]
	@lIdUsuario [int]
WITH EXECUTE AS CALLER
AS
DELETE FROM tempMovimientos where IdUsuario = @lIdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[tempMovimientosEliminarXidUsuario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[tempMovimientosInsertar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[tempMovimientosInsertar]
	@IdMovimiento [int],
	@lIdUsuario [int]
WITH EXECUTE AS CALLER
AS
Insert into tempMovimientos (IdMovimiento, IdUsuario) values
                (@IdMovimiento ,@lIdUsuario)
GO
ALTER AUTHORIZATION ON [dbo].[tempMovimientosInsertar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TieneRolAdministrador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TieneRolAdministrador]
	@lnIdUsuario [int]
WITH EXECUTE AS CALLER
AS
select * from UsuariosRoles where idRol=1 and idEmpleado=@lnIdUsuario
GO
ALTER AUTHORIZATION ON [dbo].[TieneRolAdministrador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciadorAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TipoFinanciadorAgregar]
	@idTipoFinanciador [int] OUTPUT,
	@nombre [varchar](50),
	@denominacion [varchar](50),
	@codigo [varchar](11),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TipoFinanciador (
nombre,denominacion,codigo) values (
@nombre,@denominacion,@codigo)
set @idTipoFinanciador = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idTipoFinanciador,'TipoFinanciador'
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciadorAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciadorEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TipoFinanciadorEliminar]
	@idTipoFinanciador [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TipoFinanciador
where idTipoFinanciador = @idTipoFinanciador
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idTipoFinanciador,'TipoFinanciador'
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciadorEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciadorModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TipoFinanciadorModificar]
	@idTipoFinanciador [int],
	@nombre [varchar](50),
	@denominacion [varchar](50),
	@codigo [varchar](11),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TipoFinanciador
set
nombre = @nombre,
denominacion = @denominacion,
codigo = @codigo
where idTipoFinanciador = @idTipoFinanciador
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idTipoFinanciador,'TipoFinanciador'
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciadorModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciadorSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TipoFinanciadorSeleccionarPorId]
	@idTipoFinanciador [int]
WITH EXECUTE AS CALLER
AS
select * from TipoFinanciador
where idTipoFinanciador = @idTipoFinanciador
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciadorSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciadorSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TipoFinanciadorSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT idTipoFinanciador, nombre, denominacion, codigo
	FROM TipoFinanciador
	ORDER BY nombre
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciadorSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciamientosDevuelveSoloFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TipoFinanciamientosDevuelveSoloFarmacia]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)
SET @SQL = 'SELECT      dbo.TiposFinanciamiento.*, dbo.CajaTiposComprobante.Descripcion AS dComprobante
		          FROM          dbo.TiposFinanciamiento LEFT OUTER JOIN dbo.CajaTiposComprobante ON dbo.TiposFinanciamiento.idCajaTiposComprobante = dbo.CajaTiposComprobante.IdTipoComprobante
                       WHERE      dbo.TiposFinanciamiento.esFarmacia=1 ' +  @Filtro  + ' order by dbo.TiposFinanciamiento.descripcion'
EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciamientosDevuelveSoloFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciamientosDevuelveSoloPlanes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TipoFinanciamientosDevuelveSoloPlanes]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)
SET @SQL = 'SELECT     dbo.TiposFinanciamiento.*
                       FROM        dbo.TiposFinanciamiento
                       WHERE     dbo.TiposFinanciamiento.esFuenteFinanciamiento=1 '  + @Filtro +  ' order by dbo.TiposFinanciamiento.descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciamientosDevuelveSoloPlanes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TipoFinanciamientosParaCatalogoBienes]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TipoFinanciamientosParaCatalogoBienes]
WITH EXECUTE AS CALLER
AS
SELECT                dbo.TiposFinanciamiento.*
             FROM      dbo.TiposFinanciamiento
             WHERE   dbo.TiposFinanciamiento.idtipoFinanciamiento=0 or dbo.TiposFinanciamiento.idtipoFinanciamiento=1  order by dbo.TiposFinanciamiento.descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TipoFinanciamientosParaCatalogoBienes] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposActividadesSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposActividadesSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from TiposActividades order by idTipoActividades
GO
ALTER AUTHORIZATION ON [dbo].[TiposActividadesSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposAltaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposAltaAgregar]
	@Descripcion [varchar](50),
	@IdTipoAlta [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposAlta (
Descripcion) values (
@Descripcion)
set @IdTipoAlta = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoAlta,'TiposAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposAltaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposAltaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposAltaEliminar]
	@IdTipoAlta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposAlta
where IdTipoAlta = @IdTipoAlta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoAlta,'TiposAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposAltaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposAltaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposAltaModificar]
	@Descripcion [varchar](50),
	@IdTipoAlta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposAlta
set
Descripcion = @Descripcion
where IdTipoAlta = @IdTipoAlta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoAlta,'TiposAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposAltaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposAltaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposAltaSeleccionarPorId]
	@IdTipoAlta [int]
WITH EXECUTE AS CALLER
AS
select * from TiposAlta
where IdTipoAlta = @IdTipoAlta
GO
ALTER AUTHORIZATION ON [dbo].[TiposAltaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposAltaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposAltaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoAlta, Descripcion,
(Convert(varchar(5), IdTipoAlta) + ' = ' + Descripcion) as DescripcionLarga
 from TiposAlta
GO
ALTER AUTHORIZATION ON [dbo].[TiposAltaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCamaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCamaAgregar]
	@Descripcion [varchar](50),
	@IdTipoCama [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposCama (
Descripcion) values (
@Descripcion)
set @IdTipoCama = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[TiposCamaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCamaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCamaEliminar]
	@IdTipoCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCama
where IdTipoCama = @IdTipoCama
GO
ALTER AUTHORIZATION ON [dbo].[TiposCamaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCamaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCamaModificar]
	@Descripcion [varchar](50),
	@IdTipoCama [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCama
set
Descripcion = @Descripcion
where IdTipoCama = @IdTipoCama
GO
ALTER AUTHORIZATION ON [dbo].[TiposCamaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCamaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCamaSeleccionarPorId]
	@IdTipoCama [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCama
where IdTipoCama = @IdTipoCama
GO
ALTER AUTHORIZATION ON [dbo].[TiposCamaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCamaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCamaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoCama, Descripcion,
(Convert(varchar(5), IdTipoCama) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCama
GO
ALTER AUTHORIZATION ON [dbo].[TiposCamaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCargoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCargoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from TiposCargo order by Cargo
GO
ALTER AUTHORIZATION ON [dbo].[TiposCargoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCitaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCitaEliminar]
	@IdTipoCita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCita
where IdTipoCita = @IdTipoCita
GO
ALTER AUTHORIZATION ON [dbo].[TiposCitaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCitaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCitaModificar]
	@Descripcion [varchar](50),
	@IdTipoCita [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCita
set
Descripcion = @Descripcion
where IdTipoCita = @IdTipoCita
GO
ALTER AUTHORIZATION ON [dbo].[TiposCitaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCitaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCitaSeleccionarPorId]
	@IdTipoCita [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCita
where IdTipoCita = @IdTipoCita
GO
ALTER AUTHORIZATION ON [dbo].[TiposCitaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCitaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCitaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoCita, Descripcion,
(Convert(varchar(5), IdTipoCita) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCita
GO
ALTER AUTHORIZATION ON [dbo].[TiposCitaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionAltaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionAltaAgregar]
	@Descripcion [varchar](50),
	@IdCondicionAlta [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposCondicionAlta (
Descripcion) values (
@Descripcion)
set @IdCondicionAlta = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCondicionAlta,'TiposCondicionAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAltaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionAltaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionAltaEliminar]
	@IdCondicionAlta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCondicionAlta
where IdCondicionAlta = @IdCondicionAlta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCondicionAlta,'TiposCondicionAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAltaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionAltaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionAltaModificar]
	@Descripcion [varchar](50),
	@IdCondicionAlta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCondicionAlta
set
Descripcion = @Descripcion
where IdCondicionAlta = @IdCondicionAlta
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCondicionAlta,'TiposCondicionAlta'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAltaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionAltaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionAltaSeleccionarPorId]
	@IdCondicionAlta [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCondicionAlta
where IdCondicionAlta = @IdCondicionAlta
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAltaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionAltaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCondicionAltaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCondicionAlta, Descripcion,
(Convert(varchar(5), IdCondicionAlta) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCondicionAlta
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionAltaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionOcupacionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionOcupacionAgregar]
	@Descripcion [varchar](50),
	@IdCondicionOcupacion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposCondicionOcupacion (
Descripcion) values (
@Descripcion)
set @IdCondicionOcupacion = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionOcupacionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionOcupacionEliminar]
	@IdCondicionOcupacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCondicionOcupacion
where IdCondicionOcupacion = @IdCondicionOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionOcupacionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionOcupacionModificar]
	@Descripcion [varchar](50),
	@IdCondicionOcupacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCondicionOcupacion
set
Descripcion = @Descripcion
where IdCondicionOcupacion = @IdCondicionOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionOcupacionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionOcupacionSeleccionarPorId]
	@IdCondicionOcupacion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCondicionOcupacion
where IdCondicionOcupacion = @IdCondicionOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionOcupacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCondicionOcupacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCondicionOcupacion, Descripcion,
(Convert(varchar(5), IdCondicionOcupacion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCondicionOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionOcupacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteAgregar]
	@Descripcion [varchar](50),
	@IdTipoCondicionPaciente [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposCondicionPaciente (
Descripcion) values (
@Descripcion)
set @IdTipoCondicionPaciente = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoCondicionPaciente,'TiposCondicionPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteCondicionAlEstablecimientoYservicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteCondicionAlEstablecimientoYservicio]
	@IdPaciente [int],
	@ldFechaIngreso [datetime],
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
select    FechaIngreso,idTipoCondicionAlEstab,idTipoCondicionAlServicio,IdServicioIngreso from Atenciones
               where    idEstadoAtencion>=1 and IdPaciente = @IdPaciente
                     and  FechaIngreso <= @ldFechaIngreso
                     and  IdAtencion <> @IdAtencion  AND NOT (dbo.Atenciones.IdTipoCondicionALEstab IS NULL)
               order by FechaIngreso desc,HoraIngreso Desc
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteCondicionAlEstablecimientoYservicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteEliminar]
	@IdTipoCondicionPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCondicionPaciente
where IdTipoCondicionPaciente = @IdTipoCondicionPaciente
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoCondicionPaciente,'TiposCondicionPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteFiltrarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteFiltrarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoCondicionPaciente, Descripcion, convert(varchar(5), IdTipoCondicionPaciente) + '= ' + Descripcion as DescripcionLarga From TiposCondicionPaciente
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteModificar]
	@Descripcion [varchar](50),
	@IdTipoCondicionPaciente [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCondicionPaciente
set
Descripcion = @Descripcion
where IdTipoCondicionPaciente = @IdTipoCondicionPaciente
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoCondicionPaciente,'TiposCondicionPaciente'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteSeleccionarPorId]
	@IdTipoCondicionPaciente [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCondicionPaciente
where IdTipoCondicionPaciente = @IdTipoCondicionPaciente
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionPacienteSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCondicionPacienteSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoCondicionPaciente, Descripcion
, convert(varchar(5), IdTipoCondicionPaciente) + '= ' + Descripcion as DescripcionLarga
from TiposCondicionPaciente
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionPacienteSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionRecienNacidoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionRecienNacidoAgregar]
	@Descripcion [varchar](20),
	@IdCondicionRN [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposCondicionRecienNacido (
Descripcion) values (
@Descripcion)
set @IdCondicionRN = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdCondicionRN,'TiposCondicionRecienNacido'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacidoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionRecienNacidoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionRecienNacidoEliminar]
	@IdCondicionRN [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCondicionRecienNacido
where IdCondicionRN = @IdCondicionRN
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdCondicionRN,'TiposCondicionRecienNacido'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacidoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionRecienNacidoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionRecienNacidoModificar]
	@Descripcion [varchar](20),
	@IdCondicionRN [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCondicionRecienNacido
set
Descripcion = @Descripcion
where IdCondicionRN = @IdCondicionRN
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdCondicionRN,'TiposCondicionRecienNacido'
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacidoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionRecienNacidoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionRecienNacidoSeleccionarPorId]
	@IdCondicionRN [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCondicionRecienNacido
where IdCondicionRN = @IdCondicionRN
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacidoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionRecienNacidoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposCondicionRecienNacidoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCondicionRN, Descripcion,
(Convert(varchar(5), IdCondicionRN) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCondicionRecienNacido
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionRecienNacidoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionTrabajoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionTrabajoEliminar]
	@IdCondicionTrabajo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposCondicionTrabajo
where IdCondicionTrabajo = @IdCondicionTrabajo
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionTrabajoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionTrabajoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionTrabajoModificar]
	@IdCondicionTrabajo [int],
	@Descripcion [varchar](50),
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposCondicionTrabajo
set
Descripcion = @Descripcion
where IdCondicionTrabajo = @IdCondicionTrabajo
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionTrabajoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionTrabajoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionTrabajoSeleccionarPorId]
	@IdCondicionTrabajo [int]
WITH EXECUTE AS CALLER
AS
select * from TiposCondicionTrabajo
where IdCondicionTrabajo = @IdCondicionTrabajo
GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionTrabajoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposCondicionTrabajoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposCondicionTrabajoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdCondicionTrabajo, Descripcion,
(Convert(varchar(5), IdCondicionTrabajo) + ' = ' + Descripcion) as DescripcionLarga
 from TiposCondicionTrabajo
 --SCCQ 12/03/2020 Cambio2 Inicio
 where IndFlag =1
 --SCCQ 12/03/2020 Cambio2 Fin
order by IdCondicionTrabajo

GO
ALTER AUTHORIZATION ON [dbo].[TiposCondicionTrabajoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposConsultaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposConsultaEliminar]
	@IdTipoConsulta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposConsulta
where IdTipoConsulta = @IdTipoConsulta
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsultaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposConsultaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposConsultaModificar]
	@Descripcion [varchar](50),
	@IdTipoConsulta [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposConsulta
set
Descripcion = @Descripcion
where IdTipoConsulta = @IdTipoConsulta
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsultaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposConsultaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposConsultaSeleccionarPorId]
	@IdTipoConsulta [int]
WITH EXECUTE AS CALLER
AS
select * from TiposConsulta
where IdTipoConsulta = @IdTipoConsulta
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsultaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposConsultaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposConsultaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoConsulta, Descripcion,
(Convert(varchar(5), IdTipoConsulta) + ' = ' + Descripcion) as DescripcionLarga
 from TiposConsulta
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsultaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposConsumosDevuelveTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposConsumosDevuelveTodos]
	@Filtro [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)

IF @Filtro <> ' '
	SET  @SQL = 'select * from TiposConsumos Where '  + @Filtro + ' order by descripcion'
ELSE
	SET  @SQL = 'select * from TiposConsumos order by Descripcion'

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TiposConsumosDevuelveTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestacadosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestacadosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from TiposDestacados
order by destacado
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestacadosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionAgregar]
	@IdTipoServicio [int],
	@Descripcion [varchar](50),
	@Codigo [char](1),
	@IdDestinoAtencion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposDestinoAtencion (
IdTipoServicio,Descripcion,Codigo) values (
@IdTipoServicio,@Descripcion,@Codigo)
set @IdDestinoAtencion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdDestinoAtencion,'TiposDestinoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionDevuelveIdSis]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionDevuelveIdSis]
	@lnIdDestinoAtencionGalenHos [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDestinoAtencion where idDestinoAtencion=@lnIdDestinoAtencionGalenHos
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionDevuelveIdSis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionEliminar]
	@IdDestinoAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposDestinoAtencion
where IdDestinoAtencion = @IdDestinoAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDestinoAtencion,'TiposDestinoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionModificar]
	@IdTipoServicio [int],
	@Descripcion [varchar](50),
	@Codigo [char](1),
	@IdDestinoAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposDestinoAtencion
set
IdTipoServicio = @IdTipoServicio,
Descripcion = @Descripcion,
Codigo = @Codigo
where IdDestinoAtencion = @IdDestinoAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDestinoAtencion,'TiposDestinoAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioEmergencia]
WITH EXECUTE AS CALLER
AS
select IdDestinoAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposDestinoAtencion where IdTipoServicio = 2
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioExterno]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioExterno]
WITH EXECUTE AS CALLER
AS
select IdDestinoAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposDestinoAtencion where IdTipoServicio = 1
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSeleccionarDestinosDeConsultorioExterno] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSeleccionarDestinosDeHospitalizacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSeleccionarDestinosDeHospitalizacion]
	@TipoServicioHosp [int]
WITH EXECUTE AS CALLER
AS
select IdDestinoAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposDestinoAtencion where IdTipoServicio = 3 and TipoServicioHosp=@TipoServicioHosp
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSeleccionarDestinosDeHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSeleccionarDestinosDeObsEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSeleccionarDestinosDeObsEmergencia]
WITH EXECUTE AS CALLER
AS
select IdDestinoAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposDestinoAtencion where IdTipoServicio = 4
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSeleccionarDestinosDeObsEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSeleccionarPorId]
	@IdDestinoAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDestinoAtencion
where IdDestinoAtencion = @IdDestinoAtencion
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionSoloSIS]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionSoloSIS]
	@lnIdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDestinoAtencion where not (id_destinoAseguradoSIS is null) and idTipoServicio=@lnIdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionSoloSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionXidDestinoAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionXidDestinoAtencion]
	@lnIdDestinoAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDestinoAtencion where idDestinoAtencion=@lnIdDestinoAtencion
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionXidDestinoAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDestinoAtencionXidtipoServicioCodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDestinoAtencionXidtipoServicioCodigo]
	@IdTipoServicio [int],
	@codigo [varchar](1)
WITH EXECUTE AS CALLER
AS
select * from TiposDestinoAtencion where Codigo = @codigo  and IdTipoServicio = @IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[TiposDestinoAtencionXidtipoServicioCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadDevuelveIdSis]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadDevuelveIdSis]
	@lnIdTipoDocumentoGalenHos [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDocIdentidad where idDocIdentidad=@lnIdTipoDocumentoGalenHos
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadDevuelveIdSis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadDevuelveTipoDocumentoGal]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadDevuelveTipoDocumentoGal]
	@idTipoDocumentoSIS [int]
WITH EXECUTE AS CALLER
AS
select IdDocIdentidad from TiposDocIdentidad
where CodigoSIS=@idTipoDocumentoSIS
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadDevuelveTipoDocumentoGal] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadDevuelveTipoDocumentoSis]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadDevuelveTipoDocumentoSis]
	@idTipoDocumentoGalenhos [int]
WITH EXECUTE AS CALLER
AS
select CodigoSIS from TiposDocIdentidad
where idDocIdentidad=@idTipoDocumentoGalenhos
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadDevuelveTipoDocumentoSis] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadEliminar]
	@IdDocIdentidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposDocIdentidad
where IdDocIdentidad = @IdDocIdentidad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdDocIdentidad,'TiposDocIdentidad'
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadFiltrarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadFiltrarTodos]
WITH EXECUTE AS CALLER
AS
select IdDocIdentidad, Descripcion, (Convert(varchar(5), IdDocIdentidad) + ' = ' + Descripcion) as DescripcionLarga From TiposDocIdentidad
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadModificar]
	@Descripcion [varchar](50),
	@IdDocIdentidad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposDocIdentidad
set
Descripcion = @Descripcion
where IdDocIdentidad = @IdDocIdentidad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdDocIdentidad,'TiposDocIdentidad'
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadSeleccionarPorId]
	@IdDocIdentidad [int]
WITH EXECUTE AS CALLER
AS
select * from TiposDocIdentidad
where IdDocIdentidad = @IdDocIdentidad
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdDocIdentidad, Descripcion,
(Convert(varchar(5), IdDocIdentidad) + ' = ' + Descripcion) as DescripcionLarga
 from TiposDocIdentidad
 --SCCQ 13/03/2020 Cambio2 Inicio
 where IdDocIdentidad<>0
 --SCCQ 13/03/2020 Cambio2 Fin

GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadSeleccionarTodosIncSinTipoDoc]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadSeleccionarTodosIncSinTipoDoc]
WITH EXECUTE AS CALLER
AS
--SCCQ 13/03/2020 Cambio2 Inicio
	--SELECT 0 AS IdDocIdentidad, '' AS Descripcion, '0 = SIN DOCUMENTO' AS DescripcionLarga
	--UNION
--SCCQ 13/03/2020 Cambio2 Inicio
	SELECT IdDocIdentidad, Descripcion,  (Convert(varchar(5), IdDocIdentidad) + ' = ' + Descripcion) AS DescripcionLarga
	FROM TiposDocIdentidad

--CAMBIO ID 21

--SCCQ 02/06/2020 Cambio21 Inicio

update Proveedores set RazonSocial ='SOAT MAPFRE' where idProveedor=1356
--SCCQ 02/06/2020 Cambio21 Fin

--CAMBIO ID 22

--SCCQ 03/06/2020 Cambio22 Inicio
if not exists
	(select * from Parametros where IdParametro=600)
	begin
		INSERT [dbo].[Parametros] ([IdParametro], [Tipo], [Codigo], [ValorTexto], [ValorInt], [ValorFloat], [Descripcion], [Grupo]) VALUES (600,'DATOS_GENERALES', NULL, NULL, NULL, NULL,'Mensaje y ruta para actualizar versión con archivo bat.', NULL)
	end
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadSeleccionarTodosIncSinTipoDoc] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposDocIdentidadXfiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposDocIdentidadXfiltro]
	@Filtro [varchar](500)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(1000)

seT  @SQL =  'select CodigoHis from TiposDocIdentidad where  ' + @Filtro

EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TiposDocIdentidadXfiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEdadAgregar]
	@Descripcion [varchar](10),
	@Codigo [char](1),
	@IdTipoEdad [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposEdad (
Descripcion,Codigo) values (
@Descripcion,@Codigo)
set @IdTipoEdad = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoEdad,'TiposEdad'
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEdadEliminar]
	@IdTipoEdad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposEdad
where IdTipoEdad = @IdTipoEdad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoEdad,'TiposEdad'
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEdadModificar]
	@Descripcion [varchar](10),
	@Codigo [char](1),
	@IdTipoEdad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposEdad
set
Descripcion = @Descripcion,
Codigo = @Codigo
where IdTipoEdad = @IdTipoEdad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoEdad,'TiposEdad'
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEdadSeleccionarPorId]
	@IdTipoEdad [int]
WITH EXECUTE AS CALLER
AS
select * from TiposEdad
where IdTipoEdad = @IdTipoEdad
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEdadSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoEdad, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposEdad
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEdadXcodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEdadXcodigo]
	@codigo [varchar](1)
WITH EXECUTE AS CALLER
AS
-- select IdTipoEdad from TiposEdad where Codigo =  @codigo
select * from TiposEdad where Codigo =  @codigo
GO
ALTER AUTHORIZATION ON [dbo].[TiposEdadXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEmpleadoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEmpleadoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoEmpleado, Descripcion,
(Convert(varchar(5), IdTipoEmpleado) + ' = ' + Descripcion) as DescripcionLarga
 from TiposEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleadoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEmpleadosSeleccionarId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEmpleadosSeleccionarId]
	@IdTipoEmpleado [int]
WITH EXECUTE AS CALLER
AS
SELECT dbo.TiposEmpleado.EsColegiatura
	FROM   dbo.TiposEmpleado
	where  IdTipoEmpleado = @IdTipoEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleadosSeleccionarId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEmpleadosSeleccionarIdMedico]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEmpleadosSeleccionarIdMedico]
	@IdMedico [int]
WITH EXECUTE AS CALLER
AS
SELECT       dbo.TiposEmpleado.Descripcion, dbo.Empleados.IdEmpleado, dbo.Medicos.IdMedico
             FROM           dbo.Empleados LEFT OUTER JOIN
                                  dbo.Medicos ON dbo.Empleados.IdEmpleado = dbo.Medicos.IdEmpleado LEFT OUTER JOIN
                                  dbo.TiposEmpleado ON dbo.Empleados.IdTipoEmpleado = dbo.TiposEmpleado.IdTipoEmpleado
             Where           dbo.Medicos.IdMedico =@IdMedico
GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleadosSeleccionarIdMedico] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEmpleadosSeleccionarSegunFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEmpleadosSeleccionarSegunFiltro]
	@Where [varchar](80)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(500)

SET  @SQL =  'select IdTipoEmpleado,descripcion as DescripcionLarga from TiposEmpleado ' +  @Where


EXECUTE (@SQL)

GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleadosSeleccionarSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEmpleadosSeleccionarSiSeProgramaPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEmpleadosSeleccionarSiSeProgramaPorId]
	@IdTipoEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from TiposEmpleado
where idTipoEmpleado=@IdTipoEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[TiposEmpleadosSeleccionarSiSeProgramaPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilEliminar]
	@IdEstadoCivil [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposEstadoCivil
where IdEstadoCivil = @IdEstadoCivil
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstadoCivil,'TiposEstadoCivil',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilModificar]
	@Descripcion [varchar](50),
	@IdEstadoCivil [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposEstadoCivil
set
Descripcion = @Descripcion
where IdEstadoCivil = @IdEstadoCivil
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdEstadoCivil,'TiposEstadoCivil',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilSeleccionarPorId]
	@IdEstadoCivil [int]
WITH EXECUTE AS CALLER
AS
select * from TiposEstadoCivil
where IdEstadoCivil = @IdEstadoCivil
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoCivil, Descripcion,
(Convert(varchar(5), IdEstadoCivil) + ' = ' + Descripcion) as DescripcionLarga
 from TiposEstadoCivil
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilTodos]
WITH EXECUTE AS CALLER
AS
select IdEstadoCivil, left(Descripcion,15) as dCorto  from TiposEstadoCivil order by Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposEstadoCivilXidEstadoCivil]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposEstadoCivilXidEstadoCivil]
	@IdEstadoCivil [int]
WITH EXECUTE AS CALLER
AS
select * from TiposEstadoCivil where idEstadoCivil=@IdEstadoCivil
GO
ALTER AUTHORIZATION ON [dbo].[TiposEstadoCivilXidEstadoCivil] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoAgregar]
	@Descripcion [varchar](50),
	@IdTipoFinanciamiento [int],
	@esOficina [bit],
	@esSalida [bit],
	@SeIngresPrecios [bit],
	@EsFarmacia [bit],
	@idCajaTiposComprobante [int],
	@tipoVenta [varchar](1),
	@SeImprimeComprobante [bit],
	@esFuenteFinanciamiento [bit],
	@GeneraPago [int],
	@idTipoConcepto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposFinanciamiento (IdTipoFinanciamiento,Descripcion,esOficina,esSalida,SeIngresPrecios,EsFarmacia,idCajaTiposComprobante,
				tipoVenta,SeImprimeComprobante,esFuenteFinanciamiento,GeneraPago,idTipoConcepto)
values (@IdTipoFinanciamiento,@Descripcion,@esOficina,@esSalida,@SeIngresPrecios,@EsFarmacia,@idCajaTiposComprobante,
				@tipoVenta,@SeImprimeComprobante,@esFuenteFinanciamiento,@GeneraPago,@idTipoConcepto)


--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoFinanciamiento,'TiposFinanciamiento'
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoDevuelveComoSeTrabajaEnEstadoCuenta]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoDevuelveComoSeTrabajaEnEstadoCuenta]
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT * from TiposFinanciamiento where idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoDevuelveComoSeTrabajaEnEstadoCuenta] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoEliminar]
	@IdTipoFinanciamiento [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposFinanciamiento
where IdTipoFinanciamiento = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoModificar]
	@Descripcion [varchar](50),
	@IdTipoFinanciamiento [int],
	@esOficina [bit],
	@esSalida [bit],
	@SeIngresPrecios [bit],
	@EsFarmacia [bit],
	@idCajaTiposComprobante [int],
	@tipoVenta [varchar](1),
	@SeImprimeComprobante [bit],
	@esFuenteFinanciamiento [bit],
	@GeneraPago [int],
	@idTipoConcepto [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposFinanciamiento
set
Descripcion = @Descripcion,
esOficina=@esOficina,
esSalida=@esSalida,
SeIngresPrecios=@SeIngresPrecios,
EsFarmacia=@EsFarmacia,
idCajaTiposComprobante=@idCajaTiposComprobante,
tipoVenta=@tipoVenta,
SeImprimeComprobante=@SeImprimeComprobante,
esFuenteFinanciamiento=@esFuenteFinanciamiento,
GeneraPago=@GeneraPago,
idTipoConcepto=@idTipoConcepto
where IdTipoFinanciamiento = @IdTipoFinanciamiento
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoFinanciamiento,'TiposFinanciamiento'
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSegunFiltro]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSegunFiltro]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'select * from TiposFinanciamiento where '+ @lcFiltro +' order by descripcion'


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSegunFiltro] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSeleccionarParaCaja]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSeleccionarParaCaja]
WITH EXECUTE AS CALLER
AS
select
IdTipoFinanciamiento, Descripcion, (convert(varchar(5), IdTipoFinanciamiento) + ' = ' + Descripcion) as DescripcionLarga
from TiposFinanciamiento
where IdTipoFinanciamiento in (1,5)
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSeleccionarParaCaja] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSeleccionarPorId]
	@IdTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento
where IdTipoFinanciamiento = @IdTipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSeleccionarSoloConPlan]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSeleccionarSoloConPlan]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento
where esFuenteFinanciamiento=1
order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSeleccionarSoloConPlan] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSeleccionarSoloIngresaPrecios]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSeleccionarSoloIngresaPrecios]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento
where seIngresPrecios=1 and idTipoFinanciamiento>0
order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSeleccionarSoloIngresaPrecios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select
IdTipoFinanciamiento, Descripcion, (convert(varchar(5), IdTipoFinanciamiento) + ' = ' + Descripcion) as DescripcionLarga
from TiposFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoSoloFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoSoloFarmacia]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento
where esFarmacia=1
order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoSoloFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientosSeleccionarPorGeneraPagos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientosSeleccionarPorGeneraPagos]
	@generaPago [int],
	@TipoGeneraPago [int]
WITH EXECUTE AS CALLER
AS
If @TipoGeneraPago = 1 --parametro genera pago
	Begin

	select * from TiposFinanciamiento where generaPago=@generaPago Order by Descripcion

	End

Else If @TipoGeneraPago = 2 -- genera pago 2,3,4
	Begin

	select * from TiposFinanciamiento where generaPago in (2,3,4) order by descripcion

	End
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientosSeleccionarPorGeneraPagos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientosTarifaSeleccionarPorPlan]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientosTarifaSeleccionarPorPlan]
	@IdFuenteFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.FuentesFinanciamientoTarifas.idFuenteFinanciamiento, dbo.FuentesFinanciamientoTarifas.idTipoFinanciamiento,
                                dbo.TiposFinanciamiento.Descripcion
             FROM         dbo.FuentesFinanciamientoTarifas LEFT OUTER JOIN
                                dbo.TiposFinanciamiento ON dbo.FuentesFinanciamientoTarifas.idTipoFinanciamiento = dbo.TiposFinanciamiento.IdTipoFinanciamiento
             where         dbo.FuentesFinanciamientoTarifas.idFuenteFinanciamiento=@IdFuenteFinanciamiento
             Order by      dbo.TiposFinanciamiento.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientosTarifaSeleccionarPorPlan] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposFinanciamientoXidentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposFinanciamientoXidentificador]
	@IdtipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
select * from TiposFinanciamiento where idTipoFinanciamiento=@IdtipoFinanciamiento
GO
ALTER AUTHORIZATION ON [dbo].[TiposFinanciamientoXidentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionEliminar]
	@IdGradoInstruccion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposGradoInstruccion
where IdGradoInstruccion = @IdGradoInstruccion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGradoInstruccion,'TiposGradoInstruccion',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionModificar]
	@Descripcion [varchar](50),
	@IdGradoInstruccion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposGradoInstruccion
set
Descripcion = @Descripcion
where IdGradoInstruccion = @IdGradoInstruccion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdGradoInstruccion,'TiposGradoInstruccion',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionSeleccionarPorId]
	@IdGradoInstruccion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposGradoInstruccion
where IdGradoInstruccion = @IdGradoInstruccion
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdGradoInstruccion, Descripcion,
(Convert(varchar(5), IdGradoInstruccion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposGradoInstruccion
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionTodos]
WITH EXECUTE AS CALLER
AS
select IdGradoInstruccion, left(Descripcion,40) as dCorto from TiposGradoInstruccion order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGradoInstruccionXidGradoInstruccion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposGradoInstruccionXidGradoInstruccion]
	@IdGradoInstruccion [int]
WITH EXECUTE AS CALLER
AS
select sip2000 from TiposGradoInstruccion where idGradoInstruccion=@IdGradoInstruccion
GO
ALTER AUTHORIZATION ON [dbo].[TiposGradoInstruccionXidGradoInstruccion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGravedadAtencionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGravedadAtencionAgregar]
	@Descripcion [varchar](50),
	@IdTipoGravedad [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposGravedadAtencion (
Descripcion) values (
@Descripcion)
set @IdTipoGravedad = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoGravedad,'TiposGravedadAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGravedadAtencionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGravedadAtencionEliminar]
	@IdTipoGravedad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposGravedadAtencion
where IdTipoGravedad = @IdTipoGravedad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoGravedad,'TiposGravedadAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGravedadAtencionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGravedadAtencionModificar]
	@Descripcion [varchar](50),
	@IdTipoGravedad [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposGravedadAtencion
set
Descripcion = @Descripcion
where IdTipoGravedad = @IdTipoGravedad
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoGravedad,'TiposGravedadAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGravedadAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGravedadAtencionSeleccionarPorId]
	@IdTipoGravedad [int]
WITH EXECUTE AS CALLER
AS
select * from TiposGravedadAtencion
where IdTipoGravedad = @IdTipoGravedad
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposGravedadAtencionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposGravedadAtencionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoGravedad, Descripcion+ ' (sem='+codigoSEM +')' AS DESCRIPCION, convert(varchar, IdTipoGravedad) + ' '+  Descripcion as DescripcionLarga
from TiposGravedadAtencion
GO
ALTER AUTHORIZATION ON [dbo].[TiposGravedadAtencionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposHistoriaClinicaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposHistoriaClinicaAgregar]
	@Descripcion [varchar](50),
	@IdTipoHistoria [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposHistoriaClinica (
Descripcion) values (
@Descripcion)
set @IdTipoHistoria = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinicaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposHistoriaClinicaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposHistoriaClinicaEliminar]
	@IdTipoHistoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposHistoriaClinica
where IdTipoHistoria = @IdTipoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinicaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposHistoriaClinicaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposHistoriaClinicaModificar]
	@Descripcion [varchar](50),
	@IdTipoHistoria [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposHistoriaClinica
set
Descripcion = @Descripcion
where IdTipoHistoria = @IdTipoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinicaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposHistoriaClinicaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposHistoriaClinicaSeleccionarPorId]
	@IdTipoHistoria [int]
WITH EXECUTE AS CALLER
AS
select * from TiposHistoriaClinica
where IdTipoHistoria = @IdTipoHistoria
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinicaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposHistoriaClinicaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposHistoriaClinicaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoHistoria, Descripcion,
(Convert(varchar(5), IdTipoHistoria) + ' = ' + Descripcion) as DescripcionLarga
 from TiposHistoriaClinica
GO
ALTER AUTHORIZATION ON [dbo].[TiposHistoriaClinicaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposIdiomasSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposIdiomasSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT *, left(lengua,10) as dCorto from TiposIdiomas order by lengua
GO
ALTER AUTHORIZATION ON [dbo].[TiposIdiomasSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaAgregar]
	@Descripcion [varchar](50),
	@IdTipoNumeracion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposNumeracionHistoria (
Descripcion) values (
@Descripcion)
set @IdTipoNumeracion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoNumeracion,'TiposNumeracionHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaEliminar]
	@IdTipoNumeracion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposNumeracionHistoria
where IdTipoNumeracion = @IdTipoNumeracion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoNumeracion,'TiposNumeracionHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaModificar]
	@Descripcion [varchar](50),
	@IdTipoNumeracion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposNumeracionHistoria
set
Descripcion = @Descripcion
where IdTipoNumeracion = @IdTipoNumeracion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoNumeracion,'TiposNumeracionHistoria'
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarDeConsultaExterna]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarDeConsultaExterna]
WITH EXECUTE AS CALLER
AS
select IdTipoNumeracion, Descripcion,
(Convert(varchar(5), IdTipoNumeracion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposNumeracionHistoria where IdTipoNumeracion in (1,2,3,4,7)
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarDeConsultaExterna] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarDeEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarDeEmergencia]
WITH EXECUTE AS CALLER
AS
select IdTipoNumeracion, Descripcion,
(Convert(varchar(5), IdTipoNumeracion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposNumeracionHistoria where IdTipoNumeracion  in (1,2,3,4,5,7)
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarDeEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarDefinitivos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarDefinitivos]
	@IdTipoAdicional [int]
WITH EXECUTE AS CALLER
AS
select IdTipoNumeracion, Descripcion,
(Convert(varchar(5), IdTipoNumeracion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposNumeracionHistoria
where IdTipoNumeracion in (1,2,3)
or IdTipoNumeracion = @IdTipoAdicional
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarDefinitivos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarDeHospitalizacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarDeHospitalizacion]
WITH EXECUTE AS CALLER
AS
select IdTipoNumeracion, Descripcion,
(Convert(varchar(5), IdTipoNumeracion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposNumeracionHistoria where IdTipoNumeracion  in (1,2,3,4,6,7)
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarDeHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarPorId]
	@IdTipoNumeracion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposNumeracionHistoria
where IdTipoNumeracion = @IdTipoNumeracion
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposNumeracionHistoriaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposNumeracionHistoriaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoNumeracion, Descripcion,
(Convert(varchar(5), IdTipoNumeracion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposNumeracionHistoria
GO
ALTER AUTHORIZATION ON [dbo].[TiposNumeracionHistoriaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOcupacionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOcupacionEliminar]
	@IdTipoOcupacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposOcupacion
where IdTipoOcupacion = @IdTipoOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOcupacionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOcupacionModificar]
	@descripcion [varchar](50),
	@IdTipoOcupacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposOcupacion
set
descripcion = @descripcion
where IdTipoOcupacion = @IdTipoOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOcupacionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOcupacionSeleccionarPorId]
	@IdTipoOcupacion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposOcupacion
where IdTipoOcupacion = @IdTipoOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOcupacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposOcupacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoOcupacion, Descripcion,
(Convert(varchar(5), IdTipoOcupacion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposOcupacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOcupacionTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposOcupacionTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoOcupacion, left(Descripcion,30) as dCorto  from TiposOcupacion order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOcupacionTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionAgregar]
	@IdTipoServicio [int],
	@Descripcion [varchar](50),
	@Codigo [char](1),
	@IdOrigenAtencion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposOrigenAtencion (
IdTipoServicio,Descripcion,Codigo) values (
@IdTipoServicio,@Descripcion,@Codigo)
set @IdOrigenAtencion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdOrigenAtencion,'TiposOrigenAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionEliminar]
	@IdOrigenAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposOrigenAtencion
where IdOrigenAtencion = @IdOrigenAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdOrigenAtencion,'TiposOrigenAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionModificar]
	@IdTipoServicio [int],
	@Descripcion [varchar](50),
	@Codigo [char](1),
	@IdOrigenAtencion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposOrigenAtencion
set
IdTipoServicio = @IdTipoServicio,
Descripcion = @Descripcion,
Codigo = @Codigo
where IdOrigenAtencion = @IdOrigenAtencion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdOrigenAtencion,'TiposOrigenAtencion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionSeleccionarPorId]
	@IdOrigenAtencion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposOrigenAtencion
where IdOrigenAtencion = @IdOrigenAtencion
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosEmergencia]
WITH EXECUTE AS CALLER
AS
select IdOrigenAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposOrigenAtencion
where IdTipoServicio = 2
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosExternos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosExternos]
WITH EXECUTE AS CALLER
AS
select IdOrigenAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposOrigenAtencion
where IdTipoServicio = 1
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionSeleccionarViasDeConsultoriosExternos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionSeleccionarViasDeHospitalizacion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionSeleccionarViasDeHospitalizacion]
	@TipoServicioHosp [int]
WITH EXECUTE AS CALLER
AS
select IdOrigenAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposOrigenAtencion
where IdTipoServicio = 3 and TipoServicioHosp=@TipoServicioHosp
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionSeleccionarViasDeHospitalizacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionSeleccionarViasDeObservacionEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionSeleccionarViasDeObservacionEmergencia]
WITH EXECUTE AS CALLER
AS
select IdOrigenAtencion, Codigo + ' = ' + Descripcion as DescripcionLarga
from TiposOrigenAtencion
where IdTipoServicio = 4
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionSeleccionarViasDeObservacionEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionXcodigoTipoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionXcodigoTipoServicio]
	@codigo [varchar](1),
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select *  from TiposOrigenAtencion where Codigo = @codigo and IdTipoServicio = @IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionXcodigoTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposOrigenAtencionXorigenAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposOrigenAtencionXorigenAtencion]
	@lnIdOrigenAtencionGalenHos [int]
WITH EXECUTE AS CALLER
AS
select * from TiposOrigenAtencion where idOrigenAtencion=@lnIdOrigenAtencionGalenHos
GO
ALTER AUTHORIZATION ON [dbo].[TiposOrigenAtencionXorigenAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProcedenciaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProcedenciaEliminar]
	@IdProcedencia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposProcedencia
where IdProcedencia = @IdProcedencia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProcedencia,'TiposProcedencia',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedenciaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProcedenciaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProcedenciaModificar]
	@Descripcion [varchar](50),
	@IdProcedencia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposProcedencia
set
Descripcion = @Descripcion
where IdProcedencia = @IdProcedencia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdProcedencia,'TiposProcedencia',today
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedenciaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProcedenciaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProcedenciaSeleccionarPorId]
	@IdProcedencia [int]
WITH EXECUTE AS CALLER
AS
select * from TiposProcedencia
where IdProcedencia = @IdProcedencia
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedenciaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProcedenciaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposProcedenciaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdProcedencia, Descripcion,
(Convert(varchar(5), IdProcedencia) + ' = ' + Descripcion) as DescripcionLarga
 from TiposProcedencia
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedenciaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProcedenciaTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposProcedenciaTodos]
WITH EXECUTE AS CALLER
AS
select IdProcedencia, left(Descripcion,40) as dCorto
 from TiposProcedencia order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TiposProcedenciaTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProgramacionAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProgramacionAgregar]
	@Descripcion [varchar](50),
	@IdTipoProgramacion [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposProgramacion (
Descripcion) values (
@Descripcion)
set @IdTipoProgramacion = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoProgramacion,'TiposProgramacion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacionAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProgramacionEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProgramacionEliminar]
	@IdTipoProgramacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposProgramacion
where IdTipoProgramacion = @IdTipoProgramacion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoProgramacion,'TiposProgramacion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacionEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProgramacionModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProgramacionModificar]
	@Descripcion [varchar](50),
	@IdTipoProgramacion [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposProgramacion
set
Descripcion = @Descripcion
where IdTipoProgramacion = @IdTipoProgramacion
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoProgramacion,'TiposProgramacion'
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacionModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProgramacionSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposProgramacionSeleccionarPorId]
	@IdTipoProgramacion [int]
WITH EXECUTE AS CALLER
AS
select * from TiposProgramacion
where IdTipoProgramacion = @IdTipoProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacionSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposProgramacionSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposProgramacionSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoProgramacion, Descripcion,
(Convert(varchar(5), IdTipoProgramacion) + ' = ' + Descripcion) as DescripcionLarga
 from TiposProgramacion
GO
ALTER AUTHORIZATION ON [dbo].[TiposProgramacionSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposReferenciaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposReferenciaAgregar]
	@Descripcion [varchar](50),
	@IdTipoReferencia [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposReferencia (
Descripcion) values (
@Descripcion)
set @IdTipoReferencia = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoReferencia,'TiposReferencia'
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferenciaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposReferenciaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposReferenciaEliminar]
	@IdTipoReferencia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposReferencia
where IdTipoReferencia = @IdTipoReferencia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoReferencia,'TiposReferencia'
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferenciaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposReferenciaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposReferenciaModificar]
	@Descripcion [varchar](50),
	@IdTipoReferencia [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposReferencia
set
Descripcion = @Descripcion
where IdTipoReferencia = @IdTipoReferencia
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoReferencia,'TiposReferencia'
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferenciaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposReferenciaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposReferenciaSeleccionarPorId]
	@IdTipoReferencia [int]
WITH EXECUTE AS CALLER
AS
select * from TiposReferencia
where IdTipoReferencia = @IdTipoReferencia
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferenciaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposReferenciaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposReferenciaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoReferencia, Descripcion,
(Convert(varchar(5), IdTipoReferencia) + ' = ' + Descripcion) as DescripcionLarga
 from TiposReferencia
GO
ALTER AUTHORIZATION ON [dbo].[TiposReferenciaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposResultadoServInterm]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposResultadoServInterm]
WITH EXECUTE AS CALLER
AS
SELECT IDRESULTADOSI,DESCRIPCION
FROM TIPOSRESULTADOSSERVINTERM
GO
ALTER AUTHORIZATION ON [dbo].[TiposResultadoServInterm] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioAgregar]
	@Descripcion [varchar](50),
	@IdTipoServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposServicio (
Descripcion,IdTipoServicio) values (
@Descripcion,@IdTipoServicio)


--exec AuditoriaAgregar @IdUsuarioAuditoria, 'A', @IdTipoServicio, 'TiposServicio'
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioEliminar]
	@IdTipoServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposServicio
where IdTipoServicio = @IdTipoServicio

exec AuditoriaAgregar @IdUsuarioAuditoria, 'E', @IdTipoServicio, 'TiposServicio'
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioModificar]
	@Descripcion [varchar](50),
	@IdTipoServicio [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposServicio
set
Descripcion = @Descripcion
where IdTipoServicio = @IdTipoServicio
--exec AuditoriaAgregar @IdUsuarioAuditoria, 'M', @IdTipoServicio, 'TiposServicio'
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioSeleccionarAsistenciales]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioSeleccionarAsistenciales]
WITH EXECUTE AS CALLER
AS
select IdTipoServicio, Descripcion,
(Convert(varchar(5), IdTipoServicio) + ' = ' + Descripcion) as DescripcionLarga
 from TiposServicio
 where IdTipoServicio in (1,2,3,99)
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioSeleccionarAsistenciales] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioSeleccionarDeEmergencia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposServicioSeleccionarDeEmergencia]
WITH EXECUTE AS CALLER
AS
select IdTipoServicio, Descripcion,
(Convert(varchar(5), IdTipoServicio) + ' = ' + Descripcion) as DescripcionLarga
 from TiposServicio
 where IdTipoServicio in (2,4)
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioSeleccionarDeEmergencia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioSeleccionarPorId]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select * from TiposServicio
where IdTipoServicio = @IdTipoServicio
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposServicioSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposServicioSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoServicio, Descripcion,
(Convert(varchar(5), IdTipoServicio) + ' = ' + Descripcion) as DescripcionLarga
 from TiposServicio
GO
ALTER AUTHORIZATION ON [dbo].[TiposServicioSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSexoEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSexoEliminar]
	@IdTipoSexo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposSexo
where IdTipoSexo = @IdTipoSexo
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexoEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSexoFiltrarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposSexoFiltrarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoSexo, Descripcion, (Convert(varchar(5), IdTipoSexo) + ' = ' + Descripcion) as DescripcionLarga From TiposSexo
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexoFiltrarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSexoModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSexoModificar]
	@Descripcion [varchar](50),
	@IdTipoSexo [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposSexo
set
Descripcion = @Descripcion
where IdTipoSexo = @IdTipoSexo
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexoModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSexoSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSexoSeleccionarPorId]
	@IdTipoSexo [int]
WITH EXECUTE AS CALLER
AS
select * from TiposSexo
where IdTipoSexo = @IdTipoSexo
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexoSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSexoSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSexoSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoSexo, Descripcion,
(Convert(varchar(5), IdTipoSexo) + ' = ' + Descripcion) as DescripcionLarga
 from TiposSexo
GO
ALTER AUTHORIZATION ON [dbo].[TiposSexoSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSubsectorAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSubsectorAgregar]
	@Descripcion [varchar](50),
	@IdTipoSubsector [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposSubsector (
Descripcion) values (
@Descripcion)
set @IdTipoSubsector = @@Identity

exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@IdTipoSubsector,'TiposSubsector'
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsectorAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSubsectorEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSubsectorEliminar]
	@IdTipoSubsector [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposSubsector
where IdTipoSubsector = @IdTipoSubsector
exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@IdTipoSubsector,'TiposSubsector'
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsectorEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSubsectorModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSubsectorModificar]
	@Descripcion [varchar](50),
	@IdTipoSubsector [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposSubsector
set
Descripcion = @Descripcion
where IdTipoSubsector = @IdTipoSubsector
exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@IdTipoSubsector,'TiposSubsector'
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsectorModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSubsectorSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposSubsectorSeleccionarPorId]
	@IdTipoSubsector [int]
WITH EXECUTE AS CALLER
AS
select * from TiposSubsector
where IdTipoSubsector = @IdTipoSubsector
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsectorSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposSubsectorSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposSubsectorSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select IdTipoSubsector, Descripcion,
(Convert(varchar(5), IdTipoSubsector) + ' = ' + Descripcion) as DescripcionLarga
 from TiposSubsector
GO
ALTER AUTHORIZATION ON [dbo].[TiposSubsectorSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaAgregar]
	@idTipoTarifa [int] OUTPUT,
	@codigo [varchar](50),
	@TipoTarifa [varchar](100),
	@esFarmacia [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposTarifa (
codigo,TipoTarifa,esFarmacia) values (
@codigo,@TipoTarifa,@esFarmacia)
set @idTipoTarifa = @@identity
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idTipoTarifa,'TiposTarifa'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptActualizar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptActualizar]
	@IdProducto [int]
WITH EXECUTE AS CALLER
AS
select * from TiposTarifaCpt where idProductoCpt=@IdProducto
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptActualizar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptAgregar]
	@idTipoTarifa [int],
	@idProductoCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into TiposTarifaCpt (
idTipoTarifa,idProductoCpt) values (
@idTipoTarifa,@idProductoCpt)
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'A',@idTipoTarifa,'TiposTarifaCpt'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptEliminar]
	@idTipoTarifa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposTarifaCpt
where idTipoTarifa = @idTipoTarifa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idTipoTarifa,'TiposTarifaCpt'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptEliminarPorIdProducto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptEliminarPorIdProducto]
	@IdProducto [int],
	@IdTipoTarifa [int]
WITH EXECUTE AS CALLER
AS
delete from TiposTarifaCpt where idProductoCpt=@IdProducto and idTipoTarifa=@IdTipoTarifa
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptEliminarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptModificar]
	@idTipoTarifa [int],
	@idProductoCpt [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposTarifaCpt
set
idProductoCpt = @idProductoCpt
where idTipoTarifa = @idTipoTarifa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idTipoTarifa,'TiposTarifaCpt'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptModificarXidproducto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptModificarXidproducto]
	@idTipoTarifa [int],
	@idProductoCpt [int]
WITH EXECUTE AS CALLER
AS
update TiposTarifaCpt
set
idTipoTarifa = @idTipoTarifa
where idProductoCpt = @idProductoCpt
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptModificarXidproducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptSeleccionarPorId]
	@idTipoTarifa [int]
WITH EXECUTE AS CALLER
AS
select * from TiposTarifaCpt
where idTipoTarifa = @idTipoTarifa
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaCptSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaCptSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
SELECT     dbo.TiposTarifaCpt.*, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,dbo.FactCatalogoServicios.idProducto
             FROM         dbo.TiposTarifaCpt FULL OUTER JOIN
                                  dbo.FactCatalogoServicios ON dbo.TiposTarifaCpt.idProductoCpt = dbo.FactCatalogoServicios.IdProducto
             order by dbo.FactCatalogoServicios.Nombre
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaCptSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaEliminar]
	@idTipoTarifa [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from TiposTarifa
where idTipoTarifa = @idTipoTarifa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'E',@idTipoTarifa,'TiposTarifa'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaFiltrar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaFiltrar]
	@lcFiltro [varchar](1000)
WITH EXECUTE AS CALLER
AS
DECLARE @SQL AS VARCHAR(2000)

   SET  @SQL =  'Select *
            from TiposTarifa where 1 = 1     '+@lcFiltro


EXECUTE (@SQL)
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaFiltrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaModificar]
	@idTipoTarifa [int],
	@codigo [varchar](50),
	@TipoTarifa [varchar](100),
	@esFarmacia [bit],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update TiposTarifa
set
codigo = @codigo,
TipoTarifa = @TipoTarifa,
esFarmacia=@esFarmacia
where idTipoTarifa = @idTipoTarifa
--exec AuditoriaAgregar @IdUsuarioAuditoria ,'M',@idTipoTarifa,'TiposTarifa'
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TiposTarifaSeleccionarPorId]
	@idTipoTarifa [int]
WITH EXECUTE AS CALLER
AS
select * from TiposTarifa
where idTipoTarifa = @idTipoTarifa
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from TiposTarifa order by tipoTarifa
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaSinDetalle]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaSinDetalle]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.TiposTarifa.*, dbo.TiposTarifaCpt.idProductoCpt
FROM         dbo.TiposTarifa LEFT OUTER JOIN
                      dbo.TiposTarifaCpt ON dbo.TiposTarifa.idTipoTarifa = dbo.TiposTarifaCpt.idTipoTarifa
WHERE     (dbo.TiposTarifaCpt.idProductoCpt IS NULL)
ORDER BY dbo.TiposTarifa.idTipoTarifa
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaSinDetalle] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TiposTarifaSoloFarmacia]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TiposTarifaSoloFarmacia]
WITH EXECUTE AS CALLER
AS
select * from TiposTarifa where esFArmacia=1
GO
ALTER AUTHORIZATION ON [dbo].[TiposTarifaSoloFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TodosEmpleadosDeLab]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TodosEmpleadosDeLab]
WITH EXECUTE AS CALLER
AS
SELECT distinct dbo.Empleados.IdEmpleado, LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres AS ApNom, dbo.EmpleadosCargos.idCargo
FROM dbo.usuariosRoles, dbo.Empleados LEFT OUTER JOIN dbo.EmpleadosCargos ON dbo.Empleados.IdEmpleado = dbo.EmpleadosCargos.idEmpleado
WHERE dbo.EmpleadosCargos.idCargo>=9 and dbo.EmpleadosCargos.idCargo<=20
ORDER BY LTRIM(dbo.Empleados.ApellidoPaterno) + ' ' + LTRIM(dbo.Empleados.ApellidoMaterno) + ' ' + dbo.Empleados.Nombres
GO
ALTER AUTHORIZATION ON [dbo].[TodosEmpleadosDeLab] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TramaPrestacionesSaludHospPartoDx]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TramaPrestacionesSaludHospPartoDx]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT     top 1 dbo.AtencionesDiagnosticos.IdAtencion, dbo.Diagnosticos.CodigoCIE2004, dbo.Diagnosticos.Descripcion, dbo.SubclasificacionDiagnosticos.Codigo,
                      dbo.SubclasificacionDiagnosticos.Descripcion AS Expr1
FROM         dbo.AtencionesDiagnosticos LEFT OUTER JOIN
                      dbo.SubclasificacionDiagnosticos ON
                      dbo.AtencionesDiagnosticos.IdSubclasificacionDx = dbo.SubclasificacionDiagnosticos.IdSubclasificacionDx LEFT OUTER JOIN
                      dbo.Diagnosticos ON dbo.AtencionesDiagnosticos.IdDiagnostico = dbo.Diagnosticos.IdDiagnostico
WHERE     (dbo.AtencionesDiagnosticos.IdAtencion = @IdAtencion) AND not (dbo.SubclasificacionDiagnosticos.Codigo IS NULL)
GO
ALTER AUTHORIZATION ON [dbo].[TramaPrestacionesSaludHospPartoDx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosAgregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosAgregar]
	@IdEspecialidad [int],
	@Codigo [char](3),
	@IdTipoServicio [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@Descripcion [varchar](50),
	@IdTurno [int] OUTPUT,
	@idTipoActividades [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into Turnos (
IdEspecialidad,Codigo,IdTipoServicio,HoraFin,HoraInicio,Descripcion,idTipoActividades) values (
@IdEspecialidad,@Codigo,@IdTipoServicio,@HoraFin,@HoraInicio,@Descripcion,@idTipoActividades)
set @IdTurno = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[TurnosAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosEliminar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosEliminar]
	@IdTurno [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from Turnos
where IdTurno = @IdTurno
GO
ALTER AUTHORIZATION ON [dbo].[TurnosEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosModificar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosModificar]
	@IdEspecialidad [int],
	@Codigo [char](3),
	@IdTipoServicio [int],
	@HoraFin [char](5),
	@HoraInicio [char](5),
	@Descripcion [varchar](50),
	@IdTurno [int],
	@idTipoActividades [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update Turnos
set
IdEspecialidad = @IdEspecialidad,
Codigo = @Codigo,
IdTipoServicio = @IdTipoServicio,
HoraFin = @HoraFin,
HoraInicio = @HoraInicio,
Descripcion = @Descripcion,
idTipoActividades=@idTipoActividades
where IdTurno = @IdTurno
GO
ALTER AUTHORIZATION ON [dbo].[TurnosModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosSeleccionarPorEspecialidad]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TurnosSeleccionarPorEspecialidad]
	@IdEspecialidad [int]
WITH EXECUTE AS CALLER
AS
Select Turnos.IdTurno, Turnos.Codigo + ' = ' + Turnos.Descripcion as DescripcionLarga
from Turnos
where IdEspecialidad = @IdEspecialidad or IdEspecialidad is null
order by Turnos.Codigo, Turnos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TurnosSeleccionarPorEspecialidad] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosSeleccionarPorId]
	@IdTurno [int]
WITH EXECUTE AS CALLER
AS
select * from Turnos
where IdTurno = @IdTurno
GO
ALTER AUTHORIZATION ON [dbo].[TurnosSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosSeleccionarPorIdentificador]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TurnosSeleccionarPorIdentificador]
	@IdTurno [int]
WITH EXECUTE AS CALLER
AS
select * from turnos where idturno=@IdTurno
GO
ALTER AUTHORIZATION ON [dbo].[TurnosSeleccionarPorIdentificador] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosSeleccionarPorIdTipoServicio]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosSeleccionarPorIdTipoServicio]
	@IdTipoServicio [int]
WITH EXECUTE AS CALLER
AS
select *,descripcion as DescripcionLarga from Turnos where idTipoServicio=@IdTipoServicio order by Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TurnosSeleccionarPorIdTipoServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[TurnosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
Select Turnos.IdTurno, Turnos.Codigo, Turnos.Descripcion, Turnos.HoraInicio, Turnos.HoraFin,
TiposServicio.Descripcion as TipoServicio, Especialidades.Nombre as Especialidad
from ((Turnos left join TiposServicio on Turnos.IdTipoServicio = TiposServicio.IdTipoServicio)
left join Especialidades on Turnos.IdEspecialidad = Especialidades.IdEspecialidad)
order by  Turnos.Descripcion
GO
ALTER AUTHORIZATION ON [dbo].[TurnosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[TurnosXcodigo]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[TurnosXcodigo]
	@codigo [varchar](3)
WITH EXECUTE AS CALLER
AS
select IdTurno from Turnos where Codigo = @codigo
GO
ALTER AUTHORIZATION ON [dbo].[TurnosXcodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UPServiciosActualizar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UPServiciosActualizar]
	@UPScodigo [varchar](6),
	@UPSdescripcion [varchar](50)
WITH EXECUTE AS CALLER
AS
DECLARE UPServiciosCursor CURSOR FOR  select idUPS from UPServicios where UPShis=@UPScodigo
             OPEN UPServiciosCursor
	declare @idHallado int
	FETCH NEXT FROM UPServiciosCursor INTO @IdHallado
	if (@@FETCH_STATUS <> -1)
                   update UPServicios set descripcion=@UPSdescripcion where UPShis=@UPScodigo
             else
                   insert into UPServicios (descripcion,estado,UPShis) values (@UPSdescripcion,1,@UPScodigo)
	CLOSE UPServiciosCursor
	DEALLOCATE UPServiciosCursor
GO
ALTER AUTHORIZATION ON [dbo].[UPServiciosActualizar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UPServiciosSeleccionarTodos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[UPServiciosSeleccionarTodos]
WITH EXECUTE AS CALLER
AS
select * from UPServicios order by descripcion
GO
ALTER AUTHORIZATION ON [dbo].[UPServiciosSeleccionarTodos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_AtencionCEServiciosActualizar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_AtencionCEServiciosActualizar]
	@idAtencion [int],
	@Codigo_Item [varchar](10),
	@Descripcion_Item [varchar](300),
	@Fg_Tipo [varchar](2),
	@Descripcion_Tipo_Item [varchar](100),
	@Lab1 [varchar](3),
	@Lab2 [varchar](3),
	@Lab3 [varchar](3)
WITH EXECUTE AS CALLER
AS
BEGIN
    SET NOCOUNT ON;
    BEGIN TRY
        IF EXISTS (SELECT 1 FROM AtencionCEServicios WHERE IdAtencion = @idAtencion AND Codigo_Item = @Codigo_Item)
        BEGIN
            -- Si existe, actualizar el registro
            UPDATE AtencionCEServicios
            SET
                Descripcion_Item = @Descripcion_Item,
                Fg_Tipo = @Fg_Tipo,
                Descripcion_Tipo_Item = @Descripcion_Tipo_Item,
                Lab1 = @Lab1,
                Lab2 = @Lab2,
                Lab3 = @Lab3,
				Estado = 1
            WHERE IdAtencion = @idAtencion AND Codigo_Item = @Codigo_Item;
        END
        ELSE
        BEGIN
            -- Si no existe, insertar un nuevo registro
            INSERT INTO AtencionCEServicios (
                IdAtencion,
                Codigo_Item,
                Descripcion_Item,
                Fg_Tipo,
                Descripcion_Tipo_Item,
				IdSubclasificacionDx,
                Lab1,
                Lab2,
                Lab3,
				Estado
            )
            VALUES (
                @idAtencion,
                @Codigo_Item,
                @Descripcion_Item,
                @Fg_Tipo,
                @Descripcion_Tipo_Item,
				101,--Definitivo en CE
                @Lab1,
                @Lab2,
                @Lab3,
				1
            );
        END
    END TRY
    BEGIN CATCH
        -- Manejo de errores
        DECLARE @ErrorMessage NVARCHAR(4000);
        DECLARE @ErrorSeverity INT;
        DECLARE @ErrorState INT;

        SELECT
            @ErrorMessage = ERROR_MESSAGE(),
            @ErrorSeverity = ERROR_SEVERITY(),
            @ErrorState = ERROR_STATE();

        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH
END
GO
ALTER AUTHORIZATION ON [dbo].[usp_AtencionCEServiciosActualizar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_AtencionCEServiciosDeshabilitar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_AtencionCEServiciosDeshabilitar]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
update AtencionCEServicios set Estado =0
where IdAtencion=@idAtencion





GO
ALTER AUTHORIZATION ON [dbo].[usp_AtencionCEServiciosDeshabilitar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_AtencionCEServiciosSeleccionarPorIdAtencion]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_AtencionCEServiciosSeleccionarPorIdAtencion]
	@IdAtencion [int]
WITH EXECUTE AS CALLER
AS
BEGIN

select IdAtencionCEServicios, IdAtencion, Codigo_Item,
Descripcion_Item,Fg_Tipo, Descripcion_Tipo_Item, Lab1, Lab2, Lab3, Estado
from AtencionCEServicios
where IdAtencion=@IdAtencion and Estado =1
END


GO
ALTER AUTHORIZATION ON [dbo].[usp_AtencionCEServiciosSeleccionarPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_catalogoserviciosagregar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_catalogoserviciosagregar]
	@Id [int],
	@Id_Atencion [varchar](20),
	@Descripcion_Tipo_Item [varchar](100),
	@Fg_Tipo [varchar](2),
	@Codigo [varchar](10),
	@NombreProducto [varchar](300),
	@IdSubClasificacion [varchar](20),
	@LabConfHis [varchar](10)
WITH EXECUTE AS CALLER
AS
IF EXISTS (SELECT * FROM FactCatalogoServiciosN WHERE Id=@Id)
       UPDATE FactCatalogoServiciosN SET IdAtencion=@Id_Atencion,
	   Descripcion_Tipo_Item=@Descripcion_Tipo_Item,
	   Fg_Tipo=@Fg_Tipo,
	   idProducto=@Codigo,
	   NombreMINSA=@NombreProducto,
	   IdSubclasificacionDx=@IdSubClasificacion,
	   valores=@LabConfHis WHERE Id=@Id
ELSE
       INSERT INTO FactCatalogoServiciosN (IdAtencion,Descripcion_Tipo_Item,Fg_Tipo,idProducto,NombreMINSA,IdSubclasificacionDx,valores)
	    VALUES (@Id_Atencion,@Descripcion_Tipo_Item,@Fg_Tipo,@Codigo,@NombreProducto,@IdSubClasificacion,@LabConfHis)

GO
ALTER AUTHORIZATION ON [dbo].[usp_catalogoserviciosagregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_DniNombreBuscar]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_DniNombreBuscar]
	@Nombre [varchar](120) = NULL
WITH EXECUTE AS CALLER
AS
SELECT  P.IdPaciente, p.NroDocumento 'Dni',
		CONCAT(p.ApellidoPaterno,' ',p.ApellidoMaterno,' ', P.PrimerNombre,' ',P.SegundoNombre,' ',P.TercerNombre)  'Paciente',
	    p.NroHistoriaClinica,
		HC.NroHistoriaClinicaAnterior,
		HC.fechaUltimoCambioHistoria 'FechaCambio'
FROM Pacientes P
INNER JOIN HistoriasClinicas HC ON P.IdPaciente = HC.IdPaciente
--WHERE  CONVERT(DATE, HC.fechaUltimoCambioHistoria) BETWEEN @fechaInicio AND @fechaFinal
WHERE CONCAT(p.ApellidoPaterno,' ',p.ApellidoMaterno,' ', P.PrimerNombre,' ',P.SegundoNombre,' ',P.TercerNombre) like '%'+@Nombre+'%' /*AND p.Validado='1' AND hc.Estado='1'*/ OR
p.NroDocumento like '%'+@Nombre+'%' OR p.NroHistoriaClinica like '%'+@Nombre+'%'
GO
ALTER AUTHORIZATION ON [dbo].[usp_DniNombreBuscar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_eliminacatalogoidat]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_eliminacatalogoidat]
	@Id [int]
WITH EXECUTE AS CALLER
AS
delete from FactCatalogoServiciosN
where Id = @Id
GO
ALTER AUTHORIZATION ON [dbo].[usp_eliminacatalogoidat] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_EmpleadosRolSeleccionarPorId]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_EmpleadosRolSeleccionarPorId]
	@idEmpleado [int]
WITH EXECUTE AS CALLER
AS
select * from UsuariosRoles where idEmpleado=@idEmpleado
--SCCQ 28/08/2020 Cambio27 Fin


GO
ALTER AUTHORIZATION ON [dbo].[usp_EmpleadosRolSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_FacturacionBienesDevolucionesSeleccionarPorIdProducto]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_FacturacionBienesDevolucionesSeleccionarPorIdProducto]
	@MovNumero [varchar](9),
	@MovTipo [varchar](1),
	@idProducto [int]
WITH EXECUTE AS CALLER
AS
Select
    MovNumero
	,MovTipo
    , idProducto
    , cantdevolver=Sum(CantidadAdevolver)
From
    FacturacionBienesDevoluciones
	where
	MovNumero=@MovNumero and MovTipo=@MovTipo and idProducto=@idProducto

Group By
    idProducto
	,MovTipo
    , MovNumero;
GO
ALTER AUTHORIZATION ON [dbo].[usp_FacturacionBienesDevolucionesSeleccionarPorIdProducto] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_FarmDevuelveYactualizaCorrelativoDisponibleFarmRelMod]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_FarmDevuelveYactualizaCorrelativoDisponibleFarmRelMod]
	@MovTipo [char](1),
	@idTipoLocales [char](1),
	@idTipoSuministro [char](2),
	@DocumentoIdtipo [int],
	@NewCorrelativo [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @resulado as varchar(20)
 declare @disponible as bit
set @disponible=0
while(@disponible=0)
begin
	--Generar correlativo
	select @NewCorrelativo=dbo.ufn_GenerarCorrelativoFarmRelMod (@MovTipo,@idTipoLocales,@idTipoSuministro,@DocumentoIdtipo)
	--Verificar disponibilidad del correlativo por número de documento, idTipoDocumento y estado (1=activo)
	select @resulado=MovNumero from farmMovimiento where documentoNumero = cast (@NewCorrelativo as varchar(20)) and documentoIdTipo = @DocumentoIdtipo and idEstadoMovimiento=1
		if @@rowcount = 0--Si no esta asignado dicho número de documento

		  begin
			  set @disponible=1--El número de documento esta disponible
		  end

		else --Si el número de documento ya esta usado
		  begin
			   --Actualizar correlativo en tabla
				update dbo.farmRelMod set DocumentoUltimoNumero=@NewCorrelativo
				 WHERE   dbo.farmRelMod.TipoAlmacen=@idTipoLocales and dbo.farmRelMod.TipoMov=@MovTipo and dbo.farmRelMod.tipoSuministro=@idTipoSuministro
				 and DocumentoId=@DocumentoIdtipo
			end
end
--Actualizar correlativo en tabla
update dbo.farmRelMod set DocumentoUltimoNumero=@NewCorrelativo
WHERE   dbo.farmRelMod.TipoAlmacen=@idTipoLocales and dbo.farmRelMod.TipoMov=@MovTipo and dbo.farmRelMod.tipoSuministro=@idTipoSuministro
and DocumentoId=@DocumentoIdtipo
return
--SCCQ 08/10/2020 Cambio28 Fin
GO
ALTER AUTHORIZATION ON [dbo].[usp_FarmDevuelveYactualizaCorrelativoDisponibleFarmRelMod] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_FarmDevuelveYactualizaCorrelativosDisponibleFarmTipoDocumentos]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_FarmDevuelveYactualizaCorrelativosDisponibleFarmTipoDocumentos]
	@IdTipoDocumento [int],
	@NewCorrelativo [int] OUTPUT
WITH EXECUTE AS CALLER
AS
declare @resulado as varchar(20)
--declare @UltCorrelativo int
 declare @disponible as bit
set @disponible=0

while(@disponible=0)
	begin
		--Generar y actualizar correlativo de la Tabla farmtipodocumentos
		exec FarmDevuelveYactualizaCorrelativosDeDocumentosES @IdTipoDocumento,@NewCorrelativo output
		--Verificar disponibilidad del correlativo por número de documento, idTipoDocumento y estado (1=activo)
		select @resulado=MovNumero from farmMovimiento where documentoNumero = cast (@NewCorrelativo as varchar(20)) and documentoIdTipo = @IdTipoDocumento and idEstadoMovimiento=1
		if @@rowcount = 0--Si no esta asignado dicho número de documento

		  begin
			  set @disponible=1--El número de documento esta disponible
		  end
	end

return
--SCCQ 21/10/2020 Cambio28 Fin
GO
ALTER AUTHORIZATION ON [dbo].[usp_FarmDevuelveYactualizaCorrelativosDisponibleFarmTipoDocumentos] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_FarmReporteICI]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_FarmReporteICI]
WITH EXECUTE AS CALLER
AS
DECLARE @Fecha date= DATEADD(DAY,-1,GETDATE())
DECLARE @Fecha_inicio DATETIME =SMALLDATETIMEFROMPARTS ( YEAR(@Fecha), MONTH(@Fecha), DAY(@Fecha), 0, 0 )
DECLARE @Fecha_fin DATETIME =SMALLDATETIMEFROMPARTS ( YEAR(@Fecha), MONTH(@Fecha), DAY(@Fecha), 23, 59 )
DECLARE @FechaUltimoCierre DATE = DATEADD(DAY,-DAY(@Fecha),@Fecha)
DECLARE @primer_dia_mes DATETIME= DATEADD(DAY,1,@FechaUltimoCierre)
DECLARE @RENAES VARCHAR(10)

delete from ICI_DIGEMID where PERIODO=CONVERT(varchar,@Fecha,112)

SELECT @RENAES = ValorTexto FROM Parametros WHERE IdParametro=280
SET @RENAES = '0'+@RENAES


;WITH FARMACIAS AS (SELECT * FROM farmAlmacen WHERE idTipoLocales IN ('A','F') AND idEstado=1 )
,PRECIO_VENTA AS(
	 select IdProducto, PrecioUnitario AS PRECIO_OPERACION from FactCatalogoBienesInsumosHosp
		where IdTipoFinanciamiento=1)
, FECHA_VENCIMIENTO AS (
	select FA.idAlmacen,idProducto,
	min(FechaVencimiento) AS FEC_EXP from  farmSaldoDetallado FSD
	INNER JOIN farmAlmacen FA ON FSD.idAlmacen=FA.idAlmacen
	WHERE FA.idTipoLocales IN ('A','F') AND FA.idEstado=1
	AND Cantidad>0
	GROUP BY FA.idAlmacen,idProducto

)
,MOVIMIENTO_CALCULOS AS (
SELECT FMD.idProducto, CBI.Codigo AS CODIGO_MED,
	CASE
	WHEN FM.idTipoConcepto<>19 /*Inventario*/and FMD.MovTipo='E' and exists( select * from FARMACIAS where idAlmacen= idAlmacenDestino)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS INGRE,
	CASE
	WHEN FM.idTipoConcepto=10 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS VENTA,
	CASE
	WHEN FM.idTipoConcepto=13 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS SIS,
	CASE
	WHEN FM.idTipoConcepto =16 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS INTERSAN,
	CASE
	WHEN FM.idTipoConcepto=14 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS SOAT,
	CASE
	WHEN FM.idTipoConcepto =17 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS CREDHOSP,
	CASE
	WHEN FM.idTipoConcepto in (23/*Crédito*/,26/*Credito personal*/) and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS OTR_CONV,
	CASE
	WHEN FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS TOTAL,
	CASE
	WHEN FM.idTipoConcepto =22 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DEFNAC,
	CASE
	WHEN FM.idTipoConcepto =15 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS EXO,
	CASE
	WHEN FM.idTipoConcepto in(5,6,7,21) and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DEVOL,
	CASE
	WHEN FM.idTipoConcepto =4 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DISTRI,
	CASE
	WHEN FM.idTipoConcepto in(8,9) and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS TRANSF,
	CASE
	WHEN FM.idTipoConcepto =12 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS VENTAINST,
	CASE
	WHEN FM.idTipoConcepto =5 and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DEV_VEN,
	CASE
	WHEN FM.idTipoConcepto not in(10, 13, 16, 14, 17, 23, 26, 22, 15, 5,6,7,21,4,8,9,12,5 ) and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS OTRAS_SAL,
	CASE
	WHEN FM.idTipoConcepto in(3,24) and FMD.MovTipo='E' and exists( select * from FARMACIAS where idAlmacen= idAlmacenDestino)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DO_INGRE,
	CASE
	WHEN FM.idTipoConcepto in(3,24,27) and FMD.MovTipo='S' and exists( select * from FARMACIAS where idAlmacen= idAlmacenOrigen)
	then SUM(fmd.Cantidad)
	ELSE 0
	END AS DO_CON,
	CASE WHEN FMD.MovTipo='S' THEN idAlmacenOrigen ELSE idAlmacenDestino END 'idAlmacen'
	FROM farmMovimientoDetalle FMD
	INNER JOIN farmMovimiento FM ON FMD.MovNumero=FM.MovNumero
	INNER JOIN FactCatalogoBienesInsumos CBI ON FMD.idProducto=CBI.IdProducto
	WHERE FM.idEstadoMovimiento=1 AND (Fm.fechaCreacion BETWEEN @Fecha_inicio AND @Fecha_fin)
	GROUP BY FMD.idProducto, CBI.Codigo,idTipoConcepto, FMD.MovTipo,FM.idAlmacenDestino,FM.idAlmacenOrigen
),
MOVIMIENTO AS (
SELECT M.idAlmacen,idProducto, CODIGO_MED,/*TIPSUM ,*/SUM(INGRE) AS INGRE, SUM(VENTA) AS VENTA, SUM(SIS) AS SIS, sum(INTERSAN)as INTERSAN,
	SUM(SOAT) AS SOAT,sum(CREDHOSP)as CREDHOSP, sum(OTR_CONV) as OTR_CONV, SUM(TOTAL)as TOTAL, SUM(DEFNAC) AS DEFNAC, SUM(EXO) AS EXO,
	SUM(DEVOL) AS DEVOL, SUM(DISTRI) AS DISTRI, SUM(TRANSF) AS TRANSF, SUM(VENTAINST) AS VENTAINST, SUM(DEV_VEN) AS DEV_VEN,
	SUM(OTRAS_SAL) AS OTRAS_SAL, SUM(DO_INGRE) AS DO_INGRE, SUM(DO_CON) AS DO_CON
FROM MOVIMIENTO_CALCULOS M
INNER JOIN farmAlmacen FA ON M.idAlmacen=FA.idAlmacen
WHERE FA.idTipoLocales IN ('A','F') AND FA.idEstado=1
GROUP BY M.idAlmacen,idProducto,CODIGO_MED/*,TIPSUM*/
),
SALDOINICIAL AS(
	SELECT M.idAlmacen,FSM.idProducto,
	SUM(Saldo) 'Saldo_Inicial'
	FROM FarmSaldoMensual FSM
	INNER JOIN MOVIMIENTO M ON FSM.idAlmacen=M.idAlmacen and FSM.idProducto=M.idProducto
	WHERE CONVERT(DATE, SaldoFecha) = @FechaUltimoCierre
	GROUP BY M.idAlmacen, FSM.idProducto
),
SALDODONACION AS(
	SELECT FA.idAlmacen,FSM.idProducto,
	SUM(Saldo) 'Saldo_donacion'
	FROM FarmSaldoMensual FSM
	INNER JOIN farmAlmacen FA ON FSM.idAlmacen=FA.idAlmacen
	INNER JOIN MOVIMIENTO M ON FSM.idAlmacen=M.idAlmacen and FSM.idProducto=M.idProducto
	WHERE CONVERT(DATE, SaldoFecha) = @FechaUltimoCierre
	AND FA.idTipoLocales IN ('A','F') AND FA.idEstado=1 AND  FA.idTipoSuministro='02'
	GROUP BY FA.idAlmacen,FSM.idProducto
)
,STOCK_FINAL AS (
	SELECT M.idAlmacen, M.idProducto,
	dbo.ufn_Calcular_SaldoActual(M.idAlmacen,M.idProducto,@primer_dia_mes,@Fecha_fin,ISNULL(SI.Saldo_Inicial,0)) AS STOCK_FIN
	FROM MOVIMIENTO M
	left join SALDOINICIAL SI on SI.idAlmacen=M.idAlmacen and SI.idProducto=M.idProducto
	GROUP BY M.idAlmacen, M.idProducto,SI.Saldo_Inicial)
--INSERTAMOS EN TABLA FarmReporteICI
	INSERT INTO ICI_DIGEMID (CODIGO_EJE,CODIGO_PRE,TIPSUM,PERIODO,CODIGO_MED,PRECIO_ADQUISICION,PRECIO_OPERACION,SALDO,
	INGRE,REINGRE,VENTA,SIS,INTERSAN,FAC_PERD,DEFNAC,EXO,SOAT,CREDHOSP,OTR_CONV,DEVOL,VENCIDO,MERMA,DISTRI,TRANSF,VENTAINST,
	DEV_VEN,DEV_MERMA,OTRAS_SAL,TOTAL,STOCK_FIN,FEC_EXP,REQUERIMIENTO,DO_SALDO,DO_INGRE,DO_CON,DO_OTR,DO_TOT,DO_STK,DO_FECEXP)
--SELECCIÓN FINAL PARA EL REPORTE
SELECT 	'' 'CODIGO_EJE', A.codigoSISMED 'CODIGO_PRE',
		case
		when idTipoSuministro = '01' THEN 'S'
		when idTipoSuministro = '02' then 'D'
		else ''
		END 'TIPSUM'
		,CONVERT(varchar,@Fecha,112) 'PERIODO',
		CASE WHEN LEN(M.CODIGO_MED)>5 THEN SUBSTRING( M.CODIGO_MED,3,5) ELSE M.CODIGO_MED END 'CODIGO_MED',
		PrecioCompra AS PRECIO_ADQUISICON, PRECIO_OPERACION,isnull(Saldo_Inicial,0) AS SALDO, INGRE, 0 AS REINGRE,
		VENTA, SIS, INTERSAN, 0 AS FAC_PERD, DEFNAC, EXO,
		SOAT, CREDHOSP, OTR_CONV, DEVOL, 0 AS VENCIDO,0 AS MERMA,
		DISTRI, TRANSF, VENTAINST, DEV_VEN, 0 AS DEV_MERMA, OTRAS_SAL,TOTAL,
		STOCK_FIN, FEC_EXP, 0 AS REQUERIMIENTO,isnull(Saldo_donacion,0) AS DO_SALDO, DO_INGRE, DO_CON, 0 AS DO_OTR,
		DO_CON AS DO_TOT,
		CASE
		WHEN idTipoSuministro='02' THEN STOCK_FIN
		ELSE 0
		END AS DO_STK
		,CASE
		WHEN idTipoSuministro='02' THEN FEC_EXP
		ELSE NULL
		END AS DO_FECEXP
FROM MOVIMIENTO M
inner join PRECIO_VENTA PV ON M.idProducto=PV.IdProducto
inner join FactCatalogoBienesInsumos CBI on M.CODIGO_MED=CBI.Codigo
LEFT JOIN SALDOINICIAL SI ON M.idProducto=SI.idProducto AND M.idAlmacen=SI.idAlmacen
INNER JOIN STOCK_FINAL SF ON M.idProducto=SF.idProducto AND M.idAlmacen=SF.idAlmacen
INNER JOIN FARMACIAS A ON M.idAlmacen=A.idAlmacen
LEFT OUTER JOIN FECHA_VENCIMIENTO FV ON M.idProducto=FV.idProducto AND M.idAlmacen=FV.idAlmacen
LEFT OUTER JOIN SALDODONACION SD ON M.idProducto=SD.idProducto AND M.idAlmacen=SD.idAlmacen
order by codigoSISMED
--SCCQ 13/08/2020 Cambio26 Fin
GO
ALTER AUTHORIZATION ON [dbo].[usp_FarmReporteICI] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_fechas_minsa]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_fechas_minsa]
	@sPeriodo [varchar](6),
	@sMedcod [varchar](6),
	@sUps [varchar](6)
WITH EXECUTE AS CALLER
AS
BEGIN

set nocount on

SELECT DISTINCT vp.medcod, vp.fecha,CODCON,
CASE
WHEN (CUPOS=0)
THEN vp.fecha+'L' ELSE vp.fecha+'D'
END AS fechdispon
FROM MINSA_vProgramacion vp
  WHERE vp.medcod = @sMedcod AND vp.ups = @sUps and
  (@sPeriodo is null or @sPeriodo ='' or periodo=@sPeriodo)
END
GO
ALTER AUTHORIZATION ON [dbo].[usp_fechas_minsa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_GeneraIciDigemid]    Script Date: 12/01/2026 02:48:09 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_GeneraIciDigemid]
WITH EXECUTE AS CALLER
AS
begin

	--seleccionando fecha actual
	DECLARE @Fecha date=DATEADD(DAY,-1,GETDATE())-- DATEADD(DAY,-29,GETDATE()) ---DATEADD(DAY,-1,GETDATE())
	DECLARE @FechaUltimoCierre DATE = DATEADD(DAY,-DAY(@Fecha),@Fecha)
	DECLARE @Fecha_inicio DATETIME =SMALLDATETIMEFROMPARTS ( YEAR(@Fecha), MONTH(@Fecha), DAY(@Fecha), 0, 0 )
	DECLARE @Fecha_fin DATETIME =SMALLDATETIMEFROMPARTS ( YEAR(@Fecha), MONTH(@Fecha), DAY(@Fecha), 23, 59 )

	--1: SELECCION DE SALDOS POR ALMACEN Y PRODUCTO
	select FS.idAlmacen
	,FA.codigoSISMED as CODIGO_PRE
	,FS.idProducto
	,Codigo,case
		when len(codigo)=7 and SUBSTRINg(codigo,1,2) ='00' then SUBSTRINg(codigo,3,5)--El código no debe pasar los 5 caracteres
		when len(Codigo)=6 and SUBSTRINg(codigo,1,1) ='0' then SUBSTRINg(codigo,2,5)--El código no debe pasar los 5 caracteres
		when LEN(Codigo)<=5 then Codigo
		end as CODIGO_MED
	,CBI.PrecioCompra as PRECIO_ADQUISICON
	,CBIH.PrecioUnitario AS PRECIO_OPERACION
	,sum(cantidad) as STOCK_FIN---Se suma por la cantidad por los tipos de salida del bien (Venta, IntervenSanitaria, Venta e IntSanitaria)
	,GETDATE() as SaldoFecha
	,FA.idTipoSuministro
	INTO #SaldoFarmacia from farmSaldo FS
	inner join farmAlmacen FA on FS.idAlmacen=FA.idAlmacen
	inner join FactCatalogoBienesInsumos CBI on FS.idProducto=CBI.IdProducto
	left join FactCatalogoBienesInsumosHosp CBIH on CBI.idProducto=CBIH.IdProducto AND CBIH.IdTipoFinanciamiento=1 --Solo muestra precio de plan PARTICULAR, null si no tiene precio o no existe en la tabla FactCatalogoBienesInsumosHosp
	WHERE FA.idEstado=1 --farmacias/almacenes en estado activo
	AND FA.idTipoSuministro IN ('01', '02') --farmacias/almacenes de tipo SISMED y DONACIONES
	AND FA.idTipoLocales IN ('A','F')--farmacias y almacenes
	group by FS.idAlmacen, FS.idProducto, FA.codigoSISMED, FA.descripcion,CBI.Codigo, CBI.PrecioCompra, CBIH.PrecioUnitario, FA.idTipoSuministro


	--2: Seleccion de movimientos de ingreso
		--TOTAL DE INGRESOS
		select FM.idAlmacenDestino, FMD.idProducto, ISNULL(sum (Cantidad),0) AS INGRE, 0 AS REINGRE  INTO #VariablesIngreso from farmMovimientoDetalle FMD
		INNER JOIN farmMovimiento FM ON FMD.MovNumero=FM.MovNumero
		WHERE FM.idEstadoMovimiento=1 --El estado del movimiento es ACTIVO
		AND (FM.fechaCreacion BETWEEN @Fecha_inicio AND @Fecha_fin) --Los movimientos son del día del reporte.
		and FMD.MovTipo='E' --Solo movimientos de Ingreso
		GROUP BY FM.idAlmacenDestino, FMD.idProducto


	--3: Seleccion de movimientos de salida
		--TOTAL DE SALIDAS
		select FM.idAlmacenOrigen, FMD.idProducto, FM.idTipoConcepto,ISNULL(sum (Cantidad),0) AS SALIDA INTO #MovimientosSalida from farmMovimientoDetalle FMD
		INNER JOIN farmMovimiento FM ON FMD.MovNumero=FM.MovNumero
		WHERE FM.idEstadoMovimiento=1 --El estado del movimiento es ACTIVO
		AND (FM.fechaCreacion BETWEEN @Fecha_inicio AND @Fecha_fin) --Los movimientos son del día del reporte.
		and FMD.MovTipo='S'--Solo movimientos de Salida
		GROUP BY FM.idAlmacenOrigen, FMD.idProducto,FM.idTipoConcepto

	--4: Seleccion de fechaVencimiento proxima
	--FEC_EXP: fecha de vencimiento próxima del grupo de lotes con saldo
		select FSD.idAlmacen, FSD.idProducto, min(FechaVencimiento) as FEC_EXP INTO #FechaVencimiento from farmSaldoDetallado FSD
		inner join farmAlmacen FA on FSD.idAlmacen=FA.idAlmacen
		WHERE FA.idEstado=1 --farmacias/almacenes en estado activo
		AND FA.idTipoSuministro IN ('01', '02') --farmacias/almacenes de tipo SISMED y DONACIONES
		AND FA.idTipoLocales IN ('A','F')--farmacias y almacenes
		and FSD.Cantidad>0 ---Solo lotes con saldo
		group by FSD.idAlmacen, FSD.idProducto

	--5: Dando formato de la tabla y calculando las variables de salida SISMED
	insert into ICI_DIGEMID(CODIGO_EJE/*,idAlmacen,idProducto*/,CODIGO_PRE,TIPSUM,PERIODO,CODIGO_MED,PRECIO_ADQUISICION,PRECIO_OPERACION,SALDO,INGRE,REINGRE,VENTA,SIS,INTERSAN,FAC_PERD,DEFNAC,EXO,SOAT,CREDHOSP,OTR_CONV,
 DEVOL,VENCIDO,MERMA,DISTRI,TRANSF,VENTAINST,DEV_VEN,DEV_MERMA,OTRAS_SAL,TOTAL ,STOCK_FIN,FEC_EXP,REQUERIMIENTO,DO_SALDO,DO_INGRE,DO_CON,DO_OTR,DO_TOT,DO_STK,DO_FECEXP)
	select distinct '401' as CODIGO_EJE,
		SF.CODIGO_PRE,
		'S' AS TIPSUM,
		CONVERT(varchar,@Fecha,112) AS PERIODO,
		SF.CODIGO_MED,
		SF.PRECIO_ADQUISICON,
		SF.PRECIO_OPERACION,
		(ISNULL(SF.STOCK_FIN,0) - ISNULL(VI.INGRE,0)
		+ ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto),0)) as SALDO,--Saldo inicial del día reportado : Al Saldo Final se le resta los INGRESOS y se le suma las SALIDAS
		ISNULL(VI.INGRE,0) AS INGRE,ISNULL(VI.REINGRE,0) AS REINGRE, --VARIABLES DE INGRESOS
		--VARIABLES DE SALIDA
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND  MS.idTipoConcepto IN
																																								(10,--VENTA CONTADO (PACIENTE NORMAL)
																																								11,---VENTA UNIDAD EJECUTORA
																																								12)---VENTA INSTITUCIONAL
																																								),0) AS VENTA,
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =13),0) AS SIS,
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =16),0) AS INTERSAN,--INTERVENCION SANITARIA,
		0 AS FAC_PERD,
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =22),0) AS DEFNAC,--DEFENSA NACIONAL
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =15),0) AS EXO, --EXONERACION
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =14),0) AS SOAT,--SOAT
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =17),0) AS CREDHOSP,--CREDITO HOSPITALARIO
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =23),0) AS OTR_CONV,-- OTROS CONVENIOS
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto IN
																																								(5,--Devolución por vencimiento
																																								 6,--Devolución por deterioro
																																								 7,--Devolución por sobrestock
																																								 21)--Devolución del paciente
																																													),0) AS DEVOL,--DEVOLUCIONES
		0 AS VENCIDO,
		0 AS MERMA,
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =4),0) AS DISTRI,--DISTRIBUCIÓN
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto IN
																																								(8,--Transferencias estratégicos
																																								 9)--Transferencias otras UE
																																													),0) AS TRANSF,--TRANSFERENCIAS
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =12),0) AS VENTAINST,--VENTA INSTITUCIONAL
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto =5),0) AS DEV_VEN,--DEVOLUCIÓN POR VENCIMIENTO
		0 AS DEV_MERMA,
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto IN
																																								(2,--Encargo
																																								 18,--ESSALUD
																																								 19,--Inventario
																																								 20,--Ajuste inventario
																																								 25,--Ajuste unificación de código
																																								 26)--Crédito personal
																																													),0) AS OTRAS_SAL,--OTRAS SALIDAS
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto),0) AS TOTAL, --->TOTAL DE SALIDAS DEL DÍA REPORTADO
		SF.STOCK_FIN,--SALDO FINAL DEL DIA a las 23:59 horas
		FV.FEC_EXP,
		0 AS REQUERIMIENTO,
			-- Se informa con 0 para todas las variables DONACIONES
		0 AS DO_SALDO,
		0 AS DO_INGRE,
		0 AS DO_CON,
		0 AS DO_OTR,
		0 AS DO_TOT,
		0 AS DO_STK,
		null AS DO_FECEXP
		FROM #SaldoFarmacia SF
		LEFT JOIN #FechaVencimiento FV ON SF.idAlmacen=FV.idAlmacen AND SF.idProducto=FV.idProducto
		LEFT JOIN #VariablesIngreso VI ON SF.idAlmacen=VI.idAlmacenDestino AND SF.idProducto=VI.idProducto
		WHERE SF.idTipoSuministro='01' and SF.CODIGO_MED is not null

	--6: Dando formato de la tabla y calculando las variables de salida DONACIONES
	insert into ICI_DIGEMID(CODIGO_EJE/*,idAlmacen,idProducto*/,CODIGO_PRE,TIPSUM,PERIODO,CODIGO_MED,PRECIO_ADQUISICION,PRECIO_OPERACION,SALDO,INGRE,REINGRE,VENTA,SIS,INTERSAN,FAC_PERD,DEFNAC,EXO,SOAT,CREDHOSP,OTR_CONV,
	DEVOL,VENCIDO,MERMA,DISTRI,TRANSF,VENTAINST,DEV_VEN,DEV_MERMA,OTRAS_SAL,TOTAL ,STOCK_FIN,FEC_EXP,REQUERIMIENTO,DO_SALDO,DO_INGRE,DO_CON,DO_OTR,DO_TOT,DO_STK,DO_FECEXP)
	select distinct '401' as CODIGO_EJE,
		SF.CODIGO_PRE,
		'D' AS TIPSUM,
		CONVERT(varchar,@Fecha,112) AS PERIODO,
		SF.CODIGO_MED,
		SF.PRECIO_ADQUISICON,
		SF.PRECIO_OPERACION,
		--VARIABLES DE FARMACIAS DE SISMED IGUAL A 0
		0 AS SALDO,
		0 AS INGRE,
		0 AS REINGRE,
		0 AS VENTA,
		0 AS SIS,
		0 AS INTERSAN,
		0 AS FAC_PERD,
		0 AS DEFNAC,
		0 AS EXO,
		0 AS SOAT,
		0 AS CREDHOSP,
		0 AS OTR_CONV,
		0 AS DEVOL,
		0 AS VENCIDO,
		0 AS MERMA,
		0 AS DISTRI,
		0 AS TRANSF,
		0 AS VENTAINST,
		0 AS DEV_VEN,
		0 AS DEV_MERMA,
		0 AS OTRAS_SAL,
		0 AS _TOTAL,
		0 AS STOCK_FIN,
		null AS FEC_EXP,
		0 AS REQUERIMIENTO,
		--CALCULANDO VARIABLES DE FARMACIAS DE DONACIONES
		(ISNULL(SF.STOCK_FIN,0) - ISNULL(VI.INGRE,0)
		+ ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto),0)) as DO_SALDO,--Saldo inicial del día reportado : Al Saldo Final se le resta los INGRESOS y se le suma las SALIDAS
		ISNULL(VI.INGRE,0) AS DO_INGRE,--TOTAL DE INGRESOS
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND  MS.idTipoConcepto =3),0) AS DO_CON,--->Solo movimientos de salida de tipo de concepto DONACION
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto IN (27, --Donación a pacientes
																																							  24, --Donación otras entidades
																																							  20) --AJUSTE INVENTARIO
																																									),0) AS DO_OTR ,--->TOTAL DE OTRAS SALIDAS
		--DO_TOT --->TOTAL SALIDAS DE DONACIONES = DO_CON + DO_OTR
		ISNULL((select sum(SALIDA) from #MovimientosSalida MS WHERE SF.idAlmacen=MS.idAlmacenOrigen AND SF.idProducto=MS.idProducto AND MS.idTipoConcepto IN (3, --DONACION
																																							 27, --Donación a pacientes
																																							 24, --Donación otras entidades
																																							 20) --AJUSTE INVENTARIO
																																									),0) AS DO_TOT ,--->TOTAL SALIDAS DE DONACIONES
		--DO_STK: CALCULANDO EL SALDO FINAL DEL DIA a las 23:59 horas
		SF.STOCK_FIN AS DO_STK,
		--DO_FECEXP:fecha de vencimiento próxima del grupo de lotes con saldo (DONACIONES)
		FV.FEC_EXP AS DO_FECEXP
	FROM #SaldoFarmacia SF
		LEFT JOIN #FechaVencimiento FV ON SF.idAlmacen=FV.idAlmacen AND SF.idProducto=FV.idProducto
		LEFT JOIN #VariablesIngreso VI ON SF.idAlmacen=VI.idAlmacenDestino AND SF.idProducto=VI.idProducto
	WHERE SF.idTipoSuministro='02'and SF.CODIGO_MED is not null

	--Eliminando tablas temporales
			drop table #SaldoFarmacia
			drop table #VariablesIngreso
			drop table #MovimientosSalida
			drop table #FechaVencimiento


 END
GO
ALTER AUTHORIZATION ON [dbo].[usp_GeneraIciDigemid] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_HCSinDevolver]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_HCSinDevolver]
	@horas [int]
WITH EXECUTE AS CALLER
AS
DECLARE @Fecha datetime= GETDATE()

;WITH HC_PRESTADAS AS (
SELECT IdMovimiento,IdPaciente,FechaMovimiento,IdMotivo,IdServicioOrigen as origen,IdServicioDestino
,Observacion
FROM MovimientosHistoriaClinica
WHERE IdMotivo=6 AND IdServicioOrigen=48 -- IdMotivo=6 ES PARA TRAMITES ADMINISTRATIVOS
),
HC_DEVUELTAS AS (
SELECT IdMovimiento,IdPaciente,FechaMovimiento,IdMotivo,IdServicioOrigen as origen,IdServicioDestino
,Observacion
FROM MovimientosHistoriaClinica
WHERE IdServicioDestino=48 and IdMotivo=9
)
SELECT PACIENTES.NroHistoriaClinica,Pacientes.ApellidoPaterno,Pacientes.ApellidoMaterno,Pacientes.PrimerNombre,
Pacientes.SegundoNombre, HC_PRESTADAS.FechaMovimiento as fecha_prestada,Servicios.Nombre as destino, HC_PRESTADAS.Observacion FROM HC_PRESTADAS
LEFT JOIN HC_DEVUELTAS ON HC_PRESTADAS.IdPaciente=HC_DEVUELTAS.IdPaciente
AND HC_PRESTADAS.IdMovimiento<HC_DEVUELTAS.IdMovimiento
left join Pacientes ON HC_PRESTADAS.IdPaciente=Pacientes.IdPaciente
left join Servicios on HC_PRESTADAS.IdServicioDestino=Servicios.IdServicio
WHERE HC_DEVUELTAS.IdPaciente IS NULL
AND DATEDIFF(HOUR,HC_PRESTADAS.FechaMovimiento, @Fecha)>@HORAS
order by SUBSTRING(cast(PACIENTES.NroHistoriaClinica as varchar(12)),len(PACIENTES.NroHistoriaClinica),1),PACIENTES.NroHistoriaClinica asc
--order by HC_PRESTADAS.FechaMovimiento desc
--SCCQ 17/09/2020 Cambio27 Fin
GO
ALTER AUTHORIZATION ON [dbo].[usp_HCSinDevolver] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_LabBanSangrTamizajeSIS]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_LabBanSangrTamizajeSIS]
	@idTipoFinanciamiento [int]
WITH EXECUTE AS CALLER
AS
SELECT      dbo.FactCatalogoServicios.IdProducto, dbo.FactCatalogoServicios.Codigo, dbo.FactCatalogoServicios.Nombre,
	                      dbo.FactCatalogoServiciosHosp.PrecioUnitario, dbo.FactCatalogoServiciosHosp.Activo, dbo.FactCatalogoServiciosPtos.idPuntoCarga,
                                 dbo.FactCatalogoServiciosHosp.SeUsaSinPrecio,dbo.FactCatalogoServicios.Nombre as NombreProducto,dbo.FactCatalogoServicios.LabResultadoAutomatico
	FROM         dbo.FactCatalogoServicios RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosPtos ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosPtos.idProducto RIGHT OUTER JOIN
	                      dbo.FactCatalogoServiciosHosp ON dbo.FactCatalogoServicios.IdProducto = dbo.FactCatalogoServiciosHosp.IdProducto
	WHERE     dbo.FactCatalogoServiciosPtos.idPuntoCarga = 11 and dbo.FactCatalogoServiciosHosp.idTipoFinanciamiento= @idTipoFinanciamiento
                                and dbo.FactCatalogoServicios.Codigo in ('86701','86704','86781','86706','87445','86687','86803','85014','85018','86900','86901','85048','86906','86885','85590','86890','99206') and dbo.FactCatalogoServicios.idEstado=1
             ORDER BY dbo.FactCatalogoServicios.Nombre ASC


GO
ALTER AUTHORIZATION ON [dbo].[usp_LabBanSangrTamizajeSIS] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[USP_LIQUIDACION_GetAllByIdLiquidacionReport]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_LIQUIDACION_GetAllByIdLiquidacionReport]
	@CUENTAID [varchar](max),
	@Origen [varchar](5),
	@Factor [numeric](19, 5)
WITH EXECUTE AS CALLER
AS
DECLARE @PORCENTAJE NUMERIC(19,5) = @Factor/100
IF @Factor =0
BEGIN
		IF @Origen ='S'
		BEGIN

			SELECT
			'' RUC,
			'' NOMBREEMPRESA,
			'' DIRECCION,
			'' HISTORIA,
			'' PACIENTE,
			'' PLACA,
			'' NROPOLIZA,
			CS.Codigo ITEM,
			CS.Nombre NOMBRE,
			--OS.idTipoFinanciamiento,
			SUM(SD.Precio) PRECIO,
			SUM(SD.Cantidad) CANTIDAD,
			0 DESCUENTO,
			SUM(SD.Total) IMPORTE,
			0 IGV,
			SUM(SD.Total) TOTAL

			FROM  dbo.FacturacionServicioDespacho SD
			INNER JOIN  dbo.FactOrdenServicio OS ON SD.idOrden = OS.IdOrden
			INNER JOIN  dbo.FactCatalogoServicios CS ON SD.IdProducto = CS.IdProducto
			WHERE       OS.IdCuentaAtencion IN (SELECT VALUE FROM STRING_SPLIT(@CUENTAID))
			GROUP BY 	CS.Codigo,   CS.Nombre, OS.idTipoFinanciamiento
			ORDER BY  CS.Nombre ASC

		END
		ELSE
		BEGIN

		SELECT
			'' RUC,
			'' NOMBREEMPRESA,
			'' DIRECCION,
			'' HISTORIA,
			'' PACIENTE,
			'' PLACA,
			'' NROPOLIZA,
			CBI.Codigo ITEM,
			CBI.Nombre NOMBRE,
			--MV.idTipoFinanciamiento ,
			SUM(MD.precio)PRECIO,
			SUM(MD.cantidad)CANTIDAD,
			0 DESCUENTO,
			round(SUM(MD.total)/1.18,2) IMPORTE,
			SUM(MD.total) - round(SUM(MD.total)/1.18,2) IGV,
			SUM(MD.total) TOTAL
			 FROM  farmMovimientoVentas  MV
			INNER JOIN dbo.farmMovimientoVentasDetalle MD ON MV.movNumero = MD.MovNumero AND MV.movTipo = MD.MovTipo
			INNER JOIN dbo.FactCatalogoBienesInsumos CBI ON MD.idProducto = CBI.IdProducto

			WHERE
				MV.idCuentaAtencion IN (SELECT VALUE FROM STRING_SPLIT(@CUENTAID))
				AND MV.idTipoFinanciamiento=3
				--and dbo.farmMovimiento.idEstadoMovimiento=1
			GROUP BY CBI.Codigo,CBI.Nombre,MV.idTipoFinanciamiento
			ORDER BY  CBI.Nombre ASC


		END
END
ELSE
IF @Factor >0
BEGIN
	SELECT
	'' RUC,
	'' NOMBREEMPRESA,
	'' DIRECCION,
	'' HISTORIA,
	'' PACIENTE,
	'' PLACA,
	'' NROPOLIZA,
	CS.Codigo ITEM,
    CS.Nombre NOMBRE,
	--OS.idTipoFinanciamiento,
	SD.Precio PRECIO,
	SUM(SD.Cantidad) CANTIDAD,
	0 DESCUENTO,
	SUM(SD.Total) IMPORTE,
	0 IGV,
   SUM(SD.Total)+ROUND( SUM(SD.Total)* @PORCENTAJE,2)  TOTAL
   INTO ##SERVICIOS
    FROM  dbo.FacturacionServicioDespacho SD
	INNER JOIN  dbo.FactOrdenServicio OS ON SD.idOrden = OS.IdOrden
	INNER JOIN  dbo.FactCatalogoServicios CS ON SD.IdProducto = CS.IdProducto
    WHERE       OS.IdCuentaAtencion IN (SELECT VALUE FROM STRING_SPLIT(@CUENTAID))
	GROUP BY 	CS.Codigo,   CS.Nombre, SD.Precio
    ORDER BY  CS.Nombre ASC

	SELECT
	 RUC,
	 NOMBREEMPRESA,
	 DIRECCION,
	'' HISTORIA,
	 PACIENTE,
	 PLACA,
	 NROPOLIZA,
	 ITEM,
     NOMBRE,
	 TOTAL/CANTIDAD  PRECIO,
	 CANTIDAD,
	 0 DESCUENTO,
	 TOTAL IMPORTE,
	 0 IGV,
     TOTAL
   FROM ##SERVICIOS


END
ELSE
BEGIN

SELECT
	'' RUC,
	'' NOMBREEMPRESA,
	'' DIRECCION,
	'' HISTORIA,
	'' PACIENTE,
	'' PLACA,
	'' NROPOLIZA,
	CBI.Codigo ITEM,
	CBI.Nombre NOMBRE,
	--MV.idTipoFinanciamiento ,
	MD.precio PRECIO,
	SUM(MD.cantidad)CANTIDAD,
	0 DESCUENTO,
	round(SUM(MD.total)/1.18,2) IMPORTE,
	SUM(MD.total) - round(SUM(MD.total)/1.18,2) IGV,
	SUM(MD.total) +ROUND( SUM(MD.total) * @PORCENTAJE,2) TOTAL
	INTO ##FARMACIA
	 FROM  farmMovimientoVentas  MV
	INNER JOIN dbo.farmMovimientoVentasDetalle MD ON MV.movNumero = MD.MovNumero AND MV.movTipo = MD.MovTipo
	INNER JOIN dbo.FactCatalogoBienesInsumos CBI ON MD.idProducto = CBI.IdProducto

	WHERE
		MV.idCuentaAtencion IN (SELECT VALUE FROM STRING_SPLIT(@CUENTAID))
		AND MV.idTipoFinanciamiento=3
		--and dbo.farmMovimiento.idEstadoMovimiento=1
	GROUP BY CBI.Codigo,CBI.Nombre,MD.precio
	ORDER BY  CBI.Nombre ASC

	SELECT
	 RUC,
	 NOMBREEMPRESA,
	 DIRECCION,
	 HISTORIA,
	 PACIENTE,
	 PLACA,
	 NROPOLIZA,
	 ITEM,
     NOMBRE,
	 TOTAL/CANTIDAD  PRECIO,
	 CANTIDAD,
	 0 DESCUENTO,
	 round(TOTAL/1.18,2) IMPORTE,
	 TOTAL  -round(TOTAL/1.18,2) IGV,
	 TOTAL
   FROM ##FARMACIA
END


GO
ALTER AUTHORIZATION ON [dbo].[USP_LIQUIDACION_GetAllByIdLiquidacionReport] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_cita_agendada]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_cita_agendada]
	@sUps [varchar](10),
	@sCodMed [varchar](20),
	@sFecha [varchar](10),
	@sPachis [varchar](8)
WITH EXECUTE AS CALLER
AS
Begin

      SET NOCOUNT ON;

      declare @lenguaje varchar(20)
      set @lenguaje=@@language
      if @@language != 'spanish' set language spanish

      SELECT
      codcita, fecha, hora, turno, codcon, descon, ups, codmed, nommed, pachis, paciente,
      tidcod, tiddes, pacdoc, numpre,des_ups AS desser,flag_est,horario
      FROM Minsa_vCitaProgramada
      WHERE
      (@sUps is null or @sUps = '' or ups=@sUps) and
      (@sCodMed is null or @sCodMed = '' or codmed=@sCodMed) and
      (@sFecha is null or @sFecha = '' or fecha=@sFecha) and
      (@sPachis is null or @sPachis = '' or pachis=@sPachis)
      group by codcita, fecha, hora, turno, codcon, descon, ups, codmed, nommed, pachis, paciente,
      tidcod, tiddes, pacdoc, numpre,des_ups,flag_est,horario
     order by cast(fecha as smalldatetime) desc


end;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_cita_agendada] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_ici_diario]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_ici_diario]
WITH EXECUTE AS CALLER
AS
begin

SELECT
codigo_eje,
codigo_pre,
tipsum,
periodo,
codigo_med,
isnull(convert(varchar(20),PRECIO_ADQUISICION),'0') precio_adq,
isnull(convert(varchar(20),PRECIO_OPERACION),'0') precio_ope,
isnull(saldo,0.0) saldo,
ISNULL(ingre,0) ingre,
isnull(reingre,0) reingre,
isnull(venta,0) venta,
isnull(sis,0) sis,
isnull(intersan,0) intersan,
isnull(fac_perd,0) fac_perd,
isnull(defnac,0) defnac,
isnull(exo,0) exo,
isnull(soat,0) soat,
isnull(credhosp,0) credhosp,
isnull(otr_conv,0) otr_conv,
isnull(devol,0) devol,
isnull(vencido,0) vencido,
isnull(merma,0) merma,
isnull(distri,0) distri,
isnull(transf,0) transf,
isnull(ventainst,0) ventainst,
isnull(dev_ven,0) dev_ven,
isnull(dev_merma,0) dev_merma,
isnull(otras_sal,0) otras_sal,
isnull(total,0) total,
isnull(stock_fin,0) stock_fin,
convert(varchar(8),isnull(fec_exp,'1900-01-01'),112) fec_exp,
isnull(REQUERIMIENTO,0) req,
isnull(do_saldo,0) do_saldo,
isnull(do_ingre,0) do_ingre,
isnull(do_con,0) do_con,
isnull(do_otr,0) do_otr,
isnull(do_tot,0) do_tot,
isnull(do_stk,0) do_stk,
convert(varchar(8),isnull(do_fecexp,'1900-01-01'),112) do_fecexp
FROM ICI_DIGEMID
WHERE PERIODO = CONVERT(VARCHAR(8),(GeTDATE()-1),112)

end;

GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_ici_diario] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_paciente]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_paciente]
	@sTipDoc [varchar](10),
	@sNroDoc [varchar](20),
	@sApePat [varchar](50),
	@sApeMat [varchar](50),
	@sNroHis [varchar](20),
	@sFechaNac [varchar](10)
WITH EXECUTE AS CALLER
AS
Begin

      if len(@sNroHis)>0
            SELECT DISTINCT PACHIS, APEPAT, APEMAT, NOMPAC, DOCPAC, TIPDOC, DESTIPDOC,fecha_nac
            FROM MINSA_vPACIENTE
            WHERE PACHIS = @sNroHis;
      else
            SELECT DISTINCT PACHIS, APEPAT, APEMAT, NOMPAC, DOCPAC, TIPDOC, DESTIPDOC,fecha_nac
            FROM MINSA_vPACIENTE
            WHERE
            (@sNroHis IS NULL OR @sNroHis = '' OR PACHIS = @sNroHis) AND
            (@sTipDoc IS NULL OR @sTipDoc = '' OR TIPDOC = @sTipDoc) AND
            (@sNroDoc IS NULL OR @sNroDoc = '' OR DOCPAC LIKE '%' + @sNroDoc + '%') AND
            (@sApePat IS NULL OR @sApePat = '' OR APEPAT LIKE '%' + @sApePat + '%') AND
            (@sApeMat IS NULL OR @sApeMat = '' OR APEMAT LIKE '%' + @sApeMat + '%') AND
            (@sFechaNac IS NULL OR @sFechaNac = '' OR Fecha_Nac = @sFechaNac);

end;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_paciente] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_periodo_programacion]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_periodo_programacion]
WITH EXECUTE AS CALLER
AS
Begin

	SELECT DISTINCT CASE SUBSTRING(PERIODO,5,2)
		WHEN '01' THEN 'Enero, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '02' THEN 'Febrero, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '03' THEN 'Marzo, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '04' THEN 'Abril, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '05' THEN 'Mayo, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '06' THEN 'Junio, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '07' THEN 'Julio, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '08' THEN 'Agosto, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '09' THEN 'Septiembre, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '10' THEN 'Octubre, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '11' THEN 'Noviembre, ' + CONVERT(CHAR(4),PERIODO)
		WHEN '12' THEN 'Diciembre, ' + CONVERT(CHAR(4),PERIODO)
		END PROGRAMACION,  PERIODO
	FROM MINSA_vProgramacion

end;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_periodo_programacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_programacion]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_programacion]
	@sPeriodo [varchar](6),
	@sUps [varchar](10),
	@sCodMed [varchar](20),
	@sFecha [varchar](10)
WITH EXECUTE AS CALLER
AS
Begin

	SELECT medcod, mednom, ups, periodo,fecha, turrat, horini, horfin, codcon, turno,desups AS desser
	FROM MINSA_vProgramacion
	WHERE Periodo=@sPeriodo and
	(@sUps is null or @sUps = '' or ups=@sUps) and
	(@sCodMed is null or @sCodMed = '' or medcod=@sCodMed) and
	(@sFecha is null or @sFecha = '' or fecha=@sFecha)
	order by mednom

end;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_programacion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_tipo_documento]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_tipo_documento]
	@sTidCod [varchar](2)
WITH EXECUTE AS CALLER
AS
Begin

	SELECT tidcod, tiddes, '' tidobs
	FROM Minsa_vTipoDocumento
	WHERE
	(@sTidCod is null or @sTidCod = '' or tidcod=@sTidCod)

end;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_tipo_documento] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listar_ups]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listar_ups]
	@sPaciente [varchar](10)
WITH EXECUTE AS CALLER
AS
begin

select distinct
ups AS codups,
CAST(ups AS VARCHAR(6)) COLLATE DATABASE_DEFAULT + ' - ' + desser AS desups, (select rtrim(ltrim(ValorTexto)) from Parametros where IdParametro=280) codest, '1' flag
FROM MINSA_VPROGRAMACION
where  CODCON in (
SELECT IdServicio FROM SERVICIOS
where IdTipoServicio=1 and (soloTipoSexo=3 or soloTipoSexo in (SELECT IdTipoSexo FROM MINSA_VPACIENTE WHERE DOCPAC=@sPaciente)) and
maximaEdad>=(SELECT DATEDIFF(DAY,FechaNacimiento,GETDATE()) DIAS FROM MINSA_VPACIENTE WHERE DOCPAC=@sPaciente))

END;
GO
ALTER AUTHORIZATION ON [dbo].[usp_listar_ups] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarcatalogoid]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarcatalogoid]
	@Id [int]
WITH EXECUTE AS CALLER
AS
select * from FactCatalogoServiciosN
where Id = @Id
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarcatalogoid] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarcatalogoidat]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarcatalogoidat]
	@IdAtencion [varchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

select *  from FactCatalogoServiciosN
WHERE IdAtencion =@IdAtencion
END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarcatalogoidat] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarcatalogoservicio]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarcatalogoservicio]
	@Descripcion_Item [varchar](300),
	@Descripcion_Tipo_Item [varchar](100)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

select * from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS
WHERE Descripcion_Item like '%'+@Descripcion_Item+'%' AND Descripcion_Tipo_Item=@Descripcion_Tipo_Item and fg_estado=1

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarcatalogoservicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarcatalogoservicioc]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarcatalogoservicioc]
	@Codigo_Item [varchar](10),
	@Descripcion_Tipo_Item [varchar](100)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

select * from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS
WHERE Codigo_Item like @Codigo_Item+'%' AND Descripcion_Tipo_Item=@Descripcion_Tipo_Item

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarcatalogoservicioc] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_ListarHIS_situacio]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_ListarHIS_situacio]
WITH EXECUTE AS CALLER
AS
select IdHisSituacio,RTRIM(valores) as valores ,RTRIM(descripcio) as descripcio,codigo  from HIS_situacio

where LABHISWEB=1

order by valores




GO
ALTER AUTHORIZATION ON [dbo].[usp_ListarHIS_situacio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarhissituacio]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarhissituacio]
	@Descripcio [varchar](100)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

select valores, Descripcio  from HIS_situacio
WHERE Descripcio like @Descripcio+'%'

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarhissituacio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listarsubclasdx]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listarsubclasdx]
	@Descripcion [varchar](100)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

select Codigo, Descripcion  from SubclasificacionDiagnosticos
WHERE  IdClasificacionDx='1'

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listarsubclasdx] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_listartipoitem]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_listartipoitem]
	@Descripcion_Tipo_Item [varchar](100)
WITH EXECUTE AS CALLER
AS
BEGIN

SET NOCOUNT ON;

SELECT DISTINCT Descripcion_Tipo_Item,Fg_Tipo
FROM BDHIS_MINSA.DBO.MAESTRO_HIS_CIE_CPMS
WHERE Descripcion_Tipo_Item NOT IN
    (
        'Diagnóstico (CIEX)'
    )

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_listartipoitem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Filtrar]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Filtrar]
	@Descripcion_Tipo_Item [varchar](100) = NULL,
	@Codigo_Item [varchar](10) = null,
	@Descripcion_Item [varchar](300)
WITH EXECUTE AS CALLER
AS
BEGIN

 if @Descripcion_Tipo_Item is null and @Codigo_Item is null
 BEGIN
	 select Codigo_Item,Descripcion_Item,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

	WHERE Descripcion_Item like '%'+@Descripcion_Item+'%' and Fg_Estado=1 and Fg_Tipo <>'CX'
 END
 if @Descripcion_Tipo_Item is null and @Codigo_Item is not null

	BEGIN
		select Codigo_Item,Descripcion_Item,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

		WHERE Descripcion_Item like '%'+@Descripcion_Item+'%' and Codigo_Item=@Codigo_Item and Fg_Estado=1 and Fg_Tipo <>'CX'
	END
 if @Descripcion_Tipo_Item is not null and @Codigo_Item is null

	BEGIN
		select Codigo_Item,Descripcion_Item,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

		WHERE Descripcion_Item like '%'+@Descripcion_Item+'%' and Descripcion_Tipo_Item=@Descripcion_Tipo_Item and Fg_Estado=1 and Fg_Tipo <>'CX'
	END
if @Descripcion_Tipo_Item is not null and @Codigo_Item is not null

	BEGIN
		select Codigo_Item,Descripcion_Item,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

		WHERE Descripcion_Item like '%'+@Descripcion_Item+'%' and Descripcion_Tipo_Item=@Descripcion_Tipo_Item and Codigo_Item=@Codigo_Item and Fg_Estado=1 and Fg_Tipo <>'CX'
	END
END


GO
ALTER AUTHORIZATION ON [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Filtrar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Listar_Descripcion_Tipo_Item]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Listar_Descripcion_Tipo_Item]
WITH EXECUTE AS CALLER
AS
begin
select  distinct Fg_Tipo,Descripcion_Tipo_Item from [BDHIS_MINSA].[dbo].[MAESTRO_HIS_CIE_CPMS]
where Fg_Tipo <> 'CX' and Fg_Estado=1
end


GO
ALTER AUTHORIZATION ON [dbo].[usp_MAESTRO_HIS_CIE_CPMS_Listar_Descripcion_Tipo_Item] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_MAESTRO_HIS_CIE_CPMS_SeleccionarPorCodigo]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_MAESTRO_HIS_CIE_CPMS_SeleccionarPorCodigo]
	@Codigo_Item [varchar](10),
	@Fg_Tipo [varchar](2) = NULL
WITH EXECUTE AS CALLER
AS
BEGIN
 if @Fg_Tipo is null
 BEGIN
	 select Codigo_Item,Descripcion_Item,Fg_Tipo,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

	WHERE Codigo_Item=@Codigo_Item and Fg_Estado=1 and Fg_Tipo <>'CX'
 END
 ELSE
	BEGIN
		select Codigo_Item,Descripcion_Item,Fg_Tipo,Descripcion_Tipo_Item from BDHIS_MINSA.dbo.MAESTRO_HIS_CIE_CPMS

	WHERE Codigo_Item=@Codigo_Item and Fg_Tipo=@Fg_Tipo and Fg_Estado=1 and Fg_Tipo <>'CX'
	END
END


GO
ALTER AUTHORIZATION ON [dbo].[usp_MAESTRO_HIS_CIE_CPMS_SeleccionarPorCodigo] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_ObtenerDatosAdicionalesDeAtencionPorIdAtencion]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_ObtenerDatosAdicionalesDeAtencionPorIdAtencion]
	@idAtencion [int]
WITH EXECUTE AS CALLER
AS
SELECT
[NroReferenciaOrigen],[IdEstablecimientoOrigen],dbo.Establecimientos.Nombre As NombreEstablecimiento,dbo.FuentesFinanciamiento.Descripcion As FuenteFinanciamiento
FROM AtencionesDatosAdicionales
LEFT JOIN dbo.Establecimientos
ON
LTRIM(dbo.AtencionesDatosAdicionales.IdEstablecimientoOrigen) = dbo.Establecimientos.IdEstablecimiento
LEFT JOIN dbo.FuentesFinanciamiento
ON
(select dbo.Atenciones.idFuenteFinanciamiento
from Atenciones
left Join dbo.FuentesFinanciamiento
on dbo.Atenciones.idFuenteFinanciamiento = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
where idAtencion = @idAtencion) = dbo.FuentesFinanciamiento.IdFuenteFinanciamiento
WHERE idAtencion = @idAtencion
GO
ALTER AUTHORIZATION ON [dbo].[usp_ObtenerDatosAdicionalesDeAtencionPorIdAtencion] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_programacion_ups]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_programacion_ups]
	@sUps [varchar](10),
	@sPeriodo [varchar](6),
	@sCodMed [varchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
  SELECT distinct medcod,mednom
  FROM MINSA_vProgramacion vp
  WHERE vp.ups = @sUps AND
  (@sPeriodo is null or @sPeriodo = '' or Periodo = @sPeriodo) and
  (@sCodMed is null or @sCodMed = '' or medcod=@sCodMed)
  order by  mednom;

END
GO
ALTER AUTHORIZATION ON [dbo].[usp_programacion_ups] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_RegCitas_Minsa]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_RegCitas_Minsa]
	@fecha [varchar](8),
	@hora [varchar](5),
	@medcod [varchar](10),
	@codcon [varchar](30),
	@codups [varchar](10),
	@pachis [varchar](9),
	@pacnam [varchar](100),
	@sMsg [varchar](200) OUTPUT
WITH EXECUTE AS CALLER
AS
DECLARE @dFecha datetime, @iEstado int, @dni varchar(12),@conta int, @idCita int,
@apepat varchar(20),@apemat varchar(20), @prinom varchar(20),@segnom varchar(20),@idpaciente int,
@idtipsex int, @fecnac datetime;
BEGIN

BEGIN TRAN

--BEGIN TRY

	set @dFecha=CONVERT(datetime,@fecha);
	--obtengo estado e idcita.
		select @iEstado=idEstadoCitaWeb,@idCita=idCitaBloqueada
		from [SIGH_EXTERNA].[dbo].[CitasWebCupos]
		where Fecha=@dFecha and idServicio=@codcon and idMedico=@medcod and HoraInicio=@hora;
	if(@iEstado<>2)
	begin
		set @sMsg = 'V*La cita no se encuentra disponible';
		commit tran;
		return;
	end
	else
	begin
		--Obtengo los datos del paciente.
		select
			@dni=docpac,@apepat=upper(isnull(apepat,'')),@apemat=upper(isnull(apemat,'')), @prinom=upper(isnull(prinom,'')),@segnom=upper(isnull(segnom,'')),
			@idtipsex=idTipoSexo, @fecnac=FechaNacimiento,@idpaciente=idpaciente
			from MINSA_vPaciente
			where PACHIS=@pachis;
		--valido que no haya registrado una cita el paciente para el mismo dia, en el mismo servicio.
		select @conta=COUNT(*)
		from [SIGH_EXTERNA].[dbo].[CitasWebCupos]
		where Fecha=@dFecha and idServicio=@codcon and idMedico=@medcod and DNI=@dni;
		if @conta>0
		begin
			set @sMsg = 'V*Estimado(a) ' + @prinom + ' ' + @segnom + ' ' +  @apepat + ' ' + @apemat + ', ya cuenta con una cita registrada para el dia y servicio seleccionado.';
			commit tran;
			return;
		end
		else
		begin
			update [SIGH_EXTERNA].[dbo].[CitasWebCupos]
			set
			idEstadoCitaWeb=3,dni=@dni,ApellidoPaterno=@apepat,ApellidoMaterno=@apemat,
			PrimerNombre=@prinom,SegundoNombre=@segnom,
			idTipoSexo=@idtipsex, FechaNacimiento=@fecnac, idFuenteFinanciamiento=1, idpaciente=@idpaciente
			where Fecha=@dFecha and idServicio=@codcon and idMedico=@medcod and HoraInicio=@hora;
			set @sMsg = 'O*Su nro de cita es:'+convert(varchar(20),@idCita);
			commit tran;
			return;
			select * from[SIGH_EXTERNA].[dbo].[CitasWebCupos]
		end
	end

--END TRY

--BEGIN CATCH
--	set @sMsg = 'E*No se pudo registrar la cita.';
--	ROLLBACK;
--END CATCH

end
GO
ALTER AUTHORIZATION ON [dbo].[usp_RegCitas_Minsa] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_SeleccionarProductividadXServicio]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_SeleccionarProductividadXServicio]
	@Fecha_inicio [datetime],
	@Fecha_fin [datetime],
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
--Flujo
--1: Determinar el idPuntoCarga
--2: Determinar el idServicio
--3: Según el idServicio establecer la ruta a tomar.

--VERIFICAMOS HORA DE LA FECHA FINAL
if convert(char(5), @Fecha_fin, 108) ='00:00'
	begin
		set @Fecha_fin=DATEADD( HH, 23, @Fecha_fin )
		set @Fecha_fin=DATEADD( MINUTE, 59, @Fecha_fin )
	end
--SELECCIONAMOS EL idPuntoCarga
declare @IdPuntoCarga as int
set @IdPuntoCarga=(select IdPuntoCarga from Imagenes.Servicio where IdServicio=@IdServicio)
declare @NombreServicio as varchar(60)
set @NombreServicio=(select Nombre from Imagenes.Servicio where IdServicio=@IdServicio)
--Indicamos restricciones

--CREAMOS UNA TABLA TEMPORAL
--select * from [Imagenes].SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga) A
--Atenciones de Tomografía Computarizada (1) - Ecografía General (6) (Comparten sus módulo en el Galenhos con servicios 1->(3,4) y 6->(2))
if @IdServicio=1 or @IdServicio=6
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga) A
		--En SISGALENPLUS Tomografía Computarizada tiene su propio módulo pero comparte con Resonancia y Mamografía
		left join Imagenes.Procedimiento on A.CodigoProcedimiento collate Modern_Spanish_CI_AS=Imagenes.Procedimiento.Codigo
		where Imagenes.Procedimiento.IdServicio is null -- los que no coinciden con el catálogo
	end
--Densitometría (2), Resonancia (3), Mamografía (4)  (No tienen módulo propio en Galenhos, registran en 3 y 4->1, 2 en ->6 )
if @IdServicio=2 or @IdServicio=3 or @IdServicio=4
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga)A
			inner join Imagenes.Procedimiento on A.CodigoProcedimiento collate Modern_Spanish_CI_AS=Imagenes.Procedimiento.Codigo
		where Imagenes.Procedimiento.IdServicio=@IdServicio
	end
-- Rayos X o Ecografía Obstétrica (Usan exclusivamente sus módulos en Galenhos)
if @IdServicio=5 or @IdServicio=7
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga)
	end

GO
ALTER AUTHORIZATION ON [dbo].[usp_SeleccionarProductividadXServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[usp_SeleccionarServicios]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[usp_SeleccionarServicios]
WITH EXECUTE AS CALLER
AS
select * from imagenes.Servicio where estado=1
GO
ALTER AUTHORIZATION ON [dbo].[usp_SeleccionarServicios] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesAgregar]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UsuariosRolesAgregar]
	@IdEmpleado [int],
	@IdRol [int],
	@IdUsuarioRol [int] OUTPUT,
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
insert into UsuariosRoles (
IdEmpleado,IdRol) values (
@IdEmpleado,@IdRol)
set @IdUsuarioRol = @@Identity
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesAgregar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesEliminar]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UsuariosRolesEliminar]
	@IdUsuarioRol [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
delete from UsuariosRoles
where IdUsuarioRol = @IdUsuarioRol
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesEliminar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesElimnaXidEmpleado]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[UsuariosRolesElimnaXidEmpleado]
	@lIdEmpleado [int]
WITH EXECUTE AS CALLER
AS
delete from UsuariosRoles where IdEmpleado =  @lIdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesElimnaXidEmpleado] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesModificar]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UsuariosRolesModificar]
	@IdEmpleado [int],
	@IdRol [int],
	@IdUsuarioRol [int],
	@IdUsuarioAuditoria [int]
WITH EXECUTE AS CALLER
AS
update UsuariosRoles
set
IdEmpleado = @IdEmpleado,
IdRol = @IdRol
where IdUsuarioRol = @IdUsuarioRol
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesModificar] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesSeleccionarPorEmpleados]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[UsuariosRolesSeleccionarPorEmpleados]
	@IdEmpleado [int]
WITH EXECUTE AS CALLER
AS
select Roles.IdRol, Roles.Nombre from UsuariosRoles
left join Roles on UsuariosRoles.IdRol = Roles.IdRol
where IdEmpleado = @IdEmpleado
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesSeleccionarPorEmpleados] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesSeleccionarPorId]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UsuariosRolesSeleccionarPorId]
	@IdUsuarioRol [int]
WITH EXECUTE AS CALLER
AS
select * from UsuariosRoles
where IdUsuarioRol = @IdUsuarioRol
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesSeleccionarPorId] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesSeleccionarTodasOpciones]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[UsuariosRolesSeleccionarTodasOpciones]
WITH EXECUTE AS CALLER
AS
SELECT         dbo.Roles.Nombre AS rol, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno, dbo.Empleados.Nombres,
                         dbo.ListBarItems.Texto AS opcion
FROM            dbo.UsuariosRoles INNER JOIN
                         dbo.Roles ON dbo.UsuariosRoles.IdRol = dbo.Roles.IdRol INNER JOIN
                         dbo.Empleados ON dbo.UsuariosRoles.IdEmpleado = dbo.Empleados.IdEmpleado INNER JOIN
                         dbo.RolesItems ON dbo.Roles.IdRol = dbo.RolesItems.IdRol INNER JOIN
                         dbo.ListBarItems ON dbo.RolesItems.IdListItem = dbo.ListBarItems.IdListItem
ORDER BY rol, dbo.Empleados.ApellidoPaterno, dbo.Empleados.ApellidoMaterno
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesSeleccionarTodasOpciones] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[UsuariosRolesXidEmpleadoEsDeFarmacia]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[UsuariosRolesXidEmpleadoEsDeFarmacia]
	@ml_idUsuario [int]
WITH EXECUTE AS CALLER
AS
select distinct RolesPermisos.IdPermiso,permisos.modulo from (((Empleados
           left join UsuariosRoles on Empleados.IdEmpleado = UsuariosRoles.IdEmpleado)
           left join Roles on UsuariosRoles.IdRol = Roles.IdRol)
           left join RolesPermisos on Roles.IdRol = RolesPermisos.IdRol)
           left join Permisos on RolesPermisos.IdPermiso = Permisos.IdPermiso
           where Empleados.Idempleado = @ml_idUsuario  and permisos.modulo='Farmacia'
GO
ALTER AUTHORIZATION ON [dbo].[UsuariosRolesXidEmpleadoEsDeFarmacia] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ValidarReglasExamen]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ValidarReglasExamen]
	@cod [int]
WITH EXECUTE AS CALLER
AS
SELECT * FROM factCatalogoServicios WHERE factCatalogoServicios.IdProducto IN
			(SELECT DISTINCT LabResultadoPorItems.idProductoCPT
			FROM LabResultadoPorItems) AND factCatalogoServicios.IdProducto=@cod
GO
ALTER AUTHORIZATION ON [dbo].[ValidarReglasExamen] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ValidarReglasGrupoItem]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ValidarReglasGrupoItem]
	@cod [char](10)
WITH EXECUTE AS CALLER
AS
SELECT * FROM LabItemsGrupos
WHERE LabItemsGrupos.IdItemGrupo IN
	 (
		SELECT DISTINCT LabItemsCpt.idItemGrupo
	             FROM LabItemsCpt INNER JOIN
	             LabResultadoPorItems ON LabItemsCpt.idProductoCpt = LabResultadoPorItems.idProductoCpt AND
	             LabItemsCpt.ordenXresultado = LabResultadoPorItems.ordenXresultado
	) AND LabItemsGrupos.IdItemGrupo=@cod
GO
ALTER AUTHORIZATION ON [dbo].[ValidarReglasGrupoItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [dbo].[ValidarReglasItem]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[ValidarReglasItem]
	@cod [char](10)
WITH EXECUTE AS CALLER
AS
SELECT * FROM LabItems
WHERE LabItems.IdItem IN
	( SELECT DISTINCT LabItemsCpt.idItem
                FROM LabItemsCpt INNER JOIN
               LabResultadoPorItems ON LabItemsCpt.idProductoCpt = LabResultadoPorItems.idProductoCpt AND
               LabItemsCpt.ordenXresultado = LabResultadoPorItems.ordenXresultado
	) AND LabItems.IdItem=@cod
GO
ALTER AUTHORIZATION ON [dbo].[ValidarReglasItem] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [Imagenes].[usp_SeleccionarProductividadXServicio]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [Imagenes].[usp_SeleccionarProductividadXServicio]
	@Fecha_inicio [datetime],
	@Fecha_fin [datetime],
	@IdServicio [int]
WITH EXECUTE AS CALLER
AS
--Flujo
--1: Determinar el idPuntoCarga
--2: Determinar el idServicio
--3: Según el idServicio establecer la ruta a tomar.

--VERIFICAMOS HORA DE LA FECHA FINAL
if convert(char(5), @Fecha_fin, 108) ='00:00'
	begin
		set @Fecha_fin=DATEADD( HH, 23, @Fecha_fin )
		set @Fecha_fin=DATEADD( MINUTE, 59, @Fecha_fin )
	end
--SELECCIONAMOS EL idPuntoCarga
declare @IdPuntoCarga as int
set @IdPuntoCarga=(select IdPuntoCarga from Imagenes.Servicio where IdServicio=@IdServicio)
declare @NombreServicio as varchar(60)
set @NombreServicio=(select Nombre from Imagenes.Servicio where IdServicio=@IdServicio)
--Indicamos restricciones

--CREAMOS UNA TABLA TEMPORAL
--select * from [Imagenes].SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga) A
--Atenciones de Tomografía Computarizada (1) - Ecografía General (6) (Comparten sus módulo en el Galenhos con servicios 1->(3,4) y 6->(2))
if @IdServicio=1 or @IdServicio=6
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga) A
		--En SISGALENPLUS Tomografía Computarizada tiene su propio módulo pero comparte con Resonancia y Mamografía
		left join Imagenes.Procedimiento on A.CodigoProcedimiento collate Modern_Spanish_CI_AS=Imagenes.Procedimiento.Codigo
		where Imagenes.Procedimiento.IdServicio is null -- los que no coinciden con el catálogo
	end
--Densitometría (2), Resonancia (3), Mamografía (4)  (No tienen módulo propio en Galenhos, registran en 3 y 4->1, 2 en ->6 )
if @IdServicio=2 or @IdServicio=3 or @IdServicio=4
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga)A
			inner join Imagenes.Procedimiento on A.CodigoProcedimiento collate Modern_Spanish_CI_AS=Imagenes.Procedimiento.Codigo
		where Imagenes.Procedimiento.IdServicio=@IdServicio
	end
-- Rayos X o Ecografía Obstétrica (Usan exclusivamente sus módulos en Galenhos)
if @IdServicio=5 or @IdServicio=7
	begin
		select distinct @NombreServicio as Servicio,* from [Imagenes].fnt_SeleccionarProductividadImagGalenhos(@Fecha_inicio,@Fecha_fin,@IdPuntoCarga)
	end

GO
ALTER AUTHORIZATION ON [Imagenes].[usp_SeleccionarProductividadXServicio] TO  SCHEMA OWNER
GO
/****** Object:  StoredProcedure [Imagenes].[usp_SeleccionarServicios]    Script Date: 12/01/2026 02:48:10 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [Imagenes].[usp_SeleccionarServicios]
WITH EXECUTE AS CALLER
AS
select * from imagenes.Servicio where estado=1
GO
ALTER AUTHORIZATION ON [Imagenes].[usp_SeleccionarServicios] TO  SCHEMA OWNER
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'dato para el sistema HIS, que se ingresara en ATENCION CE' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtencionesDiagnosticos', @level2type=N'COLUMN',@level2name=N'labConfHIS'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->llego al servicio' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtencionesEstanciaHospitalaria', @level2type=N'COLUMN',@level2name=N'LlegoAlServicio'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Etapas en que divide la vida de un ser humana para efecto de la Atencion Integral' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteGrupo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Registro de datos proporcionados por el paciente en su primer contacto con el establecimiento' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteGrupoHCPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Items que se evaluan en el proceso de control de desarrollo psicomotor' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemDesarrollo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Grupo de items contempladas en el plan integral' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlan'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plantilla plan de atenciones de crecimiento' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlanCrecimiento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plantilla plan de atenciones de desarrollo' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlanDesarrollo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plantilla de plan de atenciones de inmunizaciones y tamizajes' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlanProcedimiento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Producto administrar(Hierro, Vitamina A)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlanSuplemento', @level2type=N'COLUMN',@level2name=N'IdProducto'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plantilla plan de atenciones de suplemento nutricional' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenInteItemPlanSuplemento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Fechas en que se le da atención a un paciente en cada etapa de su vida' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanAtencion'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plan de atencion de control de crecimiento de un paciente' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanCrecimientoPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1 Normal, 2 Deficit' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanDesarrolloPaciente', @level2type=N'COLUMN',@level2name=N'Evaluacion'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plan de atencion de desarrolo psicomotor de un paciente' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanDesarrolloPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Planes de Atencion Generados para cada paciente en la diferentes etapas de su vida' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanIntegralPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Registro de Indicadores de los Item a los que se le elaboro plan integral' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanItemElaborado'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Id de procedimiento applicado(Tamizaje TSH, etc)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanProcedimientoPaciente', @level2type=N'COLUMN',@level2name=N'IdProducto'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plan de atencion de inmunizaciones y tamizajes de un paciente' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanProcedimientoPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'plan de administracion de suplemento nutricional de un paciente' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlanSuplementoPaciente'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Plantilla de items a considerar en un plan de atencion por cada etapa de su vida ' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePlantillaItemPlan'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1. Abierta, 2. Multiple, 3. Simple' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePregunta', @level2type=N'COLUMN',@level2name=N'TipoRespuesta'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1 texto, 2 numero, 3 Fecha' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePregunta', @level2type=N'COLUMN',@level2name=N'TipoValorRespuesta'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Preguntas que se le pueden realizar a un paciente en su primer contacto con el establecimiento' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'AtenIntePregunta'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->farmacia emitido en caja farmacia,   2->servicios,  3->farmacia emitido en caja SERVICIOS' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'CajaComprobantesPago', @level2type=N'COLUMN',@level2name=N'IdTipoOrden'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->codigo CPT, 0->Insumo' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'FactCatalogoServicios', @level2type=N'COLUMN',@level2name=N'EsCPT'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'B->bien, S->servicio, L->laboratorio, I->Imageneologia' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'FactPuntosCarga', @level2type=N'COLUMN',@level2name=N'TipoPunto'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'devoluciones contado sin HC y los otros Tipos Financiaminentos' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'farmMovimientoNotaIngreso', @level2type=N'COLUMN',@level2name=N'idFuenteFinanciamiento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'D->Directa    P->preventa' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'farmMovimientoVentas', @level2type=N'COLUMN',@level2name=N'tipoVenta'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'devoluciones contado sin HC y los otros Tipos Financiaminentos' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'farmMovimientoVentas', @level2type=N'COLUMN',@level2name=N'idFuenteFinanciamiento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'id de tabla farmTipoConceptos (solo FArmacia)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'FuentesFinanciamiento', @level2type=N'COLUMN',@level2name=N'idTipoConceptoFarmacia'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1(solo CE), 2(solo emerg/hosp), 3(ambos)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'FuentesFinanciamiento', @level2type=N'COLUMN',@level2name=N'UtilizadoEn'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'E->Ingresos    S->Salidas' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ImagMovimiento', @level2type=N'COLUMN',@level2name=N'MovTipo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->Con Contraste, 2->sin contraste, NULL->ninguno' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ImagMovimientoImagenes', @level2type=N'COLUMN',@level2name=N'EsContraste'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->Ionico(contraste)   2->NoIonico(contraste)   NULL->ninguno' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ImagMovimientoImagenes', @level2type=N'COLUMN',@level2name=N'EsContrasteIonico'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->definitivo   2->presuntivo, NULL->ninguno' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ImagMovimientoImagenes', @level2type=N'COLUMN',@level2name=N'EsDiagnosticoDefinitivo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Unidad de medida de tiempo (Dia, Mes, Año)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'PeriodoTiempo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'0->AMBOS    1->MASCULINO   2->FEMENINO' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Servicios', @level2type=N'COLUMN',@level2name=N'soloTipoSexo'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'S->Servicio de Consulta Externa que no paga en CAJA paciente Particular por la CITA' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'Servicios', @level2type=N'COLUMN',@level2name=N'CostoCeroCE'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'3->todos   2->solo_alojados   1->solo_hosp' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposDestinoAtencion', @level2type=N'COLUMN',@level2name=N'TipoServicioHosp'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Si existe oficina en el Hospital' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'esOficina'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->Se ingresa precios desde GalenHos' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'SeIngresPrecios'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->Es una Forma de Pago (Modulo Farmacia)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'EsFarmacia'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'Ticket, Recibo, etc (solo Modulo Farmacia)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'idCajaTiposComprobante'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'D->directa      P->preventa (solo Modulo  Farmacia)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'tipoVenta'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1-> se imprime Recibo,Ticket (solo Modulo FARMACIA)' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'SeImprimeComprobante'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1-> es un Plan de Atencion, asociada a tabla: FuentesFinanciamiento' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'esFuenteFinanciamiento'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1->Genera ORDEN DE PAGO, para que el Paciente Pague posteriormente' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposFinanciamiento', @level2type=N'COLUMN',@level2name=N'GeneraPago'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'3->todos   2->solo_alojados   1->solo_hosp' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposOrigenAtencion', @level2type=N'COLUMN',@level2name=N'TipoServicioHosp'
GO
